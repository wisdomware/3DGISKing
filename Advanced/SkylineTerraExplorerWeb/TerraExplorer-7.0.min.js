/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! jQuery UI - v1.11.3 - 2015-02-12
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, draggable.js, droppable.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js, menu.js, progressbar.js, resizable.js, selectable.js, selectmenu.js, slider.js, sortable.js, spinner.js, tabs.js, tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

/* Javascript plotting library for jQuery, version 0.8.3.

Copyright (c) 2007-2014 IOLA and Ole Laursen.
Licensed under the MIT license.

*/

//var originalInstanceIds = $.map(data.features, function (c) { return c.fid; });

/*! jQuery UI - v1.10.4 - 2014-03-11
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.resizable.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

// licenseOrTutorial == 0  -> license 

// licenseOrTutorial == 1  -> tutorial

/*! jQuery UI - v1.12.0 - 2016-09-13
* http://jqueryui.com
* Includes: keycode.js, widgets/datepicker.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

/*!
 * jQuery UI Keycode 1.12.0
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Datepicker 1.12.0
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/**
 * jscolor - JavaScript Color Picker
 *
 * @link    http://jscolor.com
 * @license For open source use: GPLv3
 *          For commercial use: JSColor Commercial License
 * @author  Jan Odvarko
 * @version 2.0.4
 *
 * See usage examples at http://jscolor.com/examples/
 */

//                    var heights = tileGrid.map(function (c) {

/*! jQuery UI - v1.12.1 - 2017-11-10
* http://jqueryui.com
* Includes: widget.js, form-reset-mixin.js, keycode.js, labels.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/spinner.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

//! License: http://openseadragon.github.io/license/

/*
 * OpenSeadragon
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * Portions of this source file taken from jQuery:
 *
 * Copyright 2011 John Resig
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

/*
 * Portions of this source file taken from mattsnider.com:
 *
 * Copyright (c) 2006-2013 Matt Snider
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT
 * OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR
 * THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

/*
 * OpenSeadragon - full-screen support functions
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - EventSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - MouseTracker
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Control
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - ControlDock
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Placement
 *
 * Copyright (C) 2010-2016 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Viewer
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Navigator
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - getString/setString
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Point
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - TileSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - DziTileSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - IIIFTileSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - OsmTileSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * Derived from the OSM tile source in Rainer Simon's seajax-utils project
 * <http://github.com/rsimon/seajax-utils>.  Rainer Simon has contributed
 * the included code to the OpenSeadragon project under the New BSD license;
 * see <https://github.com/openseadragon/openseadragon/issues/58>.
 */

/*
 * OpenSeadragon - TmsTileSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * Derived from the TMS tile source in Rainer Simon's seajax-utils project
 * <http://github.com/rsimon/seajax-utils>.  Rainer Simon has contributed
 * the included code to the OpenSeadragon project under the New BSD license;
 * see <https://github.com/openseadragon/openseadragon/issues/58>.
 */

/*
 * OpenSeadragon - LegacyTileSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - ImageTileSource
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - TileSourceCollection
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Button
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - ButtonGroup
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Rect
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - ReferenceStrip
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - DisplayRect
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Spring
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - ImageLoader
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors

 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Tile
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Overlay
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Drawer
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - Viewport
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - TiledImage
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - TileCache
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * OpenSeadragon - World
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 Color animation 1.6.0
 http://www.bitstorm.org/jquery/color-animation/
 Copyright 2011, 2013 Edwin Martin
 Released under the MIT and GPL licenses.
*/

/*!child.parent.hasTilesetContent &&*/

function OpenSeadragon(e) {
    return new OpenSeadragon.Viewer(e)
}

var requirejs, require, define;
(function (e) {
    function c(e, t) {
        return f.call(e, t)
    }

    function h(e, t) {
        var n, r, i, s, o, a, f, l, c, h, p = t && t.split("/"), d = u.map, v = d && d["*"] || {};
        if (e && e.charAt(0) === ".") if (t) {
            p = p.slice(0, p.length - 1), e = p.concat(e.split("/"));
            for (l = 0; l < e.length; l += 1) {
                h = e[l];
                if (h === ".") e.splice(l, 1), l -= 1; else if (h === "..") {
                    if (l === 1 && (e[2] === ".." || e[0] === "..")) break;
                    l > 0 && (e.splice(l - 1, 2), l -= 2)
                }
            }
            e = e.join("/")
        } else e.indexOf("./") === 0 && (e = e.substring(2));
        if ((p || v) && d) {
            n = e.split("/");
            for (l = n.length; l > 0; l -= 1) {
                r = n.slice(0, l).join("/");
                if (p) for (c = p.length; c > 0; c -= 1) {
                    i = d[p.slice(0, c).join("/")];
                    if (i) {
                        i = i[r];
                        if (i) {
                            s = i, o = l;
                            break
                        }
                    }
                }
                if (s) break;
                !a && v && v[r] && (a = v[r], f = l)
            }
            !s && a && (s = a, o = f), s && (n.splice(0, o, s), e = n.join("/"))
        }
        return e
    }

    function p(t, r) {
        return function () {
            return n.apply(e, l.call(arguments, 0).concat([t, r]))
        }
    }

    function d(e) {
        return function (t) {
            return h(t, e)
        }
    }

    function v(e) {
        return function (t) {
            s[e] = t
        }
    }

    function m(n) {
        if (c(o, n)) {
            var r = o[n];
            delete o[n], a[n] = !0, t.apply(e, r)
        }
        if (!c(s, n) && !c(a, n)) throw new Error("No " + n);
        return s[n]
    }

    function g(e) {
        var t, n = e ? e.indexOf("!") : -1;
        return n > -1 && (t = e.substring(0, n), e = e.substring(n + 1, e.length)), [t, e]
    }

    function y(e) {
        return function () {
            return u && u.config && u.config[e] || {}
        }
    }

    var t, n, r, i, s = {}, o = {}, u = {}, a = {}, f = Object.prototype.hasOwnProperty, l = [].slice;
    r = function (e, t) {
        var n, r = g(e), i = r[0];
        return e = r[1], i && (i = h(i, t), n = m(i)), i ? n && n.normalize ? e = n.normalize(e, d(t)) : e = h(e, t) : (e = h(e, t), r = g(e), i = r[0], e = r[1], i && (n = m(i))), {
            f: i ? i + "!" + e : e,
            n: e,
            pr: i,
            p: n
        }
    }, i = {
        require: function (e) {
            return p(e)
        }, exports: function (e) {
            var t = s[e];
            return typeof t != "undefined" ? t : s[e] = {}
        }, module: function (e) {
            return {id: e, uri: "", exports: s[e], config: y(e)}
        }
    }, t = function (t, n, u, f) {
        var l, h, d, g, y, b = [], w;
        f = f || t;
        if (typeof u == "function") {
            n = !n.length && u.length ? ["require", "exports", "module"] : n;
            for (y = 0; y < n.length; y += 1) {
                g = r(n[y], f), h = g.f;
                if (h === "require") b[y] = i.require(t); else if (h === "exports") b[y] = i.exports(t), w = !0; else if (h === "module") l = b[y] = i.module(t); else if (c(s, h) || c(o, h) || c(a, h)) b[y] = m(h); else {
                    if (!g.p) throw new Error(t + " missing " + h);
                    g.p.load(g.n, p(f, !0), v(h), {}), b[y] = s[h]
                }
            }
            d = u.apply(s[t], b);
            if (t) if (l && l.exports !== e && l.exports !== s[t]) s[t] = l.exports; else if (d !== e || !w) s[t] = d
        } else t && (s[t] = u)
    }, requirejs = require = n = function (s, o, a, f, l) {
        return typeof s == "string" ? i[s] ? i[s](o) : m(r(s, o).f) : (s.splice || (u = s, o.splice ? (s = o, o = a, a = null) : s = e), o = o || function () {
        }, typeof a == "function" && (a = f, f = l), f ? t(e, s, o, a) : setTimeout(function () {
            t(e, s, o, a)
        }, 4), n)
    }, n.config = function (e) {
        return u = e, u.deps && n(u.deps, u.callback), n
    }, requirejs._defined = s, define = function (e, t, n) {
        t.splice || (n = t, t = []), !c(s, e) && !c(o, e) && (o[e] = [e, t, n])
    }, define.amd = {jQuery: !0}
})(), define("../ThirdParty/js/almond.js", function () {
}), define("jquery", [], function () {
    return $
}), function (e) {
    "function" == typeof define && define.amd ? define("jquery-ui.min", ["jquery"], e) : e(jQuery)
}(function (e) {
    function t(t, r) {
        var i, s, o, u = t.nodeName.toLowerCase();
        return "area" === u ? (i = t.parentNode, s = i.name, t.href && s && "map" === i.nodeName.toLowerCase() ? (o = e("img[usemap='#" + s + "']")[0], !!o && n(o)) : !1) : (/^(input|select|textarea|button|object)$/.test(u) ? !t.disabled : "a" === u ? t.href || r : r) && n(t)
    }

    function n(t) {
        return e.expr.filters.visible(t) && !e(t).parents().addBack().filter(function () {
            return "hidden" === e.css(this, "visibility")
        }).length
    }

    function r(e) {
        for (var t, n; e.length && e[0] !== document;) {
            if (t = e.css("position"), ("absolute" === t || "relative" === t || "fixed" === t) && (n = parseInt(e.css("zIndex"), 10), !isNaN(n) && 0 !== n)) return n;
            e = e.parent()
        }
        return 0
    }

    function i() {
        this._curInst = null, this._keyEvent = !1, this._disabledInputs = [], this._datepickerShowing = !1, this._inDialog = !1, this._mainDivId = "ui-datepicker-div", this._inlineClass = "ui-datepicker-inline", this._appendClass = "ui-datepicker-append", this._triggerClass = "ui-datepicker-trigger", this._dialogClass = "ui-datepicker-dialog", this._disableClass = "ui-datepicker-disabled", this._unselectableClass = "ui-datepicker-unselectable", this._currentClass = "ui-datepicker-current-day", this._dayOverClass = "ui-datepicker-days-cell-over", this.regional = [], this.regional[""] = {
            closeText: "Done",
            prevText: "Prev",
            nextText: "Next",
            currentText: "Today",
            monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            monthNamesShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
            dayNamesShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
            dayNamesMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
            weekHeader: "Wk",
            dateFormat: "mm/dd/yy",
            firstDay: 0,
            isRTL: !1,
            showMonthAfterYear: !1,
            yearSuffix: ""
        }, this._defaults = {
            showOn: "focus",
            showAnim: "fadeIn",
            showOptions: {},
            defaultDate: null,
            appendText: "",
            buttonText: "...",
            buttonImage: "",
            buttonImageOnly: !1,
            hideIfNoPrevNext: !1,
            navigationAsDateFormat: !1,
            gotoCurrent: !1,
            changeMonth: !1,
            changeYear: !1,
            yearRange: "c-10:c+10",
            showOtherMonths: !1,
            selectOtherMonths: !1,
            showWeek: !1,
            calculateWeek: this.iso8601Week,
            shortYearCutoff: "+10",
            minDate: null,
            maxDate: null,
            duration: "fast",
            beforeShowDay: null,
            beforeShow: null,
            onSelect: null,
            onChangeMonthYear: null,
            onClose: null,
            numberOfMonths: 1,
            showCurrentAtPos: 0,
            stepMonths: 1,
            stepBigMonths: 12,
            altField: "",
            altFormat: "",
            constrainInput: !0,
            showButtonPanel: !1,
            autoSize: !1,
            disabled: !1
        }, e.extend(this._defaults, this.regional[""]), this.regional.en = e.extend(!0, {}, this.regional[""]), this.regional["en-US"] = e.extend(!0, {}, this.regional.en), this.dpDiv = s(e("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))
    }

    function s(t) {
        var n = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
        return t.delegate(n, "mouseout", function () {
            e(this).removeClass("ui-state-hover"), -1 !== this.className.indexOf("ui-datepicker-prev") && e(this).removeClass("ui-datepicker-prev-hover"), -1 !== this.className.indexOf("ui-datepicker-next") && e(this).removeClass("ui-datepicker-next-hover")
        }).delegate(n, "mouseover", o)
    }

    function o() {
        e.datepicker._isDisabledDatepicker(g.inline ? g.dpDiv.parent()[0] : g.input[0]) || (e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"), e(this).addClass("ui-state-hover"), -1 !== this.className.indexOf("ui-datepicker-prev") && e(this).addClass("ui-datepicker-prev-hover"), -1 !== this.className.indexOf("ui-datepicker-next") && e(this).addClass("ui-datepicker-next-hover"))
    }

    function u(t, n) {
        e.extend(t, n);
        for (var r in n) null == n[r] && (t[r] = n[r]);
        return t
    }

    function a(e) {
        return function () {
            var t = this.element.val();
            e.apply(this, arguments), this._refresh(), t !== this.element.val() && this._trigger("change")
        }
    }

    e.ui = e.ui || {}, e.extend(e.ui, {
        version: "1.11.3",
        keyCode: {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38
        }
    }), e.fn.extend({
        scrollParent: function (t) {
            var n = this.css("position"), r = "absolute" === n, i = t ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
                s = this.parents().filter(function () {
                    var t = e(this);
                    return r && "static" === t.css("position") ? !1 : i.test(t.css("overflow") + t.css("overflow-y") + t.css("overflow-x"))
                }).eq(0);
            return "fixed" !== n && s.length ? s : e(this[0].ownerDocument || document)
        }, uniqueId: function () {
            var e = 0;
            return function () {
                return this.each(function () {
                    this.id || (this.id = "ui-id-" + ++e)
                })
            }
        }(), removeUniqueId: function () {
            return this.each(function () {
                /^ui-id-\d+$/.test(this.id) && e(this).removeAttr("id")
            })
        }
    }), e.extend(e.expr[":"], {
        data: e.expr.createPseudo ? e.expr.createPseudo(function (t) {
            return function (n) {
                return !!e.data(n, t)
            }
        }) : function (t, n, r) {
            return !!e.data(t, r[3])
        }, focusable: function (n) {
            return t(n, !isNaN(e.attr(n, "tabindex")))
        }, tabbable: function (n) {
            var r = e.attr(n, "tabindex"), i = isNaN(r);
            return (i || r >= 0) && t(n, !i)
        }
    }), e("<a>").outerWidth(1).jquery || e.each(["Width", "Height"], function (t, n) {
        function r(t, n, r, s) {
            return e.each(i, function () {
                n -= parseFloat(e.css(t, "padding" + this)) || 0, r && (n -= parseFloat(e.css(t, "border" + this + "Width")) || 0), s && (n -= parseFloat(e.css(t, "margin" + this)) || 0)
            }), n
        }

        var i = "Width" === n ? ["Left", "Right"] : ["Top", "Bottom"], s = n.toLowerCase(), o = {
            innerWidth: e.fn.innerWidth,
            innerHeight: e.fn.innerHeight,
            outerWidth: e.fn.outerWidth,
            outerHeight: e.fn.outerHeight
        };
        e.fn["inner" + n] = function (t) {
            return void 0 === t ? o["inner" + n].call(this) : this.each(function () {
                e(this).css(s, r(this, t) + "px")
            })
        }, e.fn["outer" + n] = function (t, i) {
            return "number" != typeof t ? o["outer" + n].call(this, t) : this.each(function () {
                e(this).css(s, r(this, t, !0, i) + "px")
            })
        }
    }), e.fn.addBack || (e.fn.addBack = function (e) {
        return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
    }), e("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (e.fn.removeData = function (t) {
        return function (n) {
            return arguments.length ? t.call(this, e.camelCase(n)) : t.call(this)
        }
    }(e.fn.removeData)), e.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()), e.fn.extend({
        focus: function (t) {
            return function (n, r) {
                return "number" == typeof n ? this.each(function () {
                    var t = this;
                    setTimeout(function () {
                        e(t).focus(), r && r.call(t)
                    }, n)
                }) : t.apply(this, arguments)
            }
        }(e.fn.focus), disableSelection: function () {
            var e = "onselectstart" in document.createElement("div") ? "selectstart" : "mousedown";
            return function () {
                return this.bind(e + ".ui-disableSelection", function (e) {
                    e.preventDefault()
                })
            }
        }(), enableSelection: function () {
            return this.unbind(".ui-disableSelection")
        }, zIndex: function (t) {
            if (void 0 !== t) return this.css("zIndex", t);
            if (this.length) for (var n, r, i = e(this[0]); i.length && i[0] !== document;) {
                if (n = i.css("position"), ("absolute" === n || "relative" === n || "fixed" === n) && (r = parseInt(i.css("zIndex"), 10), !isNaN(r) && 0 !== r)) return r;
                i = i.parent()
            }
            return 0
        }
    }), e.ui.plugin = {
        add: function (t, n, r) {
            var i, s = e.ui[t].prototype;
            for (i in r) s.plugins[i] = s.plugins[i] || [], s.plugins[i].push([n, r[i]])
        }, call: function (e, t, n, r) {
            var i, s = e.plugins[t];
            if (s && (r || e.element[0].parentNode && 11 !== e.element[0].parentNode.nodeType)) for (i = 0; s.length > i; i++) e.options[s[i][0]] && s[i][1].apply(e.element, n)
        }
    };
    var f = 0, l = Array.prototype.slice;
    e.cleanData = function (t) {
        return function (n) {
            var r, i, s;
            for (s = 0; null != (i = n[s]); s++) try {
                r = e._data(i, "events"), r && r.remove && e(i).triggerHandler("remove")
            } catch (o) {
            }
            t(n)
        }
    }(e.cleanData), e.widget = function (t, n, r) {
        var i, s, o, u, a = {}, f = t.split(".")[0];
        return t = t.split(".")[1], i = f + "-" + t, r || (r = n, n = e.Widget), e.expr[":"][i.toLowerCase()] = function (t) {
            return !!e.data(t, i)
        }, e[f] = e[f] || {}, s = e[f][t], o = e[f][t] = function (e, t) {
            return this._createWidget ? (arguments.length && this._createWidget(e, t), void 0) : new o(e, t)
        }, e.extend(o, s, {
            version: r.version,
            _proto: e.extend({}, r),
            _childConstructors: []
        }), u = new n, u.options = e.widget.extend({}, u.options), e.each(r, function (t, r) {
            return e.isFunction(r) ? (a[t] = function () {
                var e = function () {
                    return n.prototype[t].apply(this, arguments)
                }, i = function (e) {
                    return n.prototype[t].apply(this, e)
                };
                return function () {
                    var t, n = this._super, s = this._superApply;
                    return this._super = e, this._superApply = i, t = r.apply(this, arguments), this._super = n, this._superApply = s, t
                }
            }(), void 0) : (a[t] = r, void 0)
        }), o.prototype = e.widget.extend(u, {widgetEventPrefix: s ? u.widgetEventPrefix || t : t}, a, {
            constructor: o,
            namespace: f,
            widgetName: t,
            widgetFullName: i
        }), s ? (e.each(s._childConstructors, function (t, n) {
            var r = n.prototype;
            e.widget(r.namespace + "." + r.widgetName, o, n._proto)
        }), delete s._childConstructors) : n._childConstructors.push(o), e.widget.bridge(t, o), o
    }, e.widget.extend = function (t) {
        for (var n, r, i = l.call(arguments, 1), s = 0, o = i.length; o > s; s++) for (n in i[s]) r = i[s][n], i[s].hasOwnProperty(n) && void 0 !== r && (t[n] = e.isPlainObject(r) ? e.isPlainObject(t[n]) ? e.widget.extend({}, t[n], r) : e.widget.extend({}, r) : r);
        return t
    }, e.widget.bridge = function (t, n) {
        var r = n.prototype.widgetFullName || t;
        e.fn[t] = function (i) {
            var s = "string" == typeof i, o = l.call(arguments, 1), u = this;
            return s ? this.each(function () {
                var n, s = e.data(this, r);
                return "instance" === i ? (u = s, !1) : s ? e.isFunction(s[i]) && "_" !== i.charAt(0) ? (n = s[i].apply(s, o), n !== s && void 0 !== n ? (u = n && n.jquery ? u.pushStack(n.get()) : n, !1) : void 0) : e.error("no such method '" + i + "' for " + t + " widget instance") : e.error("cannot call methods on " + t + " prior to initialization; " + "attempted to call method '" + i + "'")
            }) : (o.length && (i = e.widget.extend.apply(null, [i].concat(o))), this.each(function () {
                var t = e.data(this, r);
                t ? (t.option(i || {}), t._init && t._init()) : e.data(this, r, new n(i, this))
            })), u
        }
    }, e.Widget = function () {
    }, e.Widget._childConstructors = [], e.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: {disabled: !1, create: null},
        _createWidget: function (t, n) {
            n = e(n || this.defaultElement || this)[0], this.element = e(n), this.uuid = f++, this.eventNamespace = "." + this.widgetName + this.uuid, this.bindings = e(), this.hoverable = e(), this.focusable = e(), n !== this && (e.data(n, this.widgetFullName, this), this._on(!0, this.element, {
                remove: function (e) {
                    e.target === n && this.destroy()
                }
            }), this.document = e(n.style ? n.ownerDocument : n.document || n), this.window = e(this.document[0].defaultView || this.document[0].parentWindow)), this.options = e.widget.extend({}, this.options, this._getCreateOptions(), t), this._create(), this._trigger("create", null, this._getCreateEventData()), this._init()
        },
        _getCreateOptions: e.noop,
        _getCreateEventData: e.noop,
        _create: e.noop,
        _init: e.noop,
        destroy: function () {
            this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)), this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled " + "ui-state-disabled"), this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")
        },
        _destroy: e.noop,
        widget: function () {
            return this.element
        },
        option: function (t, n) {
            var r, i, s, o = t;
            if (0 === arguments.length) return e.widget.extend({}, this.options);
            if ("string" == typeof t) if (o = {}, r = t.split("."), t = r.shift(), r.length) {
                for (i = o[t] = e.widget.extend({}, this.options[t]), s = 0; r.length - 1 > s; s++) i[r[s]] = i[r[s]] || {}, i = i[r[s]];
                if (t = r.pop(), 1 === arguments.length) return void 0 === i[t] ? null : i[t];
                i[t] = n
            } else {
                if (1 === arguments.length) return void 0 === this.options[t] ? null : this.options[t];
                o[t] = n
            }
            return this._setOptions(o), this
        },
        _setOptions: function (e) {
            var t;
            for (t in e) this._setOption(t, e[t]);
            return this
        },
        _setOption: function (e, t) {
            return this.options[e] = t, "disabled" === e && (this.widget().toggleClass(this.widgetFullName + "-disabled", !!t), t && (this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus"))), this
        },
        enable: function () {
            return this._setOptions({disabled: !1})
        },
        disable: function () {
            return this._setOptions({disabled: !0})
        },
        _on: function (t, n, r) {
            var i, s = this;
            "boolean" != typeof t && (r = n, n = t, t = !1), r ? (n = i = e(n), this.bindings = this.bindings.add(n)) : (r = n, n = this.element, i = this.widget()), e.each(r, function (r, o) {
                function u() {
                    return t || s.options.disabled !== !0 && !e(this).hasClass("ui-state-disabled") ? ("string" == typeof o ? s[o] : o).apply(s, arguments) : void 0
                }

                "string" != typeof o && (u.guid = o.guid = o.guid || u.guid || e.guid++);
                var a = r.match(/^([\w:-]*)\s*(.*)$/), f = a[1] + s.eventNamespace, l = a[2];
                l ? i.delegate(l, f, u) : n.bind(f, u)
            })
        },
        _off: function (t, n) {
            n = (n || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, t.unbind(n).undelegate(n), this.bindings = e(this.bindings.not(t).get()), this.focusable = e(this.focusable.not(t).get()), this.hoverable = e(this.hoverable.not(t).get())
        },
        _delay: function (e, t) {
            function n() {
                return ("string" == typeof e ? r[e] : e).apply(r, arguments)
            }

            var r = this;
            return setTimeout(n, t || 0)
        },
        _hoverable: function (t) {
            this.hoverable = this.hoverable.add(t), this._on(t, {
                mouseenter: function (t) {
                    e(t.currentTarget).addClass("ui-state-hover")
                }, mouseleave: function (t) {
                    e(t.currentTarget).removeClass("ui-state-hover")
                }
            })
        },
        _focusable: function (t) {
            this.focusable = this.focusable.add(t), this._on(t, {
                focusin: function (t) {
                    e(t.currentTarget).addClass("ui-state-focus")
                }, focusout: function (t) {
                    e(t.currentTarget).removeClass("ui-state-focus")
                }
            })
        },
        _trigger: function (t, n, r) {
            var i, s, o = this.options[t];
            if (r = r || {}, n = e.Event(n), n.type = (t === this.widgetEventPrefix ? t : this.widgetEventPrefix + t).toLowerCase(), n.target = this.element[0], s = n.originalEvent) for (i in s) i in n || (n[i] = s[i]);
            return this.element.trigger(n, r), !(e.isFunction(o) && o.apply(this.element[0], [n].concat(r)) === !1 || n.isDefaultPrevented())
        }
    }, e.each({show: "fadeIn", hide: "fadeOut"}, function (t, n) {
        e.Widget.prototype["_" + t] = function (r, i, s) {
            "string" == typeof i && (i = {effect: i});
            var o, u = i ? i === !0 || "number" == typeof i ? n : i.effect || n : t;
            i = i || {}, "number" == typeof i && (i = {duration: i}), o = !e.isEmptyObject(i), i.complete = s, i.delay && r.delay(i.delay), o && e.effects && e.effects.effect[u] ? r[t](i) : u !== t && r[u] ? r[u](i.duration, i.easing, s) : r.queue(function (n) {
                e(this)[t](), s && s.call(r[0]), n()
            })
        }
    }), e.widget;
    var c = !1;
    e(document).mouseup(function () {
        c = !1
    }), e.widget("ui.mouse", {
        version: "1.11.3",
        options: {cancel: "input,textarea,button,select,option", distance: 1, delay: 0},
        _mouseInit: function () {
            var t = this;
            this.element.bind("mousedown." + this.widgetName, function (e) {
                return t._mouseDown(e)
            }).bind("click." + this.widgetName, function (n) {
                return !0 === e.data(n.target, t.widgetName + ".preventClickEvent") ? (e.removeData(n.target, t.widgetName + ".preventClickEvent"), n.stopImmediatePropagation(), !1) : void 0
            }), this.started = !1
        },
        _mouseDestroy: function () {
            this.element.unbind("." + this.widgetName), this._mouseMoveDelegate && this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
        },
        _mouseDown: function (t) {
            if (!c) {
                this._mouseMoved = !1, this._mouseStarted && this._mouseUp(t), this._mouseDownEvent = t;
                var n = this, r = 1 === t.which,
                    i = "string" == typeof this.options.cancel && t.target.nodeName ? e(t.target).closest(this.options.cancel).length : !1;
                return r && !i && this._mouseCapture(t) ? (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function () {
                    n.mouseDelayMet = !0
                }, this.options.delay)), this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(t) !== !1, !this._mouseStarted) ? (t.preventDefault(), !0) : (!0 === e.data(t.target, this.widgetName + ".preventClickEvent") && e.removeData(t.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function (e) {
                    return n._mouseMove(e)
                }, this._mouseUpDelegate = function (e) {
                    return n._mouseUp(e)
                }, this.document.bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), t.preventDefault(), c = !0, !0)) : !0
            }
        },
        _mouseMove: function (t) {
            if (this._mouseMoved) {
                if (e.ui.ie && (!document.documentMode || 9 > document.documentMode) && !t.button) return this._mouseUp(t);
                if (!t.which) return this._mouseUp(t)
            }
            return (t.which || t.button) && (this._mouseMoved = !0), this._mouseStarted ? (this._mouseDrag(t), t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1, this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted)
        },
        _mouseUp: function (t) {
            return this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, t.target === this._mouseDownEvent.target && e.data(t.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(t)), c = !1, !1
        },
        _mouseDistanceMet: function (e) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - e.pageX), Math.abs(this._mouseDownEvent.pageY - e.pageY)) >= this.options.distance
        },
        _mouseDelayMet: function () {
            return this.mouseDelayMet
        },
        _mouseStart: function () {
        },
        _mouseDrag: function () {
        },
        _mouseStop: function () {
        },
        _mouseCapture: function () {
            return !0
        }
    }), function () {
        function t(e, t, n) {
            return [parseFloat(e[0]) * (p.test(e[0]) ? t / 100 : 1), parseFloat(e[1]) * (p.test(e[1]) ? n / 100 : 1)]
        }

        function n(t, n) {
            return parseInt(e.css(t, n), 10) || 0
        }

        function r(t) {
            var n = t[0];
            return 9 === n.nodeType ? {
                width: t.width(),
                height: t.height(),
                offset: {top: 0, left: 0}
            } : e.isWindow(n) ? {
                width: t.width(),
                height: t.height(),
                offset: {top: t.scrollTop(), left: t.scrollLeft()}
            } : n.preventDefault ? {
                width: 0,
                height: 0,
                offset: {top: n.pageY, left: n.pageX}
            } : {width: t.outerWidth(), height: t.outerHeight(), offset: t.offset()}
        }

        e.ui = e.ui || {};
        var i, s, o = Math.max, u = Math.abs, a = Math.round, f = /left|center|right/, l = /top|center|bottom/,
            c = /[\+\-]\d+(\.[\d]+)?%?/, h = /^\w+/, p = /%$/, d = e.fn.position;
        e.position = {
            scrollbarWidth: function () {
                if (void 0 !== i) return i;
                var t, n,
                    r = e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),
                    s = r.children()[0];
                return e("body").append(r), t = s.offsetWidth, r.css("overflow", "scroll"), n = s.offsetWidth, t === n && (n = r[0].clientWidth), r.remove(), i = t - n
            }, getScrollInfo: function (t) {
                var n = t.isWindow || t.isDocument ? "" : t.element.css("overflow-x"),
                    r = t.isWindow || t.isDocument ? "" : t.element.css("overflow-y"),
                    i = "scroll" === n || "auto" === n && t.width < t.element[0].scrollWidth,
                    s = "scroll" === r || "auto" === r && t.height < t.element[0].scrollHeight;
                return {width: s ? e.position.scrollbarWidth() : 0, height: i ? e.position.scrollbarWidth() : 0}
            }, getWithinInfo: function (t) {
                var n = e(t || window), r = e.isWindow(n[0]), i = !!n[0] && 9 === n[0].nodeType;
                return {
                    element: n,
                    isWindow: r,
                    isDocument: i,
                    offset: n.offset() || {left: 0, top: 0},
                    scrollLeft: n.scrollLeft(),
                    scrollTop: n.scrollTop(),
                    width: r || i ? n.width() : n.outerWidth(),
                    height: r || i ? n.height() : n.outerHeight()
                }
            }
        }, e.fn.position = function (i) {
            if (!i || !i.of) return d.apply(this, arguments);
            i = e.extend({}, i);
            var p, v, m, g, y, b, w = e(i.of), E = e.position.getWithinInfo(i.within), S = e.position.getScrollInfo(E),
                x = (i.collision || "flip").split(" "), T = {};
            return b = r(w), w[0].preventDefault && (i.at = "left top"), v = b.width, m = b.height, g = b.offset, y = e.extend({}, g), e.each(["my", "at"], function () {
                var e, t, n = (i[this] || "").split(" ");
                1 === n.length && (n = f.test(n[0]) ? n.concat(["center"]) : l.test(n[0]) ? ["center"].concat(n) : ["center", "center"]), n[0] = f.test(n[0]) ? n[0] : "center", n[1] = l.test(n[1]) ? n[1] : "center", e = c.exec(n[0]), t = c.exec(n[1]), T[this] = [e ? e[0] : 0, t ? t[0] : 0], i[this] = [h.exec(n[0])[0], h.exec(n[1])[0]]
            }), 1 === x.length && (x[1] = x[0]), "right" === i.at[0] ? y.left += v : "center" === i.at[0] && (y.left += v / 2), "bottom" === i.at[1] ? y.top += m : "center" === i.at[1] && (y.top += m / 2), p = t(T.at, v, m), y.left += p[0], y.top += p[1], this.each(function () {
                var r, f, l = e(this), c = l.outerWidth(), h = l.outerHeight(), d = n(this, "marginLeft"),
                    b = n(this, "marginTop"), N = c + d + n(this, "marginRight") + S.width,
                    C = h + b + n(this, "marginBottom") + S.height, L = e.extend({}, y),
                    A = t(T.my, l.outerWidth(), l.outerHeight());
                "right" === i.my[0] ? L.left -= c : "center" === i.my[0] && (L.left -= c / 2), "bottom" === i.my[1] ? L.top -= h : "center" === i.my[1] && (L.top -= h / 2), L.left += A[0], L.top += A[1], s || (L.left = a(L.left), L.top = a(L.top)), r = {
                    marginLeft: d,
                    marginTop: b
                }, e.each(["left", "top"], function (t, n) {
                    e.ui.position[x[t]] && e.ui.position[x[t]][n](L, {
                        targetWidth: v,
                        targetHeight: m,
                        elemWidth: c,
                        elemHeight: h,
                        collisionPosition: r,
                        collisionWidth: N,
                        collisionHeight: C,
                        offset: [p[0] + A[0], p[1] + A[1]],
                        my: i.my,
                        at: i.at,
                        within: E,
                        elem: l
                    })
                }), i.using && (f = function (e) {
                    var t = g.left - L.left, n = t + v - c, r = g.top - L.top, s = r + m - h, a = {
                        target: {element: w, left: g.left, top: g.top, width: v, height: m},
                        element: {element: l, left: L.left, top: L.top, width: c, height: h},
                        horizontal: 0 > n ? "left" : t > 0 ? "right" : "center",
                        vertical: 0 > s ? "top" : r > 0 ? "bottom" : "middle"
                    };
                    c > v && v > u(t + n) && (a.horizontal = "center"), h > m && m > u(r + s) && (a.vertical = "middle"), a.important = o(u(t), u(n)) > o(u(r), u(s)) ? "horizontal" : "vertical", i.using.call(this, e, a)
                }), l.offset(e.extend(L, {using: f}))
            })
        }, e.ui.position = {
            fit: {
                left: function (e, t) {
                    var n, r = t.within, i = r.isWindow ? r.scrollLeft : r.offset.left, s = r.width,
                        u = e.left - t.collisionPosition.marginLeft, a = i - u, f = u + t.collisionWidth - s - i;
                    t.collisionWidth > s ? a > 0 && 0 >= f ? (n = e.left + a + t.collisionWidth - s - i, e.left += a - n) : e.left = f > 0 && 0 >= a ? i : a > f ? i + s - t.collisionWidth : i : a > 0 ? e.left += a : f > 0 ? e.left -= f : e.left = o(e.left - u, e.left)
                }, top: function (e, t) {
                    var n, r = t.within, i = r.isWindow ? r.scrollTop : r.offset.top, s = t.within.height,
                        u = e.top - t.collisionPosition.marginTop, a = i - u, f = u + t.collisionHeight - s - i;
                    t.collisionHeight > s ? a > 0 && 0 >= f ? (n = e.top + a + t.collisionHeight - s - i, e.top += a - n) : e.top = f > 0 && 0 >= a ? i : a > f ? i + s - t.collisionHeight : i : a > 0 ? e.top += a : f > 0 ? e.top -= f : e.top = o(e.top - u, e.top)
                }
            }, flip: {
                left: function (e, t) {
                    var n, r, i = t.within, s = i.offset.left + i.scrollLeft, o = i.width,
                        a = i.isWindow ? i.scrollLeft : i.offset.left, f = e.left - t.collisionPosition.marginLeft,
                        l = f - a, c = f + t.collisionWidth - o - a,
                        h = "left" === t.my[0] ? -t.elemWidth : "right" === t.my[0] ? t.elemWidth : 0,
                        p = "left" === t.at[0] ? t.targetWidth : "right" === t.at[0] ? -t.targetWidth : 0,
                        d = -2 * t.offset[0];
                    0 > l ? (n = e.left + h + p + d + t.collisionWidth - o - s, (0 > n || u(l) > n) && (e.left += h + p + d)) : c > 0 && (r = e.left - t.collisionPosition.marginLeft + h + p + d - a, (r > 0 || c > u(r)) && (e.left += h + p + d))
                }, top: function (e, t) {
                    var n, r, i = t.within, s = i.offset.top + i.scrollTop, o = i.height,
                        a = i.isWindow ? i.scrollTop : i.offset.top, f = e.top - t.collisionPosition.marginTop,
                        l = f - a, c = f + t.collisionHeight - o - a, h = "top" === t.my[1],
                        p = h ? -t.elemHeight : "bottom" === t.my[1] ? t.elemHeight : 0,
                        d = "top" === t.at[1] ? t.targetHeight : "bottom" === t.at[1] ? -t.targetHeight : 0,
                        v = -2 * t.offset[1];
                    0 > l ? (r = e.top + p + d + v + t.collisionHeight - o - s, (0 > r || u(l) > r) && (e.top += p + d + v)) : c > 0 && (n = e.top - t.collisionPosition.marginTop + p + d + v - a, (n > 0 || c > u(n)) && (e.top += p + d + v))
                }
            }, flipfit: {
                left: function () {
                    e.ui.position.flip.left.apply(this, arguments), e.ui.position.fit.left.apply(this, arguments)
                }, top: function () {
                    e.ui.position.flip.top.apply(this, arguments), e.ui.position.fit.top.apply(this, arguments)
                }
            }
        }, function () {
            var t, n, r, i, o, u = document.getElementsByTagName("body")[0], a = document.createElement("div");
            t = document.createElement(u ? "div" : "body"), r = {
                visibility: "hidden",
                width: 0,
                height: 0,
                border: 0,
                margin: 0,
                background: "none"
            }, u && e.extend(r, {position: "absolute", left: "-1000px", top: "-1000px"});
            for (o in r) t.style[o] = r[o];
            t.appendChild(a), n = u || document.documentElement, n.insertBefore(t, n.firstChild), a.style.cssText = "position: absolute; left: 10.7432222px;", i = e(a).offset().left, s = i > 10 && 11 > i, t.innerHTML = "", n.removeChild(t)
        }()
    }(), e.ui.position, e.widget("ui.accordion", {
        version: "1.11.3",
        options: {
            active: 0,
            animate: {},
            collapsible: !1,
            event: "click",
            header: "> li > :first-child,> :not(li):even",
            heightStyle: "auto",
            icons: {activeHeader: "ui-icon-triangle-1-s", header: "ui-icon-triangle-1-e"},
            activate: null,
            beforeActivate: null
        },
        hideProps: {
            borderTopWidth: "hide",
            borderBottomWidth: "hide",
            paddingTop: "hide",
            paddingBottom: "hide",
            height: "hide"
        },
        showProps: {
            borderTopWidth: "show",
            borderBottomWidth: "show",
            paddingTop: "show",
            paddingBottom: "show",
            height: "show"
        },
        _create: function () {
            var t = this.options;
            this.prevShow = this.prevHide = e(), this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role", "tablist"), t.collapsible || t.active !== !1 && null != t.active || (t.active = 0), this._processPanels(), 0 > t.active && (t.active += this.headers.length), this._refresh()
        },
        _getCreateEventData: function () {
            return {header: this.active, panel: this.active.length ? this.active.next() : e()}
        },
        _createIcons: function () {
            var t = this.options.icons;
            t && (e("<span>").addClass("ui-accordion-header-icon ui-icon " + t.header).prependTo(this.headers), this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader), this.headers.addClass("ui-accordion-icons"))
        },
        _destroyIcons: function () {
            this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()
        },
        _destroy: function () {
            var e;
            this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"), this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(), this._destroyIcons(), e = this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display", "").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(), "content" !== this.options.heightStyle && e.css("height", "")
        },
        _setOption: function (e, t) {
            return "active" === e ? (this._activate(t), void 0) : ("event" === e && (this.options.event && this._off(this.headers, this.options.event), this._setupEvents(t)), this._super(e, t), "collapsible" !== e || t || this.options.active !== !1 || this._activate(0), "icons" === e && (this._destroyIcons(), t && this._createIcons()), "disabled" === e && (this.element.toggleClass("ui-state-disabled", !!t).attr("aria-disabled", t), this.headers.add(this.headers.next()).toggleClass("ui-state-disabled", !!t)), void 0)
        },
        _keydown: function (t) {
            if (!t.altKey && !t.ctrlKey) {
                var n = e.ui.keyCode, r = this.headers.length, i = this.headers.index(t.target), s = !1;
                switch (t.keyCode) {
                    case n.RIGHT:
                    case n.DOWN:
                        s = this.headers[(i + 1) % r];
                        break;
                    case n.LEFT:
                    case n.UP:
                        s = this.headers[(i - 1 + r) % r];
                        break;
                    case n.SPACE:
                    case n.ENTER:
                        this._eventHandler(t);
                        break;
                    case n.HOME:
                        s = this.headers[0];
                        break;
                    case n.END:
                        s = this.headers[r - 1]
                }
                s && (e(t.target).attr("tabIndex", -1), e(s).attr("tabIndex", 0), s.focus(), t.preventDefault())
            }
        },
        _panelKeyDown: function (t) {
            t.keyCode === e.ui.keyCode.UP && t.ctrlKey && e(t.currentTarget).prev().focus()
        },
        refresh: function () {
            var t = this.options;
            this._processPanels(), t.active === !1 && t.collapsible === !0 || !this.headers.length ? (t.active = !1, this.active = e()) : t.active === !1 ? this._activate(0) : this.active.length && !e.contains(this.element[0], this.active[0]) ? this.headers.length === this.headers.find(".ui-state-disabled").length ? (t.active = !1, this.active = e()) : this._activate(Math.max(0, t.active - 1)) : t.active = this.headers.index(this.active), this._destroyIcons(), this._refresh()
        },
        _processPanels: function () {
            var e = this.headers, t = this.panels;
            this.headers = this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"), this.panels = this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(), t && (this._off(e.not(this.headers)), this._off(t.not(this.panels)))
        },
        _refresh: function () {
            var t, n = this.options, r = n.heightStyle, i = this.element.parent();
            this.active = this._findActive(n.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"), this.active.next().addClass("ui-accordion-content-active").show(), this.headers.attr("role", "tab").each(function () {
                var t = e(this), n = t.uniqueId().attr("id"), r = t.next(), i = r.uniqueId().attr("id");
                t.attr("aria-controls", i), r.attr("aria-labelledby", n)
            }).next().attr("role", "tabpanel"), this.headers.not(this.active).attr({
                "aria-selected": "false",
                "aria-expanded": "false",
                tabIndex: -1
            }).next().attr({"aria-hidden": "true"}).hide(), this.active.length ? this.active.attr({
                "aria-selected": "true",
                "aria-expanded": "true",
                tabIndex: 0
            }).next().attr({"aria-hidden": "false"}) : this.headers.eq(0).attr("tabIndex", 0), this._createIcons(), this._setupEvents(n.event), "fill" === r ? (t = i.height(), this.element.siblings(":visible").each(function () {
                var n = e(this), r = n.css("position");
                "absolute" !== r && "fixed" !== r && (t -= n.outerHeight(!0))
            }), this.headers.each(function () {
                t -= e(this).outerHeight(!0)
            }), this.headers.next().each(function () {
                e(this).height(Math.max(0, t - e(this).innerHeight() + e(this).height()))
            }).css("overflow", "auto")) : "auto" === r && (t = 0, this.headers.next().each(function () {
                t = Math.max(t, e(this).css("height", "").height())
            }).height(t))
        },
        _activate: function (t) {
            var n = this._findActive(t)[0];
            n !== this.active[0] && (n = n || this.active[0], this._eventHandler({
                target: n,
                currentTarget: n,
                preventDefault: e.noop
            }))
        },
        _findActive: function (t) {
            return "number" == typeof t ? this.headers.eq(t) : e()
        },
        _setupEvents: function (t) {
            var n = {keydown: "_keydown"};
            t && e.each(t.split(" "), function (e, t) {
                n[t] = "_eventHandler"
            }), this._off(this.headers.add(this.headers.next())), this._on(this.headers, n), this._on(this.headers.next(), {keydown: "_panelKeyDown"}), this._hoverable(this.headers), this._focusable(this.headers)
        },
        _eventHandler: function (t) {
            var n = this.options, r = this.active, i = e(t.currentTarget), s = i[0] === r[0], o = s && n.collapsible,
                u = o ? e() : i.next(), a = r.next(),
                f = {oldHeader: r, oldPanel: a, newHeader: o ? e() : i, newPanel: u};
            t.preventDefault(), s && !n.collapsible || this._trigger("beforeActivate", t, f) === !1 || (n.active = o ? !1 : this.headers.index(i), this.active = s ? e() : i, this._toggle(f), r.removeClass("ui-accordion-header-active ui-state-active"), n.icons && r.children(".ui-accordion-header-icon").removeClass(n.icons.activeHeader).addClass(n.icons.header), s || (i.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"), n.icons && i.children(".ui-accordion-header-icon").removeClass(n.icons.header).addClass(n.icons.activeHeader), i.next().addClass("ui-accordion-content-active")))
        },
        _toggle: function (t) {
            var n = t.newPanel, r = this.prevShow.length ? this.prevShow : t.oldPanel;
            this.prevShow.add(this.prevHide).stop(!0, !0), this.prevShow = n, this.prevHide = r, this.options.animate ? this._animate(n, r, t) : (r.hide(), n.show(), this._toggleComplete(t)), r.attr({"aria-hidden": "true"}), r.prev().attr({
                "aria-selected": "false",
                "aria-expanded": "false"
            }), n.length && r.length ? r.prev().attr({
                tabIndex: -1,
                "aria-expanded": "false"
            }) : n.length && this.headers.filter(function () {
                return 0 === parseInt(e(this).attr("tabIndex"), 10)
            }).attr("tabIndex", -1), n.attr("aria-hidden", "false").prev().attr({
                "aria-selected": "true",
                "aria-expanded": "true",
                tabIndex: 0
            })
        },
        _animate: function (e, t, n) {
            var r, i, s, o = this, u = 0, a = e.length && (!t.length || e.index() < t.index()),
                f = this.options.animate || {}, l = a && f.down || f, c = function () {
                    o._toggleComplete(n)
                };
            return "number" == typeof l && (s = l), "string" == typeof l && (i = l), i = i || l.easing || f.easing, s = s || l.duration || f.duration, t.length ? e.length ? (r = e.show().outerHeight(), t.animate(this.hideProps, {
                duration: s,
                easing: i,
                step: function (e, t) {
                    t.now = Math.round(e)
                }
            }), e.hide().animate(this.showProps, {
                duration: s, easing: i, complete: c, step: function (e, n) {
                    n.now = Math.round(e), "height" !== n.prop ? u += n.now : "content" !== o.options.heightStyle && (n.now = Math.round(r - t.outerHeight() - u), u = 0)
                }
            }), void 0) : t.animate(this.hideProps, s, i, c) : e.animate(this.showProps, s, i, c)
        },
        _toggleComplete: function (e) {
            var t = e.oldPanel;
            t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"), t.length && (t.parent()[0].className = t.parent()[0].className), this._trigger("activate", null, e)
        }
    }), e.widget("ui.menu", {
        version: "1.11.3",
        defaultElement: "<ul>",
        delay: 300,
        options: {
            icons: {submenu: "ui-icon-carat-1-e"},
            items: "> *",
            menus: "ul",
            position: {my: "left-1 top", at: "right top"},
            role: "menu",
            blur: null,
            focus: null,
            select: null
        },
        _create: function () {
            this.activeMenu = this.element, this.mouseHandled = !1, this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons", !!this.element.find(".ui-icon").length).attr({
                role: this.options.role,
                tabIndex: 0
            }), this.options.disabled && this.element.addClass("ui-state-disabled").attr("aria-disabled", "true"), this._on({
                "mousedown .ui-menu-item": function (e) {
                    e.preventDefault()
                }, "click .ui-menu-item": function (t) {
                    var n = e(t.target);
                    !this.mouseHandled && n.not(".ui-state-disabled").length && (this.select(t), t.isPropagationStopped() || (this.mouseHandled = !0), n.has(".ui-menu").length ? this.expand(t) : !this.element.is(":focus") && e(this.document[0].activeElement).closest(".ui-menu").length && (this.element.trigger("focus", [!0]), this.active && 1 === this.active.parents(".ui-menu").length && clearTimeout(this.timer)))
                }, "mouseenter .ui-menu-item": function (t) {
                    if (!this.previousFilter) {
                        var n = e(t.currentTarget);
                        n.siblings(".ui-state-active").removeClass("ui-state-active"), this.focus(t, n)
                    }
                }, mouseleave: "collapseAll", "mouseleave .ui-menu": "collapseAll", focus: function (e, t) {
                    var n = this.active || this.element.find(this.options.items).eq(0);
                    t || this.focus(e, n)
                }, blur: function (t) {
                    this._delay(function () {
                        e.contains(this.element[0], this.document[0].activeElement) || this.collapseAll(t)
                    })
                }, keydown: "_keydown"
            }), this.refresh(), this._on(this.document, {
                click: function (e) {
                    this._closeOnDocumentClick(e) && this.collapseAll(e), this.mouseHandled = !1
                }
            })
        },
        _destroy: function () {
            this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(), this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function () {
                var t = e(this);
                t.data("ui-menu-submenu-carat") && t.remove()
            }), this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")
        },
        _keydown: function (t) {
            var n, r, i, s, o = !0;
            switch (t.keyCode) {
                case e.ui.keyCode.PAGE_UP:
                    this.previousPage(t);
                    break;
                case e.ui.keyCode.PAGE_DOWN:
                    this.nextPage(t);
                    break;
                case e.ui.keyCode.HOME:
                    this._move("first", "first", t);
                    break;
                case e.ui.keyCode.END:
                    this._move("last", "last", t);
                    break;
                case e.ui.keyCode.UP:
                    this.previous(t);
                    break;
                case e.ui.keyCode.DOWN:
                    this.next(t);
                    break;
                case e.ui.keyCode.LEFT:
                    this.collapse(t);
                    break;
                case e.ui.keyCode.RIGHT:
                    this.active && !this.active.is(".ui-state-disabled") && this.expand(t);
                    break;
                case e.ui.keyCode.ENTER:
                case e.ui.keyCode.SPACE:
                    this._activate(t);
                    break;
                case e.ui.keyCode.ESCAPE:
                    this.collapse(t);
                    break;
                default:
                    o = !1, r = this.previousFilter || "", i = String.fromCharCode(t.keyCode), s = !1, clearTimeout(this.filterTimer), i === r ? s = !0 : i = r + i, n = this._filterMenuItems(i), n = s && -1 !== n.index(this.active.next()) ? this.active.nextAll(".ui-menu-item") : n, n.length || (i = String.fromCharCode(t.keyCode), n = this._filterMenuItems(i)), n.length ? (this.focus(t, n), this.previousFilter = i, this.filterTimer = this._delay(function () {
                        delete this.previousFilter
                    }, 1e3)) : delete this.previousFilter
            }
            o && t.preventDefault()
        },
        _activate: function (e) {
            this.active.is(".ui-state-disabled") || (this.active.is("[aria-haspopup='true']") ? this.expand(e) : this.select(e))
        },
        refresh: function () {
            var t, n, r = this, i = this.options.icons.submenu, s = this.element.find(this.options.menus);
            this.element.toggleClass("ui-menu-icons", !!this.element.find(".ui-icon").length), s.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({
                role: this.options.role,
                "aria-hidden": "true",
                "aria-expanded": "false"
            }).each(function () {
                var t = e(this), n = t.parent(),
                    r = e("<span>").addClass("ui-menu-icon ui-icon " + i).data("ui-menu-submenu-carat", !0);
                n.attr("aria-haspopup", "true").prepend(r), t.attr("aria-labelledby", n.attr("id"))
            }), t = s.add(this.element), n = t.find(this.options.items), n.not(".ui-menu-item").each(function () {
                var t = e(this);
                r._isDivider(t) && t.addClass("ui-widget-content ui-menu-divider")
            }), n.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({
                tabIndex: -1,
                role: this._itemRole()
            }), n.filter(".ui-state-disabled").attr("aria-disabled", "true"), this.active && !e.contains(this.element[0], this.active[0]) && this.blur()
        },
        _itemRole: function () {
            return {menu: "menuitem", listbox: "option"}[this.options.role]
        },
        _setOption: function (e, t) {
            "icons" === e && this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu), "disabled" === e && this.element.toggleClass("ui-state-disabled", !!t).attr("aria-disabled", t), this._super(e, t)
        },
        focus: function (e, t) {
            var n, r;
            this.blur(e, e && "focus" === e.type), this._scrollIntoView(t), this.active = t.first(), r = this.active.addClass("ui-state-focus").removeClass("ui-state-active"), this.options.role && this.element.attr("aria-activedescendant", r.attr("id")), this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"), e && "keydown" === e.type ? this._close() : this.timer = this._delay(function () {
                this._close()
            }, this.delay), n = t.children(".ui-menu"), n.length && e && /^mouse/.test(e.type) && this._startOpening(n), this.activeMenu = t.parent(), this._trigger("focus", e, {item: t})
        },
        _scrollIntoView: function (t) {
            var n, r, i, s, o, u;
            this._hasScroll() && (n = parseFloat(e.css(this.activeMenu[0], "borderTopWidth")) || 0, r = parseFloat(e.css(this.activeMenu[0], "paddingTop")) || 0, i = t.offset().top - this.activeMenu.offset().top - n - r, s = this.activeMenu.scrollTop(), o = this.activeMenu.height(), u = t.outerHeight(), 0 > i ? this.activeMenu.scrollTop(s + i) : i + u > o && this.activeMenu.scrollTop(s + i - o + u))
        },
        blur: function (e, t) {
            t || clearTimeout(this.timer), this.active && (this.active.removeClass("ui-state-focus"), this.active = null, this._trigger("blur", e, {item: this.active}))
        },
        _startOpening: function (e) {
            clearTimeout(this.timer), "true" === e.attr("aria-hidden") && (this.timer = this._delay(function () {
                this._close(), this._open(e)
            }, this.delay))
        },
        _open: function (t) {
            var n = e.extend({of: this.active}, this.options.position);
            clearTimeout(this.timer), this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden", "true"), t.show().removeAttr("aria-hidden").attr("aria-expanded", "true").position(n)
        },
        collapseAll: function (t, n) {
            clearTimeout(this.timer), this.timer = this._delay(function () {
                var r = n ? this.element : e(t && t.target).closest(this.element.find(".ui-menu"));
                r.length || (r = this.element), this._close(r), this.blur(t), this.activeMenu = r
            }, this.delay)
        },
        _close: function (e) {
            e || (e = this.active ? this.active.parent() : this.element), e.find(".ui-menu").hide().attr("aria-hidden", "true").attr("aria-expanded", "false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")
        },
        _closeOnDocumentClick: function (t) {
            return !e(t.target).closest(".ui-menu").length
        },
        _isDivider: function (e) {
            return !/[^\-\u2014\u2013\s]/.test(e.text())
        },
        collapse: function (e) {
            var t = this.active && this.active.parent().closest(".ui-menu-item", this.element);
            t && t.length && (this._close(), this.focus(e, t))
        },
        expand: function (e) {
            var t = this.active && this.active.children(".ui-menu ").find(this.options.items).first();
            t && t.length && (this._open(t.parent()), this._delay(function () {
                this.focus(e, t)
            }))
        },
        next: function (e) {
            this._move("next", "first", e)
        },
        previous: function (e) {
            this._move("prev", "last", e)
        },
        isFirstItem: function () {
            return this.active && !this.active.prevAll(".ui-menu-item").length
        },
        isLastItem: function () {
            return this.active && !this.active.nextAll(".ui-menu-item").length
        },
        _move: function (e, t, n) {
            var r;
            this.active && (r = "first" === e || "last" === e ? this.active["first" === e ? "prevAll" : "nextAll"](".ui-menu-item").eq(-1) : this.active[e + "All"](".ui-menu-item").eq(0)), r && r.length && this.active || (r = this.activeMenu.find(this.options.items)[t]()), this.focus(n, r)
        },
        nextPage: function (t) {
            var n, r, i;
            return this.active ? (this.isLastItem() || (this._hasScroll() ? (r = this.active.offset().top, i = this.element.height(), this.active.nextAll(".ui-menu-item").each(function () {
                return n = e(this), 0 > n.offset().top - r - i
            }), this.focus(t, n)) : this.focus(t, this.activeMenu.find(this.options.items)[this.active ? "last" : "first"]())), void 0) : (this.next(t), void 0)
        },
        previousPage: function (t) {
            var n, r, i;
            return this.active ? (this.isFirstItem() || (this._hasScroll() ? (r = this.active.offset().top, i = this.element.height(), this.active.prevAll(".ui-menu-item").each(function () {
                return n = e(this), n.offset().top - r + i > 0
            }), this.focus(t, n)) : this.focus(t, this.activeMenu.find(this.options.items).first())), void 0) : (this.next(t), void 0)
        },
        _hasScroll: function () {
            return this.element.outerHeight() < this.element.prop("scrollHeight")
        },
        select: function (t) {
            this.active = this.active || e(t.target).closest(".ui-menu-item");
            var n = {item: this.active};
            this.active.has(".ui-menu").length || this.collapseAll(t, !0), this._trigger("select", t, n)
        },
        _filterMenuItems: function (t) {
            var n = t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"), r = RegExp("^" + n, "i");
            return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function () {
                return r.test(e.trim(e(this).text()))
            })
        }
    }), e.widget("ui.autocomplete", {
        version: "1.11.3",
        defaultElement: "<input>",
        options: {
            appendTo: null,
            autoFocus: !1,
            delay: 300,
            minLength: 1,
            position: {my: "left top", at: "left bottom", collision: "none"},
            source: null,
            change: null,
            close: null,
            focus: null,
            open: null,
            response: null,
            search: null,
            select: null
        },
        requestIndex: 0,
        pending: 0,
        _create: function () {
            var t, n, r, i = this.element[0].nodeName.toLowerCase(), s = "textarea" === i, o = "input" === i;
            this.isMultiLine = s ? !0 : o ? !1 : this.element.prop("isContentEditable"), this.valueMethod = this.element[s || o ? "val" : "text"], this.isNewMenu = !0, this.element.addClass("ui-autocomplete-input").attr("autocomplete", "off"), this._on(this.element, {
                keydown: function (i) {
                    if (this.element.prop("readOnly")) return t = !0, r = !0, n = !0, void 0;
                    t = !1, r = !1, n = !1;
                    var s = e.ui.keyCode;
                    switch (i.keyCode) {
                        case s.PAGE_UP:
                            t = !0, this._move("previousPage", i);
                            break;
                        case s.PAGE_DOWN:
                            t = !0, this._move("nextPage", i);
                            break;
                        case s.UP:
                            t = !0, this._keyEvent("previous", i);
                            break;
                        case s.DOWN:
                            t = !0, this._keyEvent("next", i);
                            break;
                        case s.ENTER:
                            this.menu.active && (t = !0, i.preventDefault(), this.menu.select(i));
                            break;
                        case s.TAB:
                            this.menu.active && this.menu.select(i);
                            break;
                        case s.ESCAPE:
                            this.menu.element.is(":visible") && (this.isMultiLine || this._value(this.term), this.close(i), i.preventDefault());
                            break;
                        default:
                            n = !0, this._searchTimeout(i)
                    }
                }, keypress: function (r) {
                    if (t) return t = !1, (!this.isMultiLine || this.menu.element.is(":visible")) && r.preventDefault(), void 0;
                    if (!n) {
                        var i = e.ui.keyCode;
                        switch (r.keyCode) {
                            case i.PAGE_UP:
                                this._move("previousPage", r);
                                break;
                            case i.PAGE_DOWN:
                                this._move("nextPage", r);
                                break;
                            case i.UP:
                                this._keyEvent("previous", r);
                                break;
                            case i.DOWN:
                                this._keyEvent("next", r)
                        }
                    }
                }, input: function (e) {
                    return r ? (r = !1, e.preventDefault(), void 0) : (this._searchTimeout(e), void 0)
                }, focus: function () {
                    this.selectedItem = null, this.previous = this._value()
                }, blur: function (e) {
                    return this.cancelBlur ? (delete this.cancelBlur, void 0) : (clearTimeout(this.searching), this.close(e), this._change(e), void 0)
                }
            }), this._initSource(), this.menu = e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role: null}).hide().menu("instance"), this._on(this.menu.element, {
                mousedown: function (t) {
                    t.preventDefault(), this.cancelBlur = !0, this._delay(function () {
                        delete this.cancelBlur
                    });
                    var n = this.menu.element[0];
                    e(t.target).closest(".ui-menu-item").length || this._delay(function () {
                        var t = this;
                        this.document.one("mousedown", function (r) {
                            r.target === t.element[0] || r.target === n || e.contains(n, r.target) || t.close()
                        })
                    })
                }, menufocus: function (t, n) {
                    var r, i;
                    return this.isNewMenu && (this.isNewMenu = !1, t.originalEvent && /^mouse/.test(t.originalEvent.type)) ? (this.menu.blur(), this.document.one("mousemove", function () {
                        e(t.target).trigger(t.originalEvent)
                    }), void 0) : (i = n.item.data("ui-autocomplete-item"), !1 !== this._trigger("focus", t, {item: i}) && t.originalEvent && /^key/.test(t.originalEvent.type) && this._value(i.value), r = n.item.attr("aria-label") || i.value, r && e.trim(r).length && (this.liveRegion.children().hide(), e("<div>").text(r).appendTo(this.liveRegion)), void 0)
                }, menuselect: function (e, t) {
                    var n = t.item.data("ui-autocomplete-item"), r = this.previous;
                    this.element[0] !== this.document[0].activeElement && (this.element.focus(), this.previous = r, this._delay(function () {
                        this.previous = r, this.selectedItem = n
                    })), !1 !== this._trigger("select", e, {item: n}) && this._value(n.value), this.term = this._value(), this.close(e), this.selectedItem = n
                }
            }), this.liveRegion = e("<span>", {
                role: "status",
                "aria-live": "assertive",
                "aria-relevant": "additions"
            }).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body), this._on(this.window, {
                beforeunload: function () {
                    this.element.removeAttr("autocomplete")
                }
            })
        },
        _destroy: function () {
            clearTimeout(this.searching), this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"), this.menu.element.remove(), this.liveRegion.remove()
        },
        _setOption: function (e, t) {
            this._super(e, t), "source" === e && this._initSource(), "appendTo" === e && this.menu.element.appendTo(this._appendTo()), "disabled" === e && t && this.xhr && this.xhr.abort()
        },
        _appendTo: function () {
            var t = this.options.appendTo;
            return t && (t = t.jquery || t.nodeType ? e(t) : this.document.find(t).eq(0)), t && t[0] || (t = this.element.closest(".ui-front")), t.length || (t = this.document[0].body), t
        },
        _initSource: function () {
            var t, n, r = this;
            e.isArray(this.options.source) ? (t = this.options.source, this.source = function (n, r) {
                r(e.ui.autocomplete.filter(t, n.term))
            }) : "string" == typeof this.options.source ? (n = this.options.source, this.source = function (t, i) {
                r.xhr && r.xhr.abort(), r.xhr = e.ajax({
                    url: n, data: t, dataType: "json", success: function (e) {
                        i(e)
                    }, error: function () {
                        i([])
                    }
                })
            }) : this.source = this.options.source
        },
        _searchTimeout: function (e) {
            clearTimeout(this.searching), this.searching = this._delay(function () {
                var t = this.term === this._value(), n = this.menu.element.is(":visible"),
                    r = e.altKey || e.ctrlKey || e.metaKey || e.shiftKey;
                (!t || t && !n && !r) && (this.selectedItem = null, this.search(null, e))
            }, this.options.delay)
        },
        search: function (e, t) {
            return e = null != e ? e : this._value(), this.term = this._value(), e.length < this.options.minLength ? this.close(t) : this._trigger("search", t) !== !1 ? this._search(e) : void 0
        },
        _search: function (e) {
            this.pending++, this.element.addClass("ui-autocomplete-loading"), this.cancelSearch = !1, this.source({term: e}, this._response())
        },
        _response: function () {
            var t = ++this.requestIndex;
            return e.proxy(function (e) {
                t === this.requestIndex && this.__response(e), this.pending--, this.pending || this.element.removeClass("ui-autocomplete-loading")
            }, this)
        },
        __response: function (e) {
            e && (e = this._normalize(e)), this._trigger("response", null, {content: e}), !this.options.disabled && e && e.length && !this.cancelSearch ? (this._suggest(e), this._trigger("open")) : this._close()
        },
        close: function (e) {
            this.cancelSearch = !0, this._close(e)
        },
        _close: function (e) {
            this.menu.element.is(":visible") && (this.menu.element.hide(), this.menu.blur(), this.isNewMenu = !0, this._trigger("close", e))
        },
        _change: function (e) {
            this.previous !== this._value() && this._trigger("change", e, {item: this.selectedItem})
        },
        _normalize: function (t) {
            return t.length && t[0].label && t[0].value ? t : e.map(t, function (t) {
                return "string" == typeof t ? {label: t, value: t} : e.extend({}, t, {
                    label: t.label || t.value,
                    value: t.value || t.label
                })
            })
        },
        _suggest: function (t) {
            var n = this.menu.element.empty();
            this._renderMenu(n, t), this.isNewMenu = !0, this.menu.refresh(), n.show(), this._resizeMenu(), n.position(e.extend({of: this.element}, this.options.position)), this.options.autoFocus && this.menu.next()
        },
        _resizeMenu: function () {
            var e = this.menu.element;
            e.outerWidth(Math.max(e.width("").outerWidth() + 1, this.element.outerWidth()))
        },
        _renderMenu: function (t, n) {
            var r = this;
            e.each(n, function (e, n) {
                r._renderItemData(t, n)
            })
        },
        _renderItemData: function (e, t) {
            return this._renderItem(e, t).data("ui-autocomplete-item", t)
        },
        _renderItem: function (t, n) {
            return e("<li>").text(n.label).appendTo(t)
        },
        _move: function (e, t) {
            return this.menu.element.is(":visible") ? this.menu.isFirstItem() && /^previous/.test(e) || this.menu.isLastItem() && /^next/.test(e) ? (this.isMultiLine || this._value(this.term), this.menu.blur(), void 0) : (this.menu[e](t), void 0) : (this.search(null, t), void 0)
        },
        widget: function () {
            return this.menu.element
        },
        _value: function () {
            return this.valueMethod.apply(this.element, arguments)
        },
        _keyEvent: function (e, t) {
            (!this.isMultiLine || this.menu.element.is(":visible")) && (this._move(e, t), t.preventDefault())
        }
    }), e.extend(e.ui.autocomplete, {
        escapeRegex: function (e) {
            return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
        }, filter: function (t, n) {
            var r = RegExp(e.ui.autocomplete.escapeRegex(n), "i");
            return e.grep(t, function (e) {
                return r.test(e.label || e.value || e)
            })
        }
    }), e.widget("ui.autocomplete", e.ui.autocomplete, {
        options: {
            messages: {
                noResults: "No search results.",
                results: function (e) {
                    return e + (e > 1 ? " results are" : " result is") + " available, use up and down arrow keys to navigate."
                }
            }
        }, __response: function (t) {
            var n;
            this._superApply(arguments), this.options.disabled || this.cancelSearch || (n = t && t.length ? this.options.messages.results(t.length) : this.options.messages.noResults, this.liveRegion.children().hide(), e("<div>").text(n).appendTo(this.liveRegion))
        }
    }), e.ui.autocomplete;
    var h, p = "ui-button ui-widget ui-state-default ui-corner-all",
        d = "ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",
        v = function () {
            var t = e(this);
            setTimeout(function () {
                t.find(":ui-button").button("refresh")
            }, 1)
        }, m = function (t) {
            var n = t.name, r = t.form, i = e([]);
            return n && (n = n.replace(/'/g, "\\'"), i = r ? e(r).find("[name='" + n + "'][type=radio]") : e("[name='" + n + "'][type=radio]", t.ownerDocument).filter(function () {
                return !this.form
            })), i
        };
    e.widget("ui.button", {
        version: "1.11.3",
        defaultElement: "<button>",
        options: {disabled: null, text: !0, label: null, icons: {primary: null, secondary: null}},
        _create: function () {
            this.element.closest("form").unbind("reset" + this.eventNamespace).bind("reset" + this.eventNamespace, v), "boolean" != typeof this.options.disabled ? this.options.disabled = !!this.element.prop("disabled") : this.element.prop("disabled", this.options.disabled), this._determineButtonType(), this.hasTitle = !!this.buttonElement.attr("title");
            var t = this, n = this.options, r = "checkbox" === this.type || "radio" === this.type,
                i = r ? "" : "ui-state-active";
            null === n.label && (n.label = "input" === this.type ? this.buttonElement.val() : this.buttonElement.html()), this._hoverable(this.buttonElement), this.buttonElement.addClass(p).attr("role", "button").bind("mouseenter" + this.eventNamespace, function () {
                n.disabled || this === h && e(this).addClass("ui-state-active")
            }).bind("mouseleave" + this.eventNamespace, function () {
                n.disabled || e(this).removeClass(i)
            }).bind("click" + this.eventNamespace, function (e) {
                n.disabled && (e.preventDefault(), e.stopImmediatePropagation())
            }), this._on({
                focus: function () {
                    this.buttonElement.addClass("ui-state-focus")
                }, blur: function () {
                    this.buttonElement.removeClass("ui-state-focus")
                }
            }), r && this.element.bind("change" + this.eventNamespace, function () {
                t.refresh()
            }), "checkbox" === this.type ? this.buttonElement.bind("click" + this.eventNamespace, function () {
                return n.disabled ? !1 : void 0
            }) : "radio" === this.type ? this.buttonElement.bind("click" + this.eventNamespace, function () {
                if (n.disabled) return !1;
                e(this).addClass("ui-state-active"), t.buttonElement.attr("aria-pressed", "true");
                var r = t.element[0];
                m(r).not(r).map(function () {
                    return e(this).button("widget")[0]
                }).removeClass("ui-state-active").attr("aria-pressed", "false")
            }) : (this.buttonElement.bind("mousedown" + this.eventNamespace, function () {
                return n.disabled ? !1 : (e(this).addClass("ui-state-active"), h = this, t.document.one("mouseup", function () {
                    h = null
                }), void 0)
            }).bind("mouseup" + this.eventNamespace, function () {
                return n.disabled ? !1 : (e(this).removeClass("ui-state-active"), void 0)
            }).bind("keydown" + this.eventNamespace, function (t) {
                return n.disabled ? !1 : ((t.keyCode === e.ui.keyCode.SPACE || t.keyCode === e.ui.keyCode.ENTER) && e(this).addClass("ui-state-active"), void 0)
            }).bind("keyup" + this.eventNamespace + " blur" + this.eventNamespace, function () {
                e(this).removeClass("ui-state-active")
            }), this.buttonElement.is("a") && this.buttonElement.keyup(function (t) {
                t.keyCode === e.ui.keyCode.SPACE && e(this).click()
            })), this._setOption("disabled", n.disabled), this._resetButton()
        },
        _determineButtonType: function () {
            var e, t, n;
            this.type = this.element.is("[type=checkbox]") ? "checkbox" : this.element.is("[type=radio]") ? "radio" : this.element.is("input") ? "input" : "button", "checkbox" === this.type || "radio" === this.type ? (e = this.element.parents().last(), t = "label[for='" + this.element.attr("id") + "']", this.buttonElement = e.find(t), this.buttonElement.length || (e = e.length ? e.siblings() : this.element.siblings(), this.buttonElement = e.filter(t), this.buttonElement.length || (this.buttonElement = e.find(t))), this.element.addClass("ui-helper-hidden-accessible"), n = this.element.is(":checked"), n && this.buttonElement.addClass("ui-state-active"), this.buttonElement.prop("aria-pressed", n)) : this.buttonElement = this.element
        },
        widget: function () {
            return this.buttonElement
        },
        _destroy: function () {
            this.element.removeClass("ui-helper-hidden-accessible"), this.buttonElement.removeClass(p + " ui-state-active " + d).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()), this.hasTitle || this.buttonElement.removeAttr("title")
        },
        _setOption: function (e, t) {
            return this._super(e, t), "disabled" === e ? (this.widget().toggleClass("ui-state-disabled", !!t), this.element.prop("disabled", !!t), t && ("checkbox" === this.type || "radio" === this.type ? this.buttonElement.removeClass("ui-state-focus") : this.buttonElement.removeClass("ui-state-focus ui-state-active")), void 0) : (this._resetButton(), void 0)
        },
        refresh: function () {
            var t = this.element.is("input, button") ? this.element.is(":disabled") : this.element.hasClass("ui-button-disabled");
            t !== this.options.disabled && this._setOption("disabled", t), "radio" === this.type ? m(this.element[0]).each(function () {
                e(this).is(":checked") ? e(this).button("widget").addClass("ui-state-active").attr("aria-pressed", "true") : e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed", "false")
            }) : "checkbox" === this.type && (this.element.is(":checked") ? this.buttonElement.addClass("ui-state-active").attr("aria-pressed", "true") : this.buttonElement.removeClass("ui-state-active").attr("aria-pressed", "false"))
        },
        _resetButton: function () {
            if ("input" === this.type) return this.options.label && this.element.val(this.options.label), void 0;
            var t = this.buttonElement.removeClass(d),
                n = e("<span></span>", this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),
                r = this.options.icons, i = r.primary && r.secondary, s = [];
            r.primary || r.secondary ? (this.options.text && s.push("ui-button-text-icon" + (i ? "s" : r.primary ? "-primary" : "-secondary")), r.primary && t.prepend("<span class='ui-button-icon-primary ui-icon " + r.primary + "'></span>"), r.secondary && t.append("<span class='ui-button-icon-secondary ui-icon " + r.secondary + "'></span>"), this.options.text || (s.push(i ? "ui-button-icons-only" : "ui-button-icon-only"), this.hasTitle || t.attr("title", e.trim(n)))) : s.push("ui-button-text-only"), t.addClass(s.join(" "))
        }
    }), e.widget("ui.buttonset", {
        version: "1.11.3",
        options: {items: "button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},
        _create: function () {
            this.element.addClass("ui-buttonset")
        },
        _init: function () {
            this.refresh()
        },
        _setOption: function (e, t) {
            "disabled" === e && this.buttons.button("option", e, t), this._super(e, t)
        },
        refresh: function () {
            var t = "rtl" === this.element.css("direction"), n = this.element.find(this.options.items),
                r = n.filter(":ui-button");
            n.not(":ui-button").button(), r.button("refresh"), this.buttons = n.map(function () {
                return e(this).button("widget")[0]
            }).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t ? "ui-corner-right" : "ui-corner-left").end().filter(":last").addClass(t ? "ui-corner-left" : "ui-corner-right").end().end()
        },
        _destroy: function () {
            this.element.removeClass("ui-buttonset"), this.buttons.map(function () {
                return e(this).button("widget")[0]
            }).removeClass("ui-corner-left ui-corner-right").end().button("destroy")
        }
    }), e.ui.button, e.extend(e.ui, {datepicker: {version: "1.11.3"}});
    var g;
    e.extend(i.prototype, {
        markerClassName: "hasDatepicker",
        maxRows: 4,
        _widgetDatepicker: function () {
            return this.dpDiv
        },
        setDefaults: function (e) {
            return u(this._defaults, e || {}), this
        },
        _attachDatepicker: function (t, n) {
            var r, i, s;
            r = t.nodeName.toLowerCase(), i = "div" === r || "span" === r, t.id || (this.uuid += 1, t.id = "dp" + this.uuid), s = this._newInst(e(t), i), s.settings = e.extend({}, n || {}), "input" === r ? this._connectDatepicker(t, s) : i && this._inlineDatepicker(t, s)
        },
        _newInst: function (t, n) {
            var r = t[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1");
            return {
                id: r,
                input: t,
                selectedDay: 0,
                selectedMonth: 0,
                selectedYear: 0,
                drawMonth: 0,
                drawYear: 0,
                inline: n,
                dpDiv: n ? s(e("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")) : this.dpDiv
            }
        },
        _connectDatepicker: function (t, n) {
            var r = e(t);
            n.append = e([]), n.trigger = e([]), r.hasClass(this.markerClassName) || (this._attachments(r, n), r.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp), this._autoSize(n), e.data(t, "datepicker", n), n.settings.disabled && this._disableDatepicker(t))
        },
        _attachments: function (t, n) {
            var r, i, s, o = this._get(n, "appendText"), u = this._get(n, "isRTL");
            n.append && n.append.remove(), o && (n.append = e("<span class='" + this._appendClass + "'>" + o + "</span>"), t[u ? "before" : "after"](n.append)), t.unbind("focus", this._showDatepicker), n.trigger && n.trigger.remove(), r = this._get(n, "showOn"), ("focus" === r || "both" === r) && t.focus(this._showDatepicker), ("button" === r || "both" === r) && (i = this._get(n, "buttonText"), s = this._get(n, "buttonImage"), n.trigger = e(this._get(n, "buttonImageOnly") ? e("<img/>").addClass(this._triggerClass).attr({
                src: s,
                alt: i,
                title: i
            }) : e("<button type='button'></button>").addClass(this._triggerClass).html(s ? e("<img/>").attr({
                src: s,
                alt: i,
                title: i
            }) : i)), t[u ? "before" : "after"](n.trigger), n.trigger.click(function () {
                return e.datepicker._datepickerShowing && e.datepicker._lastInput === t[0] ? e.datepicker._hideDatepicker() : e.datepicker._datepickerShowing && e.datepicker._lastInput !== t[0] ? (e.datepicker._hideDatepicker(), e.datepicker._showDatepicker(t[0])) : e.datepicker._showDatepicker(t[0]), !1
            }))
        },
        _autoSize: function (e) {
            if (this._get(e, "autoSize") && !e.inline) {
                var t, n, r, i, s = new Date(2009, 11, 20), o = this._get(e, "dateFormat");
                o.match(/[DM]/) && (t = function (e) {
                    for (n = 0, r = 0, i = 0; e.length > i; i++) e[i].length > n && (n = e[i].length, r = i);
                    return r
                }, s.setMonth(t(this._get(e, o.match(/MM/) ? "monthNames" : "monthNamesShort"))), s.setDate(t(this._get(e, o.match(/DD/) ? "dayNames" : "dayNamesShort")) + 20 - s.getDay())), e.input.attr("size", this._formatDate(e, s).length)
            }
        },
        _inlineDatepicker: function (t, n) {
            var r = e(t);
            r.hasClass(this.markerClassName) || (r.addClass(this.markerClassName).append(n.dpDiv), e.data(t, "datepicker", n), this._setDate(n, this._getDefaultDate(n), !0), this._updateDatepicker(n), this._updateAlternate(n), n.settings.disabled && this._disableDatepicker(t), n.dpDiv.css("display", "block"))
        },
        _dialogDatepicker: function (t, n, r, i, s) {
            var o, a, f, l, c, h = this._dialogInst;
            return h || (this.uuid += 1, o = "dp" + this.uuid, this._dialogInput = e("<input type='text' id='" + o + "' style='position: absolute; top: -100px; width: 0px;'/>"), this._dialogInput.keydown(this._doKeyDown), e("body").append(this._dialogInput), h = this._dialogInst = this._newInst(this._dialogInput, !1), h.settings = {}, e.data(this._dialogInput[0], "datepicker", h)), u(h.settings, i || {}), n = n && n.constructor === Date ? this._formatDate(h, n) : n, this._dialogInput.val(n), this._pos = s ? s.length ? s : [s.pageX, s.pageY] : null, this._pos || (a = document.documentElement.clientWidth, f = document.documentElement.clientHeight, l = document.documentElement.scrollLeft || document.body.scrollLeft, c = document.documentElement.scrollTop || document.body.scrollTop, this._pos = [a / 2 - 100 + l, f / 2 - 150 + c]), this._dialogInput.css("left", this._pos[0] + 20 + "px").css("top", this._pos[1] + "px"), h.settings.onSelect = r, this._inDialog = !0, this.dpDiv.addClass(this._dialogClass), this._showDatepicker(this._dialogInput[0]), e.blockUI && e.blockUI(this.dpDiv), e.data(this._dialogInput[0], "datepicker", h), this
        },
        _destroyDatepicker: function (t) {
            var n, r = e(t), i = e.data(t, "datepicker");
            r.hasClass(this.markerClassName) && (n = t.nodeName.toLowerCase(), e.removeData(t, "datepicker"), "input" === n ? (i.append.remove(), i.trigger.remove(), r.removeClass(this.markerClassName).unbind("focus", this._showDatepicker).unbind("keydown", this._doKeyDown).unbind("keypress", this._doKeyPress).unbind("keyup", this._doKeyUp)) : ("div" === n || "span" === n) && r.removeClass(this.markerClassName).empty(), g === i && (g = null))
        },
        _enableDatepicker: function (t) {
            var n, r, i = e(t), s = e.data(t, "datepicker");
            i.hasClass(this.markerClassName) && (n = t.nodeName.toLowerCase(), "input" === n ? (t.disabled = !1, s.trigger.filter("button").each(function () {
                this.disabled = !1
            }).end().filter("img").css({
                opacity: "1.0",
                cursor: ""
            })) : ("div" === n || "span" === n) && (r = i.children("." + this._inlineClass), r.children().removeClass("ui-state-disabled"), r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !1)), this._disabledInputs = e.map(this._disabledInputs, function (e) {
                return e === t ? null : e
            }))
        },
        _disableDatepicker: function (t) {
            var n, r, i = e(t), s = e.data(t, "datepicker");
            i.hasClass(this.markerClassName) && (n = t.nodeName.toLowerCase(), "input" === n ? (t.disabled = !0, s.trigger.filter("button").each(function () {
                this.disabled = !0
            }).end().filter("img").css({
                opacity: "0.5",
                cursor: "default"
            })) : ("div" === n || "span" === n) && (r = i.children("." + this._inlineClass), r.children().addClass("ui-state-disabled"), r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !0)), this._disabledInputs = e.map(this._disabledInputs, function (e) {
                return e === t ? null : e
            }), this._disabledInputs[this._disabledInputs.length] = t)
        },
        _isDisabledDatepicker: function (e) {
            if (!e) return !1;
            for (var t = 0; this._disabledInputs.length > t; t++) if (this._disabledInputs[t] === e) return !0;
            return !1
        },
        _getInst: function (t) {
            try {
                return e.data(t, "datepicker")
            } catch (n) {
                throw"Missing instance data for this datepicker"
            }
        },
        _optionDatepicker: function (t, n, r) {
            var i, s, o, a, f = this._getInst(t);
            return 2 === arguments.length && "string" == typeof n ? "defaults" === n ? e.extend({}, e.datepicker._defaults) : f ? "all" === n ? e.extend({}, f.settings) : this._get(f, n) : null : (i = n || {}, "string" == typeof n && (i = {}, i[n] = r), f && (this._curInst === f && this._hideDatepicker(), s = this._getDateDatepicker(t, !0), o = this._getMinMaxDate(f, "min"), a = this._getMinMaxDate(f, "max"), u(f.settings, i), null !== o && void 0 !== i.dateFormat && void 0 === i.minDate && (f.settings.minDate = this._formatDate(f, o)), null !== a && void 0 !== i.dateFormat && void 0 === i.maxDate && (f.settings.maxDate = this._formatDate(f, a)), "disabled" in i && (i.disabled ? this._disableDatepicker(t) : this._enableDatepicker(t)), this._attachments(e(t), f), this._autoSize(f), this._setDate(f, s), this._updateAlternate(f), this._updateDatepicker(f)), void 0)
        },
        _changeDatepicker: function (e, t, n) {
            this._optionDatepicker(e, t, n)
        },
        _refreshDatepicker: function (e) {
            var t = this._getInst(e);
            t && this._updateDatepicker(t)
        },
        _setDateDatepicker: function (e, t) {
            var n = this._getInst(e);
            n && (this._setDate(n, t), this._updateDatepicker(n), this._updateAlternate(n))
        },
        _getDateDatepicker: function (e, t) {
            var n = this._getInst(e);
            return n && !n.inline && this._setDateFromField(n, t), n ? this._getDate(n) : null
        },
        _doKeyDown: function (t) {
            var n, r, i, s = e.datepicker._getInst(t.target), o = !0, u = s.dpDiv.is(".ui-datepicker-rtl");
            if (s._keyEvent = !0, e.datepicker._datepickerShowing) switch (t.keyCode) {
                case 9:
                    e.datepicker._hideDatepicker(), o = !1;
                    break;
                case 13:
                    return i = e("td." + e.datepicker._dayOverClass + ":not(." + e.datepicker._currentClass + ")", s.dpDiv), i[0] && e.datepicker._selectDay(t.target, s.selectedMonth, s.selectedYear, i[0]), n = e.datepicker._get(s, "onSelect"), n ? (r = e.datepicker._formatDate(s), n.apply(s.input ? s.input[0] : null, [r, s])) : e.datepicker._hideDatepicker(), !1;
                case 27:
                    e.datepicker._hideDatepicker();
                    break;
                case 33:
                    e.datepicker._adjustDate(t.target, t.ctrlKey ? -e.datepicker._get(s, "stepBigMonths") : -e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 34:
                    e.datepicker._adjustDate(t.target, t.ctrlKey ? +e.datepicker._get(s, "stepBigMonths") : +e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 35:
                    (t.ctrlKey || t.metaKey) && e.datepicker._clearDate(t.target), o = t.ctrlKey || t.metaKey;
                    break;
                case 36:
                    (t.ctrlKey || t.metaKey) && e.datepicker._gotoToday(t.target), o = t.ctrlKey || t.metaKey;
                    break;
                case 37:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, u ? 1 : -1, "D"), o = t.ctrlKey || t.metaKey, t.originalEvent.altKey && e.datepicker._adjustDate(t.target, t.ctrlKey ? -e.datepicker._get(s, "stepBigMonths") : -e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 38:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, -7, "D"), o = t.ctrlKey || t.metaKey;
                    break;
                case 39:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, u ? -1 : 1, "D"), o = t.ctrlKey || t.metaKey, t.originalEvent.altKey && e.datepicker._adjustDate(t.target, t.ctrlKey ? +e.datepicker._get(s, "stepBigMonths") : +e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 40:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, 7, "D"), o = t.ctrlKey || t.metaKey;
                    break;
                default:
                    o = !1
            } else 36 === t.keyCode && t.ctrlKey ? e.datepicker._showDatepicker(this) : o = !1;
            o && (t.preventDefault(), t.stopPropagation())
        },
        _doKeyPress: function (t) {
            var n, r, i = e.datepicker._getInst(t.target);
            return e.datepicker._get(i, "constrainInput") ? (n = e.datepicker._possibleChars(e.datepicker._get(i, "dateFormat")), r = String.fromCharCode(null == t.charCode ? t.keyCode : t.charCode), t.ctrlKey || t.metaKey || " " > r || !n || n.indexOf(r) > -1) : void 0
        },
        _doKeyUp: function (t) {
            var n, r = e.datepicker._getInst(t.target);
            if (r.input.val() !== r.lastVal) try {
                n = e.datepicker.parseDate(e.datepicker._get(r, "dateFormat"), r.input ? r.input.val() : null, e.datepicker._getFormatConfig(r)), n && (e.datepicker._setDateFromField(r), e.datepicker._updateAlternate(r), e.datepicker._updateDatepicker(r))
            } catch (i) {
            }
            return !0
        },
        _showDatepicker: function (t) {
            if (t = t.target || t, "input" !== t.nodeName.toLowerCase() && (t = e("input", t.parentNode)[0]), !e.datepicker._isDisabledDatepicker(t) && e.datepicker._lastInput !== t) {
                var n, i, s, o, a, f, l;
                n = e.datepicker._getInst(t), e.datepicker._curInst && e.datepicker._curInst !== n && (e.datepicker._curInst.dpDiv.stop(!0, !0), n && e.datepicker._datepickerShowing && e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])), i = e.datepicker._get(n, "beforeShow"), s = i ? i.apply(t, [t, n]) : {}, s !== !1 && (u(n.settings, s), n.lastVal = null, e.datepicker._lastInput = t, e.datepicker._setDateFromField(n), e.datepicker._inDialog && (t.value = ""), e.datepicker._pos || (e.datepicker._pos = e.datepicker._findPos(t), e.datepicker._pos[1] += t.offsetHeight), o = !1, e(t).parents().each(function () {
                    return o |= "fixed" === e(this).css("position"), !o
                }), a = {
                    left: e.datepicker._pos[0],
                    top: e.datepicker._pos[1]
                }, e.datepicker._pos = null, n.dpDiv.empty(), n.dpDiv.css({
                    position: "absolute",
                    display: "block",
                    top: "-1000px"
                }), e.datepicker._updateDatepicker(n), a = e.datepicker._checkOffset(n, a, o), n.dpDiv.css({
                    position: e.datepicker._inDialog && e.blockUI ? "static" : o ? "fixed" : "absolute",
                    display: "none",
                    left: a.left + "px",
                    top: a.top + "px"
                }), n.inline || (f = e.datepicker._get(n, "showAnim"), l = e.datepicker._get(n, "duration"), n.dpDiv.css("z-index", r(e(t)) + 1), e.datepicker._datepickerShowing = !0, e.effects && e.effects.effect[f] ? n.dpDiv.show(f, e.datepicker._get(n, "showOptions"), l) : n.dpDiv[f || "show"](f ? l : null), e.datepicker._shouldFocusInput(n) && n.input.focus(), e.datepicker._curInst = n))
            }
        },
        _updateDatepicker: function (t) {
            this.maxRows = 4, g = t, t.dpDiv.empty().append(this._generateHTML(t)), this._attachHandlers(t);
            var n, r = this._getNumberOfMonths(t), i = r[1], s = 17, u = t.dpDiv.find("." + this._dayOverClass + " a");
            u.length > 0 && o.apply(u.get(0)), t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""), i > 1 && t.dpDiv.addClass("ui-datepicker-multi-" + i).css("width", s * i + "em"), t.dpDiv[(1 !== r[0] || 1 !== r[1] ? "add" : "remove") + "Class"]("ui-datepicker-multi"), t.dpDiv[(this._get(t, "isRTL") ? "add" : "remove") + "Class"]("ui-datepicker-rtl"), t === e.datepicker._curInst && e.datepicker._datepickerShowing && e.datepicker._shouldFocusInput(t) && t.input.focus(), t.yearshtml && (n = t.yearshtml, setTimeout(function () {
                n === t.yearshtml && t.yearshtml && t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml), n = t.yearshtml = null
            }, 0))
        },
        _shouldFocusInput: function (e) {
            return e.input && e.input.is(":visible") && !e.input.is(":disabled") && !e.input.is(":focus")
        },
        _checkOffset: function (t, n, r) {
            var i = t.dpDiv.outerWidth(), s = t.dpDiv.outerHeight(), o = t.input ? t.input.outerWidth() : 0,
                u = t.input ? t.input.outerHeight() : 0,
                a = document.documentElement.clientWidth + (r ? 0 : e(document).scrollLeft()),
                f = document.documentElement.clientHeight + (r ? 0 : e(document).scrollTop());
            return n.left -= this._get(t, "isRTL") ? i - o : 0, n.left -= r && n.left === t.input.offset().left ? e(document).scrollLeft() : 0, n.top -= r && n.top === t.input.offset().top + u ? e(document).scrollTop() : 0, n.left -= Math.min(n.left, n.left + i > a && a > i ? Math.abs(n.left + i - a) : 0), n.top -= Math.min(n.top, n.top + s > f && f > s ? Math.abs(s + u) : 0), n
        },
        _findPos: function (t) {
            for (var n, r = this._getInst(t), i = this._get(r, "isRTL"); t && ("hidden" === t.type || 1 !== t.nodeType || e.expr.filters.hidden(t));) t = t[i ? "previousSibling" : "nextSibling"];
            return n = e(t).offset(), [n.left, n.top]
        },
        _hideDatepicker: function (t) {
            var n, r, i, s, o = this._curInst;
            !o || t && o !== e.data(t, "datepicker") || this._datepickerShowing && (n = this._get(o, "showAnim"), r = this._get(o, "duration"), i = function () {
                e.datepicker._tidyDialog(o)
            }, e.effects && (e.effects.effect[n] || e.effects[n]) ? o.dpDiv.hide(n, e.datepicker._get(o, "showOptions"), r, i) : o.dpDiv["slideDown" === n ? "slideUp" : "fadeIn" === n ? "fadeOut" : "hide"](n ? r : null, i), n || i(), this._datepickerShowing = !1, s = this._get(o, "onClose"), s && s.apply(o.input ? o.input[0] : null, [o.input ? o.input.val() : "", o]), this._lastInput = null, this._inDialog && (this._dialogInput.css({
                position: "absolute",
                left: "0",
                top: "-100px"
            }), e.blockUI && (e.unblockUI(), e("body").append(this.dpDiv))), this._inDialog = !1)
        },
        _tidyDialog: function (e) {
            e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")
        },
        _checkExternalClick: function (t) {
            if (e.datepicker._curInst) {
                var n = e(t.target), r = e.datepicker._getInst(n[0]);
                (n[0].id !== e.datepicker._mainDivId && 0 === n.parents("#" + e.datepicker._mainDivId).length && !n.hasClass(e.datepicker.markerClassName) && !n.closest("." + e.datepicker._triggerClass).length && e.datepicker._datepickerShowing && (!e.datepicker._inDialog || !e.blockUI) || n.hasClass(e.datepicker.markerClassName) && e.datepicker._curInst !== r) && e.datepicker._hideDatepicker()
            }
        },
        _adjustDate: function (t, n, r) {
            var i = e(t), s = this._getInst(i[0]);
            this._isDisabledDatepicker(i[0]) || (this._adjustInstDate(s, n + ("M" === r ? this._get(s, "showCurrentAtPos") : 0), r), this._updateDatepicker(s))
        },
        _gotoToday: function (t) {
            var n, r = e(t), i = this._getInst(r[0]);
            this._get(i, "gotoCurrent") && i.currentDay ? (i.selectedDay = i.currentDay, i.drawMonth = i.selectedMonth = i.currentMonth, i.drawYear = i.selectedYear = i.currentYear) : (n = new Date, i.selectedDay = n.getDate(), i.drawMonth = i.selectedMonth = n.getMonth(), i.drawYear = i.selectedYear = n.getFullYear()), this._notifyChange(i), this._adjustDate(r)
        },
        _selectMonthYear: function (t, n, r) {
            var i = e(t), s = this._getInst(i[0]);
            s["selected" + ("M" === r ? "Month" : "Year")] = s["draw" + ("M" === r ? "Month" : "Year")] = parseInt(n.options[n.selectedIndex].value, 10), this._notifyChange(s), this._adjustDate(i)
        },
        _selectDay: function (t, n, r, i) {
            var s, o = e(t);
            e(i).hasClass(this._unselectableClass) || this._isDisabledDatepicker(o[0]) || (s = this._getInst(o[0]), s.selectedDay = s.currentDay = e("a", i).html(), s.selectedMonth = s.currentMonth = n, s.selectedYear = s.currentYear = r, this._selectDate(t, this._formatDate(s, s.currentDay, s.currentMonth, s.currentYear)))
        },
        _clearDate: function (t) {
            var n = e(t);
            this._selectDate(n, "")
        },
        _selectDate: function (t, n) {
            var r, i = e(t), s = this._getInst(i[0]);
            n = null != n ? n : this._formatDate(s), s.input && s.input.val(n), this._updateAlternate(s), r = this._get(s, "onSelect"), r ? r.apply(s.input ? s.input[0] : null, [n, s]) : s.input && s.input.trigger("change"), s.inline ? this._updateDatepicker(s) : (this._hideDatepicker(), this._lastInput = s.input[0], "object" != typeof s.input[0] && s.input.focus(), this._lastInput = null)
        },
        _updateAlternate: function (t) {
            var n, r, i, s = this._get(t, "altField");
            s && (n = this._get(t, "altFormat") || this._get(t, "dateFormat"), r = this._getDate(t), i = this.formatDate(n, r, this._getFormatConfig(t)), e(s).each(function () {
                e(this).val(i)
            }))
        },
        noWeekends: function (e) {
            var t = e.getDay();
            return [t > 0 && 6 > t, ""]
        },
        iso8601Week: function (e) {
            var t, n = new Date(e.getTime());
            return n.setDate(n.getDate() + 4 - (n.getDay() || 7)), t = n.getTime(), n.setMonth(0), n.setDate(1), Math.floor(Math.round((t - n) / 864e5) / 7) + 1
        },
        parseDate: function (t, n, r) {
            if (null == t || null == n) throw"Invalid arguments";
            if (n = "object" == typeof n ? "" + n : n + "", "" === n) return null;
            var i, s, o, u, a = 0, f = (r ? r.shortYearCutoff : null) || this._defaults.shortYearCutoff,
                l = "string" != typeof f ? f : (new Date).getFullYear() % 100 + parseInt(f, 10),
                c = (r ? r.dayNamesShort : null) || this._defaults.dayNamesShort,
                h = (r ? r.dayNames : null) || this._defaults.dayNames,
                p = (r ? r.monthNamesShort : null) || this._defaults.monthNamesShort,
                d = (r ? r.monthNames : null) || this._defaults.monthNames, v = -1, m = -1, g = -1, y = -1, b = !1,
                w = function (e) {
                    var n = t.length > i + 1 && t.charAt(i + 1) === e;
                    return n && i++, n
                }, E = function (e) {
                    var t = w(e), r = "@" === e ? 14 : "!" === e ? 20 : "y" === e && t ? 4 : "o" === e ? 3 : 2,
                        i = "y" === e ? r : 1, s = RegExp("^\\d{" + i + "," + r + "}"), o = n.substring(a).match(s);
                    if (!o) throw"Missing number at position " + a;
                    return a += o[0].length, parseInt(o[0], 10)
                }, S = function (t, r, i) {
                    var s = -1, o = e.map(w(t) ? i : r, function (e, t) {
                        return [[t, e]]
                    }).sort(function (e, t) {
                        return -(e[1].length - t[1].length)
                    });
                    if (e.each(o, function (e, t) {
                        var r = t[1];
                        return n.substr(a, r.length).toLowerCase() === r.toLowerCase() ? (s = t[0], a += r.length, !1) : void 0
                    }), -1 !== s) return s + 1;
                    throw"Unknown name at position " + a
                }, x = function () {
                    if (n.charAt(a) !== t.charAt(i)) throw"Unexpected literal at position " + a;
                    a++
                };
            for (i = 0; t.length > i; i++) if (b) "'" !== t.charAt(i) || w("'") ? x() : b = !1; else switch (t.charAt(i)) {
                case"d":
                    g = E("d");
                    break;
                case"D":
                    S("D", c, h);
                    break;
                case"o":
                    y = E("o");
                    break;
                case"m":
                    m = E("m");
                    break;
                case"M":
                    m = S("M", p, d);
                    break;
                case"y":
                    v = E("y");
                    break;
                case"@":
                    u = new Date(E("@")), v = u.getFullYear(), m = u.getMonth() + 1, g = u.getDate();
                    break;
                case"!":
                    u = new Date((E("!") - this._ticksTo1970) / 1e4), v = u.getFullYear(), m = u.getMonth() + 1, g = u.getDate();
                    break;
                case"'":
                    w("'") ? x() : b = !0;
                    break;
                default:
                    x()
            }
            if (n.length > a && (o = n.substr(a), !/^\s+/.test(o))) throw"Extra/unparsed characters found in date: " + o;
            if (-1 === v ? v = (new Date).getFullYear() : 100 > v && (v += (new Date).getFullYear() - (new Date).getFullYear() % 100 + (l >= v ? 0 : -100)), y > -1) for (m = 1, g = y; ;) {
                if (s = this._getDaysInMonth(v, m - 1), s >= g) break;
                m++, g -= s
            }
            if (u = this._daylightSavingAdjust(new Date(v, m - 1, g)), u.getFullYear() !== v || u.getMonth() + 1 !== m || u.getDate() !== g) throw"Invalid date";
            return u
        },
        ATOM: "yy-mm-dd",
        COOKIE: "D, dd M yy",
        ISO_8601: "yy-mm-dd",
        RFC_822: "D, d M y",
        RFC_850: "DD, dd-M-y",
        RFC_1036: "D, d M y",
        RFC_1123: "D, d M yy",
        RFC_2822: "D, d M yy",
        RSS: "D, d M y",
        TICKS: "!",
        TIMESTAMP: "@",
        W3C: "yy-mm-dd",
        _ticksTo1970: 864e9 * (718685 + Math.floor(492.5) - Math.floor(19.7) + Math.floor(4.925)),
        formatDate: function (e, t, n) {
            if (!t) return "";
            var r, i = (n ? n.dayNamesShort : null) || this._defaults.dayNamesShort,
                s = (n ? n.dayNames : null) || this._defaults.dayNames,
                o = (n ? n.monthNamesShort : null) || this._defaults.monthNamesShort,
                u = (n ? n.monthNames : null) || this._defaults.monthNames, a = function (t) {
                    var n = e.length > r + 1 && e.charAt(r + 1) === t;
                    return n && r++, n
                }, f = function (e, t, n) {
                    var r = "" + t;
                    if (a(e)) for (; n > r.length;) r = "0" + r;
                    return r
                }, l = function (e, t, n, r) {
                    return a(e) ? r[t] : n[t]
                }, c = "", h = !1;
            if (t) for (r = 0; e.length > r; r++) if (h) "'" !== e.charAt(r) || a("'") ? c += e.charAt(r) : h = !1; else switch (e.charAt(r)) {
                case"d":
                    c += f("d", t.getDate(), 2);
                    break;
                case"D":
                    c += l("D", t.getDay(), i, s);
                    break;
                case"o":
                    c += f("o", Math.round(((new Date(t.getFullYear(), t.getMonth(), t.getDate())).getTime() - (new Date(t.getFullYear(), 0, 0)).getTime()) / 864e5), 3);
                    break;
                case"m":
                    c += f("m", t.getMonth() + 1, 2);
                    break;
                case"M":
                    c += l("M", t.getMonth(), o, u);
                    break;
                case"y":
                    c += a("y") ? t.getFullYear() : (10 > t.getYear() % 100 ? "0" : "") + t.getYear() % 100;
                    break;
                case"@":
                    c += t.getTime();
                    break;
                case"!":
                    c += 1e4 * t.getTime() + this._ticksTo1970;
                    break;
                case"'":
                    a("'") ? c += "'" : h = !0;
                    break;
                default:
                    c += e.charAt(r)
            }
            return c
        },
        _possibleChars: function (e) {
            var t, n = "", r = !1, i = function (n) {
                var r = e.length > t + 1 && e.charAt(t + 1) === n;
                return r && t++, r
            };
            for (t = 0; e.length > t; t++) if (r) "'" !== e.charAt(t) || i("'") ? n += e.charAt(t) : r = !1; else switch (e.charAt(t)) {
                case"d":
                case"m":
                case"y":
                case"@":
                    n += "0123456789";
                    break;
                case"D":
                case"M":
                    return null;
                case"'":
                    i("'") ? n += "'" : r = !0;
                    break;
                default:
                    n += e.charAt(t)
            }
            return n
        },
        _get: function (e, t) {
            return void 0 !== e.settings[t] ? e.settings[t] : this._defaults[t]
        },
        _setDateFromField: function (e, t) {
            if (e.input.val() !== e.lastVal) {
                var n = this._get(e, "dateFormat"), r = e.lastVal = e.input ? e.input.val() : null,
                    i = this._getDefaultDate(e), s = i, o = this._getFormatConfig(e);
                try {
                    s = this.parseDate(n, r, o) || i
                } catch (u) {
                    r = t ? "" : r
                }
                e.selectedDay = s.getDate(), e.drawMonth = e.selectedMonth = s.getMonth(), e.drawYear = e.selectedYear = s.getFullYear(), e.currentDay = r ? s.getDate() : 0, e.currentMonth = r ? s.getMonth() : 0, e.currentYear = r ? s.getFullYear() : 0, this._adjustInstDate(e)
            }
        },
        _getDefaultDate: function (e) {
            return this._restrictMinMax(e, this._determineDate(e, this._get(e, "defaultDate"), new Date))
        },
        _determineDate: function (t, n, r) {
            var i = function (e) {
                    var t = new Date;
                    return t.setDate(t.getDate() + e), t
                }, s = function (n) {
                    try {
                        return e.datepicker.parseDate(e.datepicker._get(t, "dateFormat"), n, e.datepicker._getFormatConfig(t))
                    } catch (r) {
                    }
                    for (var i = (n.toLowerCase().match(/^c/) ? e.datepicker._getDate(t) : null) || new Date, s = i.getFullYear(), o = i.getMonth(), u = i.getDate(), a = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g, f = a.exec(n); f;) {
                        switch (f[2] || "d") {
                            case"d":
                            case"D":
                                u += parseInt(f[1], 10);
                                break;
                            case"w":
                            case"W":
                                u += 7 * parseInt(f[1], 10);
                                break;
                            case"m":
                            case"M":
                                o += parseInt(f[1], 10), u = Math.min(u, e.datepicker._getDaysInMonth(s, o));
                                break;
                            case"y":
                            case"Y":
                                s += parseInt(f[1], 10), u = Math.min(u, e.datepicker._getDaysInMonth(s, o))
                        }
                        f = a.exec(n)
                    }
                    return new Date(s, o, u)
                },
                o = null == n || "" === n ? r : "string" == typeof n ? s(n) : "number" == typeof n ? isNaN(n) ? r : i(n) : new Date(n.getTime());
            return o = o && "Invalid Date" == "" + o ? r : o, o && (o.setHours(0), o.setMinutes(0), o.setSeconds(0), o.setMilliseconds(0)), this._daylightSavingAdjust(o)
        },
        _daylightSavingAdjust: function (e) {
            return e ? (e.setHours(e.getHours() > 12 ? e.getHours() + 2 : 0), e) : null
        },
        _setDate: function (e, t, n) {
            var r = !t, i = e.selectedMonth, s = e.selectedYear,
                o = this._restrictMinMax(e, this._determineDate(e, t, new Date));
            e.selectedDay = e.currentDay = o.getDate(), e.drawMonth = e.selectedMonth = e.currentMonth = o.getMonth(), e.drawYear = e.selectedYear = e.currentYear = o.getFullYear(), i === e.selectedMonth && s === e.selectedYear || n || this._notifyChange(e), this._adjustInstDate(e), e.input && e.input.val(r ? "" : this._formatDate(e))
        },
        _getDate: function (e) {
            var t = !e.currentYear || e.input && "" === e.input.val() ? null : this._daylightSavingAdjust(new Date(e.currentYear, e.currentMonth, e.currentDay));
            return t
        },
        _attachHandlers: function (t) {
            var n = this._get(t, "stepMonths"), r = "#" + t.id.replace(/\\\\/g, "\\");
            t.dpDiv.find("[data-handler]").map(function () {
                var t = {
                    prev: function () {
                        e.datepicker._adjustDate(r, -n, "M")
                    }, next: function () {
                        e.datepicker._adjustDate(r, +n, "M")
                    }, hide: function () {
                        e.datepicker._hideDatepicker()
                    }, today: function () {
                        e.datepicker._gotoToday(r)
                    }, selectDay: function () {
                        return e.datepicker._selectDay(r, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this), !1
                    }, selectMonth: function () {
                        return e.datepicker._selectMonthYear(r, this, "M"), !1
                    }, selectYear: function () {
                        return e.datepicker._selectMonthYear(r, this, "Y"), !1
                    }
                };
                e(this).bind(this.getAttribute("data-event"), t[this.getAttribute("data-handler")])
            })
        },
        _generateHTML: function (e) {
            var t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b, w, E, S, x, T, N, C, k, L, A, O, M, _, D, P, H,
                B, j, F, I, q = new Date,
                R = this._daylightSavingAdjust(new Date(q.getFullYear(), q.getMonth(), q.getDate())),
                U = this._get(e, "isRTL"), z = this._get(e, "showButtonPanel"), W = this._get(e, "hideIfNoPrevNext"),
                X = this._get(e, "navigationAsDateFormat"), V = this._getNumberOfMonths(e),
                $ = this._get(e, "showCurrentAtPos"), J = this._get(e, "stepMonths"), K = 1 !== V[0] || 1 !== V[1],
                Q = this._daylightSavingAdjust(e.currentDay ? new Date(e.currentYear, e.currentMonth, e.currentDay) : new Date(9999, 9, 9)),
                G = this._getMinMaxDate(e, "min"), Y = this._getMinMaxDate(e, "max"), Z = e.drawMonth - $,
                et = e.drawYear;
            if (0 > Z && (Z += 12, et--), Y) for (t = this._daylightSavingAdjust(new Date(Y.getFullYear(), Y.getMonth() - V[0] * V[1] + 1, Y.getDate())), t = G && G > t ? G : t; this._daylightSavingAdjust(new Date(et, Z, 1)) > t;) Z--, 0 > Z && (Z = 11, et--);
            for (e.drawMonth = Z, e.drawYear = et, n = this._get(e, "prevText"), n = X ? this.formatDate(n, this._daylightSavingAdjust(new Date(et, Z - J, 1)), this._getFormatConfig(e)) : n, r = this._canAdjustMonth(e, -1, et, Z) ? "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='" + n + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "e" : "w") + "'>" + n + "</span></a>" : W ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + n + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "e" : "w") + "'>" + n + "</span></a>", i = this._get(e, "nextText"), i = X ? this.formatDate(i, this._daylightSavingAdjust(new Date(et, Z + J, 1)), this._getFormatConfig(e)) : i, s = this._canAdjustMonth(e, 1, et, Z) ? "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "w" : "e") + "'>" + i + "</span></a>" : W ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "w" : "e") + "'>" + i + "</span></a>", o = this._get(e, "currentText"), u = this._get(e, "gotoCurrent") && e.currentDay ? Q : R, o = X ? this.formatDate(o, u, this._getFormatConfig(e)) : o, a = e.inline ? "" : "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" + this._get(e, "closeText") + "</button>", f = z ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (U ? a : "") + (this._isInRange(e, u) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>" + o + "</button>" : "") + (U ? "" : a) + "</div>" : "", l = parseInt(this._get(e, "firstDay"), 10), l = isNaN(l) ? 0 : l, c = this._get(e, "showWeek"), h = this._get(e, "dayNames"), p = this._get(e, "dayNamesMin"), d = this._get(e, "monthNames"), v = this._get(e, "monthNamesShort"), m = this._get(e, "beforeShowDay"), g = this._get(e, "showOtherMonths"), y = this._get(e, "selectOtherMonths"), b = this._getDefaultDate(e), w = "", S = 0; V[0] > S; S++) {
                for (x = "", this.maxRows = 4, T = 0; V[1] > T; T++) {
                    if (N = this._daylightSavingAdjust(new Date(et, Z, e.selectedDay)), C = " ui-corner-all", k = "", K) {
                        if (k += "<div class='ui-datepicker-group", V[1] > 1) switch (T) {
                            case 0:
                                k += " ui-datepicker-group-first", C = " ui-corner-" + (U ? "right" : "left");
                                break;
                            case V[1] - 1:
                                k += " ui-datepicker-group-last", C = " ui-corner-" + (U ? "left" : "right");
                                break;
                            default:
                                k += " ui-datepicker-group-middle", C = ""
                        }
                        k += "'>"
                    }
                    for (k += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + C + "'>" + (/all|left/.test(C) && 0 === S ? U ? s : r : "") + (/all|right/.test(C) && 0 === S ? U ? r : s : "") + this._generateMonthYearHeader(e, Z, et, G, Y, S > 0 || T > 0, d, v) + "</div><table class='ui-datepicker-calendar'><thead>" + "<tr>", L = c ? "<th class='ui-datepicker-week-col'>" + this._get(e, "weekHeader") + "</th>" : "", E = 0; 7 > E; E++) A = (E + l) % 7, L += "<th scope='col'" + ((E + l + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + ">" + "<span title='" + h[A] + "'>" + p[A] + "</span></th>";
                    for (k += L + "</tr></thead><tbody>", O = this._getDaysInMonth(et, Z), et === e.selectedYear && Z === e.selectedMonth && (e.selectedDay = Math.min(e.selectedDay, O)), M = (this._getFirstDayOfMonth(et, Z) - l + 7) % 7, _ = Math.ceil((M + O) / 7), D = K ? this.maxRows > _ ? this.maxRows : _ : _, this.maxRows = D, P = this._daylightSavingAdjust(new Date(et, Z, 1 - M)), H = 0; D > H; H++) {
                        for (k += "<tr>", B = c ? "<td class='ui-datepicker-week-col'>" + this._get(e, "calculateWeek")(P) + "</td>" : "", E = 0; 7 > E; E++) j = m ? m.apply(e.input ? e.input[0] : null, [P]) : [!0, ""], F = P.getMonth() !== Z, I = F && !y || !j[0] || G && G > P || Y && P > Y, B += "<td class='" + ((E + l + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + (F ? " ui-datepicker-other-month" : "") + (P.getTime() === N.getTime() && Z === e.selectedMonth && e._keyEvent || b.getTime() === P.getTime() && b.getTime() === N.getTime() ? " " + this._dayOverClass : "") + (I ? " " + this._unselectableClass + " ui-state-disabled" : "") + (F && !g ? "" : " " + j[1] + (P.getTime() === Q.getTime() ? " " + this._currentClass : "") + (P.getTime() === R.getTime() ? " ui-datepicker-today" : "")) + "'" + (F && !g || !j[2] ? "" : " title='" + j[2].replace(/'/g, "&#39;") + "'") + (I ? "" : " data-handler='selectDay' data-event='click' data-month='" + P.getMonth() + "' data-year='" + P.getFullYear() + "'") + ">" + (F && !g ? "&#xa0;" : I ? "<span class='ui-state-default'>" + P.getDate() + "</span>" : "<a class='ui-state-default" + (P.getTime() === R.getTime() ? " ui-state-highlight" : "") + (P.getTime() === Q.getTime() ? " ui-state-active" : "") + (F ? " ui-priority-secondary" : "") + "' href='#'>" + P.getDate() + "</a>") + "</td>", P.setDate(P.getDate() + 1), P = this._daylightSavingAdjust(P);
                        k += B + "</tr>"
                    }
                    Z++, Z > 11 && (Z = 0, et++), k += "</tbody></table>" + (K ? "</div>" + (V[0] > 0 && T === V[1] - 1 ? "<div class='ui-datepicker-row-break'></div>" : "") : ""), x += k
                }
                w += x
            }
            return w += f, e._keyEvent = !1, w
        },
        _generateMonthYearHeader: function (e, t, n, r, i, s, o, u) {
            var a, f, l, c, h, p, d, v, m = this._get(e, "changeMonth"), g = this._get(e, "changeYear"),
                y = this._get(e, "showMonthAfterYear"), b = "<div class='ui-datepicker-title'>", w = "";
            if (s || !m) w += "<span class='ui-datepicker-month'>" + o[t] + "</span>"; else {
                for (a = r && r.getFullYear() === n, f = i && i.getFullYear() === n, w += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>", l = 0; 12 > l; l++) (!a || l >= r.getMonth()) && (!f || i.getMonth() >= l) && (w += "<option value='" + l + "'" + (l === t ? " selected='selected'" : "") + ">" + u[l] + "</option>");
                w += "</select>"
            }
            if (y || (b += w + (!s && m && g ? "" : "&#xa0;")), !e.yearshtml) if (e.yearshtml = "", s || !g) b += "<span class='ui-datepicker-year'>" + n + "</span>"; else {
                for (c = this._get(e, "yearRange").split(":"), h = (new Date).getFullYear(), p = function (e) {
                    var t = e.match(/c[+\-].*/) ? n + parseInt(e.substring(1), 10) : e.match(/[+\-].*/) ? h + parseInt(e, 10) : parseInt(e, 10);
                    return isNaN(t) ? h : t
                }, d = p(c[0]), v = Math.max(d, p(c[1] || "")), d = r ? Math.max(d, r.getFullYear()) : d, v = i ? Math.min(v, i.getFullYear()) : v, e.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>"; v >= d; d++) e.yearshtml += "<option value='" + d + "'" + (d === n ? " selected='selected'" : "") + ">" + d + "</option>";
                e.yearshtml += "</select>", b += e.yearshtml, e.yearshtml = null
            }
            return b += this._get(e, "yearSuffix"), y && (b += (!s && m && g ? "" : "&#xa0;") + w), b += "</div>"
        },
        _adjustInstDate: function (e, t, n) {
            var r = e.drawYear + ("Y" === n ? t : 0), i = e.drawMonth + ("M" === n ? t : 0),
                s = Math.min(e.selectedDay, this._getDaysInMonth(r, i)) + ("D" === n ? t : 0),
                o = this._restrictMinMax(e, this._daylightSavingAdjust(new Date(r, i, s)));
            e.selectedDay = o.getDate(), e.drawMonth = e.selectedMonth = o.getMonth(), e.drawYear = e.selectedYear = o.getFullYear(), ("M" === n || "Y" === n) && this._notifyChange(e)
        },
        _restrictMinMax: function (e, t) {
            var n = this._getMinMaxDate(e, "min"), r = this._getMinMaxDate(e, "max"), i = n && n > t ? n : t;
            return r && i > r ? r : i
        },
        _notifyChange: function (e) {
            var t = this._get(e, "onChangeMonthYear");
            t && t.apply(e.input ? e.input[0] : null, [e.selectedYear, e.selectedMonth + 1, e])
        },
        _getNumberOfMonths: function (e) {
            var t = this._get(e, "numberOfMonths");
            return null == t ? [1, 1] : "number" == typeof t ? [1, t] : t
        },
        _getMinMaxDate: function (e, t) {
            return this._determineDate(e, this._get(e, t + "Date"), null)
        },
        _getDaysInMonth: function (e, t) {
            return 32 - this._daylightSavingAdjust(new Date(e, t, 32)).getDate()
        },
        _getFirstDayOfMonth: function (e, t) {
            return (new Date(e, t, 1)).getDay()
        },
        _canAdjustMonth: function (e, t, n, r) {
            var i = this._getNumberOfMonths(e),
                s = this._daylightSavingAdjust(new Date(n, r + (0 > t ? t : i[0] * i[1]), 1));
            return 0 > t && s.setDate(this._getDaysInMonth(s.getFullYear(), s.getMonth())), this._isInRange(e, s)
        },
        _isInRange: function (e, t) {
            var n, r, i = this._getMinMaxDate(e, "min"), s = this._getMinMaxDate(e, "max"), o = null, u = null,
                a = this._get(e, "yearRange");
            return a && (n = a.split(":"), r = (new Date).getFullYear(), o = parseInt(n[0], 10), u = parseInt(n[1], 10), n[0].match(/[+\-].*/) && (o += r), n[1].match(/[+\-].*/) && (u += r)), (!i || t.getTime() >= i.getTime()) && (!s || t.getTime() <= s.getTime()) && (!o || t.getFullYear() >= o) && (!u || u >= t.getFullYear())
        },
        _getFormatConfig: function (e) {
            var t = this._get(e, "shortYearCutoff");
            return t = "string" != typeof t ? t : (new Date).getFullYear() % 100 + parseInt(t, 10), {
                shortYearCutoff: t,
                dayNamesShort: this._get(e, "dayNamesShort"),
                dayNames: this._get(e, "dayNames"),
                monthNamesShort: this._get(e, "monthNamesShort"),
                monthNames: this._get(e, "monthNames")
            }
        },
        _formatDate: function (e, t, n, r) {
            t || (e.currentDay = e.selectedDay, e.currentMonth = e.selectedMonth, e.currentYear = e.selectedYear);
            var i = t ? "object" == typeof t ? t : this._daylightSavingAdjust(new Date(r, n, t)) : this._daylightSavingAdjust(new Date(e.currentYear, e.currentMonth, e.currentDay));
            return this.formatDate(this._get(e, "dateFormat"), i, this._getFormatConfig(e))
        }
    }), e.fn.datepicker = function (t) {
        if (!this.length) return this;
        e.datepicker.initialized || (e(document).mousedown(e.datepicker._checkExternalClick), e.datepicker.initialized = !0), 0 === e("#" + e.datepicker._mainDivId).length && e("body").append(e.datepicker.dpDiv);
        var n = Array.prototype.slice.call(arguments, 1);
        return "string" != typeof t || "isDisabled" !== t && "getDate" !== t && "widget" !== t ? "option" === t && 2 === arguments.length && "string" == typeof arguments[1] ? e.datepicker["_" + t + "Datepicker"].apply(e.datepicker, [this[0]].concat(n)) : this.each(function () {
            "string" == typeof t ? e.datepicker["_" + t + "Datepicker"].apply(e.datepicker, [this].concat(n)) : e.datepicker._attachDatepicker(this, t)
        }) : e.datepicker["_" + t + "Datepicker"].apply(e.datepicker, [this[0]].concat(n))
    }, e.datepicker = new i, e.datepicker.initialized = !1, e.datepicker.uuid = (new Date).getTime(), e.datepicker.version = "1.11.3", e.datepicker, e.widget("ui.draggable", e.ui.mouse, {
        version: "1.11.3",
        widgetEventPrefix: "drag",
        options: {
            addClasses: !0,
            appendTo: "parent",
            axis: !1,
            connectToSortable: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            iframeFix: !1,
            opacity: !1,
            refreshPositions: !1,
            revert: !1,
            revertDuration: 500,
            scope: "default",
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: !1,
            snapMode: "both",
            snapTolerance: 20,
            stack: !1,
            zIndex: !1,
            drag: null,
            start: null,
            stop: null
        },
        _create: function () {
            "original" === this.options.helper && this._setPositionRelative(), this.options.addClasses && this.element.addClass("ui-draggable"), this.options.disabled && this.element.addClass("ui-draggable-disabled"), this._setHandleClassName(), this._mouseInit()
        },
        _setOption: function (e, t) {
            this._super(e, t), "handle" === e && (this._removeHandleClassName(), this._setHandleClassName())
        },
        _destroy: function () {
            return (this.helper || this.element).is(".ui-draggable-dragging") ? (this.destroyOnClear = !0, void 0) : (this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"), this._removeHandleClassName(), this._mouseDestroy(), void 0)
        },
        _mouseCapture: function (t) {
            var n = this.options;
            return this._blurActiveElement(t), this.helper || n.disabled || e(t.target).closest(".ui-resizable-handle").length > 0 ? !1 : (this.handle = this._getHandle(t), this.handle ? (this._blockFrames(n.iframeFix === !0 ? "iframe" : n.iframeFix), !0) : !1)
        },
        _blockFrames: function (t) {
            this.iframeBlocks = this.document.find(t).map(function () {
                var t = e(this);
                return e("<div>").css("position", "absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]
            })
        },
        _unblockFrames: function () {
            this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks)
        },
        _blurActiveElement: function (t) {
            var n = this.document[0];
            if (this.handleElement.is(t.target)) try {
                n.activeElement && "body" !== n.activeElement.nodeName.toLowerCase() && e(n.activeElement).blur()
            } catch (r) {
            }
        },
        _mouseStart: function (t) {
            var n = this.options;
            return this.helper = this._createHelper(t), this.helper.addClass("ui-draggable-dragging"), this._cacheHelperProportions(), e.ui.ddmanager && (e.ui.ddmanager.current = this), this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(!0), this.offsetParent = this.helper.offsetParent(), this.hasFixedAncestor = this.helper.parents().filter(function () {
                return "fixed" === e(this).css("position")
            }).length > 0, this.positionAbs = this.element.offset(), this._refreshOffsets(t), this.originalPosition = this.position = this._generatePosition(t, !1), this.originalPageX = t.pageX, this.originalPageY = t.pageY, n.cursorAt && this._adjustOffsetFromHelper(n.cursorAt), this._setContainment(), this._trigger("start", t) === !1 ? (this._clear(), !1) : (this._cacheHelperProportions(), e.ui.ddmanager && !n.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t), this._normalizeRightBottom(), this._mouseDrag(t, !0), e.ui.ddmanager && e.ui.ddmanager.dragStart(this, t), !0)
        },
        _refreshOffsets: function (e) {
            this.offset = {
                top: this.positionAbs.top - this.margins.top,
                left: this.positionAbs.left - this.margins.left,
                scroll: !1,
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            }, this.offset.click = {left: e.pageX - this.offset.left, top: e.pageY - this.offset.top}
        },
        _mouseDrag: function (t, n) {
            if (this.hasFixedAncestor && (this.offset.parent = this._getParentOffset()), this.position = this._generatePosition(t, !0), this.positionAbs = this._convertPositionTo("absolute"), !n) {
                var r = this._uiHash();
                if (this._trigger("drag", t, r) === !1) return this._mouseUp({}), !1;
                this.position = r.position
            }
            return this.helper[0].style.left = this.position.left + "px", this.helper[0].style.top = this.position.top + "px", e.ui.ddmanager && e.ui.ddmanager.drag(this, t), !1
        },
        _mouseStop: function (t) {
            var n = this, r = !1;
            return e.ui.ddmanager && !this.options.dropBehaviour && (r = e.ui.ddmanager.drop(this, t)), this.dropped && (r = this.dropped, this.dropped = !1), "invalid" === this.options.revert && !r || "valid" === this.options.revert && r || this.options.revert === !0 || e.isFunction(this.options.revert) && this.options.revert.call(this.element, r) ? e(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function () {
                n._trigger("stop", t) !== !1 && n._clear()
            }) : this._trigger("stop", t) !== !1 && this._clear(), !1
        },
        _mouseUp: function (t) {
            return this._unblockFrames(), e.ui.ddmanager && e.ui.ddmanager.dragStop(this, t), this.handleElement.is(t.target) && this.element.focus(), e.ui.mouse.prototype._mouseUp.call(this, t)
        },
        cancel: function () {
            return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(), this
        },
        _getHandle: function (t) {
            return this.options.handle ? !!e(t.target).closest(this.element.find(this.options.handle)).length : !0
        },
        _setHandleClassName: function () {
            this.handleElement = this.options.handle ? this.element.find(this.options.handle) : this.element, this.handleElement.addClass("ui-draggable-handle")
        },
        _removeHandleClassName: function () {
            this.handleElement.removeClass("ui-draggable-handle")
        },
        _createHelper: function (t) {
            var n = this.options, r = e.isFunction(n.helper),
                i = r ? e(n.helper.apply(this.element[0], [t])) : "clone" === n.helper ? this.element.clone().removeAttr("id") : this.element;
            return i.parents("body").length || i.appendTo("parent" === n.appendTo ? this.element[0].parentNode : n.appendTo), r && i[0] === this.element[0] && this._setPositionRelative(), i[0] === this.element[0] || /(fixed|absolute)/.test(i.css("position")) || i.css("position", "absolute"), i
        },
        _setPositionRelative: function () {
            /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative")
        },
        _adjustOffsetFromHelper: function (t) {
            "string" == typeof t && (t = t.split(" ")), e.isArray(t) && (t = {
                left: +t[0],
                top: +t[1] || 0
            }), "left" in t && (this.offset.click.left = t.left + this.margins.left), "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left), "top" in t && (this.offset.click.top = t.top + this.margins.top), "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top)
        },
        _isRootNode: function (e) {
            return /(html|body)/i.test(e.tagName) || e === this.document[0]
        },
        _getParentOffset: function () {
            var t = this.offsetParent.offset(), n = this.document[0];
            return "absolute" === this.cssPosition && this.scrollParent[0] !== n && e.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop()), this._isRootNode(this.offsetParent[0]) && (t = {
                top: 0,
                left: 0
            }), {
                top: t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function () {
            if ("relative" !== this.cssPosition) return {top: 0, left: 0};
            var e = this.element.position(), t = this._isRootNode(this.scrollParent[0]);
            return {
                top: e.top - (parseInt(this.helper.css("top"), 10) || 0) + (t ? 0 : this.scrollParent.scrollTop()),
                left: e.left - (parseInt(this.helper.css("left"), 10) || 0) + (t ? 0 : this.scrollParent.scrollLeft())
            }
        },
        _cacheMargins: function () {
            this.margins = {
                left: parseInt(this.element.css("marginLeft"), 10) || 0,
                top: parseInt(this.element.css("marginTop"), 10) || 0,
                right: parseInt(this.element.css("marginRight"), 10) || 0,
                bottom: parseInt(this.element.css("marginBottom"), 10) || 0
            }
        },
        _cacheHelperProportions: function () {
            this.helperProportions = {width: this.helper.outerWidth(), height: this.helper.outerHeight()}
        },
        _setContainment: function () {
            var t, n, r, i = this.options, s = this.document[0];
            return this.relativeContainer = null, i.containment ? "window" === i.containment ? (this.containment = [e(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, e(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, e(window).scrollLeft() + e(window).width() - this.helperProportions.width - this.margins.left, e(window).scrollTop() + (e(window).height() || s.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top], void 0) : "document" === i.containment ? (this.containment = [0, 0, e(s).width() - this.helperProportions.width - this.margins.left, (e(s).height() || s.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top], void 0) : i.containment.constructor === Array ? (this.containment = i.containment, void 0) : ("parent" === i.containment && (i.containment = this.helper[0].parentNode), n = e(i.containment), r = n[0], r && (t = /(scroll|auto)/.test(n.css("overflow")), this.containment = [(parseInt(n.css("borderLeftWidth"), 10) || 0) + (parseInt(n.css("paddingLeft"), 10) || 0), (parseInt(n.css("borderTopWidth"), 10) || 0) + (parseInt(n.css("paddingTop"), 10) || 0), (t ? Math.max(r.scrollWidth, r.offsetWidth) : r.offsetWidth) - (parseInt(n.css("borderRightWidth"), 10) || 0) - (parseInt(n.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (t ? Math.max(r.scrollHeight, r.offsetHeight) : r.offsetHeight) - (parseInt(n.css("borderBottomWidth"), 10) || 0) - (parseInt(n.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom], this.relativeContainer = n), void 0) : (this.containment = null, void 0)
        },
        _convertPositionTo: function (e, t) {
            t || (t = this.position);
            var n = "absolute" === e ? 1 : -1, r = this._isRootNode(this.scrollParent[0]);
            return {
                top: t.top + this.offset.relative.top * n + this.offset.parent.top * n - ("fixed" === this.cssPosition ? -this.offset.scroll.top : r ? 0 : this.offset.scroll.top) * n,
                left: t.left + this.offset.relative.left * n + this.offset.parent.left * n - ("fixed" === this.cssPosition ? -this.offset.scroll.left : r ? 0 : this.offset.scroll.left) * n
            }
        },
        _generatePosition: function (e, t) {
            var n, r, i, s, o = this.options, u = this._isRootNode(this.scrollParent[0]), a = e.pageX, f = e.pageY;
            return u && this.offset.scroll || (this.offset.scroll = {
                top: this.scrollParent.scrollTop(),
                left: this.scrollParent.scrollLeft()
            }), t && (this.containment && (this.relativeContainer ? (r = this.relativeContainer.offset(), n = [this.containment[0] + r.left, this.containment[1] + r.top, this.containment[2] + r.left, this.containment[3] + r.top]) : n = this.containment, e.pageX - this.offset.click.left < n[0] && (a = n[0] + this.offset.click.left), e.pageY - this.offset.click.top < n[1] && (f = n[1] + this.offset.click.top), e.pageX - this.offset.click.left > n[2] && (a = n[2] + this.offset.click.left), e.pageY - this.offset.click.top > n[3] && (f = n[3] + this.offset.click.top)), o.grid && (i = o.grid[1] ? this.originalPageY + Math.round((f - this.originalPageY) / o.grid[1]) * o.grid[1] : this.originalPageY, f = n ? i - this.offset.click.top >= n[1] || i - this.offset.click.top > n[3] ? i : i - this.offset.click.top >= n[1] ? i - o.grid[1] : i + o.grid[1] : i, s = o.grid[0] ? this.originalPageX + Math.round((a - this.originalPageX) / o.grid[0]) * o.grid[0] : this.originalPageX, a = n ? s - this.offset.click.left >= n[0] || s - this.offset.click.left > n[2] ? s : s - this.offset.click.left >= n[0] ? s - o.grid[0] : s + o.grid[0] : s), "y" === o.axis && (a = this.originalPageX), "x" === o.axis && (f = this.originalPageY)), {
                top: f - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.offset.scroll.top : u ? 0 : this.offset.scroll.top),
                left: a - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.offset.scroll.left : u ? 0 : this.offset.scroll.left)
            }
        },
        _clear: function () {
            this.helper.removeClass("ui-draggable-dragging"), this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(), this.helper = null, this.cancelHelperRemoval = !1, this.destroyOnClear && this.destroy()
        },
        _normalizeRightBottom: function () {
            "y" !== this.options.axis && "auto" !== this.helper.css("right") && (this.helper.width(this.helper.width()), this.helper.css("right", "auto")), "x" !== this.options.axis && "auto" !== this.helper.css("bottom") && (this.helper.height(this.helper.height()), this.helper.css("bottom", "auto"))
        },
        _trigger: function (t, n, r) {
            return r = r || this._uiHash(), e.ui.plugin.call(this, t, [n, r, this], !0), /^(drag|start|stop)/.test(t) && (this.positionAbs = this._convertPositionTo("absolute"), r.offset = this.positionAbs), e.Widget.prototype._trigger.call(this, t, n, r)
        },
        plugins: {},
        _uiHash: function () {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            }
        }
    }), e.ui.plugin.add("draggable", "connectToSortable", {
        start: function (t, n, r) {
            var i = e.extend({}, n, {item: r.element});
            r.sortables = [], e(r.options.connectToSortable).each(function () {
                var n = e(this).sortable("instance");
                n && !n.options.disabled && (r.sortables.push(n), n.refreshPositions(), n._trigger("activate", t, i))
            })
        }, stop: function (t, n, r) {
            var i = e.extend({}, n, {item: r.element});
            r.cancelHelperRemoval = !1, e.each(r.sortables, function () {
                var e = this;
                e.isOver ? (e.isOver = 0, r.cancelHelperRemoval = !0, e.cancelHelperRemoval = !1, e._storedCSS = {
                    position: e.placeholder.css("position"),
                    top: e.placeholder.css("top"),
                    left: e.placeholder.css("left")
                }, e._mouseStop(t), e.options.helper = e.options._helper) : (e.cancelHelperRemoval = !0, e._trigger("deactivate", t, i))
            })
        }, drag: function (t, n, r) {
            e.each(r.sortables, function () {
                var i = !1, s = this;
                s.positionAbs = r.positionAbs, s.helperProportions = r.helperProportions, s.offset.click = r.offset.click, s._intersectsWith(s.containerCache) && (i = !0, e.each(r.sortables, function () {
                    return this.positionAbs = r.positionAbs, this.helperProportions = r.helperProportions, this.offset.click = r.offset.click, this !== s && this._intersectsWith(this.containerCache) && e.contains(s.element[0], this.element[0]) && (i = !1), i
                })), i ? (s.isOver || (s.isOver = 1, s.currentItem = n.helper.appendTo(s.element).data("ui-sortable-item", !0), s.options._helper = s.options.helper, s.options.helper = function () {
                    return n.helper[0]
                }, t.target = s.currentItem[0], s._mouseCapture(t, !0), s._mouseStart(t, !0, !0), s.offset.click.top = r.offset.click.top, s.offset.click.left = r.offset.click.left, s.offset.parent.left -= r.offset.parent.left - s.offset.parent.left, s.offset.parent.top -= r.offset.parent.top - s.offset.parent.top, r._trigger("toSortable", t), r.dropped = s.element, e.each(r.sortables, function () {
                    this.refreshPositions()
                }), r.currentItem = r.element, s.fromOutside = r), s.currentItem && (s._mouseDrag(t), n.position = s.position)) : s.isOver && (s.isOver = 0, s.cancelHelperRemoval = !0, s.options._revert = s.options.revert, s.options.revert = !1, s._trigger("out", t, s._uiHash(s)), s._mouseStop(t, !0), s.options.revert = s.options._revert, s.options.helper = s.options._helper, s.placeholder && s.placeholder.remove(), r._refreshOffsets(t), n.position = r._generatePosition(t, !0), r._trigger("fromSortable", t), r.dropped = !1, e.each(r.sortables, function () {
                    this.refreshPositions()
                }))
            })
        }
    }), e.ui.plugin.add("draggable", "cursor", {
        start: function (t, n, r) {
            var i = e("body"), s = r.options;
            i.css("cursor") && (s._cursor = i.css("cursor")), i.css("cursor", s.cursor)
        }, stop: function (t, n, r) {
            var i = r.options;
            i._cursor && e("body").css("cursor", i._cursor)
        }
    }), e.ui.plugin.add("draggable", "opacity", {
        start: function (t, n, r) {
            var i = e(n.helper), s = r.options;
            i.css("opacity") && (s._opacity = i.css("opacity")), i.css("opacity", s.opacity)
        }, stop: function (t, n, r) {
            var i = r.options;
            i._opacity && e(n.helper).css("opacity", i._opacity)
        }
    }), e.ui.plugin.add("draggable", "scroll", {
        start: function (e, t, n) {
            n.scrollParentNotHidden || (n.scrollParentNotHidden = n.helper.scrollParent(!1)), n.scrollParentNotHidden[0] !== n.document[0] && "HTML" !== n.scrollParentNotHidden[0].tagName && (n.overflowOffset = n.scrollParentNotHidden.offset())
        }, drag: function (t, n, r) {
            var i = r.options, s = !1, o = r.scrollParentNotHidden[0], u = r.document[0];
            o !== u && "HTML" !== o.tagName ? (i.axis && "x" === i.axis || (r.overflowOffset.top + o.offsetHeight - t.pageY < i.scrollSensitivity ? o.scrollTop = s = o.scrollTop + i.scrollSpeed : t.pageY - r.overflowOffset.top < i.scrollSensitivity && (o.scrollTop = s = o.scrollTop - i.scrollSpeed)), i.axis && "y" === i.axis || (r.overflowOffset.left + o.offsetWidth - t.pageX < i.scrollSensitivity ? o.scrollLeft = s = o.scrollLeft + i.scrollSpeed : t.pageX - r.overflowOffset.left < i.scrollSensitivity && (o.scrollLeft = s = o.scrollLeft - i.scrollSpeed))) : (i.axis && "x" === i.axis || (t.pageY - e(u).scrollTop() < i.scrollSensitivity ? s = e(u).scrollTop(e(u).scrollTop() - i.scrollSpeed) : e(window).height() - (t.pageY - e(u).scrollTop()) < i.scrollSensitivity && (s = e(u).scrollTop(e(u).scrollTop() + i.scrollSpeed))), i.axis && "y" === i.axis || (t.pageX - e(u).scrollLeft() < i.scrollSensitivity ? s = e(u).scrollLeft(e(u).scrollLeft() - i.scrollSpeed) : e(window).width() - (t.pageX - e(u).scrollLeft()) < i.scrollSensitivity && (s = e(u).scrollLeft(e(u).scrollLeft() + i.scrollSpeed)))), s !== !1 && e.ui.ddmanager && !i.dropBehaviour && e.ui.ddmanager.prepareOffsets(r, t)
        }
    }), e.ui.plugin.add("draggable", "snap", {
        start: function (t, n, r) {
            var i = r.options;
            r.snapElements = [], e(i.snap.constructor !== String ? i.snap.items || ":data(ui-draggable)" : i.snap).each(function () {
                var t = e(this), n = t.offset();
                this !== r.element[0] && r.snapElements.push({
                    item: this,
                    width: t.outerWidth(),
                    height: t.outerHeight(),
                    top: n.top,
                    left: n.left
                })
            })
        }, drag: function (t, n, r) {
            var i, s, o, u, a, f, l, c, h, p, d = r.options, v = d.snapTolerance, m = n.offset.left,
                g = m + r.helperProportions.width, y = n.offset.top, b = y + r.helperProportions.height;
            for (h = r.snapElements.length - 1; h >= 0; h--) a = r.snapElements[h].left - r.margins.left, f = a + r.snapElements[h].width, l = r.snapElements[h].top - r.margins.top, c = l + r.snapElements[h].height, a - v > g || m > f + v || l - v > b || y > c + v || !e.contains(r.snapElements[h].item.ownerDocument, r.snapElements[h].item) ? (r.snapElements[h].snapping && r.options.snap.release && r.options.snap.release.call(r.element, t, e.extend(r._uiHash(), {snapItem: r.snapElements[h].item})), r.snapElements[h].snapping = !1) : ("inner" !== d.snapMode && (i = v >= Math.abs(l - b), s = v >= Math.abs(c - y), o = v >= Math.abs(a - g), u = v >= Math.abs(f - m), i && (n.position.top = r._convertPositionTo("relative", {
                top: l - r.helperProportions.height,
                left: 0
            }).top), s && (n.position.top = r._convertPositionTo("relative", {
                top: c,
                left: 0
            }).top), o && (n.position.left = r._convertPositionTo("relative", {
                top: 0,
                left: a - r.helperProportions.width
            }).left), u && (n.position.left = r._convertPositionTo("relative", {
                top: 0,
                left: f
            }).left)), p = i || s || o || u, "outer" !== d.snapMode && (i = v >= Math.abs(l - y), s = v >= Math.abs(c - b), o = v >= Math.abs(a - m), u = v >= Math.abs(f - g), i && (n.position.top = r._convertPositionTo("relative", {
                top: l,
                left: 0
            }).top), s && (n.position.top = r._convertPositionTo("relative", {
                top: c - r.helperProportions.height,
                left: 0
            }).top), o && (n.position.left = r._convertPositionTo("relative", {
                top: 0,
                left: a
            }).left), u && (n.position.left = r._convertPositionTo("relative", {
                top: 0,
                left: f - r.helperProportions.width
            }).left)), !r.snapElements[h].snapping && (i || s || o || u || p) && r.options.snap.snap && r.options.snap.snap.call(r.element, t, e.extend(r._uiHash(), {snapItem: r.snapElements[h].item})), r.snapElements[h].snapping = i || s || o || u || p)
        }
    }), e.ui.plugin.add("draggable", "stack", {
        start: function (t, n, r) {
            var i, s = r.options, o = e.makeArray(e(s.stack)).sort(function (t, n) {
                return (parseInt(e(t).css("zIndex"), 10) || 0) - (parseInt(e(n).css("zIndex"), 10) || 0)
            });
            o.length && (i = parseInt(e(o[0]).css("zIndex"), 10) || 0, e(o).each(function (t) {
                e(this).css("zIndex", i + t)
            }), this.css("zIndex", i + o.length))
        }
    }), e.ui.plugin.add("draggable", "zIndex", {
        start: function (t, n, r) {
            var i = e(n.helper), s = r.options;
            i.css("zIndex") && (s._zIndex = i.css("zIndex")), i.css("zIndex", s.zIndex)
        }, stop: function (t, n, r) {
            var i = r.options;
            i._zIndex && e(n.helper).css("zIndex", i._zIndex)
        }
    }), e.ui.draggable, e.widget("ui.resizable", e.ui.mouse, {
        version: "1.11.3",
        widgetEventPrefix: "resize",
        options: {
            alsoResize: !1,
            animate: !1,
            animateDuration: "slow",
            animateEasing: "swing",
            aspectRatio: !1,
            autoHide: !1,
            containment: !1,
            ghost: !1,
            grid: !1,
            handles: "e,s,se",
            helper: !1,
            maxHeight: null,
            maxWidth: null,
            minHeight: 10,
            minWidth: 10,
            zIndex: 90,
            resize: null,
            start: null,
            stop: null
        },
        _num: function (e) {
            return parseInt(e, 10) || 0
        },
        _isNumber: function (e) {
            return !isNaN(parseInt(e, 10))
        },
        _hasScroll: function (t, n) {
            if ("hidden" === e(t).css("overflow")) return !1;
            var r = n && "left" === n ? "scrollLeft" : "scrollTop", i = !1;
            return t[r] > 0 ? !0 : (t[r] = 1, i = t[r] > 0, t[r] = 0, i)
        },
        _create: function () {
            var t, n, r, i, s, o = this, u = this.options;
            if (this.element.addClass("ui-resizable"), e.extend(this, {
                _aspectRatio: !!u.aspectRatio,
                aspectRatio: u.aspectRatio,
                originalElement: this.element,
                _proportionallyResizeElements: [],
                _helper: u.helper || u.ghost || u.animate ? u.helper || "ui-resizable-helper" : null
            }), this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i) && (this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
                position: this.element.css("position"),
                width: this.element.outerWidth(),
                height: this.element.outerHeight(),
                top: this.element.css("top"),
                left: this.element.css("left")
            })), this.element = this.element.parent().data("ui-resizable", this.element.resizable("instance")), this.elementIsWrapper = !0, this.element.css({
                marginLeft: this.originalElement.css("marginLeft"),
                marginTop: this.originalElement.css("marginTop"),
                marginRight: this.originalElement.css("marginRight"),
                marginBottom: this.originalElement.css("marginBottom")
            }), this.originalElement.css({
                marginLeft: 0,
                marginTop: 0,
                marginRight: 0,
                marginBottom: 0
            }), this.originalResizeStyle = this.originalElement.css("resize"), this.originalElement.css("resize", "none"), this._proportionallyResizeElements.push(this.originalElement.css({
                position: "static",
                zoom: 1,
                display: "block"
            })), this.originalElement.css({margin: this.originalElement.css("margin")}), this._proportionallyResize()), this.handles = u.handles || (e(".ui-resizable-handle", this.element).length ? {
                n: ".ui-resizable-n",
                e: ".ui-resizable-e",
                s: ".ui-resizable-s",
                w: ".ui-resizable-w",
                se: ".ui-resizable-se",
                sw: ".ui-resizable-sw",
                ne: ".ui-resizable-ne",
                nw: ".ui-resizable-nw"
            } : "e,s,se"), this.handles.constructor === String) for ("all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"), t = this.handles.split(","), this.handles = {}, n = 0; t.length > n; n++) r = e.trim(t[n]), s = "ui-resizable-" + r, i = e("<div class='ui-resizable-handle " + s + "'></div>"), i.css({zIndex: u.zIndex}), "se" === r && i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"), this.handles[r] = ".ui-resizable-" + r, this.element.append(i);
            this._renderAxis = function (t) {
                var n, r, i, s;
                t = t || this.element;
                for (n in this.handles) this.handles[n].constructor === String && (this.handles[n] = this.element.children(this.handles[n]).first().show()), this.elementIsWrapper && this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i) && (r = e(this.handles[n], this.element), s = /sw|ne|nw|se|n|s/.test(n) ? r.outerHeight() : r.outerWidth(), i = ["padding", /ne|nw|n/.test(n) ? "Top" : /se|sw|s/.test(n) ? "Bottom" : /^e$/.test(n) ? "Right" : "Left"].join(""), t.css(i, s), this._proportionallyResize()), e(this.handles[n]).length
            }, this._renderAxis(this.element), this._handles = e(".ui-resizable-handle", this.element).disableSelection(), this._handles.mouseover(function () {
                o.resizing || (this.className && (i = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), o.axis = i && i[1] ? i[1] : "se")
            }), u.autoHide && (this._handles.hide(), e(this.element).addClass("ui-resizable-autohide").mouseenter(function () {
                u.disabled || (e(this).removeClass("ui-resizable-autohide"), o._handles.show())
            }).mouseleave(function () {
                u.disabled || o.resizing || (e(this).addClass("ui-resizable-autohide"), o._handles.hide())
            })), this._mouseInit()
        },
        _destroy: function () {
            this._mouseDestroy();
            var t, n = function (t) {
                e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()
            };
            return this.elementIsWrapper && (n(this.element), t = this.element, this.originalElement.css({
                position: t.css("position"),
                width: t.outerWidth(),
                height: t.outerHeight(),
                top: t.css("top"),
                left: t.css("left")
            }).insertAfter(t), t.remove()), this.originalElement.css("resize", this.originalResizeStyle), n(this.originalElement), this
        },
        _mouseCapture: function (t) {
            var n, r, i = !1;
            for (n in this.handles) r = e(this.handles[n])[0], (r === t.target || e.contains(r, t.target)) && (i = !0);
            return !this.options.disabled && i
        },
        _mouseStart: function (t) {
            var n, r, i, s = this.options, o = this.element;
            return this.resizing = !0, this._renderProxy(), n = this._num(this.helper.css("left")), r = this._num(this.helper.css("top")), s.containment && (n += e(s.containment).scrollLeft() || 0, r += e(s.containment).scrollTop() || 0), this.offset = this.helper.offset(), this.position = {
                left: n,
                top: r
            }, this.size = this._helper ? {
                width: this.helper.width(),
                height: this.helper.height()
            } : {width: o.width(), height: o.height()}, this.originalSize = this._helper ? {
                width: o.outerWidth(),
                height: o.outerHeight()
            } : {width: o.width(), height: o.height()}, this.sizeDiff = {
                width: o.outerWidth() - o.width(),
                height: o.outerHeight() - o.height()
            }, this.originalPosition = {left: n, top: r}, this.originalMousePosition = {
                left: t.pageX,
                top: t.pageY
            }, this.aspectRatio = "number" == typeof s.aspectRatio ? s.aspectRatio : this.originalSize.width / this.originalSize.height || 1, i = e(".ui-resizable-" + this.axis).css("cursor"), e("body").css("cursor", "auto" === i ? this.axis + "-resize" : i), o.addClass("ui-resizable-resizing"), this._propagate("start", t), !0
        },
        _mouseDrag: function (t) {
            var n, r, i = this.originalMousePosition, s = this.axis, o = t.pageX - i.left || 0,
                u = t.pageY - i.top || 0, a = this._change[s];
            return this._updatePrevProperties(), a ? (n = a.apply(this, [t, o, u]), this._updateVirtualBoundaries(t.shiftKey), (this._aspectRatio || t.shiftKey) && (n = this._updateRatio(n, t)), n = this._respectSize(n, t), this._updateCache(n), this._propagate("resize", t), r = this._applyChanges(), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), e.isEmptyObject(r) || (this._updatePrevProperties(), this._trigger("resize", t, this.ui()), this._applyChanges()), !1) : !1
        },
        _mouseStop: function (t) {
            this.resizing = !1;
            var n, r, i, s, o, u, a, f = this.options, l = this;
            return this._helper && (n = this._proportionallyResizeElements, r = n.length && /textarea/i.test(n[0].nodeName), i = r && this._hasScroll(n[0], "left") ? 0 : l.sizeDiff.height, s = r ? 0 : l.sizeDiff.width, o = {
                width: l.helper.width() - s,
                height: l.helper.height() - i
            }, u = parseInt(l.element.css("left"), 10) + (l.position.left - l.originalPosition.left) || null, a = parseInt(l.element.css("top"), 10) + (l.position.top - l.originalPosition.top) || null, f.animate || this.element.css(e.extend(o, {
                top: a,
                left: u
            })), l.helper.height(l.size.height), l.helper.width(l.size.width), this._helper && !f.animate && this._proportionallyResize()), e("body").css("cursor", "auto"), this.element.removeClass("ui-resizable-resizing"), this._propagate("stop", t), this._helper && this.helper.remove(), !1
        },
        _updatePrevProperties: function () {
            this.prevPosition = {
                top: this.position.top,
                left: this.position.left
            }, this.prevSize = {width: this.size.width, height: this.size.height}
        },
        _applyChanges: function () {
            var e = {};
            return this.position.top !== this.prevPosition.top && (e.top = this.position.top + "px"), this.position.left !== this.prevPosition.left && (e.left = this.position.left + "px"), this.size.width !== this.prevSize.width && (e.width = this.size.width + "px"), this.size.height !== this.prevSize.height && (e.height = this.size.height + "px"), this.helper.css(e), e
        },
        _updateVirtualBoundaries: function (e) {
            var t, n, r, i, s, o = this.options;
            s = {
                minWidth: this._isNumber(o.minWidth) ? o.minWidth : 0,
                maxWidth: this._isNumber(o.maxWidth) ? o.maxWidth : 1 / 0,
                minHeight: this._isNumber(o.minHeight) ? o.minHeight : 0,
                maxHeight: this._isNumber(o.maxHeight) ? o.maxHeight : 1 / 0
            }, (this._aspectRatio || e) && (t = s.minHeight * this.aspectRatio, r = s.minWidth / this.aspectRatio, n = s.maxHeight * this.aspectRatio, i = s.maxWidth / this.aspectRatio, t > s.minWidth && (s.minWidth = t), r > s.minHeight && (s.minHeight = r), s.maxWidth > n && (s.maxWidth = n), s.maxHeight > i && (s.maxHeight = i)), this._vBoundaries = s
        },
        _updateCache: function (e) {
            this.offset = this.helper.offset(), this._isNumber(e.left) && (this.position.left = e.left), this._isNumber(e.top) && (this.position.top = e.top), this._isNumber(e.height) && (this.size.height = e.height), this._isNumber(e.width) && (this.size.width = e.width)
        },
        _updateRatio: function (e) {
            var t = this.position, n = this.size, r = this.axis;
            return this._isNumber(e.height) ? e.width = e.height * this.aspectRatio : this._isNumber(e.width) && (e.height = e.width / this.aspectRatio), "sw" === r && (e.left = t.left + (n.width - e.width), e.top = null), "nw" === r && (e.top = t.top + (n.height - e.height), e.left = t.left + (n.width - e.width)), e
        },
        _respectSize: function (e) {
            var t = this._vBoundaries, n = this.axis, r = this._isNumber(e.width) && t.maxWidth && t.maxWidth < e.width,
                i = this._isNumber(e.height) && t.maxHeight && t.maxHeight < e.height,
                s = this._isNumber(e.width) && t.minWidth && t.minWidth > e.width,
                o = this._isNumber(e.height) && t.minHeight && t.minHeight > e.height,
                u = this.originalPosition.left + this.originalSize.width, a = this.position.top + this.size.height,
                f = /sw|nw|w/.test(n), l = /nw|ne|n/.test(n);
            return s && (e.width = t.minWidth), o && (e.height = t.minHeight), r && (e.width = t.maxWidth), i && (e.height = t.maxHeight), s && f && (e.left = u - t.minWidth), r && f && (e.left = u - t.maxWidth), o && l && (e.top = a - t.minHeight), i && l && (e.top = a - t.maxHeight), e.width || e.height || e.left || !e.top ? e.width || e.height || e.top || !e.left || (e.left = null) : e.top = null, e
        },
        _getPaddingPlusBorderDimensions: function (e) {
            for (var t = 0, n = [], r = [e.css("borderTopWidth"), e.css("borderRightWidth"), e.css("borderBottomWidth"), e.css("borderLeftWidth")], i = [e.css("paddingTop"), e.css("paddingRight"), e.css("paddingBottom"), e.css("paddingLeft")]; 4 > t; t++) n[t] = parseInt(r[t], 10) || 0, n[t] += parseInt(i[t], 10) || 0;
            return {height: n[0] + n[2], width: n[1] + n[3]}
        },
        _proportionallyResize: function () {
            if (this._proportionallyResizeElements.length) for (var e, t = 0, n = this.helper || this.element; this._proportionallyResizeElements.length > t; t++) e = this._proportionallyResizeElements[t], this.outerDimensions || (this.outerDimensions = this._getPaddingPlusBorderDimensions(e)), e.css({
                height: n.height() - this.outerDimensions.height || 0,
                width: n.width() - this.outerDimensions.width || 0
            })
        },
        _renderProxy: function () {
            var t = this.element, n = this.options;
            this.elementOffset = t.offset(), this._helper ? (this.helper = this.helper || e("<div style='overflow:hidden;'></div>"), this.helper.addClass(this._helper).css({
                width: this.element.outerWidth() - 1,
                height: this.element.outerHeight() - 1,
                position: "absolute",
                left: this.elementOffset.left + "px",
                top: this.elementOffset.top + "px",
                zIndex: ++n.zIndex
            }), this.helper.appendTo("body").disableSelection()) : this.helper = this.element
        },
        _change: {
            e: function (e, t) {
                return {width: this.originalSize.width + t}
            }, w: function (e, t) {
                var n = this.originalSize, r = this.originalPosition;
                return {left: r.left + t, width: n.width - t}
            }, n: function (e, t, n) {
                var r = this.originalSize, i = this.originalPosition;
                return {top: i.top + n, height: r.height - n}
            }, s: function (e, t, n) {
                return {height: this.originalSize.height + n}
            }, se: function (t, n, r) {
                return e.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [t, n, r]))
            }, sw: function (t, n, r) {
                return e.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [t, n, r]))
            }, ne: function (t, n, r) {
                return e.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [t, n, r]))
            }, nw: function (t, n, r) {
                return e.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [t, n, r]))
            }
        },
        _propagate: function (t, n) {
            e.ui.plugin.call(this, t, [n, this.ui()]), "resize" !== t && this._trigger(t, n, this.ui())
        },
        plugins: {},
        ui: function () {
            return {
                originalElement: this.originalElement,
                element: this.element,
                helper: this.helper,
                position: this.position,
                size: this.size,
                originalSize: this.originalSize,
                originalPosition: this.originalPosition
            }
        }
    }), e.ui.plugin.add("resizable", "animate", {
        stop: function (t) {
            var n = e(this).resizable("instance"), r = n.options, i = n._proportionallyResizeElements,
                s = i.length && /textarea/i.test(i[0].nodeName),
                o = s && n._hasScroll(i[0], "left") ? 0 : n.sizeDiff.height, u = s ? 0 : n.sizeDiff.width,
                a = {width: n.size.width - u, height: n.size.height - o},
                f = parseInt(n.element.css("left"), 10) + (n.position.left - n.originalPosition.left) || null,
                l = parseInt(n.element.css("top"), 10) + (n.position.top - n.originalPosition.top) || null;
            n.element.animate(e.extend(a, l && f ? {top: l, left: f} : {}), {
                duration: r.animateDuration,
                easing: r.animateEasing,
                step: function () {
                    var r = {
                        width: parseInt(n.element.css("width"), 10),
                        height: parseInt(n.element.css("height"), 10),
                        top: parseInt(n.element.css("top"), 10),
                        left: parseInt(n.element.css("left"), 10)
                    };
                    i && i.length && e(i[0]).css({
                        width: r.width,
                        height: r.height
                    }), n._updateCache(r), n._propagate("resize", t)
                }
            })
        }
    }), e.ui.plugin.add("resizable", "containment", {
        start: function () {
            var t, n, r, i, s, o, u, a = e(this).resizable("instance"), f = a.options, l = a.element, c = f.containment,
                h = c instanceof e ? c.get(0) : /parent/.test(c) ? l.parent().get(0) : c;
            h && (a.containerElement = e(h), /document/.test(c) || c === document ? (a.containerOffset = {
                left: 0,
                top: 0
            }, a.containerPosition = {left: 0, top: 0}, a.parentData = {
                element: e(document),
                left: 0,
                top: 0,
                width: e(document).width(),
                height: e(document).height() || document.body.parentNode.scrollHeight
            }) : (t = e(h), n = [], e(["Top", "Right", "Left", "Bottom"]).each(function (e, r) {
                n[e] = a._num(t.css("padding" + r))
            }), a.containerOffset = t.offset(), a.containerPosition = t.position(), a.containerSize = {
                height: t.innerHeight() - n[3],
                width: t.innerWidth() - n[1]
            }, r = a.containerOffset, i = a.containerSize.height, s = a.containerSize.width, o = a._hasScroll(h, "left") ? h.scrollWidth : s, u = a._hasScroll(h) ? h.scrollHeight : i, a.parentData = {
                element: h,
                left: r.left,
                top: r.top,
                width: o,
                height: u
            }))
        }, resize: function (t) {
            var n, r, i, s, o = e(this).resizable("instance"), u = o.options, a = o.containerOffset, f = o.position,
                l = o._aspectRatio || t.shiftKey, c = {top: 0, left: 0}, h = o.containerElement, p = !0;
            h[0] !== document && /static/.test(h.css("position")) && (c = a), f.left < (o._helper ? a.left : 0) && (o.size.width = o.size.width + (o._helper ? o.position.left - a.left : o.position.left - c.left), l && (o.size.height = o.size.width / o.aspectRatio, p = !1), o.position.left = u.helper ? a.left : 0), f.top < (o._helper ? a.top : 0) && (o.size.height = o.size.height + (o._helper ? o.position.top - a.top : o.position.top), l && (o.size.width = o.size.height * o.aspectRatio, p = !1), o.position.top = o._helper ? a.top : 0), i = o.containerElement.get(0) === o.element.parent().get(0), s = /relative|absolute/.test(o.containerElement.css("position")), i && s ? (o.offset.left = o.parentData.left + o.position.left, o.offset.top = o.parentData.top + o.position.top) : (o.offset.left = o.element.offset().left, o.offset.top = o.element.offset().top), n = Math.abs(o.sizeDiff.width + (o._helper ? o.offset.left - c.left : o.offset.left - a.left)), r = Math.abs(o.sizeDiff.height + (o._helper ? o.offset.top - c.top : o.offset.top - a.top)), n + o.size.width >= o.parentData.width && (o.size.width = o.parentData.width - n, l && (o.size.height = o.size.width / o.aspectRatio, p = !1)), r + o.size.height >= o.parentData.height && (o.size.height = o.parentData.height - r, l && (o.size.width = o.size.height * o.aspectRatio, p = !1)), p || (o.position.left = o.prevPosition.left, o.position.top = o.prevPosition.top, o.size.width = o.prevSize.width, o.size.height = o.prevSize.height)
        }, stop: function () {
            var t = e(this).resizable("instance"), n = t.options, r = t.containerOffset, i = t.containerPosition,
                s = t.containerElement, o = e(t.helper), u = o.offset(), a = o.outerWidth() - t.sizeDiff.width,
                f = o.outerHeight() - t.sizeDiff.height;
            t._helper && !n.animate && /relative/.test(s.css("position")) && e(this).css({
                left: u.left - i.left - r.left,
                width: a,
                height: f
            }), t._helper && !n.animate && /static/.test(s.css("position")) && e(this).css({
                left: u.left - i.left - r.left,
                width: a,
                height: f
            })
        }
    }), e.ui.plugin.add("resizable", "alsoResize", {
        start: function () {
            var t = e(this).resizable("instance"), n = t.options, r = function (t) {
                e(t).each(function () {
                    var t = e(this);
                    t.data("ui-resizable-alsoresize", {
                        width: parseInt(t.width(), 10),
                        height: parseInt(t.height(), 10),
                        left: parseInt(t.css("left"), 10),
                        top: parseInt(t.css("top"), 10)
                    })
                })
            };
            "object" != typeof n.alsoResize || n.alsoResize.parentNode ? r(n.alsoResize) : n.alsoResize.length ? (n.alsoResize = n.alsoResize[0], r(n.alsoResize)) : e.each(n.alsoResize, function (e) {
                r(e)
            })
        }, resize: function (t, n) {
            var r = e(this).resizable("instance"), i = r.options, s = r.originalSize, o = r.originalPosition, u = {
                height: r.size.height - s.height || 0,
                width: r.size.width - s.width || 0,
                top: r.position.top - o.top || 0,
                left: r.position.left - o.left || 0
            }, a = function (t, r) {
                e(t).each(function () {
                    var t = e(this), i = e(this).data("ui-resizable-alsoresize"), s = {},
                        o = r && r.length ? r : t.parents(n.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"];
                    e.each(o, function (e, t) {
                        var n = (i[t] || 0) + (u[t] || 0);
                        n && n >= 0 && (s[t] = n || null)
                    }), t.css(s)
                })
            };
            "object" != typeof i.alsoResize || i.alsoResize.nodeType ? a(i.alsoResize) : e.each(i.alsoResize, function (e, t) {
                a(e, t)
            })
        }, stop: function () {
            e(this).removeData("resizable-alsoresize")
        }
    }), e.ui.plugin.add("resizable", "ghost", {
        start: function () {
            var t = e(this).resizable("instance"), n = t.options, r = t.size;
            t.ghost = t.originalElement.clone(), t.ghost.css({
                opacity: .25,
                display: "block",
                position: "relative",
                height: r.height,
                width: r.width,
                margin: 0,
                left: 0,
                top: 0
            }).addClass("ui-resizable-ghost").addClass("string" == typeof n.ghost ? n.ghost : ""), t.ghost.appendTo(t.helper)
        }, resize: function () {
            var t = e(this).resizable("instance");
            t.ghost && t.ghost.css({position: "relative", height: t.size.height, width: t.size.width})
        }, stop: function () {
            var t = e(this).resizable("instance");
            t.ghost && t.helper && t.helper.get(0).removeChild(t.ghost.get(0))
        }
    }), e.ui.plugin.add("resizable", "grid", {
        resize: function () {
            var t, n = e(this).resizable("instance"), r = n.options, i = n.size, s = n.originalSize,
                o = n.originalPosition, u = n.axis, a = "number" == typeof r.grid ? [r.grid, r.grid] : r.grid,
                f = a[0] || 1, l = a[1] || 1, c = Math.round((i.width - s.width) / f) * f,
                h = Math.round((i.height - s.height) / l) * l, p = s.width + c, d = s.height + h,
                v = r.maxWidth && p > r.maxWidth, m = r.maxHeight && d > r.maxHeight, g = r.minWidth && r.minWidth > p,
                y = r.minHeight && r.minHeight > d;
            r.grid = a, g && (p += f), y && (d += l), v && (p -= f), m && (d -= l), /^(se|s|e)$/.test(u) ? (n.size.width = p, n.size.height = d) : /^(ne)$/.test(u) ? (n.size.width = p, n.size.height = d, n.position.top = o.top - h) : /^(sw)$/.test(u) ? (n.size.width = p, n.size.height = d, n.position.left = o.left - c) : ((0 >= d - l || 0 >= p - f) && (t = n._getPaddingPlusBorderDimensions(this)), d - l > 0 ? (n.size.height = d, n.position.top = o.top - h) : (d = l - t.height, n.size.height = d, n.position.top = o.top + s.height - d), p - f > 0 ? (n.size.width = p, n.position.left = o.left - c) : (p = f - t.width, n.size.width = p, n.position.left = o.left + s.width - p))
        }
    }), e.ui.resizable, e.widget("ui.dialog", {
        version: "1.11.3",
        options: {
            appendTo: "body",
            autoOpen: !0,
            buttons: [],
            closeOnEscape: !0,
            closeText: "Close",
            dialogClass: "",
            draggable: !0,
            hide: null,
            height: "auto",
            maxHeight: null,
            maxWidth: null,
            minHeight: 150,
            minWidth: 150,
            modal: !1,
            position: {
                my: "center", at: "center", of: window, collision: "fit", using: function (t) {
                    var n = e(this).css(t).offset().top;
                    0 > n && e(this).css("top", t.top - n)
                }
            },
            resizable: !0,
            show: null,
            title: null,
            width: 300,
            beforeClose: null,
            close: null,
            drag: null,
            dragStart: null,
            dragStop: null,
            focus: null,
            open: null,
            resize: null,
            resizeStart: null,
            resizeStop: null
        },
        sizeRelatedOptions: {
            buttons: !0,
            height: !0,
            maxHeight: !0,
            maxWidth: !0,
            minHeight: !0,
            minWidth: !0,
            width: !0
        },
        resizableRelatedOptions: {maxHeight: !0, maxWidth: !0, minHeight: !0, minWidth: !0},
        _create: function () {
            this.originalCss = {
                display: this.element[0].style.display,
                width: this.element[0].style.width,
                minHeight: this.element[0].style.minHeight,
                maxHeight: this.element[0].style.maxHeight,
                height: this.element[0].style.height
            }, this.originalPosition = {
                parent: this.element.parent(),
                index: this.element.parent().children().index(this.element)
            }, this.originalTitle = this.element.attr("title"), this.options.title = this.options.title || this.originalTitle, this._createWrapper(), this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog), this._createTitlebar(), this._createButtonPane(), this.options.draggable && e.fn.draggable && this._makeDraggable(), this.options.resizable && e.fn.resizable && this._makeResizable(), this._isOpen = !1, this._trackFocus()
        },
        _init: function () {
            this.options.autoOpen && this.open()
        },
        _appendTo: function () {
            var t = this.options.appendTo;
            return t && (t.jquery || t.nodeType) ? e(t) : this.document.find(t || "body").eq(0)
        },
        _destroy: function () {
            var e, t = this.originalPosition;
            this._destroyOverlay(), this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(), this.uiDialog.stop(!0, !0).remove(), this.originalTitle && this.element.attr("title", this.originalTitle), e = t.parent.children().eq(t.index), e.length && e[0] !== this.element[0] ? e.before(this.element) : t.parent.append(this.element)
        },
        widget: function () {
            return this.uiDialog
        },
        disable: e.noop,
        enable: e.noop,
        close: function (t) {
            var n, r = this;
            if (this._isOpen && this._trigger("beforeClose", t) !== !1) {
                if (this._isOpen = !1, this._focusedElement = null, this._destroyOverlay(), this._untrackInstance(), !this.opener.filter(":focusable").focus().length) try {
                    n = this.document[0].activeElement, n && "body" !== n.nodeName.toLowerCase() && e(n).blur()
                } catch (i) {
                }
                this._hide(this.uiDialog, this.options.hide, function () {
                    r._trigger("close", t)
                })
            }
        },
        isOpen: function () {
            return this._isOpen
        },
        moveToTop: function () {
            this._moveToTop()
        },
        _moveToTop: function (t, n) {
            var r = !1, i = this.uiDialog.siblings(".ui-front:visible").map(function () {
                return +e(this).css("z-index")
            }).get(), s = Math.max.apply(null, i);
            return s >= +this.uiDialog.css("z-index") && (this.uiDialog.css("z-index", s + 1), r = !0), r && !n && this._trigger("focus", t), r
        },
        open: function () {
            var t = this;
            return this._isOpen ? (this._moveToTop() && this._focusTabbable(), void 0) : (this._isOpen = !0, this.opener = e(this.document[0].activeElement), this._size(), this._position(), this._createOverlay(), this._moveToTop(null, !0), this.overlay && this.overlay.css("z-index", this.uiDialog.css("z-index") - 1), this._show(this.uiDialog, this.options.show, function () {
                t._focusTabbable(), t._trigger("focus")
            }), this._makeFocusTarget(), this._trigger("open"), void 0)
        },
        _focusTabbable: function () {
            var e = this._focusedElement;
            e || (e = this.element.find("[autofocus]")), e.length || (e = this.element.find(":tabbable")), e.length || (e = this.uiDialogButtonPane.find(":tabbable")), e.length || (e = this.uiDialogTitlebarClose.filter(":tabbable")), e.length || (e = this.uiDialog), e.eq(0).focus()
        },
        _keepFocus: function (t) {
            function n() {
                var t = this.document[0].activeElement, n = this.uiDialog[0] === t || e.contains(this.uiDialog[0], t);
                n || this._focusTabbable()
            }

            t.preventDefault(), n.call(this), this._delay(n)
        },
        _createWrapper: function () {
            this.uiDialog = e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front " + this.options.dialogClass).hide().attr({
                tabIndex: -1,
                role: "dialog"
            }).appendTo(this._appendTo()), this._on(this.uiDialog, {
                keydown: function (t) {
                    if (this.options.closeOnEscape && !t.isDefaultPrevented() && t.keyCode && t.keyCode === e.ui.keyCode.ESCAPE) return t.preventDefault(), this.close(t), void 0;
                    if (t.keyCode === e.ui.keyCode.TAB && !t.isDefaultPrevented()) {
                        var n = this.uiDialog.find(":tabbable"), r = n.filter(":first"), i = n.filter(":last");
                        t.target !== i[0] && t.target !== this.uiDialog[0] || t.shiftKey ? t.target !== r[0] && t.target !== this.uiDialog[0] || !t.shiftKey || (this._delay(function () {
                            i.focus()
                        }), t.preventDefault()) : (this._delay(function () {
                            r.focus()
                        }), t.preventDefault())
                    }
                }, mousedown: function (e) {
                    this._moveToTop(e) && this._focusTabbable()
                }
            }), this.element.find("[aria-describedby]").length || this.uiDialog.attr({"aria-describedby": this.element.uniqueId().attr("id")})
        },
        _createTitlebar: function () {
            var t;
            this.uiDialogTitlebar = e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog), this._on(this.uiDialogTitlebar, {
                mousedown: function (t) {
                    e(t.target).closest(".ui-dialog-titlebar-close") || this.uiDialog.focus()
                }
            }), this.uiDialogTitlebarClose = e("<button type='button'></button>").button({
                label: this.options.closeText,
                icons: {primary: "ui-icon-closethick"},
                text: !1
            }).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar), this._on(this.uiDialogTitlebarClose, {
                click: function (e) {
                    e.preventDefault(), this.close(e)
                }
            }), t = e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar), this._title(t), this.uiDialog.attr({"aria-labelledby": t.attr("id")})
        },
        _title: function (e) {
            this.options.title || e.html("&#160;"), e.text(this.options.title)
        },
        _createButtonPane: function () {
            this.uiDialogButtonPane = e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"), this.uiButtonSet = e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane), this._createButtons()
        },
        _createButtons: function () {
            var t = this, n = this.options.buttons;
            return this.uiDialogButtonPane.remove(), this.uiButtonSet.empty(), e.isEmptyObject(n) || e.isArray(n) && !n.length ? (this.uiDialog.removeClass("ui-dialog-buttons"), void 0) : (e.each(n, function (n, r) {
                var i, s;
                r = e.isFunction(r) ? {
                    click: r,
                    text: n
                } : r, r = e.extend({type: "button"}, r), i = r.click, r.click = function () {
                    i.apply(t.element[0], arguments)
                }, s = {
                    icons: r.icons,
                    text: r.showText
                }, delete r.icons, delete r.showText, e("<button></button>", r).button(s).appendTo(t.uiButtonSet)
            }), this.uiDialog.addClass("ui-dialog-buttons"), this.uiDialogButtonPane.appendTo(this.uiDialog), void 0)
        },
        _makeDraggable: function () {
            function t(e) {
                return {position: e.position, offset: e.offset}
            }

            var n = this, r = this.options;
            this.uiDialog.draggable({
                cancel: ".ui-dialog-content, .ui-dialog-titlebar-close",
                handle: ".ui-dialog-titlebar",
                containment: "document",
                start: function (r, i) {
                    e(this).addClass("ui-dialog-dragging"), n._blockFrames(), n._trigger("dragStart", r, t(i))
                },
                drag: function (e, r) {
                    n._trigger("drag", e, t(r))
                },
                stop: function (i, s) {
                    var o = s.offset.left - n.document.scrollLeft(), u = s.offset.top - n.document.scrollTop();
                    r.position = {
                        my: "left top",
                        at: "left" + (o >= 0 ? "+" : "") + o + " " + "top" + (u >= 0 ? "+" : "") + u,
                        of: n.window
                    }, e(this).removeClass("ui-dialog-dragging"), n._unblockFrames(), n._trigger("dragStop", i, t(s))
                }
            })
        },
        _makeResizable: function () {
            function t(e) {
                return {
                    originalPosition: e.originalPosition,
                    originalSize: e.originalSize,
                    position: e.position,
                    size: e.size
                }
            }

            var n = this, r = this.options, i = r.resizable, s = this.uiDialog.css("position"),
                o = "string" == typeof i ? i : "n,e,s,w,se,sw,ne,nw";
            this.uiDialog.resizable({
                cancel: ".ui-dialog-content",
                containment: "document",
                alsoResize: this.element,
                maxWidth: r.maxWidth,
                maxHeight: r.maxHeight,
                minWidth: r.minWidth,
                minHeight: this._minHeight(),
                handles: o,
                start: function (r, i) {
                    e(this).addClass("ui-dialog-resizing"), n._blockFrames(), n._trigger("resizeStart", r, t(i))
                },
                resize: function (e, r) {
                    n._trigger("resize", e, t(r))
                },
                stop: function (i, s) {
                    var o = n.uiDialog.offset(), u = o.left - n.document.scrollLeft(),
                        a = o.top - n.document.scrollTop();
                    r.height = n.uiDialog.height(), r.width = n.uiDialog.width(), r.position = {
                        my: "left top",
                        at: "left" + (u >= 0 ? "+" : "") + u + " " + "top" + (a >= 0 ? "+" : "") + a,
                        of: n.window
                    }, e(this).removeClass("ui-dialog-resizing"), n._unblockFrames(), n._trigger("resizeStop", i, t(s))
                }
            }).css("position", s)
        },
        _trackFocus: function () {
            this._on(this.widget(), {
                focusin: function (t) {
                    this._makeFocusTarget(), this._focusedElement = e(t.target)
                }
            })
        },
        _makeFocusTarget: function () {
            this._untrackInstance(), this._trackingInstances().unshift(this)
        },
        _untrackInstance: function () {
            var t = this._trackingInstances(), n = e.inArray(this, t);
            -1 !== n && t.splice(n, 1)
        },
        _trackingInstances: function () {
            var e = this.document.data("ui-dialog-instances");
            return e || (e = [], this.document.data("ui-dialog-instances", e)), e
        },
        _minHeight: function () {
            var e = this.options;
            return "auto" === e.height ? e.minHeight : Math.min(e.minHeight, e.height)
        },
        _position: function () {
            var e = this.uiDialog.is(":visible");
            e || this.uiDialog.show(), this.uiDialog.position(this.options.position), e || this.uiDialog.hide()
        },
        _setOptions: function (t) {
            var n = this, r = !1, i = {};
            e.each(t, function (e, t) {
                n._setOption(e, t), e in n.sizeRelatedOptions && (r = !0), e in n.resizableRelatedOptions && (i[e] = t)
            }), r && (this._size(), this._position()), this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", i)
        },
        _setOption: function (e, t) {
            var n, r, i = this.uiDialog;
            "dialogClass" === e && i.removeClass(this.options.dialogClass).addClass(t), "disabled" !== e && (this._super(e, t), "appendTo" === e && this.uiDialog.appendTo(this._appendTo()), "buttons" === e && this._createButtons(), "closeText" === e && this.uiDialogTitlebarClose.button({label: "" + t}), "draggable" === e && (n = i.is(":data(ui-draggable)"), n && !t && i.draggable("destroy"), !n && t && this._makeDraggable()), "position" === e && this._position(), "resizable" === e && (r = i.is(":data(ui-resizable)"), r && !t && i.resizable("destroy"), r && "string" == typeof t && i.resizable("option", "handles", t), r || t === !1 || this._makeResizable()), "title" === e && this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))
        },
        _size: function () {
            var e, t, n, r = this.options;
            this.element.show().css({
                width: "auto",
                minHeight: 0,
                maxHeight: "none",
                height: 0
            }), r.minWidth > r.width && (r.width = r.minWidth), e = this.uiDialog.css({
                height: "auto",
                width: r.width
            }).outerHeight(), t = Math.max(0, r.minHeight - e), n = "number" == typeof r.maxHeight ? Math.max(0, r.maxHeight - e) : "none", "auto" === r.height ? this.element.css({
                minHeight: t,
                maxHeight: n,
                height: "auto"
            }) : this.element.height(Math.max(0, r.height - e)), this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", "minHeight", this._minHeight())
        },
        _blockFrames: function () {
            this.iframeBlocks = this.document.find("iframe").map(function () {
                var t = e(this);
                return e("<div>").css({
                    position: "absolute",
                    width: t.outerWidth(),
                    height: t.outerHeight()
                }).appendTo(t.parent()).offset(t.offset())[0]
            })
        },
        _unblockFrames: function () {
            this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks)
        },
        _allowInteraction: function (t) {
            return e(t.target).closest(".ui-dialog").length ? !0 : !!e(t.target).closest(".ui-datepicker").length
        },
        _createOverlay: function () {
            if (this.options.modal) {
                var t = !0;
                this._delay(function () {
                    t = !1
                }), this.document.data("ui-dialog-overlays") || this._on(this.document, {
                    focusin: function (e) {
                        t || this._allowInteraction(e) || (e.preventDefault(), this._trackingInstances()[0]._focusTabbable())
                    }
                }), this.overlay = e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()), this._on(this.overlay, {mousedown: "_keepFocus"}), this.document.data("ui-dialog-overlays", (this.document.data("ui-dialog-overlays") || 0) + 1)
            }
        },
        _destroyOverlay: function () {
            if (this.options.modal && this.overlay) {
                var e = this.document.data("ui-dialog-overlays") - 1;
                e ? this.document.data("ui-dialog-overlays", e) : this.document.unbind("focusin").removeData("ui-dialog-overlays"), this.overlay.remove(), this.overlay = null
            }
        }
    }), e.widget("ui.droppable", {
        version: "1.11.3",
        widgetEventPrefix: "drop",
        options: {
            accept: "*",
            activeClass: !1,
            addClasses: !0,
            greedy: !1,
            hoverClass: !1,
            scope: "default",
            tolerance: "intersect",
            activate: null,
            deactivate: null,
            drop: null,
            out: null,
            over: null
        },
        _create: function () {
            var t, n = this.options, r = n.accept;
            this.isover = !1, this.isout = !0, this.accept = e.isFunction(r) ? r : function (e) {
                return e.is(r)
            }, this.proportions = function () {
                return arguments.length ? (t = arguments[0], void 0) : t ? t : t = {
                    width: this.element[0].offsetWidth,
                    height: this.element[0].offsetHeight
                }
            }, this._addToManager(n.scope), n.addClasses && this.element.addClass("ui-droppable")
        },
        _addToManager: function (t) {
            e.ui.ddmanager.droppables[t] = e.ui.ddmanager.droppables[t] || [], e.ui.ddmanager.droppables[t].push(this)
        },
        _splice: function (e) {
            for (var t = 0; e.length > t; t++) e[t] === this && e.splice(t, 1)
        },
        _destroy: function () {
            var t = e.ui.ddmanager.droppables[this.options.scope];
            this._splice(t), this.element.removeClass("ui-droppable ui-droppable-disabled")
        },
        _setOption: function (t, n) {
            if ("accept" === t) this.accept = e.isFunction(n) ? n : function (e) {
                return e.is(n)
            }; else if ("scope" === t) {
                var r = e.ui.ddmanager.droppables[this.options.scope];
                this._splice(r), this._addToManager(n)
            }
            this._super(t, n)
        },
        _activate: function (t) {
            var n = e.ui.ddmanager.current;
            this.options.activeClass && this.element.addClass(this.options.activeClass), n && this._trigger("activate", t, this.ui(n))
        },
        _deactivate: function (t) {
            var n = e.ui.ddmanager.current;
            this.options.activeClass && this.element.removeClass(this.options.activeClass), n && this._trigger("deactivate", t, this.ui(n))
        },
        _over: function (t) {
            var n = e.ui.ddmanager.current;
            n && (n.currentItem || n.element)[0] !== this.element[0] && this.accept.call(this.element[0], n.currentItem || n.element) && (this.options.hoverClass && this.element.addClass(this.options.hoverClass), this._trigger("over", t, this.ui(n)))
        },
        _out: function (t) {
            var n = e.ui.ddmanager.current;
            n && (n.currentItem || n.element)[0] !== this.element[0] && this.accept.call(this.element[0], n.currentItem || n.element) && (this.options.hoverClass && this.element.removeClass(this.options.hoverClass), this._trigger("out", t, this.ui(n)))
        },
        _drop: function (t, n) {
            var r = n || e.ui.ddmanager.current, i = !1;
            return r && (r.currentItem || r.element)[0] !== this.element[0] ? (this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function () {
                var n = e(this).droppable("instance");
                return n.options.greedy && !n.options.disabled && n.options.scope === r.options.scope && n.accept.call(n.element[0], r.currentItem || r.element) && e.ui.intersect(r, e.extend(n, {offset: n.element.offset()}), n.options.tolerance, t) ? (i = !0, !1) : void 0
            }), i ? !1 : this.accept.call(this.element[0], r.currentItem || r.element) ? (this.options.activeClass && this.element.removeClass(this.options.activeClass), this.options.hoverClass && this.element.removeClass(this.options.hoverClass), this._trigger("drop", t, this.ui(r)), this.element) : !1) : !1
        },
        ui: function (e) {
            return {
                draggable: e.currentItem || e.element,
                helper: e.helper,
                position: e.position,
                offset: e.positionAbs
            }
        }
    }), e.ui.intersect = function () {
        function e(e, t, n) {
            return e >= t && t + n > e
        }

        return function (t, n, r, i) {
            if (!n.offset) return !1;
            var s = (t.positionAbs || t.position.absolute).left + t.margins.left,
                o = (t.positionAbs || t.position.absolute).top + t.margins.top, u = s + t.helperProportions.width,
                a = o + t.helperProportions.height, f = n.offset.left, l = n.offset.top, c = f + n.proportions().width,
                h = l + n.proportions().height;
            switch (r) {
                case"fit":
                    return s >= f && c >= u && o >= l && h >= a;
                case"intersect":
                    return s + t.helperProportions.width / 2 > f && c > u - t.helperProportions.width / 2 && o + t.helperProportions.height / 2 > l && h > a - t.helperProportions.height / 2;
                case"pointer":
                    return e(i.pageY, l, n.proportions().height) && e(i.pageX, f, n.proportions().width);
                case"touch":
                    return (o >= l && h >= o || a >= l && h >= a || l > o && a > h) && (s >= f && c >= s || u >= f && c >= u || f > s && u > c);
                default:
                    return !1
            }
        }
    }(), e.ui.ddmanager = {
        current: null, droppables: {"default": []}, prepareOffsets: function (t, n) {
            var r, i, s = e.ui.ddmanager.droppables[t.options.scope] || [], o = n ? n.type : null,
                u = (t.currentItem || t.element).find(":data(ui-droppable)").addBack();
            e:for (r = 0; s.length > r; r++) if (!(s[r].options.disabled || t && !s[r].accept.call(s[r].element[0], t.currentItem || t.element))) {
                for (i = 0; u.length > i; i++) if (u[i] === s[r].element[0]) {
                    s[r].proportions().height = 0;
                    continue e
                }
                s[r].visible = "none" !== s[r].element.css("display"), s[r].visible && ("mousedown" === o && s[r]._activate.call(s[r], n), s[r].offset = s[r].element.offset(), s[r].proportions({
                    width: s[r].element[0].offsetWidth,
                    height: s[r].element[0].offsetHeight
                }))
            }
        }, drop: function (t, n) {
            var r = !1;
            return e.each((e.ui.ddmanager.droppables[t.options.scope] || []).slice(), function () {
                this.options && (!this.options.disabled && this.visible && e.ui.intersect(t, this, this.options.tolerance, n) && (r = this._drop.call(this, n) || r), !this.options.disabled && this.visible && this.accept.call(this.element[0], t.currentItem || t.element) && (this.isout = !0, this.isover = !1, this._deactivate.call(this, n)))
            }), r
        }, dragStart: function (t, n) {
            t.element.parentsUntil("body").bind("scroll.droppable", function () {
                t.options.refreshPositions || e.ui.ddmanager.prepareOffsets(t, n)
            })
        }, drag: function (t, n) {
            t.options.refreshPositions && e.ui.ddmanager.prepareOffsets(t, n), e.each(e.ui.ddmanager.droppables[t.options.scope] || [], function () {
                if (!this.options.disabled && !this.greedyChild && this.visible) {
                    var r, i, s, o = e.ui.intersect(t, this, this.options.tolerance, n),
                        u = !o && this.isover ? "isout" : o && !this.isover ? "isover" : null;
                    u && (this.options.greedy && (i = this.options.scope, s = this.element.parents(":data(ui-droppable)").filter(function () {
                        return e(this).droppable("instance").options.scope === i
                    }), s.length && (r = e(s[0]).droppable("instance"), r.greedyChild = "isover" === u)), r && "isover" === u && (r.isover = !1, r.isout = !0, r._out.call(r, n)), this[u] = !0, this["isout" === u ? "isover" : "isout"] = !1, this["isover" === u ? "_over" : "_out"].call(this, n), r && "isout" === u && (r.isout = !1, r.isover = !0, r._over.call(r, n)))
                }
            })
        }, dragStop: function (t, n) {
            t.element.parentsUntil("body").unbind("scroll.droppable"), t.options.refreshPositions || e.ui.ddmanager.prepareOffsets(t, n)
        }
    }, e.ui.droppable;
    var y = "ui-effects-", b = e;
    e.effects = {effect: {}}, function (e, t) {
        function n(e, t, n) {
            var r = c[t.type] || {};
            return null == e ? n || !t.def ? null : t.def : (e = r.floor ? ~~e : parseFloat(e), isNaN(e) ? t.def : r.mod ? (e + r.mod) % r.mod : 0 > e ? 0 : e > r.max ? r.max : e)
        }

        function r(n) {
            var r = f(), i = r._rgba = [];
            return n = n.toLowerCase(), d(a, function (e, s) {
                var o, u = s.re.exec(n), a = u && s.parse(u), f = s.space || "rgba";
                return a ? (o = r[f](a), r[l[f].cache] = o[l[f].cache], i = r._rgba = o._rgba, !1) : t
            }), i.length ? ("0,0,0,0" === i.join() && e.extend(i, s.transparent), r) : s[n]
        }

        function i(e, t, n) {
            return n = (n + 1) % 1, 1 > 6 * n ? e + 6 * (t - e) * n : 1 > 2 * n ? t : 2 > 3 * n ? e + 6 * (t - e) * (2 / 3 - n) : e
        }

        var s,
            o = "backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",
            u = /^([\-+])=\s*(\d+\.?\d*)/, a = [{
                re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function (e) {
                    return [e[1], e[2], e[3], e[4]]
                }
            }, {
                re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function (e) {
                    return [2.55 * e[1], 2.55 * e[2], 2.55 * e[3], e[4]]
                }
            }, {
                re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/, parse: function (e) {
                    return [parseInt(e[1], 16), parseInt(e[2], 16), parseInt(e[3], 16)]
                }
            }, {
                re: /#([a-f0-9])([a-f0-9])([a-f0-9])/, parse: function (e) {
                    return [parseInt(e[1] + e[1], 16), parseInt(e[2] + e[2], 16), parseInt(e[3] + e[3], 16)]
                }
            }, {
                re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                space: "hsla",
                parse: function (e) {
                    return [e[1], e[2] / 100, e[3] / 100, e[4]]
                }
            }], f = e.Color = function (t, n, r, i) {
                return new e.Color.fn.parse(t, n, r, i)
            }, l = {
                rgba: {
                    props: {
                        red: {idx: 0, type: "byte"},
                        green: {idx: 1, type: "byte"},
                        blue: {idx: 2, type: "byte"}
                    }
                },
                hsla: {
                    props: {
                        hue: {idx: 0, type: "degrees"},
                        saturation: {idx: 1, type: "percent"},
                        lightness: {idx: 2, type: "percent"}
                    }
                }
            }, c = {"byte": {floor: !0, max: 255}, percent: {max: 1}, degrees: {mod: 360, floor: !0}}, h = f.support = {},
            p = e("<p>")[0], d = e.each;
        p.style.cssText = "background-color:rgba(1,1,1,.5)", h.rgba = p.style.backgroundColor.indexOf("rgba") > -1, d(l, function (e, t) {
            t.cache = "_" + e, t.props.alpha = {idx: 3, type: "percent", def: 1}
        }), f.fn = e.extend(f.prototype, {
            parse: function (i, o, u, a) {
                if (i === t) return this._rgba = [null, null, null, null], this;
                (i.jquery || i.nodeType) && (i = e(i).css(o), o = t);
                var c = this, h = e.type(i), p = this._rgba = [];
                return o !== t && (i = [i, o, u, a], h = "array"), "string" === h ? this.parse(r(i) || s._default) : "array" === h ? (d(l.rgba.props, function (e, t) {
                    p[t.idx] = n(i[t.idx], t)
                }), this) : "object" === h ? (i instanceof f ? d(l, function (e, t) {
                    i[t.cache] && (c[t.cache] = i[t.cache].slice())
                }) : d(l, function (t, r) {
                    var s = r.cache;
                    d(r.props, function (e, t) {
                        if (!c[s] && r.to) {
                            if ("alpha" === e || null == i[e]) return;
                            c[s] = r.to(c._rgba)
                        }
                        c[s][t.idx] = n(i[e], t, !0)
                    }), c[s] && 0 > e.inArray(null, c[s].slice(0, 3)) && (c[s][3] = 1, r.from && (c._rgba = r.from(c[s])))
                }), this) : t
            }, is: function (e) {
                var n = f(e), r = !0, i = this;
                return d(l, function (e, s) {
                    var o, u = n[s.cache];
                    return u && (o = i[s.cache] || s.to && s.to(i._rgba) || [], d(s.props, function (e, n) {
                        return null != u[n.idx] ? r = u[n.idx] === o[n.idx] : t
                    })), r
                }), r
            }, _space: function () {
                var e = [], t = this;
                return d(l, function (n, r) {
                    t[r.cache] && e.push(n)
                }), e.pop()
            }, transition: function (e, t) {
                var r = f(e), i = r._space(), s = l[i], o = 0 === this.alpha() ? f("transparent") : this,
                    u = o[s.cache] || s.to(o._rgba), a = u.slice();
                return r = r[s.cache], d(s.props, function (e, i) {
                    var s = i.idx, o = u[s], f = r[s], l = c[i.type] || {};
                    null !== f && (null === o ? a[s] = f : (l.mod && (f - o > l.mod / 2 ? o += l.mod : o - f > l.mod / 2 && (o -= l.mod)), a[s] = n((f - o) * t + o, i)))
                }), this[i](a)
            }, blend: function (t) {
                if (1 === this._rgba[3]) return this;
                var n = this._rgba.slice(), r = n.pop(), i = f(t)._rgba;
                return f(e.map(n, function (e, t) {
                    return (1 - r) * i[t] + r * e
                }))
            }, toRgbaString: function () {
                var t = "rgba(", n = e.map(this._rgba, function (e, t) {
                    return null == e ? t > 2 ? 1 : 0 : e
                });
                return 1 === n[3] && (n.pop(), t = "rgb("), t + n.join() + ")"
            }, toHslaString: function () {
                var t = "hsla(", n = e.map(this.hsla(), function (e, t) {
                    return null == e && (e = t > 2 ? 1 : 0), t && 3 > t && (e = Math.round(100 * e) + "%"), e
                });
                return 1 === n[3] && (n.pop(), t = "hsl("), t + n.join() + ")"
            }, toHexString: function (t) {
                var n = this._rgba.slice(), r = n.pop();
                return t && n.push(~~(255 * r)), "#" + e.map(n, function (e) {
                    return e = (e || 0).toString(16), 1 === e.length ? "0" + e : e
                }).join("")
            }, toString: function () {
                return 0 === this._rgba[3] ? "transparent" : this.toRgbaString()
            }
        }), f.fn.parse.prototype = f.fn, l.hsla.to = function (e) {
            if (null == e[0] || null == e[1] || null == e[2]) return [null, null, null, e[3]];
            var t, n, r = e[0] / 255, i = e[1] / 255, s = e[2] / 255, o = e[3], u = Math.max(r, i, s),
                a = Math.min(r, i, s), f = u - a, l = u + a, c = .5 * l;
            return t = a === u ? 0 : r === u ? 60 * (i - s) / f + 360 : i === u ? 60 * (s - r) / f + 120 : 60 * (r - i) / f + 240, n = 0 === f ? 0 : .5 >= c ? f / l : f / (2 - l), [Math.round(t) % 360, n, c, null == o ? 1 : o]
        }, l.hsla.from = function (e) {
            if (null == e[0] || null == e[1] || null == e[2]) return [null, null, null, e[3]];
            var t = e[0] / 360, n = e[1], r = e[2], s = e[3], o = .5 >= r ? r * (1 + n) : r + n - r * n, u = 2 * r - o;
            return [Math.round(255 * i(u, o, t + 1 / 3)), Math.round(255 * i(u, o, t)), Math.round(255 * i(u, o, t - 1 / 3)), s]
        }, d(l, function (r, i) {
            var s = i.props, o = i.cache, a = i.to, l = i.from;
            f.fn[r] = function (r) {
                if (a && !this[o] && (this[o] = a(this._rgba)), r === t) return this[o].slice();
                var i, u = e.type(r), c = "array" === u || "object" === u ? r : arguments, h = this[o].slice();
                return d(s, function (e, t) {
                    var r = c["object" === u ? e : t.idx];
                    null == r && (r = h[t.idx]), h[t.idx] = n(r, t)
                }), l ? (i = f(l(h)), i[o] = h, i) : f(h)
            }, d(s, function (t, n) {
                f.fn[t] || (f.fn[t] = function (i) {
                    var s, o = e.type(i), a = "alpha" === t ? this._hsla ? "hsla" : "rgba" : r, f = this[a](),
                        l = f[n.idx];
                    return "undefined" === o ? l : ("function" === o && (i = i.call(this, l), o = e.type(i)), null == i && n.empty ? this : ("string" === o && (s = u.exec(i), s && (i = l + parseFloat(s[2]) * ("+" === s[1] ? 1 : -1))), f[n.idx] = i, this[a](f)))
                })
            })
        }), f.hook = function (t) {
            var n = t.split(" ");
            d(n, function (t, n) {
                e.cssHooks[n] = {
                    set: function (t, i) {
                        var s, o, u = "";
                        if ("transparent" !== i && ("string" !== e.type(i) || (s = r(i)))) {
                            if (i = f(s || i), !h.rgba && 1 !== i._rgba[3]) {
                                for (o = "backgroundColor" === n ? t.parentNode : t; ("" === u || "transparent" === u) && o && o.style;) try {
                                    u = e.css(o, "backgroundColor"), o = o.parentNode
                                } catch (a) {
                                }
                                i = i.blend(u && "transparent" !== u ? u : "_default")
                            }
                            i = i.toRgbaString()
                        }
                        try {
                            t.style[n] = i
                        } catch (a) {
                        }
                    }
                }, e.fx.step[n] = function (t) {
                    t.colorInit || (t.start = f(t.elem, n), t.end = f(t.end), t.colorInit = !0), e.cssHooks[n].set(t.elem, t.start.transition(t.end, t.pos))
                }
            })
        }, f.hook(o), e.cssHooks.borderColor = {
            expand: function (e) {
                var t = {};
                return d(["Top", "Right", "Bottom", "Left"], function (n, r) {
                    t["border" + r + "Color"] = e
                }), t
            }
        }, s = e.Color.names = {
            aqua: "#00ffff",
            black: "#000000",
            blue: "#0000ff",
            fuchsia: "#ff00ff",
            gray: "#808080",
            green: "#008000",
            lime: "#00ff00",
            maroon: "#800000",
            navy: "#000080",
            olive: "#808000",
            purple: "#800080",
            red: "#ff0000",
            silver: "#c0c0c0",
            teal: "#008080",
            white: "#ffffff",
            yellow: "#ffff00",
            transparent: [null, null, null, 0],
            _default: "#ffffff"
        }
    }(b), function () {
        function t(t) {
            var n, r,
                i = t.ownerDocument.defaultView ? t.ownerDocument.defaultView.getComputedStyle(t, null) : t.currentStyle,
                s = {};
            if (i && i.length && i[0] && i[i[0]]) for (r = i.length; r--;) n = i[r], "string" == typeof i[n] && (s[e.camelCase(n)] = i[n]); else for (n in i) "string" == typeof i[n] && (s[n] = i[n]);
            return s
        }

        function n(t, n) {
            var r, s, o = {};
            for (r in n) s = n[r], t[r] !== s && (i[r] || (e.fx.step[r] || !isNaN(parseFloat(s))) && (o[r] = s));
            return o
        }

        var r = ["add", "remove", "toggle"], i = {
            border: 1,
            borderBottom: 1,
            borderColor: 1,
            borderLeft: 1,
            borderRight: 1,
            borderTop: 1,
            borderWidth: 1,
            margin: 1,
            padding: 1
        };
        e.each(["borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle"], function (t, n) {
            e.fx.step[n] = function (e) {
                ("none" !== e.end && !e.setAttr || 1 === e.pos && !e.setAttr) && (b.style(e.elem, n, e.end), e.setAttr = !0)
            }
        }), e.fn.addBack || (e.fn.addBack = function (e) {
            return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
        }), e.effects.animateClass = function (i, s, o, u) {
            var a = e.speed(s, o, u);
            return this.queue(function () {
                var s, o = e(this), u = o.attr("class") || "", f = a.children ? o.find("*").addBack() : o;
                f = f.map(function () {
                    var n = e(this);
                    return {el: n, start: t(this)}
                }), s = function () {
                    e.each(r, function (e, t) {
                        i[t] && o[t + "Class"](i[t])
                    })
                }, s(), f = f.map(function () {
                    return this.end = t(this.el[0]), this.diff = n(this.start, this.end), this
                }), o.attr("class", u), f = f.map(function () {
                    var t = this, n = e.Deferred(), r = e.extend({}, a, {
                        queue: !1, complete: function () {
                            n.resolve(t)
                        }
                    });
                    return this.el.animate(this.diff, r), n.promise()
                }), e.when.apply(e, f.get()).done(function () {
                    s(), e.each(arguments, function () {
                        var t = this.el;
                        e.each(this.diff, function (e) {
                            t.css(e, "")
                        })
                    }), a.complete.call(o[0])
                })
            })
        }, e.fn.extend({
            addClass: function (t) {
                return function (n, r, i, s) {
                    return r ? e.effects.animateClass.call(this, {add: n}, r, i, s) : t.apply(this, arguments)
                }
            }(e.fn.addClass), removeClass: function (t) {
                return function (n, r, i, s) {
                    return arguments.length > 1 ? e.effects.animateClass.call(this, {remove: n}, r, i, s) : t.apply(this, arguments)
                }
            }(e.fn.removeClass), toggleClass: function (t) {
                return function (n, r, i, s, o) {
                    return "boolean" == typeof r || void 0 === r ? i ? e.effects.animateClass.call(this, r ? {add: n} : {remove: n}, i, s, o) : t.apply(this, arguments) : e.effects.animateClass.call(this, {toggle: n}, r, i, s)
                }
            }(e.fn.toggleClass), switchClass: function (t, n, r, i, s) {
                return e.effects.animateClass.call(this, {add: n, remove: t}, r, i, s)
            }
        })
    }(), function () {
        function t(t, n, r, i) {
            return e.isPlainObject(t) && (n = t, t = t.effect), t = {effect: t}, null == n && (n = {}), e.isFunction(n) && (i = n, r = null, n = {}), ("number" == typeof n || e.fx.speeds[n]) && (i = r, r = n, n = {}), e.isFunction(r) && (i = r, r = null), n && e.extend(t, n), r = r || n.duration, t.duration = e.fx.off ? 0 : "number" == typeof r ? r : r in e.fx.speeds ? e.fx.speeds[r] : e.fx.speeds._default, t.complete = i || n.complete, t
        }

        function n(t) {
            return !t || "number" == typeof t || e.fx.speeds[t] ? !0 : "string" != typeof t || e.effects.effect[t] ? e.isFunction(t) ? !0 : "object" != typeof t || t.effect ? !1 : !0 : !0
        }

        e.extend(e.effects, {
            version: "1.11.3", save: function (e, t) {
                for (var n = 0; t.length > n; n++) null !== t[n] && e.data(y + t[n], e[0].style[t[n]])
            }, restore: function (e, t) {
                var n, r;
                for (r = 0; t.length > r; r++) null !== t[r] && (n = e.data(y + t[r]), void 0 === n && (n = ""), e.css(t[r], n))
            }, setMode: function (e, t) {
                return "toggle" === t && (t = e.is(":hidden") ? "show" : "hide"), t
            }, getBaseline: function (e, t) {
                var n, r;
                switch (e[0]) {
                    case"top":
                        n = 0;
                        break;
                    case"middle":
                        n = .5;
                        break;
                    case"bottom":
                        n = 1;
                        break;
                    default:
                        n = e[0] / t.height
                }
                switch (e[1]) {
                    case"left":
                        r = 0;
                        break;
                    case"center":
                        r = .5;
                        break;
                    case"right":
                        r = 1;
                        break;
                    default:
                        r = e[1] / t.width
                }
                return {x: r, y: n}
            }, createWrapper: function (t) {
                if (t.parent().is(".ui-effects-wrapper")) return t.parent();
                var n = {width: t.outerWidth(!0), height: t.outerHeight(!0), "float": t.css("float")},
                    r = e("<div></div>").addClass("ui-effects-wrapper").css({
                        fontSize: "100%",
                        background: "transparent",
                        border: "none",
                        margin: 0,
                        padding: 0
                    }), i = {width: t.width(), height: t.height()}, s = document.activeElement;
                try {
                    s.id
                } catch (o) {
                    s = document.body
                }
                return t.wrap(r), (t[0] === s || e.contains(t[0], s)) && e(s).focus(), r = t.parent(), "static" === t.css("position") ? (r.css({position: "relative"}), t.css({position: "relative"})) : (e.extend(n, {
                    position: t.css("position"),
                    zIndex: t.css("z-index")
                }), e.each(["top", "left", "bottom", "right"], function (e, r) {
                    n[r] = t.css(r), isNaN(parseInt(n[r], 10)) && (n[r] = "auto")
                }), t.css({
                    position: "relative",
                    top: 0,
                    left: 0,
                    right: "auto",
                    bottom: "auto"
                })), t.css(i), r.css(n).show()
            }, removeWrapper: function (t) {
                var n = document.activeElement;
                return t.parent().is(".ui-effects-wrapper") && (t.parent().replaceWith(t), (t[0] === n || e.contains(t[0], n)) && e(n).focus()), t
            }, setTransition: function (t, n, r, i) {
                return i = i || {}, e.each(n, function (e, n) {
                    var s = t.cssUnit(n);
                    s[0] > 0 && (i[n] = s[0] * r + s[1])
                }), i
            }
        }), e.fn.extend({
            effect: function () {
                function n(t) {
                    function n() {
                        e.isFunction(s) && s.call(i[0]), e.isFunction(t) && t()
                    }

                    var i = e(this), s = r.complete, u = r.mode;
                    (i.is(":hidden") ? "hide" === u : "show" === u) ? (i[u](), n()) : o.call(i[0], r, n)
                }

                var r = t.apply(this, arguments), i = r.mode, s = r.queue, o = e.effects.effect[r.effect];
                return e.fx.off || !o ? i ? this[i](r.duration, r.complete) : this.each(function () {
                    r.complete && r.complete.call(this)
                }) : s === !1 ? this.each(n) : this.queue(s || "fx", n)
            }, show: function (e) {
                return function (r) {
                    if (n(r)) return e.apply(this, arguments);
                    var i = t.apply(this, arguments);
                    return i.mode = "show", this.effect.call(this, i)
                }
            }(e.fn.show), hide: function (e) {
                return function (r) {
                    if (n(r)) return e.apply(this, arguments);
                    var i = t.apply(this, arguments);
                    return i.mode = "hide", this.effect.call(this, i)
                }
            }(e.fn.hide), toggle: function (e) {
                return function (r) {
                    if (n(r) || "boolean" == typeof r) return e.apply(this, arguments);
                    var i = t.apply(this, arguments);
                    return i.mode = "toggle", this.effect.call(this, i)
                }
            }(e.fn.toggle), cssUnit: function (t) {
                var n = this.css(t), r = [];
                return e.each(["em", "px", "%", "pt"], function (e, t) {
                    n.indexOf(t) > 0 && (r = [parseFloat(n), t])
                }), r
            }
        })
    }(), function () {
        var t = {};
        e.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], function (e, n) {
            t[n] = function (t) {
                return Math.pow(t, e + 2)
            }
        }), e.extend(t, {
            Sine: function (e) {
                return 1 - Math.cos(e * Math.PI / 2)
            }, Circ: function (e) {
                return 1 - Math.sqrt(1 - e * e)
            }, Elastic: function (e) {
                return 0 === e || 1 === e ? e : -Math.pow(2, 8 * (e - 1)) * Math.sin((80 * (e - 1) - 7.5) * Math.PI / 15)
            }, Back: function (e) {
                return e * e * (3 * e - 2)
            }, Bounce: function (e) {
                for (var t, n = 4; ((t = Math.pow(2, --n)) - 1) / 11 > e;) ;
                return 1 / Math.pow(4, 3 - n) - 7.5625 * Math.pow((3 * t - 2) / 22 - e, 2)
            }
        }), e.each(t, function (t, n) {
            e.easing["easeIn" + t] = n, e.easing["easeOut" + t] = function (e) {
                return 1 - n(1 - e)
            }, e.easing["easeInOut" + t] = function (e) {
                return .5 > e ? n(2 * e) / 2 : 1 - n(-2 * e + 2) / 2
            }
        })
    }(), e.effects, e.effects.effect.blind = function (t, n) {
        var r, i, s, o = e(this), u = /up|down|vertical/, a = /up|left|vertical|horizontal/,
            f = ["position", "top", "bottom", "left", "right", "height", "width"],
            l = e.effects.setMode(o, t.mode || "hide"), c = t.direction || "up", h = u.test(c),
            p = h ? "height" : "width", d = h ? "top" : "left", v = a.test(c), m = {}, g = "show" === l;
        o.parent().is(".ui-effects-wrapper") ? e.effects.save(o.parent(), f) : e.effects.save(o, f), o.show(), r = e.effects.createWrapper(o).css({overflow: "hidden"}), i = r[p](), s = parseFloat(r.css(d)) || 0, m[p] = g ? i : 0, v || (o.css(h ? "bottom" : "right", 0).css(h ? "top" : "left", "auto").css({position: "absolute"}), m[d] = g ? s : i + s), g && (r.css(p, 0), v || r.css(d, s + i)), r.animate(m, {
            duration: t.duration,
            easing: t.easing,
            queue: !1,
            complete: function () {
                "hide" === l && o.hide(), e.effects.restore(o, f), e.effects.removeWrapper(o), n()
            }
        })
    }, e.effects.effect.bounce = function (t, n) {
        var r, i, s, o = e(this), u = ["position", "top", "bottom", "left", "right", "height", "width"],
            a = e.effects.setMode(o, t.mode || "effect"), f = "hide" === a, l = "show" === a, c = t.direction || "up",
            h = t.distance, p = t.times || 5, d = 2 * p + (l || f ? 1 : 0), v = t.duration / d, m = t.easing,
            g = "up" === c || "down" === c ? "top" : "left", y = "up" === c || "left" === c, b = o.queue(),
            w = b.length;
        for ((l || f) && u.push("opacity"), e.effects.save(o, u), o.show(), e.effects.createWrapper(o), h || (h = o["top" === g ? "outerHeight" : "outerWidth"]() / 3), l && (s = {opacity: 1}, s[g] = 0, o.css("opacity", 0).css(g, y ? 2 * -h : 2 * h).animate(s, v, m)), f && (h /= Math.pow(2, p - 1)), s = {}, s[g] = 0, r = 0; p > r; r++) i = {}, i[g] = (y ? "-=" : "+=") + h, o.animate(i, v, m).animate(s, v, m), h = f ? 2 * h : h / 2;
        f && (i = {opacity: 0}, i[g] = (y ? "-=" : "+=") + h, o.animate(i, v, m)), o.queue(function () {
            f && o.hide(), e.effects.restore(o, u), e.effects.removeWrapper(o), n()
        }), w > 1 && b.splice.apply(b, [1, 0].concat(b.splice(w, d + 1))), o.dequeue()
    }, e.effects.effect.clip = function (t, n) {
        var r, i, s, o = e(this), u = ["position", "top", "bottom", "left", "right", "height", "width"],
            a = e.effects.setMode(o, t.mode || "hide"), f = "show" === a, l = t.direction || "vertical",
            c = "vertical" === l, h = c ? "height" : "width", p = c ? "top" : "left", d = {};
        e.effects.save(o, u), o.show(), r = e.effects.createWrapper(o).css({overflow: "hidden"}), i = "IMG" === o[0].tagName ? r : o, s = i[h](), f && (i.css(h, 0), i.css(p, s / 2)), d[h] = f ? s : 0, d[p] = f ? 0 : s / 2, i.animate(d, {
            queue: !1,
            duration: t.duration,
            easing: t.easing,
            complete: function () {
                f || o.hide(), e.effects.restore(o, u), e.effects.removeWrapper(o), n()
            }
        })
    }, e.effects.effect.drop = function (t, n) {
        var r, i = e(this), s = ["position", "top", "bottom", "left", "right", "opacity", "height", "width"],
            o = e.effects.setMode(i, t.mode || "hide"), u = "show" === o, a = t.direction || "left",
            f = "up" === a || "down" === a ? "top" : "left", l = "up" === a || "left" === a ? "pos" : "neg",
            c = {opacity: u ? 1 : 0};
        e.effects.save(i, s), i.show(), e.effects.createWrapper(i), r = t.distance || i["top" === f ? "outerHeight" : "outerWidth"](!0) / 2, u && i.css("opacity", 0).css(f, "pos" === l ? -r : r), c[f] = (u ? "pos" === l ? "+=" : "-=" : "pos" === l ? "-=" : "+=") + r, i.animate(c, {
            queue: !1,
            duration: t.duration,
            easing: t.easing,
            complete: function () {
                "hide" === o && i.hide(), e.effects.restore(i, s), e.effects.removeWrapper(i), n()
            }
        })
    }, e.effects.effect.explode = function (t, n) {
        function r() {
            b.push(this), b.length === c * h && i()
        }

        function i() {
            p.css({visibility: "visible"}), e(b).remove(), v || p.hide(), n()
        }

        var s, o, u, a, f, l, c = t.pieces ? Math.round(Math.sqrt(t.pieces)) : 3, h = c, p = e(this),
            d = e.effects.setMode(p, t.mode || "hide"), v = "show" === d,
            m = p.show().css("visibility", "hidden").offset(), g = Math.ceil(p.outerWidth() / h),
            y = Math.ceil(p.outerHeight() / c), b = [];
        for (s = 0; c > s; s++) for (a = m.top + s * y, l = s - (c - 1) / 2, o = 0; h > o; o++) u = m.left + o * g, f = o - (h - 1) / 2, p.clone().appendTo("body").wrap("<div></div>").css({
            position: "absolute",
            visibility: "visible",
            left: -o * g,
            top: -s * y
        }).parent().addClass("ui-effects-explode").css({
            position: "absolute",
            overflow: "hidden",
            width: g,
            height: y,
            left: u + (v ? f * g : 0),
            top: a + (v ? l * y : 0),
            opacity: v ? 0 : 1
        }).animate({
            left: u + (v ? 0 : f * g),
            top: a + (v ? 0 : l * y),
            opacity: v ? 1 : 0
        }, t.duration || 500, t.easing, r)
    }, e.effects.effect.fade = function (t, n) {
        var r = e(this), i = e.effects.setMode(r, t.mode || "toggle");
        r.animate({opacity: i}, {queue: !1, duration: t.duration, easing: t.easing, complete: n})
    }, e.effects.effect.fold = function (t, n) {
        var r, i, s = e(this), o = ["position", "top", "bottom", "left", "right", "height", "width"],
            u = e.effects.setMode(s, t.mode || "hide"), a = "show" === u, f = "hide" === u, l = t.size || 15,
            c = /([0-9]+)%/.exec(l), h = !!t.horizFirst, p = a !== h, d = p ? ["width", "height"] : ["height", "width"],
            v = t.duration / 2, m = {}, g = {};
        e.effects.save(s, o), s.show(), r = e.effects.createWrapper(s).css({overflow: "hidden"}), i = p ? [r.width(), r.height()] : [r.height(), r.width()], c && (l = parseInt(c[1], 10) / 100 * i[f ? 0 : 1]), a && r.css(h ? {
            height: 0,
            width: l
        } : {
            height: l,
            width: 0
        }), m[d[0]] = a ? i[0] : l, g[d[1]] = a ? i[1] : 0, r.animate(m, v, t.easing).animate(g, v, t.easing, function () {
            f && s.hide(), e.effects.restore(s, o), e.effects.removeWrapper(s), n()
        })
    }, e.effects.effect.highlight = function (t, n) {
        var r = e(this), i = ["backgroundImage", "backgroundColor", "opacity"],
            s = e.effects.setMode(r, t.mode || "show"), o = {backgroundColor: r.css("backgroundColor")};
        "hide" === s && (o.opacity = 0), e.effects.save(r, i), r.show().css({
            backgroundImage: "none",
            backgroundColor: t.color || "#ffff99"
        }).animate(o, {
            queue: !1, duration: t.duration, easing: t.easing, complete: function () {
                "hide" === s && r.hide(), e.effects.restore(r, i), n()
            }
        })
    }, e.effects.effect.size = function (t, n) {
        var r, i, s, o = e(this),
            u = ["position", "top", "bottom", "left", "right", "width", "height", "overflow", "opacity"],
            a = ["position", "top", "bottom", "left", "right", "overflow", "opacity"],
            f = ["width", "height", "overflow"], l = ["fontSize"],
            c = ["borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom"],
            h = ["borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight"],
            p = e.effects.setMode(o, t.mode || "effect"), d = t.restore || "effect" !== p, v = t.scale || "both",
            m = t.origin || ["middle", "center"], g = o.css("position"), y = d ? u : a,
            b = {height: 0, width: 0, outerHeight: 0, outerWidth: 0};
        "show" === p && o.show(), r = {
            height: o.height(),
            width: o.width(),
            outerHeight: o.outerHeight(),
            outerWidth: o.outerWidth()
        }, "toggle" === t.mode && "show" === p ? (o.from = t.to || b, o.to = t.from || r) : (o.from = t.from || ("show" === p ? b : r), o.to = t.to || ("hide" === p ? b : r)), s = {
            from: {
                y: o.from.height / r.height,
                x: o.from.width / r.width
            }, to: {y: o.to.height / r.height, x: o.to.width / r.width}
        }, ("box" === v || "both" === v) && (s.from.y !== s.to.y && (y = y.concat(c), o.from = e.effects.setTransition(o, c, s.from.y, o.from), o.to = e.effects.setTransition(o, c, s.to.y, o.to)), s.from.x !== s.to.x && (y = y.concat(h), o.from = e.effects.setTransition(o, h, s.from.x, o.from), o.to = e.effects.setTransition(o, h, s.to.x, o.to))), ("content" === v || "both" === v) && s.from.y !== s.to.y && (y = y.concat(l).concat(f), o.from = e.effects.setTransition(o, l, s.from.y, o.from), o.to = e.effects.setTransition(o, l, s.to.y, o.to)), e.effects.save(o, y), o.show(), e.effects.createWrapper(o), o.css("overflow", "hidden").css(o.from), m && (i = e.effects.getBaseline(m, r), o.from.top = (r.outerHeight - o.outerHeight()) * i.y, o.from.left = (r.outerWidth - o.outerWidth()) * i.x, o.to.top = (r.outerHeight - o.to.outerHeight) * i.y, o.to.left = (r.outerWidth - o.to.outerWidth) * i.x), o.css(o.from), ("content" === v || "both" === v) && (c = c.concat(["marginTop", "marginBottom"]).concat(l), h = h.concat(["marginLeft", "marginRight"]), f = u.concat(c).concat(h), o.find("*[width]").each(function () {
            var n = e(this),
                r = {height: n.height(), width: n.width(), outerHeight: n.outerHeight(), outerWidth: n.outerWidth()};
            d && e.effects.save(n, f), n.from = {
                height: r.height * s.from.y,
                width: r.width * s.from.x,
                outerHeight: r.outerHeight * s.from.y,
                outerWidth: r.outerWidth * s.from.x
            }, n.to = {
                height: r.height * s.to.y,
                width: r.width * s.to.x,
                outerHeight: r.height * s.to.y,
                outerWidth: r.width * s.to.x
            }, s.from.y !== s.to.y && (n.from = e.effects.setTransition(n, c, s.from.y, n.from), n.to = e.effects.setTransition(n, c, s.to.y, n.to)), s.from.x !== s.to.x && (n.from = e.effects.setTransition(n, h, s.from.x, n.from), n.to = e.effects.setTransition(n, h, s.to.x, n.to)), n.css(n.from), n.animate(n.to, t.duration, t.easing, function () {
                d && e.effects.restore(n, f)
            })
        })), o.animate(o.to, {
            queue: !1, duration: t.duration, easing: t.easing, complete: function () {
                0 === o.to.opacity && o.css("opacity", o.from.opacity), "hide" === p && o.hide(), e.effects.restore(o, y), d || ("static" === g ? o.css({
                    position: "relative",
                    top: o.to.top,
                    left: o.to.left
                }) : e.each(["top", "left"], function (e, t) {
                    o.css(t, function (t, n) {
                        var r = parseInt(n, 10), i = e ? o.to.left : o.to.top;
                        return "auto" === n ? i + "px" : r + i + "px"
                    })
                })), e.effects.removeWrapper(o), n()
            }
        })
    }, e.effects.effect.scale = function (t, n) {
        var r = e(this), i = e.extend(!0, {}, t), s = e.effects.setMode(r, t.mode || "effect"),
            o = parseInt(t.percent, 10) || (0 === parseInt(t.percent, 10) ? 0 : "hide" === s ? 0 : 100),
            u = t.direction || "both", a = t.origin,
            f = {height: r.height(), width: r.width(), outerHeight: r.outerHeight(), outerWidth: r.outerWidth()},
            l = {y: "horizontal" !== u ? o / 100 : 1, x: "vertical" !== u ? o / 100 : 1};
        i.effect = "size", i.queue = !1, i.complete = n, "effect" !== s && (i.origin = a || ["middle", "center"], i.restore = !0), i.from = t.from || ("show" === s ? {
            height: 0,
            width: 0,
            outerHeight: 0,
            outerWidth: 0
        } : f), i.to = {
            height: f.height * l.y,
            width: f.width * l.x,
            outerHeight: f.outerHeight * l.y,
            outerWidth: f.outerWidth * l.x
        }, i.fade && ("show" === s && (i.from.opacity = 0, i.to.opacity = 1), "hide" === s && (i.from.opacity = 1, i.to.opacity = 0)), r.effect(i)
    }, e.effects.effect.puff = function (t, n) {
        var r = e(this), i = e.effects.setMode(r, t.mode || "hide"), s = "hide" === i,
            o = parseInt(t.percent, 10) || 150, u = o / 100,
            a = {height: r.height(), width: r.width(), outerHeight: r.outerHeight(), outerWidth: r.outerWidth()};
        e.extend(t, {
            effect: "scale",
            queue: !1,
            fade: !0,
            mode: i,
            complete: n,
            percent: s ? o : 100,
            from: s ? a : {
                height: a.height * u,
                width: a.width * u,
                outerHeight: a.outerHeight * u,
                outerWidth: a.outerWidth * u
            }
        }), r.effect(t)
    }, e.effects.effect.pulsate = function (t, n) {
        var r, i = e(this), s = e.effects.setMode(i, t.mode || "show"), o = "show" === s, u = "hide" === s,
            a = o || "hide" === s, f = 2 * (t.times || 5) + (a ? 1 : 0), l = t.duration / f, c = 0, h = i.queue(),
            p = h.length;
        for ((o || !i.is(":visible")) && (i.css("opacity", 0).show(), c = 1), r = 1; f > r; r++) i.animate({opacity: c}, l, t.easing), c = 1 - c;
        i.animate({opacity: c}, l, t.easing), i.queue(function () {
            u && i.hide(), n()
        }), p > 1 && h.splice.apply(h, [1, 0].concat(h.splice(p, f + 1))), i.dequeue()
    }, e.effects.effect.shake = function (t, n) {
        var r, i = e(this), s = ["position", "top", "bottom", "left", "right", "height", "width"],
            o = e.effects.setMode(i, t.mode || "effect"), u = t.direction || "left", a = t.distance || 20,
            f = t.times || 3, l = 2 * f + 1, c = Math.round(t.duration / l),
            h = "up" === u || "down" === u ? "top" : "left", p = "up" === u || "left" === u, d = {}, v = {}, m = {},
            g = i.queue(), y = g.length;
        for (e.effects.save(i, s), i.show(), e.effects.createWrapper(i), d[h] = (p ? "-=" : "+=") + a, v[h] = (p ? "+=" : "-=") + 2 * a, m[h] = (p ? "-=" : "+=") + 2 * a, i.animate(d, c, t.easing), r = 1; f > r; r++) i.animate(v, c, t.easing).animate(m, c, t.easing);
        i.animate(v, c, t.easing).animate(d, c / 2, t.easing).queue(function () {
            "hide" === o && i.hide(), e.effects.restore(i, s), e.effects.removeWrapper(i), n()
        }), y > 1 && g.splice.apply(g, [1, 0].concat(g.splice(y, l + 1))), i.dequeue()
    }, e.effects.effect.slide = function (t, n) {
        var r, i = e(this), s = ["position", "top", "bottom", "left", "right", "width", "height"],
            o = e.effects.setMode(i, t.mode || "show"), u = "show" === o, a = t.direction || "left",
            f = "up" === a || "down" === a ? "top" : "left", l = "up" === a || "left" === a, c = {};
        e.effects.save(i, s), i.show(), r = t.distance || i["top" === f ? "outerHeight" : "outerWidth"](!0), e.effects.createWrapper(i).css({overflow: "hidden"}), u && i.css(f, l ? isNaN(r) ? "-" + r : -r : r), c[f] = (u ? l ? "+=" : "-=" : l ? "-=" : "+=") + r, i.animate(c, {
            queue: !1,
            duration: t.duration,
            easing: t.easing,
            complete: function () {
                "hide" === o && i.hide(), e.effects.restore(i, s), e.effects.removeWrapper(i), n()
            }
        })
    }, e.effects.effect.transfer = function (t, n) {
        var r = e(this), i = e(t.to), s = "fixed" === i.css("position"), o = e("body"), u = s ? o.scrollTop() : 0,
            a = s ? o.scrollLeft() : 0, f = i.offset(),
            l = {top: f.top - u, left: f.left - a, height: i.innerHeight(), width: i.innerWidth()}, c = r.offset(),
            h = e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({
                top: c.top - u,
                left: c.left - a,
                height: r.innerHeight(),
                width: r.innerWidth(),
                position: s ? "fixed" : "absolute"
            }).animate(l, t.duration, t.easing, function () {
                h.remove(), n()
            })
    }, e.widget("ui.progressbar", {
        version: "1.11.3", options: {max: 100, value: 0, change: null, complete: null}, min: 0, _create: function () {
            this.oldValue = this.options.value = this._constrainedValue(), this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({
                role: "progressbar",
                "aria-valuemin": this.min
            }), this.valueDiv = e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element), this._refreshValue()
        }, _destroy: function () {
            this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"), this.valueDiv.remove()
        }, value: function (e) {
            return void 0 === e ? this.options.value : (this.options.value = this._constrainedValue(e), this._refreshValue(), void 0)
        }, _constrainedValue: function (e) {
            return void 0 === e && (e = this.options.value), this.indeterminate = e === !1, "number" != typeof e && (e = 0), this.indeterminate ? !1 : Math.min(this.options.max, Math.max(this.min, e))
        }, _setOptions: function (e) {
            var t = e.value;
            delete e.value, this._super(e), this.options.value = this._constrainedValue(t), this._refreshValue()
        }, _setOption: function (e, t) {
            "max" === e && (t = Math.max(this.min, t)), "disabled" === e && this.element.toggleClass("ui-state-disabled", !!t).attr("aria-disabled", t), this._super(e, t)
        }, _percentage: function () {
            return this.indeterminate ? 100 : 100 * (this.options.value - this.min) / (this.options.max - this.min)
        }, _refreshValue: function () {
            var t = this.options.value, n = this._percentage();
            this.valueDiv.toggle(this.indeterminate || t > this.min).toggleClass("ui-corner-right", t === this.options.max).width(n.toFixed(0) + "%"), this.element.toggleClass("ui-progressbar-indeterminate", this.indeterminate), this.indeterminate ? (this.element.removeAttr("aria-valuenow"), this.overlayDiv || (this.overlayDiv = e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))) : (this.element.attr({
                "aria-valuemax": this.options.max,
                "aria-valuenow": t
            }), this.overlayDiv && (this.overlayDiv.remove(), this.overlayDiv = null)), this.oldValue !== t && (this.oldValue = t, this._trigger("change")), t === this.options.max && this._trigger("complete")
        }
    }), e.widget("ui.selectable", e.ui.mouse, {
        version: "1.11.3",
        options: {
            appendTo: "body",
            autoRefresh: !0,
            distance: 0,
            filter: "*",
            tolerance: "touch",
            selected: null,
            selecting: null,
            start: null,
            stop: null,
            unselected: null,
            unselecting: null
        },
        _create: function () {
            var t, n = this;
            this.element.addClass("ui-selectable"), this.dragged = !1, this.refresh = function () {
                t = e(n.options.filter, n.element[0]), t.addClass("ui-selectee"), t.each(function () {
                    var t = e(this), n = t.offset();
                    e.data(this, "selectable-item", {
                        element: this,
                        $element: t,
                        left: n.left,
                        top: n.top,
                        right: n.left + t.outerWidth(),
                        bottom: n.top + t.outerHeight(),
                        startselected: !1,
                        selected: t.hasClass("ui-selected"),
                        selecting: t.hasClass("ui-selecting"),
                        unselecting: t.hasClass("ui-unselecting")
                    })
                })
            }, this.refresh(), this.selectees = t.addClass("ui-selectee"), this._mouseInit(), this.helper = e("<div class='ui-selectable-helper'></div>")
        },
        _destroy: function () {
            this.selectees.removeClass("ui-selectee").removeData("selectable-item"), this.element.removeClass("ui-selectable ui-selectable-disabled"), this._mouseDestroy()
        },
        _mouseStart: function (t) {
            var n = this, r = this.options;
            this.opos = [t.pageX, t.pageY], this.options.disabled || (this.selectees = e(r.filter, this.element[0]), this._trigger("start", t), e(r.appendTo).append(this.helper), this.helper.css({
                left: t.pageX,
                top: t.pageY,
                width: 0,
                height: 0
            }), r.autoRefresh && this.refresh(), this.selectees.filter(".ui-selected").each(function () {
                var r = e.data(this, "selectable-item");
                r.startselected = !0, t.metaKey || t.ctrlKey || (r.$element.removeClass("ui-selected"), r.selected = !1, r.$element.addClass("ui-unselecting"), r.unselecting = !0, n._trigger("unselecting", t, {unselecting: r.element}))
            }), e(t.target).parents().addBack().each(function () {
                var r, i = e.data(this, "selectable-item");
                return i ? (r = !t.metaKey && !t.ctrlKey || !i.$element.hasClass("ui-selected"), i.$element.removeClass(r ? "ui-unselecting" : "ui-selected").addClass(r ? "ui-selecting" : "ui-unselecting"), i.unselecting = !r, i.selecting = r, i.selected = r, r ? n._trigger("selecting", t, {selecting: i.element}) : n._trigger("unselecting", t, {unselecting: i.element}), !1) : void 0
            }))
        },
        _mouseDrag: function (t) {
            if (this.dragged = !0, !this.options.disabled) {
                var n, r = this, i = this.options, s = this.opos[0], o = this.opos[1], u = t.pageX, a = t.pageY;
                return s > u && (n = u, u = s, s = n), o > a && (n = a, a = o, o = n), this.helper.css({
                    left: s,
                    top: o,
                    width: u - s,
                    height: a - o
                }), this.selectees.each(function () {
                    var n = e.data(this, "selectable-item"), f = !1;
                    n && n.element !== r.element[0] && ("touch" === i.tolerance ? f = !(n.left > u || s > n.right || n.top > a || o > n.bottom) : "fit" === i.tolerance && (f = n.left > s && u > n.right && n.top > o && a > n.bottom), f ? (n.selected && (n.$element.removeClass("ui-selected"), n.selected = !1), n.unselecting && (n.$element.removeClass("ui-unselecting"), n.unselecting = !1), n.selecting || (n.$element.addClass("ui-selecting"), n.selecting = !0, r._trigger("selecting", t, {selecting: n.element}))) : (n.selecting && ((t.metaKey || t.ctrlKey) && n.startselected ? (n.$element.removeClass("ui-selecting"), n.selecting = !1, n.$element.addClass("ui-selected"), n.selected = !0) : (n.$element.removeClass("ui-selecting"), n.selecting = !1, n.startselected && (n.$element.addClass("ui-unselecting"), n.unselecting = !0), r._trigger("unselecting", t, {unselecting: n.element}))), n.selected && (t.metaKey || t.ctrlKey || n.startselected || (n.$element.removeClass("ui-selected"), n.selected = !1, n.$element.addClass("ui-unselecting"), n.unselecting = !0, r._trigger("unselecting", t, {unselecting: n.element})))))
                }), !1
            }
        },
        _mouseStop: function (t) {
            var n = this;
            return this.dragged = !1, e(".ui-unselecting", this.element[0]).each(function () {
                var r = e.data(this, "selectable-item");
                r.$element.removeClass("ui-unselecting"), r.unselecting = !1, r.startselected = !1, n._trigger("unselected", t, {unselected: r.element})
            }), e(".ui-selecting", this.element[0]).each(function () {
                var r = e.data(this, "selectable-item");
                r.$element.removeClass("ui-selecting").addClass("ui-selected"), r.selecting = !1, r.selected = !0, r.startselected = !0, n._trigger("selected", t, {selected: r.element})
            }), this._trigger("stop", t), this.helper.remove(), !1
        }
    }), e.widget("ui.selectmenu", {
        version: "1.11.3",
        defaultElement: "<select>",
        options: {
            appendTo: null,
            disabled: null,
            icons: {button: "ui-icon-triangle-1-s"},
            position: {my: "left top", at: "left bottom", collision: "none"},
            width: null,
            change: null,
            close: null,
            focus: null,
            open: null,
            select: null
        },
        _create: function () {
            var e = this.element.uniqueId().attr("id");
            this.ids = {
                element: e,
                button: e + "-button",
                menu: e + "-menu"
            }, this._drawButton(), this._drawMenu(), this.options.disabled && this.disable()
        },
        _drawButton: function () {
            var t = this;
            this.label = e("label[for='" + this.ids.element + "']").attr("for", this.ids.button), this._on(this.label, {
                click: function (e) {
                    this.button.focus(), e.preventDefault()
                }
            }), this.element.hide(), this.button = e("<span>", {
                "class": "ui-selectmenu-button ui-widget ui-state-default ui-corner-all",
                tabindex: this.options.disabled ? -1 : 0,
                id: this.ids.button,
                role: "combobox",
                "aria-expanded": "false",
                "aria-autocomplete": "list",
                "aria-owns": this.ids.menu,
                "aria-haspopup": "true"
            }).insertAfter(this.element), e("<span>", {"class": "ui-icon " + this.options.icons.button}).prependTo(this.button), this.buttonText = e("<span>", {"class": "ui-selectmenu-text"}).appendTo(this.button), this._setText(this.buttonText, this.element.find("option:selected").text()), this._resizeButton(), this._on(this.button, this._buttonEvents), this.button.one("focusin", function () {
                t.menuItems || t._refreshMenu()
            }), this._hoverable(this.button), this._focusable(this.button)
        },
        _drawMenu: function () {
            var t = this;
            this.menu = e("<ul>", {
                "aria-hidden": "true",
                "aria-labelledby": this.ids.button,
                id: this.ids.menu
            }), this.menuWrap = e("<div>", {"class": "ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()), this.menuInstance = this.menu.menu({
                role: "listbox",
                select: function (e, n) {
                    e.preventDefault(), t._setSelection(), t._select(n.item.data("ui-selectmenu-item"), e)
                },
                focus: function (e, n) {
                    var r = n.item.data("ui-selectmenu-item");
                    null != t.focusIndex && r.index !== t.focusIndex && (t._trigger("focus", e, {item: r}), t.isOpen || t._select(r, e)), t.focusIndex = r.index, t.button.attr("aria-activedescendant", t.menuItems.eq(r.index).attr("id"))
                }
            }).menu("instance"), this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"), this.menuInstance._off(this.menu, "mouseleave"), this.menuInstance._closeOnDocumentClick = function () {
                return !1
            }, this.menuInstance._isDivider = function () {
                return !1
            }
        },
        refresh: function () {
            this._refreshMenu(), this._setText(this.buttonText, this._getSelectedItem().text()), this.options.width || this._resizeButton()
        },
        _refreshMenu: function () {
            this.menu.empty();
            var e, t = this.element.find("option");
            t.length && (this._parseOptions(t), this._renderMenu(this.menu, this.items), this.menuInstance.refresh(), this.menuItems = this.menu.find("li").not(".ui-selectmenu-optgroup"), e = this._getSelectedItem(), this.menuInstance.focus(null, e), this._setAria(e.data("ui-selectmenu-item")), this._setOption("disabled", this.element.prop("disabled")))
        },
        open: function (e) {
            this.options.disabled || (this.menuItems ? (this.menu.find(".ui-state-focus").removeClass("ui-state-focus"), this.menuInstance.focus(null, this._getSelectedItem())) : this._refreshMenu(), this.isOpen = !0, this._toggleAttr(), this._resizeMenu(), this._position(), this._on(this.document, this._documentClick), this._trigger("open", e))
        },
        _position: function () {
            this.menuWrap.position(e.extend({of: this.button}, this.options.position))
        },
        close: function (e) {
            this.isOpen && (this.isOpen = !1, this._toggleAttr(), this.range = null, this._off(this.document), this._trigger("close", e))
        },
        widget: function () {
            return this.button
        },
        menuWidget: function () {
            return this.menu
        },
        _renderMenu: function (t, n) {
            var r = this, i = "";
            e.each(n, function (n, s) {
                s.optgroup !== i && (e("<li>", {
                    "class": "ui-selectmenu-optgroup ui-menu-divider" + (s.element.parent("optgroup").prop("disabled") ? " ui-state-disabled" : ""),
                    text: s.optgroup
                }).appendTo(t), i = s.optgroup), r._renderItemData(t, s)
            })
        },
        _renderItemData: function (e, t) {
            return this._renderItem(e, t).data("ui-selectmenu-item", t)
        },
        _renderItem: function (t, n) {
            var r = e("<li>");
            return n.disabled && r.addClass("ui-state-disabled"), this._setText(r, n.label), r.appendTo(t)
        },
        _setText: function (e, t) {
            t ? e.text(t) : e.html("&#160;")
        },
        _move: function (e, t) {
            var n, r, i = ".ui-menu-item";
            this.isOpen ? n = this.menuItems.eq(this.focusIndex) : (n = this.menuItems.eq(this.element[0].selectedIndex), i += ":not(.ui-state-disabled)"), r = "first" === e || "last" === e ? n["first" === e ? "prevAll" : "nextAll"](i).eq(-1) : n[e + "All"](i).eq(0), r.length && this.menuInstance.focus(t, r)
        },
        _getSelectedItem: function () {
            return this.menuItems.eq(this.element[0].selectedIndex)
        },
        _toggle: function (e) {
            this[this.isOpen ? "close" : "open"](e)
        },
        _setSelection: function () {
            var e;
            this.range && (window.getSelection ? (e = window.getSelection(), e.removeAllRanges(), e.addRange(this.range)) : this.range.select(), this.button.focus())
        },
        _documentClick: {
            mousedown: function (t) {
                this.isOpen && (e(t.target).closest(".ui-selectmenu-menu, #" + this.ids.button).length || this.close(t))
            }
        },
        _buttonEvents: {
            mousedown: function () {
                var e;
                window.getSelection ? (e = window.getSelection(), e.rangeCount && (this.range = e.getRangeAt(0))) : this.range = document.selection.createRange()
            }, click: function (e) {
                this._setSelection(), this._toggle(e)
            }, keydown: function (t) {
                var n = !0;
                switch (t.keyCode) {
                    case e.ui.keyCode.TAB:
                    case e.ui.keyCode.ESCAPE:
                        this.close(t), n = !1;
                        break;
                    case e.ui.keyCode.ENTER:
                        this.isOpen && this._selectFocusedItem(t);
                        break;
                    case e.ui.keyCode.UP:
                        t.altKey ? this._toggle(t) : this._move("prev", t);
                        break;
                    case e.ui.keyCode.DOWN:
                        t.altKey ? this._toggle(t) : this._move("next", t);
                        break;
                    case e.ui.keyCode.SPACE:
                        this.isOpen ? this._selectFocusedItem(t) : this._toggle(t);
                        break;
                    case e.ui.keyCode.LEFT:
                        this._move("prev", t);
                        break;
                    case e.ui.keyCode.RIGHT:
                        this._move("next", t);
                        break;
                    case e.ui.keyCode.HOME:
                    case e.ui.keyCode.PAGE_UP:
                        this._move("first", t);
                        break;
                    case e.ui.keyCode.END:
                    case e.ui.keyCode.PAGE_DOWN:
                        this._move("last", t);
                        break;
                    default:
                        this.menu.trigger(t), n = !1
                }
                n && t.preventDefault()
            }
        },
        _selectFocusedItem: function (e) {
            var t = this.menuItems.eq(this.focusIndex);
            t.hasClass("ui-state-disabled") || this._select(t.data("ui-selectmenu-item"), e)
        },
        _select: function (e, t) {
            var n = this.element[0].selectedIndex;
            this.element[0].selectedIndex = e.index, this._setText(this.buttonText, e.label), this._setAria(e), this._trigger("select", t, {item: e}), e.index !== n && this._trigger("change", t, {item: e}), this.close(t)
        },
        _setAria: function (e) {
            var t = this.menuItems.eq(e.index).attr("id");
            this.button.attr({
                "aria-labelledby": t,
                "aria-activedescendant": t
            }), this.menu.attr("aria-activedescendant", t)
        },
        _setOption: function (e, t) {
            "icons" === e && this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button), this._super(e, t), "appendTo" === e && this.menuWrap.appendTo(this._appendTo()), "disabled" === e && (this.menuInstance.option("disabled", t), this.button.toggleClass("ui-state-disabled", t).attr("aria-disabled", t), this.element.prop("disabled", t), t ? (this.button.attr("tabindex", -1), this.close()) : this.button.attr("tabindex", 0)), "width" === e && this._resizeButton()
        },
        _appendTo: function () {
            var t = this.options.appendTo;
            return t && (t = t.jquery || t.nodeType ? e(t) : this.document.find(t).eq(0)), t && t[0] || (t = this.element.closest(".ui-front")), t.length || (t = this.document[0].body), t
        },
        _toggleAttr: function () {
            this.button.toggleClass("ui-corner-top", this.isOpen).toggleClass("ui-corner-all", !this.isOpen).attr("aria-expanded", this.isOpen), this.menuWrap.toggleClass("ui-selectmenu-open", this.isOpen), this.menu.attr("aria-hidden", !this.isOpen)
        },
        _resizeButton: function () {
            var e = this.options.width;
            e || (e = this.element.show().outerWidth(), this.element.hide()), this.button.outerWidth(e)
        },
        _resizeMenu: function () {
            this.menu.outerWidth(Math.max(this.button.outerWidth(), this.menu.width("").outerWidth() + 1))
        },
        _getCreateOptions: function () {
            return {disabled: this.element.prop("disabled")}
        },
        _parseOptions: function (t) {
            var n = [];
            t.each(function (t, r) {
                var i = e(r), s = i.parent("optgroup");
                n.push({
                    element: i,
                    index: t,
                    value: i.val(),
                    label: i.text(),
                    optgroup: s.attr("label") || "",
                    disabled: s.prop("disabled") || i.prop("disabled")
                })
            }), this.items = n
        },
        _destroy: function () {
            this.menuWrap.remove(), this.button.remove(), this.element.show(), this.element.removeUniqueId(), this.label.attr("for", this.ids.element)
        }
    }), e.widget("ui.slider", e.ui.mouse, {
        version: "1.11.3",
        widgetEventPrefix: "slide",
        options: {
            animate: !1,
            distance: 0,
            max: 100,
            min: 0,
            orientation: "horizontal",
            range: !1,
            step: 1,
            value: 0,
            values: null,
            change: null,
            slide: null,
            start: null,
            stop: null
        },
        numPages: 5,
        _create: function () {
            this._keySliding = !1, this._mouseSliding = !1, this._animateOff = !0, this._handleIndex = null, this._detectOrientation(), this._mouseInit(), this._calculateNewMax(), this.element.addClass("ui-slider ui-slider-" + this.orientation + " ui-widget" + " ui-widget-content" + " ui-corner-all"), this._refresh(), this._setOption("disabled", this.options.disabled), this._animateOff = !1
        },
        _refresh: function () {
            this._createRange(), this._createHandles(), this._setupEvents(), this._refreshValue()
        },
        _createHandles: function () {
            var t, n, r = this.options,
                i = this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),
                s = "<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>", o = [];
            for (n = r.values && r.values.length || 1, i.length > n && (i.slice(n).remove(), i = i.slice(0, n)), t = i.length; n > t; t++) o.push(s);
            this.handles = i.add(e(o.join("")).appendTo(this.element)), this.handle = this.handles.eq(0), this.handles.each(function (t) {
                e(this).data("ui-slider-handle-index", t)
            })
        },
        _createRange: function () {
            var t = this.options, n = "";
            t.range ? (t.range === !0 && (t.values ? t.values.length && 2 !== t.values.length ? t.values = [t.values[0], t.values[0]] : e.isArray(t.values) && (t.values = t.values.slice(0)) : t.values = [this._valueMin(), this._valueMin()]), this.range && this.range.length ? this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({
                left: "",
                bottom: ""
            }) : (this.range = e("<div></div>").appendTo(this.element), n = "ui-slider-range ui-widget-header ui-corner-all"), this.range.addClass(n + ("min" === t.range || "max" === t.range ? " ui-slider-range-" + t.range : ""))) : (this.range && this.range.remove(), this.range = null)
        },
        _setupEvents: function () {
            this._off(this.handles), this._on(this.handles, this._handleEvents), this._hoverable(this.handles), this._focusable(this.handles)
        },
        _destroy: function () {
            this.handles.remove(), this.range && this.range.remove(), this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"), this._mouseDestroy()
        },
        _mouseCapture: function (t) {
            var n, r, i, s, o, u, a, f, l = this, c = this.options;
            return c.disabled ? !1 : (this.elementSize = {
                width: this.element.outerWidth(),
                height: this.element.outerHeight()
            }, this.elementOffset = this.element.offset(), n = {
                x: t.pageX,
                y: t.pageY
            }, r = this._normValueFromMouse(n), i = this._valueMax() - this._valueMin() + 1, this.handles.each(function (t) {
                var n = Math.abs(r - l.values(t));
                (i > n || i === n && (t === l._lastChangedValue || l.values(t) === c.min)) && (i = n, s = e(this), o = t)
            }), u = this._start(t, o), u === !1 ? !1 : (this._mouseSliding = !0, this._handleIndex = o, s.addClass("ui-state-active").focus(), a = s.offset(), f = !e(t.target).parents().addBack().is(".ui-slider-handle"), this._clickOffset = f ? {
                left: 0,
                top: 0
            } : {
                left: t.pageX - a.left - s.width() / 2,
                top: t.pageY - a.top - s.height() / 2 - (parseInt(s.css("borderTopWidth"), 10) || 0) - (parseInt(s.css("borderBottomWidth"), 10) || 0) + (parseInt(s.css("marginTop"), 10) || 0)
            }, this.handles.hasClass("ui-state-hover") || this._slide(t, o, r), this._animateOff = !0, !0))
        },
        _mouseStart: function () {
            return !0
        },
        _mouseDrag: function (e) {
            var t = {x: e.pageX, y: e.pageY}, n = this._normValueFromMouse(t);
            return this._slide(e, this._handleIndex, n), !1
        },
        _mouseStop: function (e) {
            return this.handles.removeClass("ui-state-active"), this._mouseSliding = !1, this._stop(e, this._handleIndex), this._change(e, this._handleIndex), this._handleIndex = null, this._clickOffset = null, this._animateOff = !1, !1
        },
        _detectOrientation: function () {
            this.orientation = "vertical" === this.options.orientation ? "vertical" : "horizontal"
        },
        _normValueFromMouse: function (e) {
            var t, n, r, i, s;
            return "horizontal" === this.orientation ? (t = this.elementSize.width, n = e.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (t = this.elementSize.height, n = e.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)), r = n / t, r > 1 && (r = 1), 0 > r && (r = 0), "vertical" === this.orientation && (r = 1 - r), i = this._valueMax() - this._valueMin(), s = this._valueMin() + r * i, this._trimAlignValue(s)
        },
        _start: function (e, t) {
            var n = {handle: this.handles[t], value: this.value()};
            return this.options.values && this.options.values.length && (n.value = this.values(t), n.values = this.values()), this._trigger("start", e, n)
        },
        _slide: function (e, t, n) {
            var r, i, s;
            this.options.values && this.options.values.length ? (r = this.values(t ? 0 : 1), 2 === this.options.values.length && this.options.range === !0 && (0 === t && n > r || 1 === t && r > n) && (n = r), n !== this.values(t) && (i = this.values(), i[t] = n, s = this._trigger("slide", e, {
                handle: this.handles[t],
                value: n,
                values: i
            }), r = this.values(t ? 0 : 1), s !== !1 && this.values(t, n))) : n !== this.value() && (s = this._trigger("slide", e, {
                handle: this.handles[t],
                value: n
            }), s !== !1 && this.value(n))
        },
        _stop: function (e, t) {
            var n = {handle: this.handles[t], value: this.value()};
            this.options.values && this.options.values.length && (n.value = this.values(t), n.values = this.values()), this._trigger("stop", e, n)
        },
        _change: function (e, t) {
            if (!this._keySliding && !this._mouseSliding) {
                var n = {handle: this.handles[t], value: this.value()};
                this.options.values && this.options.values.length && (n.value = this.values(t), n.values = this.values()), this._lastChangedValue = t, this._trigger("change", e, n)
            }
        },
        value: function (e) {
            return arguments.length ? (this.options.value = this._trimAlignValue(e), this._refreshValue(), this._change(null, 0), void 0) : this._value()
        },
        values: function (t, n) {
            var r, i, s;
            if (arguments.length > 1) return this.options.values[t] = this._trimAlignValue(n), this._refreshValue(), this._change(null, t), void 0;
            if (!arguments.length) return this._values();
            if (!e.isArray(arguments[0])) return this.options.values && this.options.values.length ? this._values(t) : this.value();
            for (r = this.options.values, i = arguments[0], s = 0; r.length > s; s += 1) r[s] = this._trimAlignValue(i[s]), this._change(null, s);
            this._refreshValue()
        },
        _setOption: function (t, n) {
            var r, i = 0;
            switch ("range" === t && this.options.range === !0 && ("min" === n ? (this.options.value = this._values(0), this.options.values = null) : "max" === n && (this.options.value = this._values(this.options.values.length - 1), this.options.values = null)), e.isArray(this.options.values) && (i = this.options.values.length), "disabled" === t && this.element.toggleClass("ui-state-disabled", !!n), this._super(t, n), t) {
                case"orientation":
                    this._detectOrientation(), this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-" + this.orientation), this._refreshValue(), this.handles.css("horizontal" === n ? "bottom" : "left", "");
                    break;
                case"value":
                    this._animateOff = !0, this._refreshValue(), this._change(null, 0), this._animateOff = !1;
                    break;
                case"values":
                    for (this._animateOff = !0, this._refreshValue(), r = 0; i > r; r += 1) this._change(null, r);
                    this._animateOff = !1;
                    break;
                case"step":
                case"min":
                case"max":
                    this._animateOff = !0, this._calculateNewMax(), this._refreshValue(), this._animateOff = !1;
                    break;
                case"range":
                    this._animateOff = !0, this._refresh(), this._animateOff = !1
            }
        },
        _value: function () {
            var e = this.options.value;
            return e = this._trimAlignValue(e)
        },
        _values: function (e) {
            var t, n, r;
            if (arguments.length) return t = this.options.values[e], t = this._trimAlignValue(t);
            if (this.options.values && this.options.values.length) {
                for (n = this.options.values.slice(), r = 0; n.length > r; r += 1) n[r] = this._trimAlignValue(n[r]);
                return n
            }
            return []
        },
        _trimAlignValue: function (e) {
            if (this._valueMin() >= e) return this._valueMin();
            if (e >= this._valueMax()) return this._valueMax();
            var t = this.options.step > 0 ? this.options.step : 1, n = (e - this._valueMin()) % t, r = e - n;
            return 2 * Math.abs(n) >= t && (r += n > 0 ? t : -t), parseFloat(r.toFixed(5))
        },
        _calculateNewMax: function () {
            var e = this.options.max, t = this._valueMin(), n = this.options.step, r = Math.floor((e - t) / n) * n;
            e = r + t, this.max = parseFloat(e.toFixed(this._precision()))
        },
        _precision: function () {
            var e = this._precisionOf(this.options.step);
            return null !== this.options.min && (e = Math.max(e, this._precisionOf(this.options.min))), e
        },
        _precisionOf: function (e) {
            var t = "" + e, n = t.indexOf(".");
            return -1 === n ? 0 : t.length - n - 1
        },
        _valueMin: function () {
            return this.options.min
        },
        _valueMax: function () {
            return this.max
        },
        _refreshValue: function () {
            var t, n, r, i, s, o = this.options.range, u = this.options, a = this,
                f = this._animateOff ? !1 : u.animate, l = {};
            this.options.values && this.options.values.length ? this.handles.each(function (r) {
                n = 100 * ((a.values(r) - a._valueMin()) / (a._valueMax() - a._valueMin())), l["horizontal" === a.orientation ? "left" : "bottom"] = n + "%", e(this).stop(1, 1)[f ? "animate" : "css"](l, u.animate), a.options.range === !0 && ("horizontal" === a.orientation ? (0 === r && a.range.stop(1, 1)[f ? "animate" : "css"]({left: n + "%"}, u.animate), 1 === r && a.range[f ? "animate" : "css"]({width: n - t + "%"}, {
                    queue: !1,
                    duration: u.animate
                })) : (0 === r && a.range.stop(1, 1)[f ? "animate" : "css"]({bottom: n + "%"}, u.animate), 1 === r && a.range[f ? "animate" : "css"]({height: n - t + "%"}, {
                    queue: !1,
                    duration: u.animate
                }))), t = n
            }) : (r = this.value(), i = this._valueMin(), s = this._valueMax(), n = s !== i ? 100 * ((r - i) / (s - i)) : 0, l["horizontal" === this.orientation ? "left" : "bottom"] = n + "%", this.handle.stop(1, 1)[f ? "animate" : "css"](l, u.animate), "min" === o && "horizontal" === this.orientation && this.range.stop(1, 1)[f ? "animate" : "css"]({width: n + "%"}, u.animate), "max" === o && "horizontal" === this.orientation && this.range[f ? "animate" : "css"]({width: 100 - n + "%"}, {
                queue: !1,
                duration: u.animate
            }), "min" === o && "vertical" === this.orientation && this.range.stop(1, 1)[f ? "animate" : "css"]({height: n + "%"}, u.animate), "max" === o && "vertical" === this.orientation && this.range[f ? "animate" : "css"]({height: 100 - n + "%"}, {
                queue: !1,
                duration: u.animate
            }))
        },
        _handleEvents: {
            keydown: function (t) {
                var n, r, i, s, o = e(t.target).data("ui-slider-handle-index");
                switch (t.keyCode) {
                    case e.ui.keyCode.HOME:
                    case e.ui.keyCode.END:
                    case e.ui.keyCode.PAGE_UP:
                    case e.ui.keyCode.PAGE_DOWN:
                    case e.ui.keyCode.UP:
                    case e.ui.keyCode.RIGHT:
                    case e.ui.keyCode.DOWN:
                    case e.ui.keyCode.LEFT:
                        if (t.preventDefault(), !this._keySliding && (this._keySliding = !0, e(t.target).addClass("ui-state-active"), n = this._start(t, o), n === !1)) return
                }
                switch (s = this.options.step, r = i = this.options.values && this.options.values.length ? this.values(o) : this.value(), t.keyCode) {
                    case e.ui.keyCode.HOME:
                        i = this._valueMin();
                        break;
                    case e.ui.keyCode.END:
                        i = this._valueMax();
                        break;
                    case e.ui.keyCode.PAGE_UP:
                        i = this._trimAlignValue(r + (this._valueMax() - this._valueMin()) / this.numPages);
                        break;
                    case e.ui.keyCode.PAGE_DOWN:
                        i = this._trimAlignValue(r - (this._valueMax() - this._valueMin()) / this.numPages);
                        break;
                    case e.ui.keyCode.UP:
                    case e.ui.keyCode.RIGHT:
                        if (r === this._valueMax()) return;
                        i = this._trimAlignValue(r + s);
                        break;
                    case e.ui.keyCode.DOWN:
                    case e.ui.keyCode.LEFT:
                        if (r === this._valueMin()) return;
                        i = this._trimAlignValue(r - s)
                }
                this._slide(t, o, i)
            }, keyup: function (t) {
                var n = e(t.target).data("ui-slider-handle-index");
                this._keySliding && (this._keySliding = !1, this._stop(t, n), this._change(t, n), e(t.target).removeClass("ui-state-active"))
            }
        }
    }), e.widget("ui.sortable", e.ui.mouse, {
        version: "1.11.3",
        widgetEventPrefix: "sort",
        ready: !1,
        options: {
            appendTo: "parent",
            axis: !1,
            connectWith: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            dropOnEmpty: !0,
            forcePlaceholderSize: !1,
            forceHelperSize: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            items: "> *",
            opacity: !1,
            placeholder: !1,
            revert: !1,
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: "default",
            tolerance: "intersect",
            zIndex: 1e3,
            activate: null,
            beforeStop: null,
            change: null,
            deactivate: null,
            out: null,
            over: null,
            receive: null,
            remove: null,
            sort: null,
            start: null,
            stop: null,
            update: null
        },
        _isOverAxis: function (e, t, n) {
            return e >= t && t + n > e
        },
        _isFloating: function (e) {
            return /left|right/.test(e.css("float")) || /inline|table-cell/.test(e.css("display"))
        },
        _create: function () {
            var e = this.options;
            this.containerCache = {}, this.element.addClass("ui-sortable"), this.refresh(), this.floating = this.items.length ? "x" === e.axis || this._isFloating(this.items[0].item) : !1, this.offset = this.element.offset(), this._mouseInit(), this._setHandleClassName(), this.ready = !0
        },
        _setOption: function (e, t) {
            this._super(e, t), "handle" === e && this._setHandleClassName()
        },
        _setHandleClassName: function () {
            this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"), e.each(this.items, function () {
                (this.instance.options.handle ? this.item.find(this.instance.options.handle) : this.item).addClass("ui-sortable-handle")
            })
        },
        _destroy: function () {
            this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"), this._mouseDestroy();
            for (var e = this.items.length - 1; e >= 0; e--) this.items[e].item.removeData(this.widgetName + "-item");
            return this
        },
        _mouseCapture: function (t, n) {
            var r = null, i = !1, s = this;
            return this.reverting ? !1 : this.options.disabled || "static" === this.options.type ? !1 : (this._refreshItems(t), e(t.target).parents().each(function () {
                return e.data(this, s.widgetName + "-item") === s ? (r = e(this), !1) : void 0
            }), e.data(t.target, s.widgetName + "-item") === s && (r = e(t.target)), r ? !this.options.handle || n || (e(this.options.handle, r).find("*").addBack().each(function () {
                this === t.target && (i = !0)
            }), i) ? (this.currentItem = r, this._removeCurrentsFromItems(), !0) : !1 : !1)
        },
        _mouseStart: function (t, n, r) {
            var i, s, o = this.options;
            if (this.currentContainer = this, this.refreshPositions(), this.helper = this._createHelper(t), this._cacheHelperProportions(), this._cacheMargins(), this.scrollParent = this.helper.scrollParent(), this.offset = this.currentItem.offset(), this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            }, e.extend(this.offset, {
                click: {left: t.pageX - this.offset.left, top: t.pageY - this.offset.top},
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            }), this.helper.css("position", "absolute"), this.cssPosition = this.helper.css("position"), this.originalPosition = this._generatePosition(t), this.originalPageX = t.pageX, this.originalPageY = t.pageY, o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt), this.domPosition = {
                prev: this.currentItem.prev()[0],
                parent: this.currentItem.parent()[0]
            }, this.helper[0] !== this.currentItem[0] && this.currentItem.hide(), this._createPlaceholder(), o.containment && this._setContainment(), o.cursor && "auto" !== o.cursor && (s = this.document.find("body"), this.storedCursor = s.css("cursor"), s.css("cursor", o.cursor), this.storedStylesheet = e("<style>*{ cursor: " + o.cursor + " !important; }</style>").appendTo(s)), o.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")), this.helper.css("opacity", o.opacity)), o.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")), this.helper.css("zIndex", o.zIndex)), this.scrollParent[0] !== this.document[0] && "HTML" !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()), this._trigger("start", t, this._uiHash()), this._preserveHelperProportions || this._cacheHelperProportions(), !r) for (i = this.containers.length - 1; i >= 0; i--) this.containers[i]._trigger("activate", t, this._uiHash(this));
            return e.ui.ddmanager && (e.ui.ddmanager.current = this), e.ui.ddmanager && !o.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t), this.dragging = !0, this.helper.addClass("ui-sortable-helper"), this._mouseDrag(t), !0
        },
        _mouseDrag: function (t) {
            var n, r, i, s, o = this.options, u = !1;
            for (this.position = this._generatePosition(t), this.positionAbs = this._convertPositionTo("absolute"), this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs), this.options.scroll && (this.scrollParent[0] !== this.document[0] && "HTML" !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - t.pageY < o.scrollSensitivity ? this.scrollParent[0].scrollTop = u = this.scrollParent[0].scrollTop + o.scrollSpeed : t.pageY - this.overflowOffset.top < o.scrollSensitivity && (this.scrollParent[0].scrollTop = u = this.scrollParent[0].scrollTop - o.scrollSpeed), this.overflowOffset.left + this.scrollParent[0].offsetWidth - t.pageX < o.scrollSensitivity ? this.scrollParent[0].scrollLeft = u = this.scrollParent[0].scrollLeft + o.scrollSpeed : t.pageX - this.overflowOffset.left < o.scrollSensitivity && (this.scrollParent[0].scrollLeft = u = this.scrollParent[0].scrollLeft - o.scrollSpeed)) : (t.pageY - this.document.scrollTop() < o.scrollSensitivity ? u = this.document.scrollTop(this.document.scrollTop() - o.scrollSpeed) : this.window.height() - (t.pageY - this.document.scrollTop()) < o.scrollSensitivity && (u = this.document.scrollTop(this.document.scrollTop() + o.scrollSpeed)), t.pageX - this.document.scrollLeft() < o.scrollSensitivity ? u = this.document.scrollLeft(this.document.scrollLeft() - o.scrollSpeed) : this.window.width() - (t.pageX - this.document.scrollLeft()) < o.scrollSensitivity && (u = this.document.scrollLeft(this.document.scrollLeft() + o.scrollSpeed))), u !== !1 && e.ui.ddmanager && !o.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t)), this.positionAbs = this._convertPositionTo("absolute"), this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"), this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"), n = this.items.length - 1; n >= 0; n--) if (r = this.items[n], i = r.item[0], s = this._intersectsWithPointer(r), s && r.instance === this.currentContainer && i !== this.currentItem[0] && this.placeholder[1 === s ? "next" : "prev"]()[0] !== i && !e.contains(this.placeholder[0], i) && ("semi-dynamic" === this.options.type ? !e.contains(this.element[0], i) : !0)) {
                if (this.direction = 1 === s ? "down" : "up", "pointer" !== this.options.tolerance && !this._intersectsWithSides(r)) break;
                this._rearrange(t, r), this._trigger("change", t, this._uiHash());
                break
            }
            return this._contactContainers(t), e.ui.ddmanager && e.ui.ddmanager.drag(this, t), this._trigger("sort", t, this._uiHash()), this.lastPositionAbs = this.positionAbs, !1
        },
        _mouseStop: function (t, n) {
            if (t) {
                if (e.ui.ddmanager && !this.options.dropBehaviour && e.ui.ddmanager.drop(this, t), this.options.revert) {
                    var r = this, i = this.placeholder.offset(), s = this.options.axis, o = {};
                    s && "x" !== s || (o.left = i.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === this.document[0].body ? 0 : this.offsetParent[0].scrollLeft)), s && "y" !== s || (o.top = i.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === this.document[0].body ? 0 : this.offsetParent[0].scrollTop)), this.reverting = !0, e(this.helper).animate(o, parseInt(this.options.revert, 10) || 500, function () {
                        r._clear(t)
                    })
                } else this._clear(t, n);
                return !1
            }
        },
        cancel: function () {
            if (this.dragging) {
                this._mouseUp({target: null}), "original" === this.options.helper ? this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper") : this.currentItem.show();
                for (var t = this.containers.length - 1; t >= 0; t--) this.containers[t]._trigger("deactivate", null, this._uiHash(this)), this.containers[t].containerCache.over && (this.containers[t]._trigger("out", null, this._uiHash(this)), this.containers[t].containerCache.over = 0)
            }
            return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]), "original" !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(), e.extend(this, {
                helper: null,
                dragging: !1,
                reverting: !1,
                _noFinalSort: null
            }), this.domPosition.prev ? e(this.domPosition.prev).after(this.currentItem) : e(this.domPosition.parent).prepend(this.currentItem)), this
        },
        serialize: function (t) {
            var n = this._getItemsAsjQuery(t && t.connected), r = [];
            return t = t || {}, e(n).each(function () {
                var n = (e(t.item || this).attr(t.attribute || "id") || "").match(t.expression || /(.+)[\-=_](.+)/);
                n && r.push((t.key || n[1] + "[]") + "=" + (t.key && t.expression ? n[1] : n[2]))
            }), !r.length && t.key && r.push(t.key + "="), r.join("&")
        },
        toArray: function (t) {
            var n = this._getItemsAsjQuery(t && t.connected), r = [];
            return t = t || {}, n.each(function () {
                r.push(e(t.item || this).attr(t.attribute || "id") || "")
            }), r
        },
        _intersectsWith: function (e) {
            var t = this.positionAbs.left, n = t + this.helperProportions.width, r = this.positionAbs.top,
                i = r + this.helperProportions.height, s = e.left, o = s + e.width, u = e.top, a = u + e.height,
                f = this.offset.click.top, l = this.offset.click.left,
                c = "x" === this.options.axis || r + f > u && a > r + f,
                h = "y" === this.options.axis || t + l > s && o > t + l, p = c && h;
            return "pointer" === this.options.tolerance || this.options.forcePointerForContainers || "pointer" !== this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > e[this.floating ? "width" : "height"] ? p : t + this.helperProportions.width / 2 > s && o > n - this.helperProportions.width / 2 && r + this.helperProportions.height / 2 > u && a > i - this.helperProportions.height / 2
        },
        _intersectsWithPointer: function (e) {
            var t = "x" === this.options.axis || this._isOverAxis(this.positionAbs.top + this.offset.click.top, e.top, e.height),
                n = "y" === this.options.axis || this._isOverAxis(this.positionAbs.left + this.offset.click.left, e.left, e.width),
                r = t && n, i = this._getDragVerticalDirection(), s = this._getDragHorizontalDirection();
            return r ? this.floating ? s && "right" === s || "down" === i ? 2 : 1 : i && ("down" === i ? 2 : 1) : !1
        },
        _intersectsWithSides: function (e) {
            var t = this._isOverAxis(this.positionAbs.top + this.offset.click.top, e.top + e.height / 2, e.height),
                n = this._isOverAxis(this.positionAbs.left + this.offset.click.left, e.left + e.width / 2, e.width),
                r = this._getDragVerticalDirection(), i = this._getDragHorizontalDirection();
            return this.floating && i ? "right" === i && n || "left" === i && !n : r && ("down" === r && t || "up" === r && !t)
        },
        _getDragVerticalDirection: function () {
            var e = this.positionAbs.top - this.lastPositionAbs.top;
            return 0 !== e && (e > 0 ? "down" : "up")
        },
        _getDragHorizontalDirection: function () {
            var e = this.positionAbs.left - this.lastPositionAbs.left;
            return 0 !== e && (e > 0 ? "right" : "left")
        },
        refresh: function (e) {
            return this._refreshItems(e), this._setHandleClassName(), this.refreshPositions(), this
        },
        _connectWith: function () {
            var e = this.options;
            return e.connectWith.constructor === String ? [e.connectWith] : e.connectWith
        },
        _getItemsAsjQuery: function (t) {
            function n() {
                u.push(this)
            }

            var r, i, s, o, u = [], a = [], f = this._connectWith();
            if (f && t) for (r = f.length - 1; r >= 0; r--) for (s = e(f[r], this.document[0]), i = s.length - 1; i >= 0; i--) o = e.data(s[i], this.widgetFullName), o && o !== this && !o.options.disabled && a.push([e.isFunction(o.options.items) ? o.options.items.call(o.element) : e(o.options.items, o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), o]);
            for (a.push([e.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                options: this.options,
                item: this.currentItem
            }) : e(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]), r = a.length - 1; r >= 0; r--) a[r][0].each(n);
            return e(u)
        },
        _removeCurrentsFromItems: function () {
            var t = this.currentItem.find(":data(" + this.widgetName + "-item)");
            this.items = e.grep(this.items, function (e) {
                for (var n = 0; t.length > n; n++) if (t[n] === e.item[0]) return !1;
                return !0
            })
        },
        _refreshItems: function (t) {
            this.items = [], this.containers = [this];
            var n, r, i, s, o, u, a, f, l = this.items,
                c = [[e.isFunction(this.options.items) ? this.options.items.call(this.element[0], t, {item: this.currentItem}) : e(this.options.items, this.element), this]],
                h = this._connectWith();
            if (h && this.ready) for (n = h.length - 1; n >= 0; n--) for (i = e(h[n], this.document[0]), r = i.length - 1; r >= 0; r--) s = e.data(i[r], this.widgetFullName), s && s !== this && !s.options.disabled && (c.push([e.isFunction(s.options.items) ? s.options.items.call(s.element[0], t, {item: this.currentItem}) : e(s.options.items, s.element), s]), this.containers.push(s));
            for (n = c.length - 1; n >= 0; n--) for (o = c[n][1], u = c[n][0], r = 0, f = u.length; f > r; r++) a = e(u[r]), a.data(this.widgetName + "-item", o), l.push({
                item: a,
                instance: o,
                width: 0,
                height: 0,
                left: 0,
                top: 0
            })
        },
        refreshPositions: function (t) {
            this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
            var n, r, i, s;
            for (n = this.items.length - 1; n >= 0; n--) r = this.items[n], r.instance !== this.currentContainer && this.currentContainer && r.item[0] !== this.currentItem[0] || (i = this.options.toleranceElement ? e(this.options.toleranceElement, r.item) : r.item, t || (r.width = i.outerWidth(), r.height = i.outerHeight()), s = i.offset(), r.left = s.left, r.top = s.top);
            if (this.options.custom && this.options.custom.refreshContainers) this.options.custom.refreshContainers.call(this); else for (n = this.containers.length - 1; n >= 0; n--) s = this.containers[n].element.offset(), this.containers[n].containerCache.left = s.left, this.containers[n].containerCache.top = s.top, this.containers[n].containerCache.width = this.containers[n].element.outerWidth(), this.containers[n].containerCache.height = this.containers[n].element.outerHeight();
            return this
        },
        _createPlaceholder: function (t) {
            t = t || this;
            var n, r = t.options;
            r.placeholder && r.placeholder.constructor !== String || (n = r.placeholder, r.placeholder = {
                element: function () {
                    var r = t.currentItem[0].nodeName.toLowerCase(),
                        i = e("<" + r + ">", t.document[0]).addClass(n || t.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper");
                    return "tr" === r ? t.currentItem.children().each(function () {
                        e("<td>&#160;</td>", t.document[0]).attr("colspan", e(this).attr("colspan") || 1).appendTo(i)
                    }) : "img" === r && i.attr("src", t.currentItem.attr("src")), n || i.css("visibility", "hidden"), i
                }, update: function (e, i) {
                    (!n || r.forcePlaceholderSize) && (i.height() || i.height(t.currentItem.innerHeight() - parseInt(t.currentItem.css("paddingTop") || 0, 10) - parseInt(t.currentItem.css("paddingBottom") || 0, 10)), i.width() || i.width(t.currentItem.innerWidth() - parseInt(t.currentItem.css("paddingLeft") || 0, 10) - parseInt(t.currentItem.css("paddingRight") || 0, 10)))
                }
            }), t.placeholder = e(r.placeholder.element.call(t.element, t.currentItem)), t.currentItem.after(t.placeholder), r.placeholder.update(t, t.placeholder)
        },
        _contactContainers: function (t) {
            var n, r, i, s, o, u, a, f, l, c, h = null, p = null;
            for (n = this.containers.length - 1; n >= 0; n--) if (!e.contains(this.currentItem[0], this.containers[n].element[0])) if (this._intersectsWith(this.containers[n].containerCache)) {
                if (h && e.contains(this.containers[n].element[0], h.element[0])) continue;
                h = this.containers[n], p = n
            } else this.containers[n].containerCache.over && (this.containers[n]._trigger("out", t, this._uiHash(this)), this.containers[n].containerCache.over = 0);
            if (h) if (1 === this.containers.length) this.containers[p].containerCache.over || (this.containers[p]._trigger("over", t, this._uiHash(this)), this.containers[p].containerCache.over = 1); else {
                for (i = 1e4, s = null, l = h.floating || this._isFloating(this.currentItem), o = l ? "left" : "top", u = l ? "width" : "height", c = l ? "clientX" : "clientY", r = this.items.length - 1; r >= 0; r--) e.contains(this.containers[p].element[0], this.items[r].item[0]) && this.items[r].item[0] !== this.currentItem[0] && (a = this.items[r].item.offset()[o], f = !1, t[c] - a > this.items[r][u] / 2 && (f = !0), i > Math.abs(t[c] - a) && (i = Math.abs(t[c] - a), s = this.items[r], this.direction = f ? "up" : "down"));
                if (!s && !this.options.dropOnEmpty) return;
                if (this.currentContainer === this.containers[p]) return this.currentContainer.containerCache.over || (this.containers[p]._trigger("over", t, this._uiHash()), this.currentContainer.containerCache.over = 1), void 0;
                s ? this._rearrange(t, s, null, !0) : this._rearrange(t, null, this.containers[p].element, !0), this._trigger("change", t, this._uiHash()), this.containers[p]._trigger("change", t, this._uiHash(this)), this.currentContainer = this.containers[p], this.options.placeholder.update(this.currentContainer, this.placeholder), this.containers[p]._trigger("over", t, this._uiHash(this)), this.containers[p].containerCache.over = 1
            }
        },
        _createHelper: function (t) {
            var n = this.options,
                r = e.isFunction(n.helper) ? e(n.helper.apply(this.element[0], [t, this.currentItem])) : "clone" === n.helper ? this.currentItem.clone() : this.currentItem;
            return r.parents("body").length || e("parent" !== n.appendTo ? n.appendTo : this.currentItem[0].parentNode)[0].appendChild(r[0]), r[0] === this.currentItem[0] && (this._storedCSS = {
                width: this.currentItem[0].style.width,
                height: this.currentItem[0].style.height,
                position: this.currentItem.css("position"),
                top: this.currentItem.css("top"),
                left: this.currentItem.css("left")
            }), (!r[0].style.width || n.forceHelperSize) && r.width(this.currentItem.width()), (!r[0].style.height || n.forceHelperSize) && r.height(this.currentItem.height()), r
        },
        _adjustOffsetFromHelper: function (t) {
            "string" == typeof t && (t = t.split(" ")), e.isArray(t) && (t = {
                left: +t[0],
                top: +t[1] || 0
            }), "left" in t && (this.offset.click.left = t.left + this.margins.left), "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left), "top" in t && (this.offset.click.top = t.top + this.margins.top), "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top)
        },
        _getParentOffset: function () {
            this.offsetParent = this.helper.offsetParent();
            var t = this.offsetParent.offset();
            return "absolute" === this.cssPosition && this.scrollParent[0] !== this.document[0] && e.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop()), (this.offsetParent[0] === this.document[0].body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && e.ui.ie) && (t = {
                top: 0,
                left: 0
            }), {
                top: t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function () {
            if ("relative" === this.cssPosition) {
                var e = this.currentItem.position();
                return {
                    top: e.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                    left: e.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                }
            }
            return {top: 0, left: 0}
        },
        _cacheMargins: function () {
            this.margins = {
                left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
                top: parseInt(this.currentItem.css("marginTop"), 10) || 0
            }
        },
        _cacheHelperProportions: function () {
            this.helperProportions = {width: this.helper.outerWidth(), height: this.helper.outerHeight()}
        },
        _setContainment: function () {
            var t, n, r, i = this.options;
            "parent" === i.containment && (i.containment = this.helper[0].parentNode), ("document" === i.containment || "window" === i.containment) && (this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, "document" === i.containment ? this.document.width() : this.window.width() - this.helperProportions.width - this.margins.left, ("document" === i.containment ? this.document.width() : this.window.height() || this.document[0].body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]), /^(document|window|parent)$/.test(i.containment) || (t = e(i.containment)[0], n = e(i.containment).offset(), r = "hidden" !== e(t).css("overflow"), this.containment = [n.left + (parseInt(e(t).css("borderLeftWidth"), 10) || 0) + (parseInt(e(t).css("paddingLeft"), 10) || 0) - this.margins.left, n.top + (parseInt(e(t).css("borderTopWidth"), 10) || 0) + (parseInt(e(t).css("paddingTop"), 10) || 0) - this.margins.top, n.left + (r ? Math.max(t.scrollWidth, t.offsetWidth) : t.offsetWidth) - (parseInt(e(t).css("borderLeftWidth"), 10) || 0) - (parseInt(e(t).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, n.top + (r ? Math.max(t.scrollHeight, t.offsetHeight) : t.offsetHeight) - (parseInt(e(t).css("borderTopWidth"), 10) || 0) - (parseInt(e(t).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top])
        },
        _convertPositionTo: function (t, n) {
            n || (n = this.position);
            var r = "absolute" === t ? 1 : -1,
                i = "absolute" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                s = /(html|body)/i.test(i[0].tagName);
            return {
                top: n.top + this.offset.relative.top * r + this.offset.parent.top * r - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : s ? 0 : i.scrollTop()) * r,
                left: n.left + this.offset.relative.left * r + this.offset.parent.left * r - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : s ? 0 : i.scrollLeft()) * r
            }
        },
        _generatePosition: function (t) {
            var n, r, i = this.options, s = t.pageX, o = t.pageY,
                u = "absolute" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                a = /(html|body)/i.test(u[0].tagName);
            return "relative" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()), this.originalPosition && (this.containment && (t.pageX - this.offset.click.left < this.containment[0] && (s = this.containment[0] + this.offset.click.left), t.pageY - this.offset.click.top < this.containment[1] && (o = this.containment[1] + this.offset.click.top), t.pageX - this.offset.click.left > this.containment[2] && (s = this.containment[2] + this.offset.click.left), t.pageY - this.offset.click.top > this.containment[3] && (o = this.containment[3] + this.offset.click.top)), i.grid && (n = this.originalPageY + Math.round((o - this.originalPageY) / i.grid[1]) * i.grid[1], o = this.containment ? n - this.offset.click.top >= this.containment[1] && n - this.offset.click.top <= this.containment[3] ? n : n - this.offset.click.top >= this.containment[1] ? n - i.grid[1] : n + i.grid[1] : n, r = this.originalPageX + Math.round((s - this.originalPageX) / i.grid[0]) * i.grid[0], s = this.containment ? r - this.offset.click.left >= this.containment[0] && r - this.offset.click.left <= this.containment[2] ? r : r - this.offset.click.left >= this.containment[0] ? r - i.grid[0] : r + i.grid[0] : r)), {
                top: o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : a ? 0 : u.scrollTop()),
                left: s - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : a ? 0 : u.scrollLeft())
            }
        },
        _rearrange: function (e, t, n, r) {
            n ? n[0].appendChild(this.placeholder[0]) : t.item[0].parentNode.insertBefore(this.placeholder[0], "down" === this.direction ? t.item[0] : t.item[0].nextSibling), this.counter = this.counter ? ++this.counter : 1;
            var i = this.counter;
            this._delay(function () {
                i === this.counter && this.refreshPositions(!r)
            })
        },
        _clear: function (e, t) {
            function n(e, t, n) {
                return function (r) {
                    n._trigger(e, r, t._uiHash(t))
                }
            }

            this.reverting = !1;
            var r, i = [];
            if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem), this._noFinalSort = null, this.helper[0] === this.currentItem[0]) {
                for (r in this._storedCSS) ("auto" === this._storedCSS[r] || "static" === this._storedCSS[r]) && (this._storedCSS[r] = "");
                this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
            } else this.currentItem.show();
            for (this.fromOutside && !t && i.push(function (e) {
                this._trigger("receive", e, this._uiHash(this.fromOutside))
            }), !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not(".ui-sortable-helper")[0] && this.domPosition.parent === this.currentItem.parent()[0] || t || i.push(function (e) {
                this._trigger("update", e, this._uiHash())
            }), this !== this.currentContainer && (t || (i.push(function (e) {
                this._trigger("remove", e, this._uiHash())
            }), i.push(function (e) {
                return function (t) {
                    e._trigger("receive", t, this._uiHash(this))
                }
            }.call(this, this.currentContainer)), i.push(function (e) {
                return function (t) {
                    e._trigger("update", t, this._uiHash(this))
                }
            }.call(this, this.currentContainer)))), r = this.containers.length - 1; r >= 0; r--) t || i.push(n("deactivate", this, this.containers[r])), this.containers[r].containerCache.over && (i.push(n("out", this, this.containers[r])), this.containers[r].containerCache.over = 0);
            if (this.storedCursor && (this.document.find("body").css("cursor", this.storedCursor), this.storedStylesheet.remove()), this._storedOpacity && this.helper.css("opacity", this._storedOpacity), this._storedZIndex && this.helper.css("zIndex", "auto" === this._storedZIndex ? "" : this._storedZIndex), this.dragging = !1, t || this._trigger("beforeStop", e, this._uiHash()), this.placeholder[0].parentNode.removeChild(this.placeholder[0]), this.cancelHelperRemoval || (this.helper[0] !== this.currentItem[0] && this.helper.remove(), this.helper = null), !t) {
                for (r = 0; i.length > r; r++) i[r].call(this, e);
                this._trigger("stop", e, this._uiHash())
            }
            return this.fromOutside = !1, !this.cancelHelperRemoval
        },
        _trigger: function () {
            e.Widget.prototype._trigger.apply(this, arguments) === !1 && this.cancel()
        },
        _uiHash: function (t) {
            var n = t || this;
            return {
                helper: n.helper,
                placeholder: n.placeholder || e([]),
                position: n.position,
                originalPosition: n.originalPosition,
                offset: n.positionAbs,
                item: n.currentItem,
                sender: t ? t.element : null
            }
        }
    }), e.widget("ui.spinner", {
        version: "1.11.3",
        defaultElement: "<input>",
        widgetEventPrefix: "spin",
        options: {
            culture: null,
            icons: {down: "ui-icon-triangle-1-s", up: "ui-icon-triangle-1-n"},
            incremental: !0,
            max: null,
            min: null,
            numberFormat: null,
            page: 10,
            step: 1,
            change: null,
            spin: null,
            start: null,
            stop: null
        },
        _create: function () {
            this._setOption("max", this.options.max), this._setOption("min", this.options.min), this._setOption("step", this.options.step), "" !== this.value() && this._value(this.element.val(), !0), this._draw(), this._on(this._events), this._refresh(), this._on(this.window, {
                beforeunload: function () {
                    this.element.removeAttr("autocomplete")
                }
            })
        },
        _getCreateOptions: function () {
            var t = {}, n = this.element;
            return e.each(["min", "max", "step"], function (e, r) {
                var i = n.attr(r);
                void 0 !== i && i.length && (t[r] = i)
            }), t
        },
        _events: {
            keydown: function (e) {
                this._start(e) && this._keydown(e) && e.preventDefault()
            }, keyup: "_stop", focus: function () {
                this.previous = this.element.val()
            }, blur: function (e) {
                return this.cancelBlur ? (delete this.cancelBlur, void 0) : (this._stop(), this._refresh(), this.previous !== this.element.val() && this._trigger("change", e), void 0)
            }, mousewheel: function (e, t) {
                if (t) {
                    if (!this.spinning && !this._start(e)) return !1;
                    this._spin((t > 0 ? 1 : -1) * this.options.step, e), clearTimeout(this.mousewheelTimer), this.mousewheelTimer = this._delay(function () {
                        this.spinning && this._stop(e)
                    }, 100), e.preventDefault()
                }
            }, "mousedown .ui-spinner-button": function (t) {
                function n() {
                    var e = this.element[0] === this.document[0].activeElement;
                    e || (this.element.focus(), this.previous = r, this._delay(function () {
                        this.previous = r
                    }))
                }

                var r;
                r = this.element[0] === this.document[0].activeElement ? this.previous : this.element.val(), t.preventDefault(), n.call(this), this.cancelBlur = !0, this._delay(function () {
                    delete this.cancelBlur, n.call(this)
                }), this._start(t) !== !1 && this._repeat(null, e(t.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, t)
            }, "mouseup .ui-spinner-button": "_stop", "mouseenter .ui-spinner-button": function (t) {
                return e(t.currentTarget).hasClass("ui-state-active") ? this._start(t) === !1 ? !1 : (this._repeat(null, e(t.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, t), void 0) : void 0
            }, "mouseleave .ui-spinner-button": "_stop"
        },
        _draw: function () {
            var e = this.uiSpinner = this.element.addClass("ui-spinner-input").attr("autocomplete", "off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());
            this.element.attr("role", "spinbutton"), this.buttons = e.find(".ui-spinner-button").attr("tabIndex", -1).button().removeClass("ui-corner-all"), this.buttons.height() > Math.ceil(.5 * e.height()) && e.height() > 0 && e.height(e.height()), this.options.disabled && this.disable()
        },
        _keydown: function (t) {
            var n = this.options, r = e.ui.keyCode;
            switch (t.keyCode) {
                case r.UP:
                    return this._repeat(null, 1, t), !0;
                case r.DOWN:
                    return this._repeat(null, -1, t), !0;
                case r.PAGE_UP:
                    return this._repeat(null, n.page, t), !0;
                case r.PAGE_DOWN:
                    return this._repeat(null, -n.page, t), !0
            }
            return !1
        },
        _uiSpinnerHtml: function () {
            return "<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"
        },
        _buttonHtml: function () {
            return "<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon " + this.options.icons.up + "'>&#9650;</span>" + "</a>" + "<a class='ui-spinner-button ui-spinner-down ui-corner-br'>" + "<span class='ui-icon " + this.options.icons.down + "'>&#9660;</span>" + "</a>"
        },
        _start: function (e) {
            return this.spinning || this._trigger("start", e) !== !1 ? (this.counter || (this.counter = 1), this.spinning = !0, !0) : !1
        },
        _repeat: function (e, t, n) {
            e = e || 500, clearTimeout(this.timer), this.timer = this._delay(function () {
                this._repeat(40, t, n)
            }, e), this._spin(t * this.options.step, n)
        },
        _spin: function (e, t) {
            var n = this.value() || 0;
            this.counter || (this.counter = 1), n = this._adjustValue(n + e * this._increment(this.counter)), this.spinning && this._trigger("spin", t, {value: n}) === !1 || (this._value(n), this.counter++)
        },
        _increment: function (t) {
            var n = this.options.incremental;
            return n ? e.isFunction(n) ? n(t) : Math.floor(t * t * t / 5e4 - t * t / 500 + 17 * t / 200 + 1) : 1
        },
        _precision: function () {
            var e = this._precisionOf(this.options.step);
            return null !== this.options.min && (e = Math.max(e, this._precisionOf(this.options.min))), e
        },
        _precisionOf: function (e) {
            var t = "" + e, n = t.indexOf(".");
            return -1 === n ? 0 : t.length - n - 1
        },
        _adjustValue: function (e) {
            var t, n, r = this.options;
            return t = null !== r.min ? r.min : 0, n = e - t, n = Math.round(n / r.step) * r.step, e = t + n, e = parseFloat(e.toFixed(this._precision())), null !== r.max && e > r.max ? r.max : null !== r.min && r.min > e ? r.min : e
        },
        _stop: function (e) {
            this.spinning && (clearTimeout(this.timer), clearTimeout(this.mousewheelTimer), this.counter = 0, this.spinning = !1, this._trigger("stop", e))
        },
        _setOption: function (e, t) {
            if ("culture" === e || "numberFormat" === e) {
                var n = this._parse(this.element.val());
                return this.options[e] = t, this.element.val(this._format(n)), void 0
            }
            ("max" === e || "min" === e || "step" === e) && "string" == typeof t && (t = this._parse(t)), "icons" === e && (this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up), this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)), this._super(e, t), "disabled" === e && (this.widget().toggleClass("ui-state-disabled", !!t), this.element.prop("disabled", !!t), this.buttons.button(t ? "disable" : "enable"))
        },
        _setOptions: a(function (e) {
            this._super(e)
        }),
        _parse: function (e) {
            return "string" == typeof e && "" !== e && (e = window.Globalize && this.options.numberFormat ? Globalize.parseFloat(e, 10, this.options.culture) : +e), "" === e || isNaN(e) ? null : e
        },
        _format: function (e) {
            return "" === e ? "" : window.Globalize && this.options.numberFormat ? Globalize.format(e, this.options.numberFormat, this.options.culture) : e
        },
        _refresh: function () {
            this.element.attr({
                "aria-valuemin": this.options.min,
                "aria-valuemax": this.options.max,
                "aria-valuenow": this._parse(this.element.val())
            })
        },
        isValid: function () {
            var e = this.value();
            return null === e ? !1 : e === this._adjustValue(e)
        },
        _value: function (e, t) {
            var n;
            "" !== e && (n = this._parse(e), null !== n && (t || (n = this._adjustValue(n)), e = this._format(n))), this.element.val(e), this._refresh()
        },
        _destroy: function () {
            this.element.removeClass("ui-spinner-input").prop("disabled", !1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"), this.uiSpinner.replaceWith(this.element)
        },
        stepUp: a(function (e) {
            this._stepUp(e)
        }),
        _stepUp: function (e) {
            this._start() && (this._spin((e || 1) * this.options.step), this._stop())
        },
        stepDown: a(function (e) {
            this._stepDown(e)
        }),
        _stepDown: function (e) {
            this._start() && (this._spin((e || 1) * -this.options.step), this._stop())
        },
        pageUp: a(function (e) {
            this._stepUp((e || 1) * this.options.page)
        }),
        pageDown: a(function (e) {
            this._stepDown((e || 1) * this.options.page)
        }),
        value: function (e) {
            return arguments.length ? (a(this._value).call(this, e), void 0) : this._parse(this.element.val())
        },
        widget: function () {
            return this.uiSpinner
        }
    }), e.widget("ui.tabs", {
        version: "1.11.3",
        delay: 300,
        options: {
            active: null,
            collapsible: !1,
            event: "click",
            heightStyle: "content",
            hide: null,
            show: null,
            activate: null,
            beforeActivate: null,
            beforeLoad: null,
            load: null
        },
        _isLocal: function () {
            var e = /#.*$/;
            return function (t) {
                var n, r;
                t = t.cloneNode(!1), n = t.href.replace(e, ""), r = location.href.replace(e, "");
                try {
                    n = decodeURIComponent(n)
                } catch (i) {
                }
                try {
                    r = decodeURIComponent(r)
                } catch (i) {
                }
                return t.hash.length > 1 && n === r
            }
        }(),
        _create: function () {
            var t = this, n = this.options;
            this.running = !1, this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible", n.collapsible), this._processTabs(), n.active = this._initialActive(), e.isArray(n.disabled) && (n.disabled = e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"), function (e) {
                return t.tabs.index(e)
            }))).sort()), this.active = this.options.active !== !1 && this.anchors.length ? this._findActive(n.active) : e(), this._refresh(), this.active.length && this.load(n.active)
        },
        _initialActive: function () {
            var t = this.options.active, n = this.options.collapsible, r = location.hash.substring(1);
            return null === t && (r && this.tabs.each(function (n, i) {
                return e(i).attr("aria-controls") === r ? (t = n, !1) : void 0
            }), null === t && (t = this.tabs.index(this.tabs.filter(".ui-tabs-active"))), (null === t || -1 === t) && (t = this.tabs.length ? 0 : !1)), t !== !1 && (t = this.tabs.index(this.tabs.eq(t)), -1 === t && (t = n ? !1 : 0)), !n && t === !1 && this.anchors.length && (t = 0), t
        },
        _getCreateEventData: function () {
            return {tab: this.active, panel: this.active.length ? this._getPanelForTab(this.active) : e()}
        },
        _tabKeydown: function (t) {
            var n = e(this.document[0].activeElement).closest("li"), r = this.tabs.index(n), i = !0;
            if (!this._handlePageNav(t)) {
                switch (t.keyCode) {
                    case e.ui.keyCode.RIGHT:
                    case e.ui.keyCode.DOWN:
                        r++;
                        break;
                    case e.ui.keyCode.UP:
                    case e.ui.keyCode.LEFT:
                        i = !1, r--;
                        break;
                    case e.ui.keyCode.END:
                        r = this.anchors.length - 1;
                        break;
                    case e.ui.keyCode.HOME:
                        r = 0;
                        break;
                    case e.ui.keyCode.SPACE:
                        return t.preventDefault(), clearTimeout(this.activating), this._activate(r), void 0;
                    case e.ui.keyCode.ENTER:
                        return t.preventDefault(), clearTimeout(this.activating), this._activate(r === this.options.active ? !1 : r), void 0;
                    default:
                        return
                }
                t.preventDefault(), clearTimeout(this.activating), r = this._focusNextTab(r, i), t.ctrlKey || t.metaKey || (n.attr("aria-selected", "false"), this.tabs.eq(r).attr("aria-selected", "true"), this.activating = this._delay(function () {
                    this.option("active", r)
                }, this.delay))
            }
        },
        _panelKeydown: function (t) {
            this._handlePageNav(t) || t.ctrlKey && t.keyCode === e.ui.keyCode.UP && (t.preventDefault(), this.active.focus())
        },
        _handlePageNav: function (t) {
            return t.altKey && t.keyCode === e.ui.keyCode.PAGE_UP ? (this._activate(this._focusNextTab(this.options.active - 1, !1)), !0) : t.altKey && t.keyCode === e.ui.keyCode.PAGE_DOWN ? (this._activate(this._focusNextTab(this.options.active + 1, !0)), !0) : void 0
        },
        _findNextTab: function (t, n) {
            function r() {
                return t > i && (t = 0), 0 > t && (t = i), t
            }

            for (var i = this.tabs.length - 1; -1 !== e.inArray(r(), this.options.disabled);) t = n ? t + 1 : t - 1;
            return t
        },
        _focusNextTab: function (e, t) {
            return e = this._findNextTab(e, t), this.tabs.eq(e).focus(), e
        },
        _setOption: function (e, t) {
            return "active" === e ? (this._activate(t), void 0) : "disabled" === e ? (this._setupDisabled(t), void 0) : (this._super(e, t), "collapsible" === e && (this.element.toggleClass("ui-tabs-collapsible", t), t || this.options.active !== !1 || this._activate(0)), "event" === e && this._setupEvents(t), "heightStyle" === e && this._setupHeightStyle(t), void 0)
        },
        _sanitizeSelector: function (e) {
            return e ? e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g, "\\$&") : ""
        },
        refresh: function () {
            var t = this.options, n = this.tablist.children(":has(a[href])");
            t.disabled = e.map(n.filter(".ui-state-disabled"), function (e) {
                return n.index(e)
            }), this._processTabs(), t.active !== !1 && this.anchors.length ? this.active.length && !e.contains(this.tablist[0], this.active[0]) ? this.tabs.length === t.disabled.length ? (t.active = !1, this.active = e()) : this._activate(this._findNextTab(Math.max(0, t.active - 1), !1)) : t.active = this.tabs.index(this.active) : (t.active = !1, this.active = e()), this._refresh()
        },
        _refresh: function () {
            this._setupDisabled(this.options.disabled), this._setupEvents(this.options.event), this._setupHeightStyle(this.options.heightStyle), this.tabs.not(this.active).attr({
                "aria-selected": "false",
                "aria-expanded": "false",
                tabIndex: -1
            }), this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden": "true"}), this.active.length ? (this.active.addClass("ui-tabs-active ui-state-active").attr({
                "aria-selected": "true",
                "aria-expanded": "true",
                tabIndex: 0
            }), this._getPanelForTab(this.active).show().attr({"aria-hidden": "false"})) : this.tabs.eq(0).attr("tabIndex", 0)
        },
        _processTabs: function () {
            var t = this, n = this.tabs, r = this.anchors, i = this.panels;
            this.tablist = this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role", "tablist").delegate("> li", "mousedown" + this.eventNamespace, function (t) {
                e(this).is(".ui-state-disabled") && t.preventDefault()
            }).delegate(".ui-tabs-anchor", "focus" + this.eventNamespace, function () {
                e(this).closest("li").is(".ui-state-disabled") && this.blur()
            }), this.tabs = this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({
                role: "tab",
                tabIndex: -1
            }), this.anchors = this.tabs.map(function () {
                return e("a", this)[0]
            }).addClass("ui-tabs-anchor").attr({
                role: "presentation",
                tabIndex: -1
            }), this.panels = e(), this.anchors.each(function (n, r) {
                var i, s, o, u = e(r).uniqueId().attr("id"), a = e(r).closest("li"), f = a.attr("aria-controls");
                t._isLocal(r) ? (i = r.hash, o = i.substring(1), s = t.element.find(t._sanitizeSelector(i))) : (o = a.attr("aria-controls") || e({}).uniqueId()[0].id, i = "#" + o, s = t.element.find(i), s.length || (s = t._createPanel(o), s.insertAfter(t.panels[n - 1] || t.tablist)), s.attr("aria-live", "polite")), s.length && (t.panels = t.panels.add(s)), f && a.data("ui-tabs-aria-controls", f), a.attr({
                    "aria-controls": o,
                    "aria-labelledby": u
                }), s.attr("aria-labelledby", u)
            }), this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role", "tabpanel"), n && (this._off(n.not(this.tabs)), this._off(r.not(this.anchors)), this._off(i.not(this.panels)))
        },
        _getList: function () {
            return this.tablist || this.element.find("ol,ul").eq(0)
        },
        _createPanel: function (t) {
            return e("<div>").attr("id", t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy", !0)
        },
        _setupDisabled: function (t) {
            e.isArray(t) && (t.length ? t.length === this.anchors.length && (t = !0) : t = !1);
            for (var n, r = 0; n = this.tabs[r]; r++) t === !0 || -1 !== e.inArray(r, t) ? e(n).addClass("ui-state-disabled").attr("aria-disabled", "true") : e(n).removeClass("ui-state-disabled").removeAttr("aria-disabled");
            this.options.disabled = t
        },
        _setupEvents: function (t) {
            var n = {};
            t && e.each(t.split(" "), function (e, t) {
                n[t] = "_eventHandler"
            }), this._off(this.anchors.add(this.tabs).add(this.panels)), this._on(!0, this.anchors, {
                click: function (e) {
                    e.preventDefault()
                }
            }), this._on(this.anchors, n), this._on(this.tabs, {keydown: "_tabKeydown"}), this._on(this.panels, {keydown: "_panelKeydown"}), this._focusable(this.tabs), this._hoverable(this.tabs)
        },
        _setupHeightStyle: function (t) {
            var n, r = this.element.parent();
            "fill" === t ? (n = r.height(), n -= this.element.outerHeight() - this.element.height(), this.element.siblings(":visible").each(function () {
                var t = e(this), r = t.css("position");
                "absolute" !== r && "fixed" !== r && (n -= t.outerHeight(!0))
            }), this.element.children().not(this.panels).each(function () {
                n -= e(this).outerHeight(!0)
            }), this.panels.each(function () {
                e(this).height(Math.max(0, n - e(this).innerHeight() + e(this).height()))
            }).css("overflow", "auto")) : "auto" === t && (n = 0, this.panels.each(function () {
                n = Math.max(n, e(this).height("").height())
            }).height(n))
        },
        _eventHandler: function (t) {
            var n = this.options, r = this.active, i = e(t.currentTarget), s = i.closest("li"), o = s[0] === r[0],
                u = o && n.collapsible, a = u ? e() : this._getPanelForTab(s),
                f = r.length ? this._getPanelForTab(r) : e(),
                l = {oldTab: r, oldPanel: f, newTab: u ? e() : s, newPanel: a};
            t.preventDefault(), s.hasClass("ui-state-disabled") || s.hasClass("ui-tabs-loading") || this.running || o && !n.collapsible || this._trigger("beforeActivate", t, l) === !1 || (n.active = u ? !1 : this.tabs.index(s), this.active = o ? e() : s, this.xhr && this.xhr.abort(), f.length || a.length || e.error("jQuery UI Tabs: Mismatching fragment identifier."), a.length && this.load(this.tabs.index(s), t), this._toggle(t, l))
        },
        _toggle: function (t, n) {
            function r() {
                s.running = !1, s._trigger("activate", t, n)
            }

            function i() {
                n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"), o.length && s.options.show ? s._show(o, s.options.show, r) : (o.show(), r())
            }

            var s = this, o = n.newPanel, u = n.oldPanel;
            this.running = !0, u.length && this.options.hide ? this._hide(u, this.options.hide, function () {
                n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"), i()
            }) : (n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"), u.hide(), i()), u.attr("aria-hidden", "true"), n.oldTab.attr({
                "aria-selected": "false",
                "aria-expanded": "false"
            }), o.length && u.length ? n.oldTab.attr("tabIndex", -1) : o.length && this.tabs.filter(function () {
                return 0 === e(this).attr("tabIndex")
            }).attr("tabIndex", -1), o.attr("aria-hidden", "false"), n.newTab.attr({
                "aria-selected": "true",
                "aria-expanded": "true",
                tabIndex: 0
            })
        },
        _activate: function (t) {
            var n, r = this._findActive(t);
            r[0] !== this.active[0] && (r.length || (r = this.active), n = r.find(".ui-tabs-anchor")[0], this._eventHandler({
                target: n,
                currentTarget: n,
                preventDefault: e.noop
            }))
        },
        _findActive: function (t) {
            return t === !1 ? e() : this.tabs.eq(t)
        },
        _getIndex: function (e) {
            return "string" == typeof e && (e = this.anchors.index(this.anchors.filter("[href$='" + e + "']"))), e
        },
        _destroy: function () {
            this.xhr && this.xhr.abort(), this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"), this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"), this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(), this.tablist.unbind(this.eventNamespace), this.tabs.add(this.panels).each(function () {
                e.data(this, "ui-tabs-destroy") ? e(this).remove() : e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")
            }), this.tabs.each(function () {
                var t = e(this), n = t.data("ui-tabs-aria-controls");
                n ? t.attr("aria-controls", n).removeData("ui-tabs-aria-controls") : t.removeAttr("aria-controls")
            }), this.panels.show(), "content" !== this.options.heightStyle && this.panels.css("height", "")
        },
        enable: function (t) {
            var n = this.options.disabled;
            n !== !1 && (void 0 === t ? n = !1 : (t = this._getIndex(t), n = e.isArray(n) ? e.map(n, function (e) {
                return e !== t ? e : null
            }) : e.map(this.tabs, function (e, n) {
                return n !== t ? n : null
            })), this._setupDisabled(n))
        },
        disable: function (t) {
            var n = this.options.disabled;
            if (n !== !0) {
                if (void 0 === t) n = !0; else {
                    if (t = this._getIndex(t), -1 !== e.inArray(t, n)) return;
                    n = e.isArray(n) ? e.merge([t], n).sort() : [t]
                }
                this._setupDisabled(n)
            }
        },
        load: function (t, n) {
            t = this._getIndex(t);
            var r = this, i = this.tabs.eq(t), s = i.find(".ui-tabs-anchor"), o = this._getPanelForTab(i),
                u = {tab: i, panel: o};
            this._isLocal(s[0]) || (this.xhr = e.ajax(this._ajaxSettings(s, n, u)), this.xhr && "canceled" !== this.xhr.statusText && (i.addClass("ui-tabs-loading"), o.attr("aria-busy", "true"), this.xhr.success(function (e) {
                setTimeout(function () {
                    o.html(e), r._trigger("load", n, u)
                }, 1)
            }).complete(function (e, t) {
                setTimeout(function () {
                    "abort" === t && r.panels.stop(!1, !0), i.removeClass("ui-tabs-loading"), o.removeAttr("aria-busy"), e === r.xhr && delete r.xhr
                }, 1)
            })))
        },
        _ajaxSettings: function (t, n, r) {
            var i = this;
            return {
                url: t.attr("href"), beforeSend: function (t, s) {
                    return i._trigger("beforeLoad", n, e.extend({jqXHR: t, ajaxSettings: s}, r))
                }
            }
        },
        _getPanelForTab: function (t) {
            var n = e(t).attr("aria-controls");
            return this.element.find(this._sanitizeSelector("#" + n))
        }
    }), e.widget("ui.tooltip", {
        version: "1.11.3", options: {
            content: function () {
                var t = e(this).attr("title") || "";
                return e("<a>").text(t).html()
            },
            hide: !0,
            items: "[title]:not([disabled])",
            position: {my: "left top+15", at: "left bottom", collision: "flipfit flip"},
            show: !0,
            tooltipClass: null,
            track: !1,
            close: null,
            open: null
        }, _addDescribedBy: function (t, n) {
            var r = (t.attr("aria-describedby") || "").split(/\s+/);
            r.push(n), t.data("ui-tooltip-id", n).attr("aria-describedby", e.trim(r.join(" ")))
        }, _removeDescribedBy: function (t) {
            var n = t.data("ui-tooltip-id"), r = (t.attr("aria-describedby") || "").split(/\s+/), i = e.inArray(n, r);
            -1 !== i && r.splice(i, 1), t.removeData("ui-tooltip-id"), r = e.trim(r.join(" ")), r ? t.attr("aria-describedby", r) : t.removeAttr("aria-describedby")
        }, _create: function () {
            this._on({
                mouseover: "open",
                focusin: "open"
            }), this.tooltips = {}, this.parents = {}, this.options.disabled && this._disable(), this.liveRegion = e("<div>").attr({
                role: "log",
                "aria-live": "assertive",
                "aria-relevant": "additions"
            }).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)
        }, _setOption: function (t, n) {
            var r = this;
            return "disabled" === t ? (this[n ? "_disable" : "_enable"](), this.options[t] = n, void 0) : (this._super(t, n), "content" === t && e.each(this.tooltips, function (e, t) {
                r._updateContent(t.element)
            }), void 0)
        }, _disable: function () {
            var t = this;
            e.each(this.tooltips, function (n, r) {
                var i = e.Event("blur");
                i.target = i.currentTarget = r.element[0], t.close(i, !0)
            }), this.element.find(this.options.items).addBack().each(function () {
                var t = e(this);
                t.is("[title]") && t.data("ui-tooltip-title", t.attr("title")).removeAttr("title")
            })
        }, _enable: function () {
            this.element.find(this.options.items).addBack().each(function () {
                var t = e(this);
                t.data("ui-tooltip-title") && t.attr("title", t.data("ui-tooltip-title"))
            })
        }, open: function (t) {
            var n = this, r = e(t ? t.target : this.element).closest(this.options.items);
            r.length && !r.data("ui-tooltip-id") && (r.attr("title") && r.data("ui-tooltip-title", r.attr("title")), r.data("ui-tooltip-open", !0), t && "mouseover" === t.type && r.parents().each(function () {
                var t, r = e(this);
                r.data("ui-tooltip-open") && (t = e.Event("blur"), t.target = t.currentTarget = this, n.close(t, !0)), r.attr("title") && (r.uniqueId(), n.parents[this.id] = {
                    element: this,
                    title: r.attr("title")
                }, r.attr("title", ""))
            }), this._updateContent(r, t))
        }, _updateContent: function (e, t) {
            var n, r = this.options.content, i = this, s = t ? t.type : null;
            return "string" == typeof r ? this._open(t, e, r) : (n = r.call(e[0], function (n) {
                e.data("ui-tooltip-open") && i._delay(function () {
                    t && (t.type = s), this._open(t, e, n)
                })
            }), n && this._open(t, e, n), void 0)
        }, _open: function (t, n, r) {
            function i(e) {
                l.of = e, o.is(":hidden") || o.position(l)
            }

            var s, o, u, a, f, l = e.extend({}, this.options.position);
            if (r) {
                if (s = this._find(n)) return s.tooltip.find(".ui-tooltip-content").html(r), void 0;
                n.is("[title]") && (t && "mouseover" === t.type ? n.attr("title", "") : n.removeAttr("title")), s = this._tooltip(n), o = s.tooltip, this._addDescribedBy(n, o.attr("id")), o.find(".ui-tooltip-content").html(r), this.liveRegion.children().hide(), r.clone ? (f = r.clone(), f.removeAttr("id").find("[id]").removeAttr("id")) : f = r, e("<div>").html(f).appendTo(this.liveRegion), this.options.track && t && /^mouse/.test(t.type) ? (this._on(this.document, {mousemove: i}), i(t)) : o.position(e.extend({of: n}, this.options.position)), o.hide(), this._show(o, this.options.show), this.options.show && this.options.show.delay && (a = this.delayedShow = setInterval(function () {
                    o.is(":visible") && (i(l.of), clearInterval(a))
                }, e.fx.interval)), this._trigger("open", t, {tooltip: o}), u = {
                    keyup: function (t) {
                        if (t.keyCode === e.ui.keyCode.ESCAPE) {
                            var r = e.Event(t);
                            r.currentTarget = n[0], this.close(r, !0)
                        }
                    }
                }, n[0] !== this.element[0] && (u.remove = function () {
                    this._removeTooltip(o)
                }), t && "mouseover" !== t.type || (u.mouseleave = "close"), t && "focusin" !== t.type || (u.focusout = "close"), this._on(!0, n, u)
            }
        }, close: function (t) {
            var n, r = this, i = e(t ? t.currentTarget : this.element), s = this._find(i);
            s && (n = s.tooltip, s.closing || (clearInterval(this.delayedShow), i.data("ui-tooltip-title") && !i.attr("title") && i.attr("title", i.data("ui-tooltip-title")), this._removeDescribedBy(i), s.hiding = !0, n.stop(!0), this._hide(n, this.options.hide, function () {
                r._removeTooltip(e(this))
            }), i.removeData("ui-tooltip-open"), this._off(i, "mouseleave focusout keyup"), i[0] !== this.element[0] && this._off(i, "remove"), this._off(this.document, "mousemove"), t && "mouseleave" === t.type && e.each(this.parents, function (t, n) {
                e(n.element).attr("title", n.title), delete r.parents[t]
            }), s.closing = !0, this._trigger("close", t, {tooltip: n}), s.hiding || (s.closing = !1)))
        }, _tooltip: function (t) {
            var n = e("<div>").attr("role", "tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content " + (this.options.tooltipClass || "")),
                r = n.uniqueId().attr("id");
            return e("<div>").addClass("ui-tooltip-content").appendTo(n), n.appendTo(this.document[0].body), this.tooltips[r] = {
                element: t,
                tooltip: n
            }
        }, _find: function (e) {
            var t = e.data("ui-tooltip-id");
            return t ? this.tooltips[t] : null
        }, _removeTooltip: function (e) {
            e.remove(), delete this.tooltips[e.attr("id")]
        }, _destroy: function () {
            var t = this;
            e.each(this.tooltips, function (n, r) {
                var i = e.Event("blur"), s = r.element;
                i.target = i.currentTarget = s[0], t.close(i, !0), e("#" + n).remove(), s.data("ui-tooltip-title") && (s.attr("title") || s.attr("title", s.data("ui-tooltip-title")), s.removeData("ui-tooltip-title"))
            }), this.liveRegion.remove()
        }
    })
}), function (e) {
    e.color = {}, e.color.make = function (t, n, r, i) {
        var s = {};
        return s.r = t || 0, s.g = n || 0, s.b = r || 0, s.a = i != null ? i : 1, s.add = function (e, t) {
            for (var n = 0; n < e.length; ++n) s[e.charAt(n)] += t;
            return s.normalize()
        }, s.scale = function (e, t) {
            for (var n = 0; n < e.length; ++n) s[e.charAt(n)] *= t;
            return s.normalize()
        }, s.toString = function () {
            return s.a >= 1 ? "rgb(" + [s.r, s.g, s.b].join(",") + ")" : "rgba(" + [s.r, s.g, s.b, s.a].join(",") + ")"
        }, s.normalize = function () {
            function e(e, t, n) {
                return t < e ? e : t > n ? n : t
            }

            return s.r = e(0, parseInt(s.r), 255), s.g = e(0, parseInt(s.g), 255), s.b = e(0, parseInt(s.b), 255), s.a = e(0, s.a, 1), s
        }, s.clone = function () {
            return e.color.make(s.r, s.b, s.g, s.a)
        }, s.normalize()
    }, e.color.extract = function (t, n) {
        var r;
        do {
            r = t.css(n).toLowerCase();
            if (r != "" && r != "transparent") break;
            t = t.parent()
        } while (t.length && !e.nodeName(t.get(0), "body"));
        return r == "rgba(0, 0, 0, 0)" && (r = "transparent"), e.color.parse(r)
    }, e.color.parse = function (n) {
        var r, i = e.color.make;
        if (r = /rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n)) return i(parseInt(r[1], 10), parseInt(r[2], 10), parseInt(r[3], 10));
        if (r = /rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n)) return i(parseInt(r[1], 10), parseInt(r[2], 10), parseInt(r[3], 10), parseFloat(r[4]));
        if (r = /rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n)) return i(parseFloat(r[1]) * 2.55, parseFloat(r[2]) * 2.55, parseFloat(r[3]) * 2.55);
        if (r = /rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n)) return i(parseFloat(r[1]) * 2.55, parseFloat(r[2]) * 2.55, parseFloat(r[3]) * 2.55, parseFloat(r[4]));
        if (r = /#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n)) return i(parseInt(r[1], 16), parseInt(r[2], 16), parseInt(r[3], 16));
        if (r = /#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n)) return i(parseInt(r[1] + r[1], 16), parseInt(r[2] + r[2], 16), parseInt(r[3] + r[3], 16));
        var s = e.trim(n).toLowerCase();
        return s == "transparent" ? i(255, 255, 255, 0) : (r = t[s] || [0, 0, 0], i(r[0], r[1], r[2]))
    };
    var t = {
        aqua: [0, 255, 255],
        azure: [240, 255, 255],
        beige: [245, 245, 220],
        black: [0, 0, 0],
        blue: [0, 0, 255],
        brown: [165, 42, 42],
        cyan: [0, 255, 255],
        darkblue: [0, 0, 139],
        darkcyan: [0, 139, 139],
        darkgrey: [169, 169, 169],
        darkgreen: [0, 100, 0],
        darkkhaki: [189, 183, 107],
        darkmagenta: [139, 0, 139],
        darkolivegreen: [85, 107, 47],
        darkorange: [255, 140, 0],
        darkorchid: [153, 50, 204],
        darkred: [139, 0, 0],
        darksalmon: [233, 150, 122],
        darkviolet: [148, 0, 211],
        fuchsia: [255, 0, 255],
        gold: [255, 215, 0],
        green: [0, 128, 0],
        indigo: [75, 0, 130],
        khaki: [240, 230, 140],
        lightblue: [173, 216, 230],
        lightcyan: [224, 255, 255],
        lightgreen: [144, 238, 144],
        lightgrey: [211, 211, 211],
        lightpink: [255, 182, 193],
        lightyellow: [255, 255, 224],
        lime: [0, 255, 0],
        magenta: [255, 0, 255],
        maroon: [128, 0, 0],
        navy: [0, 0, 128],
        olive: [128, 128, 0],
        orange: [255, 165, 0],
        pink: [255, 192, 203],
        purple: [128, 0, 128],
        violet: [128, 0, 128],
        red: [255, 0, 0],
        silver: [192, 192, 192],
        white: [255, 255, 255],
        yellow: [255, 255, 0]
    }
}(jQuery), function (e) {
    function n(t, n) {
        var r = n.children("." + t)[0];
        if (r == null) {
            r = document.createElement("canvas"), r.className = t, e(r).css({
                direction: "ltr",
                position: "absolute",
                left: 0,
                top: 0
            }).appendTo(n);
            if (!r.getContext) {
                if (!window.G_vmlCanvasManager) throw new Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");
                r = window.G_vmlCanvasManager.initElement(r)
            }
        }
        this.element = r;
        var i = this.context = r.getContext("2d"), s = window.devicePixelRatio || 1,
            o = i.webkitBackingStorePixelRatio || i.mozBackingStorePixelRatio || i.msBackingStorePixelRatio || i.oBackingStorePixelRatio || i.backingStorePixelRatio || 1;
        this.pixelRatio = s / o, this.resize(n.width(), n.height()), this.textContainer = null, this.text = {}, this._textCache = {}
    }

    function r(t, r, s, o) {
        function E(e, t) {
            t = [w].concat(t);
            for (var n = 0; n < e.length; ++n) e[n].apply(this, t)
        }

        function S() {
            var t = {Canvas: n};
            for (var r = 0; r < o.length; ++r) {
                var i = o[r];
                i.init(w, t), i.options && e.extend(!0, a, i.options)
            }
        }

        function x(n) {
            e.extend(!0, a, n), n && n.colors && (a.colors = n.colors), a.xaxis.color == null && (a.xaxis.color = e.color.parse(a.grid.color).scale("a", .22).toString()), a.yaxis.color == null && (a.yaxis.color = e.color.parse(a.grid.color).scale("a", .22).toString()), a.xaxis.tickColor == null && (a.xaxis.tickColor = a.grid.tickColor || a.xaxis.color), a.yaxis.tickColor == null && (a.yaxis.tickColor = a.grid.tickColor || a.yaxis.color), a.grid.borderColor == null && (a.grid.borderColor = a.grid.color), a.grid.tickColor == null && (a.grid.tickColor = e.color.parse(a.grid.color).scale("a", .22).toString());
            var r, i, s, o = t.css("font-size"), u = o ? +o.replace("px", "") : 13, f = {
                style: t.css("font-style"),
                size: Math.round(.8 * u),
                variant: t.css("font-variant"),
                weight: t.css("font-weight"),
                family: t.css("font-family")
            };
            s = a.xaxes.length || 1;
            for (r = 0; r < s; ++r) i = a.xaxes[r], i && !i.tickColor && (i.tickColor = i.color), i = e.extend(!0, {}, a.xaxis, i), a.xaxes[r] = i, i.font && (i.font = e.extend({}, f, i.font), i.font.color || (i.font.color = i.color), i.font.lineHeight || (i.font.lineHeight = Math.round(i.font.size * 1.15)));
            s = a.yaxes.length || 1;
            for (r = 0; r < s; ++r) i = a.yaxes[r], i && !i.tickColor && (i.tickColor = i.color), i = e.extend(!0, {}, a.yaxis, i), a.yaxes[r] = i, i.font && (i.font = e.extend({}, f, i.font), i.font.color || (i.font.color = i.color), i.font.lineHeight || (i.font.lineHeight = Math.round(i.font.size * 1.15)));
            a.xaxis.noTicks && a.xaxis.ticks == null && (a.xaxis.ticks = a.xaxis.noTicks), a.yaxis.noTicks && a.yaxis.ticks == null && (a.yaxis.ticks = a.yaxis.noTicks), a.x2axis && (a.xaxes[1] = e.extend(!0, {}, a.xaxis, a.x2axis), a.xaxes[1].position = "top", a.x2axis.min == null && (a.xaxes[1].min = null), a.x2axis.max == null && (a.xaxes[1].max = null)), a.y2axis && (a.yaxes[1] = e.extend(!0, {}, a.yaxis, a.y2axis), a.yaxes[1].position = "right", a.y2axis.min == null && (a.yaxes[1].min = null), a.y2axis.max == null && (a.yaxes[1].max = null)), a.grid.coloredAreas && (a.grid.markings = a.grid.coloredAreas), a.grid.coloredAreasColor && (a.grid.markingsColor = a.grid.coloredAreasColor), a.lines && e.extend(!0, a.series.lines, a.lines), a.points && e.extend(!0, a.series.points, a.points), a.bars && e.extend(!0, a.series.bars, a.bars), a.shadowSize != null && (a.series.shadowSize = a.shadowSize), a.highlightColor != null && (a.series.highlightColor = a.highlightColor);
            for (r = 0; r < a.xaxes.length; ++r) O(d, r + 1).options = a.xaxes[r];
            for (r = 0; r < a.yaxes.length; ++r) O(v, r + 1).options = a.yaxes[r];
            for (var l in b) a.hooks[l] && a.hooks[l].length && (b[l] = b[l].concat(a.hooks[l]));
            E(b.processOptions, [a])
        }

        function T(e) {
            u = N(e), M(), _()
        }

        function N(t) {
            var n = [];
            for (var r = 0; r < t.length; ++r) {
                var i = e.extend(!0, {}, a.series);
                t[r].data != null ? (i.data = t[r].data, delete t[r].data, e.extend(!0, i, t[r]), t[r].data = i.data) : i.data = t[r], n.push(i)
            }
            return n
        }

        function C(e, t) {
            var n = e[t + "axis"];
            return typeof n == "object" && (n = n.n), typeof n != "number" && (n = 1), n
        }

        function k() {
            return e.grep(d.concat(v), function (e) {
                return e
            })
        }

        function L(e) {
            var t = {}, n, r;
            for (n = 0; n < d.length; ++n) r = d[n], r && r.used && (t["x" + r.n] = r.c2p(e.left));
            for (n = 0; n < v.length; ++n) r = v[n], r && r.used && (t["y" + r.n] = r.c2p(e.top));
            return t.x1 !== undefined && (t.x = t.x1), t.y1 !== undefined && (t.y = t.y1), t
        }

        function A(e) {
            var t = {}, n, r, i;
            for (n = 0; n < d.length; ++n) {
                r = d[n];
                if (r && r.used) {
                    i = "x" + r.n, e[i] == null && r.n == 1 && (i = "x");
                    if (e[i] != null) {
                        t.left = r.p2c(e[i]);
                        break
                    }
                }
            }
            for (n = 0; n < v.length; ++n) {
                r = v[n];
                if (r && r.used) {
                    i = "y" + r.n, e[i] == null && r.n == 1 && (i = "y");
                    if (e[i] != null) {
                        t.top = r.p2c(e[i]);
                        break
                    }
                }
            }
            return t
        }

        function O(t, n) {
            return t[n - 1] || (t[n - 1] = {
                n: n,
                direction: t == d ? "x" : "y",
                options: e.extend(!0, {}, t == d ? a.xaxis : a.yaxis)
            }), t[n - 1]
        }

        function M() {
            var t = u.length, n = -1, r;
            for (r = 0; r < u.length; ++r) {
                var i = u[r].color;
                i != null && (t--, typeof i == "number" && i > n && (n = i))
            }
            t <= n && (t = n + 1);
            var s, o = [], f = a.colors, l = f.length, c = 0;
            for (r = 0; r < t; r++) s = e.color.parse(f[r % l] || "#666"), r % l == 0 && r && (c >= 0 ? c < .5 ? c = -c - .2 : c = 0 : c = -c), o[r] = s.scale("rgb", 1 + c);
            var h = 0, p;
            for (r = 0; r < u.length; ++r) {
                p = u[r], p.color == null ? (p.color = o[h].toString(), ++h) : typeof p.color == "number" && (p.color = o[p.color].toString());
                if (p.lines.show == null) {
                    var m, g = !0;
                    for (m in p) if (p[m] && p[m].show) {
                        g = !1;
                        break
                    }
                    g && (p.lines.show = !0)
                }
                p.lines.zero == null && (p.lines.zero = !!p.lines.fill), p.xaxis = O(d, C(p, "x")), p.yaxis = O(v, C(p, "y"))
            }
        }

        function _() {
            function x(e, t, n) {
                t < e.datamin && t != -r && (e.datamin = t), n > e.datamax && n != r && (e.datamax = n)
            }

            var t = Number.POSITIVE_INFINITY, n = Number.NEGATIVE_INFINITY, r = Number.MAX_VALUE, i, s, o, a, f, l, c,
                h, p, d, v, m, g, y, w, S;
            e.each(k(), function (e, r) {
                r.datamin = t, r.datamax = n, r.used = !1
            });
            for (i = 0; i < u.length; ++i) l = u[i], l.datapoints = {points: []}, E(b.processRawData, [l, l.data, l.datapoints]);
            for (i = 0; i < u.length; ++i) {
                l = u[i], w = l.data, S = l.datapoints.format;
                if (!S) {
                    S = [], S.push({x: !0, number: !0, required: !0}), S.push({y: !0, number: !0, required: !0});
                    if (l.bars.show || l.lines.show && l.lines.fill) {
                        var T = !!(l.bars.show && l.bars.zero || l.lines.show && l.lines.zero);
                        S.push({
                            y: !0,
                            number: !0,
                            required: !1,
                            defaultValue: 0,
                            autoscale: T
                        }), l.bars.horizontal && (delete S[S.length - 1].y, S[S.length - 1].x = !0)
                    }
                    l.datapoints.format = S
                }
                if (l.datapoints.pointsize != null) continue;
                l.datapoints.pointsize = S.length, h = l.datapoints.pointsize, c = l.datapoints.points;
                var N = l.lines.show && l.lines.steps;
                l.xaxis.used = l.yaxis.used = !0;
                for (s = o = 0; s < w.length; ++s, o += h) {
                    y = w[s];
                    var C = y == null;
                    if (!C) for (a = 0; a < h; ++a) m = y[a], g = S[a], g && (g.number && m != null && (m = +m, isNaN(m) ? m = null : m == Infinity ? m = r : m == -Infinity && (m = -r)), m == null && (g.required && (C = !0), g.defaultValue != null && (m = g.defaultValue))), c[o + a] = m;
                    if (C) for (a = 0; a < h; ++a) m = c[o + a], m != null && (g = S[a], g.autoscale !== !1 && (g.x && x(l.xaxis, m, m), g.y && x(l.yaxis, m, m))), c[o + a] = null; else if (N && o > 0 && c[o - h] != null && c[o - h] != c[o] && c[o - h + 1] != c[o + 1]) {
                        for (a = 0; a < h; ++a) c[o + h + a] = c[o + a];
                        c[o + 1] = c[o - h + 1], o += h
                    }
                }
            }
            for (i = 0; i < u.length; ++i) l = u[i], E(b.processDatapoints, [l, l.datapoints]);
            for (i = 0; i < u.length; ++i) {
                l = u[i], c = l.datapoints.points, h = l.datapoints.pointsize, S = l.datapoints.format;
                var L = t, A = t, O = n, M = n;
                for (s = 0; s < c.length; s += h) {
                    if (c[s] == null) continue;
                    for (a = 0; a < h; ++a) {
                        m = c[s + a], g = S[a];
                        if (!g || g.autoscale === !1 || m == r || m == -r) continue;
                        g.x && (m < L && (L = m), m > O && (O = m)), g.y && (m < A && (A = m), m > M && (M = m))
                    }
                }
                if (l.bars.show) {
                    var _;
                    switch (l.bars.align) {
                        case"left":
                            _ = 0;
                            break;
                        case"right":
                            _ = -l.bars.barWidth;
                            break;
                        default:
                            _ = -l.bars.barWidth / 2
                    }
                    l.bars.horizontal ? (A += _, M += _ + l.bars.barWidth) : (L += _, O += _ + l.bars.barWidth)
                }
                x(l.xaxis, L, O), x(l.yaxis, A, M)
            }
            e.each(k(), function (e, r) {
                r.datamin == t && (r.datamin = null), r.datamax == n && (r.datamax = null)
            })
        }

        function D() {
            t.css("padding", 0).children().filter(function () {
                return !e(this).hasClass("flot-overlay") && !e(this).hasClass("flot-base")
            }).remove(), t.css("position") == "static" && t.css("position", "relative"), f = new n("flot-base", t), l = new n("flot-overlay", t), h = f.context, p = l.context, c = e(l.element).unbind();
            var r = t.data("plot");
            r && (r.shutdown(), l.clear()), t.data("plot", w)
        }

        function P() {
            a.grid.hoverable && (c.mousemove(at), c.bind("mouseleave", ft)), a.grid.clickable && c.click(lt), E(b.bindEvents, [c])
        }

        function H() {
            ot && clearTimeout(ot), c.unbind("mousemove", at), c.unbind("mouseleave", ft), c.unbind("click", lt), E(b.shutdown, [c])
        }

        function B(e) {
            function t(e) {
                return e
            }

            var n, r, i = e.options.transform || t, s = e.options.inverseTransform;
            e.direction == "x" ? (n = e.scale = g / Math.abs(i(e.max) - i(e.min)), r = Math.min(i(e.max), i(e.min))) : (n = e.scale = y / Math.abs(i(e.max) - i(e.min)), n = -n, r = Math.max(i(e.max), i(e.min))), i == t ? e.p2c = function (e) {
                return (e - r) * n
            } : e.p2c = function (e) {
                return (i(e) - r) * n
            }, s ? e.c2p = function (e) {
                return s(r + e / n)
            } : e.c2p = function (e) {
                return r + e / n
            }
        }

        function j(e) {
            var t = e.options, n = e.ticks || [], r = t.labelWidth || 0, i = t.labelHeight || 0,
                s = r || (e.direction == "x" ? Math.floor(f.width / (n.length || 1)) : null),
                o = e.direction + "Axis " + e.direction + e.n + "Axis",
                u = "flot-" + e.direction + "-axis flot-" + e.direction + e.n + "-axis " + o,
                a = t.font || "flot-tick-label tickLabel";
            for (var l = 0; l < n.length; ++l) {
                var c = n[l];
                if (!c.label) continue;
                var h = f.getTextInfo(u, c.label, a, null, s);
                r = Math.max(r, h.width), i = Math.max(i, h.height)
            }
            e.labelWidth = t.labelWidth || r, e.labelHeight = t.labelHeight || i
        }

        function F(t) {
            var n = t.labelWidth, r = t.labelHeight, i = t.options.position, s = t.direction === "x",
                o = t.options.tickLength, u = a.grid.axisMargin, l = a.grid.labelMargin, c = !0, h = !0, p = !0, g = !1;
            e.each(s ? d : v, function (e, n) {
                n && (n.show || n.reserveSpace) && (n === t ? g = !0 : n.options.position === i && (g ? h = !1 : c = !1), g || (p = !1))
            }), h && (u = 0), o == null && (o = p ? "full" : 5), isNaN(+o) || (l += +o), s ? (r += l, i == "bottom" ? (m.bottom += r + u, t.box = {
                top: f.height - m.bottom,
                height: r
            }) : (t.box = {
                top: m.top + u,
                height: r
            }, m.top += r + u)) : (n += l, i == "left" ? (t.box = {
                left: m.left + u,
                width: n
            }, m.left += n + u) : (m.right += n + u, t.box = {
                left: f.width - m.right,
                width: n
            })), t.position = i, t.tickLength = o, t.box.padding = l, t.innermost = c
        }

        function I(e) {
            e.direction == "x" ? (e.box.left = m.left - e.labelWidth / 2, e.box.width = f.width - m.left - m.right + e.labelWidth) : (e.box.top = m.top - e.labelHeight / 2, e.box.height = f.height - m.bottom - m.top + e.labelHeight)
        }

        function q() {
            var t = a.grid.minBorderMargin, n, r;
            if (t == null) {
                t = 0;
                for (r = 0; r < u.length; ++r) t = Math.max(t, 2 * (u[r].points.radius + u[r].points.lineWidth / 2))
            }
            var i = {left: t, right: t, top: t, bottom: t};
            e.each(k(), function (e, t) {
                t.reserveSpace && t.ticks && t.ticks.length && (t.direction === "x" ? (i.left = Math.max(i.left, t.labelWidth / 2), i.right = Math.max(i.right, t.labelWidth / 2)) : (i.bottom = Math.max(i.bottom, t.labelHeight / 2), i.top = Math.max(i.top, t.labelHeight / 2)))
            }), m.left = Math.ceil(Math.max(i.left, m.left)), m.right = Math.ceil(Math.max(i.right, m.right)), m.top = Math.ceil(Math.max(i.top, m.top)), m.bottom = Math.ceil(Math.max(i.bottom, m.bottom))
        }

        function R() {
            var t, n = k(), r = a.grid.show;
            for (var i in m) {
                var s = a.grid.margin || 0;
                m[i] = typeof s == "number" ? s : s[i] || 0
            }
            E(b.processOffset, [m]);
            for (var i in m) typeof a.grid.borderWidth == "object" ? m[i] += r ? a.grid.borderWidth[i] : 0 : m[i] += r ? a.grid.borderWidth : 0;
            e.each(n, function (e, t) {
                var n = t.options;
                t.show = n.show == null ? t.used : n.show, t.reserveSpace = n.reserveSpace == null ? t.show : n.reserveSpace, U(t)
            });
            if (r) {
                var o = e.grep(n, function (e) {
                    return e.show || e.reserveSpace
                });
                e.each(o, function (e, t) {
                    z(t), W(t), X(t, t.ticks), j(t)
                });
                for (t = o.length - 1; t >= 0; --t) F(o[t]);
                q(), e.each(o, function (e, t) {
                    I(t)
                })
            }
            g = f.width - m.left - m.right, y = f.height - m.bottom - m.top, e.each(n, function (e, t) {
                B(t)
            }), r && G(), it()
        }

        function U(e) {
            var t = e.options, n = +(t.min != null ? t.min : e.datamin), r = +(t.max != null ? t.max : e.datamax),
                i = r - n;
            if (i == 0) {
                var s = r == 0 ? 1 : .01;
                t.min == null && (n -= s);
                if (t.max == null || t.min != null) r += s
            } else {
                var o = t.autoscaleMargin;
                o != null && (t.min == null && (n -= i * o, n < 0 && e.datamin != null && e.datamin >= 0 && (n = 0)), t.max == null && (r += i * o, r > 0 && e.datamax != null && e.datamax <= 0 && (r = 0)))
            }
            e.min = n, e.max = r
        }

        function z(t) {
            var n = t.options, r;
            typeof n.ticks == "number" && n.ticks > 0 ? r = n.ticks : r = .3 * Math.sqrt(t.direction == "x" ? f.width : f.height);
            var s = (t.max - t.min) / r, o = -Math.floor(Math.log(s) / Math.LN10), u = n.tickDecimals;
            u != null && o > u && (o = u);
            var a = Math.pow(10, -o), l = s / a, c;
            l < 1.5 ? c = 1 : l < 3 ? (c = 2, l > 2.25 && (u == null || o + 1 <= u) && (c = 2.5, ++o)) : l < 7.5 ? c = 5 : c = 10, c *= a, n.minTickSize != null && c < n.minTickSize && (c = n.minTickSize), t.delta = s, t.tickDecimals = Math.max(0, u != null ? u : o), t.tickSize = n.tickSize || c;
            if (n.mode == "time" && !t.tickGenerator) throw new Error("Time mode requires the flot.time plugin.");
            t.tickGenerator || (t.tickGenerator = function (e) {
                var t = [], n = i(e.min, e.tickSize), r = 0, s = Number.NaN, o;
                do o = s, s = n + r * e.tickSize, t.push(s), ++r; while (s < e.max && s != o);
                return t
            }, t.tickFormatter = function (e, t) {
                var n = t.tickDecimals ? Math.pow(10, t.tickDecimals) : 1, r = "" + Math.round(e * n) / n;
                if (t.tickDecimals != null) {
                    var i = r.indexOf("."), s = i == -1 ? 0 : r.length - i - 1;
                    if (s < t.tickDecimals) return (s ? r : r + ".") + ("" + n).substr(1, t.tickDecimals - s)
                }
                return r
            }), e.isFunction(n.tickFormatter) && (t.tickFormatter = function (e, t) {
                return "" + n.tickFormatter(e, t)
            });
            if (n.alignTicksWithAxis != null) {
                var h = (t.direction == "x" ? d : v)[n.alignTicksWithAxis - 1];
                if (h && h.used && h != t) {
                    var p = t.tickGenerator(t);
                    p.length > 0 && (n.min == null && (t.min = Math.min(t.min, p[0])), n.max == null && p.length > 1 && (t.max = Math.max(t.max, p[p.length - 1]))), t.tickGenerator = function (e) {
                        var t = [], n, r;
                        for (r = 0; r < h.ticks.length; ++r) n = (h.ticks[r].v - h.min) / (h.max - h.min), n = e.min + n * (e.max - e.min), t.push(n);
                        return t
                    };
                    if (!t.mode && n.tickDecimals == null) {
                        var m = Math.max(0, -Math.floor(Math.log(t.delta) / Math.LN10) + 1), g = t.tickGenerator(t);
                        g.length > 1 && /\..*0$/.test((g[1] - g[0]).toFixed(m)) || (t.tickDecimals = m)
                    }
                }
            }
        }

        function W(t) {
            var n = t.options.ticks, r = [];
            n == null || typeof n == "number" && n > 0 ? r = t.tickGenerator(t) : n && (e.isFunction(n) ? r = n(t) : r = n);
            var i, s;
            t.ticks = [];
            for (i = 0; i < r.length; ++i) {
                var o = null, u = r[i];
                typeof u == "object" ? (s = +u[0], u.length > 1 && (o = u[1])) : s = +u, o == null && (o = t.tickFormatter(s, t)), isNaN(s) || t.ticks.push({
                    v: s,
                    label: o
                })
            }
        }

        function X(e, t) {
            e.options.autoscaleMargin && t.length > 0 && (e.options.min == null && (e.min = Math.min(e.min, t[0].v)), e.options.max == null && t.length > 1 && (e.max = Math.max(e.max, t[t.length - 1].v)))
        }

        function V() {
            f.clear(), E(b.drawBackground, [h]);
            var e = a.grid;
            e.show && e.backgroundColor && K(), e.show && !e.aboveData && Q();
            for (var t = 0; t < u.length; ++t) E(b.drawSeries, [h, u[t]]), Y(u[t]);
            E(b.draw, [h]), e.show && e.aboveData && Q(), f.render(), ht()
        }

        function J(e, t) {
            var n, r, i, s, o = k();
            for (var u = 0; u < o.length; ++u) {
                n = o[u];
                if (n.direction == t) {
                    s = t + n.n + "axis", !e[s] && n.n == 1 && (s = t + "axis");
                    if (e[s]) {
                        r = e[s].from, i = e[s].to;
                        break
                    }
                }
            }
            e[s] || (n = t == "x" ? d[0] : v[0], r = e[t + "1"], i = e[t + "2"]);
            if (r != null && i != null && r > i) {
                var a = r;
                r = i, i = a
            }
            return {from: r, to: i, axis: n}
        }

        function K() {
            h.save(), h.translate(m.left, m.top), h.fillStyle = bt(a.grid.backgroundColor, y, 0, "rgba(255, 255, 255, 0)"), h.fillRect(0, 0, g, y), h.restore()
        }

        function Q() {
            var t, n, r, i;
            h.save(), h.translate(m.left, m.top);
            var s = a.grid.markings;
            if (s) {
                e.isFunction(s) && (n = w.getAxes(), n.xmin = n.xaxis.min, n.xmax = n.xaxis.max, n.ymin = n.yaxis.min, n.ymax = n.yaxis.max, s = s(n));
                for (t = 0; t < s.length; ++t) {
                    var o = s[t], u = J(o, "x"), f = J(o, "y");
                    u.from == null && (u.from = u.axis.min), u.to == null && (u.to = u.axis.max), f.from == null && (f.from = f.axis.min), f.to == null && (f.to = f.axis.max);
                    if (u.to < u.axis.min || u.from > u.axis.max || f.to < f.axis.min || f.from > f.axis.max) continue;
                    u.from = Math.max(u.from, u.axis.min), u.to = Math.min(u.to, u.axis.max), f.from = Math.max(f.from, f.axis.min), f.to = Math.min(f.to, f.axis.max);
                    var l = u.from === u.to, c = f.from === f.to;
                    if (l && c) continue;
                    u.from = Math.floor(u.axis.p2c(u.from)), u.to = Math.floor(u.axis.p2c(u.to)), f.from = Math.floor(f.axis.p2c(f.from)), f.to = Math.floor(f.axis.p2c(f.to));
                    if (l || c) {
                        var p = o.lineWidth || a.grid.markingsLineWidth, d = p % 2 ? .5 : 0;
                        h.beginPath(), h.strokeStyle = o.color || a.grid.markingsColor, h.lineWidth = p, l ? (h.moveTo(u.to + d, f.from), h.lineTo(u.to + d, f.to)) : (h.moveTo(u.from, f.to + d), h.lineTo(u.to, f.to + d)), h.stroke()
                    } else h.fillStyle = o.color || a.grid.markingsColor, h.fillRect(u.from, f.to, u.to - u.from, f.from - f.to)
                }
            }
            n = k(), r = a.grid.borderWidth;
            for (var v = 0; v < n.length; ++v) {
                var b = n[v], E = b.box, S = b.tickLength, x, T, N, C;
                if (!b.show || b.ticks.length == 0) continue;
                h.lineWidth = 1, b.direction == "x" ? (x = 0, S == "full" ? T = b.position == "top" ? 0 : y : T = E.top - m.top + (b.position == "top" ? E.height : 0)) : (T = 0, S == "full" ? x = b.position == "left" ? 0 : g : x = E.left - m.left + (b.position == "left" ? E.width : 0)), b.innermost || (h.strokeStyle = b.options.color, h.beginPath(), N = C = 0, b.direction == "x" ? N = g + 1 : C = y + 1, h.lineWidth == 1 && (b.direction == "x" ? T = Math.floor(T) + .5 : x = Math.floor(x) + .5), h.moveTo(x, T), h.lineTo(x + N, T + C), h.stroke()), h.strokeStyle = b.options.tickColor, h.beginPath();
                for (t = 0; t < b.ticks.length; ++t) {
                    var L = b.ticks[t].v;
                    N = C = 0;
                    if (isNaN(L) || L < b.min || L > b.max || S == "full" && (typeof r == "object" && r[b.position] > 0 || r > 0) && (L == b.min || L == b.max)) continue;
                    b.direction == "x" ? (x = b.p2c(L), C = S == "full" ? -y : S, b.position == "top" && (C = -C)) : (T = b.p2c(L), N = S == "full" ? -g : S, b.position == "left" && (N = -N)), h.lineWidth == 1 && (b.direction == "x" ? x = Math.floor(x) + .5 : T = Math.floor(T) + .5), h.moveTo(x, T), h.lineTo(x + N, T + C)
                }
                h.stroke()
            }
            r && (i = a.grid.borderColor, typeof r == "object" || typeof i == "object" ? (typeof r != "object" && (r = {
                top: r,
                right: r,
                bottom: r,
                left: r
            }), typeof i != "object" && (i = {
                top: i,
                right: i,
                bottom: i,
                left: i
            }), r.top > 0 && (h.strokeStyle = i.top, h.lineWidth = r.top, h.beginPath(), h.moveTo(0 - r.left, 0 - r.top / 2), h.lineTo(g, 0 - r.top / 2), h.stroke()), r.right > 0 && (h.strokeStyle = i.right, h.lineWidth = r.right, h.beginPath(), h.moveTo(g + r.right / 2, 0 - r.top), h.lineTo(g + r.right / 2, y), h.stroke()), r.bottom > 0 && (h.strokeStyle = i.bottom, h.lineWidth = r.bottom, h.beginPath(), h.moveTo(g + r.right, y + r.bottom / 2), h.lineTo(0, y + r.bottom / 2), h.stroke()), r.left > 0 && (h.strokeStyle = i.left, h.lineWidth = r.left, h.beginPath(), h.moveTo(0 - r.left / 2, y + r.bottom), h.lineTo(0 - r.left / 2, 0), h.stroke())) : (h.lineWidth = r, h.strokeStyle = a.grid.borderColor, h.strokeRect(-r / 2, -r / 2, g + r, y + r))), h.restore()
        }

        function G() {
            e.each(k(), function (e, t) {
                var n = t.box, r = t.direction + "Axis " + t.direction + t.n + "Axis",
                    i = "flot-" + t.direction + "-axis flot-" + t.direction + t.n + "-axis " + r,
                    s = t.options.font || "flot-tick-label tickLabel", o, u, a, l, c;
                f.removeText(i);
                if (!t.show || t.ticks.length == 0) return;
                for (var h = 0; h < t.ticks.length; ++h) {
                    o = t.ticks[h];
                    if (!o.label || o.v < t.min || o.v > t.max) continue;
                    t.direction == "x" ? (l = "center", u = m.left + t.p2c(o.v), t.position == "bottom" ? a = n.top + n.padding : (a = n.top + n.height - n.padding, c = "bottom")) : (c = "middle", a = m.top + t.p2c(o.v), t.position == "left" ? (u = n.left + n.width - n.padding, l = "right") : u = n.left + n.padding), f.addText(i, u, a, o.label, s, null, null, l, c)
                }
            })
        }

        function Y(e) {
            e.lines.show && Z(e), e.bars.show && nt(e), e.points.show && et(e)
        }

        function Z(e) {
            function t(e, t, n, r, i) {
                var s = e.points, o = e.pointsize, u = null, a = null;
                h.beginPath();
                for (var f = o; f < s.length; f += o) {
                    var l = s[f - o], c = s[f - o + 1], p = s[f], d = s[f + 1];
                    if (l == null || p == null) continue;
                    if (c <= d && c < i.min) {
                        if (d < i.min) continue;
                        l = (i.min - c) / (d - c) * (p - l) + l, c = i.min
                    } else if (d <= c && d < i.min) {
                        if (c < i.min) continue;
                        p = (i.min - c) / (d - c) * (p - l) + l, d = i.min
                    }
                    if (c >= d && c > i.max) {
                        if (d > i.max) continue;
                        l = (i.max - c) / (d - c) * (p - l) + l, c = i.max
                    } else if (d >= c && d > i.max) {
                        if (c > i.max) continue;
                        p = (i.max - c) / (d - c) * (p - l) + l, d = i.max
                    }
                    if (l <= p && l < r.min) {
                        if (p < r.min) continue;
                        c = (r.min - l) / (p - l) * (d - c) + c, l = r.min
                    } else if (p <= l && p < r.min) {
                        if (l < r.min) continue;
                        d = (r.min - l) / (p - l) * (d - c) + c, p = r.min
                    }
                    if (l >= p && l > r.max) {
                        if (p > r.max) continue;
                        c = (r.max - l) / (p - l) * (d - c) + c, l = r.max
                    } else if (p >= l && p > r.max) {
                        if (l > r.max) continue;
                        d = (r.max - l) / (p - l) * (d - c) + c, p = r.max
                    }
                    (l != u || c != a) && h.moveTo(r.p2c(l) + t, i.p2c(c) + n), u = p, a = d, h.lineTo(r.p2c(p) + t, i.p2c(d) + n)
                }
                h.stroke()
            }

            function n(e, t, n) {
                var r = e.points, i = e.pointsize, s = Math.min(Math.max(0, n.min), n.max), o = 0, u, a = !1, f = 1,
                    l = 0, c = 0;
                for (; ;) {
                    if (i > 0 && o > r.length + i) break;
                    o += i;
                    var p = r[o - i], d = r[o - i + f], v = r[o], m = r[o + f];
                    if (a) {
                        if (i > 0 && p != null && v == null) {
                            c = o, i = -i, f = 2;
                            continue
                        }
                        if (i < 0 && o == l + i) {
                            h.fill(), a = !1, i = -i, f = 1, o = l = c + i;
                            continue
                        }
                    }
                    if (p == null || v == null) continue;
                    if (p <= v && p < t.min) {
                        if (v < t.min) continue;
                        d = (t.min - p) / (v - p) * (m - d) + d, p = t.min
                    } else if (v <= p && v < t.min) {
                        if (p < t.min) continue;
                        m = (t.min - p) / (v - p) * (m - d) + d, v = t.min
                    }
                    if (p >= v && p > t.max) {
                        if (v > t.max) continue;
                        d = (t.max - p) / (v - p) * (m - d) + d, p = t.max
                    } else if (v >= p && v > t.max) {
                        if (p > t.max) continue;
                        m = (t.max - p) / (v - p) * (m - d) + d, v = t.max
                    }
                    a || (h.beginPath(), h.moveTo(t.p2c(p), n.p2c(s)), a = !0);
                    if (d >= n.max && m >= n.max) {
                        h.lineTo(t.p2c(p), n.p2c(n.max)), h.lineTo(t.p2c(v), n.p2c(n.max));
                        continue
                    }
                    if (d <= n.min && m <= n.min) {
                        h.lineTo(t.p2c(p), n.p2c(n.min)), h.lineTo(t.p2c(v), n.p2c(n.min));
                        continue
                    }
                    var g = p, y = v;
                    d <= m && d < n.min && m >= n.min ? (p = (n.min - d) / (m - d) * (v - p) + p, d = n.min) : m <= d && m < n.min && d >= n.min && (v = (n.min - d) / (m - d) * (v - p) + p, m = n.min), d >= m && d > n.max && m <= n.max ? (p = (n.max - d) / (m - d) * (v - p) + p, d = n.max) : m >= d && m > n.max && d <= n.max && (v = (n.max - d) / (m - d) * (v - p) + p, m = n.max), p != g && h.lineTo(t.p2c(g), n.p2c(d)), h.lineTo(t.p2c(p), n.p2c(d)), h.lineTo(t.p2c(v), n.p2c(m)), v != y && (h.lineTo(t.p2c(v), n.p2c(m)), h.lineTo(t.p2c(y), n.p2c(m)))
                }
            }

            h.save(), h.translate(m.left, m.top), h.lineJoin = "round";
            var r = e.lines.lineWidth, i = e.shadowSize;
            if (r > 0 && i > 0) {
                h.lineWidth = i, h.strokeStyle = "rgba(0,0,0,0.1)";
                var s = Math.PI / 18;
                t(e.datapoints, Math.sin(s) * (r / 2 + i / 2), Math.cos(s) * (r / 2 + i / 2), e.xaxis, e.yaxis), h.lineWidth = i / 2, t(e.datapoints, Math.sin(s) * (r / 2 + i / 4), Math.cos(s) * (r / 2 + i / 4), e.xaxis, e.yaxis)
            }
            h.lineWidth = r, h.strokeStyle = e.color;
            var o = rt(e.lines, e.color, 0, y);
            o && (h.fillStyle = o, n(e.datapoints, e.xaxis, e.yaxis)), r > 0 && t(e.datapoints, 0, 0, e.xaxis, e.yaxis), h.restore()
        }

        function et(e) {
            function t(e, t, n, r, i, s, o, u) {
                var a = e.points, f = e.pointsize;
                for (var l = 0; l < a.length; l += f) {
                    var c = a[l], p = a[l + 1];
                    if (c == null || c < s.min || c > s.max || p < o.min || p > o.max) continue;
                    h.beginPath(), c = s.p2c(c), p = o.p2c(p) + r, u == "circle" ? h.arc(c, p, t, 0, i ? Math.PI : Math.PI * 2, !1) : u(h, c, p, t, i), h.closePath(), n && (h.fillStyle = n, h.fill()), h.stroke()
                }
            }

            h.save(), h.translate(m.left, m.top);
            var n = e.points.lineWidth, r = e.shadowSize, i = e.points.radius, s = e.points.symbol;
            n == 0 && (n = 1e-4);
            if (n > 0 && r > 0) {
                var o = r / 2;
                h.lineWidth = o, h.strokeStyle = "rgba(0,0,0,0.1)", t(e.datapoints, i, null, o + o / 2, !0, e.xaxis, e.yaxis, s), h.strokeStyle = "rgba(0,0,0,0.2)", t(e.datapoints, i, null, o / 2, !0, e.xaxis, e.yaxis, s)
            }
            h.lineWidth = n, h.strokeStyle = e.color, t(e.datapoints, i, rt(e.points, e.color), 0, !1, e.xaxis, e.yaxis, s), h.restore()
        }

        function tt(e, t, n, r, i, s, o, u, a, f, l) {
            var c, h, p, d, v, m, g, y, b;
            f ? (y = m = g = !0, v = !1, c = n, h = e, d = t + r, p = t + i, h < c && (b = h, h = c, c = b, v = !0, m = !1)) : (v = m = g = !0, y = !1, c = e + r, h = e + i, p = n, d = t, d < p && (b = d, d = p, p = b, y = !0, g = !1));
            if (h < o.min || c > o.max || d < u.min || p > u.max) return;
            c < o.min && (c = o.min, v = !1), h > o.max && (h = o.max, m = !1), p < u.min && (p = u.min, y = !1), d > u.max && (d = u.max, g = !1), c = o.p2c(c), p = u.p2c(p), h = o.p2c(h), d = u.p2c(d), s && (a.fillStyle = s(p, d), a.fillRect(c, d, h - c, p - d)), l > 0 && (v || m || g || y) && (a.beginPath(), a.moveTo(c, p), v ? a.lineTo(c, d) : a.moveTo(c, d), g ? a.lineTo(h, d) : a.moveTo(h, d), m ? a.lineTo(h, p) : a.moveTo(h, p), y ? a.lineTo(c, p) : a.moveTo(c, p), a.stroke())
        }

        function nt(e) {
            function t(t, n, r, i, s, o) {
                var u = t.points, a = t.pointsize;
                for (var f = 0; f < u.length; f += a) {
                    if (u[f] == null) continue;
                    tt(u[f], u[f + 1], u[f + 2], n, r, i, s, o, h, e.bars.horizontal, e.bars.lineWidth)
                }
            }

            h.save(), h.translate(m.left, m.top), h.lineWidth = e.bars.lineWidth, h.strokeStyle = e.color;
            var n;
            switch (e.bars.align) {
                case"left":
                    n = 0;
                    break;
                case"right":
                    n = -e.bars.barWidth;
                    break;
                default:
                    n = -e.bars.barWidth / 2
            }
            var r = e.bars.fill ? function (t, n) {
                return rt(e.bars, e.color, t, n)
            } : null;
            t(e.datapoints, n, n + e.bars.barWidth, r, e.xaxis, e.yaxis), h.restore()
        }

        function rt(t, n, r, i) {
            var s = t.fill;
            if (!s) return null;
            if (t.fillColor) return bt(t.fillColor, r, i, n);
            var o = e.color.parse(n);
            return o.a = typeof s == "number" ? s : .4, o.normalize(), o.toString()
        }

        function it() {
            a.legend.container != null ? e(a.legend.container).html("") : t.find(".legend").remove();
            if (!a.legend.show) return;
            var n = [], r = [], i = !1, s = a.legend.labelFormatter, o, f;
            for (var l = 0; l < u.length; ++l) o = u[l], o.label && (f = s ? s(o.label, o) : o.label, f && r.push({
                label: f,
                color: o.color
            }));
            if (a.legend.sorted) if (e.isFunction(a.legend.sorted)) r.sort(a.legend.sorted); else if (a.legend.sorted == "reverse") r.reverse(); else {
                var c = a.legend.sorted != "descending";
                r.sort(function (e, t) {
                    return e.label == t.label ? 0 : e.label < t.label != c ? 1 : -1
                })
            }
            for (var l = 0; l < r.length; ++l) {
                var h = r[l];
                l % a.legend.noColumns == 0 && (i && n.push("</tr>"), n.push("<tr>"), i = !0), n.push('<td class="legendColorBox"><div style="border:1px solid ' + a.legend.labelBoxBorderColor + ';padding:1px"><div style="width:4px;height:0;border:5px solid ' + h.color + ';overflow:hidden"></div></div></td>' + '<td class="legendLabel">' + h.label + "</td>")
            }
            i && n.push("</tr>");
            if (n.length == 0) return;
            var p = '<table style="font-size:smaller;color:' + a.grid.color + '">' + n.join("") + "</table>";
            if (a.legend.container != null) e(a.legend.container).html(p); else {
                var d = "", v = a.legend.position, g = a.legend.margin;
                g[0] == null && (g = [g, g]), v.charAt(0) == "n" ? d += "top:" + (g[1] + m.top) + "px;" : v.charAt(0) == "s" && (d += "bottom:" + (g[1] + m.bottom) + "px;"), v.charAt(1) == "e" ? d += "right:" + (g[0] + m.right) + "px;" : v.charAt(1) == "w" && (d += "left:" + (g[0] + m.left) + "px;");
                var y = e('<div class="legend">' + p.replace('style="', 'style="position:absolute;' + d + ";") + "</div>").appendTo(t);
                if (a.legend.backgroundOpacity != 0) {
                    var b = a.legend.backgroundColor;
                    b == null && (b = a.grid.backgroundColor, b && typeof b == "string" ? b = e.color.parse(b) : b = e.color.extract(y, "background-color"), b.a = 1, b = b.toString());
                    var w = y.children();
                    e('<div style="position:absolute;width:' + w.width() + "px;height:" + w.height() + "px;" + d + "background-color:" + b + ';"> </div>').prependTo(y).css("opacity", a.legend.backgroundOpacity)
                }
            }
        }

        function ut(e, t, n) {
            var r = a.grid.mouseActiveRadius, i = r * r + 1, s = null, o = !1, f, l, c;
            for (f = u.length - 1; f >= 0; --f) {
                if (!n(u[f])) continue;
                var h = u[f], p = h.xaxis, d = h.yaxis, v = h.datapoints.points, m = p.c2p(e), g = d.c2p(t),
                    y = r / p.scale, b = r / d.scale;
                c = h.datapoints.pointsize, p.options.inverseTransform && (y = Number.MAX_VALUE), d.options.inverseTransform && (b = Number.MAX_VALUE);
                if (h.lines.show || h.points.show) for (l = 0; l < v.length; l += c) {
                    var w = v[l], E = v[l + 1];
                    if (w == null) continue;
                    if (w - m > y || w - m < -y || E - g > b || E - g < -b) continue;
                    var S = Math.abs(p.p2c(w) - e), x = Math.abs(d.p2c(E) - t), T = S * S + x * x;
                    T < i && (i = T, s = [f, l / c])
                }
                if (h.bars.show && !s) {
                    var N, C;
                    switch (h.bars.align) {
                        case"left":
                            N = 0;
                            break;
                        case"right":
                            N = -h.bars.barWidth;
                            break;
                        default:
                            N = -h.bars.barWidth / 2
                    }
                    C = N + h.bars.barWidth;
                    for (l = 0; l < v.length; l += c) {
                        var w = v[l], E = v[l + 1], k = v[l + 2];
                        if (w == null) continue;
                        if (u[f].bars.horizontal ? m <= Math.max(k, w) && m >= Math.min(k, w) && g >= E + N && g <= E + C : m >= w + N && m <= w + C && g >= Math.min(k, E) && g <= Math.max(k, E)) s = [f, l / c]
                    }
                }
            }
            return s ? (f = s[0], l = s[1], c = u[f].datapoints.pointsize, {
                datapoint: u[f].datapoints.points.slice(l * c, (l + 1) * c),
                dataIndex: l,
                series: u[f],
                seriesIndex: f
            }) : null
        }

        function at(e) {
            a.grid.hoverable && ct("plothover", e, function (e) {
                return e["hoverable"] != 0
            })
        }

        function ft(e) {
            a.grid.hoverable && ct("plothover", e, function (e) {
                return !1
            })
        }

        function lt(e) {
            ct("plotclick", e, function (e) {
                return e["clickable"] != 0
            })
        }

        function ct(e, n, r) {
            var i = c.offset(), s = n.pageX - i.left - m.left, o = n.pageY - i.top - m.top, u = L({left: s, top: o});
            u.pageX = n.pageX, u.pageY = n.pageY;
            var f = ut(s, o, r);
            f && (f.pageX = parseInt(f.series.xaxis.p2c(f.datapoint[0]) + i.left + m.left, 10), f.pageY = parseInt(f.series.yaxis.p2c(f.datapoint[1]) + i.top + m.top, 10));
            if (a.grid.autoHighlight) {
                for (var l = 0; l < st.length; ++l) {
                    var h = st[l];
                    h.auto == e && (!f || h.series != f.series || h.point[0] != f.datapoint[0] || h.point[1] != f.datapoint[1]) && vt(h.series, h.point)
                }
                f && dt(f.series, f.datapoint, e)
            }
            t.trigger(e, [u, f])
        }

        function ht() {
            var e = a.interaction.redrawOverlayInterval;
            if (e == -1) {
                pt();
                return
            }
            ot || (ot = setTimeout(pt, e))
        }

        function pt() {
            ot = null, p.save(), l.clear(), p.translate(m.left, m.top);
            var e, t;
            for (e = 0; e < st.length; ++e) t = st[e], t.series.bars.show ? yt(t.series, t.point) : gt(t.series, t.point);
            p.restore(), E(b.drawOverlay, [p])
        }

        function dt(e, t, n) {
            typeof e == "number" && (e = u[e]);
            if (typeof t == "number") {
                var r = e.datapoints.pointsize;
                t = e.datapoints.points.slice(r * t, r * (t + 1))
            }
            var i = mt(e, t);
            i == -1 ? (st.push({series: e, point: t, auto: n}), ht()) : n || (st[i].auto = !1)
        }

        function vt(e, t) {
            if (e == null && t == null) {
                st = [], ht();
                return
            }
            typeof e == "number" && (e = u[e]);
            if (typeof t == "number") {
                var n = e.datapoints.pointsize;
                t = e.datapoints.points.slice(n * t, n * (t + 1))
            }
            var r = mt(e, t);
            r != -1 && (st.splice(r, 1), ht())
        }

        function mt(e, t) {
            for (var n = 0; n < st.length; ++n) {
                var r = st[n];
                if (r.series == e && r.point[0] == t[0] && r.point[1] == t[1]) return n
            }
            return -1
        }

        function gt(t, n) {
            var r = n[0], i = n[1], s = t.xaxis, o = t.yaxis,
                u = typeof t.highlightColor == "string" ? t.highlightColor : e.color.parse(t.color).scale("a", .5).toString();
            if (r < s.min || r > s.max || i < o.min || i > o.max) return;
            var a = t.points.radius + t.points.lineWidth / 2;
            p.lineWidth = a, p.strokeStyle = u;
            var f = 1.5 * a;
            r = s.p2c(r), i = o.p2c(i), p.beginPath(), t.points.symbol == "circle" ? p.arc(r, i, f, 0, 2 * Math.PI, !1) : t.points.symbol(p, r, i, f, !1), p.closePath(), p.stroke()
        }

        function yt(t, n) {
            var r = typeof t.highlightColor == "string" ? t.highlightColor : e.color.parse(t.color).scale("a", .5).toString(),
                i = r, s;
            switch (t.bars.align) {
                case"left":
                    s = 0;
                    break;
                case"right":
                    s = -t.bars.barWidth;
                    break;
                default:
                    s = -t.bars.barWidth / 2
            }
            p.lineWidth = t.bars.lineWidth, p.strokeStyle = r, tt(n[0], n[1], n[2] || 0, s, s + t.bars.barWidth, function () {
                return i
            }, t.xaxis, t.yaxis, p, t.bars.horizontal, t.bars.lineWidth)
        }

        function bt(t, n, r, i) {
            if (typeof t == "string") return t;
            var s = h.createLinearGradient(0, r, 0, n);
            for (var o = 0, u = t.colors.length; o < u; ++o) {
                var a = t.colors[o];
                if (typeof a != "string") {
                    var f = e.color.parse(i);
                    a.brightness != null && (f = f.scale("rgb", a.brightness)), a.opacity != null && (f.a *= a.opacity), a = f.toString()
                }
                s.addColorStop(o / (u - 1), a)
            }
            return s
        }

        var u = [], a = {
                colors: ["#edc240", "#afd8f8", "#cb4b4b", "#4da74d", "#9440ed"],
                legend: {
                    show: !0,
                    noColumns: 1,
                    labelFormatter: null,
                    labelBoxBorderColor: "#ccc",
                    container: null,
                    position: "ne",
                    margin: 5,
                    backgroundColor: null,
                    backgroundOpacity: .85,
                    sorted: null
                },
                xaxis: {
                    show: null,
                    position: "bottom",
                    mode: null,
                    font: null,
                    color: null,
                    tickColor: null,
                    transform: null,
                    inverseTransform: null,
                    min: null,
                    max: null,
                    autoscaleMargin: null,
                    ticks: null,
                    tickFormatter: null,
                    labelWidth: null,
                    labelHeight: null,
                    reserveSpace: null,
                    tickLength: null,
                    alignTicksWithAxis: null,
                    tickDecimals: null,
                    tickSize: null,
                    minTickSize: null
                },
                yaxis: {autoscaleMargin: .02, position: "left"},
                xaxes: [],
                yaxes: [],
                series: {
                    points: {show: !1, radius: 3, lineWidth: 2, fill: !0, fillColor: "#ffffff", symbol: "circle"},
                    lines: {lineWidth: 2, fill: !1, fillColor: null, steps: !1},
                    bars: {
                        show: !1,
                        lineWidth: 2,
                        barWidth: 1,
                        fill: !0,
                        fillColor: null,
                        align: "left",
                        horizontal: !1,
                        zero: !0
                    },
                    shadowSize: 3,
                    highlightColor: null
                },
                grid: {
                    show: !0,
                    aboveData: !1,
                    color: "#545454",
                    backgroundColor: null,
                    borderColor: null,
                    tickColor: null,
                    margin: 0,
                    labelMargin: 5,
                    axisMargin: 8,
                    borderWidth: 2,
                    minBorderMargin: null,
                    markings: null,
                    markingsColor: "#f4f4f4",
                    markingsLineWidth: 2,
                    clickable: !1,
                    hoverable: !1,
                    autoHighlight: !0,
                    mouseActiveRadius: 10
                },
                interaction: {redrawOverlayInterval: 1e3 / 60},
                hooks: {}
            }, f = null, l = null, c = null, h = null, p = null, d = [], v = [], m = {left: 0, right: 0, top: 0, bottom: 0},
            g = 0, y = 0, b = {
                processOptions: [],
                processRawData: [],
                processDatapoints: [],
                processOffset: [],
                drawBackground: [],
                drawSeries: [],
                draw: [],
                bindEvents: [],
                drawOverlay: [],
                shutdown: []
            }, w = this;
        w.setData = T, w.setupGrid = R, w.draw = V, w.getPlaceholder = function () {
            return t
        }, w.getCanvas = function () {
            return f.element
        }, w.getPlotOffset = function () {
            return m
        }, w.width = function () {
            return g
        }, w.height = function () {
            return y
        }, w.offset = function () {
            var e = c.offset();
            return e.left += m.left, e.top += m.top, e
        }, w.getData = function () {
            return u
        }, w.getAxes = function () {
            var t = {}, n;
            return e.each(d.concat(v), function (e, n) {
                n && (t[n.direction + (n.n != 1 ? n.n : "") + "axis"] = n)
            }), t
        }, w.getXAxes = function () {
            return d
        }, w.getYAxes = function () {
            return v
        }, w.c2p = L, w.p2c = A, w.getOptions = function () {
            return a
        }, w.highlight = dt, w.unhighlight = vt, w.triggerRedrawOverlay = ht, w.pointOffset = function (e) {
            return {
                left: parseInt(d[C(e, "x") - 1].p2c(+e.x) + m.left, 10),
                top: parseInt(v[C(e, "y") - 1].p2c(+e.y) + m.top, 10)
            }
        }, w.shutdown = H, w.destroy = function () {
            H(), t.removeData("plot").empty(), u = [], a = null, f = null, l = null, c = null, h = null, p = null, d = [], v = [], b = null, st = [], w = null
        }, w.resize = function () {
            var e = t.width(), n = t.height();
            f.resize(e, n), l.resize(e, n)
        }, w.hooks = b, S(w), x(s), D(), T(r), R(), V(), P();
        var st = [], ot = null
    }

    function i(e, t) {
        return t * Math.floor(e / t)
    }

    var t = Object.prototype.hasOwnProperty;
    e.fn.detach || (e.fn.detach = function () {
        return this.each(function () {
            this.parentNode && this.parentNode.removeChild(this)
        })
    }), n.prototype.resize = function (e, t) {
        if (e <= 0 || t <= 0) throw new Error("Invalid dimensions for plot, width = " + e + ", height = " + t);
        var n = this.element, r = this.context, i = this.pixelRatio;
        this.width != e && (n.width = e * i, n.style.width = e + "px", this.width = e), this.height != t && (n.height = t * i, n.style.height = t + "px", this.height = t), r.restore(), r.save(), r.scale(i, i)
    }, n.prototype.clear = function () {
        this.context.clearRect(0, 0, this.width, this.height)
    }, n.prototype.render = function () {
        var e = this._textCache;
        for (var n in e) if (t.call(e, n)) {
            var r = this.getTextLayer(n), i = e[n];
            r.hide();
            for (var s in i) if (t.call(i, s)) {
                var o = i[s];
                for (var u in o) if (t.call(o, u)) {
                    var a = o[u].positions;
                    for (var f = 0, l; l = a[f]; f++) l.active ? l.rendered || (r.append(l.element), l.rendered = !0) : (a.splice(f--, 1), l.rendered && l.element.detach());
                    a.length == 0 && delete o[u]
                }
            }
            r.show()
        }
    }, n.prototype.getTextLayer = function (t) {
        var n = this.text[t];
        return n == null && (this.textContainer == null && (this.textContainer = e("<div class='flot-text'></div>").css({
            position: "absolute",
            top: 0,
            left: 0,
            bottom: 0,
            right: 0,
            "font-size": "smaller",
            color: "#545454"
        }).insertAfter(this.element)), n = this.text[t] = e("<div></div>").addClass(t).css({
            position: "absolute",
            top: 0,
            left: 0,
            bottom: 0,
            right: 0
        }).appendTo(this.textContainer)), n
    }, n.prototype.getTextInfo = function (t, n, r, i, s) {
        var o, u, a, f;
        n = "" + n, typeof r == "object" ? o = r.style + " " + r.variant + " " + r.weight + " " + r.size + "px/" + r.lineHeight + "px " + r.family : o = r, u = this._textCache[t], u == null && (u = this._textCache[t] = {}), a = u[o], a == null && (a = u[o] = {}), f = a[n];
        if (f == null) {
            var l = e("<div></div>").html(n).css({
                position: "absolute",
                "max-width": s,
                top: -9999
            }).appendTo(this.getTextLayer(t));
            typeof r == "object" ? l.css({
                font: o,
                color: r.color
            }) : typeof r == "string" && l.addClass(r), f = a[n] = {
                width: l.outerWidth(!0),
                height: l.outerHeight(!0),
                element: l,
                positions: []
            }, l.detach()
        }
        return f
    }, n.prototype.addText = function (e, t, n, r, i, s, o, u, a) {
        var f = this.getTextInfo(e, r, i, s, o), l = f.positions;
        u == "center" ? t -= f.width / 2 : u == "right" && (t -= f.width), a == "middle" ? n -= f.height / 2 : a == "bottom" && (n -= f.height);
        for (var c = 0, h; h = l[c]; c++) if (h.x == t && h.y == n) {
            h.active = !0;
            return
        }
        h = {
            active: !0,
            rendered: !1,
            element: l.length ? f.element.clone() : f.element,
            x: t,
            y: n
        }, l.push(h), h.element.css({top: Math.round(n), left: Math.round(t), "text-align": u})
    }, n.prototype.removeText = function (e, n, r, i, s, o) {
        if (i == null) {
            var u = this._textCache[e];
            if (u != null) for (var a in u) if (t.call(u, a)) {
                var f = u[a];
                for (var l in f) if (t.call(f, l)) {
                    var c = f[l].positions;
                    for (var h = 0, p; p = c[h]; h++) p.active = !1
                }
            }
        } else {
            var c = this.getTextInfo(e, i, s, o).positions;
            for (var h = 0, p; p = c[h]; h++) p.x == n && p.y == r && (p.active = !1)
        }
    }, e.plot = function (t, n, i) {
        var s = new r(e(t), n, i, e.plot.plugins);
        return s
    }, e.plot.version = "0.8.3", e.plot.plugins = [], e.fn.plot = function (t, n) {
        return this.each(function () {
            e.plot(this, t, n)
        })
    }
}(jQuery), define("flot/jquery.flot.min", function () {
}), function ($) {
    $.extend({
        tablesorter: new function () {
            function benchmark(e, t) {
                log(e + "," + ((new Date).getTime() - t.getTime()) + "ms")
            }

            function log(e) {
                typeof console != "undefined" && typeof console.debug != "undefined" ? console.log(e) : alert(e)
            }

            function buildParserCache(e, t) {
                if (e.config.debug) var n = "";
                if (e.tBodies.length == 0) return;
                var r = e.tBodies[0].rows;
                if (r[0]) {
                    var i = [], s = r[0].cells, o = s.length;
                    for (var u = 0; u < o; u++) {
                        var a = !1;
                        $.metadata && $(t[u]).metadata() && $(t[u]).metadata().sorter ? a = getParserById($(t[u]).metadata().sorter) : e.config.headers[u] && e.config.headers[u].sorter && (a = getParserById(e.config.headers[u].sorter)), a || (a = detectParserForColumn(e, r, -1, u)), e.config.debug && (n += "column:" + u + " parser:" + a.id + "\n"), i.push(a)
                    }
                }
                return e.config.debug && log(n), i
            }

            function detectParserForColumn(e, t, n, r) {
                var i = parsers.length, s = !1, o = !1, u = !0;
                while (o == "" && u) n++, t[n] ? (s = getNodeFromRowAndCellIndex(t, n, r), o = trimAndGetNodeText(e.config, s), e.config.debug && log("Checking if value was empty on row:" + n)) : u = !1;
                for (var a = 1; a < i; a++) if (parsers[a].is(o, e, s)) return parsers[a];
                return parsers[0]
            }

            function getNodeFromRowAndCellIndex(e, t, n) {
                return e[t].cells[n]
            }

            function trimAndGetNodeText(e, t) {
                return $.trim(getElementText(e, t))
            }

            function getParserById(e) {
                var t = parsers.length;
                for (var n = 0; n < t; n++) if (parsers[n].id.toLowerCase() == e.toLowerCase()) return parsers[n];
                return !1
            }

            function buildCache(e) {
                if (e.config.debug) var t = new Date;
                var n = e.tBodies[0] && e.tBodies[0].rows.length || 0,
                    r = e.tBodies[0].rows[0] && e.tBodies[0].rows[0].cells.length || 0, i = e.config.parsers,
                    s = {row: [], normalized: []};
                for (var o = 0; o < n; ++o) {
                    var u = $(e.tBodies[0].rows[o]), a = [];
                    if (u.hasClass(e.config.cssChildRow)) {
                        s.row[s.row.length - 1] = s.row[s.row.length - 1].add(u);
                        continue
                    }
                    s.row.push(u);
                    for (var f = 0; f < r; ++f) a.push(i[f].format(getElementText(e.config, u[0].cells[f]), e, u[0].cells[f]));
                    a.push(s.normalized.length), s.normalized.push(a), a = null
                }
                return e.config.debug && benchmark("Building cache for " + n + " rows:", t), s
            }

            function getElementText(e, t) {
                var n = "";
                return t ? (e.supportsTextContent || (e.supportsTextContent = t.textContent || !1), e.textExtraction == "simple" ? e.supportsTextContent ? n = t.textContent : t.childNodes[0] && t.childNodes[0].hasChildNodes() ? n = t.childNodes[0].innerHTML : n = t.innerHTML : typeof e.textExtraction == "function" ? n = e.textExtraction(t) : n = $(t).text(), n) : ""
            }

            function appendToTable(e, t) {
                if (e.config.debug) var n = new Date;
                var r = t, i = r.row, s = r.normalized, o = s.length, u = s[0].length - 1, a = $(e.tBodies[0]), f = [];
                for (var l = 0; l < o; l++) {
                    var c = s[l][u];
                    f.push(i[c]);
                    if (!e.config.appender) {
                        var h = i[c].length;
                        for (var p = 0; p < h; p++) a[0].appendChild(i[c][p])
                    }
                }
                e.config.appender && e.config.appender(e, f), f = null, e.config.debug && benchmark("Rebuilt table:", n), applyWidget(e), setTimeout(function () {
                    $(e).trigger("sortEnd")
                }, 0)
            }

            function buildHeaders(e) {
                if (e.config.debug) var t = new Date;
                var n = $.metadata ? !0 : !1, r = computeTableHeaderCellIndexes(e);
                return $tableHeaders = $(e.config.selectorHeaders, e).each(function (t) {
                    this.column = r[this.parentNode.rowIndex + "-" + this.cellIndex], this.order = formatSortingOrder(e.config.sortInitialOrder), this.count = this.order;
                    if (checkHeaderMetadata(this) || checkHeaderOptions(e, t)) this.sortDisabled = !0;
                    checkHeaderOptionsSortingLocked(e, t) && (this.order = this.lockedOrder = checkHeaderOptionsSortingLocked(e, t));
                    if (!this.sortDisabled) {
                        var n = $(this).addClass(e.config.cssHeader);
                        e.config.onRenderHeader && e.config.onRenderHeader.apply(n)
                    }
                    e.config.headerList[t] = this
                }), e.config.debug && (benchmark("Built headers:", t), log($tableHeaders)), $tableHeaders
            }

            function computeTableHeaderCellIndexes(e) {
                var t = [], n = {}, r = e.getElementsByTagName("THEAD")[0], i = r.getElementsByTagName("TR");
                for (var s = 0; s < i.length; s++) {
                    var o = i[s].cells;
                    for (var u = 0; u < o.length; u++) {
                        var a = o[u], f = a.parentNode.rowIndex, l = f + "-" + a.cellIndex, c = a.rowSpan || 1,
                            h = a.colSpan || 1, p;
                        typeof t[f] == "undefined" && (t[f] = []);
                        for (var d = 0; d < t[f].length + 1; d++) if (typeof t[f][d] == "undefined") {
                            p = d;
                            break
                        }
                        n[l] = p;
                        for (var d = f; d < f + c; d++) {
                            typeof t[d] == "undefined" && (t[d] = []);
                            var v = t[d];
                            for (var m = p; m < p + h; m++) v[m] = "x"
                        }
                    }
                }
                return n
            }

            function checkCellColSpan(e, t, n) {
                var r = [], i = e.tHead.rows, s = i[n].cells;
                for (var o = 0; o < s.length; o++) {
                    var u = s[o];
                    u.colSpan > 1 ? r = r.concat(checkCellColSpan(e, headerArr, n++)) : (e.tHead.length == 1 || u.rowSpan > 1 || !i[n + 1]) && r.push(u)
                }
                return r
            }

            function checkHeaderMetadata(e) {
                return $.metadata && $(e).metadata().sorter === !1 ? !0 : !1
            }

            function checkHeaderOptions(e, t) {
                return e.config.headers[t] && e.config.headers[t].sorter === !1 ? !0 : !1
            }

            function checkHeaderOptionsSortingLocked(e, t) {
                return e.config.headers[t] && e.config.headers[t].lockedOrder ? e.config.headers[t].lockedOrder : !1
            }

            function applyWidget(e) {
                var t = e.config.widgets, n = t.length;
                for (var r = 0; r < n; r++) getWidgetById(t[r]).format(e)
            }

            function getWidgetById(e) {
                var t = widgets.length;
                for (var n = 0; n < t; n++) if (widgets[n].id.toLowerCase() == e.toLowerCase()) return widgets[n]
            }

            function formatSortingOrder(e) {
                return typeof e != "Number" ? e.toLowerCase() == "desc" ? 1 : 0 : e == 1 ? 1 : 0
            }

            function isValueInArray(e, t) {
                var n = t.length;
                for (var r = 0; r < n; r++) if (t[r][0] == e) return !0;
                return !1
            }

            function setHeadersCss(e, t, n, r) {
                t.removeClass(r[0]).removeClass(r[1]);
                var i = [];
                t.each(function (e) {
                    this.sortDisabled || (i[this.column] = $(this))
                });
                var s = n.length;
                for (var o = 0; o < s; o++) i[n[o][0]].addClass(r[n[o][1]])
            }

            function fixColumnWidth(e, t) {
                var n = e.config;
                if (n.widthFixed) {
                    var r = $("<colgroup>");
                    $("tr:first td", e.tBodies[0]).each(function () {
                        r.append($("<col>").css("width", $(this).width()))
                    }), $(e).prepend(r)
                }
            }

            function updateHeaderSortCount(e, t) {
                var n = e.config, r = t.length;
                for (var i = 0; i < r; i++) {
                    var s = t[i], o = n.headerList[s[0]];
                    o.count = s[1], o.count++
                }
            }

            function multisort(table, sortList, cache) {
                if (table.config.debug) var sortTime = new Date;
                var dynamicExp = "var sortWrapper = function(a,b) {", l = sortList.length;
                for (var i = 0; i < l; i++) {
                    var c = sortList[i][0], order = sortList[i][1],
                        s = table.config.parsers[c].type == "text" ? order == 0 ? makeSortFunction("text", "asc", c) : makeSortFunction("text", "desc", c) : order == 0 ? makeSortFunction("numeric", "asc", c) : makeSortFunction("numeric", "desc", c),
                        e = "e" + i;
                    dynamicExp += "var " + e + " = " + s, dynamicExp += "if(" + e + ") { return " + e + "; } ", dynamicExp += "else { "
                }
                var orgOrderCol = cache.normalized[0].length - 1;
                dynamicExp += "return a[" + orgOrderCol + "]-b[" + orgOrderCol + "];";
                for (var i = 0; i < l; i++) dynamicExp += "}; ";
                return dynamicExp += "return 0; ", dynamicExp += "}; ", table.config.debug && benchmark("Evaling expression:" + dynamicExp, new Date), eval(dynamicExp), cache.normalized.sort(sortWrapper), table.config.debug && benchmark("Sorting on " + sortList.toString() + " and dir " + order + " time:", sortTime), cache
            }

            function makeSortFunction(e, t, n) {
                var r = "a[" + n + "]", i = "b[" + n + "]";
                if (e == "text" && t == "asc") return "(" + r + " == " + i + " ? 0 : (" + r + " === null ? Number.POSITIVE_INFINITY : (" + i + " === null ? Number.NEGATIVE_INFINITY : (" + r + " < " + i + ") ? -1 : 1 )));";
                if (e == "text" && t == "desc") return "(" + r + " == " + i + " ? 0 : (" + r + " === null ? Number.POSITIVE_INFINITY : (" + i + " === null ? Number.NEGATIVE_INFINITY : (" + i + " < " + r + ") ? -1 : 1 )));";
                if (e == "numeric" && t == "asc") return "(" + r + " === null && " + i + " === null) ? 0 :(" + r + " === null ? Number.POSITIVE_INFINITY : (" + i + " === null ? Number.NEGATIVE_INFINITY : " + r + " - " + i + "));";
                if (e == "numeric" && t == "desc") return "(" + r + " === null && " + i + " === null) ? 0 :(" + r + " === null ? Number.POSITIVE_INFINITY : (" + i + " === null ? Number.NEGATIVE_INFINITY : " + i + " - " + r + "));"
            }

            function makeSortText(e) {
                return "((a[" + e + "] < b[" + e + "]) ? -1 : ((a[" + e + "] > b[" + e + "]) ? 1 : 0));"
            }

            function makeSortTextDesc(e) {
                return "((b[" + e + "] < a[" + e + "]) ? -1 : ((b[" + e + "] > a[" + e + "]) ? 1 : 0));"
            }

            function makeSortNumeric(e) {
                return "a[" + e + "]-b[" + e + "];"
            }

            function makeSortNumericDesc(e) {
                return "b[" + e + "]-a[" + e + "];"
            }

            function sortText(e, t) {
                return table.config.sortLocaleCompare ? e.localeCompare(t) : e < t ? -1 : e > t ? 1 : 0
            }

            function sortTextDesc(e, t) {
                return table.config.sortLocaleCompare ? t.localeCompare(e) : t < e ? -1 : t > e ? 1 : 0
            }

            function sortNumeric(e, t) {
                return e - t
            }

            function sortNumericDesc(e, t) {
                return t - e
            }

            function getCachedSortType(e, t) {
                return e[t].type
            }

            var parsers = [], widgets = [];
            this.defaults = {
                cssHeader: "header",
                cssAsc: "headerSortUp",
                cssDesc: "headerSortDown",
                cssChildRow: "expand-child",
                sortInitialOrder: "asc",
                sortMultiSortKey: "shiftKey",
                sortForce: null,
                sortAppend: null,
                sortLocaleCompare: !0,
                textExtraction: "simple",
                parsers: {},
                widgets: [],
                widgetZebra: {css: ["even", "odd"]},
                headers: {},
                widthFixed: !1,
                cancelSelection: !0,
                sortList: [],
                headerList: [],
                dateFormat: "us",
                decimal: "/.|,/g",
                onRenderHeader: null,
                selectorHeaders: "thead th",
                debug: !1
            }, this.benchmark = benchmark, this.construct = function (e) {
                return this.each(function () {
                    if (!this.tHead || !this.tBodies) return;
                    var t, n, r, i, s, o = 0, u;
                    this.config = {}, s = $.extend(this.config, $.tablesorter.defaults, e), t = $(this), $.data(this, "tablesorter", s), r = buildHeaders(this), this.config.parsers = buildParserCache(this, r), i = buildCache(this);
                    var a = [s.cssDesc, s.cssAsc];
                    fixColumnWidth(this), r.click(function (e) {
                        var n = t[0].tBodies[0] && t[0].tBodies[0].rows.length || 0;
                        if (!this.sortDisabled && n > 0) {
                            t.trigger("sortStart");
                            var o = $(this), u = this.column;
                            this.order = this.count++ % 2, this.lockedOrder && (this.order = this.lockedOrder);
                            if (!e[s.sortMultiSortKey]) {
                                s.sortList = [];
                                if (s.sortForce != null) {
                                    var f = s.sortForce;
                                    for (var l = 0; l < f.length; l++) f[l][0] != u && s.sortList.push(f[l])
                                }
                                s.sortList.push([u, this.order])
                            } else if (isValueInArray(u, s.sortList)) for (var l = 0; l < s.sortList.length; l++) {
                                var c = s.sortList[l], h = s.headerList[c[0]];
                                c[0] == u && (h.count = c[1], h.count++, c[1] = h.count % 2)
                            } else s.sortList.push([u, this.order]);
                            return setTimeout(function () {
                                setHeadersCss(t[0], r, s.sortList, a), appendToTable(t[0], multisort(t[0], s.sortList, i))
                            }, 1), !1
                        }
                    }).mousedown(function () {
                        if (s.cancelSelection) return this.onselectstart = function () {
                            return !1
                        }, !1
                    }), t.bind("update", function () {
                        var e = this;
                        setTimeout(function () {
                            e.config.parsers = buildParserCache(e, r), i = buildCache(e)
                        }, 1)
                    }).bind("updateCell", function (e, t) {
                        var n = this.config, r = [t.parentNode.rowIndex - 1, t.cellIndex];
                        i.normalized[r[0]][r[1]] = n.parsers[r[1]].format(getElementText(n, t), t)
                    }).bind("sorton", function (e, t) {
                        $(this).trigger("sortStart"), s.sortList = t;
                        var n = s.sortList;
                        updateHeaderSortCount(this, n), setHeadersCss(this, r, n, a), appendToTable(this, multisort(this, n, i))
                    }).bind("appendCache", function () {
                        appendToTable(this, i)
                    }).bind("applyWidgetId", function (e, t) {
                        getWidgetById(t).format(this)
                    }).bind("applyWidgets", function () {
                        applyWidget(this)
                    }), $.metadata && $(this).metadata() && $(this).metadata().sortlist && (s.sortList = $(this).metadata().sortlist), s.sortList.length > 0 && t.trigger("sorton", [s.sortList]), applyWidget(this)
                })
            }, this.addParser = function (e) {
                var t = parsers.length, n = !0;
                for (var r = 0; r < t; r++) parsers[r].id.toLowerCase() == e.id.toLowerCase() && (n = !1);
                n && parsers.push(e)
            }, this.addWidget = function (e) {
                widgets.push(e)
            }, this.formatFloat = function (e) {
                var t = parseFloat(e);
                return isNaN(t) ? 0 : t
            }, this.formatInt = function (e) {
                var t = parseInt(e);
                return isNaN(t) ? 0 : t
            }, this.isDigit = function (e, t) {
                return /^[-+]?\d*$/.test($.trim(e.replace(/[,.']/g, "")))
            }, this.clearTableBody = function (e) {
                if ($.browser.msie) {
                    function t() {
                        while (this.firstChild) this.removeChild(this.firstChild)
                    }

                    t.apply(e.tBodies[0])
                } else e.tBodies[0].innerHTML = ""
            }
        }
    }), $.fn.extend({tablesorter: $.tablesorter.construct});
    var ts = $.tablesorter;
    ts.addParser({
        id: "text", is: function (e) {
            return !0
        }, format: function (e) {
            return $.trim(e.toLocaleLowerCase())
        }, type: "text"
    }), ts.addParser({
        id: "digit", is: function (e, t) {
            var n = t.config;
            return $.tablesorter.isDigit(e, n)
        }, format: function (e) {
            return $.tablesorter.formatFloat(e)
        }, type: "numeric"
    }), ts.addParser({
        id: "currency", is: function (e) {
            return /^[£$€?.]/.test(e)
        }, format: function (e) {
            return $.tablesorter.formatFloat(e.replace(new RegExp(/[£$€]/g), ""))
        }, type: "numeric"
    }), ts.addParser({
        id: "ipAddress", is: function (e) {
            return /^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(e)
        }, format: function (e) {
            var t = e.split("."), n = "", r = t.length;
            for (var i = 0; i < r; i++) {
                var s = t[i];
                s.length == 2 ? n += "0" + s : n += s
            }
            return $.tablesorter.formatFloat(n)
        }, type: "numeric"
    }), ts.addParser({
        id: "url", is: function (e) {
            return /^(https?|ftp|file):\/\/$/.test(e)
        }, format: function (e) {
            return jQuery.trim(e.replace(new RegExp(/(https?|ftp|file):\/\//), ""))
        }, type: "text"
    }), ts.addParser({
        id: "isoDate", is: function (e) {
            return /^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(e)
        }, format: function (e) {
            return $.tablesorter.formatFloat(e != "" ? (new Date(e.replace(new RegExp(/-/g), "/"))).getTime() : "0")
        }, type: "numeric"
    }), ts.addParser({
        id: "percent", is: function (e) {
            return /\%$/.test($.trim(e))
        }, format: function (e) {
            return $.tablesorter.formatFloat(e.replace(new RegExp(/%/g), ""))
        }, type: "numeric"
    }), ts.addParser({
        id: "usLongDate", is: function (e) {
            return e.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/))
        }, format: function (e) {
            return $.tablesorter.formatFloat((new Date(e)).getTime())
        }, type: "numeric"
    }), ts.addParser({
        id: "shortDate", is: function (e) {
            return /\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(e)
        }, format: function (e, t) {
            var n = t.config;
            e = e.replace(/\-/g, "/");
            if (n.dateFormat == "us") e = e.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/, "$3/$1/$2"); else if (n.dateFormat == "uk") e = e.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/, "$3/$2/$1"); else if (n.dateFormat == "dd/mm/yy" || n.dateFormat == "dd-mm-yy") e = e.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/, "$1/$2/$3");
            return $.tablesorter.formatFloat((new Date(e)).getTime())
        }, type: "numeric"
    }), ts.addParser({
        id: "time", is: function (e) {
            return /^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(e)
        }, format: function (e) {
            return $.tablesorter.formatFloat((new Date("2000/01/01 " + e)).getTime())
        }, type: "numeric"
    }), ts.addParser({
        id: "metadata", is: function (e) {
            return !1
        }, format: function (e, t, n) {
            var r = t.config, i = r.parserMetadataName ? r.parserMetadataName : "sortValue";
            return $(n).metadata()[i]
        }, type: "numeric"
    }), ts.addWidget({
        id: "zebra", format: function (e) {
            if (e.config.debug) var t = new Date;
            var n, r = -1, i;
            $("tr:visible", e.tBodies[0]).each(function (t) {
                n = $(this), n.hasClass(e.config.cssChildRow) || r++, i = r % 2 == 0, n.removeClass(e.config.widgetZebra.css[i ? 0 : 1]).addClass(e.config.widgetZebra.css[i ? 1 : 0])
            }), e.config.debug && $.tablesorter.benchmark("Applying Zebra widget", t)
        }
    })
}(jQuery), define("jquery.tablesorter.min", function () {
}), define("TELang", ["jquery"], function (e) {
    "use strict";
    var t = {
        lang: {}, defaultCode: "0", getCode: function () {
            var e = t.getUrlParameters().lang;
            return e || (e = t.defaultCode), e
        }, getUrlParameters: function () {
            var e = [], t, n = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&");
            for (var r = 0; r < n.length; r++) t = n[r].split("="), e.push(t[0]), e[t[0]] = t[1];
            return e
        }, i18n: function (e, n) {
            var r = t.lang[e];
            return r || (r = e), n && (r = t.format(r, n)), r
        }, i18nFile: function (e) {
            var t = this.getCode();
            return t == "0" || t == "1033" ? e : t + "/" + e
        }, format: function (e, n, r) {
            n || (n = window);
            var i = function (e, t) {
                var i, s = t.split(/\.+/);
                for (var o = 0; o < s.length; o++) o == 0 && (i = n), i = i[s[o]];
                return typeof i == "function" && (i = r ? i.apply(null, r) : i()), typeof i == "undefined" ? "undefined" : i
            };
            return e.replace(t.tokenRegEx, i)
        }, tokenRegEx: /\$\{([\w.]+?)\}/g
    }, n = typeof window != "undefined" ? window : typeof self != "undefined" ? self : {};
    n.TELang = t;
    var r = t.getCode(), i = r != 0 ? "js/" + r + "/strings.js" : "js/strings.js";
    return e.ajax({url: i, dataType: "script", async: !1}), t
}), define("internal/NotificationCenter", ["jquery", "TELang"], function (e, t) {
    "use strict";
    var n = null, r = function () {
        this._Observers = []
    };
    return Cesium.defineProperties(r.prototype, {}), r.prototype.addObserver = function (e, t, n, r) {
        var i = {observer: e, funcName: t, eventName: n, sender: r};
        if (this.find(i) > -1) return;
        this._Observers.push(i)
    }, r.prototype.removeObserver = function (e, t, n, r) {
        var i = {observer: e, funcName: t, eventName: n, sender: r}, s = this.find(i);
        s > -1 && this._Observers.splice(s, 1)
    }, r.prototype.find = function (e) {
        for (var t = 0; t < this._Observers.length; t++) if (this._Observers[t].observer == e.observer && this._Observers[t].funcName == e.funcName && this._Observers[t].eventName == e.eventName && this._Observers[t].sender == e.sender) return t;
        return -1
    }, r.prototype.postNotification = function (t, n, r) {
        for (var i = 0; i < this._Observers.length; i++) {
            var s = this._Observers[i];
            if (s.eventName == t) if (s.sender == null || s.sender == n) {
                var o = s.observer[s.funcName];
                o != undefined && e.proxy(o, s.observer)(r)
            }
        }
    }, n = new r, n
}), !function (e, t) {
    "object" == typeof exports && "undefined" != typeof module ? t(exports) : "function" == typeof define && define.amd ? define("turf.min", ["exports"], t) : t(e.turf = {})
}(this, function (e) {
    "use strict";

    function t(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.bbox, i = n.id;
        if (void 0 === e) throw new Error("geometry is required");
        if (t && t.constructor !== Object) throw new Error("properties must be an Object");
        r && N(r), i && C(i);
        var s = {type: "Feature"};
        return i && (s.id = i), r && (s.bbox = r), s.properties = t || {}, s.geometry = e, s
    }

    function n(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var i = n.bbox;
        if (!e) throw new Error("type is required");
        if (!t) throw new Error("coordinates is required");
        if (!Array.isArray(t)) throw new Error("coordinates must be an Array");
        i && N(i);
        var o;
        switch (e) {
            case"Point":
                o = r(t).geometry;
                break;
            case"LineString":
                o = u(t).geometry;
                break;
            case"Polygon":
                o = s(t).geometry;
                break;
            case"MultiPoint":
                o = c(t).geometry;
                break;
            case"MultiLineString":
                o = l(t).geometry;
                break;
            case"MultiPolygon":
                o = h(t).geometry;
                break;
            default:
                throw new Error(e + " is invalid")
        }
        return i && (o.bbox = i), o
    }

    function r(e, n, r) {
        if (!e) throw new Error("coordinates is required");
        if (!Array.isArray(e)) throw new Error("coordinates must be an Array");
        if (e.length < 2) throw new Error("coordinates must be at least 2 numbers long");
        if (!x(e[0]) || !x(e[1])) throw new Error("coordinates must contain numbers");
        return t({type: "Point", coordinates: e}, n, r)
    }

    function i(e, t, n) {
        if (!e) throw new Error("coordinates is required");
        if (!Array.isArray(e)) throw new Error("coordinates must be an Array");
        return f(e.map(function (e) {
            return r(e, t)
        }), n)
    }

    function s(e, n, r) {
        if (!e) throw new Error("coordinates is required");
        for (var i = 0; i < e.length; i++) {
            var s = e[i];
            if (s.length < 4) throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");
            for (var o = 0; o < s[s.length - 1].length; o++) {
                if (0 === i && 0 === o && !x(s[0][0]) || !x(s[0][1])) throw new Error("coordinates must contain numbers");
                if (s[s.length - 1][o] !== s[0][o]) throw new Error("First and last Position are not equivalent.")
            }
        }
        return t({type: "Polygon", coordinates: e}, n, r)
    }

    function o(e, t, n) {
        if (!e) throw new Error("coordinates is required");
        if (!Array.isArray(e)) throw new Error("coordinates must be an Array");
        return f(e.map(function (e) {
            return s(e, t)
        }), n)
    }

    function u(e, n, r) {
        if (!e) throw new Error("coordinates is required");
        if (e.length < 2) throw new Error("coordinates must be an array of two or more positions");
        if (!x(e[0][1]) || !x(e[0][1])) throw new Error("coordinates must contain numbers");
        return t({type: "LineString", coordinates: e}, n, r)
    }

    function a(e, t, n) {
        if (!e) throw new Error("coordinates is required");
        if (!Array.isArray(e)) throw new Error("coordinates must be an Array");
        return f(e.map(function (e) {
            return u(e, t)
        }), n)
    }

    function f(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.bbox, r = t.id;
        if (!e) throw new Error("No features passed");
        if (!Array.isArray(e)) throw new Error("features must be an Array");
        n && N(n), r && C(r);
        var i = {type: "FeatureCollection"};
        return r && (i.id = r), n && (i.bbox = n), i.features = e, i
    }

    function l(e, n, r) {
        if (!e) throw new Error("coordinates is required");
        return t({type: "MultiLineString", coordinates: e}, n, r)
    }

    function c(e, n, r) {
        if (!e) throw new Error("coordinates is required");
        return t({type: "MultiPoint", coordinates: e}, n, r)
    }

    function h(e, n, r) {
        if (!e) throw new Error("coordinates is required");
        return t({type: "MultiPolygon", coordinates: e}, n, r)
    }

    function p(e, n, r) {
        if (!e) throw new Error("geometries is required");
        if (!Array.isArray(e)) throw new Error("geometries must be an Array");
        return t({type: "GeometryCollection", geometries: e}, n, r)
    }

    function d(e, t) {
        if (void 0 === e || null === e || isNaN(e)) throw new Error("num is required");
        if (!t || t >= 0) {
            var n = Math.pow(10, t || 0);
            return Math.round(e * n) / n
        }
        throw new Error("precision must be a positive number")
    }

    function v(e, t) {
        if (void 0 === e || null === e) throw new Error("radians is required");
        if (t && "string" != typeof t) throw new Error("units must be a string");
        var n = jo[t || "kilometers"];
        if (!n) throw new Error(t + " units is invalid");
        return e * n
    }

    function m(e, t) {
        if (void 0 === e || null === e) throw new Error("distance is required");
        if (t && "string" != typeof t) throw new Error("units must be a string");
        var n = jo[t || "kilometers"];
        if (!n) throw new Error(t + " units is invalid");
        return e / n
    }

    function g(e, t) {
        return b(m(e, t))
    }

    function y(e) {
        if (null === e || void 0 === e) throw new Error("bearing is required");
        var t = e % 360;
        return t < 0 && (t += 360), t
    }

    function b(e) {
        if (null === e || void 0 === e) throw new Error("radians is required");
        return 180 * (e % (2 * Math.PI)) / Math.PI
    }

    function w(e) {
        if (null === e || void 0 === e) throw new Error("degrees is required");
        return e % 360 * Math.PI / 180
    }

    function E(e, t, n) {
        if (null === e || void 0 === e) throw new Error("length is required");
        if (e >= 0) return v(m(e, t), n || "kilometers");
        throw new Error("length must be a positive number")
    }

    function S(e, t, n) {
        if (null === e || void 0 === e) throw new Error("area is required");
        if (e >= 0) {
            var r = Io[t || "meters"];
            if (!r) throw new Error("invalid original units");
            var i = Io[n || "kilometers"];
            if (!i) throw new Error("invalid final units");
            return e / r * i
        }
        throw new Error("area must be a positive number")
    }

    function x(e) {
        return !isNaN(e) && null !== e && !Array.isArray(e)
    }

    function T(e) {
        return !!e && e.constructor === Object
    }

    function N(e) {
        if (!e) throw new Error("bbox is required");
        if (!Array.isArray(e)) throw new Error("bbox must be an Array");
        if (4 !== e.length && 6 !== e.length) throw new Error("bbox must be an Array of 4 or 6 numbers");
        e.forEach(function (e) {
            if (!x(e)) throw new Error("bbox must only contain numbers")
        })
    }

    function C(e) {
        if (!e) throw new Error("id is required");
        if (-1 === ["string", "number"].indexOf(typeof e)) throw new Error("id must be a number or a string")
    }

    function k(e, t, n) {
        if (null !== e) for (var r, i, s, o, u, a, f, l, c = 0, h = 0, p = e.type, d = "FeatureCollection" === p, v = "Feature" === p, m = d ? e.features.length : 1, g = 0; g < m; g++) {
            u = (l = !!(f = d ? e.features[g].geometry : v ? e.geometry : e) && "GeometryCollection" === f.type) ? f.geometries.length : 1;
            for (var y = 0; y < u; y++) {
                var b = 0, w = 0;
                if (null !== (o = l ? f.geometries[y] : f)) {
                    a = o.coordinates;
                    var E = o.type;
                    switch (c = !n || "Polygon" !== E && "MultiPolygon" !== E ? 0 : 1, E) {
                        case null:
                            break;
                        case"Point":
                            t(a, h, g, b, w), h++, b++;
                            break;
                        case"LineString":
                        case"MultiPoint":
                            for (r = 0; r < a.length; r++) t(a[r], h, g, b, w), h++, "MultiPoint" === E && b++;
                            "LineString" === E && b++;
                            break;
                        case"Polygon":
                        case"MultiLineString":
                            for (r = 0; r < a.length; r++) {
                                for (i = 0; i < a[r].length - c; i++) t(a[r][i], h, g, b, w), h++;
                                "MultiLineString" === E && b++, "Polygon" === E && w++
                            }
                            "Polygon" === E && b++;
                            break;
                        case"MultiPolygon":
                            for (r = 0; r < a.length; r++) {
                                for ("MultiPolygon" === E && (w = 0), i = 0; i < a[r].length; i++) {
                                    for (s = 0; s < a[r][i].length - c; s++) t(a[r][i][s], h, g, b, w), h++;
                                    w++
                                }
                                b++
                            }
                            break;
                        case"GeometryCollection":
                            for (r = 0; r < o.geometries.length; r++) k(o.geometries[r], t, n);
                            break;
                        default:
                            throw new Error("Unknown Geometry Type")
                    }
                }
            }
        }
    }

    function L(e, t, n, r) {
        var i = n;
        return k(e, function (e, r, s, o, u) {
            i = 0 === r && void 0 === n ? e : t(i, e, r, s, o, u)
        }, r), i
    }

    function A(e, t) {
        var n;
        switch (e.type) {
            case"FeatureCollection":
                for (n = 0; n < e.features.length; n++) t(e.features[n].properties, n);
                break;
            case"Feature":
                t(e.properties, 0)
        }
    }

    function O(e, t, n) {
        var r = n;
        return A(e, function (e, i) {
            r = 0 === i && void 0 === n ? e : t(r, e, i)
        }), r
    }

    function M(e, t) {
        if ("Feature" === e.type) t(e, 0); else if ("FeatureCollection" === e.type) for (var n = 0; n < e.features.length; n++) t(e.features[n], n)
    }

    function _(e, t, n) {
        var r = n;
        return M(e, function (e, i) {
            r = 0 === i && void 0 === n ? e : t(r, e, i)
        }), r
    }

    function D(e) {
        var t = [];
        return k(e, function (e) {
            t.push(e)
        }), t
    }

    function P(e, t) {
        var n, r, i, s, o, u, a, f, l, c, h = 0, p = "FeatureCollection" === e.type, d = "Feature" === e.type,
            v = p ? e.features.length : 1;
        for (n = 0; n < v; n++) {
            for (u = p ? e.features[n].geometry : d ? e.geometry : e, f = p ? e.features[n].properties : d ? e.properties : {}, l = p ? e.features[n].bbox : d ? e.bbox : void 0, c = p ? e.features[n].id : d ? e.id : void 0, o = (a = !!u && "GeometryCollection" === u.type) ? u.geometries.length : 1, i = 0; i < o; i++) if (null !== (s = a ? u.geometries[i] : u)) switch (s.type) {
                case"Point":
                case"LineString":
                case"MultiPoint":
                case"Polygon":
                case"MultiLineString":
                case"MultiPolygon":
                    t(s, h, f, l, c);
                    break;
                case"GeometryCollection":
                    for (r = 0; r < s.geometries.length; r++) t(s.geometries[r], h, f, l, c);
                    break;
                default:
                    throw new Error("Unknown Geometry Type")
            } else t(null, h, f, l, c);
            h++
        }
    }

    function H(e, t, n) {
        var r = n;
        return P(e, function (e, i, s, o, u) {
            r = 0 === i && void 0 === n ? e : t(r, e, i, s, o, u)
        }), r
    }

    function B(e, n) {
        P(e, function (e, r, i, s, o) {
            var u = null === e ? null : e.type;
            switch (u) {
                case null:
                case"Point":
                case"LineString":
                case"Polygon":
                    return void n(t(e, i, {bbox: s, id: o}), r, 0)
            }
            var a;
            switch (u) {
                case"MultiPoint":
                    a = "Point";
                    break;
                case"MultiLineString":
                    a = "LineString";
                    break;
                case"MultiPolygon":
                    a = "Polygon"
            }
            e.coordinates.forEach(function (e, s) {
                n(t({type: a, coordinates: e}, i), r, s)
            })
        })
    }

    function j(e, t, n) {
        var r = n;
        return B(e, function (e, i, s) {
            r = 0 === i && 0 === s && void 0 === n ? e : t(r, e, i, s)
        }), r
    }

    function F(e, t) {
        B(e, function (e, n, r) {
            var i = 0;
            if (e.geometry) {
                var s = e.geometry.type;
                "Point" !== s && "MultiPoint" !== s && L(e, function (s, o, a, f, l, c) {
                    var h = u([s, o], e.properties);
                    return t(h, n, r, c, i), i++, o
                })
            }
        })
    }

    function I(e, t, n) {
        var r = n, i = !1;
        return F(e, function (e, s, o, u, a) {
            r = !1 === i && void 0 === n ? e : t(r, e, s, o, u, a), i = !0
        }), r
    }

    function q(e, t) {
        if (!e) throw new Error("geojson is required");
        B(e, function (e, n, r) {
            if (null !== e.geometry) {
                var i = e.geometry.type, s = e.geometry.coordinates;
                switch (i) {
                    case"LineString":
                        t(e, n, r, 0, 0);
                        break;
                    case"Polygon":
                        for (var o = 0; o < s.length; o++) t(u(s[o], e.properties), n, r, o)
                }
            }
        })
    }

    function R(e, t, n) {
        var r = n;
        return q(e, function (e, i, s, o) {
            r = 0 === i && void 0 === n ? e : t(r, e, i, s, o)
        }), r
    }

    function U(e) {
        var t = [1 / 0, 1 / 0, -1 / 0, -1 / 0];
        return k(e, function (e) {
            t[0] > e[0] && (t[0] = e[0]), t[1] > e[1] && (t[1] = e[1]), t[2] < e[0] && (t[2] = e[0]), t[3] < e[1] && (t[3] = e[1])
        }), t
    }

    function z(e) {
        if (!e) throw new Error("obj is required");
        var t = W(e);
        if (t.length > 1 && x(t[0]) && x(t[1])) return t;
        throw new Error("Coordinate is not a valid Point")
    }

    function W(e) {
        if (!e) throw new Error("obj is required");
        var t;
        if (e.length ? t = e : e.coordinates ? t = e.coordinates : e.geometry && e.geometry.coordinates && (t = e.geometry.coordinates), t) return X(t), t;
        throw new Error("No valid coordinates")
    }

    function X(e) {
        if (e.length > 1 && x(e[0]) && x(e[1])) return !0;
        if (Array.isArray(e[0]) && e[0].length) return X(e[0]);
        throw new Error("coordinates must only contain numbers")
    }

    function V(e, t, n) {
        if (!t || !n) throw new Error("type and name required");
        if (!e || e.type !== t) throw new Error("Invalid input to " + n + ": must be a " + t + ", given " + e.type)
    }

    function $(e, t, n) {
        if (!e) throw new Error("No feature passed");
        if (!n) throw new Error(".featureOf() requires a name");
        if (!e || "Feature" !== e.type || !e.geometry) throw new Error("Invalid input to " + n + ", Feature with geometry required");
        if (!e.geometry || e.geometry.type !== t) throw new Error("Invalid input to " + n + ": must be a " + t + ", given " + e.geometry.type)
    }

    function J(e, t, n) {
        if (!e) throw new Error("No featureCollection passed");
        if (!n) throw new Error(".collectionOf() requires a name");
        if (!e || "FeatureCollection" !== e.type) throw new Error("Invalid input to " + n + ", FeatureCollection required");
        for (var r = 0; r < e.features.length; r++) {
            var i = e.features[r];
            if (!i || "Feature" !== i.type || !i.geometry) throw new Error("Invalid input to " + n + ", Feature with geometry required");
            if (!i.geometry || i.geometry.type !== t) throw new Error("Invalid input to " + n + ": must be a " + t + ", given " + i.geometry.type)
        }
    }

    function K(e) {
        if (!e) throw new Error("geojson is required");
        if (void 0 !== e.geometry) return e.geometry;
        if (e.coordinates || e.geometries) return e;
        throw new Error("geojson must be a valid Feature or Geometry Object")
    }

    function Q() {
        throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")
    }

    function G(e, t) {
        if (!e) throw new Error((t || "geojson") + " is required");
        if (e.geometry && e.geometry.type) return e.geometry.type;
        if (e.type) return e.type;
        throw new Error((t || "geojson") + " is invalid")
    }

    function Y(e, t, n) {
        n = n || {};
        for (var r = Object.keys(zo), i = 0; i < r.length; i++) {
            var s = r[i], o = n[s];
            o = void 0 !== o && null !== o ? o : zo[s], Wo[s] = o
        }
        Wo.verbose && console.log("MarchingSquaresJS-isoContours: computing isocontour for " + t);
        var u = function (e) {
            var t = [], n = 0;
            return e.rows, e.cols, e.cells.forEach(function (r, i) {
                r.forEach(function (r, s) {
                    if (void 0 !== r && !function (e) {
                        return 5 === e.cval || 10 === e.cval
                    }(r) && !et(r)) {
                        var o = function (e, t, n) {
                            var r, i, s, o = e.length, u = [], a = [0, 0, 1, 1, 0, 0, 0, 0, -1, 0, 1, 1, -1, 0, -1, 0],
                                f = [0, -1, 0, 0, 1, 1, 1, 1, 0, -1, 0, 0, 0, -1, 0, 0],
                                l = ["none", "bottom", "right", "right", "top", "top", "top", "top", "left", "bottom", "right", "right", "left", "bottom", "left", "none"],
                                c = (e[t][n], e[t][n]), h = c.cval,
                                p = nt(c, s = ["none", "left", "bottom", "left", "right", "none", "bottom", "left", "top", "top", "none", "top", "right", "right", "bottom", "none"][h]);
                            u.push([n + p[0], t + p[1]]), p = nt(c, s = l[h]), u.push([n + p[0], t + p[1]]), tt(c);
                            for (var d = n + a[h], v = t + f[h], m = h; d >= 0 && v >= 0 && v < o && (d != n || v != t) && void 0 !== (c = e[v][d]);) {
                                if (0 === (h = c.cval) || 15 === h) return {path: u, info: "mergeable"};
                                s = l[h], r = a[h], i = f[h], 5 !== h && 10 !== h || (5 === h ? c.flipped ? -1 === f[m] ? (s = "left", r = -1, i = 0) : (s = "right", r = 1, i = 0) : -1 === a[m] && (s = "bottom", r = 0, i = -1) : 10 === h && (c.flipped ? -1 === a[m] ? (s = "top", r = 0, i = 1) : (s = "bottom", r = 0, i = -1) : 1 === f[m] && (s = "left", r = -1, i = 0))), p = nt(c, s), u.push([d + p[0], v + p[1]]), tt(c), d += r, v += i, m = h
                            }
                            return {path: u, info: "closed"}
                        }(e.cells, i, s), u = !1;
                        if ("mergeable" === o.info) for (var a = o.path[o.path.length - 1][0], f = o.path[o.path.length - 1][1], l = n - 1; l >= 0; l--) if (Math.abs(t[l][0][0] - a) <= 1e-7 && Math.abs(t[l][0][1] - f) <= 1e-7) {
                            for (var c = o.path.length - 2; c >= 0; --c) t[l].unshift(o.path[c]);
                            u = !0;
                            break
                        }
                        u || (t[n++] = o.path)
                    }
                })
            }), t
        }(function (e, t) {
            for (var n = e.length - 1, r = e[0].length - 1, i = {rows: n, cols: r, cells: []}, s = 0; s < n; ++s) {
                i.cells[s] = [];
                for (var o = 0; o < r; ++o) {
                    var u = 0, a = e[s + 1][o], f = e[s + 1][o + 1], l = e[s][o + 1], c = e[s][o];
                    if (!(isNaN(a) || isNaN(f) || isNaN(l) || isNaN(c))) {
                        u |= a >= t ? 8 : 0, u |= f >= t ? 4 : 0, u |= l >= t ? 2 : 0;
                        var h = !1;
                        if (5 === (u |= c >= t ? 1 : 0) || 10 === u) {
                            var p = (a + f + l + c) / 4;
                            5 === u && p < t ? (u = 10, h = !0) : 10 === u && p < t && (u = 5, h = !0)
                        }
                        if (0 !== u && 15 !== u) {
                            var d, v, m, g;
                            d = v = m = g = .5, 1 === u ? (m = 1 - Z(t, a, c), v = 1 - Z(t, l, c)) : 2 === u ? (v = Z(t, c, l), g = 1 - Z(t, f, l)) : 3 === u ? (m = 1 - Z(t, a, c), g = 1 - Z(t, f, l)) : 4 === u ? (d = Z(t, a, f), g = Z(t, l, f)) : 5 === u ? (d = Z(t, a, f), g = Z(t, l, f), v = 1 - Z(t, l, c), m = 1 - Z(t, a, c)) : 6 === u ? (v = Z(t, c, l), d = Z(t, a, f)) : 7 === u ? (m = 1 - Z(t, a, c), d = Z(t, a, f)) : 8 === u ? (m = Z(t, c, a), d = 1 - Z(t, f, a)) : 9 === u ? (v = 1 - Z(t, l, c), d = 1 - Z(t, f, a)) : 10 === u ? (d = 1 - Z(t, f, a), g = 1 - Z(t, f, l), v = Z(t, c, l), m = Z(t, c, a)) : 11 === u ? (d = 1 - Z(t, f, a), g = 1 - Z(t, f, l)) : 12 === u ? (m = Z(t, c, a), g = Z(t, l, f)) : 13 === u ? (v = 1 - Z(t, l, c), g = Z(t, l, f)) : 14 === u ? (m = Z(t, c, a), v = Z(t, c, l)) : console.log("MarchingSquaresJS-isoContours: Illegal cval detected: " + u), i.cells[s][o] = {
                                cval: u,
                                flipped: h,
                                top: d,
                                right: g,
                                bottom: v,
                                left: m
                            }
                        }
                    }
                }
            }
            return i
        }(e, t));
        return "function" == typeof Wo.successCallback && Wo.successCallback(u), u
    }

    function Z(e, t, n) {
        return (e - t) / (n - t)
    }

    function et(e) {
        return 0 === e.cval || 15 === e.cval
    }

    function tt(e) {
        et(e) || 5 === e.cval || 10 === e.cval || (e.cval = 15)
    }

    function nt(e, t) {
        return "top" === t ? [e.top, 1] : "bottom" === t ? [e.bottom, 0] : "right" === t ? [1, e.right] : "left" === t ? [0, e.left] : void 0
    }

    function rt(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.zProperty || "elevation", r = t.flip, i = t.flags;
        J(e, "Point", "input must contain Points");
        for (var s = function (e, t) {
            var n = {};
            return M(e, function (e) {
                var t = W(e)[1];
                n[t] || (n[t] = []), n[t].push(e)
            }), Object.keys(n).map(function (e) {
                var t = n[e], r = t.sort(function (e, t) {
                    return W(e)[0] - W(t)[0]
                });
                return r
            }).sort(function (e, n) {
                return t ? W(e[0])[1] - W(n[0])[1] : W(n[0])[1] - W(e[0])[1]
            })
        }(e, r), o = [], u = 0; u < s.length; u++) {
            for (var a = s[u], f = [], l = 0; l < a.length; l++) {
                var c = a[l];
                c.properties[n] ? f.push(c.properties[n]) : f.push(0), !0 === i && (c.properties.matrixPosition = [u, l])
            }
            o.push(f)
        }
        return o
    }

    function it(e, t, n, r, i) {
        for (n = n || 0, r = r || e.length - 1, i = i || function (e, t) {
            return e < t ? -1 : e > t ? 1 : 0
        }; r > n;) {
            if (r - n > 600) {
                var s = r - n + 1, o = t - n + 1, u = Math.log(s), a = .5 * Math.exp(2 * u / 3),
                    f = .5 * Math.sqrt(u * a * (s - a) / s) * (o - s / 2 < 0 ? -1 : 1);
                it(e, t, Math.max(n, Math.floor(t - o * a / s + f)), Math.min(r, Math.floor(t + (s - o) * a / s + f)), i)
            }
            var l = e[t], c = n, h = r;
            for (st(e, n, t), i(e[r], l) > 0 && st(e, n, r); c < h;) {
                for (st(e, c, h), c++, h--; i(e[c], l) < 0;) c++;
                for (; i(e[h], l) > 0;) h--
            }
            0 === i(e[n], l) ? st(e, n, h) : st(e, ++h, r), h <= t && (n = h + 1), t <= h && (r = h - 1)
        }
    }

    function st(e, t, n) {
        var r = e[t];
        e[t] = e[n], e[n] = r
    }

    function ot(e, t) {
        if (!(this instanceof ot)) return new ot(e, t);
        this._maxEntries = Math.max(4, e || 9), this._minEntries = Math.max(2, Math.ceil(.4 * this._maxEntries)), t && this._initFormat(t), this.clear()
    }

    function ut(e, t) {
        at(e, 0, e.children.length, t, e)
    }

    function at(e, t, n, r, i) {
        i || (i = mt(null)), i.minX = 1 / 0, i.minY = 1 / 0, i.maxX = -1 / 0, i.maxY = -1 / 0;
        for (var s, o = t; o < n; o++) s = e.children[o], ft(i, e.leaf ? r(s) : s);
        return i
    }

    function ft(e, t) {
        return e.minX = Math.min(e.minX, t.minX), e.minY = Math.min(e.minY, t.minY), e.maxX = Math.max(e.maxX, t.maxX), e.maxY = Math.max(e.maxY, t.maxY), e
    }

    function lt(e, t) {
        return e.minX - t.minX
    }

    function ct(e, t) {
        return e.minY - t.minY
    }

    function ht(e) {
        return (e.maxX - e.minX) * (e.maxY - e.minY)
    }

    function pt(e) {
        return e.maxX - e.minX + (e.maxY - e.minY)
    }

    function dt(e, t) {
        return e.minX <= t.minX && e.minY <= t.minY && t.maxX <= e.maxX && t.maxY <= e.maxY
    }

    function vt(e, t) {
        return t.minX <= e.maxX && t.minY <= e.maxY && t.maxX >= e.minX && t.maxY >= e.minY
    }

    function mt(e) {
        return {children: e, height: 1, leaf: !0, minX: 1 / 0, minY: 1 / 0, maxX: -1 / 0, maxY: -1 / 0}
    }

    function gt(e, t, n, r, i) {
        for (var s, o = [t, n]; o.length;) (n = o.pop()) - (t = o.pop()) <= r || (s = t + Math.ceil((n - t) / r / 2) * r, Xo(e, s, t, n, i), o.push(t, s, s, n))
    }

    function yt(e, t) {
        return t = {exports: {}}, e(t, t.exports), t.exports
    }

    function bt(e, t) {
        if (!(this instanceof bt)) return new bt(e, t);
        if (this.data = e || [], this.length = this.data.length, this.compare = t || function (e, t) {
            return e < t ? -1 : e > t ? 1 : 0
        }, this.length > 0) for (var n = (this.length >> 1) - 1; n >= 0; n--) this._down(n)
    }

    function wt(e, t, n) {
        t = Math.max(0, void 0 === t ? 2 : t), n = n || 0;
        for (var r, i = function (e) {
            for (var t = e[0], n = e[0], r = e[0], i = e[0], s = 0; s < e.length; s++) {
                var o = e[s];
                o[0] < t[0] && (t = o), o[0] > r[0] && (r = o), o[1] < n[1] && (n = o), o[1] > i[1] && (i = o)
            }
            var u = [t, n, r, i], a = u.slice();
            for (s = 0; s < e.length; s++) iu(e[s], u) || a.push(e[s]);
            var f = eu(a), l = [];
            for (s = 0; s < f.length; s++) l.push(a[f[s]]);
            return l
        }(e), s = Vo(16, ["[0]", "[1]", "[0]", "[1]"]).load(e), o = [], u = 0; u < i.length; u++) {
            var a = i[u];
            s.remove(a), r = Nt(a, r), o.push(r)
        }
        var f = Vo(16);
        for (u = 0; u < o.length; u++) f.insert(Tt(o[u]));
        for (var l = t * t, c = n * n; o.length;) {
            var h = o.shift(), p = h.p, d = h.next.p, v = Ct(p, d);
            if (!(v < c)) {
                var m = v / l;
                (a = function (e, t, n, r, i, s, o) {
                    var u = new nu(null, Et), a = e.data;
                    for (; a;) {
                        for (var f = 0; f < a.children.length; f++) {
                            var l = a.children[f], c = a.leaf ? kt(l, n, r) : function (e, t, n) {
                                if (St(e, n) || St(t, n)) return 0;
                                var r = Lt(e[0], e[1], t[0], t[1], n.minX, n.minY, n.maxX, n.minY);
                                if (0 === r) return 0;
                                var i = Lt(e[0], e[1], t[0], t[1], n.minX, n.minY, n.minX, n.maxY);
                                if (0 === i) return 0;
                                var s = Lt(e[0], e[1], t[0], t[1], n.maxX, n.minY, n.maxX, n.maxY);
                                if (0 === s) return 0;
                                var o = Lt(e[0], e[1], t[0], t[1], n.minX, n.maxY, n.maxX, n.maxY);
                                return 0 === o ? 0 : Math.min(r, i, s, o)
                            }(n, r, l);
                            c > s || u.push({node: l, dist: c})
                        }
                        for (; u.length && !u.peek().node.children;) {
                            var h = u.pop(), p = h.node, d = kt(p, t, n), v = kt(p, r, i);
                            if (h.dist < d && h.dist < v && xt(n, p, o) && xt(r, p, o)) return p
                        }
                        (a = u.pop()) && (a = a.node)
                    }
                    return null
                }(s, h.prev.p, p, d, h.next.next.p, m, f)) && Math.min(Ct(a, p), Ct(a, d)) <= m && (o.push(h), o.push(Nt(a, h)), s.remove(a), f.remove(h), f.insert(Tt(h)), f.insert(Tt(h.next)))
            }
        }
        h = r;
        var g = [];
        do g.push(h.p), h = h.next; while (h !== r);
        return g.push(h.p), g
    }

    function Et(e, t) {
        return e.dist - t.dist
    }

    function St(e, t) {
        return e[0] >= t.minX && e[0] <= t.maxX && e[1] >= t.minY && e[1] <= t.maxY
    }

    function xt(e, t, n) {
        for (var r = Math.min(e[0], t[0]), i = Math.min(e[1], t[1]), s = Math.max(e[0], t[0]), o = Math.max(e[1], t[1]), u = n.search({
            minX: r,
            minY: i,
            maxX: s,
            maxY: o
        }), a = 0; a < u.length; a++) if (function (e, t, n, r) {
            return e !== r && t !== n && su(e, t, n) > 0 != su(e, t, r) > 0 && su(n, r, e) > 0 != su(n, r, t) > 0
        }(u[a].p, u[a].next.p, e, t)) return !1;
        return !0
    }

    function Tt(e) {
        var t = e.p, n = e.next.p;
        return e.minX = Math.min(t[0], n[0]), e.minY = Math.min(t[1], n[1]), e.maxX = Math.max(t[0], n[0]), e.maxY = Math.max(t[1], n[1]), e
    }

    function Nt(e, t) {
        var n = {p: e, prev: null, next: null, minX: 0, minY: 0, maxX: 0, maxY: 0};
        return t ? (n.next = t.next, n.prev = t, t.next.prev = n, t.next = n) : (n.prev = n, n.next = n), n
    }

    function Ct(e, t) {
        var n = e[0] - t[0], r = e[1] - t[1];
        return n * n + r * r
    }

    function kt(e, t, n) {
        var r = t[0], i = t[1], s = n[0] - r, o = n[1] - i;
        if (0 !== s || 0 !== o) {
            var u = ((e[0] - r) * s + (e[1] - i) * o) / (s * s + o * o);
            u > 1 ? (r = n[0], i = n[1]) : u > 0 && (r += s * u, i += o * u)
        }
        return s = e[0] - r, o = e[1] - i, s * s + o * o
    }

    function Lt(e, t, n, r, i, s, o, u) {
        var a, f, l, c, h = n - e, p = r - t, d = o - i, v = u - s, m = e - i, g = t - s, y = h * h + p * p,
            b = h * d + p * v, w = d * d + v * v, E = h * m + p * g, S = d * m + v * g, x = y * w - b * b, T = x, N = x;
        0 === x ? (f = 0, T = 1, c = S, N = w) : (c = y * S - b * E, (f = b * S - w * E) < 0 ? (f = 0, c = S, N = w) : f > T && (f = T, c = S + b, N = w)), c < 0 ? (c = 0, -E < 0 ? f = 0 : -E > y ? f = T : (f = -E, T = y)) : c > N && (c = N, -E + b < 0 ? f = 0 : -E + b > y ? f = T : (f = -E + b, T = y)), a = 0 === f ? 0 : f / T;
        var C = (1 - (l = 0 === c ? 0 : c / N)) * i + l * o - ((1 - a) * e + a * n),
            k = (1 - l) * s + l * u - ((1 - a) * t + a * r);
        return C * C + k * k
    }

    function At(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.concavity || 1 / 0, r = [];
        if (k(e, function (e) {
            r.push([e[0], e[1]])
        }), !r.length) return null;
        var i = ou(r, n);
        return i.length > 3 ? s([i]) : null
    }

    function Ot(e, t, n) {
        if ("object" != typeof (n = n || {})) throw new Error("options is invalid");
        var r = n.ignoreBoundary;
        if (!e) throw new Error("point is required");
        if (!t) throw new Error("polygon is required");
        var i = z(e), s = W(t), o = t.geometry ? t.geometry.type : t.type, u = t.bbox;
        if (u && !1 === function (e, t) {
            return t[0] <= e[0] && t[1] <= e[1] && t[2] >= e[0] && t[3] >= e[1]
        }(i, u)) return !1;
        "Polygon" === o && (s = [s]);
        for (var a = 0, f = !1; a < s.length && !f; a++) if (Mt(i, s[a][0], r)) {
            for (var l = !1, c = 1; c < s[a].length && !l;) Mt(i, s[a][c], !r) && (l = !0), c++;
            l || (f = !0)
        }
        return f
    }

    function Mt(e, t, n) {
        var r = !1;
        t[0][0] === t[t.length - 1][0] && t[0][1] === t[t.length - 1][1] && (t = t.slice(0, t.length - 1));
        for (var i = 0, s = t.length - 1; i < t.length; s = i++) {
            var o = t[i][0], u = t[i][1], a = t[s][0], f = t[s][1];
            if (e[1] * (o - a) + u * (a - e[0]) + f * (e[0] - o) == 0 && (o - e[0]) * (a - e[0]) <= 0 && (u - e[1]) * (f - e[1]) <= 0) return !n;
            u > e[1] != f > e[1] && e[0] < (a - o) * (e[1] - u) / (f - u) + o && (r = !r)
        }
        return r
    }

    function _t(e, t) {
        var n = [];
        return P(t, function (t) {
            M(e, function (e) {
                Ot(e, t) && n.push(e)
            })
        }), f(n)
    }

    function Dt(e, t) {
        if ("FeatureCollection" !== e.type) throw new Error("points must be a FeatureCollection");
        var n = !1;
        return f(function (e) {
            if (e.length < 3) return [];
            e.sort(Ht);
            var t, n, r, i, s, o, u = e.length - 1, a = e[u].x, f = e[0].x, l = e[u].y, c = l;
            for (; u--;) e[u].y < l && (l = e[u].y), e[u].y > c && (c = e[u].y);
            var h, p = f - a, d = c - l, v = p > d ? p : d, m = .5 * (f + a), g = .5 * (c + l),
                y = [new Pt({x: m - 20 * v, y: g - v, __sentinel: !0}, {
                    x: m,
                    y: g + 20 * v,
                    __sentinel: !0
                }, {x: m + 20 * v, y: g - v, __sentinel: !0})], b = [], w = [];
            u = e.length;
            for (; u--;) {
                for (w.length = 0, h = y.length; h--;) (p = e[u].x - y[h].x) > 0 && p * p > y[h].r ? (b.push(y[h]), y.splice(h, 1)) : (d = e[u].y - y[h].y, p * p + d * d > y[h].r || (w.push(y[h].a, y[h].b, y[h].b, y[h].c, y[h].c, y[h].a), y.splice(h, 1)));
                for (Bt(w), h = w.length; h;) n = w[--h], t = w[--h], r = e[u], i = n.x - t.x, s = n.y - t.y, o = 2 * (i * (r.y - n.y) - s * (r.x - n.x)), Math.abs(o) > 1e-12 && y.push(new Pt(t, n, r))
            }
            Array.prototype.push.apply(b, y), u = b.length;
            for (; u--;) (b[u].a.__sentinel || b[u].b.__sentinel || b[u].c.__sentinel) && b.splice(u, 1);
            return b
        }(e.features.map(function (e) {
            var r = {x: e.geometry.coordinates[0], y: e.geometry.coordinates[1]};
            return t ? r.z = e.properties[t] : 3 === e.geometry.coordinates.length && (n = !0, r.z = e.geometry.coordinates[2]), r
        })).map(function (e) {
            var t = [e.a.x, e.a.y], r = [e.b.x, e.b.y], i = [e.c.x, e.c.y], o = {};
            return n ? (t.push(e.a.z), r.push(e.b.z), i.push(e.c.z)) : o = {
                a: e.a.z,
                b: e.b.z,
                c: e.c.z
            }, s([[t, r, i, t]], o)
        }))
    }

    function Pt(e, t, n) {
        this.a = e, this.b = t, this.c = n;
        var r, i, s = t.x - e.x, o = t.y - e.y, u = n.x - e.x, a = n.y - e.y, f = s * (e.x + t.x) + o * (e.y + t.y),
            l = u * (e.x + n.x) + a * (e.y + n.y), c = 2 * (s * (n.y - t.y) - o * (n.x - t.x));
        this.x = (a * f - o * l) / c, this.y = (s * l - u * f) / c, r = this.x - e.x, i = this.y - e.y, this.r = r * r + i * i
    }

    function Ht(e, t) {
        return t.x - e.x
    }

    function Bt(e) {
        var t, n, r, i, s, o = e.length;
        e:for (; o;) for (n = e[--o], t = e[--o], r = o; r;) if (s = e[--r], i = e[--r], t === i && n === s || t === s && n === i) {
            e.splice(o, 2), e.splice(r, 2), o -= 2;
            continue e
        }
    }

    function jt(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.units, i = z(e), s = z(t), o = w(s[1] - i[1]), u = w(s[0] - i[0]), a = w(i[1]), f = w(s[1]),
            l = Math.pow(Math.sin(o / 2), 2) + Math.pow(Math.sin(u / 2), 2) * Math.cos(a) * Math.cos(f);
        return v(2 * Math.atan2(Math.sqrt(l), Math.sqrt(1 - l)), r)
    }

    function Ft(e) {
        if (!e) throw new Error("geojson is required");
        switch (e.type) {
            case"Feature":
                return It(e);
            case"FeatureCollection":
                return function (e) {
                    var t = {type: "FeatureCollection"};
                    return Object.keys(e).forEach(function (n) {
                        switch (n) {
                            case"type":
                            case"features":
                                return;
                            default:
                                t[n] = e[n]
                        }
                    }), t.features = e.features.map(function (e) {
                        return It(e)
                    }), t
                }(e);
            case"Point":
            case"LineString":
            case"Polygon":
            case"MultiPoint":
            case"MultiLineString":
            case"MultiPolygon":
            case"GeometryCollection":
                return Rt(e);
            default:
                throw new Error("unknown GeoJSON type")
        }
    }

    function It(e) {
        var t = {type: "Feature"};
        return Object.keys(e).forEach(function (n) {
            switch (n) {
                case"type":
                case"properties":
                case"geometry":
                    return;
                default:
                    t[n] = e[n]
            }
        }), t.properties = qt(e.properties), t.geometry = Rt(e.geometry), t
    }

    function qt(e) {
        var t = {};
        return e ? (Object.keys(e).forEach(function (n) {
            var r = e[n];
            "object" == typeof r ? null === r ? t[n] = null : r.length ? t[n] = r.map(function (e) {
                return e
            }) : t[n] = qt(r) : t[n] = r
        }), t) : t
    }

    function Rt(e) {
        var t = {type: e.type};
        return e.bbox && (t.bbox = e.bbox), "GeometryCollection" === e.type ? (t.geometries = e.geometries.map(function (e) {
            return Rt(e)
        }), t) : (t.coordinates = Ut(e.coordinates), t)
    }

    function Ut(e) {
        return "object" != typeof e[0] ? e.slice() : e.map(function (e) {
            return Ut(e)
        })
    }

    function zt(e, t) {
        function n(e, t) {
            t.length && t.pop();
            for (var n = f[e < 0 ? ~e : e], r = 0, i = n.length; r < i; ++r) t.push(a(n[r], r));
            e < 0 && lu(t, i)
        }

        function r(e) {
            return a(e)
        }

        function i(e) {
            for (var t = [], r = 0, i = e.length; r < i; ++r) n(e[r], t);
            return t.length < 2 && t.push(t[0]), t
        }

        function s(e) {
            for (var t = i(e); t.length < 4;) t.push(t[0]);
            return t
        }

        function o(e) {
            return e.map(s)
        }

        function u(e) {
            var t, n = e.type;
            switch (n) {
                case"GeometryCollection":
                    return {type: n, geometries: e.geometries.map(u)};
                case"Point":
                    t = r(e.coordinates);
                    break;
                case"MultiPoint":
                    t = e.coordinates.map(r);
                    break;
                case"LineString":
                    t = i(e.arcs);
                    break;
                case"MultiLineString":
                    t = e.arcs.map(i);
                    break;
                case"Polygon":
                    t = o(e.arcs);
                    break;
                case"MultiPolygon":
                    t = e.arcs.map(o);
                    break;
                default:
                    return null
            }
            return {type: n, coordinates: t}
        }

        var a = fu(e.transform), f = e.arcs;
        return u(t)
    }

    function Wt(e, t) {
        function n(e) {
            switch (e.type) {
                case"GeometryCollection":
                    e.geometries.forEach(n);
                    break;
                case"Polygon":
                    r(e.arcs);
                    break;
                case"MultiPolygon":
                    e.arcs.forEach(r)
            }
        }

        function r(e) {
            e.forEach(function (t) {
                t.forEach(function (t) {
                    (s[t = t < 0 ? ~t : t] || (s[t] = [])).push(e)
                })
            }), o.push(e)
        }

        function i(t) {
            return function (e) {
                for (var t, n = -1, r = e.length, i = e[r - 1], s = 0; ++n < r;) t = i, i = e[n], s += t[0] * i[1] - t[1] * i[0];
                return Math.abs(s)
            }(zt(e, {type: "Polygon", arcs: [t]}).coordinates[0])
        }

        var s = {}, o = [], u = [];
        return t.forEach(n), o.forEach(function (e) {
            if (!e._) {
                var t = [], n = [e];
                for (e._ = 1, u.push(t); e = n.pop();) t.push(e), e.forEach(function (e) {
                    e.forEach(function (e) {
                        s[e < 0 ? ~e : e].forEach(function (e) {
                            e._ || (e._ = 1, n.push(e))
                        })
                    })
                })
            }
        }), o.forEach(function (e) {
            delete e._
        }), {
            type: "MultiPolygon", arcs: u.map(function (t) {
                var n, r = [];
                if (t.forEach(function (e) {
                    e.forEach(function (e) {
                        e.forEach(function (e) {
                            s[e < 0 ? ~e : e].length < 2 && r.push(e)
                        })
                    })
                }), r = cu(e, r), (n = r.length) > 1) for (var o, u, a = 1, f = i(r[0]); a < n; ++a) (o = i(r[a])) > f && (u = r[0], r[0] = r[a], r[a] = u, f = o);
                return r
            })
        }
    }

    function Xt(e, t, n) {
        for (var r, i = t + (n-- - t >> 1); t < i; ++t, --n) r = e[t], e[t] = e[n], e[n] = r
    }

    function Vt(e) {
        return null == e ? {type: null} : ("FeatureCollection" === e.type ? function (e) {
            var t = {type: "GeometryCollection", geometries: e.features.map($t)};
            return null != e.bbox && (t.bbox = e.bbox), t
        } : "Feature" === e.type ? $t : Jt)(e)
    }

    function $t(e) {
        var t, n = Jt(e.geometry);
        null != e.id && (n.id = e.id), null != e.bbox && (n.bbox = e.bbox);
        for (t in e.properties) {
            n.properties = e.properties;
            break
        }
        return n
    }

    function Jt(e) {
        if (null == e) return {type: null};
        var t = "GeometryCollection" === e.type ? {
            type: "GeometryCollection",
            geometries: e.geometries.map(Jt)
        } : "Point" === e.type || "MultiPoint" === e.type ? {type: e.type, coordinates: e.coordinates} : {
            type: e.type,
            arcs: e.coordinates
        };
        return null != e.bbox && (t.bbox = e.bbox), t
    }

    function Kt(e) {
        var t, n = e[0], r = e[1];
        return r < n && (t = n, n = r, r = t), n + 31 * r
    }

    function Qt(e, t) {
        var n, r = e[0], i = e[1], s = t[0], o = t[1];
        return i < r && (n = r, r = i, i = n), o < s && (n = s, s = o, o = n), r === s && i === o
    }

    function Gt(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.mutate;
        if ("FeatureCollection" !== G(e)) throw new Error("geojson must be a FeatureCollection");
        if (!e.features.length) throw new Error("geojson is empty");
        !1 !== n && void 0 !== n || (e = Ft(e));
        var r = [], i = R(e, function (e, t) {
            var n = function (e, t) {
                var n, r = e.geometry.coordinates, i = t.geometry.coordinates, s = Yt(r[0]), o = Yt(r[r.length - 1]),
                    a = Yt(i[0]), f = Yt(i[i.length - 1]);
                if (s === f) n = i.concat(r.slice(1)); else if (a === o) n = r.concat(i.slice(1)); else if (s === a) n = r.slice(1).reverse().concat(i); else {
                    if (o !== f) return null;
                    n = r.concat(i.reverse().slice(1))
                }
                return u(n)
            }(e, t);
            return n || (r.push(e), t)
        });
        return i && r.push(i), r.length ? 1 === r.length ? r[0] : l(r.map(function (e) {
            return e.coordinates
        })) : null
    }

    function Yt(e) {
        return e[0].toString() + "," + e[1].toString()
    }

    function Zt(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.mutate;
        if ("FeatureCollection" !== G(e)) throw new Error("geojson must be a FeatureCollection");
        if (!e.features.length) throw new Error("geojson is empty");
        !1 !== n && void 0 !== n || (e = Ft(e));
        var r = function (e) {
            var t = {};
            B(e, function (e) {
                t[e.geometry.type] = !0
            });
            var n = Object.keys(t);
            return 1 === n.length ? n[0] : null
        }(e);
        if (!r) throw new Error("geojson must be homogenous");
        switch (r) {
            case"LineString":
                return Gt(e, t);
            case"Polygon":
                return function (e, t) {
                    if (t = t || {}, !T(t)) throw new Error("options is invalid");
                    var n = t.mutate;
                    if ("FeatureCollection" !== G(e)) throw new Error("geojson must be a FeatureCollection");
                    if (!e.features.length) throw new Error("geojson is empty");
                    !1 !== n && void 0 !== n || (e = Ft(e));
                    var r = [];
                    B(e, function (e) {
                        r.push(e.geometry)
                    });
                    var i = Su({geoms: p(r).geometry});
                    return hu(i, i.objects.geoms.geometries)
                }(e, t);
            default:
                throw new Error(r + " is not supported")
        }
    }

    function en(e, n) {
        var r = "object" == typeof n ? n.mutate : n;
        if (!e) throw new Error("geojson is required");
        var i = G(e), s = [];
        switch (i) {
            case"LineString":
                s = tn(e);
                break;
            case"MultiLineString":
            case"Polygon":
                W(e).forEach(function (e) {
                    s.push(tn(e))
                });
                break;
            case"MultiPolygon":
                W(e).forEach(function (e) {
                    var t = [];
                    e.forEach(function (e) {
                        t.push(tn(e))
                    }), s.push(t)
                });
                break;
            case"Point":
                return e;
            case"MultiPoint":
                var o = {};
                W(e).forEach(function (e) {
                    var t = e.join("-");
                    o.hasOwnProperty(t) || (s.push(e), o[t] = !0)
                });
                break;
            default:
                throw new Error(i + " geometry not supported")
        }
        return e.coordinates ? !0 === r ? (e.coordinates = s, e) : {
            type: i,
            coordinates: s
        } : !0 === r ? (e.geometry.coordinates = s, e) : t({type: i, coordinates: s}, e.properties, e.bbox, e.id)
    }

    function tn(e) {
        var t = W(e);
        if (2 === t.length && !function (e, t) {
            return e[0] === t[0] && e[1] === t[1]
        }(t[0], t[1])) return t;
        var n, r, i, s = [], o = t.length - 1;
        s.push(t[0]);
        for (var u = 1; u < o; u++) n = t[u - 1], r = t[u], function (e, t, n) {
            var r = n[0], i = n[1], s = e[0], o = e[1], u = t[0], a = t[1], f = u - s, l = a - o;
            return (r - s) * l - (i - o) * f == 0 && (Math.abs(f) >= Math.abs(l) ? f > 0 ? s <= r && r <= u : u <= r && r <= s : l > 0 ? o <= i && i <= a : a <= i && i <= o)
        }(n, i = t[u + 1], r) || s.push(r);
        return s.push(i), s
    }

    function nn(e, t) {
        var n = e.x - t.x, r = e.y - t.y;
        return n * n + r * r
    }

    function rn(e, t, n) {
        var r = t.x, i = t.y, s = n.x - r, o = n.y - i;
        if (0 !== s || 0 !== o) {
            var u = ((e.x - r) * s + (e.y - i) * o) / (s * s + o * o);
            u > 1 ? (r = n.x, i = n.y) : u > 0 && (r += s * u, i += o * u)
        }
        return s = e.x - r, o = e.y - i, s * s + o * o
    }

    function sn(e, t, n, r, i) {
        for (var s, o = r, u = t + 1; u < n; u++) {
            var a = rn(e[u], e[t], e[n]);
            a > o && (s = u, o = a)
        }
        o > r && (s - t > 1 && sn(e, t, s, r, i), i.push(e[s]), n - s > 1 && sn(e, s, n, r, i))
    }

    function on(e, t, n) {
        if (e.length <= 2) return e;
        var r = void 0 !== t ? t * t : 1;
        return e = n ? e : function (e, t) {
            for (var n, r = e[0], i = [r], s = 1, o = e.length; s < o; s++) nn(n = e[s], r) > t && (i.push(n), r = n);
            return r !== n && i.push(n), i
        }(e, r), e = function (e, t) {
            var n = e.length - 1, r = [e[0]];
            return sn(e, 0, n, t, r), r.push(e[n]), r
        }(e, r)
    }

    function un(e, t, n) {
        return on(e.map(function (e) {
            return {x: e[0], y: e[1], z: e[2]}
        }), t, n).map(function (e) {
            return e.z ? [e.x, e.y, e.z] : [e.x, e.y]
        })
    }

    function an(e, t, n) {
        return e.map(function (e) {
            var r = e.map(function (e) {
                return {x: e[0], y: e[1]}
            });
            if (r.length < 4) throw new Error("invalid polygon");
            for (var i = on(r, t, n).map(function (e) {
                return [e.x, e.y]
            }); !function (e) {
                return !(e.length < 3 || 3 === e.length && e[2][0] === e[0][0] && e[2][1] === e[0][1])
            }(i);) i = on(r, t -= .01 * t, n).map(function (e) {
                return [e.x, e.y]
            });
            return i[i.length - 1][0] === i[0][0] && i[i.length - 1][1] === i[0][1] || i.push(i[0]), i
        })
    }

    function fn(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.resolution || 1e4, r = t.sharpness || .85;
        if (!e) throw new Error("line is required");
        if (!x(n)) throw new Error("resolution must be an number");
        if (!x(r)) throw new Error("sharpness must be an number");
        for (var i = [], s = new xu({
            points: K(e).coordinates.map(function (e) {
                return {x: e[0], y: e[1]}
            }), duration: n, sharpness: r
        }), o = 0; o < s.duration; o += 10) {
            var a = s.pos(o);
            Math.floor(o / 100) % 2 == 0 && i.push([a.x, a.y])
        }
        return u(i, e.properties)
    }

    function ln(e) {
        N(e);
        var t = Number(e[0]), n = Number(e[1]), r = Number(e[2]), i = Number(e[3]);
        if (6 === e.length) throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");
        var o = [t, n];
        return s([[o, [r, n], [r, i], [t, i], o]])
    }

    function cn(e) {
        return ln(U(e))
    }

    function hn(e) {
        var t = e[0], n = e[1], r = e[2], i = e[3];
        if (jt(e.slice(0, 2), [r, n]) >= jt(e.slice(0, 2), [t, i])) {
            var s = (n + i) / 2;
            return [t, s - (r - t) / 2, r, s + (r - t) / 2]
        }
        var o = (t + r) / 2;
        return [o - (i - n) / 2, n, o + (i - n) / 2, i]
    }

    function pn(e, t, n, i) {
        if (i = i || {}, !T(i)) throw new Error("options is invalid");
        var s = i.units, o = i.properties, u = z(e), a = w(u[0]), f = w(u[1]), l = w(n), c = m(t, s),
            h = Math.asin(Math.sin(f) * Math.cos(c) + Math.cos(f) * Math.sin(c) * Math.cos(l));
        return r([b(a + Math.atan2(Math.sin(l) * Math.sin(c) * Math.cos(f), Math.cos(c) - Math.sin(f) * Math.sin(h))), b(h)], o)
    }

    function dn(e, t, n) {
        var r = (n = n || {}).steps || 64, i = n.properties;
        if (!e) throw new Error("center is required");
        if (!t) throw new Error("radius is required");
        if ("object" != typeof n) throw new Error("options must be an object");
        if ("number" != typeof r) throw new Error("steps must be a number");
        r = r || 64, i = i || e.properties || {};
        for (var o = [], u = 0; u < r; u++) o.push(pn(e, t, -360 * u / r, n).geometry.coordinates);
        return o.push(o[0]), s([o], i)
    }

    function vn(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        if (!0 === n.final) return function (e, t) {
            var n = vn(t, e);
            return n = (n + 180) % 360
        }(e, t);
        var r = z(e), i = z(t), s = w(r[0]), o = w(i[0]), u = w(r[1]), a = w(i[1]), f = Math.sin(o - s) * Math.cos(a),
            l = Math.cos(u) * Math.sin(a) - Math.sin(u) * Math.cos(a) * Math.cos(o - s);
        return b(Math.atan2(f, l))
    }

    function mn(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.properties;
        if (!e) throw new Error("geojson is required");
        var i = U(e);
        return r([(i[0] + i[2]) / 2, (i[1] + i[3]) / 2], n)
    }

    function gn(e, t) {
        var n = 0, i = 0, s = 0;
        return k(e, function (e) {
            n += e[0], i += e[1], s++
        }, !0), r([n / s, i / s], t)
    }

    function yn(e, t) {
        switch (G(e)) {
            case"Point":
                return e;
            case"Polygon":
                var n = [];
                k(e, function (e) {
                    n.push(e)
                });
                var i, s, o, u, a, f, l, c, h = gn(e, t), p = h.geometry.coordinates, d = 0, v = 0, m = 0,
                    g = n.map(function (e) {
                        return [e[0] - p[0], e[1] - p[1]]
                    });
                for (i = 0; i < n.length - 1; i++) u = (s = g[i])[0], f = s[1], a = (o = g[i + 1])[0], m += c = u * (l = o[1]) - a * f, d += (u + a) * c, v += (f + l) * c;
                if (0 === m) return h;
                var y = 1 / (6 * .5 * m);
                return r([p[0] + y * d, p[1] + y * v], t);
            default:
                var b = At(e);
                return b ? yn(b, t) : gn(e, t)
        }
    }

    function bn(e) {
        var t = [];
        return "FeatureCollection" === e.type ? M(e, function (e) {
            k(e, function (n) {
                t.push(r(n, e.properties))
            })
        }) : k(e, function (n) {
            t.push(r(n, e.properties))
        }), f(t)
    }

    function wn(e, t, n) {
        n = n || 2;
        var r = t && t.length, i = r ? t[0] * n : e.length, s = En(e, 0, i, n, !0), o = [];
        if (!s) return o;
        var u, a, f, l, c, h, p;
        if (r && (s = function (e, t, n, r) {
            var i, s, o, u, a, f = [];
            for (i = 0, s = t.length; i < s; i++) o = t[i] * r, u = i < s - 1 ? t[i + 1] * r : e.length, (a = En(e, o, u, r, !1)) === a.next && (a.steiner = !0), f.push(function (e) {
                var t = e, n = e;
                do t.x < n.x && (n = t), t = t.next; while (t !== e);
                return n
            }(a));
            for (f.sort(Tn), i = 0; i < f.length; i++) !function (e, t) {
                if (t = function (e, t) {
                    var n, r = t, i = e.x, s = e.y, o = -1 / 0;
                    do {
                        if (s <= r.y && s >= r.next.y && r.next.y !== r.y) {
                            var u = r.x + (s - r.y) * (r.next.x - r.x) / (r.next.y - r.y);
                            if (u <= i && u > o) {
                                if (o = u, u === i) {
                                    if (s === r.y) return r;
                                    if (s === r.next.y) return r.next
                                }
                                n = r.x < r.next.x ? r : r.next
                            }
                        }
                        r = r.next
                    } while (r !== t);
                    if (!n) return null;
                    if (i === o) return n.prev;
                    var a, f = n, l = n.x, c = n.y, h = 1 / 0;
                    for (r = n.next; r !== f;) i >= r.x && r.x >= l && i !== r.x && Cn(s < c ? i : o, s, l, c, s < c ? o : i, s, r.x, r.y) && ((a = Math.abs(s - r.y) / (i - r.x)) < h || a === h && r.x > n.x) && On(r, e) && (n = r, h = a), r = r.next;
                    return n
                }(e, t)) {
                    var n = Mn(t, e);
                    Sn(n, n.next)
                }
            }(f[i], n), n = Sn(n, n.next);
            return n
        }(e, t, s, n)), e.length > 80 * n) {
            u = f = e[0], a = l = e[1];
            for (var d = n; d < i; d += n) c = e[d], h = e[d + 1], c < u && (u = c), h < a && (a = h), c > f && (f = c), h > l && (l = h);
            p = 0 !== (p = Math.max(f - u, l - a)) ? 1 / p : 0
        }
        return xn(s, o, n, u, a, p), o
    }

    function En(e, t, n, r, i) {
        var s, o;
        if (i === Hn(e, t, n, r) > 0) for (s = t; s < n; s += r) o = _n(s, e[s], e[s + 1], o); else for (s = n - r; s >= t; s -= r) o = _n(s, e[s], e[s + 1], o);
        return o && Ln(o, o.next) && (Dn(o), o = o.next), o
    }

    function Sn(e, t) {
        if (!e) return e;
        t || (t = e);
        var n, r = e;
        do if (n = !1, r.steiner || !Ln(r, r.next) && 0 !== kn(r.prev, r, r.next)) r = r.next; else {
            if (Dn(r), (r = t = r.prev) === r.next) break;
            n = !0
        } while (n || r !== t);
        return t
    }

    function xn(e, t, n, r, i, s, o) {
        if (e) {
            !o && s && function (e, t, n, r) {
                var i = e;
                do null === i.z && (i.z = Nn(i.x, i.y, t, n, r)), i.prevZ = i.prev, i.nextZ = i.next, i = i.next; while (i !== e);
                i.prevZ.nextZ = null, i.prevZ = null, function (e) {
                    var t, n, r, i, s, o, u, a, f = 1;
                    do {
                        for (n = e, e = null, s = null, o = 0; n;) {
                            for (o++, r = n, u = 0, t = 0; t < f && (u++, r = r.nextZ); t++) ;
                            for (a = f; u > 0 || a > 0 && r;) 0 !== u && (0 === a || !r || n.z <= r.z) ? (i = n, n = n.nextZ, u--) : (i = r, r = r.nextZ, a--), s ? s.nextZ = i : e = i, i.prevZ = s, s = i;
                            n = r
                        }
                        s.nextZ = null, f *= 2
                    } while (o > 1)
                }(i)
            }(e, r, i, s);
            for (var u, a, f = e; e.prev !== e.next;) if (u = e.prev, a = e.next, s ? function (e, t, n, r) {
                var i = e.prev, s = e, o = e.next;
                if (kn(i, s, o) >= 0) return !1;
                var u = i.x < s.x ? i.x < o.x ? i.x : o.x : s.x < o.x ? s.x : o.x,
                    a = i.y < s.y ? i.y < o.y ? i.y : o.y : s.y < o.y ? s.y : o.y,
                    f = i.x > s.x ? i.x > o.x ? i.x : o.x : s.x > o.x ? s.x : o.x,
                    l = i.y > s.y ? i.y > o.y ? i.y : o.y : s.y > o.y ? s.y : o.y, c = Nn(u, a, t, n, r),
                    h = Nn(f, l, t, n, r), p = e.nextZ;
                for (; p && p.z <= h;) {
                    if (p !== e.prev && p !== e.next && Cn(i.x, i.y, s.x, s.y, o.x, o.y, p.x, p.y) && kn(p.prev, p, p.next) >= 0) return !1;
                    p = p.nextZ
                }
                p = e.prevZ;
                for (; p && p.z >= c;) {
                    if (p !== e.prev && p !== e.next && Cn(i.x, i.y, s.x, s.y, o.x, o.y, p.x, p.y) && kn(p.prev, p, p.next) >= 0) return !1;
                    p = p.prevZ
                }
                return !0
            }(e, r, i, s) : function (e) {
                var t = e.prev, n = e, r = e.next;
                if (kn(t, n, r) >= 0) return !1;
                var i = e.next.next;
                for (; i !== e.prev;) {
                    if (Cn(t.x, t.y, n.x, n.y, r.x, r.y, i.x, i.y) && kn(i.prev, i, i.next) >= 0) return !1;
                    i = i.next
                }
                return !0
            }(e)) t.push(u.i / n), t.push(e.i / n), t.push(a.i / n), Dn(e), e = a.next, f = a.next; else if ((e = a) === f) {
                o ? 1 === o ? xn(e = function (e, t, n) {
                    var r = e;
                    do {
                        var i = r.prev, s = r.next.next;
                        !Ln(i, s) && An(i, r, r.next, s) && On(i, s) && On(s, i) && (t.push(i.i / n), t.push(r.i / n), t.push(s.i / n), Dn(r), Dn(r.next), r = e = s), r = r.next
                    } while (r !== e);
                    return r
                }(e, t, n), t, n, r, i, s, 2) : 2 === o && function (e, t, n, r, i, s) {
                    var o = e;
                    do {
                        for (var u = o.next.next; u !== o.prev;) {
                            if (o.i !== u.i && function (e, t) {
                                return e.next.i !== t.i && e.prev.i !== t.i && !function (e, t) {
                                    var n = e;
                                    do {
                                        if (n.i !== e.i && n.next.i !== e.i && n.i !== t.i && n.next.i !== t.i && An(n, n.next, e, t)) return !0;
                                        n = n.next
                                    } while (n !== e);
                                    return !1
                                }(e, t) && On(e, t) && On(t, e) && function (e, t) {
                                    var n = e, r = !1, i = (e.x + t.x) / 2, s = (e.y + t.y) / 2;
                                    do n.y > s != n.next.y > s && n.next.y !== n.y && i < (n.next.x - n.x) * (s - n.y) / (n.next.y - n.y) + n.x && (r = !r), n = n.next; while (n !== e);
                                    return r
                                }(e, t)
                            }(o, u)) {
                                var a = Mn(o, u);
                                return o = Sn(o, o.next), a = Sn(a, a.next), xn(o, t, n, r, i, s), void xn(a, t, n, r, i, s)
                            }
                            u = u.next
                        }
                        o = o.next
                    } while (o !== e)
                }(e, t, n, r, i, s) : xn(Sn(e), t, n, r, i, s, 1);
                break
            }
        }
    }

    function Tn(e, t) {
        return e.x - t.x
    }

    function Nn(e, t, n, r, i) {
        return e = 32767 * (e - n) * i, t = 32767 * (t - r) * i, e = 16711935 & (e | e << 8), e = 252645135 & (e | e << 4), e = 858993459 & (e | e << 2), e = 1431655765 & (e | e << 1), t = 16711935 & (t | t << 8), t = 252645135 & (t | t << 4), t = 858993459 & (t | t << 2), t = 1431655765 & (t | t << 1), e | t << 1
    }

    function Cn(e, t, n, r, i, s, o, u) {
        return (i - o) * (t - u) - (e - o) * (s - u) >= 0 && (e - o) * (r - u) - (n - o) * (t - u) >= 0 && (n - o) * (s - u) - (i - o) * (r - u) >= 0
    }

    function kn(e, t, n) {
        return (t.y - e.y) * (n.x - t.x) - (t.x - e.x) * (n.y - t.y)
    }

    function Ln(e, t) {
        return e.x === t.x && e.y === t.y
    }

    function An(e, t, n, r) {
        return !!(Ln(e, t) && Ln(n, r) || Ln(e, r) && Ln(n, t)) || kn(e, t, n) > 0 != kn(e, t, r) > 0 && kn(n, r, e) > 0 != kn(n, r, t) > 0
    }

    function On(e, t) {
        return kn(e.prev, e, e.next) < 0 ? kn(e, t, e.next) >= 0 && kn(e, e.prev, t) >= 0 : kn(e, t, e.prev) < 0 || kn(e, e.next, t) < 0
    }

    function Mn(e, t) {
        var n = new Pn(e.i, e.x, e.y), r = new Pn(t.i, t.x, t.y), i = e.next, s = t.prev;
        return e.next = t, t.prev = e, n.next = i, i.prev = n, r.next = n, n.prev = r, s.next = r, r.prev = s, r
    }

    function _n(e, t, n, r) {
        var i = new Pn(e, t, n);
        return r ? (i.next = r.next, i.prev = r, r.next.prev = i, r.next = i) : (i.prev = i, i.next = i), i
    }

    function Dn(e) {
        e.next.prev = e.prev, e.prev.next = e.next, e.prevZ && (e.prevZ.nextZ = e.nextZ), e.nextZ && (e.nextZ.prevZ = e.prevZ)
    }

    function Pn(e, t, n) {
        this.i = e, this.x = t, this.y = n, this.prev = null, this.next = null, this.z = null, this.prevZ = null, this.nextZ = null, this.steiner = !1
    }

    function Hn(e, t, n, r) {
        for (var i = 0, s = t, o = n - r; s < n; s += r) i += (e[o] - e[s]) * (e[s + 1] + e[o + 1]), o = s;
        return i
    }

    function Bn(e) {
        var t = function (e) {
            for (var t = e[0][0].length, n = {
                vertices: [],
                holes: [],
                dimensions: t
            }, r = 0, i = 0; i < e.length; i++) {
                for (var s = 0; s < e[i].length; s++) for (var o = 0; o < t; o++) n.vertices.push(e[i][s][o]);
                i > 0 && (r += e[i - 1].length, n.holes.push(r))
            }
            return n
        }(e), n = Tu(t.vertices, t.holes, 2), r = [], i = [];
        n.forEach(function (e, r) {
            var s = n[r];
            i.push([t.vertices[2 * s], t.vertices[2 * s + 1]])
        });
        for (var o = 0; o < i.length; o += 3) {
            var u = i.slice(o, o + 3);
            u.push(i[o]), r.push(s([u]))
        }
        return r
    }

    function jn(e, t) {
        if (!e) throw new Error("targetPoint is required");
        if (!t) throw new Error("points is required");
        var n, r = 1 / 0;
        return M(t, function (t, i) {
            var s = jt(e, t);
            s < r && ((n = Ft(t)).properties.featureIndex = i, n.properties.distanceToPoint = s, r = s)
        }), n
    }

    function Fn(e, t, n, r, i) {
        In(e, t, n || 0, r || e.length - 1, i || function (e, t) {
            return e < t ? -1 : e > t ? 1 : 0
        })
    }

    function In(e, t, n, r, i) {
        for (; r > n;) {
            if (r - n > 600) {
                var s = r - n + 1, o = t - n + 1, u = Math.log(s), a = .5 * Math.exp(2 * u / 3),
                    f = .5 * Math.sqrt(u * a * (s - a) / s) * (o - s / 2 < 0 ? -1 : 1);
                In(e, t, Math.max(n, Math.floor(t - o * a / s + f)), Math.min(r, Math.floor(t + (s - o) * a / s + f)), i)
            }
            var l = e[t], c = n, h = r;
            for (qn(e, n, t), i(e[r], l) > 0 && qn(e, n, r); c < h;) {
                for (qn(e, c, h), c++, h--; i(e[c], l) < 0;) c++;
                for (; i(e[h], l) > 0;) h--
            }
            0 === i(e[n], l) ? qn(e, n, h) : qn(e, ++h, r), h <= t && (n = h + 1), t <= h && (r = h - 1)
        }
    }

    function qn(e, t, n) {
        var r = e[t];
        e[t] = e[n], e[n] = r
    }

    function Rn(e, t) {
        if (!(this instanceof Rn)) return new Rn(e, t);
        this._maxEntries = Math.max(4, e || 9), this._minEntries = Math.max(2, Math.ceil(.4 * this._maxEntries)), t && this._initFormat(t), this.clear()
    }

    function Un(e, t) {
        zn(e, 0, e.children.length, t, e)
    }

    function zn(e, t, n, r, i) {
        i || (i = Gn(null)), i.minX = 1 / 0, i.minY = 1 / 0, i.maxX = -1 / 0, i.maxY = -1 / 0;
        for (var s, o = t; o < n; o++) s = e.children[o], Wn(i, e.leaf ? r(s) : s);
        return i
    }

    function Wn(e, t) {
        return e.minX = Math.min(e.minX, t.minX), e.minY = Math.min(e.minY, t.minY), e.maxX = Math.max(e.maxX, t.maxX), e.maxY = Math.max(e.maxY, t.maxY), e
    }

    function Xn(e, t) {
        return e.minX - t.minX
    }

    function Vn(e, t) {
        return e.minY - t.minY
    }

    function $n(e) {
        return (e.maxX - e.minX) * (e.maxY - e.minY)
    }

    function Jn(e) {
        return e.maxX - e.minX + (e.maxY - e.minY)
    }

    function Kn(e, t) {
        return e.minX <= t.minX && e.minY <= t.minY && t.maxX <= e.maxX && t.maxY <= e.maxY
    }

    function Qn(e, t) {
        return t.minX <= e.maxX && t.minY <= e.maxY && t.maxX >= e.minX && t.maxY >= e.minY
    }

    function Gn(e) {
        return {children: e, height: 1, leaf: !0, minX: 1 / 0, minY: 1 / 0, maxX: -1 / 0, maxY: -1 / 0}
    }

    function Yn(e, t, n, r, i) {
        for (var s, o = [t, n]; o.length;) (n = o.pop()) - (t = o.pop()) <= r || (Fn(e, s = t + Math.ceil((n - t) / r / 2) * r, t, n, i), o.push(t, s, s, n))
    }

    function Zn(e) {
        var t = Rn(e);
        return t.insert = function (e) {
            if (Array.isArray(e)) {
                var t = e;
                (e = er(t)).bbox = t
            } else e.bbox = e.bbox ? e.bbox : tr(e);
            return Rn.prototype.insert.call(this, e)
        }, t.load = function (e) {
            var t = [];
            return Array.isArray(e) ? e.forEach(function (e) {
                var n = er(e);
                n.bbox = e, t.push(n)
            }) : M(e, function (e) {
                e.bbox = e.bbox ? e.bbox : tr(e), t.push(e)
            }), Rn.prototype.load.call(this, t)
        }, t.remove = function (e) {
            if (Array.isArray(e)) {
                var t = e;
                (e = er(t)).bbox = t
            }
            return Rn.prototype.remove.call(this, e)
        }, t.clear = function () {
            return Rn.prototype.clear.call(this)
        }, t.search = function (e) {
            return {type: "FeatureCollection", features: Rn.prototype.search.call(this, this.toBBox(e))}
        }, t.collides = function (e) {
            return Rn.prototype.collides.call(this, this.toBBox(e))
        }, t.all = function () {
            return {type: "FeatureCollection", features: Rn.prototype.all.call(this)}
        }, t.toJSON = function () {
            return Rn.prototype.toJSON.call(this)
        }, t.fromJSON = function (e) {
            return Rn.prototype.fromJSON.call(this, e)
        }, t.toBBox = function (e) {
            var t;
            return t = e.bbox ? e.bbox : Array.isArray(e) && 4 === e.length ? e : tr(e), {
                minX: t[0],
                minY: t[1],
                maxX: t[2],
                maxY: t[3]
            }
        }, t
    }

    function er(e) {
        var t = [e[0], e[1]], n = [e[0], e[3]], r = [e[2], e[3]];
        return {
            type: "Feature",
            bbox: e,
            properties: {},
            geometry: {type: "Polygon", coordinates: [[t, [e[2], e[1]], r, n, t]]}
        }
    }

    function tr(e) {
        var t = [1 / 0, 1 / 0, -1 / 0, -1 / 0];
        return k(e, function (e) {
            t[0] > e[0] && (t[0] = e[0]), t[1] > e[1] && (t[1] = e[1]), t[2] < e[0] && (t[2] = e[0]), t[3] < e[1] && (t[3] = e[1])
        }), t
    }

    function nr(e) {
        if (!e) throw new Error("geojson is required");
        var t = [];
        return B(e, function (e) {
            !function (e, t) {
                var n = [], r = e.geometry;
                switch (r.type) {
                    case"Polygon":
                        n = W(r);
                        break;
                    case"LineString":
                        n = [W(r)]
                }
                n.forEach(function (n) {
                    var r = function (e, t) {
                        var n = [];
                        return e.reduce(function (e, r) {
                            var i = u([e, r], t);
                            return i.bbox = function (e, t) {
                                var n = e[0], r = e[1], i = t[0], s = t[1];
                                return [n < i ? n : i, r < s ? r : s, n > i ? n : i, r > s ? r : s]
                            }(e, r), n.push(i), r
                        }), n
                    }(n, e.properties);
                    r.forEach(function (e) {
                        e.id = t.length, t.push(e)
                    })
                })
            }(e, t)
        }), f(t)
    }

    function rr(e, n) {
        var r = {}, i = [];
        if ("LineString" === e.type && (e = t(e)), "LineString" === n.type && (n = t(n)), "Feature" === e.type && "Feature" === n.type && "LineString" === e.geometry.type && "LineString" === n.geometry.type && 2 === e.geometry.coordinates.length && 2 === n.geometry.coordinates.length) {
            var s = ir(e, n);
            return s && i.push(s), f(i)
        }
        var o = Zn();
        return o.load(nr(n)), M(nr(e), function (e) {
            M(o.search(e), function (t) {
                var n = ir(e, t);
                if (n) {
                    var s = W(n).join(",");
                    r[s] || (r[s] = !0, i.push(n))
                }
            })
        }), f(i)
    }

    function ir(e, t) {
        var n = W(e), i = W(t);
        if (2 !== n.length) throw new Error("<intersects> line1 must only contain 2 coordinates");
        if (2 !== i.length) throw new Error("<intersects> line2 must only contain 2 coordinates");
        var s = n[0][0], o = n[0][1], u = n[1][0], a = n[1][1], f = i[0][0], l = i[0][1], c = i[1][0], h = i[1][1],
            p = (h - l) * (u - s) - (c - f) * (a - o), d = (c - f) * (o - l) - (h - l) * (s - f),
            v = (u - s) * (o - l) - (a - o) * (s - f);
        if (0 === p) return null;
        var m = d / p, g = v / p;
        return m >= 0 && m <= 1 && g >= 0 && g <= 1 ? r([s + m * (u - s), o + m * (a - o)]) : null
    }

    function sr(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var i = e.geometry ? e.geometry.type : e.type;
        if ("LineString" !== i && "MultiLineString" !== i) throw new Error("lines must be LineString or MultiLineString");
        var s = r([1 / 0, 1 / 0], {dist: 1 / 0}), o = 0;
        return B(e, function (e) {
            for (var i = W(e), a = 0; a < i.length - 1; a++) {
                var f = r(i[a]);
                f.properties.dist = jt(t, f, n);
                var l = r(i[a + 1]);
                l.properties.dist = jt(t, l, n);
                var c = jt(f, l, n), h = Math.max(f.properties.dist, l.properties.dist), p = vn(f, l),
                    d = pn(t, h, p + 90, n), v = pn(t, h, p - 90, n),
                    m = rr(u([d.geometry.coordinates, v.geometry.coordinates]), u([f.geometry.coordinates, l.geometry.coordinates])),
                    g = null;
                m.features.length > 0 && ((g = m.features[0]).properties.dist = jt(t, g, n), g.properties.location = o + jt(f, g, n)), f.properties.dist < s.properties.dist && ((s = f).properties.index = a, s.properties.location = o), l.properties.dist < s.properties.dist && ((s = l).properties.index = a + 1, s.properties.location = o + c), g && g.properties.dist < s.properties.dist && ((s = g).properties.index = a), o += c
            }
        }), s
    }

    function or(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.final;
        if (!e) throw new Error("start point is required");
        if (!t) throw new Error("end point is required");
        var i;
        return (i = r ? ur(z(t), z(e)) : ur(z(e), z(t))) > 180 ? -(360 - i) : i
    }

    function ur(e, t) {
        var n = w(e[1]), r = w(t[1]), i = w(t[0] - e[0]);
        i > Math.PI && (i -= 2 * Math.PI), i < -Math.PI && (i += 2 * Math.PI);
        var s = Math.log(Math.tan(r / 2 + Math.PI / 4) / Math.tan(n / 2 + Math.PI / 4));
        return (b(Math.atan2(i, s)) + 360) % 360
    }

    function ar(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.units;
        if (!e) throw new Error("from point is required");
        if (!t) throw new Error("to point is required");
        var i = z(e), s = z(t);
        return s[0] += s[0] - i[0] > 180 ? -360 : i[0] - s[0] > 180 ? 360 : 0, E(function (e, t, n) {
            var r = n = void 0 === n ? Bo : Number(n), i = e[1] * Math.PI / 180, s = t[1] * Math.PI / 180, o = s - i,
                u = Math.abs(t[0] - e[0]) * Math.PI / 180;
            u > Math.PI && (u -= 2 * Math.PI);
            var a = Math.log(Math.tan(s / 2 + Math.PI / 4) / Math.tan(i / 2 + Math.PI / 4)),
                f = Math.abs(a) > 1e-11 ? o / a : Math.cos(i);
            return Math.sqrt(o * o + f * f * u * u) * r
        }(i, s), "meters", r)
    }

    function fr(e, t) {
        return cr(e, "mercator", t)
    }

    function lr(e, t) {
        return cr(e, "wgs84", t)
    }

    function cr(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.mutate;
        if (!e) throw new Error("geojson is required");
        return Array.isArray(e) && x(e[0]) ? e = "mercator" === t ? hr(e) : pr(e) : (!0 !== r && (e = Ft(e)), k(e, function (e) {
            var n = "mercator" === t ? hr(e) : pr(e);
            e[0] = n[0], e[1] = n[1]
        })), e
    }

    function hr(e) {
        var t = Math.PI / 180, n = 20037508.342789244,
            r = [6378137 * (Math.abs(e[0]) <= 180 ? e[0] : e[0] - 360 * function (e) {
                return e < 0 ? -1 : e > 0 ? 1 : 0
            }(e[0])) * t, 6378137 * Math.log(Math.tan(.25 * Math.PI + .5 * e[1] * t))];
        return r[0] > n && (r[0] = n), r[0] < -n && (r[0] = -n), r[1] > n && (r[1] = n), r[1] < -n && (r[1] = -n), r
    }

    function pr(e) {
        var t = 180 / Math.PI;
        return [e[0] * t / 6378137, (.5 * Math.PI - 2 * Math.atan(Math.exp(-e[1] / 6378137))) * t]
    }

    function dr(e, n, i) {
        if (i = i || {}, !T(i)) throw new Error("options is invalid");
        if (!e) throw new Error("pt is required");
        if (Array.isArray(e) ? e = r(e) : "Point" === e.type ? e = t(e) : $(e, "Point", "point"), !n) throw new Error("line is required");
        Array.isArray(n) ? n = u(n) : "LineString" === n.type ? n = t(n) : $(n, "LineString", "line");
        var s = 1 / 0, o = e.geometry.coordinates;
        return F(n, function (e) {
            var t = e.geometry.coordinates[0], n = e.geometry.coordinates[1], u = function (e, t, n, i) {
                var s = i.mercator, o = !0 !== s ? jt(t, e, i) : vr(t, e, i), u = y(!0 !== s ? vn(t, e) : or(t, e)),
                    a = y(!0 !== s ? vn(t, n) : or(t, n)), f = Math.abs(u - a);
                if (f > 90) return o;
                var l = (a + 180) % 360, c = y(!0 !== s ? vn(n, e) : or(n, e)), h = Math.abs(c - l);
                return h > 180 && (h = Math.abs(h - 360)), h > 90 ? !0 !== s ? jt(e, n, i) : vr(e, n, i) : !0 !== s ? o * Math.sin(w(f)) : function (e, t, n, i) {
                    var s = 0;
                    (Math.abs(e[0]) >= 180 || Math.abs(t[0]) >= 180 || Math.abs(n[0]) >= 180) && (s = e[0] > 0 || t[0] > 0 || n[0] > 0 ? -180 : 180);
                    var o = r(n), u = fr([e[0] + s, e[1]]), a = fr([t[0] + s, t[1]]), f = fr([n[0] + s, n[1]]),
                        l = lr(function (e, t, n) {
                            var r = e[0], i = e[1], s = t[0], o = t[1], u = n[0], a = n[1], f = s - r, l = o - i,
                                c = ((u - r) * f + (a - i) * l) / (f * f + l * l);
                            return [r + c * f, i + c * l]
                        }(u, a, f));
                    return 0 !== s && (l[0] -= s), ar(o, l, i)
                }(t, n, e, i)
            }(o, t, n, i);
            s > u && (s = u)
        }), s
    }

    function vr(e, t, n) {
        var r = n.units, i = 0;
        Math.abs(e[0]) >= 180 && (i = e[0] > 0 ? -180 : 180), Math.abs(t[0]) >= 180 && (i = t[0] > 0 ? -180 : 180);
        var s = fr([e[0] + i, e[1]]), o = fr([t[0] + i, t[1]]), u = function (e) {
            return e * e
        }, a = u(s[0] - o[0]) + u(s[1] - o[1]);
        return E(Math.sqrt(a), "meters", r)
    }

    function mr(e) {
        for (var n = function (e) {
            return "FeatureCollection" !== e.type ? "Feature" !== e.type ? f([t(e)]) : f([e]) : e
        }(e), i = mn(n), s = !1, o = 0; !s && o < n.features.length;) {
            var u, a = n.features[o].geometry, l = !1;
            if ("Point" === a.type) i.geometry.coordinates[0] === a.coordinates[0] && i.geometry.coordinates[1] === a.coordinates[1] && (s = !0); else if ("MultiPoint" === a.type) {
                var c = !1;
                for (u = 0; !c && u < a.coordinates.length;) i.geometry.coordinates[0] === a.coordinates[u][0] && i.geometry.coordinates[1] === a.coordinates[u][1] && (s = !0, c = !0), u++
            } else if ("LineString" === a.type) for (u = 0; !l && u < a.coordinates.length - 1;) gr(i.geometry.coordinates[0], i.geometry.coordinates[1], a.coordinates[u][0], a.coordinates[u][1], a.coordinates[u + 1][0], a.coordinates[u + 1][1]) && (l = !0, s = !0), u++; else if ("MultiLineString" === a.type) for (var h = 0; h < a.coordinates.length;) {
                l = !1, u = 0;
                for (var p = a.coordinates[h]; !l && u < p.length - 1;) gr(i.geometry.coordinates[0], i.geometry.coordinates[1], p[u][0], p[u][1], p[u + 1][0], p[u + 1][1]) && (l = !0, s = !0), u++;
                h++
            } else "Polygon" !== a.type && "MultiPolygon" !== a.type || Ot(i, a) && (s = !0);
            o++
        }
        if (s) return i;
        var d = f([]);
        for (o = 0; o < n.features.length; o++) d.features = d.features.concat(bn(n.features[o]).features);
        return r(jn(i, d).geometry.coordinates)
    }

    function gr(e, t, n, r, i, s) {
        return Math.sqrt((i - n) * (i - n) + (s - r) * (s - r)) === Math.sqrt((e - n) * (e - n) + (t - r) * (t - r)) + Math.sqrt((i - e) * (i - e) + (s - t) * (s - t))
    }

    function yr(e) {
        return H(e, function (e, t) {
            return e + br(t)
        }, 0)
    }

    function br(e) {
        var t, n = 0;
        switch (e.type) {
            case"Polygon":
                return wr(e.coordinates);
            case"MultiPolygon":
                for (t = 0; t < e.coordinates.length; t++) n += wr(e.coordinates[t]);
                return n;
            case"Point":
            case"MultiPoint":
            case"LineString":
            case"MultiLineString":
                return 0;
            case"GeometryCollection":
                for (t = 0; t < e.geometries.length; t++) n += br(e.geometries[t]);
                return n
        }
    }

    function wr(e) {
        var t = 0;
        if (e && e.length > 0) {
            t += Math.abs(Er(e[0]));
            for (var n = 1; n < e.length; n++) t -= Math.abs(Er(e[n]))
        }
        return t
    }

    function Er(e) {
        var t, n, r, i, s, o, u = 0, a = e.length;
        if (a > 2) {
            for (o = 0; o < a; o++) o === a - 2 ? (r = a - 2, i = a - 1, s = 0) : o === a - 1 ? (r = a - 1, i = 0, s = 1) : (r = o, i = o + 1, s = o + 2), t = e[r], n = e[i], u += (Sr(e[s][0]) - Sr(t[0])) * Math.sin(Sr(n[1]));
            u = u * ku * ku / 2
        }
        return u
    }

    function Sr(e) {
        return e * Math.PI / 180
    }

    function xr(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        if (!e) throw new Error("geojson is required");
        return I(e, function (e, n) {
            var r = n.geometry.coordinates;
            return e + jt(r[0], r[1], t)
        }, 0)
    }

    function Tr(e, t, n, r) {
        if (r = r || {}, !T(r)) throw new Error("options is invalid");
        var i, s = [];
        if ("Feature" === e.type) i = e.geometry.coordinates; else {
            if ("LineString" !== e.type) throw new Error("input must be a LineString Feature or Geometry");
            i = e.coordinates
        }
        for (var o, a, f, l = 0, c = 0; c < i.length && !(t >= l && c === i.length - 1); c++) {
            if (l > t && 0 === s.length) {
                if (!(o = t - l)) return s.push(i[c]), u(s);
                a = vn(i[c], i[c - 1]) - 180, f = pn(i[c], o, a, r), s.push(f.geometry.coordinates)
            }
            if (l >= n) return (o = n - l) ? (a = vn(i[c], i[c - 1]) - 180, f = pn(i[c], o, a, r), s.push(f.geometry.coordinates), u(s)) : (s.push(i[c]), u(s));
            if (l >= t && s.push(i[c]), c === i.length - 1) return u(s);
            l += jt(i[c], i[c + 1], r)
        }
        return u(i[i.length - 1])
    }

    function Nr(e, t, n) {
        var r = (n = n || {}).ignoreEndVertices;
        if (!T(n)) throw new Error("invalid options");
        if (!e) throw new Error("pt is required");
        if (!t) throw new Error("line is required");
        for (var i = z(e), s = W(t), o = 0; o < s.length - 1; o++) {
            var u = !1;
            if (r && (0 === o && (u = "start"), o === s.length - 2 && (u = "end"), 0 === o && o + 1 === s.length - 1 && (u = "both")), function (e, t, n, r) {
                var i = n[0], s = n[1], o = e[0], u = e[1], a = t[0], f = t[1], l = n[0] - o, c = n[1] - u, h = a - o,
                    p = f - u;
                if (l * p - c * h != 0) return !1;
                if (!r) return Math.abs(h) >= Math.abs(p) ? h > 0 ? o <= i && i <= a : a <= i && i <= o : p > 0 ? u <= s && s <= f : f <= s && s <= u;
                if ("start" === r) return Math.abs(h) >= Math.abs(p) ? h > 0 ? o < i && i <= a : a <= i && i < o : p > 0 ? u < s && s <= f : f <= s && s < u;
                if ("end" === r) return Math.abs(h) >= Math.abs(p) ? h > 0 ? o <= i && i < a : a < i && i <= o : p > 0 ? u <= s && s < f : f < s && s <= u;
                if ("both" === r) return Math.abs(h) >= Math.abs(p) ? h > 0 ? o < i && i < a : a < i && i < o : p > 0 ? u < s && s < f : f < s && s < u
            }(s[o], s[o + 1], i, u)) return !0
        }
        return !1
    }

    function Cr(e, t) {
        var n = G(e), r = G(t), i = K(e), s = K(t);
        switch (n) {
            case"Point":
                switch (r) {
                    case"MultiPoint":
                        return function (e, t) {
                            var n, r = !1;
                            for (n = 0; n < t.coordinates.length; n++) if (Lr(t.coordinates[n], e.coordinates)) {
                                r = !0;
                                break
                            }
                            return r
                        }(i, s);
                    case"LineString":
                        return Nr(i, s, {ignoreEndVertices: !0});
                    case"Polygon":
                        return Ot(i, s, {ignoreBoundary: !0});
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"MultiPoint":
                switch (r) {
                    case"MultiPoint":
                        return function (e, t) {
                            for (var n = 0; n < e.coordinates.length; n++) {
                                for (var r = !1, i = 0; i < t.coordinates.length; i++) Lr(e.coordinates[n], t.coordinates[i]) && (r = !0);
                                if (!r) return !1
                            }
                            return !0
                        }(i, s);
                    case"LineString":
                        return function (e, t) {
                            for (var n = !1, r = 0; r < e.coordinates.length; r++) {
                                if (!Nr(e.coordinates[r], t)) return !1;
                                n || (n = Nr(e.coordinates[r], t, {ignoreEndVertices: !0}))
                            }
                            return n
                        }(i, s);
                    case"Polygon":
                        return function (e, t) {
                            for (var n = !0, r = 0; r < e.coordinates.length; r++) {
                                var i = Ot(e.coordinates[1], t);
                                if (!i) {
                                    n = !1;
                                    break
                                }
                                i = Ot(e.coordinates[1], t, {ignoreBoundary: !0})
                            }
                            return n && i
                        }(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"LineString":
                switch (r) {
                    case"LineString":
                        return function (e, t) {
                            for (var n = 0; n < e.coordinates.length; n++) if (!Nr(e.coordinates[n], t)) return !1;
                            return !0
                        }(i, s);
                    case"Polygon":
                        return function (e, t) {
                            var n = U(t), r = U(e);
                            if (!kr(n, r)) return !1;
                            for (var i = !1, s = 0; s < e.coordinates.length - 1; s++) {
                                if (!Ot(e.coordinates[s], t)) return !1;
                                if (i || (i = Ot(e.coordinates[s], t, {ignoreBoundary: !0})), !i) {
                                    var o = function (e, t) {
                                        return [(e[0] + t[0]) / 2, (e[1] + t[1]) / 2]
                                    }(e.coordinates[s], e.coordinates[s + 1]);
                                    i = Ot(o, t, {ignoreBoundary: !0})
                                }
                            }
                            return i
                        }(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"Polygon":
                switch (r) {
                    case"Polygon":
                        return function (e, t) {
                            var n = U(e);
                            if (!kr(U(t), n)) return !1;
                            for (var r = 0; r < e.coordinates[0].length; r++) if (!Ot(e.coordinates[0][r], t)) return !1;
                            return !0
                        }(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            default:
                throw new Error("feature1 " + n + " geometry not supported")
        }
    }

    function kr(e, t) {
        return !(e[0] > t[0]) && !(e[2] < t[2]) && !(e[1] > t[1]) && !(e[3] < t[3])
    }

    function Lr(e, t) {
        return e[0] === t[0] && e[1] === t[1]
    }

    function Ar(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var i = n.mask, s = n.properties, o = [];
        if (null === t || void 0 === t) throw new Error("cellSide is required");
        if (!x(t)) throw new Error("cellSide is invalid");
        if (!e) throw new Error("bbox is required");
        if (!Array.isArray(e)) throw new Error("bbox must be array");
        if (4 !== e.length) throw new Error("bbox must contain 4 numbers");
        if (i && -1 === ["Polygon", "MultiPolygon"].indexOf(G(i))) throw new Error("options.mask must be a (Multi)Polygon");
        for (var u = e[0], a = e[1], l = e[2], c = e[3], h = t / jt([u, a], [l, a], n) * (l - u), p = t / jt([u, a], [u, c], n) * (c - a), d = l - u, v = c - a, m = Math.floor(d / h), g = (v - Math.floor(v / p) * p) / 2, y = u + (d - m * h) / 2; y <= l;) {
            for (var b = a + g; b <= c;) {
                var w = r([y, b], s);
                i ? Cr(w, i) && o.push(w) : o.push(w), b += p
            }
            y += h
        }
        return f(o)
    }

    function Or(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.precision, r = t.coordinates, i = t.mutate;
        if (n = void 0 === n || null === n || isNaN(n) ? 6 : n, r = void 0 === r || null === r || isNaN(r) ? 3 : r, !e) throw new Error("<geojson> is required");
        if ("number" != typeof n) throw new Error("<precision> must be a number");
        if ("number" != typeof r) throw new Error("<coordinates> must be a number");
        !1 !== i && void 0 !== i || (e = JSON.parse(JSON.stringify(e)));
        var s = Math.pow(10, n);
        return k(e, function (e) {
            !function (e, t, n) {
                e.length > n && e.splice(n, e.length);
                for (var r = 0; r < e.length; r++) e[r] = Math.round(e[r] * t) / t
            }(e, s, r)
        }), e
    }

    function Mr(e, t) {
        if (!e || !t) return !1;
        if (e.length !== t.length) return !1;
        for (var n = 0, r = e.length; n < r; n++) if (e[n] instanceof Array && t[n] instanceof Array) {
            if (!Mr(e[n], t[n])) return !1
        } else if (e[n] !== t[n]) return !1;
        return !0
    }

    function _r(e, t) {
        if (void 0 === t && (t = !0), 3 != e.length) throw new Error("This function requires an array of three points [x,y]");
        return (e[1][0] - e[0][0]) * (e[2][1] - e[0][1]) - (e[1][1] - e[0][1]) * (e[2][0] - e[0][0]) >= 0 == t
    }

    function Dr(e, t) {
        if (!e || !t) return !1;
        if (e.length != t.length) return !1;
        for (var n = 0, r = e.length; n < r; n++) if (e[n] instanceof Array && t[n] instanceof Array) {
            if (!Dr(e[n], t[n])) return !1
        } else if (e[n] != t[n]) return !1;
        return !0
    }

    function Pr(e, t) {
        var n = [], r = Zn();
        return B(t, function (t) {
            if (n.forEach(function (e, t) {
                e.id = t
            }), n.length) {
                var i = r.search(t);
                if (i.features.length) {
                    var s = Br(t, i);
                    n = n.filter(function (e) {
                        return e.id !== s.id
                    }), r.remove(s), M(Hr(s, t), function (e) {
                        n.push(e), r.insert(e)
                    })
                }
            } else (n = Hr(e, t).features).forEach(function (e) {
                e.bbox || (e.bbox = hn(U(e)))
            }), r.load(f(n))
        }), f(n)
    }

    function Hr(e, t) {
        var n = [], r = W(e)[0], i = W(e)[e.geometry.coordinates.length - 1];
        if (jr(r, z(t)) || jr(i, z(t))) return f([e]);
        var s = Zn(), o = nr(e);
        s.load(o);
        var a = s.search(t);
        if (!a.features.length) return f([e]);
        var l = Br(t, a), c = _(o, function (e, r, i) {
            var s = W(r)[1], o = z(t);
            return i === l.id ? (e.push(o), n.push(u(e)), jr(o, s) ? [o] : [o, s]) : (e.push(s), e)
        }, [r]);
        return c.length > 1 && n.push(u(c)), f(n)
    }

    function Br(e, t) {
        if (!t.features.length) throw new Error("lines must contain features");
        if (1 === t.features.length) return t.features[0];
        var n, r = 1 / 0;
        return M(t, function (t) {
            var i = sr(t, e).properties.dist;
            i < r && (n = t, r = i)
        }), n
    }

    function jr(e, t) {
        return e[0] === t[0] && e[1] === t[1]
    }

    function Fr(e, t, n, r, i) {
        if (i = i || {}, !T(i)) throw new Error("options is invalid");
        var s = i.steps, o = i.units;
        if (!e) throw new Error("center is required");
        if (!t) throw new Error("radius is required");
        if (void 0 === n || null === n) throw new Error("bearing1 is required");
        if (void 0 === r || null === r) throw new Error("bearing2 is required");
        if ("object" != typeof i) throw new Error("options must be an object");
        s = s || 64;
        var a = Ir(n), f = Ir(r), l = e.properties;
        if (a === f) return u(dn(e, t, i).geometry.coordinates[0], l);
        for (var c = a, h = a < f ? f : f + 360, p = c, d = [], v = 0; p < h;) d.push(pn(e, t, p, o).geometry.coordinates), p = c + 360 * ++v / s;
        return p > h && d.push(pn(e, t, h, o).geometry.coordinates), u(d, l)
    }

    function Ir(e) {
        var t = e % 360;
        return t < 0 && (t += 360), t
    }

    function qr(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.properties, r = G(e), i = W(e);
        if (n = n || e.properties || {}, !i.length) throw new Error("polygon must contain coordinates");
        switch (r) {
            case"Polygon":
                return Rr(i, n);
            case"MultiPolygon":
                var s = [];
                return i.forEach(function (e) {
                    s.push(Rr(e, n))
                }), f(s);
            default:
                throw new Error("geom " + r + " not supported")
        }
    }

    function Rr(e, t) {
        return e.length > 1 ? l(e, t) : u(e[0], t)
    }

    function Ur(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.properties, r = t.autoComplete, i = t.orderCoords;
        if (!e) throw new Error("lines is required");
        r = void 0 === r || r, i = void 0 === i || i;
        switch (G(e)) {
            case"FeatureCollection":
            case"GeometryCollection":
                var s = [];
                return (e.features ? e.features : e.geometries).forEach(function (e) {
                    s.push(W(zr(e, {}, r, i)))
                }), h(s, n)
        }
        return zr(e, n, r, i)
    }

    function zr(e, t, n, r) {
        t = t || e.properties || {};
        var i = W(e), o = G(e);
        if (!i.length) throw new Error("line must contain coordinates");
        switch (o) {
            case"LineString":
                return n && (i = Wr(i)), s([i], t);
            case"MultiLineString":
                var a = [], f = 0;
                return i.forEach(function (e) {
                    if (n && (e = Wr(e)), r) {
                        var t = function (e) {
                            var t = e[0], n = e[1], r = e[2], i = e[3];
                            return Math.abs(t - r) * Math.abs(n - i)
                        }(U(u(e)));
                        t > f ? (a.unshift(e), f = t) : a.push(e)
                    } else a.push(e)
                }), s(a, t);
            default:
                throw new Error("geometry type " + o + " is not supported")
        }
    }

    function Wr(e) {
        var t = e[0], n = t[0], r = t[1], i = e[e.length - 1], s = i[0], o = i[1];
        return n === s && r === o || e.push(t), e
    }

    function Xr(e, t, n) {
        var r, i, s, o, u, a = e.length, f = $r(e[0], t), l = [];
        for (n || (n = []), r = 1; r < a; r++) {
            for (i = e[r - 1], o = u = $r(s = e[r], t); ;) {
                if (!(f | o)) {
                    l.push(i), o !== u ? (l.push(s), r < a - 1 && (n.push(l), l = [])) : r === a - 1 && l.push(s);
                    break
                }
                if (f & o) break;
                f ? f = $r(i = Vr(i, s, f, t), t) : o = $r(s = Vr(i, s, o, t), t)
            }
            f = u
        }
        return l.length && n.push(l), n
    }

    function Vr(e, t, n, r) {
        return 8 & n ? [e[0] + (t[0] - e[0]) * (r[3] - e[1]) / (t[1] - e[1]), r[3]] : 4 & n ? [e[0] + (t[0] - e[0]) * (r[1] - e[1]) / (t[1] - e[1]), r[1]] : 2 & n ? [r[2], e[1] + (t[1] - e[1]) * (r[2] - e[0]) / (t[0] - e[0])] : 1 & n ? [r[0], e[1] + (t[1] - e[1]) * (r[0] - e[0]) / (t[0] - e[0])] : null
    }

    function $r(e, t) {
        var n = 0;
        return e[0] < t[0] ? n |= 1 : e[0] > t[2] && (n |= 2), e[1] < t[1] ? n |= 4 : e[1] > t[3] && (n |= 8), n
    }

    function Jr(e, t) {
        for (var n = [], r = 0; r < e.length; r++) {
            var i = Fu.polygon(e[r], t);
            i.length > 0 && (i[0][0] === i[i.length - 1][0] && i[0][1] === i[i.length - 1][1] || i.push(i[0]), i.length >= 4 && n.push(i))
        }
        return n
    }

    function Kr(e) {
        return "[object Arguments]" === Object.prototype.toString.call(e)
    }

    function Qr(e, t, n) {
        return n || (n = {}), e === t || (e instanceof Date && t instanceof Date ? e.getTime() === t.getTime() : !e || !t || "object" != typeof e && "object" != typeof t ? (n.strict, e === t) : function (e, t, n) {
            var r, i;
            if (Gr(e) || Gr(t)) return !1;
            if (e.prototype !== t.prototype) return !1;
            if (Kr(e)) return !!Kr(t) && (e = Iu.call(e), t = Iu.call(t), Qr(e, t, n));
            if (Yr(e)) {
                if (!Yr(t)) return !1;
                if (e.length !== t.length) return !1;
                for (r = 0; r < e.length; r++) if (e[r] !== t[r]) return !1;
                return !0
            }
            try {
                var s = Object.keys(e), o = Object.keys(t)
            } catch (e) {
                return !1
            }
            if (s.length !== o.length) return !1;
            for (s.sort(), o.sort(), r = s.length - 1; r >= 0; r--) if (s[r] !== o[r]) return !1;
            for (r = s.length - 1; r >= 0; r--) if (i = s[r], !Qr(e[i], t[i], n)) return !1;
            return typeof e == typeof t
        }(e, t, n))
    }

    function Gr(e) {
        return null === e || void 0 === e
    }

    function Yr(e) {
        return !!e && "object" == typeof e && "number" == typeof e.length && "function" == typeof e.copy && "function" == typeof e.slice && !(e.length > 0 && "number" != typeof e[0])
    }

    function Zr(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.tolerance || 0, i = [], s = Zn();
        s.load(nr(e));
        var o;
        return F(t, function (e) {
            var t = !1;
            M(s.search(e), function (n) {
                if (!1 === t) {
                    var i = W(e).sort(), s = W(n).sort();
                    Qr(i, s) ? (t = !0, o = o ? ei(o, e) : e) : (0 === r ? Nr(i[0], n) && Nr(i[1], n) : sr(n, i[0]).properties.dist <= r && sr(n, i[1]).properties.dist <= r) ? (t = !0, o = o ? ei(o, e) : e) : (0 === r ? Nr(s[0], e) && Nr(s[1], e) : sr(e, s[0]).properties.dist <= r && sr(e, s[1]).properties.dist <= r) && (o = o ? ei(o, n) : n)
                }
            }), !1 === t && o && (i.push(o), o = void 0)
        }), o && i.push(o), f(i)
    }

    function ei(e, t) {
        var n = W(t), r = W(e), i = r[0], s = r[r.length - 1], o = e.geometry.coordinates;
        return Qr(n[0], i) ? o.unshift(n[1]) : Qr(n[0], s) ? o.push(n[1]) : Qr(n[1], i) ? o.unshift(n[0]) : Qr(n[1], s) && o.push(n[0]), e
    }

    function ti(e) {
        var t = e % 360;
        return t < 0 && (t += 360), t
    }

    function ni(e, t, n, i) {
        if (i = i || {}, !T(i)) throw new Error("options is invalid");
        var s = i.units, o = i.properties;
        if (!e) throw new Error("origin is required");
        if (void 0 === t || null === t) throw new Error("distance is required");
        if (void 0 === n || null === n) throw new Error("bearing is required");
        if (t >= 0) {
            var u = E(t, s, "meters"), a = z(e), f = function (e, t, n, r) {
                r = void 0 === r ? Bo : Number(r);
                var i = t / r, s = e[0] * Math.PI / 180, o = w(e[1]), u = w(n), a = i * Math.cos(u), f = o + a;
                Math.abs(f) > Math.PI / 2 && (f = f > 0 ? Math.PI - f : -Math.PI - f);
                var l = Math.log(Math.tan(f / 2 + Math.PI / 4) / Math.tan(o / 2 + Math.PI / 4)),
                    c = Math.abs(l) > 1e-11 ? a / l : Math.cos(o), h = i * Math.sin(u) / c;
                return [(180 * (s + h) / Math.PI + 540) % 360 - 180, 180 * f / Math.PI]
            }(a, u, n);
            return f[0] += f[0] - a[0] > 180 ? -360 : a[0] - f[0] > 180 ? 360 : 0, r(f, o)
        }
        throw new Error("distance must be greater than 0")
    }

    function ri(e, t, n, r, i, s) {
        for (var o = 0; o < e.length; o++) {
            var u = e[o], a = e[o + 1];
            o === e.length - 1 && (a = e[0]), r = ii(u, a, t), n <= 0 && r > 0 ? function (e, t, n) {
                return ii(e, t, n) < 0
            }(t, u, i) || (i = u) : n > 0 && r <= 0 && (function (e, t, n) {
                return ii(e, t, n) > 0
            }(t, u, s) || (s = u)), n = r
        }
        return [i, s]
    }

    function ii(e, t, n) {
        return (t[0] - e[0]) * (n[1] - e[1]) - (n[0] - e[0]) * (t[1] - e[1])
    }

    function si(e) {
        if (!e) throw new Error("line is required");
        var t = e.geometry ? e.geometry.type : e.type;
        if (!Array.isArray(e) && "LineString" !== t) throw new Error("geometry must be a LineString");
        for (var n, r, i = W(e), s = 0, o = 1; o < i.length;) n = r || i[0], s += ((r = i[o])[0] - n[0]) * (r[1] + n[1]), o++;
        return s > 0
    }

    function oi(e, t) {
        switch ("Feature" === e.type ? e.geometry.type : e.type) {
            case"GeometryCollection":
                return P(e, function (e) {
                    oi(e, t)
                }), e;
            case"LineString":
                return ui(W(e), t), e;
            case"Polygon":
                return ai(W(e), t), e;
            case"MultiLineString":
                return W(e).forEach(function (e) {
                    ui(e, t)
                }), e;
            case"MultiPolygon":
                return W(e).forEach(function (e) {
                    ai(e, t)
                }), e;
            case"Point":
            case"MultiPoint":
                return e
        }
    }

    function ui(e, t) {
        si(e) === t && e.reverse()
    }

    function ai(e, t) {
        si(e[0]) !== t && e[0].reverse();
        for (var n = 1; n < e.length; n++) si(e[n]) === t && e[n].reverse()
    }

    function fi(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.zProperty || "elevation", r = t.flip, i = t.flags;
        J(e, "Point", "input must contain Points");
        for (var s = function (e, t) {
            var n = {};
            return M(e, function (e) {
                var t = W(e)[1];
                n[t] || (n[t] = []), n[t].push(e)
            }), Object.keys(n).map(function (e) {
                var t = n[e], r = t.sort(function (e, t) {
                    return W(e)[0] - W(t)[0]
                });
                return r
            }).sort(function (e, n) {
                return t ? W(e[0])[1] - W(n[0])[1] : W(n[0])[1] - W(e[0])[1]
            })
        }(e, r), o = [], u = 0; u < s.length; u++) {
            for (var a = s[u], f = [], l = 0; l < a.length; l++) {
                var c = a[l];
                c.properties[n] ? f.push(c.properties[n]) : f.push(0), !0 === i && (c.properties.matrixPosition = [u, l])
            }
            o.push(f)
        }
        return o
    }

    function li(e, t, n, r) {
        r = r || {};
        for (var i = Object.keys(qu), s = 0; s < i.length; s++) {
            var o = i[s], u = r[o];
            u = void 0 !== u && null !== u ? u : qu[o], Ru[o] = u
        }
        Ru.verbose && console.log("MarchingSquaresJS-isoBands: computing isobands for [" + t + ":" + (t + n) + "]");
        var a, f = function (e, t, n) {
            for (var r = e.length - 1, i = e[0].length - 1, s = {
                rows: r,
                cols: i,
                cells: []
            }, o = t + Math.abs(n), u = 0; u < r; ++u) {
                s.cells[u] = [];
                for (var a = 0; a < i; ++a) {
                    var f = 0, l = e[u + 1][a], c = e[u + 1][a + 1], h = e[u][a + 1], p = e[u][a];
                    if (!(isNaN(l) || isNaN(c) || isNaN(h) || isNaN(p))) {
                        f |= l < t ? 0 : l > o ? 128 : 64, f |= c < t ? 0 : c > o ? 32 : 16, f |= h < t ? 0 : h > o ? 8 : 4;
                        var d = +(f |= p < t ? 0 : p > o ? 2 : 1), v = 0;
                        if (17 === f || 18 === f || 33 === f || 34 === f || 38 === f || 68 === f || 72 === f || 98 === f || 102 === f || 132 === f || 136 === f || 137 === f || 152 === f || 153 === f) {
                            var m = (l + c + h + p) / 4;
                            v = m > o ? 2 : m < t ? 0 : 1, 34 === f ? 1 === v ? f = 35 : 0 === v && (f = 136) : 136 === f ? 1 === v ? (f = 35, v = 4) : 0 === v && (f = 34) : 17 === f ? 1 === v ? (f = 155, v = 4) : 0 === v && (f = 153) : 68 === f ? 1 === v ? (f = 103, v = 4) : 0 === v && (f = 102) : 153 === f ? 1 === v && (f = 155) : 102 === f ? 1 === v && (f = 103) : 152 === f ? v < 2 && (f = 156, v = 1) : 137 === f ? v < 2 && (f = 139, v = 1) : 98 === f ? v < 2 && (f = 99, v = 1) : 38 === f ? v < 2 && (f = 39, v = 1) : 18 === f ? v > 0 ? (f = 156, v = 4) : f = 152 : 33 === f ? v > 0 ? (f = 139, v = 4) : f = 137 : 72 === f ? v > 0 ? (f = 99, v = 4) : f = 98 : 132 === f && (v > 0 ? (f = 39, v = 4) : f = 38)
                        }
                        if (0 != f && 170 != f) {
                            var g, y, b, w, E, S, x, T;
                            g = y = b = w = E = S = x = T = .5;
                            var N = [];
                            1 === f ? (b = 1 - ci(t, h, p), T = 1 - ci(t, l, p), N.push(ka[f])) : 169 === f ? (b = ci(o, p, h), T = ci(o, p, l), N.push(ka[f])) : 4 === f ? (S = 1 - ci(t, c, h), w = ci(t, p, h), N.push(Na[f])) : 166 === f ? (S = ci(o, h, c), w = 1 - ci(o, h, p), N.push(Na[f])) : 16 === f ? (E = ci(t, h, c), y = ci(t, l, c), N.push(Ta[f])) : 154 === f ? (E = 1 - ci(o, c, h), y = 1 - ci(o, c, l), N.push(Ta[f])) : 64 === f ? (x = ci(t, p, l), g = 1 - ci(t, c, l), N.push(Aa[f])) : 106 === f ? (x = 1 - ci(o, l, p), g = ci(o, l, c), N.push(Aa[f])) : 168 === f ? (w = ci(o, p, h), b = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), N.push(Ca[f]), N.push(ka[f])) : 2 === f ? (w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), N.push(Ca[f]), N.push(ka[f])) : 162 === f ? (E = ci(o, h, c), S = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), N.push(Ca[f]), N.push(ka[f])) : 8 === f ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), N.push(Ta[f]), N.push(Na[f])) : 138 === f ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l), N.push(Ta[f]), N.push(Na[f])) : 32 === f ? (E = ci(o, h, c), S = ci(t, h, c), g = ci(t, l, c), y = ci(o, l, c), N.push(Ta[f]), N.push(Na[f])) : 42 === f ? (T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c), N.push(La[f]), N.push(Aa[f])) : 128 === f && (T = ci(t, p, l), x = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l), N.push(La[f]), N.push(Aa[f])), 5 === f ? (S = 1 - ci(t, c, h), T = 1 - ci(t, l, p), N.push(Na[f])) : 165 === f ? (S = ci(o, h, c), T = ci(o, p, l), N.push(Na[f])) : 20 === f ? (w = ci(t, p, h), y = ci(t, l, c), N.push(Ca[f])) : 150 === f ? (w = 1 - ci(o, h, p), y = 1 - ci(o, c, l), N.push(Ca[f])) : 80 === f ? (E = ci(t, h, c), x = ci(t, p, l), N.push(Ta[f])) : 90 === f ? (E = 1 - ci(o, c, h), x = 1 - ci(o, l, p), N.push(Ta[f])) : 65 === f ? (b = 1 - ci(t, h, p), g = 1 - ci(t, c, l), N.push(ka[f])) : 105 === f ? (b = ci(o, p, h), g = ci(o, l, c), N.push(ka[f])) : 160 === f ? (E = ci(o, h, c), S = ci(t, h, c), T = ci(t, p, l), x = ci(o, p, l), N.push(Ta[f]), N.push(Na[f])) : 10 === f ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), N.push(Ta[f]), N.push(Na[f])) : 130 === f ? (w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l), N.push(Ca[f]), N.push(ka[f])) : 40 === f ? (w = ci(o, p, h), b = ci(t, p, h), g = ci(t, l, c), y = ci(o, l, c), N.push(Ca[f]), N.push(ka[f])) : 101 === f ? (S = ci(o, h, c), g = ci(o, l, c), N.push(Na[f])) : 69 === f ? (S = 1 - ci(t, c, h), g = 1 - ci(t, c, l), N.push(Na[f])) : 149 === f ? (T = ci(o, p, l), y = 1 - ci(o, c, l), N.push(La[f])) : 21 === f ? (T = 1 - ci(t, l, p), y = ci(t, l, c), N.push(La[f])) : 86 === f ? (w = 1 - ci(o, h, p), x = 1 - ci(o, l, p), N.push(Ca[f])) : 84 === f ? (w = ci(t, p, h), x = ci(t, p, l), N.push(Ca[f])) : 89 === f ? (E = 1 - ci(o, c, h), b = ci(o, p, h), N.push(ka[f])) : 81 === f ? (E = ci(t, h, c), b = 1 - ci(t, h, p), N.push(ka[f])) : 96 === f ? (E = ci(o, h, c), S = ci(t, h, c), x = ci(t, p, l), g = ci(o, l, c), N.push(Ta[f]), N.push(Na[f])) : 74 === f ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), x = 1 - ci(o, l, p), g = 1 - ci(t, c, l), N.push(Ta[f]), N.push(Na[f])) : 24 === f ? (E = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), y = ci(t, l, c), N.push(Ta[f]), N.push(ka[f])) : 146 === f ? (E = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), y = 1 - ci(o, c, l), N.push(Ta[f]), N.push(ka[f])) : 6 === f ? (S = 1 - ci(t, c, h), w = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), N.push(Na[f]), N.push(Ca[f])) : 164 === f ? (S = ci(o, h, c), w = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), N.push(Na[f]), N.push(Ca[f])) : 129 === f ? (b = 1 - ci(t, h, p), T = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l), N.push(ka[f]), N.push(La[f])) : 41 === f ? (b = ci(o, p, h), T = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c), N.push(ka[f]), N.push(La[f])) : 66 === f ? (w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), x = 1 - ci(o, l, p), g = 1 - ci(t, c, l), N.push(Ca[f]), N.push(ka[f])) : 104 === f ? (w = ci(o, p, h), b = ci(t, p, h), x = ci(t, p, l), g = ci(o, l, c), N.push(ka[f]), N.push(Oa[f])) : 144 === f ? (E = ci(t, h, c), T = ci(t, p, l), x = ci(o, p, l), y = 1 - ci(o, c, l), N.push(Ta[f]), N.push(Aa[f])) : 26 === f ? (E = 1 - ci(o, c, h), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), y = ci(t, l, c), N.push(Ta[f]), N.push(Aa[f])) : 36 === f ? (S = ci(o, h, c), w = ci(t, p, h), g = ci(t, l, c), y = ci(o, l, c), N.push(Na[f]), N.push(Ca[f])) : 134 === f ? (S = 1 - ci(t, c, h), w = 1 - ci(o, h, p), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l), N.push(Na[f]), N.push(Ca[f])) : 9 === f ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), b = ci(o, p, h), T = 1 - ci(t, l, p), N.push(Ta[f]), N.push(Na[f])) : 161 === f ? (E = ci(o, h, c), S = ci(t, h, c), b = 1 - ci(t, h, p), T = ci(o, p, l), N.push(Ta[f]), N.push(Na[f])) : 37 === f ? (S = ci(o, h, c), T = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c), N.push(Na[f]), N.push(La[f])) : 133 === f ? (S = 1 - ci(t, c, h), T = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l), N.push(Na[f]), N.push(La[f])) : 148 === f ? (w = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), y = 1 - ci(o, c, l), N.push(Ca[f]), N.push(Aa[f])) : 22 === f ? (w = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), y = ci(t, l, c), N.push(Ca[f]), N.push(Aa[f])) : 82 === f ? (E = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), x = 1 - ci(o, l, p), N.push(Ta[f]), N.push(ka[f])) : 88 === f ? (E = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), x = ci(t, p, l), N.push(Ta[f]), N.push(ka[f])) : 73 === f ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), b = ci(o, p, h), g = 1 - ci(t, c, l), N.push(Ta[f]), N.push(Na[f])) : 97 === f ? (E = ci(o, h, c), S = ci(t, h, c), b = 1 - ci(t, h, p), g = ci(o, l, c), N.push(Ta[f]), N.push(Na[f])) : 145 === f ? (E = ci(t, h, c), b = 1 - ci(t, h, p), T = ci(o, p, l), y = 1 - ci(o, c, l), N.push(Ta[f]), N.push(La[f])) : 25 === f ? (E = 1 - ci(o, c, h), b = ci(o, p, h), T = 1 - ci(t, l, p), y = ci(t, l, c), N.push(Ta[f]), N.push(La[f])) : 70 === f ? (S = 1 - ci(t, c, h), w = 1 - ci(o, h, p), x = 1 - ci(o, l, p), g = 1 - ci(t, c, l), N.push(Na[f]), N.push(Ca[f])) : 100 === f ? (S = ci(o, h, c), w = ci(t, p, h), x = ci(t, p, l), g = ci(o, l, c), N.push(Na[f]), N.push(Ca[f])) : 34 === f ? (0 === v ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l)) : (E = ci(o, h, c), S = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c)), N.push(Ta[f]), N.push(Na[f]), N.push(La[f]), N.push(Aa[f])) : 35 === f ? (4 === v ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l)) : (E = ci(o, h, c), S = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c)), N.push(Ta[f]), N.push(Na[f]), N.push(ka[f]), N.push(Aa[f])) : 136 === f ? (0 === v ? (E = ci(o, h, c), S = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c)) : (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l)), N.push(Ta[f]), N.push(Na[f]), N.push(La[f]), N.push(Aa[f])) : 153 === f ? (0 === v ? (E = ci(t, h, c), b = 1 - ci(t, h, p), T = 1 - ci(t, l, p), y = ci(t, l, c)) : (E = 1 - ci(o, c, h), b = ci(o, p, h), T = ci(o, p, l), y = 1 - ci(o, c, l)), N.push(Ta[f]), N.push(ka[f])) : 102 === f ? (0 === v ? (S = 1 - ci(t, c, h), w = ci(t, p, h), x = ci(t, p, l), g = 1 - ci(t, c, l)) : (S = ci(o, h, c), w = 1 - ci(o, h, p), x = 1 - ci(o, l, p), g = ci(o, l, c)), N.push(Na[f]), N.push(Aa[f])) : 155 === f ? (4 === v ? (E = ci(t, h, c), b = 1 - ci(t, h, p), T = 1 - ci(t, l, p), y = ci(t, l, c)) : (E = 1 - ci(o, c, h), b = ci(o, p, h), T = ci(o, p, l), y = 1 - ci(o, c, l)), N.push(Ta[f]), N.push(La[f])) : 103 === f ? (4 === v ? (S = 1 - ci(t, c, h), w = ci(t, p, h), x = ci(t, p, l), g = 1 - ci(t, c, l)) : (S = ci(o, h, c), w = 1 - ci(o, h, p), x = 1 - ci(o, l, p), g = ci(o, l, c)), N.push(Na[f]), N.push(Ca[f])) : 152 === f ? (0 === v ? (E = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), y = ci(t, l, c)) : (E = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), y = 1 - ci(o, c, l)), N.push(Ta[f]), N.push(Ca[f]), N.push(ka[f])) : 156 === f ? (4 === v ? (E = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), y = ci(t, l, c)) : (E = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), y = 1 - ci(o, c, l)), N.push(Ta[f]), N.push(ka[f]), N.push(Aa[f])) : 137 === f ? (0 === v ? (E = ci(o, h, c), S = ci(t, h, c), b = 1 - ci(t, h, p), T = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c)) : (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), b = ci(o, p, h), T = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l)), N.push(Ta[f]), N.push(Na[f]), N.push(ka[f])) : 139 === f ? (4 === v ? (E = ci(o, h, c), S = ci(t, h, c), b = 1 - ci(t, h, p), T = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c)) : (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), b = ci(o, p, h), T = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l)), N.push(Ta[f]), N.push(Na[f]), N.push(La[f])) : 98 === f ? (0 === v ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), x = ci(t, p, l), g = 1 - ci(t, c, l)) : (E = ci(o, h, c), S = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), x = 1 - ci(o, l, p), g = ci(o, l, c)), N.push(Ta[f]), N.push(Na[f]), N.push(Aa[f])) : 99 === f ? (4 === v ? (E = 1 - ci(t, c, h), S = 1 - ci(o, c, h), w = ci(o, p, h), b = ci(t, p, h), x = ci(t, p, l), g = 1 - ci(t, c, l)) : (E = ci(o, h, c), S = ci(t, h, c), w = 1 - ci(t, h, p), b = 1 - ci(o, h, p), x = 1 - ci(o, l, p), g = ci(o, l, c)), N.push(Ta[f]), N.push(Na[f]), N.push(ka[f])) : 38 === f ? (0 === v ? (S = 1 - ci(t, c, h), w = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l)) : (S = ci(o, h, c), w = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c)), N.push(Na[f]), N.push(La[f]), N.push(Aa[f])) : 39 === f ? (4 === v ? (S = 1 - ci(t, c, h), w = ci(t, p, h), T = ci(t, p, l), x = ci(o, p, l), g = 1 - ci(o, c, l), y = 1 - ci(t, c, l)) : (S = ci(o, h, c), w = 1 - ci(o, h, p), T = 1 - ci(o, l, p), x = 1 - ci(t, l, p), g = ci(t, l, c), y = ci(o, l, c)), N.push(Na[f]), N.push(Ca[f]), N.push(Aa[f])) : 85 === f && (E = 1, S = 0, w = 1, b = 0, T = 0, x = 1, g = 0, y = 1), (g < 0 || g > 1 || y < 0 || y > 1 || E < 0 || E > 1 || w < 0 || w > 1 || T < 0 || T > 1 || x < 0 || x > 1) && console.log("MarchingSquaresJS-isoBands: " + f + " " + d + " " + l + "," + c + "," + h + "," + p + " " + v + " " + g + " " + y + " " + E + " " + S + " " + w + " " + b + " " + T + " " + x), s.cells[u][a] = {
                                cval: f,
                                cval_real: d,
                                flipped: v,
                                topleft: g,
                                topright: y,
                                righttop: E,
                                rightbottom: S,
                                bottomright: w,
                                bottomleft: b,
                                leftbottom: T,
                                lefttop: x,
                                edges: N
                            }
                        }
                    }
                }
            }
            return s
        }(e, t, n);
        return Ru.polygons ? (Ru.verbose && console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"), a = function (e) {
            var t = [], n = 0;
            return e.cells.forEach(function (e, r) {
                e.forEach(function (e, i) {
                    if (void 0 !== e) {
                        var s = _a[e.cval](e);
                        "object" == typeof s && hi(s) ? "object" == typeof s[0] && hi(s[0]) ? "object" == typeof s[0][0] && hi(s[0][0]) ? s.forEach(function (e) {
                            e.forEach(function (e) {
                                e[0] += i, e[1] += r
                            }), t[n++] = e
                        }) : (s.forEach(function (e) {
                            e[0] += i, e[1] += r
                        }), t[n++] = s) : console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates") : console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")
                    }
                })
            }), t
        }(f)) : (Ru.verbose && console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"), a = function (e) {
            for (var t = [], n = e.rows, r = e.cols, i = [], s = 0; s < n; s++) for (var o = 0; o < r; o++) if (void 0 !== e.cells[s][o] && e.cells[s][o].edges.length > 0) {
                var u = e.cells[s][o], a = function (e) {
                    if (e.edges.length > 0) {
                        var t = e.edges[e.edges.length - 1], n = e.cval_real;
                        switch (t) {
                            case 0:
                                return n & zu ? {p: [1, e.righttop], x: -1, y: 0, o: 1} : {
                                    p: [e.topleft, 1],
                                    x: 0,
                                    y: -1,
                                    o: 0
                                };
                            case 1:
                                return n & Wu ? {p: [e.topleft, 1], x: 0, y: -1, o: 0} : {
                                    p: [1, e.rightbottom],
                                    x: -1,
                                    y: 0,
                                    o: 0
                                };
                            case 2:
                                return n & Wu ? {p: [e.bottomright, 0], x: 0, y: 1, o: 1} : {
                                    p: [e.topleft, 1],
                                    x: 0,
                                    y: -1,
                                    o: 0
                                };
                            case 3:
                                return n & Xu ? {p: [e.topleft, 1], x: 0, y: -1, o: 0} : {
                                    p: [e.bottomleft, 0],
                                    x: 0,
                                    y: 1,
                                    o: 0
                                };
                            case 4:
                                return n & zu ? {p: [1, e.righttop], x: -1, y: 0, o: 1} : {
                                    p: [e.topright, 1],
                                    x: 0,
                                    y: -1,
                                    o: 1
                                };
                            case 5:
                                return n & Wu ? {p: [e.topright, 1], x: 0, y: -1, o: 1} : {
                                    p: [1, e.rightbottom],
                                    x: -1,
                                    y: 0,
                                    o: 0
                                };
                            case 6:
                                return n & Wu ? {p: [e.bottomright, 0], x: 0, y: 1, o: 1} : {
                                    p: [e.topright, 1],
                                    x: 0,
                                    y: -1,
                                    o: 1
                                };
                            case 7:
                                return n & Xu ? {p: [e.topright, 1], x: 0, y: -1, o: 1} : {
                                    p: [e.bottomleft, 0],
                                    x: 0,
                                    y: 1,
                                    o: 0
                                };
                            case 8:
                                return n & Wu ? {p: [e.bottomright, 0], x: 0, y: 1, o: 1} : {
                                    p: [1, e.righttop],
                                    x: -1,
                                    y: 0,
                                    o: 1
                                };
                            case 9:
                                return n & Xu ? {p: [1, e.righttop], x: -1, y: 0, o: 1} : {
                                    p: [e.bottomleft, 0],
                                    x: 0,
                                    y: 1,
                                    o: 0
                                };
                            case 10:
                                return n & Xu ? {p: [0, e.leftbottom], x: 1, y: 0, o: 0} : {
                                    p: [1, e.righttop],
                                    x: -1,
                                    y: 0,
                                    o: 1
                                };
                            case 11:
                                return n & Uu ? {p: [1, e.righttop], x: -1, y: 0, o: 1} : {
                                    p: [0, e.lefttop],
                                    x: 1,
                                    y: 0,
                                    o: 1
                                };
                            case 12:
                                return n & Wu ? {p: [e.bottomright, 0], x: 0, y: 1, o: 1} : {
                                    p: [1, e.rightbottom],
                                    x: -1,
                                    y: 0,
                                    o: 0
                                };
                            case 13:
                                return n & Xu ? {p: [1, e.rightbottom], x: -1, y: 0, o: 0} : {
                                    p: [e.bottomleft, 0],
                                    x: 0,
                                    y: 1,
                                    o: 0
                                };
                            case 14:
                                return n & Xu ? {p: [0, e.leftbottom], x: 1, y: 0, o: 0} : {
                                    p: [1, e.rightbottom],
                                    x: -1,
                                    y: 0,
                                    o: 0
                                };
                            case 15:
                                return n & Uu ? {p: [1, e.rightbottom], x: -1, y: 0, o: 0} : {
                                    p: [0, e.lefttop],
                                    x: 1,
                                    y: 0,
                                    o: 1
                                };
                            case 16:
                                return n & Wu ? {p: [e.bottomright, 0], x: 0, y: 1, o: 1} : {
                                    p: [0, e.leftbottom],
                                    x: 1,
                                    y: 0,
                                    o: 0
                                };
                            case 17:
                                return n & Uu ? {p: [e.bottomright, 0], x: 0, y: 1, o: 1} : {
                                    p: [0, e.lefttop],
                                    x: 1,
                                    y: 0,
                                    o: 1
                                };
                            case 18:
                                return n & Xu ? {p: [0, e.leftbottom], x: 1, y: 0, o: 0} : {
                                    p: [e.bottomleft, 0],
                                    x: 0,
                                    y: 1,
                                    o: 0
                                };
                            case 19:
                                return n & Uu ? {p: [e.bottomleft, 0], x: 0, y: 1, o: 0} : {
                                    p: [0, e.lefttop],
                                    x: 1,
                                    y: 0,
                                    o: 1
                                };
                            case 20:
                                return n & Uu ? {p: [e.topleft, 1], x: 0, y: -1, o: 0} : {
                                    p: [0, e.leftbottom],
                                    x: 1,
                                    y: 0,
                                    o: 0
                                };
                            case 21:
                                return n & zu ? {p: [0, e.leftbottom], x: 1, y: 0, o: 0} : {
                                    p: [e.topright, 1],
                                    x: 0,
                                    y: -1,
                                    o: 1
                                };
                            case 22:
                                return n & Uu ? {p: [e.topleft, 1], x: 0, y: -1, o: 0} : {
                                    p: [0, e.lefttop],
                                    x: 1,
                                    y: 0,
                                    o: 1
                                };
                            case 23:
                                return n & zu ? {p: [0, e.lefttop], x: 1, y: 0, o: 1} : {
                                    p: [e.topright, 1],
                                    x: 0,
                                    y: -1,
                                    o: 1
                                };
                            default:
                                console.log("MarchingSquaresJS-isoBands: edge index out of range!"), console.log(e)
                        }
                    }
                    return null
                }(u), f = null, l = o, c = s;
                null !== a && i.push([a.p[0] + l, a.p[1] + c]);
                do {
                    if (null === (f = function (e, t, n, r) {
                        var i, s, o, u, a, f = e.cval;
                        switch (t) {
                            case-1:
                                switch (r) {
                                    case 0:
                                        i = Na[f], o = ta[f], u = na[f], a = ra[f];
                                        break;
                                    default:
                                        i = Ta[f], o = Yu[f], u = Zu[f], a = ea[f]
                                }
                                break;
                            case 1:
                                switch (r) {
                                    case 0:
                                        i = La[f], o = pa[f], u = da[f], a = va[f];
                                        break;
                                    default:
                                        i = Aa[f], o = la[f], u = ca[f], a = ha[f]
                                }
                                break;
                            default:
                                switch (n) {
                                    case-1:
                                        switch (r) {
                                            case 0:
                                                i = Oa[f], o = Vu[f], u = $u[f], a = Ju[f];
                                                break;
                                            default:
                                                i = Ma[f], o = Ku[f], u = Qu[f], a = Gu[f]
                                        }
                                        break;
                                    case 1:
                                        switch (r) {
                                            case 0:
                                                i = ka[f], o = ia[f], u = sa[f], a = oa[f];
                                                break;
                                            default:
                                                i = Ca[f], o = ua[f], u = aa[f], a = fa[f]
                                        }
                                }
                        }
                        if (s = e.edges.indexOf(i), void 0 === e.edges[s]) return null;
                        !function (e, t) {
                            delete e.edges[t];
                            for (var n = t + 1; n < e.edges.length; n++) e.edges[n - 1] = e.edges[n];
                            e.edges.pop()
                        }(e, s);
                        switch (f = e.cval_real, i) {
                            case 0:
                                f & zu ? (t = e.topleft, n = 1) : (t = 1, n = e.righttop);
                                break;
                            case 1:
                                f & Wu ? (t = 1, n = e.rightbottom) : (t = e.topleft, n = 1);
                                break;
                            case 2:
                                f & Wu ? (t = e.topleft, n = 1) : (t = e.bottomright, n = 0);
                                break;
                            case 3:
                                f & Xu ? (t = e.bottomleft, n = 0) : (t = e.topleft, n = 1);
                                break;
                            case 4:
                                f & zu ? (t = e.topright, n = 1) : (t = 1, n = e.righttop);
                                break;
                            case 5:
                                f & Wu ? (t = 1, n = e.rightbottom) : (t = e.topright, n = 1);
                                break;
                            case 6:
                                f & Wu ? (t = e.topright, n = 1) : (t = e.bottomright, n = 0);
                                break;
                            case 7:
                                f & Xu ? (t = e.bottomleft, n = 0) : (t = e.topright, n = 1);
                                break;
                            case 8:
                                f & Wu ? (t = 1, n = e.righttop) : (t = e.bottomright, n = 0);
                                break;
                            case 9:
                                f & Xu ? (t = e.bottomleft, n = 0) : (t = 1, n = e.righttop);
                                break;
                            case 10:
                                f & Xu ? (t = 1, n = e.righttop) : (t = 0, n = e.leftbottom);
                                break;
                            case 11:
                                f & Uu ? (t = 0, n = e.lefttop) : (t = 1, n = e.righttop);
                                break;
                            case 12:
                                f & Wu ? (t = 1, n = e.rightbottom) : (t = e.bottomright, n = 0);
                                break;
                            case 13:
                                f & Xu ? (t = e.bottomleft, n = 0) : (t = 1, n = e.rightbottom);
                                break;
                            case 14:
                                f & Xu ? (t = 1, n = e.rightbottom) : (t = 0, n = e.leftbottom);
                                break;
                            case 15:
                                f & Uu ? (t = 0, n = e.lefttop) : (t = 1, n = e.rightbottom);
                                break;
                            case 16:
                                f & Wu ? (t = 0, n = e.leftbottom) : (t = e.bottomright, n = 0);
                                break;
                            case 17:
                                f & Uu ? (t = 0, n = e.lefttop) : (t = e.bottomright, n = 0);
                                break;
                            case 18:
                                f & Xu ? (t = e.bottomleft, n = 0) : (t = 0, n = e.leftbottom);
                                break;
                            case 19:
                                f & Uu ? (t = 0, n = e.lefttop) : (t = e.bottomleft, n = 0);
                                break;
                            case 20:
                                f & Uu ? (t = 0, n = e.leftbottom) : (t = e.topleft, n = 1);
                                break;
                            case 21:
                                f & zu ? (t = e.topright, n = 1) : (t = 0, n = e.leftbottom);
                                break;
                            case 22:
                                f & Uu ? (t = 0, n = e.lefttop) : (t = e.topleft, n = 1);
                                break;
                            case 23:
                                f & zu ? (t = e.topright, n = 1) : (t = 0, n = e.lefttop);
                                break;
                            default:
                                return console.log("MarchingSquaresJS-isoBands: edge index out of range!"), console.log(e), null
                        }
                        return void 0 !== t && void 0 !== n && void 0 !== o && void 0 !== u && void 0 !== a || (console.log("MarchingSquaresJS-isoBands: undefined value!"), console.log(e), console.log(t + " " + n + " " + o + " " + u + " " + a)), {
                            p: [t, n],
                            x: o,
                            y: u,
                            o: a
                        }
                    }(e.cells[c][l], a.x, a.y, a.o))) break;
                    if (i.push([f.p[0] + l, f.p[1] + c]), l += f.x, c += f.y, a = f, c < 0 || c >= n || l < 0 || l >= r || void 0 === e.cells[c][l]) {
                        l -= f.x, c -= f.y;
                        var h = function (e, t, n, r, i, s) {
                            var o = e.cells[n][t], u = o.cval_real, a = t + r, f = n + i, l = [], c = !1;
                            for (; !c;) {
                                if (void 0 === e.cells[f] || void 0 === e.cells[f][a]) if (f -= i, a -= r, o = e.cells[f][a], u = o.cval_real, -1 === i) if (0 === s) if (u & Xu) l.push([a, f]), r = -1, i = 0, s = 0; else {
                                    if (!(u & Wu)) {
                                        l.push([a + o.bottomright, f]), r = 0, i = 1, s = 1, c = !0;
                                        break
                                    }
                                    l.push([a + 1, f]), r = 1, i = 0, s = 0
                                } else {
                                    if (!(u & Xu)) {
                                        if (u & Wu) {
                                            l.push([a + o.bottomright, f]), r = 0, i = 1, s = 1, c = !0;
                                            break
                                        }
                                        l.push([a + o.bottomleft, f]), r = 0, i = 1, s = 0, c = !0;
                                        break
                                    }
                                    l.push([a, f]), r = -1, i = 0, s = 0
                                } else if (1 === i) if (0 === s) {
                                    if (!(u & zu)) {
                                        if (u & Uu) {
                                            l.push([a + o.topleft, f + 1]), r = 0, i = -1, s = 0, c = !0;
                                            break
                                        }
                                        l.push([a + o.topright, f + 1]), r = 0, i = -1, s = 1, c = !0;
                                        break
                                    }
                                    l.push([a + 1, f + 1]), r = 1, i = 0, s = 1
                                } else l.push([a + 1, f + 1]), r = 1, i = 0, s = 1; else if (-1 === r) if (0 === s) {
                                    if (!(u & Uu)) {
                                        if (u & Xu) {
                                            l.push([a, f + o.leftbottom]), r = 1, i = 0, s = 0, c = !0;
                                            break
                                        }
                                        l.push([a, f + o.lefttop]), r = 1, i = 0, s = 1, c = !0;
                                        break
                                    }
                                    l.push([a, f + 1]), r = 0, i = 1, s = 0
                                } else {
                                    if (!(u & Uu)) {
                                        console.log("MarchingSquaresJS-isoBands: wtf");
                                        break
                                    }
                                    l.push([a, f + 1]), r = 0, i = 1, s = 0
                                } else {
                                    if (1 !== r) {
                                        console.log("MarchingSquaresJS-isoBands: we came from nowhere!");
                                        break
                                    }
                                    if (0 === s) {
                                        if (!(u & Wu)) {
                                            l.push([a + 1, f + o.rightbottom]), r = -1, i = 0, s = 0, c = !0;
                                            break
                                        }
                                        l.push([a + 1, f]), r = 0, i = -1, s = 1
                                    } else {
                                        if (!(u & Wu)) {
                                            if (u & zu) {
                                                l.push([a + 1, f + o.righttop]), r = -1, i = 0, s = 1;
                                                break
                                            }
                                            l.push([a + 1, f + o.rightbottom]), r = -1, i = 0, s = 0, c = !0;
                                            break
                                        }
                                        l.push([a + 1, f]), r = 0, i = -1, s = 1
                                    }
                                } else if (o = e.cells[f][a], u = o.cval_real, -1 === r) if (0 === s) if (void 0 !== e.cells[f - 1] && void 0 !== e.cells[f - 1][a]) r = 0, i = -1, s = 1; else {
                                    if (!(u & Xu)) {
                                        l.push([a + o.bottomright, f]), r = 0, i = 1, s = 1, c = !0;
                                        break
                                    }
                                    l.push([a, f])
                                } else {
                                    if (!(u & Uu)) {
                                        console.log("MarchingSquaresJS-isoBands: found entry from top at " + a + "," + f);
                                        break
                                    }
                                    console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")
                                } else if (1 === r) {
                                    if (0 === s) {
                                        console.log("MarchingSquaresJS-isoBands: wtf");
                                        break
                                    }
                                    if (void 0 !== e.cells[f + 1] && void 0 !== e.cells[f + 1][a]) r = 0, i = 1, s = 0; else {
                                        if (!(u & zu)) {
                                            l.push([a + o.topleft, f + 1]), r = 0, i = -1, s = 0, c = !0;
                                            break
                                        }
                                        l.push([a + 1, f + 1]), r = 1, i = 0, s = 1
                                    }
                                } else if (-1 === i) {
                                    if (1 !== s) {
                                        console.log("MarchingSquaresJS-isoBands: wtf");
                                        break
                                    }
                                    if (void 0 !== e.cells[f][a + 1]) r = 1, i = 0, s = 1; else {
                                        if (!(u & Wu)) {
                                            l.push([a + 1, f + o.righttop]), r = -1, i = 0, s = 1, c = !0;
                                            break
                                        }
                                        l.push([a + 1, f]), r = 0, i = -1, s = 1
                                    }
                                } else {
                                    if (1 !== i) {
                                        console.log("MarchingSquaresJS-isoBands: where did we came from???");
                                        break
                                    }
                                    if (0 !== s) {
                                        console.log("MarchingSquaresJS-isoBands: wtf");
                                        break
                                    }
                                    if (void 0 !== e.cells[f][a - 1]) r = -1, i = 0, s = 0; else {
                                        if (!(u & Uu)) {
                                            l.push([a, f + o.leftbottom]), r = 1, i = 0, s = 0, c = !0;
                                            break
                                        }
                                        l.push([a, f + 1]), r = 0, i = 1, s = 0
                                    }
                                }
                                if (a += r, f += i, a === t && f === n) break
                            }
                            return {path: l, i: a, j: f, x: r, y: i, o: s}
                        }(e, l, c, f.x, f.y, f.o);
                        if (null === h) break;
                        h.path.forEach(function (e) {
                            i.push(e)
                        }), l = h.i, c = h.j, a = h
                    }
                } while (void 0 !== e.cells[c][l] && e.cells[c][l].edges.length > 0);
                t.push(i), i = [], e.cells[s][o].edges.length > 0 && o--
            }
            return t
        }(f)), "function" == typeof Ru.successCallback && Ru.successCallback(a), a
    }

    function ci(e, t, n) {
        return (e - t) / (n - t)
    }

    function hi(e) {
        return e.constructor.toString().indexOf("Array") > -1
    }

    function pi(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.pivot, i = n.mutate;
        if (!e) throw new Error("geojson is required");
        if (void 0 === t || null === t || isNaN(t)) throw new Error("angle is required");
        return 0 === t ? e : (r || (r = gn(e)), !1 !== i && void 0 !== i || (e = Ft(e)), k(e, function (e) {
            var n = or(r, e) + t, i = ar(r, e), s = W(ni(r, i, n));
            e[0] = s[0], e[1] = s[1]
        }), e)
    }

    function di(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.origin, i = n.mutate;
        if (!e) throw new Error("geojson required");
        if ("number" != typeof t || 0 === t) throw new Error("invalid factor");
        var s = Array.isArray(r) || "object" == typeof r;
        return !0 !== i && (e = Ft(e)), "FeatureCollection" !== e.type || s ? vi(e, t, r) : (M(e, function (n, i) {
            e.features[i] = vi(n, t, r)
        }), e)
    }

    function vi(e, t, n) {
        var i = "Point" === G(e);
        return n = function (e, t) {
            void 0 !== t && null !== t || (t = "centroid");
            if (Array.isArray(t) || "object" == typeof t) return z(t);
            var n = e.bbox ? e.bbox : U(e), i = n[0], s = n[1], o = n[2], u = n[3];
            switch (t) {
                case"sw":
                case"southwest":
                case"westsouth":
                case"bottomleft":
                    return r([i, s]);
                case"se":
                case"southeast":
                case"eastsouth":
                case"bottomright":
                    return r([o, s]);
                case"nw":
                case"northwest":
                case"westnorth":
                case"topleft":
                    return r([i, u]);
                case"ne":
                case"northeast":
                case"eastnorth":
                case"topright":
                    return r([o, u]);
                case"center":
                    return mn(e);
                case void 0:
                case null:
                case"centroid":
                    return gn(e);
                default:
                    throw new Error("invalid origin")
            }
        }(e, n), 1 === t || i ? e : (k(e, function (e) {
            var r = ar(n, e), i = or(n, e), s = W(ni(n, r * t, i));
            e[0] = s[0], e[1] = s[1], 3 === e.length && (e[2] *= t)
        }), e)
    }

    function mi(e) {
        var t = e[0], n = e[1];
        return [n[0] - t[0], n[1] - t[1]]
    }

    function gi(e, t) {
        return e[0] * t[1] - t[0] * e[1]
    }

    function yi(e, t) {
        return !function (e, t) {
            return 0 === gi(mi(e), mi(t))
        }(e, t) && function (e, t) {
            var n = e[0], r = mi(e), i = t[0], s = mi(t), o = gi(r, s);
            return function (e, t) {
                return [e[0] + t[0], e[1] + t[1]]
            }(n, function (e, t) {
                return [e * t[0], e * t[1]]
            }(gi(function (e, t) {
                return [e[0] - t[0], e[1] - t[1]]
            }(i, n), s) / o, r))
        }(e, t)
    }

    function bi(e, t, n) {
        var r = [], i = g(t, n), s = W(e), o = [];
        return s.forEach(function (e, t) {
            if (t !== s.length - 1) {
                var n = function (e, t, n) {
                    var r = Math.sqrt((e[0] - t[0]) * (e[0] - t[0]) + (e[1] - t[1]) * (e[1] - t[1])),
                        i = e[0] + n * (t[1] - e[1]) / r, s = t[0] + n * (t[1] - e[1]) / r,
                        o = e[1] + n * (e[0] - t[0]) / r, u = t[1] + n * (e[0] - t[0]) / r;
                    return [[i, o], [s, u]]
                }(e, s[t + 1], i);
                if (r.push(n), t > 0) {
                    var u = r[t - 1], a = yi(n, u);
                    !1 !== a && (u[1] = a, n[0] = a), o.push(u[0]), t === s.length - 2 && (o.push(n[0]), o.push(n[1]))
                }
                2 === s.length && (o.push(n[0]), o.push(n[1]))
            }
        }), u(o, e.properties)
    }

    function wi(e, t, n) {
        var r = t[0] - e[0], i = t[1] - e[1], s = n[0] - t[0], o = n[1] - t[1];
        return Math.sign(r * o - s * i)
    }

    function Ei(e, t) {
        return t.geometry.coordinates[0].every(function (t) {
            return Ot(r(t), e)
        })
    }

    function Si(e, t) {
        for (var n = 0; n < e.coordinates.length - 1; n++) if (function (e, t, n) {
            var r = n[0] - e[0], i = n[1] - e[1], s = t[0] - e[0], o = t[1] - e[1];
            return r * o - i * s != 0 ? !1 : Math.abs(s) >= Math.abs(o) ? s > 0 ? e[0] <= n[0] && n[0] <= t[0] : t[0] <= n[0] && n[0] <= e[0] : o > 0 ? e[1] <= n[1] && n[1] <= t[1] : t[1] <= n[1] && n[1] <= e[1]
        }(e.coordinates[n], e.coordinates[n + 1], t.coordinates)) return !0;
        return !1
    }

    function xi(e, t) {
        return rr(t, qr(e)).features.length > 0
    }

    function Ti(e, t) {
        return !(e[0] > t[0]) && !(e[2] < t[2]) && !(e[1] > t[1]) && !(e[3] < t[3])
    }

    function Ni(e, t) {
        return e[0] === t[0] && e[1] === t[1]
    }

    function Ci(e, t) {
        for (var n = !1, r = !1, i = e.coordinates.length, s = 0; s < i && !n && !r;) {
            for (var o = 0; o < t.coordinates.length - 1; o++) {
                var u = !0;
                0 !== o && o !== t.coordinates.length - 2 || (u = !1), Ai(t.coordinates[o], t.coordinates[o + 1], e.coordinates[s], u) ? n = !0 : r = !0
            }
            s++
        }
        return n && r
    }

    function ki(e, t) {
        return rr(e, qr(t)).features.length > 0
    }

    function Li(e, t) {
        for (var n = !1, i = !1, s = e.coordinates[0].length, o = 0; o < s && n && i;) Ot(r(e.coordinates[0][o]), t) ? n = !0 : i = !0, o++;
        return i && i
    }

    function Ai(e, t, n, r) {
        var i = n[0] - e[0], s = n[1] - e[1], o = t[0] - e[0], u = t[1] - e[1];
        return 0 == i * u - s * o && (r ? Math.abs(o) >= Math.abs(u) ? o > 0 ? e[0] <= n[0] && n[0] <= t[0] : t[0] <= n[0] && n[0] <= e[0] : u > 0 ? e[1] <= n[1] && n[1] <= t[1] : t[1] <= n[1] && n[1] <= e[1] : Math.abs(o) >= Math.abs(u) ? o > 0 ? e[0] < n[0] && n[0] < t[0] : t[0] < n[0] && n[0] < e[0] : u > 0 ? e[1] < n[1] && n[1] < t[1] : t[1] < n[1] && n[1] < e[1])
    }

    function Oi(e) {
        return e.coordinates.map(function (t) {
            return {type: e.type.replace("Multi", ""), coordinates: t}
        })
    }

    function Mi(e, t) {
        return e.hasOwnProperty("coordinates") ? e.coordinates.length === t.coordinates.length : e.length === t.length
    }

    function _i(e, t) {
        return qa(e, t, {strict: !0})
    }

    function Di(e, t) {
        if (!e) throw new Error("feature1 is required");
        if (!t) throw new Error("feature2 is required");
        var n = G(e);
        if (n !== G(t)) throw new Error("features must be of the same type");
        if ("Point" === n) throw new Error("Point geometry not supported");
        if ((new Ua({precision: 6})).compare(e, t)) return !1;
        var r = 0;
        switch (n) {
            case"MultiPoint":
                var i = D(e), s = D(t);
                i.forEach(function (e) {
                    s.forEach(function (t) {
                        e[0] === t[0] && e[1] === t[1] && r++
                    })
                });
                break;
            case"LineString":
            case"MultiLineString":
                F(e, function (e) {
                    F(t, function (t) {
                        Zr(e, t).features.length && r++
                    })
                });
                break;
            case"Polygon":
            case"MultiPolygon":
                F(e, function (e) {
                    F(t, function (t) {
                        rr(e, t).features.length && r++
                    })
                })
        }
        return r > 0
    }

    function Pi(e, t, n) {
        n = n || [];
        for (var r = 0; r < e; r++) n[r] = t;
        return n
    }

    function Hi(e, t) {
        if (e.geometry && e.geometry.type) return e.geometry.type;
        if (e.type) return e.type;
        throw new Error("Invalid GeoJSON object for " + t)
    }

    function Bi(e) {
        for (var t = e, n = []; t.parent;) n.unshift(t), t = t.parent;
        return n
    }

    function ji(e, t) {
        t = t || {}, this.nodes = [], this.diagonal = !!t.diagonal, this.grid = [];
        for (var n = 0; n < e.length; n++) {
            this.grid[n] = [];
            for (var r = 0, i = e[n]; r < i.length; r++) {
                var s = new Fi(n, r, i[r]);
                this.grid[n][r] = s, this.nodes.push(s)
            }
        }
        this.init()
    }

    function Fi(e, t, n) {
        this.x = e, this.y = t, this.weight = n
    }

    function Ii(e) {
        this.content = [], this.scoreFunction = e
    }

    function qi(e) {
        return e[0]
    }

    function Ri(e) {
        return e[1]
    }

    function Ui() {
        this._ = null
    }

    function zi(e) {
        e.U = e.C = e.L = e.R = e.P = e.N = null
    }

    function Wi(e, t) {
        var n = t, r = t.R, i = n.U;
        i ? i.L === n ? i.L = r : i.R = r : e._ = r, r.U = i, n.U = r, n.R = r.L, n.R && (n.R.U = n), r.L = n
    }

    function Xi(e, t) {
        var n = t, r = t.L, i = n.U;
        i ? i.L === n ? i.L = r : i.R = r : e._ = r, r.U = i, n.U = r, n.L = r.R, n.L && (n.L.U = n), r.R = n
    }

    function Vi(e) {
        for (; e.L;) e = e.L;
        return e
    }

    function $i(e, t, n, r) {
        var i = [null, null], s = ff.push(i) - 1;
        return i.left = e, i.right = t, n && Ki(i, e, t, n), r && Ki(i, t, e, r), uf[e.index].halfedges.push(s), uf[t.index].halfedges.push(s), i
    }

    function Ji(e, t, n) {
        var r = [t, n];
        return r.left = e, r
    }

    function Ki(e, t, n, r) {
        e[0] || e[1] ? e.left === n ? e[1] = r : e[0] = r : (e[0] = r, e.left = t, e.right = n)
    }

    function Qi(e, t, n, r, i) {
        var s, o = e[0], u = e[1], a = o[0], f = o[1], l = 0, c = 1, h = u[0] - a, p = u[1] - f;
        if (s = t - a, h || !(s > 0)) {
            if (s /= h, h < 0) {
                if (s < l) return;
                s < c && (c = s)
            } else if (h > 0) {
                if (s > c) return;
                s > l && (l = s)
            }
            if (s = r - a, h || !(s < 0)) {
                if (s /= h, h < 0) {
                    if (s > c) return;
                    s > l && (l = s)
                } else if (h > 0) {
                    if (s < l) return;
                    s < c && (c = s)
                }
                if (s = n - f, p || !(s > 0)) {
                    if (s /= p, p < 0) {
                        if (s < l) return;
                        s < c && (c = s)
                    } else if (p > 0) {
                        if (s > c) return;
                        s > l && (l = s)
                    }
                    if (s = i - f, p || !(s < 0)) {
                        if (s /= p, p < 0) {
                            if (s > c) return;
                            s > l && (l = s)
                        } else if (p > 0) {
                            if (s < l) return;
                            s < c && (c = s)
                        }
                        return !(l > 0 || c < 1) || (l > 0 && (e[0] = [a + l * h, f + l * p]), c < 1 && (e[1] = [a + c * h, f + c * p]), !0)
                    }
                }
            }
        }
    }

    function Gi(e, t, n, r, i) {
        var s = e[1];
        if (s) return !0;
        var o, u, a = e[0], f = e.left, l = e.right, c = f[0], h = f[1], p = l[0], d = l[1], v = (c + p) / 2,
            m = (h + d) / 2;
        if (d === h) {
            if (v < t || v >= r) return;
            if (c > p) {
                if (a) {
                    if (a[1] >= i) return
                } else a = [v, n];
                s = [v, i]
            } else {
                if (a) {
                    if (a[1] < n) return
                } else a = [v, i];
                s = [v, n]
            }
        } else if (o = (c - p) / (d - h), u = m - o * v, o < -1 || o > 1) if (c > p) {
            if (a) {
                if (a[1] >= i) return
            } else a = [(n - u) / o, n];
            s = [(i - u) / o, i]
        } else {
            if (a) {
                if (a[1] < n) return
            } else a = [(i - u) / o, i];
            s = [(n - u) / o, n]
        } else if (h < d) {
            if (a) {
                if (a[0] >= r) return
            } else a = [t, o * t + u];
            s = [r, o * r + u]
        } else {
            if (a) {
                if (a[0] < t) return
            } else a = [r, o * r + u];
            s = [t, o * t + u]
        }
        return e[0] = a, e[1] = s, !0
    }

    function Yi(e, t) {
        var n = e.site, r = t.left, i = t.right;
        return n === i && (i = r, r = n), i ? Math.atan2(i[1] - r[1], i[0] - r[0]) : (n === r ? (r = t[1], i = t[0]) : (r = t[0], i = t[1]), Math.atan2(r[0] - i[0], i[1] - r[1]))
    }

    function Zi(e, t) {
        return t[+(t.left !== e.site)]
    }

    function es(e, t) {
        return t[+(t.left === e.site)]
    }

    function ts(e) {
        var t = e.P, n = e.N;
        if (t && n) {
            var r = t.site, i = e.site, s = n.site;
            if (r !== s) {
                var o = i[0], u = i[1], a = r[0] - o, f = r[1] - u, l = s[0] - o, c = s[1] - u, h = 2 * (a * c - f * l);
                if (!(h >= -pf)) {
                    var p = a * a + f * f, d = l * l + c * c, v = (c * p - f * d) / h, m = (a * d - l * p) / h,
                        g = lf.pop() || new function () {
                            zi(this), this.x = this.y = this.arc = this.site = this.cy = null
                        };
                    g.arc = e, g.site = i, g.x = v + o, g.y = (g.cy = m + u) + Math.sqrt(v * v + m * m), e.circle = g;
                    for (var y = null, b = af._; b;) if (g.y < b.y || g.y === b.y && g.x <= b.x) {
                        if (!b.L) {
                            y = b.P;
                            break
                        }
                        b = b.L
                    } else {
                        if (!b.R) {
                            y = b;
                            break
                        }
                        b = b.R
                    }
                    af.insert(y, g), y || (sf = g)
                }
            }
        }
    }

    function ns(e) {
        var t = e.circle;
        t && (t.P || (sf = t.N), af.remove(t), lf.push(t), zi(t), e.circle = null)
    }

    function rs(e) {
        var t = cf.pop() || new function () {
            zi(this), this.edge = this.site = this.circle = null
        };
        return t.site = e, t
    }

    function is(e) {
        ns(e), of.remove(e), cf.push(e), zi(e)
    }

    function ss(e) {
        var t = e.circle, n = t.x, r = t.cy, i = [n, r], s = e.P, o = e.N, u = [e];
        is(e);
        for (var a = s; a.circle && Math.abs(n - a.circle.x) < hf && Math.abs(r - a.circle.cy) < hf;) s = a.P, u.unshift(a), is(a), a = s;
        u.unshift(a), ns(a);
        for (var f = o; f.circle && Math.abs(n - f.circle.x) < hf && Math.abs(r - f.circle.cy) < hf;) o = f.N, u.push(f), is(f), f = o;
        u.push(f), ns(f);
        var l, c = u.length;
        for (l = 1; l < c; ++l) f = u[l], a = u[l - 1], Ki(f.edge, a.site, f.site, i);
        a = u[0], (f = u[c - 1]).edge = $i(a.site, f.site, null, i), ts(a), ts(f)
    }

    function os(e) {
        for (var t, n, r, i, s = e[0], o = e[1], u = of._; u;) if ((r = us(u, o) - s) > hf) u = u.L; else {
            if (!((i = s - function (e, t) {
                var n = e.N;
                if (n) return us(n, t);
                var r = e.site;
                return r[1] === t ? r[0] : 1 / 0
            }(u, o)) > hf)) {
                r > -hf ? (t = u.P, n = u) : i > -hf ? (t = u, n = u.N) : t = n = u;
                break
            }
            if (!u.R) {
                t = u;
                break
            }
            u = u.R
        }
        !function (e) {
            uf[e.index] = {site: e, halfedges: []}
        }(e);
        var a = rs(e);
        if (of.insert(t, a), t || n) {
            if (t === n) return ns(t), n = rs(t.site), of.insert(a, n), a.edge = n.edge = $i(t.site, a.site), ts(t), void ts(n);
            if (n) {
                ns(t), ns(n);
                var f = t.site, l = f[0], c = f[1], h = e[0] - l, p = e[1] - c, d = n.site, v = d[0] - l, m = d[1] - c,
                    g = 2 * (h * m - p * v), y = h * h + p * p, b = v * v + m * m,
                    w = [(m * y - p * b) / g + l, (h * b - v * y) / g + c];
                Ki(n.edge, f, d, w), a.edge = $i(f, e, null, w), n.edge = $i(e, d, null, w), ts(t), ts(n)
            } else a.edge = $i(t.site, a.site)
        }
    }

    function us(e, t) {
        var n = e.site, r = n[0], i = n[1], s = i - t;
        if (!s) return r;
        var o = e.P;
        if (!o) return -1 / 0;
        var u = (n = o.site)[0], a = n[1], f = a - t;
        if (!f) return u;
        var l = u - r, c = 1 / s - 1 / f, h = l / f;
        return c ? (-h + Math.sqrt(h * h - 2 * c * (l * l / (-2 * f) - a + f / 2 + i - s / 2))) / c + r : (r + u) / 2
    }

    function as(e, t, n) {
        return (e[0] - n[0]) * (t[1] - e[1]) - (e[0] - t[0]) * (n[1] - e[1])
    }

    function fs(e, t) {
        return t[1] - e[1] || t[0] - e[0]
    }

    function ls(e, t) {
        var n, r, i, s = e.sort(fs).pop();
        for (ff = [], uf = new Array(e.length), of = new Ui, af = new Ui; ;) if (i = sf, s && (!i || s[1] < i.y || s[1] === i.y && s[0] < i.x)) s[0] === n && s[1] === r || (os(s), n = s[0], r = s[1]), s = e.pop(); else {
            if (!i) break;
            ss(i.arc)
        }
        if (function () {
            for (var e, t, n, r, i = 0, s = uf.length; i < s; ++i) if ((e = uf[i]) && (r = (t = e.halfedges).length)) {
                var o = new Array(r), u = new Array(r);
                for (n = 0; n < r; ++n) o[n] = n, u[n] = Yi(e, ff[t[n]]);
                for (o.sort(function (e, t) {
                    return u[t] - u[e]
                }), n = 0; n < r; ++n) u[n] = t[o[n]];
                for (n = 0; n < r; ++n) t[n] = u[n]
            }
        }(), t) {
            var o = +t[0][0], u = +t[0][1], a = +t[1][0], f = +t[1][1];
            !function (e, t, n, r) {
                for (var i, s = ff.length; s--;) Gi(i = ff[s], e, t, n, r) && Qi(i, e, t, n, r) && (Math.abs(i[0][0] - i[1][0]) > hf || Math.abs(i[0][1] - i[1][1]) > hf) || delete ff[s]
            }(o, u, a, f), function (e, t, n, r) {
                var i, s, o, u, a, f, l, c, h, p, d, v, m = uf.length, g = !0;
                for (i = 0; i < m; ++i) if (s = uf[i]) {
                    for (o = s.site, u = (a = s.halfedges).length; u--;) ff[a[u]] || a.splice(u, 1);
                    for (u = 0, f = a.length; u < f;) d = (p = es(s, ff[a[u]]))[0], v = p[1], c = (l = Zi(s, ff[a[++u % f]]))[0], h = l[1], (Math.abs(d - c) > hf || Math.abs(v - h) > hf) && (a.splice(u, 0, ff.push(Ji(o, p, Math.abs(d - e) < hf && r - v > hf ? [e, Math.abs(c - e) < hf ? h : r] : Math.abs(v - r) < hf && n - d > hf ? [Math.abs(h - r) < hf ? c : n, r] : Math.abs(d - n) < hf && v - t > hf ? [n, Math.abs(c - n) < hf ? h : t] : Math.abs(v - t) < hf && d - e > hf ? [Math.abs(h - t) < hf ? c : e, t] : null)) - 1), ++f);
                    f && (g = !1)
                }
                if (g) {
                    var y, b, w, E = 1 / 0;
                    for (i = 0, g = null; i < m; ++i) (s = uf[i]) && (w = (y = (o = s.site)[0] - e) * y + (b = o[1] - t) * b) < E && (E = w, g = s);
                    if (g) {
                        var S = [e, t], x = [e, r], T = [n, r], N = [n, t];
                        g.halfedges.push(ff.push(Ji(o = g.site, S, x)) - 1, ff.push(Ji(o, x, T)) - 1, ff.push(Ji(o, T, N)) - 1, ff.push(Ji(o, N, S)) - 1)
                    }
                }
                for (i = 0; i < m; ++i) (s = uf[i]) && (s.halfedges.length || delete uf[i])
            }(o, u, a, f)
        }
        this.edges = ff, this.cells = uf, of = af = ff = uf = null
    }

    function cs(e) {
        return (e = e.slice()).push(e[0]), s([e])
    }

    function hs(e, t, n, r) {
        var i = (r = r || {}).steps || 64, o = r.units || "kilometers", u = r.angle || 0, a = r.pivot || e,
            f = r.properties || e.properties || {};
        if (!e) throw new Error("center is required");
        if (!t) throw new Error("xSemiAxis is required");
        if (!n) throw new Error("ySemiAxis is required");
        if (!T(r)) throw new Error("options must be an object");
        if (!x(i)) throw new Error("steps must be a number");
        if (!x(u)) throw new Error("angle must be a number");
        var l = z(e);
        if ("degrees" === o) var c = w(u); else t = ni(e, t, 90, {units: o}), n = ni(e, n, 0, {units: o}), t = z(t)[0] - l[0], n = z(n)[1] - l[1];
        for (var h = [], p = 0; p < i; p += 1) {
            var d = -360 * p / i, v = t * n / Math.sqrt(Math.pow(n, 2) + Math.pow(t, 2) * Math.pow(ps(d), 2)),
                m = t * n / Math.sqrt(Math.pow(t, 2) + Math.pow(n, 2) / Math.pow(ps(d), 2));
            if (d < -90 && d >= -270 && (v = -v), d < -180 && d >= -360 && (m = -m), "degrees" === o) {
                var g = v * Math.cos(c) + m * Math.sin(c), y = m * Math.cos(c) - v * Math.sin(c);
                v = g, m = y
            }
            h.push([v + l[0], m + l[1]])
        }
        return h.push(h[0]), "degrees" === o ? s([h], f) : pi(s([h], f), u, {pivot: a})
    }

    function ps(e) {
        var t = e * Math.PI / 180;
        return Math.tan(t)
    }

    function ds(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.properties, i = t.weight;
        if (!e) throw new Error("geojson is required");
        var s = 0, o = 0, u = 0;
        return P(e, function (e, t, n) {
            var r = n[i];
            if (r = void 0 === r || null === r ? 1 : r, !x(r)) throw new Error("weight value must be a number for feature index " + t);
            (r = Number(r)) > 0 && k(e, function (e) {
                s += e[0] * r, o += e[1] * r, u += r
            })
        }), r([s / u, o / u], n)
    }

    function vs(e, t, n, i) {
        var s = n.properties.tolerance || .001, o = 0, u = 0, a = 0, f = 0;
        if (M(n, function (t) {
            var n = t.properties.weight, r = void 0 === n || null === n ? 1 : n;
            if (r = Number(r), !x(r)) throw new Error("weight value must be a number");
            if (r > 0) {
                f += 1;
                var i = r * jt(t, e);
                0 === i && (i = 1);
                var s = r / i;
                o += t.geometry.coordinates[0] * s, u += t.geometry.coordinates[1] * s, a += s
            }
        }), f < 1) throw new Error("no features to measure");
        var l = o / a, c = u / a;
        return 1 === f || 0 === i || Math.abs(l - t[0]) < s && Math.abs(c - t[1]) < s ? r([l, c], {medianCandidates: n.properties.medianCandidates}) : (n.properties.medianCandidates.push([l, c]), vs([l, c], e, n, i - 1))
    }

    function ms(e, t) {
        return {x: e[0] - t[0], y: e[1] - t[1]}
    }

    function gs(e) {
        if (T(e) && (e = e.bbox), e && !Array.isArray(e)) throw new Error("bbox is invalid");
        return e ? function (e) {
            return [Math.random() * (e[2] - e[0]) + e[0], Math.random() * (e[3] - e[1]) + e[1]]
        }(e) : [360 * Es(), 180 * Es()]
    }

    function ys(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.bbox;
        void 0 !== e && null !== e || (e = 1);
        for (var i = [], s = 0; s < e; s++) i.push(r(gs(n)));
        return f(i)
    }

    function bs(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.bbox, r = t.num_vertices, i = t.max_radial_length;
        void 0 !== e && null !== e || (e = 1), x(r) || (r = 10), x(i) || (i = 10);
        for (var o = [], u = 0; u < e; u++) {
            var a = [], l = Array.apply(null, new Array(r + 1)).map(Math.random);
            l.forEach(function (e, t, n) {
                n[t] = t > 0 ? e + n[t - 1] : e
            }), l.forEach(function (e) {
                e = 2 * e * Math.PI / l[l.length - 1];
                var t = Math.random();
                a.push([t * i * Math.sin(e), t * i * Math.cos(e)])
            }), a[a.length - 1] = a[0], a = a.map(function (e) {
                return function (t) {
                    return [t[0] + e[0], t[1] + e[1]]
                }
            }(gs(n))), o.push(s([a]))
        }
        return f(o)
    }

    function ws(e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.bbox, r = t.num_vertices, i = t.max_length, s = t.max_rotation;
        void 0 !== e && null !== e || (e = 1), (!x(r) || r < 2) && (r = 10), x(i) || (i = 1e-4), x(s) || (s = Math.PI / 8);
        for (var o = [], a = 0; a < e; a++) {
            for (var l = [gs(n)], c = 0; c < r - 1; c++) {
                var h = (0 === c ? 2 * Math.random() * Math.PI : Math.tan((l[c][1] - l[c - 1][1]) / (l[c][0] - l[c - 1][0]))) + (Math.random() - .5) * s * 2,
                    p = Math.random() * i;
                l.push([l[c][0] + p * Math.cos(h), l[c][1] + p * Math.sin(h)])
            }
            o.push(u(l))
        }
        return f(o)
    }

    function Es() {
        return Math.random() - .5
    }

    function Ss(e, t) {
        if (!e) throw new Error("geojson is required");
        if ("FeatureCollection" !== e.type) throw new Error("geojson must be a FeatureCollection");
        if (void 0 === t || null === t) throw new Error("filter is required");
        var n = [];
        return M(e, function (e) {
            Cs(e.properties, t) && n.push(e)
        }), f(n)
    }

    function xs(e, t, n) {
        if (!e) throw new Error("geojson is required");
        if ("FeatureCollection" !== e.type) throw new Error("geojson must be a FeatureCollection");
        if (void 0 === t || null === t) throw new Error("property is required");
        for (var r = Ns(e, t), i = Object.keys(r), s = 0; s < i.length; s++) {
            for (var o = i[s], u = r[o], a = [], l = 0; l < u.length; l++) a.push(e.features[u[l]]);
            n(f(a), o, s)
        }
    }

    function Ts(e, t, n, r) {
        var i = r;
        return xs(e, t, function (e, t, s) {
            i = 0 === s && void 0 === r ? e : n(i, e, t, s)
        }), i
    }

    function Ns(e, t) {
        var n = {};
        return M(e, function (e, r) {
            var i = e.properties || {};
            if (i.hasOwnProperty(t)) {
                var s = i[t];
                n.hasOwnProperty(s) ? n[s].push(r) : n[s] = [r]
            }
        }), n
    }

    function Cs(e, t) {
        if (void 0 === e) return !1;
        var n = typeof t;
        if ("number" === n || "string" === n) return e.hasOwnProperty(t);
        if (Array.isArray(t)) {
            for (var r = 0; r < t.length; r++) if (!Cs(e, t[r])) return !1;
            return !0
        }
        return ks(e, t)
    }

    function ks(e, t) {
        for (var n = Object.keys(t), r = 0; r < n.length; r++) {
            var i = n[r];
            if (e[i] !== t[i]) return !1
        }
        return !0
    }

    function Ls(e, t) {
        if (!t) return {};
        if (!t.length) return {};
        for (var n = {}, r = 0; r < t.length; r++) {
            var i = t[r];
            e.hasOwnProperty(i) && (n[i] = e[i])
        }
        return n
    }

    function As() {
    }

    function Os(e) {
        this.message = e || ""
    }

    function Ms(e) {
        this.message = e || ""
    }

    function _s() {
    }

    function Ds(e) {
        return null === e ? Hl : e.color
    }

    function Ps(e) {
        return null === e ? null : e.parent
    }

    function Hs(e, t) {
        null !== e && (e.color = t)
    }

    function Bs(e) {
        return null === e ? null : e.left
    }

    function js(e) {
        return null === e ? null : e.right
    }

    function Fs() {
        this.root_ = null, this.size_ = 0
    }

    function Is() {
    }

    function qs() {
        this.array_ = [], arguments[0] instanceof wl && this.addAll(arguments[0])
    }

    function Rs() {
    }

    function Us(e) {
        this.message = e || ""
    }

    function zs() {
        this.array_ = []
    }

    function Ws(e) {
        switch (e.type) {
            case"Polygon":
                return yr(e) > 1 ? e : null;
            case"MultiPolygon":
                var t = [];
                if (B(e, function (e) {
                    yr(e) > 1 && t.push(e.geometry.coordinates)
                }), t.length) return {type: "MultiPolygon", coordinates: t}
        }
    }

    function Xs() {
        this.reset()
    }

    function Vs(e, t, n) {
        var r = e.s = t + n, i = r - t, s = r - i;
        e.t = t - s + (n - i)
    }

    function $s(e) {
        return e > 1 ? qd : e < -1 ? -qd : Math.asin(e)
    }

    function Js() {
    }

    function Ks(e, t) {
        e && tv.hasOwnProperty(e.type) && tv[e.type](e, t)
    }

    function Qs(e, t, n) {
        var r, i = -1, s = e.length - n;
        for (t.lineStart(); ++i < s;) r = e[i], t.point(r[0], r[1], r[2]);
        t.lineEnd()
    }

    function Gs(e, t) {
        var n = -1, r = e.length;
        for (t.polygonStart(); ++n < r;) Qs(e[n], t, 1);
        t.polygonEnd()
    }

    function Ys(e) {
        return [$d(e[1], e[0]), $s(e[2])]
    }

    function Zs(e) {
        var t = e[0], n = e[1], r = Jd(n);
        return [r * Jd(t), r * Gd(t), Gd(n)]
    }

    function eo(e, t) {
        return e[0] * t[0] + e[1] * t[1] + e[2] * t[2]
    }

    function to(e, t) {
        return [e[1] * t[2] - e[2] * t[1], e[2] * t[0] - e[0] * t[2], e[0] * t[1] - e[1] * t[0]]
    }

    function no(e, t) {
        e[0] += t[0], e[1] += t[1], e[2] += t[2]
    }

    function ro(e, t) {
        return [e[0] * t, e[1] * t, e[2] * t]
    }

    function io(e) {
        var t = Yd(e[0] * e[0] + e[1] * e[1] + e[2] * e[2]);
        e[0] /= t, e[1] /= t, e[2] /= t
    }

    function so(e, t) {
        return [e > Id ? e - Ud : e < -Id ? e + Ud : e, t]
    }

    function oo(e, t, n) {
        return (e %= Ud) ? t || n ? rv(ao(e), fo(t, n)) : ao(e) : t || n ? fo(t, n) : so
    }

    function uo(e) {
        return function (t, n) {
            return t += e, [t > Id ? t - Ud : t < -Id ? t + Ud : t, n]
        }
    }

    function ao(e) {
        var t = uo(e);
        return t.invert = uo(-e), t
    }

    function fo(e, t) {
        function n(e, t) {
            var n = Jd(t), u = Jd(e) * n, a = Gd(e) * n, f = Gd(t), l = f * r + u * i;
            return [$d(a * s - l * o, u * r - f * i), $s(l * s + a * o)]
        }

        var r = Jd(e), i = Gd(e), s = Jd(t), o = Gd(t);
        return n.invert = function (e, t) {
            var n = Jd(t), u = Jd(e) * n, a = Gd(e) * n, f = Gd(t), l = f * s - a * o;
            return [$d(a * s + f * o, u * r + l * i), $s(l * r - u * i)]
        }, n
    }

    function lo(e, t) {
        (t = Zs(t))[0] -= e, io(t);
        var n = function (e) {
            return e > 1 ? 0 : e < -1 ? Id : Math.acos(e)
        }(-t[1]);
        return ((-t[2] < 0 ? -n : n) + Ud - Fd) % Ud
    }

    function co(e, t, n, r) {
        this.x = e, this.z = t, this.o = n, this.e = r, this.v = !1, this.n = this.p = null
    }

    function ho(e) {
        if (t = e.length) {
            for (var t, n, r = 0, i = e[0]; ++r < t;) i.n = n = e[r], n.p = i, i = n;
            i.n = n = e[0], n.p = i
        }
    }

    function po(e, t, n, r) {
        function i(i, s) {
            return e <= i && i <= n && t <= s && s <= r
        }

        function s(i, s, u, f) {
            var l = 0, c = 0;
            if (null == i || (l = o(i, u)) !== (c = o(s, u)) || a(i, s) < 0 ^ u > 0) {
                do f.point(0 === l || 3 === l ? e : n, l > 1 ? r : t); while ((l = (l + u + 4) % 4) !== c)
            } else f.point(s[0], s[1])
        }

        function o(r, i) {
            return Xd(r[0] - e) < Fd ? i > 0 ? 0 : 3 : Xd(r[0] - n) < Fd ? i > 0 ? 2 : 1 : Xd(r[1] - t) < Fd ? i > 0 ? 1 : 0 : i > 0 ? 3 : 2
        }

        function u(e, t) {
            return a(e.x, t.x)
        }

        function a(e, t) {
            var n = o(e, 1), r = o(t, 1);
            return n !== r ? n - r : 0 === n ? t[1] - e[1] : 1 === n ? e[0] - t[0] : 2 === n ? e[1] - t[1] : t[0] - e[0]
        }

        return function (o) {
            function a(e, t) {
                i(e, t) && E.point(e, t)
            }

            function f(s, o) {
                var u = i(s, o);
                if (c && h.push([s, o]), b) p = s, d = o, v = u, b = !1, u && (E.lineStart(), E.point(s, o)); else if (u && y) E.point(s, o); else {
                    var a = [m = Math.max(hv, Math.min(cv, m)), g = Math.max(hv, Math.min(cv, g))],
                        f = [s = Math.max(hv, Math.min(cv, s)), o = Math.max(hv, Math.min(cv, o))];
                    ov(a, f, e, t, n, r) ? (y || (E.lineStart(), E.point(a[0], a[1])), E.point(f[0], f[1]), u || E.lineEnd(), w = !1) : u && (E.lineStart(), E.point(s, o), w = !1)
                }
                m = s, g = o, y = u
            }

            var l, c, h, p, d, v, m, g, y, b, w, E = o, S = sv(), x = {
                point: a, lineStart: function () {
                    x.point = f, c && c.push(h = []), b = !0, y = !1, m = g = NaN
                }, lineEnd: function () {
                    l && (f(p, d), v && y && S.rejoin(), l.push(S.result())), x.point = a, y && E.lineEnd()
                }, polygonStart: function () {
                    E = S, l = [], c = [], w = !0
                }, polygonEnd: function () {
                    var t = function () {
                        for (var t = 0, n = 0, i = c.length; n < i; ++n) for (var s, o, u = c[n], a = 1, f = u.length, l = u[0], h = l[0], p = l[1]; a < f; ++a) s = h, o = p, h = (l = u[a])[0], p = l[1], o <= r ? p > r && (h - s) * (r - o) > (p - o) * (e - s) && ++t : p <= r && (h - s) * (r - o) < (p - o) * (e - s) && --t;
                        return t
                    }(), n = w && t, i = (l = lv(l)).length;
                    (n || i) && (o.polygonStart(), n && (o.lineStart(), s(null, null, 1, o), o.lineEnd()), i && av(l, u, t, s, o), o.polygonEnd()), E = o, l = c = h = null
                }
            };
            return x
        }
    }

    function vo(e) {
        return e.length > 1
    }

    function mo(e, t) {
        return ((e = e.x)[0] < 0 ? e[1] - qd - Fd : qd - e[1]) - ((t = t.x)[0] < 0 ? t[1] - qd - Fd : qd - t[1])
    }

    function go(e) {
        return function (t) {
            var n = new yo;
            for (var r in e) n[r] = e[r];
            return n.stream = t, n
        }
    }

    function yo() {
    }

    function bo(e, t, n) {
        var r = t[1][0] - t[0][0], i = t[1][1] - t[0][1], s = e.clipExtent && e.clipExtent();
        e.scale(150).translate([0, 0]), null != s && e.clipExtent(null), nv(n, e.stream(bv));
        var o = bv.result(), u = Math.min(r / (o[1][0] - o[0][0]), i / (o[1][1] - o[0][1])),
            a = +t[0][0] + (r - u * (o[1][0] + o[0][0])) / 2, f = +t[0][1] + (i - u * (o[1][1] + o[0][1])) / 2;
        return null != s && e.clipExtent(s), e.scale(150 * u).translate([a, f])
    }

    function wo(e) {
        return function (e) {
            function t(e) {
                return e = f(e[0] * Wd, e[1] * Wd), [e[0] * v + o, u - e[1] * v]
            }

            function n(e, t) {
                return e = s(e, t), [e[0] * v + o, u - e[1] * v]
            }

            function r() {
                f = rv(a = oo(w, E, S), s);
                var e = s(y, b);
                return o = m - e[0] * v, u = g + e[1] * v, i()
            }

            function i() {
                return p = d = null, t
            }

            var s, o, u, a, f, l, c, h, p, d, v = 150, m = 480, g = 250, y = 0, b = 0, w = 0, E = 0, S = 0, x = null,
                T = Ev, N = null, C = dv, k = .5, L = Nv(n, k);
            return t.stream = function (e) {
                return p && d === e ? p : p = Cv(T(a, L(C(d = e))))
            }, t.clipAngle = function (e) {
                return arguments.length ? (T = +e ? Sv(x = e * Wd, 6 * Wd) : (x = null, Ev), i()) : x * zd
            }, t.clipExtent = function (e) {
                return arguments.length ? (C = null == e ? (N = l = c = h = null, dv) : po(N = +e[0][0], l = +e[0][1], c = +e[1][0], h = +e[1][1]), i()) : null == N ? null : [[N, l], [c, h]]
            }, t.scale = function (e) {
                return arguments.length ? (v = +e, r()) : v
            }, t.translate = function (e) {
                return arguments.length ? (m = +e[0], g = +e[1], r()) : [m, g]
            }, t.center = function (e) {
                return arguments.length ? (y = e[0] % 360 * Wd, b = e[1] % 360 * Wd, r()) : [y * zd, b * zd]
            }, t.rotate = function (e) {
                return arguments.length ? (w = e[0] % 360 * Wd, E = e[1] % 360 * Wd, S = e.length > 2 ? e[2] % 360 * Wd : 0, r()) : [w * zd, E * zd, S * zd]
            }, t.precision = function (e) {
                return arguments.length ? (L = Nv(n, k = e * e), i()) : Yd(k)
            }, t.fitExtent = function (e, n) {
                return bo(t, e, n)
            }, t.fitSize = function (e, n) {
                return function (e, t, n) {
                    return bo(e, [[0, 0], t], n)
                }(t, e, n)
            }, function () {
                return s = e.apply(this, arguments), t.invert = s.invert && function (e) {
                    return (e = f.invert((e[0] - o) / v, (u - e[1]) / v)) && [e[0] * zd, e[1] * zd]
                }, r()
            }
        }(function () {
            return e
        })()
    }

    function Eo(e, t) {
        return [e, Qd(Zd((qd + t) / 2))]
    }

    function So(e, t) {
        return [Qd(Zd((qd + t) / 2)), -e]
    }

    function xo(e, n, r, i) {
        var s = e.properties || {}, o = "Feature" === e.type ? e.geometry : e;
        if ("GeometryCollection" === o.type) {
            var u = [];
            return P(e, function (e) {
                var t = xo(e, n, r, i);
                t && u.push(t)
            }), f(u)
        }
        var a, l = U(e), c = l[1] > 50 && l[3] > 50;
        a = c ? {type: o.type, coordinates: No(o.coordinates, ko(o))} : fr(o);
        var h = (new Tc).read(a), p = v(m(n, r), "meters"), d = vp.bufferOp(h, p);
        if (d = (new Nc).write(d), !To(d.coordinates)) {
            var g;
            return (g = c ? {type: d.type, coordinates: Co(d.coordinates, ko(o))} : lr(d)).geometry ? g : t(g, s)
        }
    }

    function To(e) {
        return Array.isArray(e[0]) ? To(e[0]) : isNaN(e[0])
    }

    function No(e, t) {
        return "object" != typeof e[0] ? t(e) : e.map(function (e) {
            return No(e, t)
        })
    }

    function Co(e, t) {
        return "object" != typeof e[0] ? t.invert(e) : e.map(function (e) {
            return Co(e, t)
        })
    }

    function ko(e) {
        var t = mn(e).geometry.coordinates.reverse(), n = t.map(function (e) {
            return -e
        });
        return kv().center(t).rotate(n).scale(Bo)
    }

    function Lo() {
        for (var e = new Tc, t = e.read(JSON.stringify(arguments[0].geometry)), n = 1; n < arguments.length; n++) t = Hd.union(t, e.read(JSON.stringify(arguments[n].geometry)));
        return t = (new Nc).write(t), {type: "Feature", geometry: t, properties: arguments[0].properties}
    }

    function Ao(e, n) {
        var r = K(e), i = K(n);
        if (en(Or(i, {precision: 4})).coordinates[0].length < 4) return null;
        if (en(Or(r, {precision: 4})).coordinates[0].length < 4) return null;
        var s = new Tc, o = s.read(Or(r)), u = s.read(Or(i)), a = Cd.intersection(o, u);
        return a.isEmpty() ? null : t((new Nc).write(a))
    }

    function Oo(e, t) {
        return function (e, t, n) {
            var r, i;
            if (!Array.isArray(t)) throw new Error("Get closest expects an array as second argument");
            return t.forEach(function (t, s) {
                var o = n(t, e);
                o >= 0 && (void 0 === i || o < i) && (i = o, r = s)
            }), r
        }(e, t, function (e, t) {
            return e - t
        })
    }

    function Mo(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.properties || {}, i = n.triangles, o = n.mask;
        if (null === t || void 0 === t) throw new Error("cellSide is required");
        if (!x(t)) throw new Error("cellSide is invalid");
        if (!e) throw new Error("bbox is required");
        if (!Array.isArray(e)) throw new Error("bbox must be array");
        if (4 !== e.length) throw new Error("bbox must contain 4 numbers");
        if (o && -1 === ["Polygon", "MultiPolygon"].indexOf(G(o))) throw new Error("options.mask must be a (Multi)Polygon");
        var u = e[0], a = e[1], l = e[2], c = e[3], h = (a + c) / 2, p = (u + l) / 2,
            d = 2 * t / jt([u, h], [l, h], n) * (l - u), v = 2 * t / jt([p, a], [p, c], n) * (c - a), m = d / 2,
            g = 2 * m, y = Math.sqrt(3) / 2 * v, b = l - u, w = c - a, E = .75 * g, S = y, N = (b - g) / (g - m / 2),
            C = Math.floor(N), k = (C * E - m / 2 - b) / 2 - m / 2 + E / 2, L = Math.floor((w - y) / y),
            A = (w - L * y) / 2, O = L * y - w > y / 2;
        O && (A -= y / 4);
        for (var M = [], _ = [], D = 0; D < 6; D++) {
            var P = 2 * Math.PI / 6 * D;
            M.push(Math.cos(P)), _.push(Math.sin(P))
        }
        for (var H = [], B = 0; B <= C; B++) for (var j = 0; j <= L; j++) {
            var F = B % 2 == 1;
            if ((0 !== j || !F) && (0 !== j || !O)) {
                var I = B * E + u - k, q = j * S + a + A;
                if (F && (q -= y / 2), !0 === i) (function (e, t, n, r, i, o) {
                    for (var u = [], a = 0; a < 6; a++) {
                        var f = [];
                        f.push(e), f.push([e[0] + t * i[a], e[1] + n * o[a]]), f.push([e[0] + t * i[(a + 1) % 6], e[1] + n * o[(a + 1) % 6]]), f.push(e), u.push(s([f], r))
                    }
                    return u
                })([I, q], d / 2, v / 2, r, M, _).forEach(function (e) {
                    o ? Ao(o, e) && H.push(e) : H.push(e)
                }); else {
                    var R = function (e, t, n, r, i, o) {
                        for (var u = [], a = 0; a < 6; a++) {
                            var f = e[0] + t * i[a], l = e[1] + n * o[a];
                            u.push([f, l])
                        }
                        return u.push(u[0].slice()), s([u], r)
                    }([I, q], d / 2, v / 2, r, M, _);
                    o ? Ao(o, R) && H.push(R) : H.push(R)
                }
            }
        }
        return f(H)
    }

    function _o(e) {
        if (e.features.length <= 1) return e;
        var t = function (e) {
            var t = Vo(), n = [];
            return B(e, function (e, t) {
                var r = U(e);
                n.push({minX: r[0], minY: r[1], maxX: r[2], maxY: r[3], geojson: e, index: t})
            }), t.load(n), t
        }(e), n = [], r = {};
        return B(e, function (e, i) {
            if (r[i]) return !0;
            for (t.remove({index: i}, Do), r[i] = !0; ;) {
                var s = U(e), o = t.search({minX: s[0], minY: s[1], maxX: s[2], maxY: s[3]});
                if (o.length > 0) {
                    var u = o.map(function (e) {
                        return r[e.index] = !0, t.remove({index: e.index}, Do), e.geojson
                    });
                    u.push(e), e = Lo.apply(this, u)
                }
                if (0 === o.length) break
            }
            n.push(e)
        }), f(n)
    }

    function Do(e, t) {
        return e.index === t.index
    }

    function Po(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.properties, i = n.mask, o = [];
        if (null === t || void 0 === t) throw new Error("cellSide is required");
        if (!x(t)) throw new Error("cellSide is invalid");
        if (!e) throw new Error("bbox is required");
        if (!Array.isArray(e)) throw new Error("bbox must be array");
        if (4 !== e.length) throw new Error("bbox must contain 4 numbers");
        if (i && -1 === ["Polygon", "MultiPolygon"].indexOf(G(i))) throw new Error("options.mask must be a (Multi)Polygon");
        for (var u = e[0], a = e[1], l = e[2], c = e[3], h = t / jt([u, a], [l, a], n) * (l - u), p = t / jt([u, a], [u, c], n) * (c - a), d = l - u, v = c - a, m = Math.floor(d / h), g = Math.floor(v / p), y = (v - g * p) / 2, b = u + (d - m * h) / 2, w = 0; w < m; w++) {
            for (var E = a + y, S = 0; S < g; S++) {
                var N = s([[[b, E], [b, E + p], [b + h, E + p], [b + h, E], [b, E]]], r);
                i ? Ao(i, N) && o.push(N) : o.push(N), E += p
            }
            b += h
        }
        return f(o)
    }

    function Ho(e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.properties, i = n.mask, o = [];
        if (null === t || void 0 === t) throw new Error("cellSide is required");
        if (!x(t)) throw new Error("cellSide is invalid");
        if (!e) throw new Error("bbox is required");
        if (!Array.isArray(e)) throw new Error("bbox must be array");
        if (4 !== e.length) throw new Error("bbox must contain 4 numbers");
        if (i && -1 === ["Polygon", "MultiPolygon"].indexOf(G(i))) throw new Error("options.mask must be a (Multi)Polygon");
        for (var u = t / jt([e[0], e[1]], [e[2], e[1]], n) * (e[2] - e[0]), a = t / jt([e[0], e[1]], [e[0], e[3]], n) * (e[3] - e[1]), l = 0, c = e[0]; c <= e[2];) {
            for (var h = 0, p = e[1]; p <= e[3];) {
                var d = null, v = null;
                l % 2 == 0 && h % 2 == 0 ? (d = s([[[c, p], [c, p + a], [c + u, p], [c, p]]], r), v = s([[[c, p + a], [c + u, p + a], [c + u, p], [c, p + a]]], r)) : l % 2 == 0 && h % 2 == 1 ? (d = s([[[c, p], [c + u, p + a], [c + u, p], [c, p]]], r), v = s([[[c, p], [c, p + a], [c + u, p + a], [c, p]]], r)) : h % 2 == 0 && l % 2 == 1 ? (d = s([[[c, p], [c, p + a], [c + u, p + a], [c, p]]], r), v = s([[[c, p], [c + u, p + a], [c + u, p], [c, p]]], r)) : h % 2 == 1 && l % 2 == 1 && (d = s([[[c, p], [c, p + a], [c + u, p], [c, p]]], r), v = s([[[c, p + a], [c + u, p + a], [c + u, p], [c, p + a]]], r)), i ? (Ao(i, d) && o.push(d), Ao(i, v) && o.push(v)) : (o.push(d), o.push(v)), p += a, h++
            }
            l++, c += u
        }
        return f(o)
    }

    var Bo = 6371008.8, jo = {
        meters: Bo,
        metres: Bo,
        millimeters: 1e3 * Bo,
        millimetres: 1e3 * Bo,
        centimeters: 100 * Bo,
        centimetres: 100 * Bo,
        kilometers: Bo / 1e3,
        kilometres: Bo / 1e3,
        miles: Bo / 1609.344,
        nauticalmiles: Bo / 1852,
        inches: 39.37 * Bo,
        yards: Bo / 1.0936,
        feet: 3.28084 * Bo,
        radians: 1,
        degrees: Bo / 111325
    }, Fo = {
        meters: 1,
        metres: 1,
        millimeters: 1e3,
        millimetres: 1e3,
        centimeters: 100,
        centimetres: 100,
        kilometers: .001,
        kilometres: .001,
        miles: 1 / 1609.344,
        nauticalmiles: 1 / 1852,
        inches: 39.37,
        yards: 1 / 1.0936,
        feet: 3.28084,
        radians: 1 / Bo,
        degrees: 1 / 111325
    }, Io = {
        meters: 1,
        metres: 1,
        millimeters: 1e6,
        millimetres: 1e6,
        centimeters: 1e4,
        centimetres: 1e4,
        kilometers: 1e-6,
        kilometres: 1e-6,
        acres: 247105e-9,
        miles: 3.86e-7,
        yards: 1.195990046,
        feet: 10.763910417,
        inches: 1550.003100006
    }, qo = Object.freeze({
        earthRadius: Bo,
        factors: jo,
        unitsFactors: Fo,
        areaFactors: Io,
        feature: t,
        geometry: n,
        point: r,
        points: i,
        polygon: s,
        polygons: o,
        lineString: u,
        lineStrings: a,
        featureCollection: f,
        multiLineString: l,
        multiPoint: c,
        multiPolygon: h,
        geometryCollection: p,
        round: d,
        radiansToLength: v,
        lengthToRadians: m,
        lengthToDegrees: g,
        bearingToAzimuth: y,
        radiansToDegrees: b,
        degreesToRadians: w,
        convertLength: E,
        convertArea: S,
        isNumber: x,
        isObject: T,
        validateBBox: N,
        validateId: C,
        radians2degrees: function () {
            throw new Error("method has been renamed to `radiansToDegrees`")
        },
        degrees2radians: function () {
            throw new Error("method has been renamed to `degreesToRadians`")
        },
        distanceToDegrees: function () {
            throw new Error("method has been renamed to `lengthToDegrees`")
        },
        distanceToRadians: function () {
            throw new Error("method has been renamed to `lengthToRadians`")
        },
        radiansToDistance: function () {
            throw new Error("method has been renamed to `radiansToLength`")
        },
        bearingToAngle: function () {
            throw new Error("method has been renamed to `bearingToAzimuth`")
        },
        convertDistance: function () {
            throw new Error("method has been renamed to `convertLength`")
        }
    }), Ro = Object.freeze({
        coordEach: k,
        coordReduce: L,
        propEach: A,
        propReduce: O,
        featureEach: M,
        featureReduce: _,
        coordAll: D,
        geomEach: P,
        geomReduce: H,
        flattenEach: B,
        flattenReduce: j,
        segmentEach: F,
        segmentReduce: I,
        lineEach: q,
        lineReduce: R
    }), Uo = Object.freeze({
        getCoord: z,
        getCoords: W,
        containsNumber: X,
        geojsonType: V,
        featureOf: $,
        collectionOf: J,
        getGeom: K,
        getGeomType: Q,
        getType: G
    }), zo = {successCallback: null, verbose: !1}, Wo = {}, Xo = it, Vo = ot;
    ot.prototype = {
        all: function () {
            return this._all(this.data, [])
        }, search: function (e) {
            var t = this.data, n = [], r = this.toBBox;
            if (!vt(e, t)) return n;
            for (var i, s, o, u, a = []; t;) {
                for (i = 0, s = t.children.length; i < s; i++) o = t.children[i], vt(e, u = t.leaf ? r(o) : o) && (t.leaf ? n.push(o) : dt(e, u) ? this._all(o, n) : a.push(o));
                t = a.pop()
            }
            return n
        }, collides: function (e) {
            var t = this.data, n = this.toBBox;
            if (!vt(e, t)) return !1;
            for (var r, i, s, o, u = []; t;) {
                for (r = 0, i = t.children.length; r < i; r++) if (s = t.children[r], o = t.leaf ? n(s) : s, vt(e, o)) {
                    if (t.leaf || dt(e, o)) return !0;
                    u.push(s)
                }
                t = u.pop()
            }
            return !1
        }, load: function (e) {
            if (!e || !e.length) return this;
            if (e.length < this._minEntries) {
                for (var t = 0, n = e.length; t < n; t++) this.insert(e[t]);
                return this
            }
            var r = this._build(e.slice(), 0, e.length - 1, 0);
            if (this.data.children.length) if (this.data.height === r.height) this._splitRoot(this.data, r); else {
                if (this.data.height < r.height) {
                    var i = this.data;
                    this.data = r, r = i
                }
                this._insert(r, this.data.height - r.height - 1, !0)
            } else this.data = r;
            return this
        }, insert: function (e) {
            return e && this._insert(e, this.data.height - 1), this
        }, clear: function () {
            return this.data = mt([]), this
        }, remove: function (e, t) {
            if (!e) return this;
            for (var n, r, i, s, o = this.data, u = this.toBBox(e), a = [], f = []; o || a.length;) {
                if (o || (o = a.pop(), r = a[a.length - 1], n = f.pop(), s = !0), o.leaf && -1 !== (i = function (e, t, n) {
                    if (!n) return t.indexOf(e);
                    for (var r = 0; r < t.length; r++) if (n(e, t[r])) return r;
                    return -1
                }(e, o.children, t))) return o.children.splice(i, 1), a.push(o), this._condense(a), this;
                s || o.leaf || !dt(o, u) ? r ? (n++, o = r.children[n], s = !1) : o = null : (a.push(o), f.push(n), n = 0, r = o, o = o.children[0])
            }
            return this
        }, toBBox: function (e) {
            return e
        }, compareMinX: lt, compareMinY: ct, toJSON: function () {
            return this.data
        }, fromJSON: function (e) {
            return this.data = e, this
        }, _all: function (e, t) {
            for (var n = []; e;) e.leaf ? t.push.apply(t, e.children) : n.push.apply(n, e.children), e = n.pop();
            return t
        }, _build: function (e, t, n, r) {
            var i, s = n - t + 1, o = this._maxEntries;
            if (s <= o) return i = mt(e.slice(t, n + 1)), ut(i, this.toBBox), i;
            r || (r = Math.ceil(Math.log(s) / Math.log(o)), o = Math.ceil(s / Math.pow(o, r - 1))), (i = mt([])).leaf = !1, i.height = r;
            var u, a, f, l, c = Math.ceil(s / o), h = c * Math.ceil(Math.sqrt(o));
            for (gt(e, t, n, h, this.compareMinX), u = t; u <= n; u += h) for (gt(e, u, f = Math.min(u + h - 1, n), c, this.compareMinY), a = u; a <= f; a += c) l = Math.min(a + c - 1, f), i.children.push(this._build(e, a, l, r - 1));
            return ut(i, this.toBBox), i
        }, _chooseSubtree: function (e, t, n, r) {
            for (var i, s, o, u, a, f, l, c; r.push(t), !t.leaf && r.length - 1 !== n;) {
                for (l = c = 1 / 0, i = 0, s = t.children.length; i < s; i++) a = ht(o = t.children[i]), (f = function (e, t) {
                    return (Math.max(t.maxX, e.maxX) - Math.min(t.minX, e.minX)) * (Math.max(t.maxY, e.maxY) - Math.min(t.minY, e.minY))
                }(e, o) - a) < c ? (c = f, l = a < l ? a : l, u = o) : f === c && a < l && (l = a, u = o);
                t = u || t.children[0]
            }
            return t
        }, _insert: function (e, t, n) {
            var r = this.toBBox, i = n ? e : r(e), s = [], o = this._chooseSubtree(i, this.data, t, s);
            for (o.children.push(e), ft(o, i); t >= 0 && s[t].children.length > this._maxEntries;) this._split(s, t), t--;
            this._adjustParentBBoxes(i, s, t)
        }, _split: function (e, t) {
            var n = e[t], r = n.children.length, i = this._minEntries;
            this._chooseSplitAxis(n, i, r);
            var s = this._chooseSplitIndex(n, i, r), o = mt(n.children.splice(s, n.children.length - s));
            o.height = n.height, o.leaf = n.leaf, ut(n, this.toBBox), ut(o, this.toBBox), t ? e[t - 1].children.push(o) : this._splitRoot(n, o)
        }, _splitRoot: function (e, t) {
            this.data = mt([e, t]), this.data.height = e.height + 1, this.data.leaf = !1, ut(this.data, this.toBBox)
        }, _chooseSplitIndex: function (e, t, n) {
            var r, i, s, o, u, a, f, l;
            for (a = f = 1 / 0, r = t; r <= n - t; r++) o = function (e, t) {
                var n = Math.max(e.minX, t.minX), r = Math.max(e.minY, t.minY), i = Math.min(e.maxX, t.maxX),
                    s = Math.min(e.maxY, t.maxY);
                return Math.max(0, i - n) * Math.max(0, s - r)
            }(i = at(e, 0, r, this.toBBox), s = at(e, r, n, this.toBBox)), u = ht(i) + ht(s), o < a ? (a = o, l = r, f = u < f ? u : f) : o === a && u < f && (f = u, l = r);
            return l
        }, _chooseSplitAxis: function (e, t, n) {
            var r = e.leaf ? this.compareMinX : lt, i = e.leaf ? this.compareMinY : ct;
            this._allDistMargin(e, t, n, r) < this._allDistMargin(e, t, n, i) && e.children.sort(r)
        }, _allDistMargin: function (e, t, n, r) {
            e.children.sort(r);
            var i, s, o = this.toBBox, u = at(e, 0, t, o), a = at(e, n - t, n, o), f = pt(u) + pt(a);
            for (i = t; i < n - t; i++) s = e.children[i], ft(u, e.leaf ? o(s) : s), f += pt(u);
            for (i = n - t - 1; i >= t; i--) s = e.children[i], ft(a, e.leaf ? o(s) : s), f += pt(a);
            return f
        }, _adjustParentBBoxes: function (e, t, n) {
            for (var r = n; r >= 0; r--) ft(t[r], e)
        }, _condense: function (e) {
            for (var t, n = e.length - 1; n >= 0; n--) 0 === e[n].children.length ? n > 0 ? (t = e[n - 1].children).splice(t.indexOf(e[n]), 1) : this.clear() : ut(e[n], this.toBBox)
        }, _initFormat: function (e) {
            var t = ["return a", " - b", ";"];
            this.compareMinX = new Function("a", "b", t.join(e[0])), this.compareMinY = new Function("a", "b", t.join(e[1])), this.toBBox = new Function("a", "return {minX: a" + e[0] + ", minY: a" + e[1] + ", maxX: a" + e[2] + ", maxY: a" + e[3] + "};")
        }
    };
    var $o = function (e, t, n) {
        var r = e * t, i = Jo * e, s = i - (i - e), o = e - s, u = Jo * t, a = u - (u - t), f = t - a,
            l = o * f - (r - s * a - o * a - s * f);
        return n ? (n[0] = l, n[1] = r, n) : [l, r]
    }, Jo = +(Math.pow(2, 27) + 1), Ko = function (e, t) {
        var n = 0 | e.length, r = 0 | t.length;
        if (1 === n && 1 === r) return function (e, t) {
            var n = e + t, r = n - e, i = e - (n - r) + (t - r);
            return i ? [i, n] : [n]
        }(e[0], t[0]);
        var i, s, o = n + r, u = new Array(o), a = 0, f = 0, l = 0, c = Math.abs, h = e[f], p = c(h), d = t[l],
            v = c(d);
        p < v ? (s = h, (f += 1) < n && (p = c(h = e[f]))) : (s = d, (l += 1) < r && (v = c(d = t[l]))), f < n && p < v || l >= r ? (i = h, (f += 1) < n && (p = c(h = e[f]))) : (i = d, (l += 1) < r && (v = c(d = t[l])));
        for (var m, g, y = i + s, b = y - i, w = s - b, E = w, S = y; f < n && l < r;) p < v ? (i = h, (f += 1) < n && (p = c(h = e[f]))) : (i = d, (l += 1) < r && (v = c(d = t[l]))), (w = (s = E) - (b = (y = i + s) - i)) && (u[a++] = w), E = S - ((m = S + y) - (g = m - S)) + (y - g), S = m;
        for (; f < n;) (w = (s = E) - (b = (y = (i = h) + s) - i)) && (u[a++] = w), E = S - ((m = S + y) - (g = m - S)) + (y - g), S = m, (f += 1) < n && (h = e[f]);
        for (; l < r;) (w = (s = E) - (b = (y = (i = d) + s) - i)) && (u[a++] = w), E = S - ((m = S + y) - (g = m - S)) + (y - g), S = m, (l += 1) < r && (d = t[l]);
        return E && (u[a++] = E), S && (u[a++] = S), a || (u[a++] = 0), u.length = a, u
    }, Qo = function (e, t, n) {
        var r = e + t, i = r - e, s = t - i, o = e - (r - i);
        return n ? (n[0] = o + s, n[1] = r, n) : [o + s, r]
    }, Go = function (e, t) {
        var n = e.length;
        if (1 === n) {
            var r = $o(e[0], t);
            return r[0] ? r : [r[1]]
        }
        var i = new Array(2 * n), s = [.1, .1], o = [.1, .1], u = 0;
        $o(e[0], t, s), s[0] && (i[u++] = s[0]);
        for (var a = 1; a < n; ++a) {
            $o(e[a], t, o);
            var f = s[1];
            Qo(f, o[0], s), s[0] && (i[u++] = s[0]);
            var l = o[1], c = s[1], h = l + c, p = c - (h - l);
            s[1] = h, p && (i[u++] = p)
        }
        return s[1] && (i[u++] = s[1]), 0 === u && (i[u++] = 0), i.length = u, i
    }, Yo = function (e, t) {
        var n = 0 | e.length, r = 0 | t.length;
        if (1 === n && 1 === r) return function (e, t) {
            var n = e + t, r = n - e, i = e - (n - r) + (t - r);
            return i ? [i, n] : [n]
        }(e[0], -t[0]);
        var i, s, o = n + r, u = new Array(o), a = 0, f = 0, l = 0, c = Math.abs, h = e[f], p = c(h), d = -t[l],
            v = c(d);
        p < v ? (s = h, (f += 1) < n && (p = c(h = e[f]))) : (s = d, (l += 1) < r && (v = c(d = -t[l]))), f < n && p < v || l >= r ? (i = h, (f += 1) < n && (p = c(h = e[f]))) : (i = d, (l += 1) < r && (v = c(d = -t[l])));
        for (var m, g, y = i + s, b = y - i, w = s - b, E = w, S = y; f < n && l < r;) p < v ? (i = h, (f += 1) < n && (p = c(h = e[f]))) : (i = d, (l += 1) < r && (v = c(d = -t[l]))), (w = (s = E) - (b = (y = i + s) - i)) && (u[a++] = w), E = S - ((m = S + y) - (g = m - S)) + (y - g), S = m;
        for (; f < n;) (w = (s = E) - (b = (y = (i = h) + s) - i)) && (u[a++] = w), E = S - ((m = S + y) - (g = m - S)) + (y - g), S = m, (f += 1) < n && (h = e[f]);
        for (; l < r;) (w = (s = E) - (b = (y = (i = d) + s) - i)) && (u[a++] = w), E = S - ((m = S + y) - (g = m - S)) + (y - g), S = m, (l += 1) < r && (d = -t[l]);
        return E && (u[a++] = E), S && (u[a++] = S), a || (u[a++] = 0), u.length = a, u
    }, Zo = yt(function (e) {
        function t(e, t) {
            for (var n = new Array(e.length - 1), r = 1; r < e.length; ++r) for (var i = n[r - 1] = new Array(e.length - 1), s = 0, o = 0; s < e.length; ++s) s !== t && (i[o++] = e[r][s]);
            return n
        }

        function n(e) {
            return 1 & e ? "-" : ""
        }

        function r(e) {
            if (1 === e.length) return e[0];
            if (2 === e.length) return ["sum(", e[0], ",", e[1], ")"].join("");
            var t = e.length >> 1;
            return ["sum(", r(e.slice(0, t)), ",", r(e.slice(t)), ")"].join("")
        }

        function i(e) {
            if (2 === e.length) return [["sum(prod(", e[0][0], ",", e[1][1], "),prod(-", e[0][1], ",", e[1][0], "))"].join("")];
            for (var s = [], o = 0; o < e.length; ++o) s.push(["scale(", r(i(t(e, o))), ",", n(o), e[0][o], ")"].join(""));
            return s
        }

        function s(e) {
            for (var n = [], s = [], o = function (e) {
                for (var t = new Array(e), n = 0; n < e; ++n) {
                    t[n] = new Array(e);
                    for (var r = 0; r < e; ++r) t[n][r] = ["m", r, "[", e - n - 1, "]"].join("")
                }
                return t
            }(e), u = [], a = 0; a < e; ++a) 0 == (1 & a) ? n.push.apply(n, i(t(o, a))) : s.push.apply(s, i(t(o, a))), u.push("m" + a);
            var f = r(n), l = r(s), c = "orientation" + e + "Exact",
                h = ["function ", c, "(", u.join(), "){var p=", f, ",n=", l, ",d=sub(p,n);return d[d.length-1];};return ", c].join("");
            return (new Function("sum", "prod", "scale", "sub", h))(Ko, $o, Go, Yo)
        }

        var o = 5, u = s(3), a = s(4), f = [function () {
            return 0
        }, function () {
            return 0
        }, function (e, t) {
            return t[0] - e[0]
        }, function (e, t, n) {
            var r, i = (e[1] - n[1]) * (t[0] - n[0]), s = (e[0] - n[0]) * (t[1] - n[1]), o = i - s;
            if (i > 0) {
                if (s <= 0) return o;
                r = i + s
            } else {
                if (!(i < 0)) return o;
                if (s >= 0) return o;
                r = -(i + s)
            }
            var a = 3.3306690738754716e-16 * r;
            return o >= a || o <= -a ? o : u(e, t, n)
        }, function (e, t, n, r) {
            var i = e[0] - r[0], s = t[0] - r[0], o = n[0] - r[0], u = e[1] - r[1], f = t[1] - r[1], l = n[1] - r[1],
                c = e[2] - r[2], h = t[2] - r[2], p = n[2] - r[2], d = s * l, v = o * f, m = o * u, g = i * l,
                y = i * f, b = s * u, w = c * (d - v) + h * (m - g) + p * (y - b),
                E = 7.771561172376103e-16 * ((Math.abs(d) + Math.abs(v)) * Math.abs(c) + (Math.abs(m) + Math.abs(g)) * Math.abs(h) + (Math.abs(y) + Math.abs(b)) * Math.abs(p));
            return w > E || -w > E ? w : a(e, t, n, r)
        }];
        !function () {
            for (; f.length <= o;) f.push(s(f.length));
            for (var t = [], n = ["slow"], r = 0; r <= o; ++r) t.push("a" + r), n.push("o" + r);
            var i = ["function getOrientation(", t.join(), "){switch(arguments.length){case 0:case 1:return 0;"];
            for (r = 2; r <= o; ++r) i.push("case ", r, ":return o", r, "(", t.slice(0, r).join(), ");");
            i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"), n.push(i.join(""));
            var u = Function.apply(void 0, n);
            for (e.exports = u.apply(void 0, [function (e) {
                var t = f[e.length];
                return t || (t = f[e.length] = s(e.length)), t.apply(void 0, e)
            }].concat(f)), r = 0; r <= o; ++r) e.exports[r] = f[r]
        }()
    }), eu = function (e) {
        var t = e.length;
        if (t < 3) {
            for (var n = new Array(t), r = 0; r < t; ++r) n[r] = r;
            return 2 === t && e[0][0] === e[1][0] && e[0][1] === e[1][1] ? [0] : n
        }
        var i = new Array(t);
        for (r = 0; r < t; ++r) i[r] = r;
        i.sort(function (t, n) {
            var r = e[t][0] - e[n][0];
            return r || e[t][1] - e[n][1]
        });
        var s = [i[0], i[1]], o = [i[0], i[1]];
        for (r = 2; r < t; ++r) {
            for (var u = i[r], a = e[u], f = s.length; f > 1 && tu(e[s[f - 2]], e[s[f - 1]], a) <= 0;) f -= 1, s.pop();
            for (s.push(u), f = o.length; f > 1 && tu(e[o[f - 2]], e[o[f - 1]], a) >= 0;) f -= 1, o.pop();
            o.push(u)
        }
        n = new Array(o.length + s.length - 2);
        for (var l = 0, c = (r = 0, s.length); r < c; ++r) n[l++] = s[r];
        for (var h = o.length - 2; h > 0; --h) n[l++] = o[h];
        return n
    }, tu = Zo[3], nu = bt, ru = bt;
    bt.prototype = {
        push: function (e) {
            this.data.push(e), this.length++, this._up(this.length - 1)
        }, pop: function () {
            if (0 !== this.length) {
                var e = this.data[0];
                return this.length--, this.length > 0 && (this.data[0] = this.data[this.length], this._down(0)), this.data.pop(), e
            }
        }, peek: function () {
            return this.data[0]
        }, _up: function (e) {
            for (var t = this.data, n = this.compare, r = t[e]; e > 0;) {
                var i = e - 1 >> 1, s = t[i];
                if (n(r, s) >= 0) break;
                t[e] = s, e = i
            }
            t[e] = r
        }, _down: function (e) {
            for (var t = this.data, n = this.compare, r = this.length >> 1, i = t[e]; e < r;) {
                var s = 1 + (e << 1), o = s + 1, u = t[s];
                if (o < this.length && n(t[o], u) < 0 && (s = o, u = t[o]), n(u, i) >= 0) break;
                t[e] = u, e = s
            }
            t[e] = i
        }
    }, nu.default = ru;
    var iu = function (e, t) {
        for (var n = e[0], r = e[1], i = !1, s = 0, o = t.length - 1; s < t.length; o = s++) {
            var u = t[s][0], a = t[s][1], f = t[o][0], l = t[o][1];
            a > r != l > r && n < (f - u) * (r - a) / (l - a) + u && (i = !i)
        }
        return i
    }, su = Zo[3], ou = wt, uu = wt;
    ou.default = uu;
    var au = function (e) {
        return e
    }, fu = function (e) {
        if (null == e) return au;
        var t, n, r = e.scale[0], i = e.scale[1], s = e.translate[0], o = e.translate[1];
        return function (e, u) {
            u || (t = n = 0);
            var a = 2, f = e.length, l = new Array(f);
            for (l[0] = (t += e[0]) * r + s, l[1] = (n += e[1]) * i + o; a < f;) l[a] = e[a], ++a;
            return l
        }
    }, lu = function (e, t) {
        for (var n, r = e.length, i = r - t; i < --r;) n = e[i], e[i++] = e[r], e[r] = n
    }, cu = function (e, t) {
        function n(e, t) {
            for (var n in e) {
                var i = e[n];
                delete t[i.start], delete i.start, delete i.end, i.forEach(function (e) {
                    r[e < 0 ? ~e : e] = 1
                }), o.push(i)
            }
        }

        var r = {}, i = {}, s = {}, o = [], u = -1;
        return t.forEach(function (n, r) {
            var i, s = e.arcs[n < 0 ? ~n : n];
            s.length < 3 && !s[1][0] && !s[1][1] && (i = t[++u], t[u] = n, t[r] = i)
        }), t.forEach(function (t) {
            var n, r, o = function (t) {
                var n, r = e.arcs[t < 0 ? ~t : t], i = r[0];
                return e.transform ? (n = [0, 0], r.forEach(function (e) {
                    n[0] += e[0], n[1] += e[1]
                })) : n = r[r.length - 1], t < 0 ? [n, i] : [i, n]
            }(t), u = o[0], a = o[1];
            if (n = s[u]) if (delete s[n.end], n.push(t), n.end = a, r = i[a]) {
                delete i[r.start];
                var f = r === n ? n : n.concat(r);
                i[f.start = n.start] = s[f.end = r.end] = f
            } else i[n.start] = s[n.end] = n; else if (n = i[a]) if (delete i[n.start], n.unshift(t), n.start = u, r = s[u]) {
                delete s[r.end];
                var l = r === n ? n : r.concat(n);
                i[l.start = r.start] = s[l.end = n.end] = l
            } else i[n.start] = s[n.end] = n; else i[(n = [t]).start = u] = s[n.end = a] = n
        }), n(s, i), n(i, s), t.forEach(function (e) {
            r[e < 0 ? ~e : e] || o.push([e])
        }), o
    }, hu = function (e) {
        return zt(e, Wt.apply(this, arguments))
    }, pu = function (e, t, n, r, i, s) {
        3 === arguments.length && (r = s = Array, i = null);
        for (var o = new r(e = 1 << Math.max(4, Math.ceil(Math.log(e) / Math.LN2))), u = new s(e), a = e - 1, f = 0; f < e; ++f) o[f] = i;
        return {
            set: function (r, s) {
                for (var f = t(r) & a, l = o[f], c = 0; l != i;) {
                    if (n(l, r)) return u[f] = s;
                    if (++c >= e) throw new Error("full hashmap");
                    l = o[f = f + 1 & a]
                }
                return o[f] = r, u[f] = s, s
            }, maybeSet: function (r, s) {
                for (var f = t(r) & a, l = o[f], c = 0; l != i;) {
                    if (n(l, r)) return u[f];
                    if (++c >= e) throw new Error("full hashmap");
                    l = o[f = f + 1 & a]
                }
                return o[f] = r, u[f] = s, s
            }, get: function (r, s) {
                for (var f = t(r) & a, l = o[f], c = 0; l != i;) {
                    if (n(l, r)) return u[f];
                    if (++c >= e) break;
                    l = o[f = f + 1 & a]
                }
                return s
            }, keys: function () {
                for (var e = [], t = 0, n = o.length; t < n; ++t) {
                    var r = o[t];
                    r != i && e.push(r)
                }
                return e
            }
        }
    }, du = function (e, t) {
        return e[0] === t[0] && e[1] === t[1]
    }, vu = new ArrayBuffer(16), mu = new Float64Array(vu), gu = new Uint32Array(vu), yu = function (e) {
        mu[0] = e[0], mu[1] = e[1];
        var t = gu[0] ^ gu[1];
        return 2147483647 & (t = t << 5 ^ t >> 7 ^ gu[2] ^ gu[3])
    }, bu = function (e) {
        function t(e, t, n, r) {
            if (h[n] !== e) {
                h[n] = e;
                var i = p[n];
                if (i >= 0) {
                    var s = d[n];
                    i === t && s === r || i === r && s === t || (++m, v[n] = 1)
                } else p[n] = t, d[n] = r
            }
        }

        function n(e) {
            return yu(a[e])
        }

        function r(e, t) {
            return du(a[e], a[t])
        }

        var i, s, o, u, a = e.coordinates, f = e.lines, l = e.rings, c = function () {
                for (var e = pu(1.4 * a.length, n, r, Int32Array, -1, Int32Array), t = new Int32Array(a.length), i = 0, s = a.length; i < s; ++i) t[i] = e.maybeSet(i, i);
                return t
            }(), h = new Int32Array(a.length), p = new Int32Array(a.length), d = new Int32Array(a.length),
            v = new Int8Array(a.length), m = 0;
        for (i = 0, s = a.length; i < s; ++i) h[i] = p[i] = d[i] = -1;
        for (i = 0, s = f.length; i < s; ++i) {
            var g = f[i], y = g[0], b = g[1];
            for (o = c[y], u = c[++y], ++m, v[o] = 1; ++y <= b;) t(i, o, o = u, u = c[y]);
            ++m, v[u] = 1
        }
        for (i = 0, s = a.length; i < s; ++i) h[i] = -1;
        for (i = 0, s = l.length; i < s; ++i) {
            var w = l[i], E = w[0] + 1, S = w[1];
            for (t(i, c[S - 1], o = c[E - 1], u = c[E]); ++E <= S;) t(i, o, o = u, u = c[E])
        }
        h = p = d = null;
        var x, T = function (e, t, n, r, i) {
            3 === arguments.length && (r = Array, i = null);
            for (var s = new r(e = 1 << Math.max(4, Math.ceil(Math.log(e) / Math.LN2))), o = e - 1, u = 0; u < e; ++u) s[u] = i;
            return {
                add: function (r) {
                    for (var u = t(r) & o, a = s[u], f = 0; a != i;) {
                        if (n(a, r)) return !0;
                        if (++f >= e) throw new Error("full hashset");
                        a = s[u = u + 1 & o]
                    }
                    return s[u] = r, !0
                }, has: function (r) {
                    for (var u = t(r) & o, a = s[u], f = 0; a != i;) {
                        if (n(a, r)) return !0;
                        if (++f >= e) break;
                        a = s[u = u + 1 & o]
                    }
                    return !1
                }, values: function () {
                    for (var e = [], t = 0, n = s.length; t < n; ++t) {
                        var r = s[t];
                        r != i && e.push(r)
                    }
                    return e
                }
            }
        }(1.4 * m, yu, du);
        for (i = 0, s = a.length; i < s; ++i) v[x = c[i]] && T.add(a[x]);
        return T
    }, wu = function (e) {
        var t, n, r, i = bu(e), s = e.coordinates, o = e.lines, u = e.rings;
        for (n = 0, r = o.length; n < r; ++n) for (var a = o[n], f = a[0], l = a[1]; ++f < l;) i.has(s[f]) && (t = {
            0: f,
            1: a[1]
        }, a[1] = f, a = a.next = t);
        for (n = 0, r = u.length; n < r; ++n) for (var c = u[n], h = c[0], p = h, d = c[1], v = i.has(s[h]); ++p < d;) i.has(s[p]) && (v ? (t = {
            0: p,
            1: c[1]
        }, c[1] = p, c = c.next = t) : (!function (e, t, n, r) {
            Xt(e, t, n), Xt(e, t, t + r), Xt(e, t + r, n)
        }(s, h, d, d - p), s[d] = s[h], v = !0, p = h));
        return e
    }, Eu = function (e) {
        function t(e) {
            var t, n, r, i, s, o, u, a;
            if (r = p.get(t = f[e[0]])) for (u = 0, a = r.length; u < a; ++u) if (i = r[u], function (e, t) {
                var n = e[0], r = t[0], i = e[1], s = t[1];
                if (n - i != r - s) return !1;
                for (; n <= i; ++n, ++r) if (!du(f[n], f[r])) return !1;
                return !0
            }(i, e)) return e[0] = i[0], void (e[1] = i[1]);
            if (s = p.get(n = f[e[1]])) for (u = 0, a = s.length; u < a; ++u) if (o = s[u], function (e, t) {
                var n = e[0], r = t[0], i = e[1], s = t[1];
                if (n - i != r - s) return !1;
                for (; n <= i; ++n, --s) if (!du(f[n], f[s])) return !1;
                return !0
            }(o, e)) return e[1] = o[0], void (e[0] = o[1]);
            r ? r.push(e) : p.set(t, [e]), s ? s.push(e) : p.set(n, [e]), d.push(e)
        }

        function n(e, t) {
            var n = e[0], r = t[0], s = e[1] - n;
            if (s !== t[1] - r) return !1;
            for (var o = i(e), u = i(t), a = 0; a < s; ++a) if (!du(f[n + (a + o) % s], f[r + (a + u) % s])) return !1;
            return !0
        }

        function r(e, t) {
            var n = e[0], r = t[0], s = e[1], o = t[1], u = s - n;
            if (u !== o - r) return !1;
            for (var a = i(e), l = u - i(t), c = 0; c < u; ++c) if (!du(f[n + (c + a) % u], f[o - (c + l) % u])) return !1;
            return !0
        }

        function i(e) {
            for (var t = e[0], n = e[1], r = t, i = r, s = f[r]; ++r < n;) {
                var o = f[r];
                (o[0] < s[0] || o[0] === s[0] && o[1] < s[1]) && (i = r, s = o)
            }
            return i - t
        }

        var s, o, u, a, f = e.coordinates, l = e.lines, c = e.rings, h = l.length + c.length;
        for (delete e.lines, delete e.rings, u = 0, a = l.length; u < a; ++u) for (s = l[u]; s = s.next;) ++h;
        for (u = 0, a = c.length; u < a; ++u) for (o = c[u]; o = o.next;) ++h;
        var p = pu(2 * h * 1.4, yu, du), d = e.arcs = [];
        for (u = 0, a = l.length; u < a; ++u) {
            s = l[u];
            do t(s); while (s = s.next)
        }
        for (u = 0, a = c.length; u < a; ++u) if ((o = c[u]).next) {
            do t(o); while (o = o.next)
        } else !function (e) {
            var t, s, o, u, a;
            if (s = p.get(t = f[e[0]])) for (u = 0, a = s.length; u < a; ++u) {
                if (o = s[u], n(o, e)) return e[0] = o[0], void (e[1] = o[1]);
                if (r(o, e)) return e[0] = o[1], void (e[1] = o[0])
            }
            if (s = p.get(t = f[e[0] + i(e)])) for (u = 0, a = s.length; u < a; ++u) {
                if (o = s[u], n(o, e)) return e[0] = o[0], void (e[1] = o[1]);
                if (r(o, e)) return e[0] = o[1], void (e[1] = o[0])
            }
            s ? s.push(e) : p.set(t, [e]), d.push(e)
        }(o);
        return e
    }, Su = function (e, t) {
        function n(e) {
            e && l.hasOwnProperty(e.type) && l[e.type](e)
        }

        function r(e) {
            var t = [];
            do {
                var n = f.get(e);
                t.push(e[0] < e[1] ? n : ~n)
            } while (e = e.next);
            return t
        }

        function i(e) {
            return e.map(r)
        }

        var s = function (e) {
            function t(e) {
                null != e && f.hasOwnProperty(e.type) && f[e.type](e)
            }

            function n(e) {
                var t = e[0], n = e[1];
                t < s && (s = t), t > u && (u = t), n < o && (o = n), n > a && (a = n)
            }

            function r(e) {
                e.forEach(n)
            }

            function i(e) {
                e.forEach(r)
            }

            var s = 1 / 0, o = 1 / 0, u = -1 / 0, a = -1 / 0, f = {
                GeometryCollection: function (e) {
                    e.geometries.forEach(t)
                }, Point: function (e) {
                    n(e.coordinates)
                }, MultiPoint: function (e) {
                    e.coordinates.forEach(n)
                }, LineString: function (e) {
                    r(e.arcs)
                }, MultiLineString: function (e) {
                    e.arcs.forEach(r)
                }, Polygon: function (e) {
                    e.arcs.forEach(r)
                }, MultiPolygon: function (e) {
                    e.arcs.forEach(i)
                }
            };
            for (var l in e) t(e[l]);
            return u >= s && a >= o ? [s, o, u, a] : void 0
        }(e = function (e) {
            var t, n = {};
            for (t in e) n[t] = Vt(e[t]);
            return n
        }(e)), o = t > 0 && s && function (e, t, n) {
            function r(e) {
                return [Math.round((e[0] - f) * p), Math.round((e[1] - l) * d)]
            }

            function i(e, t) {
                for (var n, r, i, s, o, u = -1, a = 0, c = e.length, h = new Array(c); ++u < c;) n = e[u], s = Math.round((n[0] - f) * p), o = Math.round((n[1] - l) * d), s === r && o === i || (h[a++] = [r = s, i = o]);
                for (h.length = a; a < t;) a = h.push([h[0][0], h[0][1]]);
                return h
            }

            function s(e) {
                return i(e, 2)
            }

            function o(e) {
                return i(e, 4)
            }

            function u(e) {
                return e.map(o)
            }

            function a(e) {
                null != e && v.hasOwnProperty(e.type) && v[e.type](e)
            }

            var f = t[0], l = t[1], c = t[2], h = t[3], p = c - f ? (n - 1) / (c - f) : 1,
                d = h - l ? (n - 1) / (h - l) : 1, v = {
                    GeometryCollection: function (e) {
                        e.geometries.forEach(a)
                    }, Point: function (e) {
                        e.coordinates = r(e.coordinates)
                    }, MultiPoint: function (e) {
                        e.coordinates = e.coordinates.map(r)
                    }, LineString: function (e) {
                        e.arcs = s(e.arcs)
                    }, MultiLineString: function (e) {
                        e.arcs = e.arcs.map(s)
                    }, Polygon: function (e) {
                        e.arcs = u(e.arcs)
                    }, MultiPolygon: function (e) {
                        e.arcs = e.arcs.map(u)
                    }
                };
            for (var m in e) a(e[m]);
            return {scale: [1 / p, 1 / d], translate: [f, l]}
        }(e, s, t), u = Eu(wu(function (e) {
            function t(e) {
                e && f.hasOwnProperty(e.type) && f[e.type](e)
            }

            function n(e) {
                for (var t = 0, n = e.length; t < n; ++t) a[++s] = e[t];
                var r = {0: s - n + 1, 1: s};
                return o.push(r), r
            }

            function r(e) {
                for (var t = 0, n = e.length; t < n; ++t) a[++s] = e[t];
                var r = {0: s - n + 1, 1: s};
                return u.push(r), r
            }

            function i(e) {
                return e.map(r)
            }

            var s = -1, o = [], u = [], a = [], f = {
                GeometryCollection: function (e) {
                    e.geometries.forEach(t)
                }, LineString: function (e) {
                    e.arcs = n(e.arcs)
                }, MultiLineString: function (e) {
                    e.arcs = e.arcs.map(n)
                }, Polygon: function (e) {
                    e.arcs = e.arcs.map(r)
                }, MultiPolygon: function (e) {
                    e.arcs = e.arcs.map(i)
                }
            };
            for (var l in e) t(e[l]);
            return {type: "Topology", coordinates: a, lines: o, rings: u, objects: e}
        }(e))), a = u.coordinates, f = pu(1.4 * u.arcs.length, Kt, Qt);
        e = u.objects, u.bbox = s, u.arcs = u.arcs.map(function (e, t) {
            return f.set(e, t), a.slice(e[0], e[1] + 1)
        }), delete u.coordinates, a = null;
        var l = {
            GeometryCollection: function (e) {
                e.geometries.forEach(n)
            }, LineString: function (e) {
                e.arcs = r(e.arcs)
            }, MultiLineString: function (e) {
                e.arcs = e.arcs.map(r)
            }, Polygon: function (e) {
                e.arcs = e.arcs.map(r)
            }, MultiPolygon: function (e) {
                e.arcs = e.arcs.map(i)
            }
        };
        for (var c in e) n(e[c]);
        return o && (u.transform = o, u.arcs = function (e) {
            for (var t = -1, n = e.length; ++t < n;) {
                for (var r, i, s = e[t], o = 0, u = 1, a = s.length, f = s[0], l = f[0], c = f[1]; ++o < a;) r = (f = s[o])[0], i = f[1], r === l && i === c || (s[u++] = [r - l, i - c], l = r, c = i);
                1 === u && (s[u++] = [0, 0]), s.length = u
            }
            return e
        }(u.arcs)), u
    }, xu = function (e) {
        this.points = e.points || [], this.duration = e.duration || 1e4, this.sharpness = e.sharpness || .85, this.centers = [], this.controls = [], this.stepLength = e.stepLength || 60, this.length = this.points.length, this.delay = 0;
        for (var t = 0; t < this.length; t++) this.points[t].z = this.points[t].z || 0;
        for (t = 0; t < this.length - 1; t++) {
            var n = this.points[t], r = this.points[t + 1];
            this.centers.push({x: (n.x + r.x) / 2, y: (n.y + r.y) / 2, z: (n.z + r.z) / 2})
        }
        this.controls.push([this.points[0], this.points[0]]);
        for (t = 0; t < this.centers.length - 1; t++) {
            n = this.centers[t], r = this.centers[t + 1];
            var i = this.points[t + 1].x - (this.centers[t].x + this.centers[t + 1].x) / 2,
                s = this.points[t + 1].y - (this.centers[t].y + this.centers[t + 1].y) / 2,
                o = this.points[t + 1].z - (this.centers[t].y + this.centers[t + 1].z) / 2;
            this.controls.push([{
                x: (1 - this.sharpness) * this.points[t + 1].x + this.sharpness * (this.centers[t].x + i),
                y: (1 - this.sharpness) * this.points[t + 1].y + this.sharpness * (this.centers[t].y + s),
                z: (1 - this.sharpness) * this.points[t + 1].z + this.sharpness * (this.centers[t].z + o)
            }, {
                x: (1 - this.sharpness) * this.points[t + 1].x + this.sharpness * (this.centers[t + 1].x + i),
                y: (1 - this.sharpness) * this.points[t + 1].y + this.sharpness * (this.centers[t + 1].y + s),
                z: (1 - this.sharpness) * this.points[t + 1].z + this.sharpness * (this.centers[t + 1].z + o)
            }])
        }
        return this.controls.push([this.points[this.length - 1], this.points[this.length - 1]]), this.steps = this.cacheSteps(this.stepLength), this
    };
    xu.prototype.cacheSteps = function (e) {
        var t = [], n = this.pos(0);
        t.push(0);
        for (var r = 0; r < this.duration; r += 10) {
            var i = this.pos(r);
            Math.sqrt((i.x - n.x) * (i.x - n.x) + (i.y - n.y) * (i.y - n.y) + (i.z - n.z) * (i.z - n.z)) > e && (t.push(r), n = i)
        }
        return t
    }, xu.prototype.vector = function (e) {
        var t = this.pos(e + 10), n = this.pos(e - 10);
        return {
            angle: 180 * Math.atan2(t.y - n.y, t.x - n.x) / 3.14,
            speed: Math.sqrt((n.x - t.x) * (n.x - t.x) + (n.y - t.y) * (n.y - t.y) + (n.z - t.z) * (n.z - t.z))
        }
    }, xu.prototype.pos = function (e) {
        var t = e - this.delay;
        t < 0 && (t = 0), t > this.duration && (t = this.duration - 1);
        var n = t / this.duration;
        if (n >= 1) return this.points[this.length - 1];
        var r = Math.floor((this.points.length - 1) * n);
        return function (e, t, n, r, i) {
            var s = function (e) {
                var t = e * e;
                return [t * e, 3 * t * (1 - e), 3 * e * (1 - e) * (1 - e), (1 - e) * (1 - e) * (1 - e)]
            }(e);
            return {
                x: i.x * s[0] + r.x * s[1] + n.x * s[2] + t.x * s[3],
                y: i.y * s[0] + r.y * s[1] + n.y * s[2] + t.y * s[3],
                z: i.z * s[0] + r.z * s[1] + n.z * s[2] + t.z * s[3]
            }
        }((this.length - 1) * n - r, this.points[r], this.controls[r][1], this.controls[r + 1][0], this.points[r + 1])
    };
    var Tu = wn, Nu = wn;
    wn.deviation = function (e, t, n, r) {
        var i = t && t.length, s = i ? t[0] * n : e.length, o = Math.abs(Hn(e, 0, s, n));
        if (i) for (var u = 0, a = t.length; u < a; u++) {
            var f = t[u] * n, l = u < a - 1 ? t[u + 1] * n : e.length;
            o -= Math.abs(Hn(e, f, l, n))
        }
        var c = 0;
        for (u = 0; u < r.length; u += 3) {
            var h = r[u] * n, p = r[u + 1] * n, d = r[u + 2] * n;
            c += Math.abs((e[h] - e[d]) * (e[p + 1] - e[h + 1]) - (e[h] - e[p]) * (e[d + 1] - e[h + 1]))
        }
        return 0 === o && 0 === c ? 0 : Math.abs((c - o) / o)
    }, wn.flatten = function (e) {
        for (var t = e[0][0].length, n = {vertices: [], holes: [], dimensions: t}, r = 0, i = 0; i < e.length; i++) {
            for (var s = 0; s < e[i].length; s++) for (var o = 0; o < t; o++) n.vertices.push(e[i][s][o]);
            i > 0 && (r += e[i - 1].length, n.holes.push(r))
        }
        return n
    }, Tu.default = Nu, Rn.prototype = {
        all: function () {
            return this._all(this.data, [])
        }, search: function (e) {
            var t = this.data, n = [], r = this.toBBox;
            if (!Qn(e, t)) return n;
            for (var i, s, o, u, a = []; t;) {
                for (i = 0, s = t.children.length; i < s; i++) o = t.children[i], Qn(e, u = t.leaf ? r(o) : o) && (t.leaf ? n.push(o) : Kn(e, u) ? this._all(o, n) : a.push(o));
                t = a.pop()
            }
            return n
        }, collides: function (e) {
            var t = this.data, n = this.toBBox;
            if (!Qn(e, t)) return !1;
            for (var r, i, s, o, u = []; t;) {
                for (r = 0, i = t.children.length; r < i; r++) if (s = t.children[r], o = t.leaf ? n(s) : s, Qn(e, o)) {
                    if (t.leaf || Kn(e, o)) return !0;
                    u.push(s)
                }
                t = u.pop()
            }
            return !1
        }, load: function (e) {
            if (!e || !e.length) return this;
            if (e.length < this._minEntries) {
                for (var t = 0, n = e.length; t < n; t++) this.insert(e[t]);
                return this
            }
            var r = this._build(e.slice(), 0, e.length - 1, 0);
            if (this.data.children.length) if (this.data.height === r.height) this._splitRoot(this.data, r); else {
                if (this.data.height < r.height) {
                    var i = this.data;
                    this.data = r, r = i
                }
                this._insert(r, this.data.height - r.height - 1, !0)
            } else this.data = r;
            return this
        }, insert: function (e) {
            return e && this._insert(e, this.data.height - 1), this
        }, clear: function () {
            return this.data = Gn([]), this
        }, remove: function (e, t) {
            if (!e) return this;
            for (var n, r, i, s, o = this.data, u = this.toBBox(e), a = [], f = []; o || a.length;) {
                if (o || (o = a.pop(), r = a[a.length - 1], n = f.pop(), s = !0), o.leaf && -1 !== (i = function (e, t, n) {
                    if (!n) return t.indexOf(e);
                    for (var r = 0; r < t.length; r++) if (n(e, t[r])) return r;
                    return -1
                }(e, o.children, t))) return o.children.splice(i, 1), a.push(o), this._condense(a), this;
                s || o.leaf || !Kn(o, u) ? r ? (n++, o = r.children[n], s = !1) : o = null : (a.push(o), f.push(n), n = 0, r = o, o = o.children[0])
            }
            return this
        }, toBBox: function (e) {
            return e
        }, compareMinX: Xn, compareMinY: Vn, toJSON: function () {
            return this.data
        }, fromJSON: function (e) {
            return this.data = e, this
        }, _all: function (e, t) {
            for (var n = []; e;) e.leaf ? t.push.apply(t, e.children) : n.push.apply(n, e.children), e = n.pop();
            return t
        }, _build: function (e, t, n, r) {
            var i, s = n - t + 1, o = this._maxEntries;
            if (s <= o) return i = Gn(e.slice(t, n + 1)), Un(i, this.toBBox), i;
            r || (r = Math.ceil(Math.log(s) / Math.log(o)), o = Math.ceil(s / Math.pow(o, r - 1))), (i = Gn([])).leaf = !1, i.height = r;
            var u, a, f, l, c = Math.ceil(s / o), h = c * Math.ceil(Math.sqrt(o));
            for (Yn(e, t, n, h, this.compareMinX), u = t; u <= n; u += h) for (Yn(e, u, f = Math.min(u + h - 1, n), c, this.compareMinY), a = u; a <= f; a += c) l = Math.min(a + c - 1, f), i.children.push(this._build(e, a, l, r - 1));
            return Un(i, this.toBBox), i
        }, _chooseSubtree: function (e, t, n, r) {
            for (var i, s, o, u, a, f, l, c; r.push(t), !t.leaf && r.length - 1 !== n;) {
                for (l = c = 1 / 0, i = 0, s = t.children.length; i < s; i++) a = $n(o = t.children[i]), (f = function (e, t) {
                    return (Math.max(t.maxX, e.maxX) - Math.min(t.minX, e.minX)) * (Math.max(t.maxY, e.maxY) - Math.min(t.minY, e.minY))
                }(e, o) - a) < c ? (c = f, l = a < l ? a : l, u = o) : f === c && a < l && (l = a, u = o);
                t = u || t.children[0]
            }
            return t
        }, _insert: function (e, t, n) {
            var r = this.toBBox, i = n ? e : r(e), s = [], o = this._chooseSubtree(i, this.data, t, s);
            for (o.children.push(e), Wn(o, i); t >= 0 && s[t].children.length > this._maxEntries;) this._split(s, t), t--;
            this._adjustParentBBoxes(i, s, t)
        }, _split: function (e, t) {
            var n = e[t], r = n.children.length, i = this._minEntries;
            this._chooseSplitAxis(n, i, r);
            var s = this._chooseSplitIndex(n, i, r), o = Gn(n.children.splice(s, n.children.length - s));
            o.height = n.height, o.leaf = n.leaf, Un(n, this.toBBox), Un(o, this.toBBox), t ? e[t - 1].children.push(o) : this._splitRoot(n, o)
        }, _splitRoot: function (e, t) {
            this.data = Gn([e, t]), this.data.height = e.height + 1, this.data.leaf = !1, Un(this.data, this.toBBox)
        }, _chooseSplitIndex: function (e, t, n) {
            var r, i, s, o, u, a, f, l;
            for (a = f = 1 / 0, r = t; r <= n - t; r++) o = function (e, t) {
                var n = Math.max(e.minX, t.minX), r = Math.max(e.minY, t.minY), i = Math.min(e.maxX, t.maxX),
                    s = Math.min(e.maxY, t.maxY);
                return Math.max(0, i - n) * Math.max(0, s - r)
            }(i = zn(e, 0, r, this.toBBox), s = zn(e, r, n, this.toBBox)), u = $n(i) + $n(s), o < a ? (a = o, l = r, f = u < f ? u : f) : o === a && u < f && (f = u, l = r);
            return l
        }, _chooseSplitAxis: function (e, t, n) {
            var r = e.leaf ? this.compareMinX : Xn, i = e.leaf ? this.compareMinY : Vn;
            this._allDistMargin(e, t, n, r) < this._allDistMargin(e, t, n, i) && e.children.sort(r)
        }, _allDistMargin: function (e, t, n, r) {
            e.children.sort(r);
            var i, s, o = this.toBBox, u = zn(e, 0, t, o), a = zn(e, n - t, n, o), f = Jn(u) + Jn(a);
            for (i = t; i < n - t; i++) s = e.children[i], Wn(u, e.leaf ? o(s) : s), f += Jn(u);
            for (i = n - t - 1; i >= t; i--) s = e.children[i], Wn(a, e.leaf ? o(s) : s), f += Jn(a);
            return f
        }, _adjustParentBBoxes: function (e, t, n) {
            for (var r = n; r >= 0; r--) Wn(t[r], e)
        }, _condense: function (e) {
            for (var t, n = e.length - 1; n >= 0; n--) 0 === e[n].children.length ? n > 0 ? (t = e[n - 1].children).splice(t.indexOf(e[n]), 1) : this.clear() : Un(e[n], this.toBBox)
        }, _initFormat: function (e) {
            var t = ["return a", " - b", ";"];
            this.compareMinX = new Function("a", "b", t.join(e[0])), this.compareMinY = new Function("a", "b", t.join(e[1])), this.toBBox = new Function("a", "return {minX: a" + e[0] + ", minY: a" + e[1] + ", maxX: a" + e[2] + ", maxY: a" + e[3] + "};")
        }
    };
    var Cu = Object.freeze({toMercator: fr, toWgs84: lr}), ku = 6378137, Lu = function (e, t, n) {
        function r(e, n, r, i) {
            var a = s[e][n], f = s[e][n + 1], l = s[r][i], c = s[r][i + 1], h = function (e, t, n, r) {
                if (Mr(e, n) || Mr(e, r) || Mr(t, n) || Mr(r, n)) return null;
                var i = e[0], s = e[1], o = t[0], u = t[1], a = n[0], f = n[1], l = r[0], c = r[1],
                    h = (i - o) * (f - c) - (s - u) * (a - l);
                return 0 === h ? null : [((i * u - s * o) * (a - l) - (i - o) * (a * c - f * l)) / h, ((i * u - s * o) * (f - c) - (s - u) * (a * c - f * l)) / h]
            }(a, f, l, c);
            if (null !== h) {
                var p, d;
                if (p = f[0] !== a[0] ? (h[0] - a[0]) / (f[0] - a[0]) : (h[1] - a[1]) / (f[1] - a[1]), d = c[0] !== l[0] ? (h[0] - l[0]) / (c[0] - l[0]) : (h[1] - l[1]) / (c[1] - l[1]), !(p >= 1 || p <= 0 || d >= 1 || d <= 0)) {
                    var v = h, m = !u[v];
                    m && (u[v] = !0), t ? o.push(t(h, e, n, a, f, p, r, i, l, c, d, m)) : o.push(h)
                }
            }
        }

        function i(e, t) {
            var n, r, i, o, u = s[e][t], a = s[e][t + 1];
            return u[0] < a[0] ? (n = u[0], r = a[0]) : (n = a[0], r = u[0]), u[1] < a[1] ? (i = u[1], o = a[1]) : (i = a[1], o = u[1]), {
                minX: n,
                minY: i,
                maxX: r,
                maxY: o,
                ring: e,
                edge: t
            }
        }

        if ("Polygon" !== e.geometry.type) throw new Error("The input feature must be a Polygon");
        void 0 === n && (n = 1);
        var s = e.geometry.coordinates, o = [], u = {};
        if (n) {
            for (var a = [], f = 0; f < s.length; f++) for (var l = 0; l < s[f].length - 1; l++) a.push(i(f, l));
            var c = Vo();
            c.load(a)
        }
        for (var h = 0; h < s.length; h++) for (var p = 0; p < s[h].length - 1; p++) if (n) c.search(i(h, p)).forEach(function (e) {
            var t = e.ring, n = e.edge;
            r(h, p, t, n)
        }); else for (var d = 0; d < s.length; d++) for (var v = 0; v < s[d].length - 1; v++) r(h, p, d, v);
        return t || (o = {type: "Feature", geometry: {type: "MultiPoint", coordinates: o}}), o
    }, Au = function (e) {
        function t() {
            for (var e = [], t = 0; t < d.features.length; t++) -1 == d.features[t].properties.parent && e.push(t);
            if (e.length > 1) for (t = 0; t < e.length; t++) {
                for (var n = -1, r = 0; r < d.features.length; r++) e[t] != r && Ot(d.features[e[t]].geometry.coordinates[0][0], d.features[r], {ignoreBoundary: !0}) && yr(d.features[r]) < 1 / 0 && (n = r);
                d.features[e[t]].properties.parent = n
            }
        }

        function n() {
            for (var e = 0; e < d.features.length; e++) if (-1 == d.features[e].properties.parent) {
                var t = d.features[e].properties.winding;
                d.features[e].properties.netWinding = t, r(e, t)
            }
        }

        function r(e, t) {
            for (var n = 0; n < d.features.length; n++) if (d.features[n].properties.parent == e) {
                var i = t + d.features[n].properties.winding;
                d.features[n].properties.netWinding = i, r(n, i)
            }
        }

        if ("Feature" != e.type) throw new Error("The input must a geojson object of type Feature");
        if (void 0 === e.geometry || null == e.geometry) throw new Error("The input must a geojson object with a non-empty geometry");
        if ("Polygon" != e.geometry.type) throw new Error("The input must be a geojson Polygon");
        for (var i = e.geometry.coordinates.length, o = [], u = 0; u < i; u++) {
            var a = e.geometry.coordinates[u];
            Dr(a[0], a[a.length - 1]) || a.push(a[0]), o.push.apply(o, a.slice(0, a.length - 1))
        }
        if (!function (e) {
            for (var t = {}, n = 1, r = 0, i = e.length; r < i; ++r) {
                if (t.hasOwnProperty(e[r])) {
                    n = 0;
                    break
                }
                t[e[r]] = 1
            }
            return n
        }(o)) throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");
        var l = o.length, c = Lu(e, function (e, t, n, r, i, s, o, u, a, f, l, c) {
            return [e, t, n, r, i, s, o, u, a, f, l, c]
        }), h = c.length;
        if (0 == h) {
            var p = [];
            for (u = 0; u < i; u++) p.push(s([e.geometry.coordinates[u]], {
                parent: -1, winding: function (e) {
                    for (var t = 0, n = 0; n < e.length - 1; n++) e[n][0] < e[t][0] && (t = n);
                    if (_r([e[(t - 1).modulo(e.length - 1)], e[t], e[(t + 1).modulo(e.length - 1)]], !0)) var r = 1; else r = -1;
                    return r
                }(e.geometry.coordinates[u])
            }));
            var d = f(p);
            return t(), n(), d
        }
        var v = [], m = [];
        for (u = 0; u < i; u++) {
            v.push([]);
            for (var g = 0; g < e.geometry.coordinates[u].length - 1; g++) v[u].push([new Ou(e.geometry.coordinates[u][(g + 1).modulo(e.geometry.coordinates[u].length - 1)], 1, [u, g], [u, (g + 1).modulo(e.geometry.coordinates[u].length - 1)], void 0)]), m.push(new Mu(e.geometry.coordinates[u][g], [u, (g - 1).modulo(e.geometry.coordinates[u].length - 1)], [u, g], void 0, void 0, !1, !0))
        }
        for (u = 0; u < h; u++) v[c[u][1]][c[u][2]].push(new Ou(c[u][0], c[u][5], [c[u][1], c[u][2]], [c[u][6], c[u][7]], void 0)), c[u][11] && m.push(new Mu(c[u][0], [c[u][1], c[u][2]], [c[u][6], c[u][7]], void 0, void 0, !0, !0));
        var y = m.length;
        for (u = 0; u < v.length; u++) for (g = 0; g < v[u].length; g++) v[u][g].sort(function (e, t) {
            return e.param < t.param ? -1 : 1
        });
        var b = [];
        for (u = 0; u < y; u++) b.push({
            minX: m[u].coord[0],
            minY: m[u].coord[1],
            maxX: m[u].coord[0],
            maxY: m[u].coord[1],
            index: u
        });
        var w = Vo();
        w.load(b);
        for (u = 0; u < v.length; u++) for (g = 0; g < v[u].length; g++) for (var E = 0; E < v[u][g].length; E++) {
            x = E == v[u][g].length - 1 ? v[u][(g + 1).modulo(e.geometry.coordinates[u].length - 1)][0].coord : v[u][g][E + 1].coord;
            var S = w.search({minX: x[0], minY: x[1], maxX: x[0], maxY: x[1]})[0];
            v[u][g][E].nxtIsectAlongEdgeIn = S.index
        }
        for (u = 0; u < v.length; u++) for (g = 0; g < v[u].length; g++) for (E = 0; E < v[u][g].length; E++) {
            var x = v[u][g][E].coord, T = (S = w.search({minX: x[0], minY: x[1], maxX: x[0], maxY: x[1]})[0]).index;
            T < l ? m[T].nxtIsectAlongRingAndEdge2 = v[u][g][E].nxtIsectAlongEdgeIn : Dr(m[T].ringAndEdge1, v[u][g][E].ringAndEdgeIn) ? m[T].nxtIsectAlongRingAndEdge1 = v[u][g][E].nxtIsectAlongEdgeIn : m[T].nxtIsectAlongRingAndEdge2 = v[u][g][E].nxtIsectAlongEdgeIn
        }
        var N = [];
        for (u = 0, g = 0; g < i; g++) {
            var C = u;
            for (E = 0; E < e.geometry.coordinates[g].length - 1; E++) m[u].coord[0] < m[C].coord[0] && (C = u), u++;
            var k = m[C].nxtIsectAlongRingAndEdge2;
            for (E = 0; E < m.length; E++) if (m[E].nxtIsectAlongRingAndEdge1 == C || m[E].nxtIsectAlongRingAndEdge2 == C) {
                var L = E;
                break
            }
            var A = _r([m[L].coord, m[C].coord, m[k].coord], !0) ? 1 : -1;
            N.push({isect: C, parent: -1, winding: A})
        }
        N.sort(function (e, t) {
            return m[e.isect].coord > m[t.isect].coord ? -1 : 1
        });
        for (p = []; N.length > 0;) {
            var O = N.pop(), M = O.isect, _ = O.parent, D = O.winding, P = p.length, H = [m[M].coord], B = M;
            if (m[M].ringAndEdge1Walkable) var j = m[M].ringAndEdge1,
                F = m[M].nxtIsectAlongRingAndEdge1; else j = m[M].ringAndEdge2, F = m[M].nxtIsectAlongRingAndEdge2;
            for (; !Dr(m[M].coord, m[F].coord);) {
                H.push(m[F].coord);
                var I = void 0;
                for (u = 0; u < N.length; u++) if (N[u].isect == F) {
                    I = u;
                    break
                }
                if (void 0 != I && N.splice(I, 1), Dr(j, m[F].ringAndEdge1)) {
                    if (j = m[F].ringAndEdge2, m[F].ringAndEdge2Walkable = !1, m[F].ringAndEdge1Walkable) {
                        var q = {isect: F};
                        _r([m[B].coord, m[F].coord, m[m[F].nxtIsectAlongRingAndEdge2].coord], 1 == D) ? (q.parent = _, q.winding = -D) : (q.parent = P, q.winding = D), N.push(q)
                    }
                    B = F, F = m[F].nxtIsectAlongRingAndEdge2
                } else {
                    if (j = m[F].ringAndEdge1, m[F].ringAndEdge1Walkable = !1, m[F].ringAndEdge2Walkable) q = {isect: F}, _r([m[B].coord, m[F].coord, m[m[F].nxtIsectAlongRingAndEdge1].coord], 1 == D) ? (q.parent = _, q.winding = -D) : (q.parent = P, q.winding = D), N.push(q);
                    B = F, F = m[F].nxtIsectAlongRingAndEdge1
                }
            }
            H.push(m[F].coord), p.push(s([H], {index: P, parent: _, winding: D, netWinding: void 0}))
        }
        return d = f(p), t(), n(), d
    }, Ou = function (e, t, n, r, i) {
        this.coord = e, this.param = t, this.ringAndEdgeIn = n, this.ringAndEdgeOut = r, this.nxtIsectAlongEdgeIn = i
    }, Mu = function (e, t, n, r, i, s, o) {
        this.coord = e, this.ringAndEdge1 = t, this.ringAndEdge2 = n, this.nxtIsectAlongRingAndEdge1 = r, this.nxtIsectAlongRingAndEdge2 = i, this.ringAndEdge1Walkable = s, this.ringAndEdge2Walkable = o
    };
    Number.prototype.modulo = function (e) {
        return (this % e + e) % e
    };
    var _u = Math.PI / 180, Du = 180 / Math.PI, Pu = function (e, t) {
        this.lon = e, this.lat = t, this.x = _u * e, this.y = _u * t
    };
    Pu.prototype.view = function () {
        return String(this.lon).slice(0, 4) + "," + String(this.lat).slice(0, 4)
    }, Pu.prototype.antipode = function () {
        var e = -1 * this.lat, t = this.lon < 0 ? 180 + this.lon : -1 * (180 - this.lon);
        return new Pu(t, e)
    };
    var Hu = function () {
        this.coords = [], this.length = 0
    };
    Hu.prototype.move_to = function (e) {
        this.length++, this.coords.push(e)
    };
    var Bu = function (e) {
        this.properties = e || {}, this.geometries = []
    };
    Bu.prototype.json = function () {
        if (this.geometries.length <= 0) return {
            geometry: {type: "LineString", coordinates: null},
            type: "Feature",
            properties: this.properties
        };
        if (1 === this.geometries.length) return {
            geometry: {
                type: "LineString",
                coordinates: this.geometries[0].coords
            }, type: "Feature", properties: this.properties
        };
        for (var e = [], t = 0; t < this.geometries.length; t++) e.push(this.geometries[t].coords);
        return {geometry: {type: "MultiLineString", coordinates: e}, type: "Feature", properties: this.properties}
    }, Bu.prototype.wkt = function () {
        for (var e = "", t = "LINESTRING(", n = function (e) {
            t += e[0] + " " + e[1] + ","
        }, r = 0; r < this.geometries.length; r++) {
            if (0 === this.geometries[r].coords.length) return "LINESTRING(empty)";
            this.geometries[r].coords.forEach(n), e += t.substring(0, t.length - 1) + ")"
        }
        return e
    };
    var ju = function (e, t, n) {
        if (!e || void 0 === e.x || void 0 === e.y) throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");
        if (!t || void 0 === t.x || void 0 === t.y) throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");
        this.start = new Pu(e.x, e.y), this.end = new Pu(t.x, t.y), this.properties = n || {};
        var r = this.start.x - this.end.x, i = this.start.y - this.end.y,
            s = Math.pow(Math.sin(i / 2), 2) + Math.cos(this.start.y) * Math.cos(this.end.y) * Math.pow(Math.sin(r / 2), 2);
        if (this.g = 2 * Math.asin(Math.sqrt(s)), this.g === Math.PI) throw new Error("it appears " + e.view() + " and " + t.view() + " are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");
        if (isNaN(this.g)) throw new Error("could not calculate great circle between " + e + " and " + t)
    };
    ju.prototype.interpolate = function (e) {
        var t = Math.sin((1 - e) * this.g) / Math.sin(this.g), n = Math.sin(e * this.g) / Math.sin(this.g),
            r = t * Math.cos(this.start.y) * Math.cos(this.start.x) + n * Math.cos(this.end.y) * Math.cos(this.end.x),
            i = t * Math.cos(this.start.y) * Math.sin(this.start.x) + n * Math.cos(this.end.y) * Math.sin(this.end.x),
            s = t * Math.sin(this.start.y) + n * Math.sin(this.end.y),
            o = Du * Math.atan2(s, Math.sqrt(Math.pow(r, 2) + Math.pow(i, 2)));
        return [Du * Math.atan2(i, r), o]
    }, ju.prototype.Arc = function (e, t) {
        var n = [];
        if (!e || e <= 2) n.push([this.start.lon, this.start.lat]), n.push([this.end.lon, this.end.lat]); else for (var r = 1 / (e - 1), i = 0; i < e; ++i) {
            var s = r * i, o = this.interpolate(s);
            n.push(o)
        }
        for (var u = !1, a = 0, f = t && t.offset ? t.offset : 10, l = 180 - f, c = -180 + f, h = 360 - f, p = 1; p < n.length; ++p) {
            var d = n[p - 1][0], v = n[p][0], m = Math.abs(v - d);
            m > h && (v > l && d < c || d > l && v < c) ? u = !0 : m > a && (a = m)
        }
        var g = [];
        if (u && a < f) {
            var y = [];
            g.push(y);
            for (var b = 0; b < n.length; ++b) {
                var w = parseFloat(n[b][0]);
                if (b > 0 && Math.abs(w - n[b - 1][0]) > h) {
                    var E = parseFloat(n[b - 1][0]), S = parseFloat(n[b - 1][1]), x = parseFloat(n[b][0]),
                        T = parseFloat(n[b][1]);
                    if (E > -180 && E < c && 180 === x && b + 1 < n.length && n[b - 1][0] > -180 && n[b - 1][0] < c) {
                        y.push([-180, n[b][1]]), b++, y.push([n[b][0], n[b][1]]);
                        continue
                    }
                    if (E > l && E < 180 && -180 === x && b + 1 < n.length && n[b - 1][0] > l && n[b - 1][0] < 180) {
                        y.push([180, n[b][1]]), b++, y.push([n[b][0], n[b][1]]);
                        continue
                    }
                    if (E < c && x > l) {
                        var N = E;
                        E = x, x = N;
                        var C = S;
                        S = T, T = C
                    }
                    if (E > l && x < c && (x += 360), E <= 180 && x >= 180 && E < x) {
                        var k = (180 - E) / (x - E), L = k * T + (1 - k) * S;
                        y.push([n[b - 1][0] > l ? 180 : -180, L]), (y = []).push([n[b - 1][0] > l ? -180 : 180, L]), g.push(y)
                    } else y = [], g.push(y);
                    y.push([w, n[b][1]])
                } else y.push([n[b][0], n[b][1]])
            }
        } else {
            var A = [];
            g.push(A);
            for (var O = 0; O < n.length; ++O) A.push([n[O][0], n[O][1]])
        }
        for (var M = new Bu(this.properties), _ = 0; _ < g.length; ++_) {
            var D = new Hu;
            M.geometries.push(D);
            for (var P = g[_], H = 0; H < P.length; ++H) D.move_to(P[H])
        }
        return M
    };
    var Fu = Xr;
    Xr.polyline = Xr, Xr.polygon = function (e, t) {
        var n, r, i, s, o, u, a;
        for (r = 1; r <= 8; r *= 2) {
            for (n = [], s = !($r(i = e[e.length - 1], t) & r), o = 0; o < e.length; o++) (a = !($r(u = e[o], t) & r)) !== s && n.push(Vr(i, u, r, t)), a && n.push(u), i = u, s = a;
            if (!(e = n).length) break
        }
        return n
    };
    var Iu = Array.prototype.slice, qu = {successCallback: null, verbose: !1, polygons: !1}, Ru = {}, Uu = 64, zu = 16,
        Wu = 4, Xu = 1, Vu = [], $u = [], Ju = [], Ku = [], Qu = [], Gu = [], Yu = [], Zu = [], ea = [], ta = [],
        na = [], ra = [], ia = [], sa = [], oa = [], ua = [], aa = [], fa = [], la = [], ca = [], ha = [], pa = [],
        da = [], va = [];
    Yu[85] = ta[85] = -1, Zu[85] = na[85] = 0, ea[85] = ra[85] = 1, la[85] = pa[85] = 1, ca[85] = da[85] = 0, ha[85] = va[85] = 1, Vu[85] = Ku[85] = 0, $u[85] = Qu[85] = -1, Ju[85] = oa[85] = 0, ua[85] = ia[85] = 0, aa[85] = sa[85] = 1, Gu[85] = fa[85] = 1, pa[1] = pa[169] = 0, da[1] = da[169] = -1, va[1] = va[169] = 0, ia[1] = ia[169] = -1, sa[1] = sa[169] = 0, oa[1] = oa[169] = 0, ta[4] = ta[166] = 0, na[4] = na[166] = -1, ra[4] = ra[166] = 1, ua[4] = ua[166] = 1, aa[4] = aa[166] = 0, fa[4] = fa[166] = 0, Yu[16] = Yu[154] = 0, Zu[16] = Zu[154] = 1, ea[16] = ea[154] = 1, Ku[16] = Ku[154] = 1, Qu[16] = Qu[154] = 0, Gu[16] = Gu[154] = 1, la[64] = la[106] = 0, ca[64] = ca[106] = 1, ha[64] = ha[106] = 0, Vu[64] = Vu[106] = -1, $u[64] = $u[106] = 0, Ju[64] = Ju[106] = 1, la[2] = la[168] = 0, ca[2] = ca[168] = -1, ha[2] = ha[168] = 1, pa[2] = pa[168] = 0, da[2] = da[168] = -1, va[2] = va[168] = 0, ia[2] = ia[168] = -1, sa[2] = sa[168] = 0, oa[2] = oa[168] = 0, ua[2] = ua[168] = -1, aa[2] = aa[168] = 0, fa[2] = fa[168] = 1, Yu[8] = Yu[162] = 0, Zu[8] = Zu[162] = -1, ea[8] = ea[162] = 0, ta[8] = ta[162] = 0, na[8] = na[162] = -1, ra[8] = ra[162] = 1, ia[8] = ia[162] = 1, sa[8] = sa[162] = 0, oa[8] = oa[162] = 1, ua[8] = ua[162] = 1, aa[8] = aa[162] = 0, fa[8] = fa[162] = 0, Yu[32] = Yu[138] = 0, Zu[32] = Zu[138] = 1, ea[32] = ea[138] = 1, ta[32] = ta[138] = 0, na[32] = na[138] = 1, ra[32] = ra[138] = 0, Vu[32] = Vu[138] = 1, $u[32] = $u[138] = 0, Ju[32] = Ju[138] = 0, Ku[32] = Ku[138] = 1, Qu[32] = Qu[138] = 0, Gu[32] = Gu[138] = 1, pa[128] = pa[42] = 0, da[128] = da[42] = 1, va[128] = va[42] = 1, la[128] = la[42] = 0, ca[128] = ca[42] = 1, ha[128] = ha[42] = 0, Vu[128] = Vu[42] = -1, $u[128] = $u[42] = 0, Ju[128] = Ju[42] = 1, Ku[128] = Ku[42] = -1, Qu[128] = Qu[42] = 0, Gu[128] = Gu[42] = 0, ta[5] = ta[165] = -1, na[5] = na[165] = 0, ra[5] = ra[165] = 0, pa[5] = pa[165] = 1, da[5] = da[165] = 0, va[5] = va[165] = 0, ua[20] = ua[150] = 0, aa[20] = aa[150] = 1, fa[20] = fa[150] = 1, Ku[20] = Ku[150] = 0, Qu[20] = Qu[150] = -1, Gu[20] = Gu[150] = 1, Yu[80] = Yu[90] = -1, Zu[80] = Zu[90] = 0, ea[80] = ea[90] = 1, la[80] = la[90] = 1, ca[80] = ca[90] = 0,ha[80] = ha[90] = 1,ia[65] = ia[105] = 0,sa[65] = sa[105] = 1,oa[65] = oa[105] = 0,Vu[65] = Vu[105] = 0,$u[65] = $u[105] = -1,Ju[65] = Ju[105] = 0,Yu[160] = Yu[10] = -1,Zu[160] = Zu[10] = 0,ea[160] = ea[10] = 1,ta[160] = ta[10] = -1,na[160] = na[10] = 0,ra[160] = ra[10] = 0,pa[160] = pa[10] = 1,da[160] = da[10] = 0,va[160] = va[10] = 0,la[160] = la[10] = 1,ca[160] = ca[10] = 0,ha[160] = ha[10] = 1,ua[130] = ua[40] = 0,aa[130] = aa[40] = 1,fa[130] = fa[40] = 1,ia[130] = ia[40] = 0,sa[130] = sa[40] = 1,oa[130] = oa[40] = 0,Vu[130] = Vu[40] = 0,$u[130] = $u[40] = -1,Ju[130] = Ju[40] = 0,Ku[130] = Ku[40] = 0,Qu[130] = Qu[40] = -1,Gu[130] = Gu[40] = 1,ta[37] = ta[133] = 0,na[37] = na[133] = 1,ra[37] = ra[133] = 1,pa[37] = pa[133] = 0,da[37] = da[133] = 1,va[37] = va[133] = 0,Vu[37] = Vu[133] = -1,$u[37] = $u[133] = 0,Ju[37] = Ju[133] = 0,Ku[37] = Ku[133] = 1,Qu[37] = Qu[133] = 0,Gu[37] = Gu[133] = 0,ua[148] = ua[22] = -1,aa[148] = aa[22] = 0,fa[148] = fa[22] = 0,pa[148] = pa[22] = 0,da[148] = da[22] = -1,va[148] = va[22] = 1,la[148] = la[22] = 0,ca[148] = ca[22] = 1,ha[148] = ha[22] = 1,Ku[148] = Ku[22] = -1,Qu[148] = Qu[22] = 0,Gu[148] = Gu[22] = 1,Yu[82] = Yu[88] = 0,Zu[82] = Zu[88] = -1,ea[82] = ea[88] = 1,ua[82] = ua[88] = 1,aa[82] = aa[88] = 0,fa[82] = fa[88] = 1,ia[82] = ia[88] = -1,sa[82] = sa[88] = 0,oa[82] = oa[88] = 1,la[82] = la[88] = 0,ca[82] = ca[88] = -1,ha[82] = ha[88] = 0,Yu[73] = Yu[97] = 0,Zu[73] = Zu[97] = 1,ea[73] = ea[97] = 0,ta[73] = ta[97] = 0,na[73] = na[97] = -1,ra[73] = ra[97] = 0,ia[73] = ia[97] = 1,sa[73] = sa[97] = 0,oa[73] = oa[97] = 0,Vu[73] = Vu[97] = 1,$u[73] = $u[97] = 0,Ju[73] = Ju[97] = 1,Yu[145] = Yu[25] = 0,Zu[145] = Zu[25] = -1,ea[145] = ea[25] = 0,ia[145] = ia[25] = 1,sa[145] = sa[25] = 0,oa[145] = oa[25] = 1,pa[145] = pa[25] = 0,da[145] = da[25] = 1,va[145] = va[25] = 1,Ku[145] = Ku[25] = -1,Qu[145] = Qu[25] = 0,Gu[145] = Gu[25] = 0,ta[70] = ta[100] = 0,na[70] = na[100] = 1,ra[70] = ra[100] = 0,ua[70] = ua[100] = -1,aa[70] = aa[100] = 0,fa[70] = fa[100] = 1,la[70] = la[100] = 0,ca[70] = ca[100] = -1,ha[70] = ha[100] = 1,Vu[70] = Vu[100] = 1,$u[70] = $u[100] = 0,Ju[70] = Ju[100] = 0,ta[101] = ta[69] = 0,na[101] = na[69] = 1,ra[101] = ra[69] = 0,Vu[101] = Vu[69] = 1,$u[101] = $u[69] = 0,Ju[101] = Ju[69] = 0,pa[149] = pa[21] = 0,da[149] = da[21] = 1,va[149] = va[21] = 1,Ku[149] = Ku[21] = -1,Qu[149] = Qu[21] = 0,Gu[149] = Gu[21] = 0,ua[86] = ua[84] = -1,aa[86] = aa[84] = 0,fa[86] = fa[84] = 1,la[86] = la[84] = 0,ca[86] = ca[84] = -1,ha[86] = ha[84] = 1,Yu[89] = Yu[81] = 0,Zu[89] = Zu[81] = -1,ea[89] = ea[81] = 0,ia[89] = ia[81] = 1,sa[89] = sa[81] = 0,oa[89] = oa[81] = 1,Yu[96] = Yu[74] = 0,Zu[96] = Zu[74] = 1,ea[96] = ea[74] = 0,ta[96] = ta[74] = -1,na[96] = na[74] = 0,ra[96] = ra[74] = 1,la[96] = la[74] = 1,ca[96] = ca[74] = 0,ha[96] = ha[74] = 0,Vu[96] = Vu[74] = 1,$u[96] = $u[74] = 0,Ju[96] = Ju[74] = 1,Yu[24] = Yu[146] = 0,Zu[24] = Zu[146] = -1,ea[24] = ea[146] = 1,ua[24] = ua[146] = 1,aa[24] = aa[146] = 0,fa[24] = fa[146] = 1,ia[24] = ia[146] = 0,sa[24] = sa[146] = 1,oa[24] = oa[146] = 1,Ku[24] = Ku[146] = 0,Qu[24] = Qu[146] = -1,Gu[24] = Gu[146] = 0,ta[6] = ta[164] = -1,na[6] = na[164] = 0,ra[6] = ra[164] = 1,ua[6] = ua[164] = -1,aa[6] = aa[164] = 0,fa[6] = fa[164] = 0,pa[6] = pa[164] = 0,da[6] = da[164] = -1,va[6] = va[164] = 1,la[6] = la[164] = 1,ca[6] = ca[164] = 0,ha[6] = ha[164] = 0,ia[129] = ia[41] = 0,sa[129] = sa[41] = 1,oa[129] = oa[41] = 1,pa[129] = pa[41] = 0,da[129] = da[41] = 1,va[129] = va[41] = 0,Vu[129] = Vu[41] = -1,$u[129] = $u[41] = 0,Ju[129] = Ju[41] = 0,Ku[129] = Ku[41] = 0,Qu[129] = Qu[41] = -1,Gu[129] = Gu[41] = 0,ua[66] = ua[104] = 0,aa[66] = aa[104] = 1,fa[66] = fa[104] = 0,ia[66] = ia[104] = -1,sa[66] = sa[104] = 0,oa[66] = oa[104] = 1,la[66] = la[104] = 0,ca[66] = ca[104] = -1,ha[66] = ha[104] = 0,Vu[66] = Vu[104] = 0,$u[66] = $u[104] = -1,Ju[66] = Ju[104] = 1,Yu[144] = Yu[26] = -1,Zu[144] = Zu[26] = 0,ea[144] = ea[26] = 0,pa[144] = pa[26] = 1,da[144] = da[26] = 0,va[144] = va[26] = 1,la[144] = la[26] = 0,ca[144] = ca[26] = 1,ha[144] = ha[26] = 1,Ku[144] = Ku[26] = -1,Qu[144] = Qu[26] = 0,Gu[144] = Gu[26] = 1,ta[36] = ta[134] = 0,na[36] = na[134] = 1,ra[36] = ra[134] = 1,ua[36] = ua[134] = 0,aa[36] = aa[134] = 1,fa[36] = fa[134] = 0,Vu[36] = Vu[134] = 0,$u[36] = $u[134] = -1,Ju[36] = Ju[134] = 1,Ku[36] = Ku[134] = 1,Qu[36] = Qu[134] = 0,Gu[36] = Gu[134] = 0,Yu[9] = Yu[161] = -1,Zu[9] = Zu[161] = 0,ea[9] = ea[161] = 0,ta[9] = ta[161] = 0,na[9] = na[161] = -1,ra[9] = ra[161] = 0,ia[9] = ia[161] = 1,sa[9] = sa[161] = 0,oa[9] = oa[161] = 0,pa[9] = pa[161] = 1,da[9] = da[161] = 0,va[9] = va[161] = 1,Yu[136] = 0,Zu[136] = 1,ea[136] = 1,ta[136] = 0,na[136] = 1,ra[136] = 0,ua[136] = -1,aa[136] = 0,fa[136] = 1,ia[136] = -1,sa[136] = 0,oa[136] = 0,pa[136] = 0,da[136] = -1,va[136] = 0,la[136] = 0,ca[136] = -1,ha[136] = 1,Vu[136] = 1,$u[136] = 0,Ju[136] = 0,Ku[136] = 1,Qu[136] = 0,Gu[136] = 1,Yu[34] = 0,Zu[34] = -1,ea[34] = 0,ta[34] = 0,na[34] = -1,ra[34] = 1,ua[34] = 1,aa[34] = 0,fa[34] = 0,ia[34] = 1,sa[34] = 0,oa[34] = 1,pa[34] = 0,da[34] = 1,va[34] = 1,la[34] = 0,ca[34] = 1,ha[34] = 0,Vu[34] = -1,$u[34] = 0,Ju[34] = 1,Ku[34] = -1,Qu[34] = 0,Gu[34] = 0,Yu[35] = 0,Zu[35] = 1,ea[35] = 1,ta[35] = 0,na[35] = -1,ra[35] = 1,ua[35] = 1,aa[35] = 0,fa[35] = 0,ia[35] = -1,sa[35] = 0,oa[35] = 0,pa[35] = 0,da[35] = -1,va[35] = 0,la[35] = 0,ca[35] = 1,ha[35] = 0,Vu[35] = -1,$u[35] = 0,Ju[35] = 1,Ku[35] = 1,Qu[35] = 0,Gu[35] = 1,Yu[153] = 0,Zu[153] = 1,ea[153] = 1,ia[153] = -1,sa[153] = 0,oa[153] = 0,pa[153] = 0,da[153] = -1,va[153] = 0,Ku[153] = 1,Qu[153] = 0,Gu[153] = 1,ta[102] = 0,na[102] = -1,ra[102] = 1,ua[102] = 1,aa[102] = 0,fa[102] = 0,la[102] = 0,ca[102] = 1,ha[102] = 0,Vu[102] = -1,$u[102] = 0,Ju[102] = 1,Yu[155] = 0,Zu[155] = -1,ea[155] = 0,ia[155] = 1,sa[155] = 0,oa[155] = 1,pa[155] = 0,da[155] = 1,va[155] = 1,Ku[155] = -1,Qu[155] = 0,Gu[155] = 0,ta[103] = 0,na[103] = 1,ra[103] = 0,ua[103] = -1,aa[103] = 0,fa[103] = 1,la[103] = 0,ca[103] = -1,ha[103] = 1,Vu[103] = 1,$u[103] = 0,Ju[103] = 0,Yu[152] = 0,Zu[152] = 1,ea[152] = 1,ua[152] = -1,aa[152] = 0,fa[152] = 1,ia[152] = -1,sa[152] = 0,oa[152] = 0,pa[152] = 0,da[152] = -1,va[152] = 0,la[152] = 0,ca[152] = -1,ha[152] = 1,Ku[152] = 1,Qu[152] = 0,Gu[152] = 1,Yu[156] = 0,Zu[156] = -1,ea[156] = 1,ua[156] = 1,aa[156] = 0,fa[156] = 1,ia[156] = -1,sa[156] = 0,oa[156] = 0,pa[156] = 0,da[156] = -1,va[156] = 0,la[156] = 0,ca[156] = 1,ha[156] = 1,Ku[156] = -1,Qu[156] = 0,Gu[156] = 1,Yu[137] = 0,Zu[137] = 1,ea[137] = 1,ta[137] = 0,na[137] = 1,ra[137] = 0,ia[137] = -1,sa[137] = 0,oa[137] = 0,pa[137] = 0,da[137] = -1,va[137] = 0,Vu[137] = 1,$u[137] = 0,Ju[137] = 0,Ku[137] = 1,Qu[137] = 0,Gu[137] = 1,Yu[139] = 0,Zu[139] = 1,ea[139] = 1,ta[139] = 0,na[139] = -1,ra[139] = 0,ia[139] = 1,sa[139] = 0,oa[139] = 0,pa[139] = 0,da[139] = 1,va[139] = 0,Vu[139] = -1,$u[139] = 0,Ju[139] = 0,Ku[139] = 1,Qu[139] = 0,Gu[139] = 1,Yu[98] = 0,Zu[98] = -1,ea[98] = 0,ta[98] = 0,na[98] = -1,ra[98] = 1,ua[98] = 1,aa[98] = 0,fa[98] = 0,ia[98] = 1,sa[98] = 0,oa[98] = 1,la[98] = 0,ca[98] = 1,ha[98] = 0,Vu[98] = -1,$u[98] = 0,Ju[98] = 1,Yu[99] = 0,Zu[99] = 1,ea[99] = 0,ta[99] = 0,na[99] = -1,ra[99] = 1,ua[99] = 1,aa[99] = 0,fa[99] = 0,ia[99] = -1,sa[99] = 0,oa[99] = 1,la[99] = 0,ca[99] = -1,ha[99] = 0,Vu[99] = 1,$u[99] = 0,Ju[99] = 1,ta[38] = 0,na[38] = -1,ra[38] = 1,ua[38] = 1,aa[38] = 0,fa[38] = 0,pa[38] = 0,da[38] = 1,va[38] = 1,la[38] = 0,ca[38] = 1,ha[38] = 0,Vu[38] = -1,$u[38] = 0,Ju[38] = 1,Ku[38] = -1,Qu[38] = 0,Gu[38] = 0,ta[39] = 0,na[39] = 1,ra[39] = 1,ua[39] = -1,aa[39] = 0,fa[39] = 0,pa[39] = 0,da[39] = -1,va[39] = 1,la[39] = 0,ca[39] = 1,ha[39] = 0,Vu[39] = -1,$u[39] = 0,Ju[39] = 1,Ku[39] = 1,Qu[39] = 0,Gu[39] = 0;
    var ma = function (e) {
        return [[e.bottomleft, 0], [0, 0], [0, e.leftbottom]]
    }, ga = function (e) {
        return [[1, e.rightbottom], [1, 0], [e.bottomright, 0]]
    }, ya = function (e) {
        return [[e.topright, 1], [1, 1], [1, e.righttop]]
    }, ba = function (e) {
        return [[0, e.lefttop], [0, 1], [e.topleft, 1]]
    }, wa = function (e) {
        return [[e.bottomright, 0], [e.bottomleft, 0], [0, e.leftbottom], [0, e.lefttop]]
    }, Ea = function (e) {
        return [[e.bottomright, 0], [e.bottomleft, 0], [1, e.righttop], [1, e.rightbottom]]
    }, Sa = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [e.topleft, 1], [e.topright, 1]]
    }, xa = function (e) {
        return [[0, e.leftbottom], [0, e.lefttop], [e.topleft, 1], [e.topright, 1]]
    }, Ta = [], Na = [], Ca = [], ka = [], La = [], Aa = [], Oa = [], Ma = [];
    ka[1] = La[1] = 18, ka[169] = La[169] = 18, Ca[4] = Na[4] = 12, Ca[166] = Na[166] = 12, Ta[16] = Ma[16] = 4, Ta[154] = Ma[154] = 4, Aa[64] = Oa[64] = 22, Aa[106] = Oa[106] = 22, Ca[2] = Aa[2] = 17, ka[2] = La[2] = 18, Ca[168] = Aa[168] = 17, ka[168] = La[168] = 18, Ta[8] = ka[8] = 9, Na[8] = Ca[8] = 12, Ta[162] = ka[162] = 9, Na[162] = Ca[162] = 12, Ta[32] = Ma[32] = 4, Na[32] = Oa[32] = 1, Ta[138] = Ma[138] = 4, Na[138] = Oa[138] = 1, La[128] = Ma[128] = 21, Aa[128] = Oa[128] = 22, La[42] = Ma[42] = 21, Aa[42] = Oa[42] = 22, Na[5] = La[5] = 14, Na[165] = La[165] = 14, Ca[20] = Ma[20] = 6, Ca[150] = Ma[150] = 6, Ta[80] = Aa[80] = 11, Ta[90] = Aa[90] = 11, ka[65] = Oa[65] = 3, ka[105] = Oa[105] = 3, Ta[160] = Aa[160] = 11, Na[160] = La[160] = 14, Ta[10] = Aa[10] = 11, Na[10] = La[10] = 14, Ca[130] = Ma[130] = 6, ka[130] = Oa[130] = 3, Ca[40] = Ma[40] = 6, ka[40] = Oa[40] = 3, Na[101] = Oa[101] = 1, Na[69] = Oa[69] = 1, La[149] = Ma[149] = 21, La[21] = Ma[21] = 21, Ca[86] = Aa[86] = 17, Ca[84] = Aa[84] = 17, Ta[89] = ka[89] = 9, Ta[81] = ka[81] = 9, Ta[96] = Oa[96] = 0, Na[96] = Aa[96] = 15, Ta[74] = Oa[74] = 0, Na[74] = Aa[74] = 15, Ta[24] = Ca[24] = 8, ka[24] = Ma[24] = 7, Ta[146] = Ca[146] = 8, ka[146] = Ma[146] = 7, Na[6] = Aa[6] = 15, Ca[6] = La[6] = 16, Na[164] = Aa[164] = 15, Ca[164] = La[164] = 16, ka[129] = Ma[129] = 7, La[129] = Oa[129] = 20, ka[41] = Ma[41] = 7, La[41] = Oa[41] = 20, Ca[66] = Oa[66] = 2, ka[66] = Aa[66] = 19, Ca[104] = Oa[104] = 2, ka[104] = Aa[104] = 19, Ta[144] = La[144] = 10, Aa[144] = Ma[144] = 23, Ta[26] = La[26] = 10, Aa[26] = Ma[26] = 23, Na[36] = Ma[36] = 5, Ca[36] = Oa[36] = 2, Na[134] = Ma[134] = 5, Ca[134] = Oa[134] = 2, Ta[9] = La[9] = 10, Na[9] = ka[9] = 13, Ta[161] = La[161] = 10, Na[161] = ka[161] = 13, Na[37] = Ma[37] = 5, La[37] = Oa[37] = 20, Na[133] = Ma[133] = 5, La[133] = Oa[133] = 20, Ca[148] = La[148] = 16, Aa[148] = Ma[148] = 23, Ca[22] = La[22] = 16, Aa[22] = Ma[22] = 23, Ta[82] = Ca[82] = 8, ka[82] = Aa[82] = 19, Ta[88] = Ca[88] = 8, ka[88] = Aa[88] = 19, Ta[73] = Oa[73] = 0, Na[73] = ka[73] = 13, Ta[97] = Oa[97] = 0, Na[97] = ka[97] = 13, Ta[145] = ka[145] = 9, La[145] = Ma[145] = 21, Ta[25] = ka[25] = 9, La[25] = Ma[25] = 21, Na[70] = Oa[70] = 1,Ca[70] = Aa[70] = 17,Na[100] = Oa[100] = 1,Ca[100] = Aa[100] = 17,Ta[34] = ka[34] = 9,Na[34] = Ca[34] = 12,La[34] = Ma[34] = 21,Aa[34] = Oa[34] = 22,Ta[136] = Ma[136] = 4,Na[136] = Oa[136] = 1,Ca[136] = Aa[136] = 17,ka[136] = La[136] = 18,Ta[35] = Ma[35] = 4,Na[35] = Ca[35] = 12,ka[35] = La[35] = 18,Aa[35] = Oa[35] = 22,Ta[153] = Ma[153] = 4,ka[153] = La[153] = 18,Na[102] = Ca[102] = 12,Aa[102] = Oa[102] = 22,Ta[155] = ka[155] = 9,La[155] = Ma[155] = 23,Na[103] = Oa[103] = 1,Ca[103] = Aa[103] = 17,Ta[152] = Ma[152] = 4,Ca[152] = Aa[152] = 17,ka[152] = La[152] = 18,Ta[156] = Ca[156] = 8,ka[156] = La[156] = 18,Aa[156] = Ma[156] = 23,Ta[137] = Ma[137] = 4,Na[137] = Oa[137] = 1,ka[137] = La[137] = 18,Ta[139] = Ma[139] = 4,Na[139] = ka[139] = 13,La[139] = Oa[139] = 20,Ta[98] = ka[98] = 9,Na[98] = Ca[98] = 12,Aa[98] = Oa[98] = 22,Ta[99] = Oa[99] = 0,Na[99] = Ca[99] = 12,ka[99] = Aa[99] = 19,Na[38] = Ca[38] = 12,La[38] = Ma[38] = 21,Aa[38] = Oa[38] = 22,Na[39] = Ma[39] = 5,Ca[39] = La[39] = 16,Aa[39] = Oa[39] = 22;
    var _a = [];
    _a[1] = _a[169] = ma, _a[4] = _a[166] = ga, _a[16] = _a[154] = ya, _a[64] = _a[106] = ba, _a[168] = _a[2] = wa, _a[162] = _a[8] = Ea, _a[138] = _a[32] = Sa, _a[42] = _a[128] = xa, _a[5] = _a[165] = function (e) {
        return [[0, 0], [0, e.leftbottom], [1, e.rightbottom], [1, 0]]
    }, _a[20] = _a[150] = function (e) {
        return [[1, 0], [e.bottomright, 0], [e.topright, 1], [1, 1]]
    }, _a[80] = _a[90] = function (e) {
        return [[1, 1], [1, e.righttop], [0, e.lefttop], [0, 1]]
    }, _a[65] = _a[105] = function (e) {
        return [[e.bottomleft, 0], [0, 0], [0, 1], [e.topleft, 1]]
    }, _a[160] = _a[10] = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [0, e.leftbottom], [0, e.lefttop]]
    }, _a[130] = _a[40] = function (e) {
        return [[e.topleft, 1], [e.topright, 1], [e.bottomright, 0], [e.bottomleft, 0]]
    }, _a[85] = function () {
        return [[0, 0], [0, 1], [1, 1], [1, 0]]
    }, _a[101] = _a[69] = function (e) {
        return [[1, e.rightbottom], [1, 0], [0, 0], [0, 1], [e.topleft, 1]]
    }, _a[149] = _a[21] = function (e) {
        return [[e.topright, 1], [1, 1], [1, 0], [0, 0], [0, e.leftbottom]]
    }, _a[86] = _a[84] = function (e) {
        return [[1, 0], [e.bottomright, 0], [0, e.lefttop], [0, 1], [1, 1]]
    }, _a[89] = _a[81] = function (e) {
        return [[1, 1], [1, e.righttop], [e.bottomleft, 0], [0, 0], [0, 1]]
    }, _a[96] = _a[74] = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [0, e.lefttop], [0, 1], [e.topleft, 1]]
    }, _a[24] = _a[146] = function (e) {
        return [[1, 1], [1, e.righttop], [e.bottomright, 0], [e.bottomleft, 0], [e.topright, 1]]
    }, _a[6] = _a[164] = function (e) {
        return [[1, e.rightbottom], [1, 0], [e.bottomright, 0], [0, e.leftbottom], [0, e.lefttop]]
    }, _a[129] = _a[41] = function (e) {
        return [[e.topright, 1], [e.bottomleft, 0], [0, 0], [0, e.leftbottom], [e.topleft, 1]]
    }, _a[66] = _a[104] = function (e) {
        return [[e.bottomright, 0], [e.bottomleft, 0], [0, e.lefttop], [0, 1], [e.topleft, 1]]
    }, _a[144] = _a[26] = function (e) {
        return [[1, 1], [1, e.righttop], [0, e.leftbottom], [0, e.lefttop], [e.topright, 1]]
    }, _a[36] = _a[134] = function (e) {
        return [[1, e.rightbottom], [1, 0], [e.bottomright, 0], [e.topleft, 1], [e.topright, 1]]
    }, _a[9] = _a[161] = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [e.bottomleft, 0], [0, 0], [0, e.leftbottom]]
    }, _a[37] = _a[133] = function (e) {
        return [[1, e.rightbottom], [1, 0], [0, 0], [0, e.leftbottom], [e.topleft, 1], [e.topright, 1]]
    }, _a[148] = _a[22] = function (e) {
        return [[1, 1], [1, 0], [e.bottomright, 0], [0, e.leftbottom], [0, e.lefttop], [e.topright, 1]]
    }, _a[82] = _a[88] = function (e) {
        return [[1, 1], [1, e.righttop], [e.bottomright, 0], [e.bottomleft, 0], [0, e.lefttop], [0, 1]]
    }, _a[73] = _a[97] = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [e.bottomleft, 0], [0, 0], [0, 1], [e.topleft, 1]]
    }, _a[145] = _a[25] = function (e) {
        return [[1, 1], [1, e.righttop], [e.bottomleft, 0], [0, 0], [0, e.leftbottom], [e.topright, 1]]
    }, _a[70] = _a[100] = function (e) {
        return [[1, e.rightbottom], [1, 0], [e.bottomright, 0], [0, e.lefttop], [0, 1], [e.topleft, 1]]
    }, _a[34] = function (e) {
        return [xa(e), Ea(e)]
    }, _a[35] = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [e.bottomright, 0], [e.bottomleft, 0], [0, e.leftbottom], [0, e.lefttop], [e.topleft, 1], [e.topright, 1]]
    }, _a[136] = function (e) {
        return [Sa(e), wa(e)]
    }, _a[153] = function (e) {
        return [ya(e), ma(e)]
    }, _a[102] = function (e) {
        return [ga(e), ba(e)]
    }, _a[155] = function (e) {
        return [[1, 1], [1, e.righttop], [e.bottomleft, 0], [0, 0], [0, e.leftbottom], [e.topright, 1]]
    }, _a[103] = function (e) {
        return [[1, e.rightbottom], [1, 0], [e.bottomright, 0], [0, e.lefttop], [0, 1], [e.topleft, 1]]
    }, _a[152] = function (e) {
        return [ya(e), wa(e)]
    }, _a[156] = function (e) {
        return [[1, 1], [1, e.righttop], [e.bottomright, 0], [e.bottomleft, 0], [0, e.leftbottom], [0, e.lefttop], [e.topright, 1]]
    }, _a[137] = function (e) {
        return [Sa(e), ma(e)]
    }, _a[139] = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [e.bottomleft, 0], [0, 0], [0, e.leftbottom], [e.topleft, 1], [e.topright, 1]]
    }, _a[98] = function (e) {
        return [Ea(e), ba(e)]
    }, _a[99] = function (e) {
        return [[1, e.righttop], [1, e.rightbottom], [e.bottomright, 0], [e.bottomleft, 0], [0, e.lefttop], [0, 1], [e.topleft, 1]]
    }, _a[38] = function (e) {
        return [ga(e), xa(e)]
    }, _a[39] = function (e) {
        return [[1, e.rightbottom], [1, 0], [e.bottomright, 0], [0, e.leftbottom], [0, e.lefttop], [e.topleft, 1], [e.topright, 1]]
    };
    var Da = function Lv(e) {
        this.id = Lv.buildId(e), this.coordinates = e, this.innerEdges = [], this.outerEdges = [], this.outerEdgesSorted = !1
    };
    Da.buildId = function (e) {
        return e.join(",")
    }, Da.prototype.removeInnerEdge = function (e) {
        this.innerEdges = this.innerEdges.filter(function (t) {
            return t.from.id !== e.from.id
        })
    }, Da.prototype.removeOuterEdge = function (e) {
        this.outerEdges = this.outerEdges.filter(function (t) {
            return t.to.id !== e.to.id
        })
    }, Da.prototype.addOuterEdge = function (e) {
        this.outerEdges.push(e), this.outerEdgesSorted = !1
    }, Da.prototype.sortOuterEdges = function () {
        var e = this;
        this.outerEdgesSorted || (this.outerEdges.sort(function (t, n) {
            var r = t.to, i = n.to;
            if (r.coordinates[0] - e.coordinates[0] >= 0 && i.coordinates[0] - e.coordinates[0] < 0) return 1;
            if (r.coordinates[0] - e.coordinates[0] < 0 && i.coordinates[0] - e.coordinates[0] >= 0) return -1;
            if (r.coordinates[0] - e.coordinates[0] == 0 && i.coordinates[0] - e.coordinates[0] == 0) return r.coordinates[1] - e.coordinates[1] >= 0 || i.coordinates[1] - e.coordinates[1] >= 0 ? r.coordinates[1] - i.coordinates[1] : i.coordinates[1] - r.coordinates[1];
            var s = wi(e.coordinates, r.coordinates, i.coordinates);
            return s < 0 ? 1 : s > 0 ? -1 : Math.pow(r.coordinates[0] - e.coordinates[0], 2) + Math.pow(r.coordinates[1] - e.coordinates[1], 2) - (Math.pow(i.coordinates[0] - e.coordinates[0], 2) + Math.pow(i.coordinates[1] - e.coordinates[1], 2))
        }), this.outerEdgesSorted = !0)
    }, Da.prototype.getOuterEdges = function () {
        return this.sortOuterEdges(), this.outerEdges
    }, Da.prototype.getOuterEdge = function (e) {
        return this.sortOuterEdges(), this.outerEdges[e]
    }, Da.prototype.addInnerEdge = function (e) {
        this.innerEdges.push(e)
    };
    var Pa = function (e, t) {
        this.from = e, this.to = t, this.next = void 0, this.label = void 0, this.symetric = void 0, this.ring = void 0, this.from.addOuterEdge(this), this.to.addInnerEdge(this)
    };
    Pa.prototype.getSymetric = function () {
        return this.symetric || (this.symetric = new Pa(this.to, this.from), this.symetric.symetric = this), this.symetric
    }, Pa.prototype.deleteEdge = function () {
        this.from.removeOuterEdge(this), this.to.removeInnerEdge(this)
    }, Pa.prototype.isEqual = function (e) {
        return this.from.id === e.from.id && this.to.id === e.to.id
    }, Pa.prototype.toString = function () {
        return "Edge { " + this.from.id + " -> " + this.to.id + " }"
    }, Pa.prototype.toLineString = function () {
        return u([this.from.coordinates, this.to.coordinates])
    }, Pa.prototype.compareTo = function (e) {
        return wi(e.from.coordinates, e.to.coordinates, this.to.coordinates)
    };
    var Ha = function () {
        this.edges = [], this.polygon = void 0, this.envelope = void 0
    }, Ba = {length: {configurable: !0}};
    Ha.prototype.push = function (e) {
        this[this.edges.length] = e, this.edges.push(e), this.polygon = this.envelope = void 0
    }, Ha.prototype.get = function (e) {
        return this.edges[e]
    }, Ba.length.get = function () {
        return this.edges.length
    }, Ha.prototype.forEach = function (e) {
        this.edges.forEach(e)
    }, Ha.prototype.map = function (e) {
        return this.edges.map(e)
    }, Ha.prototype.some = function (e) {
        return this.edges.some(e)
    }, Ha.prototype.isValid = function () {
        return !0
    }, Ha.prototype.isHole = function () {
        var e = this, t = this.edges.reduce(function (t, n, r) {
                return n.from.coordinates[1] > e.edges[t].from.coordinates[1] && (t = r), t
            }, 0), n = (0 === t ? this.length : t) - 1, r = (t + 1) % this.length,
            i = wi(this.edges[n].from.coordinates, this.edges[t].from.coordinates, this.edges[r].from.coordinates);
        return 0 === i ? this.edges[n].from.coordinates[0] > this.edges[r].from.coordinates[0] : i > 0
    }, Ha.prototype.toMultiPoint = function () {
        return c(this.edges.map(function (e) {
            return e.from.coordinates
        }))
    }, Ha.prototype.toPolygon = function () {
        if (this.polygon) return this.polygon;
        var e = this.edges.map(function (e) {
            return e.from.coordinates
        });
        return e.push(this.edges[0].from.coordinates), this.polygon = s([e])
    }, Ha.prototype.getEnvelope = function () {
        return this.envelope ? this.envelope : this.envelope = cn(this.toPolygon())
    }, Ha.findEdgeRingContaining = function (e, t) {
        var n, i, s = e.getEnvelope();
        return t.forEach(function (t) {
            var o = t.getEnvelope();
            if (i && (n = i.getEnvelope()), !function (e, t) {
                var n = e.geometry.coordinates.map(function (e) {
                    return e[0]
                }), r = e.geometry.coordinates.map(function (e) {
                    return e[1]
                }), i = t.geometry.coordinates.map(function (e) {
                    return e[0]
                }), s = t.geometry.coordinates.map(function (e) {
                    return e[1]
                });
                return Math.max(null, n) === Math.max(null, i) && Math.max(null, r) === Math.max(null, s) && Math.min(null, n) === Math.min(null, i) && Math.min(null, r) === Math.min(null, s)
            }(o, s) && Ei(o, s)) {
                var u = e.map(function (e) {
                    return e.from.coordinates
                }).find(function (e) {
                    return !t.some(function (t) {
                        return function (e, t) {
                            return e[0] === t[0] && e[1] === t[1]
                        }(e, t.from.coordinates)
                    })
                });
                u && t.inside(r(u)) && (i && !Ei(n, o) || (i = t))
            }
        }), i
    }, Ha.prototype.inside = function (e) {
        return Ot(e, this.toPolygon())
    }, Object.defineProperties(Ha.prototype, Ba);
    var ja = function () {
        this.edges = [], this.nodes = {}
    };
    ja.fromGeoJson = function (e) {
        !function (e) {
            if (!e) throw new Error("No geojson passed");
            if ("FeatureCollection" !== e.type && "GeometryCollection" !== e.type && "MultiLineString" !== e.type && "LineString" !== e.type && "Feature" !== e.type) throw new Error("Invalid input type '" + e.type + "'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")
        }(e);
        var t = new ja;
        return B(e, function (e) {
            $(e, "LineString", "Graph::fromGeoJson"), L(e, function (e, n) {
                if (e) {
                    var r = t.getNode(e), i = t.getNode(n);
                    t.addEdge(r, i)
                }
                return n
            })
        }), t
    }, ja.prototype.getNode = function (e) {
        var t = Da.buildId(e), n = this.nodes[t];
        return n || (n = this.nodes[t] = new Da(e)), n
    }, ja.prototype.addEdge = function (e, t) {
        var n = new Pa(e, t), r = n.getSymetric();
        this.edges.push(n), this.edges.push(r)
    }, ja.prototype.deleteDangles = function () {
        var e = this;
        Object.keys(this.nodes).map(function (t) {
            return e.nodes[t]
        }).forEach(function (t) {
            return e._removeIfDangle(t)
        })
    }, ja.prototype._removeIfDangle = function (e) {
        var t = this;
        if (e.innerEdges.length <= 1) {
            var n = e.getOuterEdges().map(function (e) {
                return e.to
            });
            this.removeNode(e), n.forEach(function (e) {
                return t._removeIfDangle(e)
            })
        }
    }, ja.prototype.deleteCutEdges = function () {
        var e = this;
        this._computeNextCWEdges(), this._findLabeledEdgeRings(), this.edges.forEach(function (t) {
            t.label === t.symetric.label && (e.removeEdge(t.symetric), e.removeEdge(t))
        })
    }, ja.prototype._computeNextCWEdges = function (e) {
        var t = this;
        void 0 === e ? Object.keys(this.nodes).forEach(function (e) {
            return t._computeNextCWEdges(t.nodes[e])
        }) : e.getOuterEdges().forEach(function (t, n) {
            e.getOuterEdge((0 === n ? e.getOuterEdges().length : n) - 1).symetric.next = t
        })
    }, ja.prototype._computeNextCCWEdges = function (e, t) {
        for (var n, r, i = e.getOuterEdges(), s = i.length - 1; s >= 0; --s) {
            var o = i[s], u = o.symetric, a = void 0, f = void 0;
            o.label === t && (a = o), u.label === t && (f = u), a && f && (f && (r = f), a && (r && (r.next = a, r = void 0), n || (n = a)))
        }
        r && (r.next = n)
    }, ja.prototype._findLabeledEdgeRings = function () {
        var e = [], t = 0;
        return this.edges.forEach(function (n) {
            if (!(n.label >= 0)) {
                e.push(n);
                var r = n;
                do r.label = t, r = r.next; while (!n.isEqual(r));
                t++
            }
        }), e
    }, ja.prototype.getEdgeRings = function () {
        var e = this;
        this._computeNextCWEdges(), this.edges.forEach(function (e) {
            e.label = void 0
        }), this._findLabeledEdgeRings().forEach(function (t) {
            e._findIntersectionNodes(t).forEach(function (n) {
                e._computeNextCCWEdges(n, t.label)
            })
        });
        var t = [];
        return this.edges.forEach(function (n) {
            n.ring || t.push(e._findEdgeRing(n))
        }), t
    }, ja.prototype._findIntersectionNodes = function (e) {
        var t = [], n = e, r = function () {
            var r = 0;
            n.from.getOuterEdges().forEach(function (t) {
                t.label === e.label && ++r
            }), r > 1 && t.push(n.from), n = n.next
        };
        do r(); while (!e.isEqual(n));
        return t
    }, ja.prototype._findEdgeRing = function (e) {
        var t = e, n = new Ha;
        do n.push(t), t.ring = n, t = t.next; while (!e.isEqual(t));
        return n
    }, ja.prototype.removeNode = function (e) {
        var t = this;
        e.getOuterEdges().forEach(function (e) {
            return t.removeEdge(e)
        }), e.innerEdges.forEach(function (e) {
            return t.removeEdge(e)
        }), delete this.nodes[e.id]
    }, ja.prototype.removeEdge = function (e) {
        this.edges = this.edges.filter(function (t) {
            return !t.isEqual(e)
        }), e.deleteEdge()
    };
    var Fa = yt(function (e, t) {
        function n(e) {
            var t = [];
            for (var n in e) t.push(n);
            return t
        }

        (e.exports = "function" == typeof Object.keys ? Object.keys : n).shim = n
    }), Ia = (Fa.shim, yt(function (e, t) {
        function n(e) {
            return "[object Arguments]" == Object.prototype.toString.call(e)
        }

        function r(e) {
            return e && "object" == typeof e && "number" == typeof e.length && Object.prototype.hasOwnProperty.call(e, "callee") && !Object.prototype.propertyIsEnumerable.call(e, "callee") || !1
        }

        var i = "[object Arguments]" == function () {
            return Object.prototype.toString.call(arguments)
        }();
        (t = e.exports = i ? n : r).supported = n, t.unsupported = r
    })), qa = (Ia.supported, Ia.unsupported, yt(function (e) {
        function t(e) {
            return null === e || void 0 === e
        }

        function n(e) {
            return !!e && "object" == typeof e && "number" == typeof e.length && "function" == typeof e.copy && "function" == typeof e.slice && !(e.length > 0 && "number" != typeof e[0])
        }

        var r = Array.prototype.slice, i = e.exports = function (e, s, o) {
            return o || (o = {}), e === s || (e instanceof Date && s instanceof Date ? e.getTime() === s.getTime() : !e || !s || "object" != typeof e && "object" != typeof s ? o.strict ? e === s : e == s : function (e, s, o) {
                var u, a;
                if (t(e) || t(s)) return !1;
                if (e.prototype !== s.prototype) return !1;
                if (Ia(e)) return !!Ia(s) && (e = r.call(e), s = r.call(s), i(e, s, o));
                if (n(e)) {
                    if (!n(s)) return !1;
                    if (e.length !== s.length) return !1;
                    for (u = 0; u < e.length; u++) if (e[u] !== s[u]) return !1;
                    return !0
                }
                try {
                    var f = Fa(e), l = Fa(s)
                } catch (e) {
                    return !1
                }
                if (f.length != l.length) return !1;
                for (f.sort(), l.sort(), u = f.length - 1; u >= 0; u--) if (f[u] != l[u]) return !1;
                for (u = f.length - 1; u >= 0; u--) if (a = f[u], !i(e[a], s[a], o)) return !1;
                return typeof e == typeof s
            }(e, s, o))
        }
    })), Ra = function (e) {
        this.precision = e && e.precision ? e.precision : 17, this.direction = !!e && !!e.direction && e.direction, this.pseudoNode = !!e && !!e.pseudoNode && e.pseudoNode, this.objectComparator = e && e.objectComparator ? e.objectComparator : _i
    };
    Ra.prototype.compare = function (e, t) {
        if (e.type !== t.type || !Mi(e, t)) return !1;
        switch (e.type) {
            case"Point":
                return this.compareCoord(e.coordinates, t.coordinates);
            case"LineString":
                return this.compareLine(e.coordinates, t.coordinates, 0, !1);
            case"Polygon":
                return this.comparePolygon(e, t);
            case"Feature":
                return this.compareFeature(e, t);
            default:
                if (0 === e.type.indexOf("Multi")) {
                    var n = this, r = Oi(e), i = Oi(t);
                    return r.every(function (e) {
                        return this.some(function (t) {
                            return n.compare(e, t)
                        })
                    }, i)
                }
        }
        return !1
    }, Ra.prototype.compareCoord = function (e, t) {
        if (e.length !== t.length) return !1;
        for (var n = 0; n < e.length; n++) if (e[n].toFixed(this.precision) !== t[n].toFixed(this.precision)) return !1;
        return !0
    }, Ra.prototype.compareLine = function (e, t, n, r) {
        if (!Mi(e, t)) return !1;
        var i = this.pseudoNode ? e : this.removePseudo(e), s = this.pseudoNode ? t : this.removePseudo(t);
        if (!r || this.compareCoord(i[0], s[0]) || (s = this.fixStartIndex(s, i))) {
            var o = this.compareCoord(i[n], s[n]);
            return this.direction || o ? this.comparePath(i, s) : !!this.compareCoord(i[n], s[s.length - (1 + n)]) && this.comparePath(i.slice().reverse(), s)
        }
    }, Ra.prototype.fixStartIndex = function (e, t) {
        for (var n, r = -1, i = 0; i < e.length; i++) if (this.compareCoord(e[i], t[0])) {
            r = i;
            break
        }
        return r >= 0 && (n = [].concat(e.slice(r, e.length), e.slice(1, r + 1))), n
    }, Ra.prototype.comparePath = function (e, t) {
        var n = this;
        return e.every(function (e, t) {
            return n.compareCoord(e, this[t])
        }, t)
    }, Ra.prototype.comparePolygon = function (e, t) {
        if (this.compareLine(e.coordinates[0], t.coordinates[0], 1, !0)) {
            var n = e.coordinates.slice(1, e.coordinates.length), r = t.coordinates.slice(1, t.coordinates.length),
                i = this;
            return n.every(function (e) {
                return this.some(function (t) {
                    return i.compareLine(e, t, 1, !0)
                })
            }, r)
        }
        return !1
    }, Ra.prototype.compareFeature = function (e, t) {
        return e.id === t.id && !!this.objectComparator(e.properties, t.properties) && !!this.compareBBox(e, t) && this.compare(e.geometry, t.geometry)
    }, Ra.prototype.compareBBox = function (e, t) {
        return !!(!e.bbox && !t.bbox || e.bbox && t.bbox && this.compareCoord(e.bbox, t.bbox))
    }, Ra.prototype.removePseudo = function (e) {
        return e
    };
    var Ua = Ra, za = yt(function (e) {
        function t(e, t, n, r) {
            this.dataset = [], this.epsilon = 1, this.minPts = 2, this.distance = this._euclideanDistance, this.clusters = [], this.noise = [], this._visited = [], this._assigned = [], this._datasetLength = 0, this._init(e, t, n, r)
        }

        t.prototype.run = function (e, t, n, r) {
            this._init(e, t, n, r);
            for (var i = 0; i < this._datasetLength; i++) if (1 !== this._visited[i]) {
                this._visited[i] = 1;
                var s = this._regionQuery(i);
                if (s.length < this.minPts) this.noise.push(i); else {
                    var o = this.clusters.length;
                    this.clusters.push([]), this._addToCluster(i, o), this._expandCluster(o, s)
                }
            }
            return this.clusters
        }, t.prototype._init = function (e, t, n, r) {
            if (e) {
                if (!(e instanceof Array)) throw Error("Dataset must be of type array, " + typeof e + " given");
                this.dataset = e, this.clusters = [], this.noise = [], this._datasetLength = e.length, this._visited = new Array(this._datasetLength), this._assigned = new Array(this._datasetLength)
            }
            t && (this.epsilon = t), n && (this.minPts = n), r && (this.distance = r)
        }, t.prototype._expandCluster = function (e, t) {
            for (var n = 0; n < t.length; n++) {
                var r = t[n];
                if (1 !== this._visited[r]) {
                    this._visited[r] = 1;
                    var i = this._regionQuery(r);
                    i.length >= this.minPts && (t = this._mergeArrays(t, i))
                }
                1 !== this._assigned[r] && this._addToCluster(r, e)
            }
        }, t.prototype._addToCluster = function (e, t) {
            this.clusters[t].push(e), this._assigned[e] = 1
        }, t.prototype._regionQuery = function (e) {
            for (var t = [], n = 0; n < this._datasetLength; n++) this.distance(this.dataset[e], this.dataset[n]) < this.epsilon && t.push(n);
            return t
        }, t.prototype._mergeArrays = function (e, t) {
            for (var n = t.length, r = 0; r < n; r++) {
                var i = t[r];
                e.indexOf(i) < 0 && e.push(i)
            }
            return e
        }, t.prototype._euclideanDistance = function (e, t) {
            for (var n = 0, r = Math.min(e.length, t.length); r--;) n += (e[r] - t[r]) * (e[r] - t[r]);
            return Math.sqrt(n)
        }, e.exports && (e.exports = t)
    }), Wa = yt(function (e) {
        function t(e, t, n) {
            this.k = 3, this.dataset = [], this.assignments = [], this.centroids = [], this.init(e, t, n)
        }

        t.prototype.init = function (e, t, n) {
            this.assignments = [], this.centroids = [], void 0 !== e && (this.dataset = e), void 0 !== t && (this.k = t), void 0 !== n && (this.distance = n)
        }, t.prototype.run = function (e, t) {
            this.init(e, t);
            for (var n = this.dataset.length, r = 0; r < this.k; r++) this.centroids[r] = this.randomCentroid();
            for (var i = !0; i;) {
                i = this.assign();
                for (var s = 0; s < this.k; s++) {
                    for (var o = new Array(l), u = 0, a = 0; a < l; a++) o[a] = 0;
                    for (var f = 0; f < n; f++) {
                        var l = this.dataset[f].length;
                        if (s === this.assignments[f]) {
                            for (a = 0; a < l; a++) o[a] += this.dataset[f][a];
                            u++
                        }
                    }
                    if (u > 0) {
                        for (a = 0; a < l; a++) o[a] /= u;
                        this.centroids[s] = o
                    } else this.centroids[s] = this.randomCentroid(), i = !0
                }
            }
            return this.getClusters()
        }, t.prototype.randomCentroid = function () {
            var e, t, n = this.dataset.length - 1;
            do t = Math.round(Math.random() * n), e = this.dataset[t]; while (this.centroids.indexOf(e) >= 0);
            return e
        }, t.prototype.assign = function () {
            for (var e, t = !1, n = this.dataset.length, r = 0; r < n; r++) (e = this.argmin(this.dataset[r], this.centroids, this.distance)) != this.assignments[r] && (this.assignments[r] = e, t = !0);
            return t
        }, t.prototype.getClusters = function () {
            for (var e, t = new Array(this.k), n = 0; n < this.assignments.length; n++) void 0 === t[e = this.assignments[n]] && (t[e] = []), t[e].push(n);
            return t
        }, t.prototype.argmin = function (e, t, n) {
            for (var r, i = Number.MAX_VALUE, s = 0, o = t.length, u = 0; u < o; u++) (r = n(e, t[u])) < i && (i = r, s = u);
            return s
        }, t.prototype.distance = function (e, t) {
            for (var n = 0, r = Math.min(e.length, t.length); r--;) {
                var i = e[r] - t[r];
                n += i * i
            }
            return Math.sqrt(n)
        }, e.exports && (e.exports = t)
    }), Xa = yt(function (e) {
        function t(e, t, n) {
            this._queue = [], this._priorities = [], this._sorting = "desc", this._init(e, t, n)
        }

        t.prototype.insert = function (e, t) {
            for (var n = this._queue.length, r = n; r--;) {
                var i = this._priorities[r];
                "desc" === this._sorting ? t > i && (n = r) : t < i && (n = r)
            }
            this._insertAt(e, t, n)
        }, t.prototype.remove = function (e) {
            for (var t = this._queue.length; t--;) if (e === this._queue[t]) {
                this._queue.splice(t, 1), this._priorities.splice(t, 1);
                break
            }
        }, t.prototype.forEach = function (e) {
            this._queue.forEach(e)
        }, t.prototype.getElements = function () {
            return this._queue
        }, t.prototype.getElementPriority = function (e) {
            return this._priorities[e]
        }, t.prototype.getPriorities = function () {
            return this._priorities
        }, t.prototype.getElementsWithPriorities = function () {
            for (var e = [], t = 0, n = this._queue.length; t < n; t++) e.push([this._queue[t], this._priorities[t]]);
            return e
        }, t.prototype._init = function (e, t, n) {
            if (e && t) {
                if (this._queue = [], this._priorities = [], e.length !== t.length) throw new Error("Arrays must have the same length");
                for (var r = 0; r < e.length; r++) this.insert(e[r], t[r])
            }
            n && (this._sorting = n)
        }, t.prototype._insertAt = function (e, t, n) {
            this._queue.length === n ? (this._queue.push(e), this._priorities.push(t)) : (this._queue.splice(n, 0, e), this._priorities.splice(n, 0, t))
        }, e.exports && (e.exports = t)
    }), Va = yt(function (e) {
        function t(e, t, n, r) {
            this.epsilon = 1, this.minPts = 1, this.distance = this._euclideanDistance, this._reachability = [], this._processed = [], this._coreDistance = 0, this._orderedList = [], this._init(e, t, n, r)
        }

        if (e.exports) var n = Xa;
        t.prototype.run = function (e, t, r, i) {
            this._init(e, t, r, i);
            for (var s = 0, o = this.dataset.length; s < o; s++) if (1 !== this._processed[s]) {
                this._processed[s] = 1, this.clusters.push([s]);
                var u = this.clusters.length - 1;
                this._orderedList.push(s);
                var a = new n(null, null, "asc"), f = this._regionQuery(s);
                void 0 !== this._distanceToCore(s) && (this._updateQueue(s, f, a), this._expandCluster(u, a))
            }
            return this.clusters
        }, t.prototype.getReachabilityPlot = function () {
            for (var e = [], t = 0, n = this._orderedList.length; t < n; t++) {
                var r = this._orderedList[t], i = this._reachability[r];
                e.push([r, i])
            }
            return e
        }, t.prototype._init = function (e, t, n, r) {
            if (e) {
                if (!(e instanceof Array)) throw Error("Dataset must be of type array, " + typeof e + " given");
                this.dataset = e, this.clusters = [], this._reachability = new Array(this.dataset.length), this._processed = new Array(this.dataset.length), this._coreDistance = 0, this._orderedList = []
            }
            t && (this.epsilon = t), n && (this.minPts = n), r && (this.distance = r)
        }, t.prototype._updateQueue = function (e, t, n) {
            var r = this;
            this._coreDistance = this._distanceToCore(e), t.forEach(function (t) {
                if (void 0 === r._processed[t]) {
                    var i = r.distance(r.dataset[e], r.dataset[t]), s = Math.max(r._coreDistance, i);
                    void 0 === r._reachability[t] ? (r._reachability[t] = s, n.insert(t, s)) : s < r._reachability[t] && (r._reachability[t] = s, n.remove(t), n.insert(t, s))
                }
            })
        }, t.prototype._expandCluster = function (e, t) {
            for (var n = t.getElements(), r = 0, i = n.length; r < i; r++) {
                var s = n[r];
                if (void 0 === this._processed[s]) {
                    var o = this._regionQuery(s);
                    this._processed[s] = 1, this.clusters[e].push(s), this._orderedList.push(s), void 0 !== this._distanceToCore(s) && (this._updateQueue(s, o, t), this._expandCluster(e, t))
                }
            }
        }, t.prototype._distanceToCore = function (e) {
            for (var t = this.epsilon, n = 0; n < t; n++) if (this._regionQuery(e, n).length >= this.minPts) return n
        }, t.prototype._regionQuery = function (e, t) {
            t = t || this.epsilon;
            for (var n = [], r = 0, i = this.dataset.length; r < i; r++) this.distance(this.dataset[e], this.dataset[r]) < t && n.push(r);
            return n
        }, t.prototype._euclideanDistance = function (e, t) {
            for (var n = 0, r = Math.min(e.length, t.length); r--;) n += (e[r] - t[r]) * (e[r] - t[r]);
            return Math.sqrt(n)
        }, e.exports && (e.exports = t)
    }), $a = yt(function (e) {
        e.exports && (e.exports = {DBSCAN: za, KMEANS: Wa, OPTICS: Va, PriorityQueue: Xa})
    }), Ja = ($a.DBSCAN, $a.KMEANS, $a.OPTICS, $a.PriorityQueue, function (e, t, n) {
        for (var r = e.length, i = 0, s = 0; s < r; s++) {
            var o = (e[s] || 0) - (t[s] || 0);
            i += o * o
        }
        return n ? Math.sqrt(i) : i
    }), Ka = Ja, Qa = function (e, t, n) {
        var r = Math.abs(e - t);
        return n ? r : r * r
    }, Ga = Ja, Ya = function (e, t) {
        for (var n = {}, r = [], i = t << 2, s = e.length, o = e[0].length > 0; r.length < t && i-- > 0;) {
            var u = e[Math.floor(Math.random() * s)], a = o ? u.join("_") : "" + u;
            n[a] || (n[a] = !0, r.push(u))
        }
        if (r.length < t) throw new Error("Error initializating clusters");
        return r
    }, Za = function (e, t) {
        var n = e[0].length ? Ka : Qa, r = [], i = e.length, s = e[0].length > 0, o = e[Math.floor(Math.random() * i)];
        s && o.join("_");
        for (r.push(o); r.length < t;) {
            for (var u = [], a = r.length, f = 0, l = [], c = 0; c < i; c++) {
                for (var h = 1 / 0, p = 0; p < a; p++) {
                    var d = n(e[c], r[p]);
                    d <= h && (h = d)
                }
                u[c] = h
            }
            for (var v = 0; v < i; v++) f += u[v];
            for (var m = 0; m < i; m++) l[m] = {i: m, v: e[m], pr: u[m] / f, cs: 0};
            l.sort(function (e, t) {
                return e.pr - t.pr
            }), l[0].cs = l[0].pr;
            for (var g = 1; g < i; g++) l[g].cs = l[g - 1].cs + l[g].pr;
            for (var y = Math.random(), b = 0; b < i - 1 && l[b++].cs < y;) ;
            r.push(l[b - 1].v)
        }
        return r
    }, ef = 1e4, tf = function (e, t, n, r) {
        var i = [], s = [], o = [], u = [], a = !1, f = r || ef, l = e.length, c = e[0].length, h = c > 0, p = [];
        if (n) i = "kmrand" == n ? Ya(e, t) : "kmpp" == n ? Za(e, t) : n; else for (var d = {}; i.length < t;) {
            var v = Math.floor(Math.random() * l);
            d[v] || (d[v] = !0, i.push(e[v]))
        }
        do {
            Pi(t, 0, p);
            for (var m = 0; m < l; m++) {
                for (var g = 1 / 0, y = 0, b = 0; b < t; b++) (u = h ? Ga(e[m], i[b]) : Math.abs(e[m] - i[b])) <= g && (g = u, y = b);
                o[m] = y, p[y]++
            }
            for (var w = [], E = (s = [], 0); E < t; E++) w[E] = h ? Pi(c, 0, w[E]) : 0, s[E] = i[E];
            if (h) {
                for (var S = 0; S < t; S++) i[S] = [];
                for (var x = 0; x < l; x++) for (var T = w[o[x]], N = e[x], C = 0; C < c; C++) T[C] += N[C];
                a = !0;
                for (var k = 0; k < t; k++) {
                    for (var L = i[k], A = w[k], O = s[k], M = p[k], _ = 0; _ < c; _++) L[_] = A[_] / M || 0;
                    if (a) for (var D = 0; D < c; D++) if (O[D] != L[D]) {
                        a = !1;
                        break
                    }
                }
            } else {
                for (var P = 0; P < l; P++) w[o[P]] += e[P];
                for (var H = 0; H < t; H++) i[H] = w[H] / p[H] || 0;
                a = !0;
                for (var B = 0; B < t; B++) if (s[B] != i[B]) {
                    a = !1;
                    break
                }
            }
            a = a || --f <= 0
        } while (!a);
        return {it: ef - f, k: t, idxs: o, centroids: i}
    }, nf = {
        search: function (e, t, n, r) {
            e.cleanDirty();
            var i = (r = r || {}).heuristic || nf.heuristics.manhattan, s = r.closest || !1, o = new Ii(function (e) {
                return e.f
            }), u = t;
            for (t.h = i(t, n), o.push(t); o.size() > 0;) {
                var a = o.pop();
                if (a === n) return Bi(a);
                a.closed = !0;
                for (var f = e.neighbors(a), l = 0, c = f.length; l < c; ++l) {
                    var h = f[l];
                    if (!h.closed && !h.isWall()) {
                        var p = a.g + h.getCost(a), d = h.visited;
                        (!d || p < h.g) && (h.visited = !0, h.parent = a, h.h = h.h || i(h, n), h.g = p, h.f = h.g + h.h, e.markDirty(h), s && (h.h < u.h || h.h === u.h && h.g < u.g) && (u = h), d ? o.rescoreElement(h) : o.push(h))
                    }
                }
            }
            return s ? Bi(u) : []
        }, heuristics: {
            manhattan: function (e, t) {
                return Math.abs(t.x - e.x) + Math.abs(t.y - e.y)
            }, diagonal: function (e, t) {
                var n = Math.sqrt(2), r = Math.abs(t.x - e.x), i = Math.abs(t.y - e.y);
                return 1 * (r + i) + (n - 2) * Math.min(r, i)
            }
        }, cleanNode: function (e) {
            e.f = 0, e.g = 0, e.h = 0, e.visited = !1, e.closed = !1, e.parent = null
        }
    };
    ji.prototype.init = function () {
        this.dirtyNodes = [];
        for (var e = 0; e < this.nodes.length; e++) nf.cleanNode(this.nodes[e])
    }, ji.prototype.cleanDirty = function () {
        for (var e = 0; e < this.dirtyNodes.length; e++) nf.cleanNode(this.dirtyNodes[e]);
        this.dirtyNodes = []
    }, ji.prototype.markDirty = function (e) {
        this.dirtyNodes.push(e)
    }, ji.prototype.neighbors = function (e) {
        var t = [], n = e.x, r = e.y, i = this.grid;
        return i[n - 1] && i[n - 1][r] && t.push(i[n - 1][r]), i[n + 1] && i[n + 1][r] && t.push(i[n + 1][r]), i[n] && i[n][r - 1] && t.push(i[n][r - 1]), i[n] && i[n][r + 1] && t.push(i[n][r + 1]), this.diagonal && (i[n - 1] && i[n - 1][r - 1] && t.push(i[n - 1][r - 1]), i[n + 1] && i[n + 1][r - 1] && t.push(i[n + 1][r - 1]), i[n - 1] && i[n - 1][r + 1] && t.push(i[n - 1][r + 1]), i[n + 1] && i[n + 1][r + 1] && t.push(i[n + 1][r + 1])), t
    }, ji.prototype.toString = function () {
        for (var e, t, n, r, i = [], s = this.grid, o = 0, u = s.length; o < u; o++) {
            for (e = [], n = 0, r = (t = s[o]).length; n < r; n++) e.push(t[n].weight);
            i.push(e.join(" "))
        }
        return i.join("\n")
    }, Fi.prototype.toString = function () {
        return "[" + this.x + " " + this.y + "]"
    }, Fi.prototype.getCost = function (e) {
        return e && e.x !== this.x && e.y !== this.y ? 1.41421 * this.weight : this.weight
    }, Fi.prototype.isWall = function () {
        return 0 === this.weight
    }, Ii.prototype = {
        push: function (e) {
            this.content.push(e), this.sinkDown(this.content.length - 1)
        }, pop: function () {
            var e = this.content[0], t = this.content.pop();
            return this.content.length > 0 && (this.content[0] = t, this.bubbleUp(0)), e
        }, remove: function (e) {
            var t = this.content.indexOf(e), n = this.content.pop();
            t !== this.content.length - 1 && (this.content[t] = n, this.scoreFunction(n) < this.scoreFunction(e) ? this.sinkDown(t) : this.bubbleUp(t))
        }, size: function () {
            return this.content.length
        }, rescoreElement: function (e) {
            this.sinkDown(this.content.indexOf(e))
        }, sinkDown: function (e) {
            for (var t = this.content[e]; e > 0;) {
                var n = (e + 1 >> 1) - 1, r = this.content[n];
                if (!(this.scoreFunction(t) < this.scoreFunction(r))) break;
                this.content[n] = t, this.content[e] = r, e = n
            }
        }, bubbleUp: function (e) {
            for (var t = this.content.length, n = this.content[e], r = this.scoreFunction(n); ;) {
                var i, s = e + 1 << 1, o = s - 1, u = null;
                if (o < t) {
                    var a = this.content[o];
                    (i = this.scoreFunction(a)) < r && (u = o)
                }
                if (s < t) {
                    var f = this.content[s];
                    this.scoreFunction(f) < (null === u ? r : i) && (u = s)
                }
                if (null === u) break;
                this.content[e] = this.content[u], this.content[u] = n, e = u
            }
        }
    };
    var rf = function (e) {
        return function () {
            return e
        }
    };
    Ui.prototype = {
        constructor: Ui, insert: function (e, t) {
            var n, r, i;
            if (e) {
                if (t.P = e, t.N = e.N, e.N && (e.N.P = t), e.N = t, e.R) {
                    for (e = e.R; e.L;) e = e.L;
                    e.L = t
                } else e.R = t;
                n = e
            } else this._ ? (e = Vi(this._), t.P = null, t.N = e, e.P = e.L = t, n = e) : (t.P = t.N = null, this._ = t, n = null);
            for (t.L = t.R = null, t.U = n, t.C = !0, e = t; n && n.C;) n === (r = n.U).L ? (i = r.R) && i.C ? (n.C = i.C = !1, r.C = !0, e = r) : (e === n.R && (Wi(this, n), n = (e = n).U), n.C = !1, r.C = !0, Xi(this, r)) : (i = r.L) && i.C ? (n.C = i.C = !1, r.C = !0, e = r) : (e === n.L && (Xi(this, n), n = (e = n).U), n.C = !1, r.C = !0, Wi(this, r)), n = e.U;
            this._.C = !1
        }, remove: function (e) {
            e.N && (e.N.P = e.P), e.P && (e.P.N = e.N), e.N = e.P = null;
            var t, n, r, i = e.U, s = e.L, o = e.R;
            if (n = s ? o ? Vi(o) : s : o, i ? i.L === e ? i.L = n : i.R = n : this._ = n, s && o ? (r = n.C, n.C = e.C, n.L = s, s.U = n, n !== o ? (i = n.U, n.U = e.U, e = n.R, i.L = e, n.R = o, o.U = n) : (n.U = i, i = n, e = n.R)) : (r = e.C, e = n), e && (e.U = i), !r) if (e && e.C) e.C = !1; else {
                do {
                    if (e === this._) break;
                    if (e === i.L) {
                        if ((t = i.R).C && (t.C = !1, i.C = !0, Wi(this, i), t = i.R), t.L && t.L.C || t.R && t.R.C) {
                            t.R && t.R.C || (t.L.C = !1, t.C = !0, Xi(this, t), t = i.R), t.C = i.C, i.C = t.R.C = !1, Wi(this, i), e = this._;
                            break
                        }
                    } else if ((t = i.L).C && (t.C = !1, i.C = !0, Xi(this, i), t = i.L), t.L && t.L.C || t.R && t.R.C) {
                        t.L && t.L.C || (t.R.C = !1, t.C = !0, Wi(this, t), t = i.L), t.C = i.C, i.C = t.L.C = !1, Xi(this, i), e = this._;
                        break
                    }
                    t.C = !0, e = i, i = i.U
                } while (!e.C);
                e && (e.C = !1)
            }
        }
    };
    var sf, of, uf, af, ff, lf = [], cf = [], hf = 1e-6, pf = 1e-12;
    ls.prototype = {
        constructor: ls, polygons: function () {
            var e = this.edges;
            return this.cells.map(function (t) {
                var n = t.halfedges.map(function (n) {
                    return Zi(t, e[n])
                });
                return n.data = t.site.data, n
            })
        }, triangles: function () {
            var e = [], t = this.edges;
            return this.cells.forEach(function (n, r) {
                if (s = (i = n.halfedges).length) for (var i, s, o, u = n.site, a = -1, f = t[i[s - 1]], l = f.left === u ? f.right : f.left; ++a < s;) o = l, l = (f = t[i[a]]).left === u ? f.right : f.left, o && l && r < o.index && r < l.index && as(u, o, l) < 0 && e.push([u.data, o.data, l.data])
            }), e
        }, links: function () {
            return this.edges.filter(function (e) {
                return e.right
            }).map(function (e) {
                return {source: e.left.data, target: e.right.data}
            })
        }, find: function (e, t, n) {
            for (var r, i, s = this, o = s._found || 0, u = s.cells.length; !(i = s.cells[o]);) if (++o >= u) return null;
            var a = e - i.site[0], f = t - i.site[1], l = a * a + f * f;
            do i = s.cells[r = o], o = null, i.halfedges.forEach(function (n) {
                var r = s.edges[n], u = r.left;
                if (u !== i.site && u || (u = r.right)) {
                    var a = e - u[0], f = t - u[1], c = a * a + f * f;
                    c < l && (l = c, o = u.index)
                }
            }); while (null !== o);
            return s._found = r, null == n || l <= n * n ? i.site : null
        }
    };
    var df = function () {
            function e(e) {
                return new ls(e.map(function (r, i) {
                    var s = [Math.round(t(r, i, e) / hf) * hf, Math.round(n(r, i, e) / hf) * hf];
                    return s.index = i, s.data = r, s
                }), r)
            }

            var t = qi, n = Ri, r = null;
            return e.polygons = function (t) {
                return e(t).polygons()
            }, e.links = function (t) {
                return e(t).links()
            }, e.triangles = function (t) {
                return e(t).triangles()
            }, e.x = function (n) {
                return arguments.length ? (t = "function" == typeof n ? n : rf(+n), e) : t
            }, e.y = function (t) {
                return arguments.length ? (n = "function" == typeof t ? t : rf(+t), e) : n
            }, e.extent = function (t) {
                return arguments.length ? (r = null == t ? null : [[+t[0][0], +t[0][1]], [+t[1][0], +t[1][1]]], e) : r && [[r[0][0], r[0][1]], [r[1][0], r[1][1]]]
            }, e.size = function (t) {
                return arguments.length ? (r = null == t ? null : [[0, 0], [+t[0], +t[1]]], e) : r && [r[1][0] - r[0][0], r[1][1] - r[0][1]]
            }, e
        }, vf = Object.freeze({randomPosition: gs, randomPoint: ys, randomPolygon: bs, randomLineString: ws}),
        mf = Object.freeze({
            getCluster: Ss,
            clusterEach: xs,
            clusterReduce: Ts,
            createBins: Ns,
            applyFilter: Cs,
            propertiesContainsFilter: ks,
            filterProperties: Ls
        });
    "fill" in Array.prototype || Object.defineProperty(Array.prototype, "fill", {
        configurable: !0, value: function (e) {
            if (void 0 === this || null === this) throw new TypeError(this + " is not an object");
            var t = Object(this), n = Math.max(Math.min(t.length, 9007199254740991), 0) || 0,
                r = 1 in arguments ? parseInt(Number(arguments[1]), 10) || 0 : 0;
            r = r < 0 ? Math.max(n + r, 0) : Math.min(r, n);
            var i = 2 in arguments && void 0 !== arguments[2] ? parseInt(Number(arguments[2]), 10) || 0 : n;
            for (i = i < 0 ? Math.max(n + arguments[2], 0) : Math.min(i, n); r < i;) t[r] = e, ++r;
            return t
        }, writable: !0
    }), Number.isFinite = Number.isFinite || function (e) {
        return "number" == typeof e && isFinite(e)
    }, Number.isInteger = Number.isInteger || function (e) {
        return "number" == typeof e && isFinite(e) && Math.floor(e) === e
    }, Number.parseFloat = Number.parseFloat || parseFloat, Number.isNaN = Number.isNaN || function (e) {
        return e != e
    }, Math.trunc = Math.trunc || function (e) {
        return e < 0 ? Math.ceil(e) : Math.floor(e)
    };
    var gf = function () {
    };
    gf.prototype.interfaces_ = function () {
        return []
    }, gf.prototype.getClass = function () {
        return gf
    }, gf.prototype.equalsWithTolerance = function (e, t, n) {
        return Math.abs(e - t) <= n
    };
    var yf = function () {
    }, bf = function () {
    }, wf = {MAX_VALUE: {configurable: !0}};
    bf.isNaN = function (e) {
        return Number.isNaN(e)
    }, bf.doubleToLongBits = function (e) {
        return e
    }, bf.longBitsToDouble = function (e) {
        return e
    }, bf.isInfinite = function (e) {
        return !Number.isFinite(e)
    }, wf.MAX_VALUE.get = function () {
        return Number.MAX_VALUE
    }, Object.defineProperties(bf, wf);
    var Ef = function () {
    }, Sf = function () {
    }, xf = function () {
    }, Tf = function Av() {
        if (this.x = null, this.y = null, this.z = null, 0 === arguments.length) this.x = 0, this.y = 0, this.z = Av.NULL_ORDINATE; else if (1 === arguments.length) {
            var e = arguments[0];
            this.x = e.x, this.y = e.y, this.z = e.z
        } else 2 === arguments.length ? (this.x = arguments[0], this.y = arguments[1], this.z = Av.NULL_ORDINATE) : 3 === arguments.length && (this.x = arguments[0], this.y = arguments[1], this.z = arguments[2])
    }, Nf = {
        DimensionalComparator: {configurable: !0},
        serialVersionUID: {configurable: !0},
        NULL_ORDINATE: {configurable: !0},
        X: {configurable: !0},
        Y: {configurable: !0},
        Z: {configurable: !0}
    };
    Tf.prototype.setOrdinate = function (e, t) {
        switch (e) {
            case Tf.X:
                this.x = t;
                break;
            case Tf.Y:
                this.y = t;
                break;
            case Tf.Z:
                this.z = t;
                break;
            default:
                throw new yf("Invalid ordinate index: " + e)
        }
    }, Tf.prototype.equals2D = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return this.x === e.x && this.y === e.y
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return !!gf.equalsWithTolerance(this.x, t.x, n) && !!gf.equalsWithTolerance(this.y, t.y, n)
        }
    }, Tf.prototype.getOrdinate = function (e) {
        switch (e) {
            case Tf.X:
                return this.x;
            case Tf.Y:
                return this.y;
            case Tf.Z:
                return this.z
        }
        throw new yf("Invalid ordinate index: " + e)
    }, Tf.prototype.equals3D = function (e) {
        return this.x === e.x && this.y === e.y && (this.z === e.z || bf.isNaN(this.z)) && bf.isNaN(e.z)
    }, Tf.prototype.equals = function (e) {
        return e instanceof Tf && this.equals2D(e)
    }, Tf.prototype.equalInZ = function (e, t) {
        return gf.equalsWithTolerance(this.z, e.z, t)
    }, Tf.prototype.compareTo = function (e) {
        var t = e;
        return this.x < t.x ? -1 : this.x > t.x ? 1 : this.y < t.y ? -1 : this.y > t.y ? 1 : 0
    }, Tf.prototype.clone = function () {
    }, Tf.prototype.copy = function () {
        return new Tf(this)
    }, Tf.prototype.toString = function () {
        return "(" + this.x + ", " + this.y + ", " + this.z + ")"
    }, Tf.prototype.distance3D = function (e) {
        var t = this.x - e.x, n = this.y - e.y, r = this.z - e.z;
        return Math.sqrt(t * t + n * n + r * r)
    }, Tf.prototype.distance = function (e) {
        var t = this.x - e.x, n = this.y - e.y;
        return Math.sqrt(t * t + n * n)
    }, Tf.prototype.hashCode = function () {
        var e = 17;
        return e = 37 * e + Tf.hashCode(this.x), e = 37 * e + Tf.hashCode(this.y)
    }, Tf.prototype.setCoordinate = function (e) {
        this.x = e.x, this.y = e.y, this.z = e.z
    }, Tf.prototype.interfaces_ = function () {
        return [Ef, Sf, As]
    }, Tf.prototype.getClass = function () {
        return Tf
    }, Tf.hashCode = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = bf.doubleToLongBits(e);
            return Math.trunc((t ^ t) >>> 32)
        }
    }, Nf.DimensionalComparator.get = function () {
        return Cf
    }, Nf.serialVersionUID.get = function () {
        return 0x5cbf2c235c7e5800
    }, Nf.NULL_ORDINATE.get = function () {
        return bf.NaN
    }, Nf.X.get = function () {
        return 0
    }, Nf.Y.get = function () {
        return 1
    }, Nf.Z.get = function () {
        return 2
    }, Object.defineProperties(Tf, Nf);
    var Cf = function (e) {
        if (this._dimensionsToTest = 2, 0 !== arguments.length) if (1 === arguments.length) {
            var t = arguments[0];
            if (2 !== t && 3 !== t) throw new yf("only 2 or 3 dimensions may be specified");
            this._dimensionsToTest = t
        }
    };
    Cf.prototype.compare = function (e, t) {
        var n = e, r = t, i = Cf.compare(n.x, r.x);
        if (0 !== i) return i;
        var s = Cf.compare(n.y, r.y);
        return 0 !== s ? s : this._dimensionsToTest <= 2 ? 0 : Cf.compare(n.z, r.z)
    }, Cf.prototype.interfaces_ = function () {
        return [xf]
    }, Cf.prototype.getClass = function () {
        return Cf
    }, Cf.compare = function (e, t) {
        return e < t ? -1 : e > t ? 1 : bf.isNaN(e) ? bf.isNaN(t) ? 0 : -1 : bf.isNaN(t) ? 1 : 0
    };
    var kf = function () {
    };
    kf.prototype.create = function () {
    }, kf.prototype.interfaces_ = function () {
        return []
    }, kf.prototype.getClass = function () {
        return kf
    };
    var Lf = function () {
    }, Af = {
        INTERIOR: {configurable: !0},
        BOUNDARY: {configurable: !0},
        EXTERIOR: {configurable: !0},
        NONE: {configurable: !0}
    };
    Lf.prototype.interfaces_ = function () {
        return []
    }, Lf.prototype.getClass = function () {
        return Lf
    }, Lf.toLocationSymbol = function (e) {
        switch (e) {
            case Lf.EXTERIOR:
                return "e";
            case Lf.BOUNDARY:
                return "b";
            case Lf.INTERIOR:
                return "i";
            case Lf.NONE:
                return "-"
        }
        throw new yf("Unknown location value: " + e)
    }, Af.INTERIOR.get = function () {
        return 0
    }, Af.BOUNDARY.get = function () {
        return 1
    }, Af.EXTERIOR.get = function () {
        return 2
    }, Af.NONE.get = function () {
        return -1
    }, Object.defineProperties(Lf, Af);
    var Of = function (e, t) {
        return e.interfaces_ && e.interfaces_().indexOf(t) > -1
    }, Mf = function () {
    }, _f = {LOG_10: {configurable: !0}};
    Mf.prototype.interfaces_ = function () {
        return []
    }, Mf.prototype.getClass = function () {
        return Mf
    }, Mf.log10 = function (e) {
        var t = Math.log(e);
        return bf.isInfinite(t) ? t : bf.isNaN(t) ? t : t / Mf.LOG_10
    }, Mf.min = function (e, t, n, r) {
        var i = e;
        return t < i && (i = t), n < i && (i = n), r < i && (i = r), i
    }, Mf.clamp = function () {
        if ("number" == typeof arguments[2] && "number" == typeof arguments[0] && "number" == typeof arguments[1]) {
            var e = arguments[0], t = arguments[1], n = arguments[2];
            return e < t ? t : e > n ? n : e
        }
        if (Number.isInteger(arguments[2]) && Number.isInteger(arguments[0]) && Number.isInteger(arguments[1])) {
            var r = arguments[0], i = arguments[1], s = arguments[2];
            return r < i ? i : r > s ? s : r
        }
    }, Mf.wrap = function (e, t) {
        return e < 0 ? t - -e % t : e % t
    }, Mf.max = function () {
        if (3 === arguments.length) {
            var e = arguments[0], t = arguments[1], n = arguments[2], r = e;
            return t > r && (r = t), n > r && (r = n), r
        }
        if (4 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2], u = arguments[3], a = i;
            return s > a && (a = s), o > a && (a = o), u > a && (a = u), a
        }
    }, Mf.average = function (e, t) {
        return (e + t) / 2
    }, _f.LOG_10.get = function () {
        return Math.log(10)
    }, Object.defineProperties(Mf, _f);
    var Df = function (e) {
        this.str = e
    };
    Df.prototype.append = function (e) {
        this.str += e
    }, Df.prototype.setCharAt = function (e, t) {
        this.str = this.str.substr(0, e) + t + this.str.substr(e + 1)
    }, Df.prototype.toString = function (e) {
        return this.str
    };
    var Pf = function (e) {
        this.value = e
    };
    Pf.prototype.intValue = function () {
        return this.value
    }, Pf.prototype.compareTo = function (e) {
        return this.value < e ? -1 : this.value > e ? 1 : 0
    }, Pf.isNaN = function (e) {
        return Number.isNaN(e)
    };
    var Hf = function () {
    };
    Hf.isWhitespace = function (e) {
        return e <= 32 && e >= 0 || 127 === e
    }, Hf.toUpperCase = function (e) {
        return e.toUpperCase()
    };
    var Bf = function Ov() {
        if (this._hi = 0, this._lo = 0, 0 === arguments.length) this.init(0); else if (1 === arguments.length) {
            if ("number" == typeof arguments[0]) {
                var e = arguments[0];
                this.init(e)
            } else if (arguments[0] instanceof Ov) {
                var t = arguments[0];
                this.init(t)
            } else if ("string" == typeof arguments[0]) {
                var n = arguments[0];
                Ov.call(this, Ov.parse(n))
            }
        } else if (2 === arguments.length) {
            var r = arguments[0], i = arguments[1];
            this.init(r, i)
        }
    }, jf = {
        PI: {configurable: !0},
        TWO_PI: {configurable: !0},
        PI_2: {configurable: !0},
        E: {configurable: !0},
        NaN: {configurable: !0},
        EPS: {configurable: !0},
        SPLIT: {configurable: !0},
        MAX_PRINT_DIGITS: {configurable: !0},
        TEN: {configurable: !0},
        ONE: {configurable: !0},
        SCI_NOT_EXPONENT_CHAR: {configurable: !0},
        SCI_NOT_ZERO: {configurable: !0}
    };
    Bf.prototype.le = function (e) {
        return (this._hi < e._hi || this._hi === e._hi) && this._lo <= e._lo
    }, Bf.prototype.extractSignificantDigits = function (e, t) {
        var n = this.abs(), r = Bf.magnitude(n._hi), i = Bf.TEN.pow(r);
        (n = n.divide(i)).gt(Bf.TEN) ? (n = n.divide(Bf.TEN), r += 1) : n.lt(Bf.ONE) && (n = n.multiply(Bf.TEN), r -= 1);
        for (var s = r + 1, o = new Df, u = Bf.MAX_PRINT_DIGITS - 1, a = 0; a <= u; a++) {
            e && a === s && o.append(".");
            var f = Math.trunc(n._hi);
            if (f < 0) break;
            var l = !1, c = 0;
            f > 9 ? (l = !0, c = "9") : c = "0" + f, o.append(c), n = n.subtract(Bf.valueOf(f)).multiply(Bf.TEN), l && n.selfAdd(Bf.TEN);
            var h = !0, p = Bf.magnitude(n._hi);
            if (p < 0 && Math.abs(p) >= u - a && (h = !1), !h) break
        }
        return t[0] = r, o.toString()
    }, Bf.prototype.sqr = function () {
        return this.multiply(this)
    }, Bf.prototype.doubleValue = function () {
        return this._hi + this._lo
    }, Bf.prototype.subtract = function () {
        if (arguments[0] instanceof Bf) {
            var e = arguments[0];
            return this.add(e.negate())
        }
        if ("number" == typeof arguments[0]) {
            var t = arguments[0];
            return this.add(-t)
        }
    }, Bf.prototype.equals = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return this._hi === e._hi && this._lo === e._lo
        }
    }, Bf.prototype.isZero = function () {
        return 0 === this._hi && 0 === this._lo
    }, Bf.prototype.selfSubtract = function () {
        if (arguments[0] instanceof Bf) {
            var e = arguments[0];
            return this.isNaN() ? this : this.selfAdd(-e._hi, -e._lo)
        }
        if ("number" == typeof arguments[0]) {
            var t = arguments[0];
            return this.isNaN() ? this : this.selfAdd(-t, 0)
        }
    }, Bf.prototype.getSpecialNumberString = function () {
        return this.isZero() ? "0.0" : this.isNaN() ? "NaN " : null
    }, Bf.prototype.min = function (e) {
        return this.le(e) ? this : e
    }, Bf.prototype.selfDivide = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Bf) {
                var e = arguments[0];
                return this.selfDivide(e._hi, e._lo)
            }
            if ("number" == typeof arguments[0]) {
                var t = arguments[0];
                return this.selfDivide(t, 0)
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = null, s = null, o = null, u = null, a = null, f = null,
                l = null, c = null;
            return a = this._hi / n, f = Bf.SPLIT * a, i = f - a, c = Bf.SPLIT * n, i = f - i, s = a - i, o = c - n, l = a * n, o = c - o, u = n - o, c = i * o - l + i * u + s * o + s * u, f = (this._hi - l - c + this._lo - a * r) / n, c = a + f, this._hi = c, this._lo = a - c + f, this
        }
    }, Bf.prototype.dump = function () {
        return "DD<" + this._hi + ", " + this._lo + ">"
    }, Bf.prototype.divide = function () {
        if (arguments[0] instanceof Bf) {
            var e = arguments[0], t = null, n = null, r = null, i = null, s = null, o = null, u = null, a = null;
            return n = (s = this._hi / e._hi) - (t = (o = Bf.SPLIT * s) - (t = o - s)), a = t * (r = (a = Bf.SPLIT * e._hi) - (r = a - e._hi)) - (u = s * e._hi) + t * (i = e._hi - r) + n * r + n * i, o = (this._hi - u - a + this._lo - s * e._lo) / e._hi, new Bf(a = s + o, s - a + o)
        }
        if ("number" == typeof arguments[0]) {
            var f = arguments[0];
            return bf.isNaN(f) ? Bf.createNaN() : Bf.copy(this).selfDivide(f, 0)
        }
    }, Bf.prototype.ge = function (e) {
        return (this._hi > e._hi || this._hi === e._hi) && this._lo >= e._lo
    }, Bf.prototype.pow = function (e) {
        if (0 === e) return Bf.valueOf(1);
        var t = new Bf(this), n = Bf.valueOf(1), r = Math.abs(e);
        if (r > 1) for (; r > 0;) r % 2 == 1 && n.selfMultiply(t), (r /= 2) > 0 && (t = t.sqr()); else n = t;
        return e < 0 ? n.reciprocal() : n
    }, Bf.prototype.ceil = function () {
        if (this.isNaN()) return Bf.NaN;
        var e = Math.ceil(this._hi), t = 0;
        return e === this._hi && (t = Math.ceil(this._lo)), new Bf(e, t)
    }, Bf.prototype.compareTo = function (e) {
        var t = e;
        return this._hi < t._hi ? -1 : this._hi > t._hi ? 1 : this._lo < t._lo ? -1 : this._lo > t._lo ? 1 : 0
    }, Bf.prototype.rint = function () {
        return this.isNaN() ? this : this.add(.5).floor()
    }, Bf.prototype.setValue = function () {
        if (arguments[0] instanceof Bf) {
            var e = arguments[0];
            return this.init(e), this
        }
        if ("number" == typeof arguments[0]) {
            var t = arguments[0];
            return this.init(t), this
        }
    }, Bf.prototype.max = function (e) {
        return this.ge(e) ? this : e
    }, Bf.prototype.sqrt = function () {
        if (this.isZero()) return Bf.valueOf(0);
        if (this.isNegative()) return Bf.NaN;
        var e = 1 / Math.sqrt(this._hi), t = this._hi * e, n = Bf.valueOf(t), r = this.subtract(n.sqr())._hi * .5 * e;
        return n.add(r)
    }, Bf.prototype.selfAdd = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Bf) {
                var e = arguments[0];
                return this.selfAdd(e._hi, e._lo)
            }
            if ("number" == typeof arguments[0]) {
                var t = arguments[0], n = null, r = null, i = null, s = null, o = null, u = null;
                return i = this._hi + t, o = i - this._hi, s = i - o, s = t - o + (this._hi - s), u = s + this._lo, n = i + u, r = u + (i - n), this._hi = n + r, this._lo = r + (n - this._hi), this
            }
        } else if (2 === arguments.length) {
            var a = arguments[0], f = arguments[1], l = null, c = null, h = null, p = null, d = null, v = null,
                m = null;
            p = this._hi + a, c = this._lo + f, d = p - (v = p - this._hi), h = c - (m = c - this._lo);
            var g = (l = p + (v = (d = a - v + (this._hi - d)) + c)) + (v = (h = f - m + (this._lo - h)) + (v + (p - l))),
                y = v + (l - g);
            return this._hi = g, this._lo = y, this
        }
    }, Bf.prototype.selfMultiply = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Bf) {
                var e = arguments[0];
                return this.selfMultiply(e._hi, e._lo)
            }
            if ("number" == typeof arguments[0]) {
                var t = arguments[0];
                return this.selfMultiply(t, 0)
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = null, s = null, o = null, u = null, a = null, f = null;
            i = (a = Bf.SPLIT * this._hi) - this._hi, f = Bf.SPLIT * n, i = a - i, s = this._hi - i, o = f - n;
            var l = (a = this._hi * n) + (f = i * (o = f - o) - a + i * (u = n - o) + s * o + s * u + (this._hi * r + this._lo * n)),
                c = f + (i = a - l);
            return this._hi = l, this._lo = c, this
        }
    }, Bf.prototype.selfSqr = function () {
        return this.selfMultiply(this)
    }, Bf.prototype.floor = function () {
        if (this.isNaN()) return Bf.NaN;
        var e = Math.floor(this._hi), t = 0;
        return e === this._hi && (t = Math.floor(this._lo)), new Bf(e, t)
    }, Bf.prototype.negate = function () {
        return this.isNaN() ? this : new Bf(-this._hi, -this._lo)
    }, Bf.prototype.clone = function () {
    }, Bf.prototype.multiply = function () {
        if (arguments[0] instanceof Bf) {
            var e = arguments[0];
            return e.isNaN() ? Bf.createNaN() : Bf.copy(this).selfMultiply(e)
        }
        if ("number" == typeof arguments[0]) {
            var t = arguments[0];
            return bf.isNaN(t) ? Bf.createNaN() : Bf.copy(this).selfMultiply(t, 0)
        }
    }, Bf.prototype.isNaN = function () {
        return bf.isNaN(this._hi)
    }, Bf.prototype.intValue = function () {
        return Math.trunc(this._hi)
    }, Bf.prototype.toString = function () {
        var e = Bf.magnitude(this._hi);
        return e >= -3 && e <= 20 ? this.toStandardNotation() : this.toSciNotation()
    }, Bf.prototype.toStandardNotation = function () {
        var e = this.getSpecialNumberString();
        if (null !== e) return e;
        var t = (new Array(1)).fill(null), n = this.extractSignificantDigits(!0, t), r = t[0] + 1, i = n;
        if ("." === n.charAt(0)) i = "0" + n; else if (r < 0) i = "0." + Bf.stringOfChar("0", -r) + n; else if (-1 === n.indexOf(".")) {
            var s = r - n.length;
            i = n + Bf.stringOfChar("0", s) + ".0"
        }
        return this.isNegative() ? "-" + i : i
    }, Bf.prototype.reciprocal = function () {
        var e = null, t = null, n = null, r = null, i = null, s = null, o = null, u = null;
        t = (i = 1 / this._hi) - (e = (s = Bf.SPLIT * i) - (e = s - i)), n = (u = Bf.SPLIT * this._hi) - this._hi;
        var a = i + (s = (1 - (o = i * this._hi) - (u = e * (n = u - n) - o + e * (r = this._hi - n) + t * n + t * r) - i * this._lo) / this._hi);
        return new Bf(a, i - a + s)
    }, Bf.prototype.toSciNotation = function () {
        if (this.isZero()) return Bf.SCI_NOT_ZERO;
        var e = this.getSpecialNumberString();
        if (null !== e) return e;
        var t = (new Array(1)).fill(null), n = this.extractSignificantDigits(!1, t),
            r = Bf.SCI_NOT_EXPONENT_CHAR + t[0];
        if ("0" === n.charAt(0)) throw new Error("Found leading zero: " + n);
        var i = "";
        n.length > 1 && (i = n.substring(1));
        var s = n.charAt(0) + "." + i;
        return this.isNegative() ? "-" + s + r : s + r
    }, Bf.prototype.abs = function () {
        return this.isNaN() ? Bf.NaN : this.isNegative() ? this.negate() : new Bf(this)
    }, Bf.prototype.isPositive = function () {
        return (this._hi > 0 || 0 === this._hi) && this._lo > 0
    }, Bf.prototype.lt = function (e) {
        return (this._hi < e._hi || this._hi === e._hi) && this._lo < e._lo
    }, Bf.prototype.add = function () {
        if (arguments[0] instanceof Bf) {
            var e = arguments[0];
            return Bf.copy(this).selfAdd(e)
        }
        if ("number" == typeof arguments[0]) {
            var t = arguments[0];
            return Bf.copy(this).selfAdd(t)
        }
    }, Bf.prototype.init = function () {
        if (1 === arguments.length) {
            if ("number" == typeof arguments[0]) {
                var e = arguments[0];
                this._hi = e, this._lo = 0
            } else if (arguments[0] instanceof Bf) {
                var t = arguments[0];
                this._hi = t._hi, this._lo = t._lo
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            this._hi = n, this._lo = r
        }
    }, Bf.prototype.gt = function (e) {
        return (this._hi > e._hi || this._hi === e._hi) && this._lo > e._lo
    }, Bf.prototype.isNegative = function () {
        return (this._hi < 0 || 0 === this._hi) && this._lo < 0
    }, Bf.prototype.trunc = function () {
        return this.isNaN() ? Bf.NaN : this.isPositive() ? this.floor() : this.ceil()
    }, Bf.prototype.signum = function () {
        return this._hi > 0 ? 1 : this._hi < 0 ? -1 : this._lo > 0 ? 1 : this._lo < 0 ? -1 : 0
    }, Bf.prototype.interfaces_ = function () {
        return [As, Ef, Sf]
    }, Bf.prototype.getClass = function () {
        return Bf
    }, Bf.sqr = function (e) {
        return Bf.valueOf(e).selfMultiply(e)
    }, Bf.valueOf = function () {
        if ("string" == typeof arguments[0]) {
            var e = arguments[0];
            return Bf.parse(e)
        }
        if ("number" == typeof arguments[0]) {
            var t = arguments[0];
            return new Bf(t)
        }
    }, Bf.sqrt = function (e) {
        return Bf.valueOf(e).sqrt()
    }, Bf.parse = function (e) {
        for (var t = 0, n = e.length; Hf.isWhitespace(e.charAt(t));) t++;
        var r = !1;
        if (t < n) {
            var i = e.charAt(t);
            "-" !== i && "+" !== i || (t++, "-" === i && (r = !0))
        }
        for (var s = new Bf, o = 0, u = 0, a = 0; !(t >= n);) {
            var f = e.charAt(t);
            if (t++, Hf.isDigit(f)) {
                var l = f - "0";
                s.selfMultiply(Bf.TEN), s.selfAdd(l), o++
            } else {
                if ("." !== f) {
                    if ("e" === f || "E" === f) {
                        var c = e.substring(t);
                        try {
                            a = Pf.parseInt(c)
                        } catch (t) {
                            throw t instanceof Error ? new Error("Invalid exponent " + c + " in string " + e) : t
                        }
                        break
                    }
                    throw new Error("Unexpected character '" + f + "' at position " + t + " in string " + e)
                }
                u = o
            }
        }
        var h = s, p = o - u - a;
        if (0 === p) h = s; else if (p > 0) {
            var d = Bf.TEN.pow(p);
            h = s.divide(d)
        } else if (p < 0) {
            var v = Bf.TEN.pow(-p);
            h = s.multiply(v)
        }
        return r ? h.negate() : h
    }, Bf.createNaN = function () {
        return new Bf(bf.NaN, bf.NaN)
    }, Bf.copy = function (e) {
        return new Bf(e)
    }, Bf.magnitude = function (e) {
        var t = Math.abs(e), n = Math.log(t) / Math.log(10), r = Math.trunc(Math.floor(n));
        return 10 * Math.pow(10, r) <= t && (r += 1), r
    }, Bf.stringOfChar = function (e, t) {
        for (var n = new Df, r = 0; r < t; r++) n.append(e);
        return n.toString()
    }, jf.PI.get = function () {
        return new Bf(3.141592653589793, 1.2246467991473532e-16)
    }, jf.TWO_PI.get = function () {
        return new Bf(6.283185307179586, 2.4492935982947064e-16)
    }, jf.PI_2.get = function () {
        return new Bf(1.5707963267948966, 6.123233995736766e-17)
    }, jf.E.get = function () {
        return new Bf(2.718281828459045, 1.4456468917292502e-16)
    }, jf.NaN.get = function () {
        return new Bf(bf.NaN, bf.NaN)
    }, jf.EPS.get = function () {
        return 1.23259516440783e-32
    }, jf.SPLIT.get = function () {
        return 134217729
    }, jf.MAX_PRINT_DIGITS.get = function () {
        return 32
    }, jf.TEN.get = function () {
        return Bf.valueOf(10)
    }, jf.ONE.get = function () {
        return Bf.valueOf(1)
    }, jf.SCI_NOT_EXPONENT_CHAR.get = function () {
        return "E"
    }, jf.SCI_NOT_ZERO.get = function () {
        return "0.0E0"
    }, Object.defineProperties(Bf, jf);
    var Ff = function () {
    }, If = {DP_SAFE_EPSILON: {configurable: !0}};
    Ff.prototype.interfaces_ = function () {
        return []
    }, Ff.prototype.getClass = function () {
        return Ff
    }, Ff.orientationIndex = function (e, t, n) {
        var r = Ff.orientationIndexFilter(e, t, n);
        if (r <= 1) return r;
        var i = Bf.valueOf(t.x).selfAdd(-e.x), s = Bf.valueOf(t.y).selfAdd(-e.y), o = Bf.valueOf(n.x).selfAdd(-t.x),
            u = Bf.valueOf(n.y).selfAdd(-t.y);
        return i.selfMultiply(u).selfSubtract(s.selfMultiply(o)).signum()
    }, Ff.signOfDet2x2 = function (e, t, n, r) {
        return e.multiply(r).selfSubtract(t.multiply(n)).signum()
    }, Ff.intersection = function (e, t, n, r) {
        var i = Bf.valueOf(r.y).selfSubtract(n.y).selfMultiply(Bf.valueOf(t.x).selfSubtract(e.x)),
            s = Bf.valueOf(r.x).selfSubtract(n.x).selfMultiply(Bf.valueOf(t.y).selfSubtract(e.y)), o = i.subtract(s),
            u = Bf.valueOf(r.x).selfSubtract(n.x).selfMultiply(Bf.valueOf(e.y).selfSubtract(n.y)),
            a = Bf.valueOf(r.y).selfSubtract(n.y).selfMultiply(Bf.valueOf(e.x).selfSubtract(n.x)),
            f = u.subtract(a).selfDivide(o).doubleValue(),
            l = Bf.valueOf(e.x).selfAdd(Bf.valueOf(t.x).selfSubtract(e.x).selfMultiply(f)).doubleValue(),
            c = Bf.valueOf(t.x).selfSubtract(e.x).selfMultiply(Bf.valueOf(e.y).selfSubtract(n.y)),
            h = Bf.valueOf(t.y).selfSubtract(e.y).selfMultiply(Bf.valueOf(e.x).selfSubtract(n.x)),
            p = c.subtract(h).selfDivide(o).doubleValue(),
            d = Bf.valueOf(n.y).selfAdd(Bf.valueOf(r.y).selfSubtract(n.y).selfMultiply(p)).doubleValue();
        return new Tf(l, d)
    }, Ff.orientationIndexFilter = function (e, t, n) {
        var r = null, i = (e.x - n.x) * (t.y - n.y), s = (e.y - n.y) * (t.x - n.x), o = i - s;
        if (i > 0) {
            if (s <= 0) return Ff.signum(o);
            r = i + s
        } else {
            if (!(i < 0)) return Ff.signum(o);
            if (s >= 0) return Ff.signum(o);
            r = -i - s
        }
        var u = Ff.DP_SAFE_EPSILON * r;
        return o >= u || -o >= u ? Ff.signum(o) : 2
    }, Ff.signum = function (e) {
        return e > 0 ? 1 : e < 0 ? -1 : 0
    }, If.DP_SAFE_EPSILON.get = function () {
        return 1e-15
    }, Object.defineProperties(Ff, If);
    var qf = function () {
    }, Rf = {X: {configurable: !0}, Y: {configurable: !0}, Z: {configurable: !0}, M: {configurable: !0}};
    Rf.X.get = function () {
        return 0
    }, Rf.Y.get = function () {
        return 1
    }, Rf.Z.get = function () {
        return 2
    }, Rf.M.get = function () {
        return 3
    }, qf.prototype.setOrdinate = function (e, t, n) {
    }, qf.prototype.size = function () {
    }, qf.prototype.getOrdinate = function (e, t) {
    }, qf.prototype.getCoordinate = function () {
    }, qf.prototype.getCoordinateCopy = function (e) {
    }, qf.prototype.getDimension = function () {
    }, qf.prototype.getX = function (e) {
    }, qf.prototype.clone = function () {
    }, qf.prototype.expandEnvelope = function (e) {
    }, qf.prototype.copy = function () {
    }, qf.prototype.getY = function (e) {
    }, qf.prototype.toCoordinateArray = function () {
    }, qf.prototype.interfaces_ = function () {
        return [Sf]
    }, qf.prototype.getClass = function () {
        return qf
    }, Object.defineProperties(qf, Rf);
    var Uf = function () {
    }, zf = function (e) {
        function t() {
            e.call(this, "Projective point not representable on the Cartesian plane.")
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Uf), Wf = function () {
    };
    Wf.arraycopy = function (e, t, n, r, i) {
        for (var s = 0, o = t; o < t + i; o++) n[r + s] = e[o], s++
    }, Wf.getProperty = function (e) {
        return {"line.separator": "\n"}[e]
    };
    var Xf = function Mv() {
        if (this.x = null, this.y = null, this.w = null, 0 === arguments.length) this.x = 0, this.y = 0, this.w = 1; else if (1 === arguments.length) {
            var e = arguments[0];
            this.x = e.x, this.y = e.y, this.w = 1
        } else if (2 === arguments.length) {
            if ("number" == typeof arguments[0] && "number" == typeof arguments[1]) {
                var t = arguments[0], n = arguments[1];
                this.x = t, this.y = n, this.w = 1
            } else if (arguments[0] instanceof Mv && arguments[1] instanceof Mv) {
                var r = arguments[0], i = arguments[1];
                this.x = r.y * i.w - i.y * r.w, this.y = i.x * r.w - r.x * i.w, this.w = r.x * i.y - i.x * r.y
            } else if (arguments[0] instanceof Tf && arguments[1] instanceof Tf) {
                var s = arguments[0], o = arguments[1];
                this.x = s.y - o.y, this.y = o.x - s.x, this.w = s.x * o.y - o.x * s.y
            }
        } else if (3 === arguments.length) {
            var u = arguments[0], a = arguments[1], f = arguments[2];
            this.x = u, this.y = a, this.w = f
        } else if (4 === arguments.length) {
            var l = arguments[0], c = arguments[1], h = arguments[2], p = arguments[3], d = l.y - c.y, v = c.x - l.x,
                m = l.x * c.y - c.x * l.y, g = h.y - p.y, y = p.x - h.x, b = h.x * p.y - p.x * h.y;
            this.x = v * b - y * m, this.y = g * m - d * b, this.w = d * y - g * v
        }
    };
    Xf.prototype.getY = function () {
        var e = this.y / this.w;
        if (bf.isNaN(e) || bf.isInfinite(e)) throw new zf;
        return e
    }, Xf.prototype.getX = function () {
        var e = this.x / this.w;
        if (bf.isNaN(e) || bf.isInfinite(e)) throw new zf;
        return e
    }, Xf.prototype.getCoordinate = function () {
        var e = new Tf;
        return e.x = this.getX(), e.y = this.getY(), e
    }, Xf.prototype.interfaces_ = function () {
        return []
    }, Xf.prototype.getClass = function () {
        return Xf
    }, Xf.intersection = function (e, t, n, r) {
        var i = e.y - t.y, s = t.x - e.x, o = e.x * t.y - t.x * e.y, u = n.y - r.y, a = r.x - n.x,
            f = n.x * r.y - r.x * n.y, l = i * a - u * s, c = (s * f - a * o) / l, h = (u * o - i * f) / l;
        if (bf.isNaN(c) || bf.isInfinite(c) || bf.isNaN(h) || bf.isInfinite(h)) throw new zf;
        return new Tf(c, h)
    };
    var Vf = function _v() {
        if (this._minx = null, this._maxx = null, this._miny = null, this._maxy = null, 0 === arguments.length) this.init(); else if (1 === arguments.length) {
            if (arguments[0] instanceof Tf) {
                var e = arguments[0];
                this.init(e.x, e.x, e.y, e.y)
            } else if (arguments[0] instanceof _v) {
                var t = arguments[0];
                this.init(t)
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            this.init(n.x, r.x, n.y, r.y)
        } else if (4 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2], u = arguments[3];
            this.init(i, s, o, u)
        }
    }, $f = {serialVersionUID: {configurable: !0}};
    Vf.prototype.getArea = function () {
        return this.getWidth() * this.getHeight()
    }, Vf.prototype.equals = function (e) {
        if (e instanceof Vf) {
            var t = e;
            return this.isNull() ? t.isNull() : this._maxx === t.getMaxX() && this._maxy === t.getMaxY() && this._minx === t.getMinX() && this._miny === t.getMinY()
        }
        return !1
    }, Vf.prototype.intersection = function (e) {
        if (this.isNull() || e.isNull() || !this.intersects(e)) return new Vf;
        var t = this._minx > e._minx ? this._minx : e._minx, n = this._miny > e._miny ? this._miny : e._miny,
            r = this._maxx < e._maxx ? this._maxx : e._maxx, i = this._maxy < e._maxy ? this._maxy : e._maxy;
        return new Vf(t, r, n, i)
    }, Vf.prototype.isNull = function () {
        return this._maxx < this._minx
    }, Vf.prototype.getMaxX = function () {
        return this._maxx
    }, Vf.prototype.covers = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Tf) {
                var e = arguments[0];
                return this.covers(e.x, e.y)
            }
            if (arguments[0] instanceof Vf) {
                var t = arguments[0];
                return !this.isNull() && !t.isNull() && t.getMinX() >= this._minx && t.getMaxX() <= this._maxx && t.getMinY() >= this._miny && t.getMaxY() <= this._maxy
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            return !this.isNull() && n >= this._minx && n <= this._maxx && r >= this._miny && r <= this._maxy
        }
    }, Vf.prototype.intersects = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Vf) {
                var e = arguments[0];
                return !this.isNull() && !e.isNull() && !(e._minx > this._maxx || e._maxx < this._minx || e._miny > this._maxy || e._maxy < this._miny)
            }
            if (arguments[0] instanceof Tf) {
                var t = arguments[0];
                return this.intersects(t.x, t.y)
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            return !this.isNull() && !(n > this._maxx || n < this._minx || r > this._maxy || r < this._miny)
        }
    }, Vf.prototype.getMinY = function () {
        return this._miny
    }, Vf.prototype.getMinX = function () {
        return this._minx
    }, Vf.prototype.expandToInclude = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Tf) {
                var e = arguments[0];
                this.expandToInclude(e.x, e.y)
            } else if (arguments[0] instanceof Vf) {
                var t = arguments[0];
                if (t.isNull()) return null;
                this.isNull() ? (this._minx = t.getMinX(), this._maxx = t.getMaxX(), this._miny = t.getMinY(), this._maxy = t.getMaxY()) : (t._minx < this._minx && (this._minx = t._minx), t._maxx > this._maxx && (this._maxx = t._maxx), t._miny < this._miny && (this._miny = t._miny), t._maxy > this._maxy && (this._maxy = t._maxy))
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            this.isNull() ? (this._minx = n, this._maxx = n, this._miny = r, this._maxy = r) : (n < this._minx && (this._minx = n), n > this._maxx && (this._maxx = n), r < this._miny && (this._miny = r), r > this._maxy && (this._maxy = r))
        }
    }, Vf.prototype.minExtent = function () {
        if (this.isNull()) return 0;
        var e = this.getWidth(), t = this.getHeight();
        return e < t ? e : t
    }, Vf.prototype.getWidth = function () {
        return this.isNull() ? 0 : this._maxx - this._minx
    }, Vf.prototype.compareTo = function (e) {
        var t = e;
        return this.isNull() ? t.isNull() ? 0 : -1 : t.isNull() ? 1 : this._minx < t._minx ? -1 : this._minx > t._minx ? 1 : this._miny < t._miny ? -1 : this._miny > t._miny ? 1 : this._maxx < t._maxx ? -1 : this._maxx > t._maxx ? 1 : this._maxy < t._maxy ? -1 : this._maxy > t._maxy ? 1 : 0
    }, Vf.prototype.translate = function (e, t) {
        if (this.isNull()) return null;
        this.init(this.getMinX() + e, this.getMaxX() + e, this.getMinY() + t, this.getMaxY() + t)
    }, Vf.prototype.toString = function () {
        return "Env[" + this._minx + " : " + this._maxx + ", " + this._miny + " : " + this._maxy + "]"
    }, Vf.prototype.setToNull = function () {
        this._minx = 0, this._maxx = -1, this._miny = 0, this._maxy = -1
    }, Vf.prototype.getHeight = function () {
        return this.isNull() ? 0 : this._maxy - this._miny
    }, Vf.prototype.maxExtent = function () {
        if (this.isNull()) return 0;
        var e = this.getWidth(), t = this.getHeight();
        return e > t ? e : t
    }, Vf.prototype.expandBy = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.expandBy(e, e)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            if (this.isNull()) return null;
            this._minx -= t, this._maxx += t, this._miny -= n, this._maxy += n, (this._minx > this._maxx || this._miny > this._maxy) && this.setToNull()
        }
    }, Vf.prototype.contains = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Vf) {
                var e = arguments[0];
                return this.covers(e)
            }
            if (arguments[0] instanceof Tf) {
                var t = arguments[0];
                return this.covers(t)
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            return this.covers(n, r)
        }
    }, Vf.prototype.centre = function () {
        return this.isNull() ? null : new Tf((this.getMinX() + this.getMaxX()) / 2, (this.getMinY() + this.getMaxY()) / 2)
    }, Vf.prototype.init = function () {
        if (0 === arguments.length) this.setToNull(); else if (1 === arguments.length) {
            if (arguments[0] instanceof Tf) {
                var e = arguments[0];
                this.init(e.x, e.x, e.y, e.y)
            } else if (arguments[0] instanceof Vf) {
                var t = arguments[0];
                this._minx = t._minx, this._maxx = t._maxx, this._miny = t._miny, this._maxy = t._maxy
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            this.init(n.x, r.x, n.y, r.y)
        } else if (4 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2], u = arguments[3];
            i < s ? (this._minx = i, this._maxx = s) : (this._minx = s, this._maxx = i), o < u ? (this._miny = o, this._maxy = u) : (this._miny = u, this._maxy = o)
        }
    }, Vf.prototype.getMaxY = function () {
        return this._maxy
    }, Vf.prototype.distance = function (e) {
        if (this.intersects(e)) return 0;
        var t = 0;
        this._maxx < e._minx ? t = e._minx - this._maxx : this._minx > e._maxx && (t = this._minx - e._maxx);
        var n = 0;
        return this._maxy < e._miny ? n = e._miny - this._maxy : this._miny > e._maxy && (n = this._miny - e._maxy), 0 === t ? n : 0 === n ? t : Math.sqrt(t * t + n * n)
    }, Vf.prototype.hashCode = function () {
        var e = 17;
        return e = 37 * e + Tf.hashCode(this._minx), e = 37 * e + Tf.hashCode(this._maxx), e = 37 * e + Tf.hashCode(this._miny), e = 37 * e + Tf.hashCode(this._maxy)
    }, Vf.prototype.interfaces_ = function () {
        return [Ef, As]
    }, Vf.prototype.getClass = function () {
        return Vf
    }, Vf.intersects = function () {
        if (3 === arguments.length) {
            var e = arguments[0], t = arguments[1], n = arguments[2];
            return n.x >= (e.x < t.x ? e.x : t.x) && n.x <= (e.x > t.x ? e.x : t.x) && n.y >= (e.y < t.y ? e.y : t.y) && n.y <= (e.y > t.y ? e.y : t.y)
        }
        if (4 === arguments.length) {
            var r = arguments[0], i = arguments[1], s = arguments[2], o = arguments[3], u = Math.min(s.x, o.x),
                a = Math.max(s.x, o.x), f = Math.min(r.x, i.x), l = Math.max(r.x, i.x);
            return !(f > a) && !(l < u) && (u = Math.min(s.y, o.y), a = Math.max(s.y, o.y), f = Math.min(r.y, i.y), l = Math.max(r.y, i.y), !(f > a) && !(l < u))
        }
    }, $f.serialVersionUID.get = function () {
        return 0x51845cd552189800
    }, Object.defineProperties(Vf, $f);
    var Jf = {
        typeStr: /^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,
        emptyTypeStr: /^\s*(\w+)\s*EMPTY\s*$/,
        spaces: /\s+/,
        parenComma: /\)\s*,\s*\(/,
        doubleParenComma: /\)\s*\)\s*,\s*\(\s*\(/,
        trimParens: /^\s*\(?(.*?)\)?\s*$/
    }, Kf = function (e) {
        this.geometryFactory = e || new yc
    };
    Kf.prototype.read = function (e) {
        var t, n, r;
        e = e.replace(/[\n\r]/g, " ");
        var i = Jf.typeStr.exec(e);
        if (-1 !== e.search("EMPTY") && ((i = Jf.emptyTypeStr.exec(e))[2] = void 0), i && (n = i[1].toLowerCase(), r = i[2], Gf[n] && (t = Gf[n].apply(this, [r]))), void 0 === t) throw new Error("Could not parse WKT " + e);
        return t
    }, Kf.prototype.write = function (e) {
        return this.extractGeometry(e)
    }, Kf.prototype.extractGeometry = function (e) {
        var t = e.getGeometryType().toLowerCase();
        if (!Qf[t]) return null;
        var n = t.toUpperCase();
        return e.isEmpty() ? n + " EMPTY" : n + "(" + Qf[t].apply(this, [e]) + ")"
    };
    var Qf = {
        coordinate: function (e) {
            return e.x + " " + e.y
        }, point: function (e) {
            return Qf.coordinate.call(this, e._coordinates._coordinates[0])
        }, multipoint: function (e) {
            for (var t = [], n = 0, r = e._geometries.length; n < r; ++n) t.push("(" + Qf.point.apply(this, [e._geometries[n]]) + ")");
            return t.join(",")
        }, linestring: function (e) {
            for (var t = [], n = 0, r = e._points._coordinates.length; n < r; ++n) t.push(Qf.coordinate.apply(this, [e._points._coordinates[n]]));
            return t.join(",")
        }, linearring: function (e) {
            for (var t = [], n = 0, r = e._points._coordinates.length; n < r; ++n) t.push(Qf.coordinate.apply(this, [e._points._coordinates[n]]));
            return t.join(",")
        }, multilinestring: function (e) {
            for (var t = [], n = 0, r = e._geometries.length; n < r; ++n) t.push("(" + Qf.linestring.apply(this, [e._geometries[n]]) + ")");
            return t.join(",")
        }, polygon: function (e) {
            var t = [];
            t.push("(" + Qf.linestring.apply(this, [e._shell]) + ")");
            for (var n = 0, r = e._holes.length; n < r; ++n) t.push("(" + Qf.linestring.apply(this, [e._holes[n]]) + ")");
            return t.join(",")
        }, multipolygon: function (e) {
            for (var t = [], n = 0, r = e._geometries.length; n < r; ++n) t.push("(" + Qf.polygon.apply(this, [e._geometries[n]]) + ")");
            return t.join(",")
        }, geometrycollection: function (e) {
            for (var t = [], n = 0, r = e._geometries.length; n < r; ++n) t.push(this.extractGeometry(e._geometries[n]));
            return t.join(",")
        }
    }, Gf = {
        point: function (e) {
            if (void 0 === e) return this.geometryFactory.createPoint();
            var t = e.trim().split(Jf.spaces);
            return this.geometryFactory.createPoint(new Tf(Number.parseFloat(t[0]), Number.parseFloat(t[1])))
        }, multipoint: function (e) {
            if (void 0 === e) return this.geometryFactory.createMultiPoint();
            for (var t, n = e.trim().split(","), r = [], i = 0, s = n.length; i < s; ++i) t = n[i].replace(Jf.trimParens, "$1"), r.push(Gf.point.apply(this, [t]));
            return this.geometryFactory.createMultiPoint(r)
        }, linestring: function (e) {
            if (void 0 === e) return this.geometryFactory.createLineString();
            for (var t, n = e.trim().split(","), r = [], i = 0, s = n.length; i < s; ++i) t = n[i].trim().split(Jf.spaces), r.push(new Tf(Number.parseFloat(t[0]), Number.parseFloat(t[1])));
            return this.geometryFactory.createLineString(r)
        }, linearring: function (e) {
            if (void 0 === e) return this.geometryFactory.createLinearRing();
            for (var t, n = e.trim().split(","), r = [], i = 0, s = n.length; i < s; ++i) t = n[i].trim().split(Jf.spaces), r.push(new Tf(Number.parseFloat(t[0]), Number.parseFloat(t[1])));
            return this.geometryFactory.createLinearRing(r)
        }, multilinestring: function (e) {
            if (void 0 === e) return this.geometryFactory.createMultiLineString();
            for (var t, n = e.trim().split(Jf.parenComma), r = [], i = 0, s = n.length; i < s; ++i) t = n[i].replace(Jf.trimParens, "$1"), r.push(Gf.linestring.apply(this, [t]));
            return this.geometryFactory.createMultiLineString(r)
        }, polygon: function (e) {
            if (void 0 === e) return this.geometryFactory.createPolygon();
            for (var t, n, r, i, s = e.trim().split(Jf.parenComma), o = [], u = 0, a = s.length; u < a; ++u) t = s[u].replace(Jf.trimParens, "$1"), n = Gf.linestring.apply(this, [t]), r = this.geometryFactory.createLinearRing(n._points), 0 === u ? i = r : o.push(r);
            return this.geometryFactory.createPolygon(i, o)
        }, multipolygon: function (e) {
            if (void 0 === e) return this.geometryFactory.createMultiPolygon();
            for (var t, n = e.trim().split(Jf.doubleParenComma), r = [], i = 0, s = n.length; i < s; ++i) t = n[i].replace(Jf.trimParens, "$1"), r.push(Gf.polygon.apply(this, [t]));
            return this.geometryFactory.createMultiPolygon(r)
        }, geometrycollection: function (e) {
            if (void 0 === e) return this.geometryFactory.createGeometryCollection();
            for (var t = (e = e.replace(/,\s*([A-Za-z])/g, "|$1")).trim().split("|"), n = [], r = 0, i = t.length; r < i; ++r) n.push(this.read(t[r]));
            return this.geometryFactory.createGeometryCollection(n)
        }
    }, Yf = function (e) {
        this.parser = new Kf(e)
    };
    Yf.prototype.write = function (e) {
        return this.parser.write(e)
    }, Yf.toLineString = function (e, t) {
        if (2 !== arguments.length) throw new Error("Not implemented");
        return "LINESTRING ( " + e.x + " " + e.y + ", " + t.x + " " + t.y + " )"
    };
    var Zf = function (e) {
        function t(t) {
            e.call(this, t), this.name = "RuntimeException", this.message = t, this.stack = (new e).stack
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t
    }(Error), el = function (e) {
        function t() {
            if (e.call(this), 0 === arguments.length) e.call(this); else if (1 === arguments.length) {
                var t = arguments[0];
                e.call(this, t)
            }
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Zf), tl = function () {
    };
    tl.prototype.interfaces_ = function () {
        return []
    }, tl.prototype.getClass = function () {
        return tl
    }, tl.shouldNeverReachHere = function () {
        if (0 === arguments.length) tl.shouldNeverReachHere(null); else if (1 === arguments.length) {
            var e = arguments[0];
            throw new el("Should never reach here" + (null !== e ? ": " + e : ""))
        }
    }, tl.isTrue = function () {
        var e, t;
        if (1 === arguments.length) e = arguments[0], tl.isTrue(e, null); else if (2 === arguments.length && (e = arguments[0], t = arguments[1], !e)) throw null === t ? new el : new el(t)
    }, tl.equals = function () {
        var e, t, n;
        if (2 === arguments.length) e = arguments[0], t = arguments[1], tl.equals(e, t, null); else if (3 === arguments.length && (e = arguments[0], t = arguments[1], n = arguments[2], !t.equals(e))) throw new el("Expected " + e + " but encountered " + t + (null !== n ? ": " + n : ""))
    };
    var nl = function () {
        this._result = null, this._inputLines = Array(2).fill().map(function () {
            return Array(2)
        }), this._intPt = (new Array(2)).fill(null), this._intLineIndex = null, this._isProper = null, this._pa = null, this._pb = null, this._precisionModel = null, this._intPt[0] = new Tf, this._intPt[1] = new Tf, this._pa = this._intPt[0], this._pb = this._intPt[1], this._result = 0
    }, rl = {
        DONT_INTERSECT: {configurable: !0},
        DO_INTERSECT: {configurable: !0},
        COLLINEAR: {configurable: !0},
        NO_INTERSECTION: {configurable: !0},
        POINT_INTERSECTION: {configurable: !0},
        COLLINEAR_INTERSECTION: {configurable: !0}
    };
    nl.prototype.getIndexAlongSegment = function (e, t) {
        return this.computeIntLineIndex(), this._intLineIndex[e][t]
    }, nl.prototype.getTopologySummary = function () {
        var e = new Df;
        return this.isEndPoint() && e.append(" endpoint"), this._isProper && e.append(" proper"), this.isCollinear() && e.append(" collinear"), e.toString()
    }, nl.prototype.computeIntersection = function (e, t, n, r) {
        this._inputLines[0][0] = e, this._inputLines[0][1] = t, this._inputLines[1][0] = n, this._inputLines[1][1] = r, this._result = this.computeIntersect(e, t, n, r)
    }, nl.prototype.getIntersectionNum = function () {
        return this._result
    }, nl.prototype.computeIntLineIndex = function () {
        if (0 === arguments.length) null === this._intLineIndex && (this._intLineIndex = Array(2).fill().map(function () {
            return Array(2)
        }), this.computeIntLineIndex(0), this.computeIntLineIndex(1)); else if (1 === arguments.length) {
            var e = arguments[0];
            this.getEdgeDistance(e, 0) > this.getEdgeDistance(e, 1) ? (this._intLineIndex[e][0] = 0, this._intLineIndex[e][1] = 1) : (this._intLineIndex[e][0] = 1, this._intLineIndex[e][1] = 0)
        }
    }, nl.prototype.isProper = function () {
        return this.hasIntersection() && this._isProper
    }, nl.prototype.setPrecisionModel = function (e) {
        this._precisionModel = e
    }, nl.prototype.isInteriorIntersection = function () {
        if (0 === arguments.length) return !!this.isInteriorIntersection(0) || !!this.isInteriorIntersection(1);
        if (1 === arguments.length) {
            for (var e = arguments[0], t = 0; t < this._result; t++) if (!this._intPt[t].equals2D(this._inputLines[e][0]) && !this._intPt[t].equals2D(this._inputLines[e][1])) return !0;
            return !1
        }
    }, nl.prototype.getIntersection = function (e) {
        return this._intPt[e]
    }, nl.prototype.isEndPoint = function () {
        return this.hasIntersection() && !this._isProper
    }, nl.prototype.hasIntersection = function () {
        return this._result !== nl.NO_INTERSECTION
    }, nl.prototype.getEdgeDistance = function (e, t) {
        return nl.computeEdgeDistance(this._intPt[t], this._inputLines[e][0], this._inputLines[e][1])
    }, nl.prototype.isCollinear = function () {
        return this._result === nl.COLLINEAR_INTERSECTION
    }, nl.prototype.toString = function () {
        return Yf.toLineString(this._inputLines[0][0], this._inputLines[0][1]) + " - " + Yf.toLineString(this._inputLines[1][0], this._inputLines[1][1]) + this.getTopologySummary()
    }, nl.prototype.getEndpoint = function (e, t) {
        return this._inputLines[e][t]
    }, nl.prototype.isIntersection = function (e) {
        for (var t = 0; t < this._result; t++) if (this._intPt[t].equals2D(e)) return !0;
        return !1
    }, nl.prototype.getIntersectionAlongSegment = function (e, t) {
        return this.computeIntLineIndex(), this._intPt[this._intLineIndex[e][t]]
    }, nl.prototype.interfaces_ = function () {
        return []
    }, nl.prototype.getClass = function () {
        return nl
    }, nl.computeEdgeDistance = function (e, t, n) {
        var r = Math.abs(n.x - t.x), i = Math.abs(n.y - t.y), s = -1;
        if (e.equals(t)) s = 0; else if (e.equals(n)) s = r > i ? r : i; else {
            var o = Math.abs(e.x - t.x), u = Math.abs(e.y - t.y);
            0 !== (s = r > i ? o : u) || e.equals(t) || (s = Math.max(o, u))
        }
        return tl.isTrue(0 !== s || !!e.equals(t), "Bad distance calculation"), s
    }, nl.nonRobustComputeEdgeDistance = function (e, t, n) {
        var r = e.x - t.x, i = e.y - t.y, s = Math.sqrt(r * r + i * i);
        return tl.isTrue(0 !== s || !!e.equals(t), "Invalid distance calculation"), s
    }, rl.DONT_INTERSECT.get = function () {
        return 0
    }, rl.DO_INTERSECT.get = function () {
        return 1
    }, rl.COLLINEAR.get = function () {
        return 2
    }, rl.NO_INTERSECTION.get = function () {
        return 0
    }, rl.POINT_INTERSECTION.get = function () {
        return 1
    }, rl.COLLINEAR_INTERSECTION.get = function () {
        return 2
    }, Object.defineProperties(nl, rl);
    var il = function (e) {
        function t() {
            e.apply(this, arguments)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.isInSegmentEnvelopes = function (e) {
            var t = new Vf(this._inputLines[0][0], this._inputLines[0][1]),
                n = new Vf(this._inputLines[1][0], this._inputLines[1][1]);
            return t.contains(e) && n.contains(e)
        }, t.prototype.computeIntersection = function () {
            if (3 !== arguments.length) return e.prototype.computeIntersection.apply(this, arguments);
            var t = arguments[0], n = arguments[1], r = arguments[2];
            if (this._isProper = !1, Vf.intersects(n, r, t) && 0 === ul.orientationIndex(n, r, t) && 0 === ul.orientationIndex(r, n, t)) return this._isProper = !0, (t.equals(n) || t.equals(r)) && (this._isProper = !1), this._result = e.POINT_INTERSECTION, null;
            this._result = e.NO_INTERSECTION
        }, t.prototype.normalizeToMinimum = function (e, t, n, r, i) {
            i.x = this.smallestInAbsValue(e.x, t.x, n.x, r.x), i.y = this.smallestInAbsValue(e.y, t.y, n.y, r.y), e.x -= i.x, e.y -= i.y, t.x -= i.x, t.y -= i.y, n.x -= i.x, n.y -= i.y, r.x -= i.x, r.y -= i.y
        }, t.prototype.safeHCoordinateIntersection = function (e, n, r, i) {
            var s = null;
            try {
                s = Xf.intersection(e, n, r, i)
            } catch (o) {
                if (!(o instanceof zf)) throw o;
                s = t.nearestEndpoint(e, n, r, i)
            }
            return s
        }, t.prototype.intersection = function (e, n, r, i) {
            var s = this.intersectionWithNormalization(e, n, r, i);
            return this.isInSegmentEnvelopes(s) || (s = new Tf(t.nearestEndpoint(e, n, r, i))), null !== this._precisionModel && this._precisionModel.makePrecise(s), s
        }, t.prototype.smallestInAbsValue = function (e, t, n, r) {
            var i = e, s = Math.abs(i);
            return Math.abs(t) < s && (i = t, s = Math.abs(t)), Math.abs(n) < s && (i = n, s = Math.abs(n)), Math.abs(r) < s && (i = r), i
        }, t.prototype.checkDD = function (e, t, n, r, i) {
            var s = Ff.intersection(e, t, n, r), o = this.isInSegmentEnvelopes(s);
            Wf.out.println("DD in env = " + o + "  --------------------- " + s), i.distance(s) > 1e-4 && Wf.out.println("Distance = " + i.distance(s))
        }, t.prototype.intersectionWithNormalization = function (e, t, n, r) {
            var i = new Tf(e), s = new Tf(t), o = new Tf(n), u = new Tf(r), a = new Tf;
            this.normalizeToEnvCentre(i, s, o, u, a);
            var f = this.safeHCoordinateIntersection(i, s, o, u);
            return f.x += a.x, f.y += a.y, f
        }, t.prototype.computeCollinearIntersection = function (t, n, r, i) {
            var s = Vf.intersects(t, n, r), o = Vf.intersects(t, n, i), u = Vf.intersects(r, i, t),
                a = Vf.intersects(r, i, n);
            return s && o ? (this._intPt[0] = r, this._intPt[1] = i, e.COLLINEAR_INTERSECTION) : u && a ? (this._intPt[0] = t, this._intPt[1] = n, e.COLLINEAR_INTERSECTION) : s && u ? (this._intPt[0] = r, this._intPt[1] = t, !r.equals(t) || o || a ? e.COLLINEAR_INTERSECTION : e.POINT_INTERSECTION) : s && a ? (this._intPt[0] = r, this._intPt[1] = n, !r.equals(n) || o || u ? e.COLLINEAR_INTERSECTION : e.POINT_INTERSECTION) : o && u ? (this._intPt[0] = i, this._intPt[1] = t, !i.equals(t) || s || a ? e.COLLINEAR_INTERSECTION : e.POINT_INTERSECTION) : o && a ? (this._intPt[0] = i, this._intPt[1] = n, !i.equals(n) || s || u ? e.COLLINEAR_INTERSECTION : e.POINT_INTERSECTION) : e.NO_INTERSECTION
        }, t.prototype.normalizeToEnvCentre = function (e, t, n, r, i) {
            var s = e.x < t.x ? e.x : t.x, o = e.y < t.y ? e.y : t.y, u = e.x > t.x ? e.x : t.x,
                a = e.y > t.y ? e.y : t.y, f = n.x < r.x ? n.x : r.x, l = n.y < r.y ? n.y : r.y,
                c = n.x > r.x ? n.x : r.x, h = n.y > r.y ? n.y : r.y, p = ((s > f ? s : f) + (u < c ? u : c)) / 2,
                d = ((o > l ? o : l) + (a < h ? a : h)) / 2;
            i.x = p, i.y = d, e.x -= i.x, e.y -= i.y, t.x -= i.x, t.y -= i.y, n.x -= i.x, n.y -= i.y, r.x -= i.x, r.y -= i.y
        }, t.prototype.computeIntersect = function (t, n, r, i) {
            if (this._isProper = !1, !Vf.intersects(t, n, r, i)) return e.NO_INTERSECTION;
            var s = ul.orientationIndex(t, n, r), o = ul.orientationIndex(t, n, i);
            if (s > 0 && o > 0 || s < 0 && o < 0) return e.NO_INTERSECTION;
            var u = ul.orientationIndex(r, i, t), a = ul.orientationIndex(r, i, n);
            return u > 0 && a > 0 || u < 0 && a < 0 ? e.NO_INTERSECTION : 0 === s && 0 === o && 0 === u && 0 === a ? this.computeCollinearIntersection(t, n, r, i) : (0 === s || 0 === o || 0 === u || 0 === a ? (this._isProper = !1, t.equals2D(r) || t.equals2D(i) ? this._intPt[0] = t : n.equals2D(r) || n.equals2D(i) ? this._intPt[0] = n : 0 === s ? this._intPt[0] = new Tf(r) : 0 === o ? this._intPt[0] = new Tf(i) : 0 === u ? this._intPt[0] = new Tf(t) : 0 === a && (this._intPt[0] = new Tf(n))) : (this._isProper = !0, this._intPt[0] = this.intersection(t, n, r, i)), e.POINT_INTERSECTION)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t.nearestEndpoint = function (e, t, n, r) {
            var i = e, s = ul.distancePointLine(e, n, r), o = ul.distancePointLine(t, n, r);
            return o < s && (s = o, i = t), (o = ul.distancePointLine(n, e, t)) < s && (s = o, i = n), (o = ul.distancePointLine(r, e, t)) < s && (s = o, i = r), i
        }, t
    }(nl), sl = function () {
    };
    sl.prototype.interfaces_ = function () {
        return []
    }, sl.prototype.getClass = function () {
        return sl
    }, sl.orientationIndex = function (e, t, n) {
        var r = t.x - e.x, i = t.y - e.y, s = n.x - t.x, o = n.y - t.y;
        return sl.signOfDet2x2(r, i, s, o)
    }, sl.signOfDet2x2 = function (e, t, n, r) {
        var i = null, s = null, o = null;
        if (i = 1, 0 === e || 0 === r) return 0 === t || 0 === n ? 0 : t > 0 ? n > 0 ? -i : i : n > 0 ? i : -i;
        if (0 === t || 0 === n) return r > 0 ? e > 0 ? i : -i : e > 0 ? -i : i;
        if (t > 0 ? r > 0 ? t <= r || (i = -i, s = e, e = n, n = s, s = t, t = r, r = s) : t <= -r ? (i = -i, n = -n, r = -r) : (s = e, e = -n, n = s, s = t, t = -r, r = s) : r > 0 ? -t <= r ? (i = -i, e = -e, t = -t) : (s = -e, e = n, n = s, s = -t, t = r, r = s) : t >= r ? (e = -e, t = -t, n = -n, r = -r) : (i = -i, s = -e, e = -n, n = s, s = -t, t = -r, r = s), e > 0) {
            if (!(n > 0)) return i;
            if (!(e <= n)) return i
        } else {
            if (n > 0) return -i;
            if (!(e >= n)) return -i;
            i = -i, e = -e, n = -n
        }
        for (; ;) {
            if (o = Math.floor(n / e), n -= o * e, (r -= o * t) < 0) return -i;
            if (r > t) return i;
            if (e > n + n) {
                if (t < r + r) return i
            } else {
                if (t > r + r) return -i;
                n = e - n, r = t - r, i = -i
            }
            if (0 === r) return 0 === n ? 0 : -i;
            if (0 === n) return i;
            if (o = Math.floor(e / n), e -= o * n, (t -= o * r) < 0) return i;
            if (t > r) return -i;
            if (n > e + e) {
                if (r < t + t) return -i
            } else {
                if (r > t + t) return i;
                e = n - e, t = r - t, i = -i
            }
            if (0 === t) return 0 === e ? 0 : i;
            if (0 === e) return -i
        }
    };
    var ol = function () {
        this._p = null, this._crossingCount = 0, this._isPointOnSegment = !1;
        var e = arguments[0];
        this._p = e
    };
    ol.prototype.countSegment = function (e, t) {
        if (e.x < this._p.x && t.x < this._p.x) return null;
        if (this._p.x === t.x && this._p.y === t.y) return this._isPointOnSegment = !0, null;
        if (e.y === this._p.y && t.y === this._p.y) {
            var n = e.x, r = t.x;
            return n > r && (n = t.x, r = e.x), this._p.x >= n && this._p.x <= r && (this._isPointOnSegment = !0), null
        }
        if (e.y > this._p.y && t.y <= this._p.y || t.y > this._p.y && e.y <= this._p.y) {
            var i = e.x - this._p.x, s = e.y - this._p.y, o = t.x - this._p.x, u = t.y - this._p.y,
                a = sl.signOfDet2x2(i, s, o, u);
            if (0 === a) return this._isPointOnSegment = !0, null;
            u < s && (a = -a), a > 0 && this._crossingCount++
        }
    }, ol.prototype.isPointInPolygon = function () {
        return this.getLocation() !== Lf.EXTERIOR
    }, ol.prototype.getLocation = function () {
        return this._isPointOnSegment ? Lf.BOUNDARY : this._crossingCount % 2 == 1 ? Lf.INTERIOR : Lf.EXTERIOR
    }, ol.prototype.isOnSegment = function () {
        return this._isPointOnSegment
    }, ol.prototype.interfaces_ = function () {
        return []
    }, ol.prototype.getClass = function () {
        return ol
    }, ol.locatePointInRing = function () {
        if (arguments[0] instanceof Tf && Of(arguments[1], qf)) {
            for (var e = arguments[0], t = arguments[1], n = new ol(e), r = new Tf, i = new Tf, s = 1; s < t.size(); s++) if (t.getCoordinate(s, r), t.getCoordinate(s - 1, i), n.countSegment(r, i), n.isOnSegment()) return n.getLocation();
            return n.getLocation()
        }
        if (arguments[0] instanceof Tf && arguments[1] instanceof Array) {
            for (var o = arguments[0], u = arguments[1], a = new ol(o), f = 1; f < u.length; f++) {
                var l = u[f], c = u[f - 1];
                if (a.countSegment(l, c), a.isOnSegment()) return a.getLocation()
            }
            return a.getLocation()
        }
    };
    var ul = function () {
    }, al = {
        CLOCKWISE: {configurable: !0},
        RIGHT: {configurable: !0},
        COUNTERCLOCKWISE: {configurable: !0},
        LEFT: {configurable: !0},
        COLLINEAR: {configurable: !0},
        STRAIGHT: {configurable: !0}
    };
    ul.prototype.interfaces_ = function () {
        return []
    }, ul.prototype.getClass = function () {
        return ul
    }, ul.orientationIndex = function (e, t, n) {
        return Ff.orientationIndex(e, t, n)
    }, ul.signedArea = function () {
        if (arguments[0] instanceof Array) {
            var e = arguments[0];
            if (e.length < 3) return 0;
            for (var t = 0, n = e[0].x, r = 1; r < e.length - 1; r++) {
                var i = e[r].x - n, s = e[r + 1].y;
                t += i * (e[r - 1].y - s)
            }
            return t / 2
        }
        if (Of(arguments[0], qf)) {
            var o = arguments[0], u = o.size();
            if (u < 3) return 0;
            var a = new Tf, f = new Tf, l = new Tf;
            o.getCoordinate(0, f), o.getCoordinate(1, l);
            var c = f.x;
            l.x -= c;
            for (var h = 0, p = 1; p < u - 1; p++) a.y = f.y, f.x = l.x, f.y = l.y, o.getCoordinate(p + 1, l), l.x -= c, h += f.x * (a.y - l.y);
            return h / 2
        }
    }, ul.distanceLineLine = function (e, t, n, r) {
        if (e.equals(t)) return ul.distancePointLine(e, n, r);
        if (n.equals(r)) return ul.distancePointLine(r, e, t);
        var i = !1;
        if (Vf.intersects(e, t, n, r)) {
            var s = (t.x - e.x) * (r.y - n.y) - (t.y - e.y) * (r.x - n.x);
            if (0 === s) i = !0; else {
                var o = (e.y - n.y) * (r.x - n.x) - (e.x - n.x) * (r.y - n.y),
                    u = ((e.y - n.y) * (t.x - e.x) - (e.x - n.x) * (t.y - e.y)) / s, a = o / s;
                (a < 0 || a > 1 || u < 0 || u > 1) && (i = !0)
            }
        } else i = !0;
        return i ? Mf.min(ul.distancePointLine(e, n, r), ul.distancePointLine(t, n, r), ul.distancePointLine(n, e, t), ul.distancePointLine(r, e, t)) : 0
    }, ul.isPointInRing = function (e, t) {
        return ul.locatePointInRing(e, t) !== Lf.EXTERIOR
    }, ul.computeLength = function (e) {
        var t = e.size();
        if (t <= 1) return 0;
        var n = 0, r = new Tf;
        e.getCoordinate(0, r);
        for (var i = r.x, s = r.y, o = 1; o < t; o++) {
            e.getCoordinate(o, r);
            var u = r.x, a = r.y, f = u - i, l = a - s;
            n += Math.sqrt(f * f + l * l), i = u, s = a
        }
        return n
    }, ul.isCCW = function (e) {
        var t = e.length - 1;
        if (t < 3) throw new yf("Ring has fewer than 4 points, so orientation cannot be determined");
        for (var n = e[0], r = 0, i = 1; i <= t; i++) {
            var s = e[i];
            s.y > n.y && (n = s, r = i)
        }
        var o = r;
        do (o -= 1) < 0 && (o = t); while (e[o].equals2D(n) && o !== r);
        var u = r;
        do u = (u + 1) % t; while (e[u].equals2D(n) && u !== r);
        var a = e[o], f = e[u];
        if (a.equals2D(n) || f.equals2D(n) || a.equals2D(f)) return !1;
        var l = ul.computeOrientation(a, n, f), c = !1;
        return c = 0 === l ? a.x > f.x : l > 0, c
    }, ul.locatePointInRing = function (e, t) {
        return ol.locatePointInRing(e, t)
    }, ul.distancePointLinePerpendicular = function (e, t, n) {
        var r = (n.x - t.x) * (n.x - t.x) + (n.y - t.y) * (n.y - t.y),
            i = ((t.y - e.y) * (n.x - t.x) - (t.x - e.x) * (n.y - t.y)) / r;
        return Math.abs(i) * Math.sqrt(r)
    }, ul.computeOrientation = function (e, t, n) {
        return ul.orientationIndex(e, t, n)
    }, ul.distancePointLine = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            if (0 === t.length) throw new yf("Line array must contain at least one vertex");
            for (var n = e.distance(t[0]), r = 0; r < t.length - 1; r++) {
                var i = ul.distancePointLine(e, t[r], t[r + 1]);
                i < n && (n = i)
            }
            return n
        }
        if (3 === arguments.length) {
            var s = arguments[0], o = arguments[1], u = arguments[2];
            if (o.x === u.x && o.y === u.y) return s.distance(o);
            var a = (u.x - o.x) * (u.x - o.x) + (u.y - o.y) * (u.y - o.y),
                f = ((s.x - o.x) * (u.x - o.x) + (s.y - o.y) * (u.y - o.y)) / a;
            if (f <= 0) return s.distance(o);
            if (f >= 1) return s.distance(u);
            var l = ((o.y - s.y) * (u.x - o.x) - (o.x - s.x) * (u.y - o.y)) / a;
            return Math.abs(l) * Math.sqrt(a)
        }
    }, ul.isOnLine = function (e, t) {
        for (var n = new il, r = 1; r < t.length; r++) {
            var i = t[r - 1], s = t[r];
            if (n.computeIntersection(e, i, s), n.hasIntersection()) return !0
        }
        return !1
    }, al.CLOCKWISE.get = function () {
        return -1
    }, al.RIGHT.get = function () {
        return ul.CLOCKWISE
    }, al.COUNTERCLOCKWISE.get = function () {
        return 1
    }, al.LEFT.get = function () {
        return ul.COUNTERCLOCKWISE
    }, al.COLLINEAR.get = function () {
        return 0
    }, al.STRAIGHT.get = function () {
        return ul.COLLINEAR
    }, Object.defineProperties(ul, al);
    var fl = function () {
    };
    fl.prototype.filter = function (e) {
    }, fl.prototype.interfaces_ = function () {
        return []
    }, fl.prototype.getClass = function () {
        return fl
    };
    var ll = function () {
        var e = arguments[0];
        this._envelope = null, this._factory = null, this._SRID = null, this._userData = null, this._factory = e, this._SRID = e.getSRID()
    }, cl = {
        serialVersionUID: {configurable: !0},
        SORTINDEX_POINT: {configurable: !0},
        SORTINDEX_MULTIPOINT: {configurable: !0},
        SORTINDEX_LINESTRING: {configurable: !0},
        SORTINDEX_LINEARRING: {configurable: !0},
        SORTINDEX_MULTILINESTRING: {configurable: !0},
        SORTINDEX_POLYGON: {configurable: !0},
        SORTINDEX_MULTIPOLYGON: {configurable: !0},
        SORTINDEX_GEOMETRYCOLLECTION: {configurable: !0},
        geometryChangedFilter: {configurable: !0}
    };
    ll.prototype.isGeometryCollection = function () {
        return this.getSortIndex() === ll.SORTINDEX_GEOMETRYCOLLECTION
    }, ll.prototype.getFactory = function () {
        return this._factory
    }, ll.prototype.getGeometryN = function (e) {
        return this
    }, ll.prototype.getArea = function () {
        return 0
    }, ll.prototype.isRectangle = function () {
        return !1
    }, ll.prototype.equals = function () {
        if (arguments[0] instanceof ll) {
            var e = arguments[0];
            return null !== e && this.equalsTopo(e)
        }
        if (arguments[0] instanceof Object) {
            var t = arguments[0];
            if (t instanceof ll) {
                var n = t;
                return this.equalsExact(n)
            }
            return !1
        }
    }, ll.prototype.equalsExact = function (e) {
        return this === e || this.equalsExact(e, 0)
    }, ll.prototype.geometryChanged = function () {
        this.apply(ll.geometryChangedFilter)
    }, ll.prototype.geometryChangedAction = function () {
        this._envelope = null
    }, ll.prototype.equalsNorm = function (e) {
        return null !== e && this.norm().equalsExact(e.norm())
    }, ll.prototype.getLength = function () {
        return 0
    }, ll.prototype.getNumGeometries = function () {
        return 1
    }, ll.prototype.compareTo = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = e;
            return this.getSortIndex() !== t.getSortIndex() ? this.getSortIndex() - t.getSortIndex() : this.isEmpty() && t.isEmpty() ? 0 : this.isEmpty() ? -1 : t.isEmpty() ? 1 : this.compareToSameClass(e)
        }
        if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            return this.getSortIndex() !== n.getSortIndex() ? this.getSortIndex() - n.getSortIndex() : this.isEmpty() && n.isEmpty() ? 0 : this.isEmpty() ? -1 : n.isEmpty() ? 1 : this.compareToSameClass(n, r)
        }
    }, ll.prototype.getUserData = function () {
        return this._userData
    }, ll.prototype.getSRID = function () {
        return this._SRID
    }, ll.prototype.getEnvelope = function () {
        return this.getFactory().toGeometry(this.getEnvelopeInternal())
    }, ll.prototype.checkNotGeometryCollection = function (e) {
        if (e.getSortIndex() === ll.SORTINDEX_GEOMETRYCOLLECTION) throw new yf("This method does not support GeometryCollection arguments")
    }, ll.prototype.equal = function (e, t, n) {
        return 0 === n ? e.equals(t) : e.distance(t) <= n
    }, ll.prototype.norm = function () {
        var e = this.copy();
        return e.normalize(), e
    }, ll.prototype.getPrecisionModel = function () {
        return this._factory.getPrecisionModel()
    }, ll.prototype.getEnvelopeInternal = function () {
        return null === this._envelope && (this._envelope = this.computeEnvelopeInternal()), new Vf(this._envelope)
    }, ll.prototype.setSRID = function (e) {
        this._SRID = e
    }, ll.prototype.setUserData = function (e) {
        this._userData = e
    }, ll.prototype.compare = function (e, t) {
        for (var n = e.iterator(), r = t.iterator(); n.hasNext() && r.hasNext();) {
            var i = n.next(), s = r.next(), o = i.compareTo(s);
            if (0 !== o) return o
        }
        return n.hasNext() ? 1 : r.hasNext() ? -1 : 0
    }, ll.prototype.hashCode = function () {
        return this.getEnvelopeInternal().hashCode()
    }, ll.prototype.isGeometryCollectionOrDerived = function () {
        return this.getSortIndex() === ll.SORTINDEX_GEOMETRYCOLLECTION || this.getSortIndex() === ll.SORTINDEX_MULTIPOINT || this.getSortIndex() === ll.SORTINDEX_MULTILINESTRING || this.getSortIndex() === ll.SORTINDEX_MULTIPOLYGON
    }, ll.prototype.interfaces_ = function () {
        return [Sf, Ef, As]
    }, ll.prototype.getClass = function () {
        return ll
    }, ll.hasNonEmptyElements = function (e) {
        for (var t = 0; t < e.length; t++) if (!e[t].isEmpty()) return !0;
        return !1
    }, ll.hasNullElements = function (e) {
        for (var t = 0; t < e.length; t++) if (null === e[t]) return !0;
        return !1
    }, cl.serialVersionUID.get = function () {
        return 0x799ea46522854c00
    }, cl.SORTINDEX_POINT.get = function () {
        return 0
    }, cl.SORTINDEX_MULTIPOINT.get = function () {
        return 1
    }, cl.SORTINDEX_LINESTRING.get = function () {
        return 2
    }, cl.SORTINDEX_LINEARRING.get = function () {
        return 3
    }, cl.SORTINDEX_MULTILINESTRING.get = function () {
        return 4
    }, cl.SORTINDEX_POLYGON.get = function () {
        return 5
    }, cl.SORTINDEX_MULTIPOLYGON.get = function () {
        return 6
    }, cl.SORTINDEX_GEOMETRYCOLLECTION.get = function () {
        return 7
    }, cl.geometryChangedFilter.get = function () {
        return hl
    }, Object.defineProperties(ll, cl);
    var hl = function () {
    };
    hl.interfaces_ = function () {
        return [fl]
    }, hl.filter = function (e) {
        e.geometryChangedAction()
    };
    var pl = function () {
    };
    pl.prototype.filter = function (e) {
    }, pl.prototype.interfaces_ = function () {
        return []
    }, pl.prototype.getClass = function () {
        return pl
    };
    var dl = function () {
    }, vl = {
        Mod2BoundaryNodeRule: {configurable: !0},
        EndPointBoundaryNodeRule: {configurable: !0},
        MultiValentEndPointBoundaryNodeRule: {configurable: !0},
        MonoValentEndPointBoundaryNodeRule: {configurable: !0},
        MOD2_BOUNDARY_RULE: {configurable: !0},
        ENDPOINT_BOUNDARY_RULE: {configurable: !0},
        MULTIVALENT_ENDPOINT_BOUNDARY_RULE: {configurable: !0},
        MONOVALENT_ENDPOINT_BOUNDARY_RULE: {configurable: !0},
        OGC_SFS_BOUNDARY_RULE: {configurable: !0}
    };
    dl.prototype.isInBoundary = function (e) {
    }, dl.prototype.interfaces_ = function () {
        return []
    }, dl.prototype.getClass = function () {
        return dl
    }, vl.Mod2BoundaryNodeRule.get = function () {
        return ml
    }, vl.EndPointBoundaryNodeRule.get = function () {
        return gl
    }, vl.MultiValentEndPointBoundaryNodeRule.get = function () {
        return yl
    }, vl.MonoValentEndPointBoundaryNodeRule.get = function () {
        return bl
    }, vl.MOD2_BOUNDARY_RULE.get = function () {
        return new ml
    }, vl.ENDPOINT_BOUNDARY_RULE.get = function () {
        return new gl
    }, vl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get = function () {
        return new yl
    }, vl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get = function () {
        return new bl
    }, vl.OGC_SFS_BOUNDARY_RULE.get = function () {
        return dl.MOD2_BOUNDARY_RULE
    }, Object.defineProperties(dl, vl);
    var ml = function () {
    };
    ml.prototype.isInBoundary = function (e) {
        return e % 2 == 1
    }, ml.prototype.interfaces_ = function () {
        return [dl]
    }, ml.prototype.getClass = function () {
        return ml
    };
    var gl = function () {
    };
    gl.prototype.isInBoundary = function (e) {
        return e > 0
    }, gl.prototype.interfaces_ = function () {
        return [dl]
    }, gl.prototype.getClass = function () {
        return gl
    };
    var yl = function () {
    };
    yl.prototype.isInBoundary = function (e) {
        return e > 1
    }, yl.prototype.interfaces_ = function () {
        return [dl]
    }, yl.prototype.getClass = function () {
        return yl
    };
    var bl = function () {
    };
    bl.prototype.isInBoundary = function (e) {
        return 1 === e
    }, bl.prototype.interfaces_ = function () {
        return [dl]
    }, bl.prototype.getClass = function () {
        return bl
    };
    var wl = function () {
    };
    wl.prototype.add = function () {
    }, wl.prototype.addAll = function () {
    }, wl.prototype.isEmpty = function () {
    }, wl.prototype.iterator = function () {
    }, wl.prototype.size = function () {
    }, wl.prototype.toArray = function () {
    }, wl.prototype.remove = function () {
    };
    var El = function (e) {
        function t(t) {
            e.call(this), this.message = t || ""
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {name: {configurable: !0}};
        return n.name.get = function () {
            return "IndexOutOfBoundsException"
        }, Object.defineProperties(t, n), t
    }(Error), Sl = function () {
    };
    Sl.prototype.hasNext = function () {
    }, Sl.prototype.next = function () {
    }, Sl.prototype.remove = function () {
    };
    var xl = function (e) {
        function t() {
            e.apply(this, arguments)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.get = function () {
        }, t.prototype.set = function () {
        }, t.prototype.isEmpty = function () {
        }, t
    }(wl);
    (Os.prototype = new Error).name = "NoSuchElementException";
    var Tl = function (e) {
        function t() {
            e.call(this), this.array_ = [], arguments[0] instanceof wl && this.addAll(arguments[0])
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.ensureCapacity = function () {
        }, t.prototype.interfaces_ = function () {
            return [e, wl]
        }, t.prototype.add = function (e) {
            return 1 === arguments.length ? this.array_.push(e) : this.array_.splice(arguments[0], arguments[1]), !0
        }, t.prototype.clear = function () {
            this.array_ = []
        }, t.prototype.addAll = function (e) {
            for (var t = e.iterator(); t.hasNext();) this.add(t.next());
            return !0
        }, t.prototype.set = function (e, t) {
            var n = this.array_[e];
            return this.array_[e] = t, n
        }, t.prototype.iterator = function () {
            return new Nl(this)
        }, t.prototype.get = function (e) {
            if (e < 0 || e >= this.size()) throw new El;
            return this.array_[e]
        }, t.prototype.isEmpty = function () {
            return 0 === this.array_.length
        }, t.prototype.size = function () {
            return this.array_.length
        }, t.prototype.toArray = function () {
            for (var e = [], t = 0, n = this.array_.length; t < n; t++) e.push(this.array_[t]);
            return e
        }, t.prototype.remove = function (e) {
            for (var t = !1, n = 0, r = this.array_.length; n < r; n++) if (this.array_[n] === e) {
                this.array_.splice(n, 1), t = !0;
                break
            }
            return t
        }, t
    }(xl), Nl = function (e) {
        function t(t) {
            e.call(this), this.arrayList_ = t, this.position_ = 0
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.next = function () {
            if (this.position_ === this.arrayList_.size()) throw new Os;
            return this.arrayList_.get(this.position_++)
        }, t.prototype.hasNext = function () {
            return this.position_ < this.arrayList_.size()
        }, t.prototype.set = function (e) {
            return this.arrayList_.set(this.position_ - 1, e)
        }, t.prototype.remove = function () {
            this.arrayList_.remove(this.arrayList_.get(this.position_))
        }, t
    }(Sl), Cl = function (e) {
        function t() {
            if (e.call(this), 0 !== arguments.length) if (1 === arguments.length) {
                var t = arguments[0];
                this.ensureCapacity(t.length), this.add(t, !0)
            } else if (2 === arguments.length) {
                var n = arguments[0], r = arguments[1];
                this.ensureCapacity(n.length), this.add(n, r)
            }
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {coordArrayType: {configurable: !0}};
        return n.coordArrayType.get = function () {
            return (new Array(0)).fill(null)
        }, t.prototype.getCoordinate = function (e) {
            return this.get(e)
        }, t.prototype.addAll = function () {
            if (2 === arguments.length) {
                for (var t = arguments[0], n = arguments[1], r = !1, i = t.iterator(); i.hasNext();) this.add(i.next(), n), r = !0;
                return r
            }
            return e.prototype.addAll.apply(this, arguments)
        }, t.prototype.clone = function () {
            for (var t = e.prototype.clone.call(this), n = 0; n < this.size(); n++) t.add(n, this.get(n).copy());
            return t
        }, t.prototype.toCoordinateArray = function () {
            return this.toArray(t.coordArrayType)
        }, t.prototype.add = function () {
            if (1 === arguments.length) {
                var t = arguments[0];
                e.prototype.add.call(this, t)
            } else if (2 === arguments.length) {
                if (arguments[0] instanceof Array && "boolean" == typeof arguments[1]) {
                    var n = arguments[0], r = arguments[1];
                    return this.add(n, r, !0), !0
                }
                if (arguments[0] instanceof Tf && "boolean" == typeof arguments[1]) {
                    var i = arguments[0];
                    if (!arguments[1] && this.size() >= 1 && this.get(this.size() - 1).equals2D(i)) return null;
                    e.prototype.add.call(this, i)
                } else if (arguments[0] instanceof Object && "boolean" == typeof arguments[1]) {
                    var s = arguments[0], o = arguments[1];
                    return this.add(s, o), !0
                }
            } else if (3 === arguments.length) {
                if ("boolean" == typeof arguments[2] && arguments[0] instanceof Array && "boolean" == typeof arguments[1]) {
                    var u = arguments[0], a = arguments[1];
                    if (arguments[2]) for (var f = 0; f < u.length; f++) this.add(u[f], a); else for (var l = u.length - 1; l >= 0; l--) this.add(u[l], a);
                    return !0
                }
                if ("boolean" == typeof arguments[2] && Number.isInteger(arguments[0]) && arguments[1] instanceof Tf) {
                    var c = arguments[0], h = arguments[1];
                    if (!arguments[2]) {
                        var p = this.size();
                        if (p > 0) {
                            if (c > 0 && this.get(c - 1).equals2D(h)) return null;
                            if (c < p && this.get(c).equals2D(h)) return null
                        }
                    }
                    e.prototype.add.call(this, c, h)
                }
            } else if (4 === arguments.length) {
                var d = arguments[0], v = arguments[1], m = arguments[2], g = arguments[3], y = 1;
                m > g && (y = -1);
                for (var b = m; b !== g; b += y) this.add(d[b], v);
                return !0
            }
        }, t.prototype.closeRing = function () {
            this.size() > 0 && this.add(new Tf(this.get(0)), !1)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, Object.defineProperties(t, n), t
    }(Tl), kl = function () {
    }, Ll = {
        ForwardComparator: {configurable: !0},
        BidirectionalComparator: {configurable: !0},
        coordArrayType: {configurable: !0}
    };
    Ll.ForwardComparator.get = function () {
        return Al
    }, Ll.BidirectionalComparator.get = function () {
        return Ol
    }, Ll.coordArrayType.get = function () {
        return (new Array(0)).fill(null)
    }, kl.prototype.interfaces_ = function () {
        return []
    }, kl.prototype.getClass = function () {
        return kl
    }, kl.isRing = function (e) {
        return !(e.length < 4) && !!e[0].equals2D(e[e.length - 1])
    }, kl.ptNotInList = function (e, t) {
        for (var n = 0; n < e.length; n++) {
            var r = e[n];
            if (kl.indexOf(r, t) < 0) return r
        }
        return null
    }, kl.scroll = function (e, t) {
        var n = kl.indexOf(t, e);
        if (n < 0) return null;
        var r = (new Array(e.length)).fill(null);
        Wf.arraycopy(e, n, r, 0, e.length - n), Wf.arraycopy(e, 0, r, e.length - n, n), Wf.arraycopy(r, 0, e, 0, e.length)
    }, kl.equals = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            if (e === t) return !0;
            if (null === e || null === t) return !1;
            if (e.length !== t.length) return !1;
            for (var n = 0; n < e.length; n++) if (!e[n].equals(t[n])) return !1;
            return !0
        }
        if (3 === arguments.length) {
            var r = arguments[0], i = arguments[1], s = arguments[2];
            if (r === i) return !0;
            if (null === r || null === i) return !1;
            if (r.length !== i.length) return !1;
            for (var o = 0; o < r.length; o++) if (0 !== s.compare(r[o], i[o])) return !1;
            return !0
        }
    }, kl.intersection = function (e, t) {
        for (var n = new Cl, r = 0; r < e.length; r++) t.intersects(e[r]) && n.add(e[r], !0);
        return n.toCoordinateArray()
    }, kl.hasRepeatedPoints = function (e) {
        for (var t = 1; t < e.length; t++) if (e[t - 1].equals(e[t])) return !0;
        return !1
    }, kl.removeRepeatedPoints = function (e) {
        return kl.hasRepeatedPoints(e) ? (new Cl(e, !1)).toCoordinateArray() : e
    }, kl.reverse = function (e) {
        for (var t = e.length - 1, n = Math.trunc(t / 2), r = 0; r <= n; r++) {
            var i = e[r];
            e[r] = e[t - r], e[t - r] = i
        }
    }, kl.removeNull = function (e) {
        for (var t = 0, n = 0; n < e.length; n++) null !== e[n] && t++;
        var r = (new Array(t)).fill(null);
        if (0 === t) return r;
        for (var i = 0, s = 0; s < e.length; s++) null !== e[s] && (r[i++] = e[s]);
        return r
    }, kl.copyDeep = function () {
        if (1 === arguments.length) {
            for (var e = arguments[0], t = (new Array(e.length)).fill(null), n = 0; n < e.length; n++) t[n] = new Tf(e[n]);
            return t
        }
        if (5 === arguments.length) for (var r = arguments[0], i = arguments[1], s = arguments[2], o = arguments[3], u = arguments[4], a = 0; a < u; a++) s[o + a] = new Tf(r[i + a])
    }, kl.isEqualReversed = function (e, t) {
        for (var n = 0; n < e.length; n++) {
            var r = e[n], i = t[e.length - n - 1];
            if (0 !== r.compareTo(i)) return !1
        }
        return !0
    }, kl.envelope = function (e) {
        for (var t = new Vf, n = 0; n < e.length; n++) t.expandToInclude(e[n]);
        return t
    }, kl.toCoordinateArray = function (e) {
        return e.toArray(kl.coordArrayType)
    }, kl.atLeastNCoordinatesOrNothing = function (e, t) {
        return t.length >= e ? t : []
    }, kl.indexOf = function (e, t) {
        for (var n = 0; n < t.length; n++) if (e.equals(t[n])) return n;
        return -1
    }, kl.increasingDirection = function (e) {
        for (var t = 0; t < Math.trunc(e.length / 2); t++) {
            var n = e.length - 1 - t, r = e[t].compareTo(e[n]);
            if (0 !== r) return r
        }
        return 1
    }, kl.compare = function (e, t) {
        for (var n = 0; n < e.length && n < t.length;) {
            var r = e[n].compareTo(t[n]);
            if (0 !== r) return r;
            n++
        }
        return n < t.length ? -1 : n < e.length ? 1 : 0
    }, kl.minCoordinate = function (e) {
        for (var t = null, n = 0; n < e.length; n++) (null === t || t.compareTo(e[n]) > 0) && (t = e[n]);
        return t
    }, kl.extract = function (e, t, n) {
        t = Mf.clamp(t, 0, e.length);
        var r = (n = Mf.clamp(n, -1, e.length)) - t + 1;
        n < 0 && (r = 0), t >= e.length && (r = 0), n < t && (r = 0);
        var i = (new Array(r)).fill(null);
        if (0 === r) return i;
        for (var s = 0, o = t; o <= n; o++) i[s++] = e[o];
        return i
    }, Object.defineProperties(kl, Ll);
    var Al = function () {
    };
    Al.prototype.compare = function (e, t) {
        return kl.compare(e, t)
    }, Al.prototype.interfaces_ = function () {
        return [xf]
    }, Al.prototype.getClass = function () {
        return Al
    };
    var Ol = function () {
    };
    Ol.prototype.compare = function (e, t) {
        var n = e, r = t;
        if (n.length < r.length) return -1;
        if (n.length > r.length) return 1;
        if (0 === n.length) return 0;
        var i = kl.compare(n, r);
        return kl.isEqualReversed(n, r) ? 0 : i
    }, Ol.prototype.OLDcompare = function (e, t) {
        var n = e, r = t;
        if (n.length < r.length) return -1;
        if (n.length > r.length) return 1;
        if (0 === n.length) return 0;
        for (var i = kl.increasingDirection(n), s = kl.increasingDirection(r), o = i > 0 ? 0 : n.length - 1, u = s > 0 ? 0 : n.length - 1, a = 0; a < n.length; a++) {
            var f = n[o].compareTo(r[u]);
            if (0 !== f) return f;
            o += i, u += s
        }
        return 0
    }, Ol.prototype.interfaces_ = function () {
        return [xf]
    }, Ol.prototype.getClass = function () {
        return Ol
    };
    var Ml = function () {
    };
    Ml.prototype.get = function () {
    }, Ml.prototype.put = function () {
    }, Ml.prototype.size = function () {
    }, Ml.prototype.values = function () {
    }, Ml.prototype.entrySet = function () {
    };
    var _l = function (e) {
        function t() {
            e.apply(this, arguments)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t
    }(Ml);
    (Ms.prototype = new Error).name = "OperationNotSupported", (_s.prototype = new wl).contains = function () {
    };
    var Dl = function (e) {
        function t() {
            e.call(this), this.array_ = [], arguments[0] instanceof wl && this.addAll(arguments[0])
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.contains = function (e) {
            for (var t = 0, n = this.array_.length; t < n; t++) if (this.array_[t] === e) return !0;
            return !1
        }, t.prototype.add = function (e) {
            return !this.contains(e) && (this.array_.push(e), !0)
        }, t.prototype.addAll = function (e) {
            for (var t = e.iterator(); t.hasNext();) this.add(t.next());
            return !0
        }, t.prototype.remove = function (e) {
            throw new Error
        }, t.prototype.size = function () {
            return this.array_.length
        }, t.prototype.isEmpty = function () {
            return 0 === this.array_.length
        }, t.prototype.toArray = function () {
            for (var e = [], t = 0, n = this.array_.length; t < n; t++) e.push(this.array_[t]);
            return e
        }, t.prototype.iterator = function () {
            return new Pl(this)
        }, t
    }(_s), Pl = function (e) {
        function t(t) {
            e.call(this), this.hashSet_ = t, this.position_ = 0
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.next = function () {
            if (this.position_ === this.hashSet_.size()) throw new Os;
            return this.hashSet_.array_[this.position_++]
        }, t.prototype.hasNext = function () {
            return this.position_ < this.hashSet_.size()
        }, t.prototype.remove = function () {
            throw new Ms
        }, t
    }(Sl), Hl = 0;
    (Fs.prototype = new _l).get = function (e) {
        for (var t = this.root_; null !== t;) {
            var n = e.compareTo(t.key);
            if (n < 0) t = t.left; else {
                if (!(n > 0)) return t.value;
                t = t.right
            }
        }
        return null
    }, Fs.prototype.put = function (e, t) {
        if (null === this.root_) return this.root_ = {
            key: e,
            value: t,
            left: null,
            right: null,
            parent: null,
            color: Hl,
            getValue: function () {
                return this.value
            },
            getKey: function () {
                return this.key
            }
        }, this.size_ = 1, null;
        var n, r, i = this.root_;
        do if (n = i, (r = e.compareTo(i.key)) < 0) i = i.left; else {
            if (!(r > 0)) {
                var s = i.value;
                return i.value = t, s
            }
            i = i.right
        } while (null !== i);
        var o = {
            key: e, left: null, right: null, value: t, parent: n, color: Hl, getValue: function () {
                return this.value
            }, getKey: function () {
                return this.key
            }
        };
        return r < 0 ? n.left = o : n.right = o, this.fixAfterInsertion(o), this.size_++, null
    }, Fs.prototype.fixAfterInsertion = function (e) {
        for (e.color = 1; null != e && e !== this.root_ && 1 === e.parent.color;) if (Ps(e) === Bs(Ps(Ps(e)))) {
            var t = js(Ps(Ps(e)));
            1 === Ds(t) ? (Hs(Ps(e), Hl), Hs(t, Hl), Hs(Ps(Ps(e)), 1), e = Ps(Ps(e))) : (e === js(Ps(e)) && (e = Ps(e), this.rotateLeft(e)), Hs(Ps(e), Hl), Hs(Ps(Ps(e)), 1), this.rotateRight(Ps(Ps(e))))
        } else {
            var n = Bs(Ps(Ps(e)));
            1 === Ds(n) ? (Hs(Ps(e), Hl), Hs(n, Hl), Hs(Ps(Ps(e)), 1), e = Ps(Ps(e))) : (e === Bs(Ps(e)) && (e = Ps(e), this.rotateRight(e)), Hs(Ps(e), Hl), Hs(Ps(Ps(e)), 1), this.rotateLeft(Ps(Ps(e))))
        }
        this.root_.color = Hl
    }, Fs.prototype.values = function () {
        var e = new Tl, t = this.getFirstEntry();
        if (null !== t) for (e.add(t.value); null !== (t = Fs.successor(t));) e.add(t.value);
        return e
    }, Fs.prototype.entrySet = function () {
        var e = new Dl, t = this.getFirstEntry();
        if (null !== t) for (e.add(t); null !== (t = Fs.successor(t));) e.add(t);
        return e
    }, Fs.prototype.rotateLeft = function (e) {
        if (null != e) {
            var t = e.right;
            e.right = t.left, null != t.left && (t.left.parent = e), t.parent = e.parent, null === e.parent ? this.root_ = t : e.parent.left === e ? e.parent.left = t : e.parent.right = t, t.left = e, e.parent = t
        }
    }, Fs.prototype.rotateRight = function (e) {
        if (null != e) {
            var t = e.left;
            e.left = t.right, null != t.right && (t.right.parent = e), t.parent = e.parent, null === e.parent ? this.root_ = t : e.parent.right === e ? e.parent.right = t : e.parent.left = t, t.right = e, e.parent = t
        }
    }, Fs.prototype.getFirstEntry = function () {
        var e = this.root_;
        if (null != e) for (; null != e.left;) e = e.left;
        return e
    }, Fs.successor = function (e) {
        if (null === e) return null;
        if (null !== e.right) {
            for (var t = e.right; null !== t.left;) t = t.left;
            return t
        }
        for (var n = e.parent, r = e; null !== n && r === n.right;) r = n, n = n.parent;
        return n
    }, Fs.prototype.size = function () {
        return this.size_
    };
    var Bl = function () {
    };
    Bl.prototype.interfaces_ = function () {
        return []
    }, Bl.prototype.getClass = function () {
        return Bl
    }, Is.prototype = new _s, (qs.prototype = new Is).contains = function (e) {
        for (var t = 0, n = this.array_.length; t < n; t++) if (0 === this.array_[t].compareTo(e)) return !0;
        return !1
    }, qs.prototype.add = function (e) {
        if (this.contains(e)) return !1;
        for (var t = 0, n = this.array_.length; t < n; t++) if (1 === this.array_[t].compareTo(e)) return this.array_.splice(t, 0, e), !0;
        return this.array_.push(e), !0
    }, qs.prototype.addAll = function (e) {
        for (var t = e.iterator(); t.hasNext();) this.add(t.next());
        return !0
    }, qs.prototype.remove = function (e) {
        throw new Ms
    }, qs.prototype.size = function () {
        return this.array_.length
    }, qs.prototype.isEmpty = function () {
        return 0 === this.array_.length
    }, qs.prototype.toArray = function () {
        for (var e = [], t = 0, n = this.array_.length; t < n; t++) e.push(this.array_[t]);
        return e
    }, qs.prototype.iterator = function () {
        return new jl(this)
    };
    var jl = function (e) {
        this.treeSet_ = e, this.position_ = 0
    };
    jl.prototype.next = function () {
        if (this.position_ === this.treeSet_.size()) throw new Os;
        return this.treeSet_.array_[this.position_++]
    }, jl.prototype.hasNext = function () {
        return this.position_ < this.treeSet_.size()
    }, jl.prototype.remove = function () {
        throw new Ms
    };
    var Fl = function () {
    };
    Fl.sort = function () {
        var e, t, n, r, i = arguments[0];
        if (1 === arguments.length) r = function (e, t) {
            return e.compareTo(t)
        }, i.sort(r); else if (2 === arguments.length) n = arguments[1], r = function (e, t) {
            return n.compare(e, t)
        }, i.sort(r); else if (3 === arguments.length) {
            (t = i.slice(arguments[1], arguments[2])).sort();
            var s = i.slice(0, arguments[1]).concat(t, i.slice(arguments[2], i.length));
            for (i.splice(0, i.length), e = 0; e < s.length; e++) i.push(s[e])
        } else if (4 === arguments.length) for (t = i.slice(arguments[1], arguments[2]), n = arguments[3], r = function (e, t) {
            return n.compare(e, t)
        }, t.sort(r), s = i.slice(0, arguments[1]).concat(t, i.slice(arguments[2], i.length)), i.splice(0, i.length), e = 0; e < s.length; e++) i.push(s[e])
    }, Fl.asList = function (e) {
        for (var t = new Tl, n = 0, r = e.length; n < r; n++) t.add(e[n]);
        return t
    };
    var Il = function () {
    }, ql = {
        P: {configurable: !0},
        L: {configurable: !0},
        A: {configurable: !0},
        FALSE: {configurable: !0},
        TRUE: {configurable: !0},
        DONTCARE: {configurable: !0},
        SYM_FALSE: {configurable: !0},
        SYM_TRUE: {configurable: !0},
        SYM_DONTCARE: {configurable: !0},
        SYM_P: {configurable: !0},
        SYM_L: {configurable: !0},
        SYM_A: {configurable: !0}
    };
    ql.P.get = function () {
        return 0
    }, ql.L.get = function () {
        return 1
    }, ql.A.get = function () {
        return 2
    }, ql.FALSE.get = function () {
        return -1
    }, ql.TRUE.get = function () {
        return -2
    }, ql.DONTCARE.get = function () {
        return -3
    }, ql.SYM_FALSE.get = function () {
        return "F"
    }, ql.SYM_TRUE.get = function () {
        return "T"
    }, ql.SYM_DONTCARE.get = function () {
        return "*"
    }, ql.SYM_P.get = function () {
        return "0"
    }, ql.SYM_L.get = function () {
        return "1"
    }, ql.SYM_A.get = function () {
        return "2"
    }, Il.prototype.interfaces_ = function () {
        return []
    }, Il.prototype.getClass = function () {
        return Il
    }, Il.toDimensionSymbol = function (e) {
        switch (e) {
            case Il.FALSE:
                return Il.SYM_FALSE;
            case Il.TRUE:
                return Il.SYM_TRUE;
            case Il.DONTCARE:
                return Il.SYM_DONTCARE;
            case Il.P:
                return Il.SYM_P;
            case Il.L:
                return Il.SYM_L;
            case Il.A:
                return Il.SYM_A
        }
        throw new yf("Unknown dimension value: " + e)
    }, Il.toDimensionValue = function (e) {
        switch (Hf.toUpperCase(e)) {
            case Il.SYM_FALSE:
                return Il.FALSE;
            case Il.SYM_TRUE:
                return Il.TRUE;
            case Il.SYM_DONTCARE:
                return Il.DONTCARE;
            case Il.SYM_P:
                return Il.P;
            case Il.SYM_L:
                return Il.L;
            case Il.SYM_A:
                return Il.A
        }
        throw new yf("Unknown dimension symbol: " + e)
    }, Object.defineProperties(Il, ql);
    var Rl = function () {
    };
    Rl.prototype.filter = function (e) {
    }, Rl.prototype.interfaces_ = function () {
        return []
    }, Rl.prototype.getClass = function () {
        return Rl
    };
    var Ul = function () {
    };
    Ul.prototype.filter = function (e, t) {
    }, Ul.prototype.isDone = function () {
    }, Ul.prototype.isGeometryChanged = function () {
    }, Ul.prototype.interfaces_ = function () {
        return []
    }, Ul.prototype.getClass = function () {
        return Ul
    };
    var zl = function (e) {
        function t(t, n) {
            if (e.call(this, n), this._geometries = t || [], e.hasNullElements(this._geometries)) throw new yf("geometries must not contain null elements")
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {serialVersionUID: {configurable: !0}};
        return t.prototype.computeEnvelopeInternal = function () {
            for (var e = new Vf, t = 0; t < this._geometries.length; t++) e.expandToInclude(this._geometries[t].getEnvelopeInternal());
            return e
        }, t.prototype.getGeometryN = function (e) {
            return this._geometries[e]
        }, t.prototype.getSortIndex = function () {
            return e.SORTINDEX_GEOMETRYCOLLECTION
        }, t.prototype.getCoordinates = function () {
            for (var e = (new Array(this.getNumPoints())).fill(null), t = -1, n = 0; n < this._geometries.length; n++) for (var r = this._geometries[n].getCoordinates(), i = 0; i < r.length; i++) e[++t] = r[i];
            return e
        }, t.prototype.getArea = function () {
            for (var e = 0, t = 0; t < this._geometries.length; t++) e += this._geometries[t].getArea();
            return e
        }, t.prototype.equalsExact = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                if (!this.isEquivalentClass(t)) return !1;
                var r = t;
                if (this._geometries.length !== r._geometries.length) return !1;
                for (var i = 0; i < this._geometries.length; i++) if (!this._geometries[i].equalsExact(r._geometries[i], n)) return !1;
                return !0
            }
            return e.prototype.equalsExact.apply(this, arguments)
        }, t.prototype.normalize = function () {
            for (var e = 0; e < this._geometries.length; e++) this._geometries[e].normalize();
            Fl.sort(this._geometries)
        }, t.prototype.getCoordinate = function () {
            return this.isEmpty() ? null : this._geometries[0].getCoordinate()
        }, t.prototype.getBoundaryDimension = function () {
            for (var e = Il.FALSE, t = 0; t < this._geometries.length; t++) e = Math.max(e, this._geometries[t].getBoundaryDimension());
            return e
        }, t.prototype.getDimension = function () {
            for (var e = Il.FALSE, t = 0; t < this._geometries.length; t++) e = Math.max(e, this._geometries[t].getDimension());
            return e
        }, t.prototype.getLength = function () {
            for (var e = 0, t = 0; t < this._geometries.length; t++) e += this._geometries[t].getLength();
            return e
        }, t.prototype.getNumPoints = function () {
            for (var e = 0, t = 0; t < this._geometries.length; t++) e += this._geometries[t].getNumPoints();
            return e
        }, t.prototype.getNumGeometries = function () {
            return this._geometries.length
        }, t.prototype.reverse = function () {
            for (var e = this._geometries.length, t = (new Array(e)).fill(null), n = 0; n < this._geometries.length; n++) t[n] = this._geometries[n].reverse();
            return this.getFactory().createGeometryCollection(t)
        }, t.prototype.compareToSameClass = function () {
            if (1 === arguments.length) {
                var e = arguments[0], t = new qs(Fl.asList(this._geometries)), n = new qs(Fl.asList(e._geometries));
                return this.compare(t, n)
            }
            if (2 === arguments.length) {
                for (var r = arguments[0], i = arguments[1], s = r, o = this.getNumGeometries(), u = s.getNumGeometries(), a = 0; a < o && a < u;) {
                    var f = this.getGeometryN(a), l = s.getGeometryN(a), c = f.compareToSameClass(l, i);
                    if (0 !== c) return c;
                    a++
                }
                return a < o ? 1 : a < u ? -1 : 0
            }
        }, t.prototype.apply = function () {
            if (Of(arguments[0], pl)) for (var e = arguments[0], t = 0; t < this._geometries.length; t++) this._geometries[t].apply(e); else if (Of(arguments[0], Ul)) {
                var n = arguments[0];
                if (0 === this._geometries.length) return null;
                for (var r = 0; r < this._geometries.length && (this._geometries[r].apply(n), !n.isDone()); r++) ;
                n.isGeometryChanged() && this.geometryChanged()
            } else if (Of(arguments[0], Rl)) {
                var i = arguments[0];
                i.filter(this);
                for (var s = 0; s < this._geometries.length; s++) this._geometries[s].apply(i)
            } else if (Of(arguments[0], fl)) {
                var o = arguments[0];
                o.filter(this);
                for (var u = 0; u < this._geometries.length; u++) this._geometries[u].apply(o)
            }
        }, t.prototype.getBoundary = function () {
            return this.checkNotGeometryCollection(this), tl.shouldNeverReachHere(), null
        }, t.prototype.clone = function () {
            var t = e.prototype.clone.call(this);
            t._geometries = (new Array(this._geometries.length)).fill(null);
            for (var n = 0; n < this._geometries.length; n++) t._geometries[n] = this._geometries[n].clone();
            return t
        }, t.prototype.getGeometryType = function () {
            return "GeometryCollection"
        }, t.prototype.copy = function () {
            for (var e = (new Array(this._geometries.length)).fill(null), n = 0; n < e.length; n++) e[n] = this._geometries[n].copy();
            return new t(e, this._factory)
        }, t.prototype.isEmpty = function () {
            for (var e = 0; e < this._geometries.length; e++) if (!this._geometries[e].isEmpty()) return !1;
            return !0
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, n.serialVersionUID.get = function () {
            return -0x4f07bcb1f857d800
        }, Object.defineProperties(t, n), t
    }(ll), Wl = function (e) {
        function t() {
            e.apply(this, arguments)
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {serialVersionUID: {configurable: !0}};
        return t.prototype.getSortIndex = function () {
            return ll.SORTINDEX_MULTILINESTRING
        }, t.prototype.equalsExact = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                return !!this.isEquivalentClass(t) && e.prototype.equalsExact.call(this, t, n)
            }
            return e.prototype.equalsExact.apply(this, arguments)
        }, t.prototype.getBoundaryDimension = function () {
            return this.isClosed() ? Il.FALSE : 0
        }, t.prototype.isClosed = function () {
            if (this.isEmpty()) return !1;
            for (var e = 0; e < this._geometries.length; e++) if (!this._geometries[e].isClosed()) return !1;
            return !0
        }, t.prototype.getDimension = function () {
            return 1
        }, t.prototype.reverse = function () {
            for (var e = this._geometries.length, t = (new Array(e)).fill(null), n = 0; n < this._geometries.length; n++) t[e - 1 - n] = this._geometries[n].reverse();
            return this.getFactory().createMultiLineString(t)
        }, t.prototype.getBoundary = function () {
            return (new Xl(this)).getBoundary()
        }, t.prototype.getGeometryType = function () {
            return "MultiLineString"
        }, t.prototype.copy = function () {
            for (var e = (new Array(this._geometries.length)).fill(null), n = 0; n < e.length; n++) e[n] = this._geometries[n].copy();
            return new t(e, this._factory)
        }, t.prototype.interfaces_ = function () {
            return [Bl]
        }, t.prototype.getClass = function () {
            return t
        }, n.serialVersionUID.get = function () {
            return 0x7155d2ab4afa8000
        }, Object.defineProperties(t, n), t
    }(zl), Xl = function () {
        if (this._geom = null, this._geomFact = null, this._bnRule = null, this._endpointMap = null, 1 === arguments.length) {
            var e = arguments[0], t = dl.MOD2_BOUNDARY_RULE;
            this._geom = e, this._geomFact = e.getFactory(), this._bnRule = t
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            this._geom = n, this._geomFact = n.getFactory(), this._bnRule = r
        }
    };
    Xl.prototype.boundaryMultiLineString = function (e) {
        if (this._geom.isEmpty()) return this.getEmptyMultiPoint();
        var t = this.computeBoundaryCoordinates(e);
        return 1 === t.length ? this._geomFact.createPoint(t[0]) : this._geomFact.createMultiPointFromCoords(t)
    }, Xl.prototype.getBoundary = function () {
        return this._geom instanceof Ql ? this.boundaryLineString(this._geom) : this._geom instanceof Wl ? this.boundaryMultiLineString(this._geom) : this._geom.getBoundary()
    }, Xl.prototype.boundaryLineString = function (e) {
        return this._geom.isEmpty() ? this.getEmptyMultiPoint() : e.isClosed() ? this._bnRule.isInBoundary(2) ? e.getStartPoint() : this._geomFact.createMultiPoint() : this._geomFact.createMultiPoint([e.getStartPoint(), e.getEndPoint()])
    }, Xl.prototype.getEmptyMultiPoint = function () {
        return this._geomFact.createMultiPoint()
    }, Xl.prototype.computeBoundaryCoordinates = function (e) {
        var t = new Tl;
        this._endpointMap = new Fs;
        for (var n = 0; n < e.getNumGeometries(); n++) {
            var r = e.getGeometryN(n);
            0 !== r.getNumPoints() && (this.addEndpoint(r.getCoordinateN(0)), this.addEndpoint(r.getCoordinateN(r.getNumPoints() - 1)))
        }
        for (var i = this._endpointMap.entrySet().iterator(); i.hasNext();) {
            var s = i.next(), o = s.getValue().count;
            this._bnRule.isInBoundary(o) && t.add(s.getKey())
        }
        return kl.toCoordinateArray(t)
    }, Xl.prototype.addEndpoint = function (e) {
        var t = this._endpointMap.get(e);
        null === t && (t = new Vl, this._endpointMap.put(e, t)), t.count++
    }, Xl.prototype.interfaces_ = function () {
        return []
    }, Xl.prototype.getClass = function () {
        return Xl
    }, Xl.getBoundary = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return (new Xl(e)).getBoundary()
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return (new Xl(t, n)).getBoundary()
        }
    };
    var Vl = function () {
        this.count = null
    };
    Vl.prototype.interfaces_ = function () {
        return []
    }, Vl.prototype.getClass = function () {
        return Vl
    };
    var $l = function () {
    }, Jl = {NEWLINE: {configurable: !0}, SIMPLE_ORDINATE_FORMAT: {configurable: !0}};
    $l.prototype.interfaces_ = function () {
        return []
    }, $l.prototype.getClass = function () {
        return $l
    }, $l.chars = function (e, t) {
        for (var n = (new Array(t)).fill(null), r = 0; r < t; r++) n[r] = e;
        return String(n)
    }, $l.getStackTrace = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = new function () {
            }, n = new function () {
            }(t);
            return e.printStackTrace(n), t.toString()
        }
        if (2 === arguments.length) {
            for (var r = arguments[0], i = arguments[1], s = "", o = new function () {
            }(new function () {
            }($l.getStackTrace(r))), u = 0; u < i; u++) try {
                s += o.readLine() + $l.NEWLINE
            } catch (e) {
                if (!(e instanceof Rs)) throw e;
                tl.shouldNeverReachHere()
            }
            return s
        }
    }, $l.split = function (e, t) {
        for (var n = t.length, r = new Tl, i = "" + e, s = i.indexOf(t); s >= 0;) {
            var o = i.substring(0, s);
            r.add(o), s = (i = i.substring(s + n)).indexOf(t)
        }
        i.length > 0 && r.add(i);
        for (var u = (new Array(r.size())).fill(null), a = 0; a < u.length; a++) u[a] = r.get(a);
        return u
    }, $l.toString = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return $l.SIMPLE_ORDINATE_FORMAT.format(e)
        }
    }, $l.spaces = function (e) {
        return $l.chars(" ", e)
    }, Jl.NEWLINE.get = function () {
        return Wf.getProperty("line.separator")
    }, Jl.SIMPLE_ORDINATE_FORMAT.get = function () {
        return new function () {
        }("0.#")
    }, Object.defineProperties($l, Jl);
    var Kl = function () {
    };
    Kl.prototype.interfaces_ = function () {
        return []
    }, Kl.prototype.getClass = function () {
        return Kl
    }, Kl.copyCoord = function (e, t, n, r) {
        for (var i = Math.min(e.getDimension(), n.getDimension()), s = 0; s < i; s++) n.setOrdinate(r, s, e.getOrdinate(t, s))
    }, Kl.isRing = function (e) {
        var t = e.size();
        return 0 === t || !(t <= 3) && e.getOrdinate(0, qf.X) === e.getOrdinate(t - 1, qf.X) && e.getOrdinate(0, qf.Y) === e.getOrdinate(t - 1, qf.Y)
    }, Kl.isEqual = function (e, t) {
        var n = e.size();
        if (n !== t.size()) return !1;
        for (var r = Math.min(e.getDimension(), t.getDimension()), i = 0; i < n; i++) for (var s = 0; s < r; s++) {
            var o = e.getOrdinate(i, s), u = t.getOrdinate(i, s);
            if (e.getOrdinate(i, s) !== t.getOrdinate(i, s) && (!bf.isNaN(o) || !bf.isNaN(u))) return !1
        }
        return !0
    }, Kl.extend = function (e, t, n) {
        var r = e.create(n, t.getDimension()), i = t.size();
        if (Kl.copy(t, 0, r, 0, i), i > 0) for (var s = i; s < n; s++) Kl.copy(t, i - 1, r, s, 1);
        return r
    }, Kl.reverse = function (e) {
        for (var t = e.size() - 1, n = Math.trunc(t / 2), r = 0; r <= n; r++) Kl.swap(e, r, t - r)
    }, Kl.swap = function (e, t, n) {
        if (t === n) return null;
        for (var r = 0; r < e.getDimension(); r++) {
            var i = e.getOrdinate(t, r);
            e.setOrdinate(t, r, e.getOrdinate(n, r)), e.setOrdinate(n, r, i)
        }
    }, Kl.copy = function (e, t, n, r, i) {
        for (var s = 0; s < i; s++) Kl.copyCoord(e, t + s, n, r + s)
    }, Kl.toString = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = e.size();
            if (0 === t) return "()";
            var n = e.getDimension(), r = new Df;
            r.append("(");
            for (var i = 0; i < t; i++) {
                i > 0 && r.append(" ");
                for (var s = 0; s < n; s++) s > 0 && r.append(","), r.append($l.toString(e.getOrdinate(i, s)))
            }
            return r.append(")"), r.toString()
        }
    }, Kl.ensureValidRing = function (e, t) {
        var n = t.size();
        return 0 === n ? t : n <= 3 ? Kl.createClosedRing(e, t, 4) : t.getOrdinate(0, qf.X) === t.getOrdinate(n - 1, qf.X) && t.getOrdinate(0, qf.Y) === t.getOrdinate(n - 1, qf.Y) ? t : Kl.createClosedRing(e, t, n + 1)
    }, Kl.createClosedRing = function (e, t, n) {
        var r = e.create(n, t.getDimension()), i = t.size();
        Kl.copy(t, 0, r, 0, i);
        for (var s = i; s < n; s++) Kl.copy(t, 0, r, s, 1);
        return r
    };
    var Ql = function (e) {
        function t(t, n) {
            e.call(this, n), this._points = null, this.init(t)
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {serialVersionUID: {configurable: !0}};
        return t.prototype.computeEnvelopeInternal = function () {
            return this.isEmpty() ? new Vf : this._points.expandEnvelope(new Vf)
        }, t.prototype.isRing = function () {
            return this.isClosed() && this.isSimple()
        }, t.prototype.getSortIndex = function () {
            return e.SORTINDEX_LINESTRING
        }, t.prototype.getCoordinates = function () {
            return this._points.toCoordinateArray()
        }, t.prototype.equalsExact = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                if (!this.isEquivalentClass(t)) return !1;
                var r = t;
                if (this._points.size() !== r._points.size()) return !1;
                for (var i = 0; i < this._points.size(); i++) if (!this.equal(this._points.getCoordinate(i), r._points.getCoordinate(i), n)) return !1;
                return !0
            }
            return e.prototype.equalsExact.apply(this, arguments)
        }, t.prototype.normalize = function () {
            for (var e = 0; e < Math.trunc(this._points.size() / 2); e++) {
                var t = this._points.size() - 1 - e;
                if (!this._points.getCoordinate(e).equals(this._points.getCoordinate(t))) return this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t)) > 0 && Kl.reverse(this._points), null
            }
        }, t.prototype.getCoordinate = function () {
            return this.isEmpty() ? null : this._points.getCoordinate(0)
        }, t.prototype.getBoundaryDimension = function () {
            return this.isClosed() ? Il.FALSE : 0
        }, t.prototype.isClosed = function () {
            return !this.isEmpty() && this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints() - 1))
        }, t.prototype.getEndPoint = function () {
            return this.isEmpty() ? null : this.getPointN(this.getNumPoints() - 1)
        }, t.prototype.getDimension = function () {
            return 1
        }, t.prototype.getLength = function () {
            return ul.computeLength(this._points)
        }, t.prototype.getNumPoints = function () {
            return this._points.size()
        }, t.prototype.reverse = function () {
            var e = this._points.copy();
            return Kl.reverse(e), this.getFactory().createLineString(e)
        }, t.prototype.compareToSameClass = function () {
            if (1 === arguments.length) {
                for (var e = arguments[0], t = 0, n = 0; t < this._points.size() && n < e._points.size();) {
                    var r = this._points.getCoordinate(t).compareTo(e._points.getCoordinate(n));
                    if (0 !== r) return r;
                    t++, n++
                }
                return t < this._points.size() ? 1 : n < e._points.size() ? -1 : 0
            }
            if (2 === arguments.length) {
                var i = arguments[0];
                return arguments[1].compare(this._points, i._points)
            }
        }, t.prototype.apply = function () {
            if (Of(arguments[0], pl)) for (var e = arguments[0], t = 0; t < this._points.size(); t++) e.filter(this._points.getCoordinate(t)); else if (Of(arguments[0], Ul)) {
                var n = arguments[0];
                if (0 === this._points.size()) return null;
                for (var r = 0; r < this._points.size() && (n.filter(this._points, r), !n.isDone()); r++) ;
                n.isGeometryChanged() && this.geometryChanged()
            } else Of(arguments[0], Rl) ? arguments[0].filter(this) : Of(arguments[0], fl) && arguments[0].filter(this)
        }, t.prototype.getBoundary = function () {
            return (new Xl(this)).getBoundary()
        }, t.prototype.isEquivalentClass = function (e) {
            return e instanceof t
        }, t.prototype.clone = function () {
            var t = e.prototype.clone.call(this);
            return t._points = this._points.clone(), t
        }, t.prototype.getCoordinateN = function (e) {
            return this._points.getCoordinate(e)
        }, t.prototype.getGeometryType = function () {
            return "LineString"
        }, t.prototype.copy = function () {
            return new t(this._points.copy(), this._factory)
        }, t.prototype.getCoordinateSequence = function () {
            return this._points
        }, t.prototype.isEmpty = function () {
            return 0 === this._points.size()
        }, t.prototype.init = function (e) {
            if (null === e && (e = this.getFactory().getCoordinateSequenceFactory().create([])), 1 === e.size()) throw new yf("Invalid number of points in LineString (found " + e.size() + " - must be 0 or >= 2)");
            this._points = e
        }, t.prototype.isCoordinate = function (e) {
            for (var t = 0; t < this._points.size(); t++) if (this._points.getCoordinate(t).equals(e)) return !0;
            return !1
        }, t.prototype.getStartPoint = function () {
            return this.isEmpty() ? null : this.getPointN(0)
        }, t.prototype.getPointN = function (e) {
            return this.getFactory().createPoint(this._points.getCoordinate(e))
        }, t.prototype.interfaces_ = function () {
            return [Bl]
        }, t.prototype.getClass = function () {
            return t
        }, n.serialVersionUID.get = function () {
            return 0x2b2b51ba435c8e00
        }, Object.defineProperties(t, n), t
    }(ll), Gl = function () {
    };
    Gl.prototype.interfaces_ = function () {
        return []
    }, Gl.prototype.getClass = function () {
        return Gl
    };
    var Yl = function (e) {
        function t(t, n) {
            e.call(this, n), this._coordinates = t || null, this.init(this._coordinates)
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {serialVersionUID: {configurable: !0}};
        return t.prototype.computeEnvelopeInternal = function () {
            if (this.isEmpty()) return new Vf;
            var e = new Vf;
            return e.expandToInclude(this._coordinates.getX(0), this._coordinates.getY(0)), e
        }, t.prototype.getSortIndex = function () {
            return e.SORTINDEX_POINT
        }, t.prototype.getCoordinates = function () {
            return this.isEmpty() ? [] : [this.getCoordinate()]
        }, t.prototype.equalsExact = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                return !!this.isEquivalentClass(t) && (!!this.isEmpty() && !!t.isEmpty() || this.isEmpty() === t.isEmpty() && this.equal(t.getCoordinate(), this.getCoordinate(), n))
            }
            return e.prototype.equalsExact.apply(this, arguments)
        }, t.prototype.normalize = function () {
        }, t.prototype.getCoordinate = function () {
            return 0 !== this._coordinates.size() ? this._coordinates.getCoordinate(0) : null
        }, t.prototype.getBoundaryDimension = function () {
            return Il.FALSE
        }, t.prototype.getDimension = function () {
            return 0
        }, t.prototype.getNumPoints = function () {
            return this.isEmpty() ? 0 : 1
        }, t.prototype.reverse = function () {
            return this.copy()
        }, t.prototype.getX = function () {
            if (null === this.getCoordinate()) throw new Error("getX called on empty Point");
            return this.getCoordinate().x
        }, t.prototype.compareToSameClass = function () {
            if (1 === arguments.length) {
                var e = arguments[0];
                return this.getCoordinate().compareTo(e.getCoordinate())
            }
            if (2 === arguments.length) {
                var t = arguments[0];
                return arguments[1].compare(this._coordinates, t._coordinates)
            }
        }, t.prototype.apply = function () {
            if (Of(arguments[0], pl)) {
                var e = arguments[0];
                if (this.isEmpty()) return null;
                e.filter(this.getCoordinate())
            } else if (Of(arguments[0], Ul)) {
                var t = arguments[0];
                if (this.isEmpty()) return null;
                t.filter(this._coordinates, 0), t.isGeometryChanged() && this.geometryChanged()
            } else Of(arguments[0], Rl) ? arguments[0].filter(this) : Of(arguments[0], fl) && arguments[0].filter(this)
        }, t.prototype.getBoundary = function () {
            return this.getFactory().createGeometryCollection(null)
        }, t.prototype.clone = function () {
            var t = e.prototype.clone.call(this);
            return t._coordinates = this._coordinates.clone(), t
        }, t.prototype.getGeometryType = function () {
            return "Point"
        }, t.prototype.copy = function () {
            return new t(this._coordinates.copy(), this._factory)
        }, t.prototype.getCoordinateSequence = function () {
            return this._coordinates
        }, t.prototype.getY = function () {
            if (null === this.getCoordinate()) throw new Error("getY called on empty Point");
            return this.getCoordinate().y
        }, t.prototype.isEmpty = function () {
            return 0 === this._coordinates.size()
        }, t.prototype.init = function (e) {
            null === e && (e = this.getFactory().getCoordinateSequenceFactory().create([])), tl.isTrue(e.size() <= 1), this._coordinates = e
        }, t.prototype.isSimple = function () {
            return !0
        }, t.prototype.interfaces_ = function () {
            return [Gl]
        }, t.prototype.getClass = function () {
            return t
        }, n.serialVersionUID.get = function () {
            return 0x44077bad161cbc00
        }, Object.defineProperties(t, n), t
    }(ll), Zl = function () {
    };
    Zl.prototype.interfaces_ = function () {
        return []
    }, Zl.prototype.getClass = function () {
        return Zl
    };
    var ec = function (e) {
        function t(t, n, r) {
            if (e.call(this, r), this._shell = null, this._holes = null, null === t && (t = this.getFactory().createLinearRing()), null === n && (n = []), e.hasNullElements(n)) throw new yf("holes must not contain null elements");
            if (t.isEmpty() && e.hasNonEmptyElements(n)) throw new yf("shell is empty but holes are not");
            this._shell = t, this._holes = n
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {serialVersionUID: {configurable: !0}};
        return t.prototype.computeEnvelopeInternal = function () {
            return this._shell.getEnvelopeInternal()
        }, t.prototype.getSortIndex = function () {
            return e.SORTINDEX_POLYGON
        }, t.prototype.getCoordinates = function () {
            if (this.isEmpty()) return [];
            for (var e = (new Array(this.getNumPoints())).fill(null), t = -1, n = this._shell.getCoordinates(), r = 0; r < n.length; r++) e[++t] = n[r];
            for (var i = 0; i < this._holes.length; i++) for (var s = this._holes[i].getCoordinates(), o = 0; o < s.length; o++) e[++t] = s[o];
            return e
        }, t.prototype.getArea = function () {
            var e = 0;
            e += Math.abs(ul.signedArea(this._shell.getCoordinateSequence()));
            for (var t = 0; t < this._holes.length; t++) e -= Math.abs(ul.signedArea(this._holes[t].getCoordinateSequence()));
            return e
        }, t.prototype.isRectangle = function () {
            if (0 !== this.getNumInteriorRing()) return !1;
            if (null === this._shell) return !1;
            if (5 !== this._shell.getNumPoints()) return !1;
            for (var e = this._shell.getCoordinateSequence(), t = this.getEnvelopeInternal(), n = 0; n < 5; n++) {
                var r = e.getX(n);
                if (r !== t.getMinX() && r !== t.getMaxX()) return !1;
                var i = e.getY(n);
                if (i !== t.getMinY() && i !== t.getMaxY()) return !1
            }
            for (var s = e.getX(0), o = e.getY(0), u = 1; u <= 4; u++) {
                var a = e.getX(u), f = e.getY(u);
                if (a !== s == (f !== o)) return !1;
                s = a, o = f
            }
            return !0
        }, t.prototype.equalsExact = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                if (!this.isEquivalentClass(t)) return !1;
                var r = t, i = this._shell, s = r._shell;
                if (!i.equalsExact(s, n)) return !1;
                if (this._holes.length !== r._holes.length) return !1;
                for (var o = 0; o < this._holes.length; o++) if (!this._holes[o].equalsExact(r._holes[o], n)) return !1;
                return !0
            }
            return e.prototype.equalsExact.apply(this, arguments)
        }, t.prototype.normalize = function () {
            if (0 === arguments.length) {
                this.normalize(this._shell, !0);
                for (var e = 0; e < this._holes.length; e++) this.normalize(this._holes[e], !1);
                Fl.sort(this._holes)
            } else if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                if (t.isEmpty()) return null;
                var r = (new Array(t.getCoordinates().length - 1)).fill(null);
                Wf.arraycopy(t.getCoordinates(), 0, r, 0, r.length);
                var i = kl.minCoordinate(t.getCoordinates());
                kl.scroll(r, i), Wf.arraycopy(r, 0, t.getCoordinates(), 0, r.length), t.getCoordinates()[r.length] = r[0], ul.isCCW(t.getCoordinates()) === n && kl.reverse(t.getCoordinates())
            }
        }, t.prototype.getCoordinate = function () {
            return this._shell.getCoordinate()
        }, t.prototype.getNumInteriorRing = function () {
            return this._holes.length
        }, t.prototype.getBoundaryDimension = function () {
            return 1
        }, t.prototype.getDimension = function () {
            return 2
        }, t.prototype.getLength = function () {
            var e = 0;
            e += this._shell.getLength();
            for (var t = 0; t < this._holes.length; t++) e += this._holes[t].getLength();
            return e
        }, t.prototype.getNumPoints = function () {
            for (var e = this._shell.getNumPoints(), t = 0; t < this._holes.length; t++) e += this._holes[t].getNumPoints();
            return e
        }, t.prototype.reverse = function () {
            var e = this.copy();
            e._shell = this._shell.copy().reverse(), e._holes = (new Array(this._holes.length)).fill(null);
            for (var t = 0; t < this._holes.length; t++) e._holes[t] = this._holes[t].copy().reverse();
            return e
        }, t.prototype.convexHull = function () {
            return this.getExteriorRing().convexHull()
        }, t.prototype.compareToSameClass = function () {
            if (1 === arguments.length) {
                var e = arguments[0], t = this._shell, n = e._shell;
                return t.compareToSameClass(n)
            }
            if (2 === arguments.length) {
                var r = arguments[0], i = arguments[1], s = r, o = this._shell, u = s._shell,
                    a = o.compareToSameClass(u, i);
                if (0 !== a) return a;
                for (var f = this.getNumInteriorRing(), l = s.getNumInteriorRing(), c = 0; c < f && c < l;) {
                    var h = this.getInteriorRingN(c), p = s.getInteriorRingN(c), d = h.compareToSameClass(p, i);
                    if (0 !== d) return d;
                    c++
                }
                return c < f ? 1 : c < l ? -1 : 0
            }
        }, t.prototype.apply = function (e) {
            if (Of(e, pl)) {
                this._shell.apply(e);
                for (var t = 0; t < this._holes.length; t++) this._holes[t].apply(e)
            } else if (Of(e, Ul)) {
                if (this._shell.apply(e), !e.isDone()) for (var n = 0; n < this._holes.length && (this._holes[n].apply(e), !e.isDone()); n++) ;
                e.isGeometryChanged() && this.geometryChanged()
            } else if (Of(e, Rl)) e.filter(this); else if (Of(e, fl)) {
                e.filter(this), this._shell.apply(e);
                for (var r = 0; r < this._holes.length; r++) this._holes[r].apply(e)
            }
        }, t.prototype.getBoundary = function () {
            if (this.isEmpty()) return this.getFactory().createMultiLineString();
            var e = (new Array(this._holes.length + 1)).fill(null);
            e[0] = this._shell;
            for (var t = 0; t < this._holes.length; t++) e[t + 1] = this._holes[t];
            return e.length <= 1 ? this.getFactory().createLinearRing(e[0].getCoordinateSequence()) : this.getFactory().createMultiLineString(e)
        }, t.prototype.clone = function () {
            var t = e.prototype.clone.call(this);
            t._shell = this._shell.clone(), t._holes = (new Array(this._holes.length)).fill(null);
            for (var n = 0; n < this._holes.length; n++) t._holes[n] = this._holes[n].clone();
            return t
        }, t.prototype.getGeometryType = function () {
            return "Polygon"
        }, t.prototype.copy = function () {
            for (var e = this._shell.copy(), n = (new Array(this._holes.length)).fill(null), r = 0; r < n.length; r++) n[r] = this._holes[r].copy();
            return new t(e, n, this._factory)
        }, t.prototype.getExteriorRing = function () {
            return this._shell
        }, t.prototype.isEmpty = function () {
            return this._shell.isEmpty()
        }, t.prototype.getInteriorRingN = function (e) {
            return this._holes[e]
        }, t.prototype.interfaces_ = function () {
            return [Zl]
        }, t.prototype.getClass = function () {
            return t
        }, n.serialVersionUID.get = function () {
            return -0x307ffefd8dc97200
        }, Object.defineProperties(t, n), t
    }(ll), tc = function (e) {
        function t() {
            e.apply(this, arguments)
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {serialVersionUID: {configurable: !0}};
        return t.prototype.getSortIndex = function () {
            return ll.SORTINDEX_MULTIPOINT
        }, t.prototype.isValid = function () {
            return !0
        }, t.prototype.equalsExact = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                return !!this.isEquivalentClass(t) && e.prototype.equalsExact.call(this, t, n)
            }
            return e.prototype.equalsExact.apply(this, arguments)
        }, t.prototype.getCoordinate = function () {
            if (1 === arguments.length) {
                var t = arguments[0];
                return this._geometries[t].getCoordinate()
            }
            return e.prototype.getCoordinate.apply(this, arguments)
        }, t.prototype.getBoundaryDimension = function () {
            return Il.FALSE
        }, t.prototype.getDimension = function () {
            return 0
        }, t.prototype.getBoundary = function () {
            return this.getFactory().createGeometryCollection(null)
        }, t.prototype.getGeometryType = function () {
            return "MultiPoint"
        }, t.prototype.copy = function () {
            for (var e = (new Array(this._geometries.length)).fill(null), n = 0; n < e.length; n++) e[n] = this._geometries[n].copy();
            return new t(e, this._factory)
        }, t.prototype.interfaces_ = function () {
            return [Gl]
        }, t.prototype.getClass = function () {
            return t
        }, n.serialVersionUID.get = function () {
            return -0x6fb1ed4162e0fc00
        }, Object.defineProperties(t, n), t
    }(zl), nc = function (e) {
        function t(t, n) {
            t instanceof Tf && n instanceof yc && (t = n.getCoordinateSequenceFactory().create(t)), e.call(this, t, n), this.validateConstruction()
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {MINIMUM_VALID_SIZE: {configurable: !0}, serialVersionUID: {configurable: !0}};
        return t.prototype.getSortIndex = function () {
            return ll.SORTINDEX_LINEARRING
        }, t.prototype.getBoundaryDimension = function () {
            return Il.FALSE
        }, t.prototype.isClosed = function () {
            return !!this.isEmpty() || e.prototype.isClosed.call(this)
        }, t.prototype.reverse = function () {
            var e = this._points.copy();
            return Kl.reverse(e), this.getFactory().createLinearRing(e)
        }, t.prototype.validateConstruction = function () {
            if (!this.isEmpty() && !e.prototype.isClosed.call(this)) throw new yf("Points of LinearRing do not form a closed linestring");
            if (this.getCoordinateSequence().size() >= 1 && this.getCoordinateSequence().size() < t.MINIMUM_VALID_SIZE) throw new yf("Invalid number of points in LinearRing (found " + this.getCoordinateSequence().size() + " - must be 0 or >= 4)")
        }, t.prototype.getGeometryType = function () {
            return "LinearRing"
        }, t.prototype.copy = function () {
            return new t(this._points.copy(), this._factory)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, n.MINIMUM_VALID_SIZE.get = function () {
            return 4
        }, n.serialVersionUID.get = function () {
            return -0x3b229e262367a600
        }, Object.defineProperties(t, n), t
    }(Ql), rc = function (e) {
        function t() {
            e.apply(this, arguments)
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {serialVersionUID: {configurable: !0}};
        return t.prototype.getSortIndex = function () {
            return ll.SORTINDEX_MULTIPOLYGON
        }, t.prototype.equalsExact = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                return !!this.isEquivalentClass(t) && e.prototype.equalsExact.call(this, t, n)
            }
            return e.prototype.equalsExact.apply(this, arguments)
        }, t.prototype.getBoundaryDimension = function () {
            return 1
        }, t.prototype.getDimension = function () {
            return 2
        }, t.prototype.reverse = function () {
            for (var e = this._geometries.length, t = (new Array(e)).fill(null), n = 0; n < this._geometries.length; n++) t[n] = this._geometries[n].reverse();
            return this.getFactory().createMultiPolygon(t)
        }, t.prototype.getBoundary = function () {
            if (this.isEmpty()) return this.getFactory().createMultiLineString();
            for (var e = new Tl, t = 0; t < this._geometries.length; t++) for (var n = this._geometries[t].getBoundary(), r = 0; r < n.getNumGeometries(); r++) e.add(n.getGeometryN(r));
            var i = (new Array(e.size())).fill(null);
            return this.getFactory().createMultiLineString(e.toArray(i))
        }, t.prototype.getGeometryType = function () {
            return "MultiPolygon"
        }, t.prototype.copy = function () {
            for (var e = (new Array(this._geometries.length)).fill(null), n = 0; n < e.length; n++) e[n] = this._geometries[n].copy();
            return new t(e, this._factory)
        }, t.prototype.interfaces_ = function () {
            return [Zl]
        }, t.prototype.getClass = function () {
            return t
        }, n.serialVersionUID.get = function () {
            return -0x7a5aa1369171980
        }, Object.defineProperties(t, n), t
    }(zl), ic = function (e) {
        this._factory = e || null, this._isUserDataCopied = !1
    }, sc = {
        NoOpGeometryOperation: {configurable: !0},
        CoordinateOperation: {configurable: !0},
        CoordinateSequenceOperation: {configurable: !0}
    };
    ic.prototype.setCopyUserData = function (e) {
        this._isUserDataCopied = e
    }, ic.prototype.edit = function (e, t) {
        if (null === e) return null;
        var n = this.editInternal(e, t);
        return this._isUserDataCopied && n.setUserData(e.getUserData()), n
    }, ic.prototype.editInternal = function (e, t) {
        return null === this._factory && (this._factory = e.getFactory()), e instanceof zl ? this.editGeometryCollection(e, t) : e instanceof ec ? this.editPolygon(e, t) : e instanceof Yl ? t.edit(e, this._factory) : e instanceof Ql ? t.edit(e, this._factory) : (tl.shouldNeverReachHere("Unsupported Geometry class: " + e.getClass().getName()), null)
    }, ic.prototype.editGeometryCollection = function (e, t) {
        for (var n = t.edit(e, this._factory), r = new Tl, i = 0; i < n.getNumGeometries(); i++) {
            var s = this.edit(n.getGeometryN(i), t);
            null === s || s.isEmpty() || r.add(s)
        }
        return n.getClass() === tc ? this._factory.createMultiPoint(r.toArray([])) : n.getClass() === Wl ? this._factory.createMultiLineString(r.toArray([])) : n.getClass() === rc ? this._factory.createMultiPolygon(r.toArray([])) : this._factory.createGeometryCollection(r.toArray([]))
    }, ic.prototype.editPolygon = function (e, t) {
        var n = t.edit(e, this._factory);
        if (null === n && (n = this._factory.createPolygon(null)), n.isEmpty()) return n;
        var r = this.edit(n.getExteriorRing(), t);
        if (null === r || r.isEmpty()) return this._factory.createPolygon();
        for (var i = new Tl, s = 0; s < n.getNumInteriorRing(); s++) {
            var o = this.edit(n.getInteriorRingN(s), t);
            null === o || o.isEmpty() || i.add(o)
        }
        return this._factory.createPolygon(r, i.toArray([]))
    }, ic.prototype.interfaces_ = function () {
        return []
    }, ic.prototype.getClass = function () {
        return ic
    }, ic.GeometryEditorOperation = function () {
    }, sc.NoOpGeometryOperation.get = function () {
        return oc
    }, sc.CoordinateOperation.get = function () {
        return uc
    }, sc.CoordinateSequenceOperation.get = function () {
        return ac
    }, Object.defineProperties(ic, sc);
    var oc = function () {
    };
    oc.prototype.edit = function (e, t) {
        return e
    }, oc.prototype.interfaces_ = function () {
        return [ic.GeometryEditorOperation]
    }, oc.prototype.getClass = function () {
        return oc
    };
    var uc = function () {
    };
    uc.prototype.edit = function (e, t) {
        var n = this.editCoordinates(e.getCoordinates(), e);
        return null === n ? e : e instanceof nc ? t.createLinearRing(n) : e instanceof Ql ? t.createLineString(n) : e instanceof Yl ? n.length > 0 ? t.createPoint(n[0]) : t.createPoint() : e
    }, uc.prototype.interfaces_ = function () {
        return [ic.GeometryEditorOperation]
    }, uc.prototype.getClass = function () {
        return uc
    };
    var ac = function () {
    };
    ac.prototype.edit = function (e, t) {
        return e instanceof nc ? t.createLinearRing(this.edit(e.getCoordinateSequence(), e)) : e instanceof Ql ? t.createLineString(this.edit(e.getCoordinateSequence(), e)) : e instanceof Yl ? t.createPoint(this.edit(e.getCoordinateSequence(), e)) : e
    }, ac.prototype.interfaces_ = function () {
        return [ic.GeometryEditorOperation]
    }, ac.prototype.getClass = function () {
        return ac
    };
    var fc = function () {
        if (this._dimension = 3, this._coordinates = null, 1 === arguments.length) {
            if (arguments[0] instanceof Array) this._coordinates = arguments[0], this._dimension = 3; else if (Number.isInteger(arguments[0])) {
                var e = arguments[0];
                this._coordinates = (new Array(e)).fill(null);
                for (var t = 0; t < e; t++) this._coordinates[t] = new Tf
            } else if (Of(arguments[0], qf)) {
                var n = arguments[0];
                if (null === n) return this._coordinates = (new Array(0)).fill(null), null;
                this._dimension = n.getDimension(), this._coordinates = (new Array(n.size())).fill(null);
                for (var r = 0; r < this._coordinates.length; r++) this._coordinates[r] = n.getCoordinateCopy(r)
            }
        } else if (2 === arguments.length) if (arguments[0] instanceof Array && Number.isInteger(arguments[1])) {
            var i = arguments[0], s = arguments[1];
            this._coordinates = i, this._dimension = s, null === i && (this._coordinates = (new Array(0)).fill(null))
        } else if (Number.isInteger(arguments[0]) && Number.isInteger(arguments[1])) {
            var o = arguments[0], u = arguments[1];
            this._coordinates = (new Array(o)).fill(null), this._dimension = u;
            for (var a = 0; a < o; a++) this._coordinates[a] = new Tf
        }
    }, lc = {serialVersionUID: {configurable: !0}};
    fc.prototype.setOrdinate = function (e, t, n) {
        switch (t) {
            case qf.X:
                this._coordinates[e].x = n;
                break;
            case qf.Y:
                this._coordinates[e].y = n;
                break;
            case qf.Z:
                this._coordinates[e].z = n;
                break;
            default:
                throw new yf("invalid ordinateIndex")
        }
    }, fc.prototype.size = function () {
        return this._coordinates.length
    }, fc.prototype.getOrdinate = function (e, t) {
        switch (t) {
            case qf.X:
                return this._coordinates[e].x;
            case qf.Y:
                return this._coordinates[e].y;
            case qf.Z:
                return this._coordinates[e].z
        }
        return bf.NaN
    }, fc.prototype.getCoordinate = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return this._coordinates[e]
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            n.x = this._coordinates[t].x, n.y = this._coordinates[t].y, n.z = this._coordinates[t].z
        }
    }, fc.prototype.getCoordinateCopy = function (e) {
        return new Tf(this._coordinates[e])
    }, fc.prototype.getDimension = function () {
        return this._dimension
    }, fc.prototype.getX = function (e) {
        return this._coordinates[e].x
    }, fc.prototype.clone = function () {
        for (var e = (new Array(this.size())).fill(null), t = 0; t < this._coordinates.length; t++) e[t] = this._coordinates[t].clone();
        return new fc(e, this._dimension)
    }, fc.prototype.expandEnvelope = function (e) {
        for (var t = 0; t < this._coordinates.length; t++) e.expandToInclude(this._coordinates[t]);
        return e
    }, fc.prototype.copy = function () {
        for (var e = (new Array(this.size())).fill(null), t = 0; t < this._coordinates.length; t++) e[t] = this._coordinates[t].copy();
        return new fc(e, this._dimension)
    }, fc.prototype.toString = function () {
        if (this._coordinates.length > 0) {
            var e = new Df(17 * this._coordinates.length);
            e.append("("), e.append(this._coordinates[0]);
            for (var t = 1; t < this._coordinates.length; t++) e.append(", "), e.append(this._coordinates[t]);
            return e.append(")"), e.toString()
        }
        return "()"
    }, fc.prototype.getY = function (e) {
        return this._coordinates[e].y
    }, fc.prototype.toCoordinateArray = function () {
        return this._coordinates
    }, fc.prototype.interfaces_ = function () {
        return [qf, As]
    }, fc.prototype.getClass = function () {
        return fc
    }, lc.serialVersionUID.get = function () {
        return -0xcb44a778db18e00
    }, Object.defineProperties(fc, lc);
    var cc = function () {
    }, hc = {serialVersionUID: {configurable: !0}, instanceObject: {configurable: !0}};
    cc.prototype.readResolve = function () {
        return cc.instance()
    }, cc.prototype.create = function () {
        if (1 === arguments.length) {
            if (arguments[0] instanceof Array) {
                var e = arguments[0];
                return new fc(e)
            }
            if (Of(arguments[0], qf)) {
                var t = arguments[0];
                return new fc(t)
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            return r > 3 && (r = 3), r < 2 ? new fc(n) : new fc(n, r)
        }
    }, cc.prototype.interfaces_ = function () {
        return [kf, As]
    }, cc.prototype.getClass = function () {
        return cc
    }, cc.instance = function () {
        return cc.instanceObject
    }, hc.serialVersionUID.get = function () {
        return -0x38e49fa6cf6f2e00
    }, hc.instanceObject.get = function () {
        return new cc
    }, Object.defineProperties(cc, hc);
    var pc = function (e) {
        function t() {
            e.call(this), this.map_ = new Map
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.get = function (e) {
            return this.map_.get(e) || null
        }, t.prototype.put = function (e, t) {
            return this.map_.set(e, t), t
        }, t.prototype.values = function () {
            for (var e = new Tl, t = this.map_.values(), n = t.next(); !n.done;) e.add(n.value), n = t.next();
            return e
        }, t.prototype.entrySet = function () {
            var e = new Dl;
            return this.map_.entries().forEach(function (t) {
                return e.add(t)
            }), e
        }, t.prototype.size = function () {
            return this.map_.size()
        }, t
    }(Ml), dc = function Dv() {
        if (this._modelType = null, this._scale = null, 0 === arguments.length) this._modelType = Dv.FLOATING; else if (1 === arguments.length) if (arguments[0] instanceof mc) {
            var e = arguments[0];
            this._modelType = e, e === Dv.FIXED && this.setScale(1)
        } else if ("number" == typeof arguments[0]) {
            var t = arguments[0];
            this._modelType = Dv.FIXED, this.setScale(t)
        } else if (arguments[0] instanceof Dv) {
            var n = arguments[0];
            this._modelType = n._modelType, this._scale = n._scale
        }
    }, vc = {serialVersionUID: {configurable: !0}, maximumPreciseValue: {configurable: !0}};
    dc.prototype.equals = function (e) {
        if (e instanceof dc) {
            var t = e;
            return this._modelType === t._modelType && this._scale === t._scale
        }
        return !1
    }, dc.prototype.compareTo = function (e) {
        var t = e, n = this.getMaximumSignificantDigits(), r = t.getMaximumSignificantDigits();
        return (new Pf(n)).compareTo(new Pf(r))
    }, dc.prototype.getScale = function () {
        return this._scale
    }, dc.prototype.isFloating = function () {
        return this._modelType === dc.FLOATING || this._modelType === dc.FLOATING_SINGLE
    }, dc.prototype.getType = function () {
        return this._modelType
    }, dc.prototype.toString = function () {
        var e = "UNKNOWN";
        return this._modelType === dc.FLOATING ? e = "Floating" : this._modelType === dc.FLOATING_SINGLE ? e = "Floating-Single" : this._modelType === dc.FIXED && (e = "Fixed (Scale=" + this.getScale() + ")"), e
    }, dc.prototype.makePrecise = function () {
        if ("number" == typeof arguments[0]) {
            var e = arguments[0];
            return bf.isNaN(e) ? e : this._modelType === dc.FLOATING_SINGLE ? e : this._modelType === dc.FIXED ? Math.round(e * this._scale) / this._scale : e
        }
        if (arguments[0] instanceof Tf) {
            var t = arguments[0];
            if (this._modelType === dc.FLOATING) return null;
            t.x = this.makePrecise(t.x), t.y = this.makePrecise(t.y)
        }
    }, dc.prototype.getMaximumSignificantDigits = function () {
        var e = 16;
        return this._modelType === dc.FLOATING ? e = 16 : this._modelType === dc.FLOATING_SINGLE ? e = 6 : this._modelType === dc.FIXED && (e = 1 + Math.trunc(Math.ceil(Math.log(this.getScale()) / Math.log(10)))), e
    }, dc.prototype.setScale = function (e) {
        this._scale = Math.abs(e)
    }, dc.prototype.interfaces_ = function () {
        return [As, Ef]
    }, dc.prototype.getClass = function () {
        return dc
    }, dc.mostPrecise = function (e, t) {
        return e.compareTo(t) >= 0 ? e : t
    }, vc.serialVersionUID.get = function () {
        return 0x6bee6404e9a25c00
    }, vc.maximumPreciseValue.get = function () {
        return 9007199254740992
    }, Object.defineProperties(dc, vc);
    var mc = function Pv(e) {
        this._name = e || null, Pv.nameToTypeMap.put(e, this)
    }, gc = {serialVersionUID: {configurable: !0}, nameToTypeMap: {configurable: !0}};
    mc.prototype.readResolve = function () {
        return mc.nameToTypeMap.get(this._name)
    }, mc.prototype.toString = function () {
        return this._name
    }, mc.prototype.interfaces_ = function () {
        return [As]
    }, mc.prototype.getClass = function () {
        return mc
    }, gc.serialVersionUID.get = function () {
        return -552860263173159e4
    }, gc.nameToTypeMap.get = function () {
        return new pc
    }, Object.defineProperties(mc, gc), dc.Type = mc, dc.FIXED = new mc("FIXED"), dc.FLOATING = new mc("FLOATING"), dc.FLOATING_SINGLE = new mc("FLOATING SINGLE");
    var yc = function Hv() {
        this._precisionModel = new dc, this._SRID = 0, this._coordinateSequenceFactory = Hv.getDefaultCoordinateSequenceFactory(), 0 === arguments.length || (1 === arguments.length ? Of(arguments[0], kf) ? this._coordinateSequenceFactory = arguments[0] : arguments[0] instanceof dc && (this._precisionModel = arguments[0]) : 2 === arguments.length ? (this._precisionModel = arguments[0], this._SRID = arguments[1]) : 3 === arguments.length && (this._precisionModel = arguments[0], this._SRID = arguments[1], this._coordinateSequenceFactory = arguments[2]))
    }, bc = {serialVersionUID: {configurable: !0}};
    yc.prototype.toGeometry = function (e) {
        return e.isNull() ? this.createPoint(null) : e.getMinX() === e.getMaxX() && e.getMinY() === e.getMaxY() ? this.createPoint(new Tf(e.getMinX(), e.getMinY())) : e.getMinX() === e.getMaxX() || e.getMinY() === e.getMaxY() ? this.createLineString([new Tf(e.getMinX(), e.getMinY()), new Tf(e.getMaxX(), e.getMaxY())]) : this.createPolygon(this.createLinearRing([new Tf(e.getMinX(), e.getMinY()), new Tf(e.getMinX(), e.getMaxY()), new Tf(e.getMaxX(), e.getMaxY()), new Tf(e.getMaxX(), e.getMinY()), new Tf(e.getMinX(), e.getMinY())]), null)
    }, yc.prototype.createLineString = function (e) {
        return e ? e instanceof Array ? new Ql(this.getCoordinateSequenceFactory().create(e), this) : Of(e, qf) ? new Ql(e, this) : void 0 : new Ql(this.getCoordinateSequenceFactory().create([]), this)
    }, yc.prototype.createMultiLineString = function () {
        if (0 === arguments.length) return new Wl(null, this);
        if (1 === arguments.length) {
            var e = arguments[0];
            return new Wl(e, this)
        }
    }, yc.prototype.buildGeometry = function (e) {
        for (var t = null, n = !1, r = !1, i = e.iterator(); i.hasNext();) {
            var s = i.next(), o = s.getClass();
            null === t && (t = o), o !== t && (n = !0), s.isGeometryCollectionOrDerived() && (r = !0)
        }
        if (null === t) return this.createGeometryCollection();
        if (n || r) return this.createGeometryCollection(yc.toGeometryArray(e));
        var u = e.iterator().next();
        if (e.size() > 1) {
            if (u instanceof ec) return this.createMultiPolygon(yc.toPolygonArray(e));
            if (u instanceof Ql) return this.createMultiLineString(yc.toLineStringArray(e));
            if (u instanceof Yl) return this.createMultiPoint(yc.toPointArray(e));
            tl.shouldNeverReachHere("Unhandled class: " + u.getClass().getName())
        }
        return u
    }, yc.prototype.createMultiPointFromCoords = function (e) {
        return this.createMultiPoint(null !== e ? this.getCoordinateSequenceFactory().create(e) : null)
    }, yc.prototype.createPoint = function () {
        if (0 === arguments.length) return this.createPoint(this.getCoordinateSequenceFactory().create([]));
        if (1 === arguments.length) {
            if (arguments[0] instanceof Tf) {
                var e = arguments[0];
                return this.createPoint(null !== e ? this.getCoordinateSequenceFactory().create([e]) : null)
            }
            if (Of(arguments[0], qf)) {
                var t = arguments[0];
                return new Yl(t, this)
            }
        }
    }, yc.prototype.getCoordinateSequenceFactory = function () {
        return this._coordinateSequenceFactory
    }, yc.prototype.createPolygon = function () {
        if (0 === arguments.length) return new ec(null, null, this);
        if (1 === arguments.length) {
            if (Of(arguments[0], qf)) {
                var e = arguments[0];
                return this.createPolygon(this.createLinearRing(e))
            }
            if (arguments[0] instanceof Array) {
                var t = arguments[0];
                return this.createPolygon(this.createLinearRing(t))
            }
            if (arguments[0] instanceof nc) {
                var n = arguments[0];
                return this.createPolygon(n, null)
            }
        } else if (2 === arguments.length) {
            var r = arguments[0], i = arguments[1];
            return new ec(r, i, this)
        }
    }, yc.prototype.getSRID = function () {
        return this._SRID
    }, yc.prototype.createGeometryCollection = function () {
        if (0 === arguments.length) return new zl(null, this);
        if (1 === arguments.length) {
            var e = arguments[0];
            return new zl(e, this)
        }
    }, yc.prototype.createGeometry = function (e) {
        return (new ic(this)).edit(e, {
            edit: function () {
                if (2 === arguments.length) {
                    var e = arguments[0];
                    return this._coordinateSequenceFactory.create(e)
                }
            }
        })
    }, yc.prototype.getPrecisionModel = function () {
        return this._precisionModel
    }, yc.prototype.createLinearRing = function () {
        if (0 === arguments.length) return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));
        if (1 === arguments.length) {
            if (arguments[0] instanceof Array) {
                var e = arguments[0];
                return this.createLinearRing(null !== e ? this.getCoordinateSequenceFactory().create(e) : null)
            }
            if (Of(arguments[0], qf)) {
                var t = arguments[0];
                return new nc(t, this)
            }
        }
    }, yc.prototype.createMultiPolygon = function () {
        if (0 === arguments.length) return new rc(null, this);
        if (1 === arguments.length) {
            var e = arguments[0];
            return new rc(e, this)
        }
    }, yc.prototype.createMultiPoint = function () {
        if (0 === arguments.length) return new tc(null, this);
        if (1 === arguments.length) {
            if (arguments[0] instanceof Array) {
                var e = arguments[0];
                return new tc(e, this)
            }
            if (arguments[0] instanceof Array) {
                var t = arguments[0];
                return this.createMultiPoint(null !== t ? this.getCoordinateSequenceFactory().create(t) : null)
            }
            if (Of(arguments[0], qf)) {
                var n = arguments[0];
                if (null === n) return this.createMultiPoint((new Array(0)).fill(null));
                for (var r = (new Array(n.size())).fill(null), i = 0; i < n.size(); i++) {
                    var s = this.getCoordinateSequenceFactory().create(1, n.getDimension());
                    Kl.copy(n, i, s, 0, 1), r[i] = this.createPoint(s)
                }
                return this.createMultiPoint(r)
            }
        }
    }, yc.prototype.interfaces_ = function () {
        return [As]
    }, yc.prototype.getClass = function () {
        return yc
    }, yc.toMultiPolygonArray = function (e) {
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.toGeometryArray = function (e) {
        if (null === e) return null;
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.getDefaultCoordinateSequenceFactory = function () {
        return cc.instance()
    }, yc.toMultiLineStringArray = function (e) {
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.toLineStringArray = function (e) {
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.toMultiPointArray = function (e) {
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.toLinearRingArray = function (e) {
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.toPointArray = function (e) {
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.toPolygonArray = function (e) {
        var t = (new Array(e.size())).fill(null);
        return e.toArray(t)
    }, yc.createPointFromInternalCoord = function (e, t) {
        return t.getPrecisionModel().makePrecise(e), t.getFactory().createPoint(e)
    }, bc.serialVersionUID.get = function () {
        return -0x5ea75f2051eeb400
    }, Object.defineProperties(yc, bc);
    var wc = ["Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon"], Ec = function (e) {
        this.geometryFactory = e || new yc
    };
    Ec.prototype.read = function (e) {
        var t, n = (t = "string" == typeof e ? JSON.parse(e) : e).type;
        if (!Sc[n]) throw new Error("Unknown GeoJSON type: " + t.type);
        return -1 !== wc.indexOf(n) ? Sc[n].apply(this, [t.coordinates]) : "GeometryCollection" === n ? Sc[n].apply(this, [t.geometries]) : Sc[n].apply(this, [t])
    }, Ec.prototype.write = function (e) {
        var t = e.getGeometryType();
        if (!xc[t]) throw new Error("Geometry is not supported");
        return xc[t].apply(this, [e])
    };
    var Sc = {
        Feature: function (e) {
            var t = {};
            for (var n in e) t[n] = e[n];
            if (e.geometry) {
                var r = e.geometry.type;
                if (!Sc[r]) throw new Error("Unknown GeoJSON type: " + e.type);
                t.geometry = this.read(e.geometry)
            }
            return e.bbox && (t.bbox = Sc.bbox.apply(this, [e.bbox])), t
        }, FeatureCollection: function (e) {
            var t = {};
            if (e.features) {
                t.features = [];
                for (var n = 0; n < e.features.length; ++n) t.features.push(this.read(e.features[n]))
            }
            return e.bbox && (t.bbox = this.parse.bbox.apply(this, [e.bbox])), t
        }, coordinates: function (e) {
            for (var t = [], n = 0; n < e.length; ++n) {
                var r = e[n];
                t.push(new Tf(r[0], r[1]))
            }
            return t
        }, bbox: function (e) {
            return this.geometryFactory.createLinearRing([new Tf(e[0], e[1]), new Tf(e[2], e[1]), new Tf(e[2], e[3]), new Tf(e[0], e[3]), new Tf(e[0], e[1])])
        }, Point: function (e) {
            var t = new Tf(e[0], e[1]);
            return this.geometryFactory.createPoint(t)
        }, MultiPoint: function (e) {
            for (var t = [], n = 0; n < e.length; ++n) t.push(Sc.Point.apply(this, [e[n]]));
            return this.geometryFactory.createMultiPoint(t)
        }, LineString: function (e) {
            var t = Sc.coordinates.apply(this, [e]);
            return this.geometryFactory.createLineString(t)
        }, MultiLineString: function (e) {
            for (var t = [], n = 0; n < e.length; ++n) t.push(Sc.LineString.apply(this, [e[n]]));
            return this.geometryFactory.createMultiLineString(t)
        }, Polygon: function (e) {
            for (var t = Sc.coordinates.apply(this, [e[0]]), n = this.geometryFactory.createLinearRing(t), r = [], i = 1; i < e.length; ++i) {
                var s = e[i], o = Sc.coordinates.apply(this, [s]), u = this.geometryFactory.createLinearRing(o);
                r.push(u)
            }
            return this.geometryFactory.createPolygon(n, r)
        }, MultiPolygon: function (e) {
            for (var t = [], n = 0; n < e.length; ++n) {
                var r = e[n];
                t.push(Sc.Polygon.apply(this, [r]))
            }
            return this.geometryFactory.createMultiPolygon(t)
        }, GeometryCollection: function (e) {
            for (var t = [], n = 0; n < e.length; ++n) {
                var r = e[n];
                t.push(this.read(r))
            }
            return this.geometryFactory.createGeometryCollection(t)
        }
    }, xc = {
        coordinate: function (e) {
            return [e.x, e.y]
        }, Point: function (e) {
            return {type: "Point", coordinates: xc.coordinate.apply(this, [e.getCoordinate()])}
        }, MultiPoint: function (e) {
            for (var t = [], n = 0; n < e._geometries.length; ++n) {
                var r = e._geometries[n], i = xc.Point.apply(this, [r]);
                t.push(i.coordinates)
            }
            return {type: "MultiPoint", coordinates: t}
        }, LineString: function (e) {
            for (var t = [], n = e.getCoordinates(), r = 0; r < n.length; ++r) {
                var i = n[r];
                t.push(xc.coordinate.apply(this, [i]))
            }
            return {type: "LineString", coordinates: t}
        }, MultiLineString: function (e) {
            for (var t = [], n = 0; n < e._geometries.length; ++n) {
                var r = e._geometries[n], i = xc.LineString.apply(this, [r]);
                t.push(i.coordinates)
            }
            return {type: "MultiLineString", coordinates: t}
        }, Polygon: function (e) {
            var t = [], n = xc.LineString.apply(this, [e._shell]);
            t.push(n.coordinates);
            for (var r = 0; r < e._holes.length; ++r) {
                var i = e._holes[r], s = xc.LineString.apply(this, [i]);
                t.push(s.coordinates)
            }
            return {type: "Polygon", coordinates: t}
        }, MultiPolygon: function (e) {
            for (var t = [], n = 0; n < e._geometries.length; ++n) {
                var r = e._geometries[n], i = xc.Polygon.apply(this, [r]);
                t.push(i.coordinates)
            }
            return {type: "MultiPolygon", coordinates: t}
        }, GeometryCollection: function (e) {
            for (var t = [], n = 0; n < e._geometries.length; ++n) {
                var r = e._geometries[n], i = r.getGeometryType();
                t.push(xc[i].apply(this, [r]))
            }
            return {type: "GeometryCollection", geometries: t}
        }
    }, Tc = function (e) {
        this.geometryFactory = e || new yc, this.precisionModel = this.geometryFactory.getPrecisionModel(), this.parser = new Ec(this.geometryFactory)
    };
    Tc.prototype.read = function (e) {
        var t = this.parser.read(e);
        return this.precisionModel.getType() === dc.FIXED && this.reducePrecision(t), t
    }, Tc.prototype.reducePrecision = function (e) {
        var t, n;
        if (e.coordinate) this.precisionModel.makePrecise(e.coordinate); else if (e.points) for (t = 0, n = e.points.length; t < n; t++) this.precisionModel.makePrecise(e.points[t]); else if (e.geometries) for (t = 0, n = e.geometries.length; t < n; t++) this.reducePrecision(e.geometries[t])
    };
    var Nc = function () {
        this.parser = new Ec(this.geometryFactory)
    };
    Nc.prototype.write = function (e) {
        return this.parser.write(e)
    };
    var Cc = function () {
    }, kc = {ON: {configurable: !0}, LEFT: {configurable: !0}, RIGHT: {configurable: !0}};
    Cc.prototype.interfaces_ = function () {
        return []
    }, Cc.prototype.getClass = function () {
        return Cc
    }, Cc.opposite = function (e) {
        return e === Cc.LEFT ? Cc.RIGHT : e === Cc.RIGHT ? Cc.LEFT : e
    }, kc.ON.get = function () {
        return 0
    }, kc.LEFT.get = function () {
        return 1
    }, kc.RIGHT.get = function () {
        return 2
    }, Object.defineProperties(Cc, kc), (Us.prototype = new Error).name = "EmptyStackException", (zs.prototype = new xl).add = function (e) {
        return this.array_.push(e), !0
    }, zs.prototype.get = function (e) {
        if (e < 0 || e >= this.size()) throw new Error;
        return this.array_[e]
    }, zs.prototype.push = function (e) {
        return this.array_.push(e), e
    }, zs.prototype.pop = function (e) {
        if (0 === this.array_.length) throw new Us;
        return this.array_.pop()
    }, zs.prototype.peek = function () {
        if (0 === this.array_.length) throw new Us;
        return this.array_[this.array_.length - 1]
    }, zs.prototype.empty = function () {
        return 0 === this.array_.length
    }, zs.prototype.isEmpty = function () {
        return this.empty()
    }, zs.prototype.search = function (e) {
        return this.array_.indexOf(e)
    }, zs.prototype.size = function () {
        return this.array_.length
    }, zs.prototype.toArray = function () {
        for (var e = [], t = 0, n = this.array_.length; t < n; t++) e.push(this.array_[t]);
        return e
    };
    var Lc = function () {
        this._minIndex = -1, this._minCoord = null, this._minDe = null, this._orientedDe = null
    };
    Lc.prototype.getCoordinate = function () {
        return this._minCoord
    }, Lc.prototype.getRightmostSide = function (e, t) {
        var n = this.getRightmostSideOfSegment(e, t);
        return n < 0 && (n = this.getRightmostSideOfSegment(e, t - 1)), n < 0 && (this._minCoord = null, this.checkForRightmostCoordinate(e)), n
    }, Lc.prototype.findRightmostEdgeAtVertex = function () {
        var e = this._minDe.getEdge().getCoordinates();
        tl.isTrue(this._minIndex > 0 && this._minIndex < e.length, "rightmost point expected to be interior vertex of edge");
        var t = e[this._minIndex - 1], n = e[this._minIndex + 1], r = ul.computeOrientation(this._minCoord, n, t),
            i = !1;
        t.y < this._minCoord.y && n.y < this._minCoord.y && r === ul.COUNTERCLOCKWISE ? i = !0 : t.y > this._minCoord.y && n.y > this._minCoord.y && r === ul.CLOCKWISE && (i = !0), i && (this._minIndex = this._minIndex - 1)
    }, Lc.prototype.getRightmostSideOfSegment = function (e, t) {
        var n = e.getEdge().getCoordinates();
        if (t < 0 || t + 1 >= n.length) return -1;
        if (n[t].y === n[t + 1].y) return -1;
        var r = Cc.LEFT;
        return n[t].y < n[t + 1].y && (r = Cc.RIGHT), r
    }, Lc.prototype.getEdge = function () {
        return this._orientedDe
    }, Lc.prototype.checkForRightmostCoordinate = function (e) {
        for (var t = e.getEdge().getCoordinates(), n = 0; n < t.length - 1; n++) (null === this._minCoord || t[n].x > this._minCoord.x) && (this._minDe = e, this._minIndex = n, this._minCoord = t[n])
    }, Lc.prototype.findRightmostEdgeAtNode = function () {
        var e = this._minDe.getNode().getEdges();
        this._minDe = e.getRightmostEdge(), this._minDe.isForward() || (this._minDe = this._minDe.getSym(), this._minIndex = this._minDe.getEdge().getCoordinates().length - 1)
    }, Lc.prototype.findEdge = function (e) {
        for (var t = e.iterator(); t.hasNext();) {
            var n = t.next();
            n.isForward() && this.checkForRightmostCoordinate(n)
        }
        tl.isTrue(0 !== this._minIndex || this._minCoord.equals(this._minDe.getCoordinate()), "inconsistency in rightmost processing"), 0 === this._minIndex ? this.findRightmostEdgeAtNode() : this.findRightmostEdgeAtVertex(), this._orientedDe = this._minDe, this.getRightmostSide(this._minDe, this._minIndex) === Cc.LEFT && (this._orientedDe = this._minDe.getSym())
    }, Lc.prototype.interfaces_ = function () {
        return []
    }, Lc.prototype.getClass = function () {
        return Lc
    };
    var Ac = function (e) {
        function t(n, r) {
            e.call(this, t.msgWithCoord(n, r)), this.pt = r ? new Tf(r) : null, this.name = "TopologyException"
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.getCoordinate = function () {
            return this.pt
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t.msgWithCoord = function (e, t) {
            return t ? e : e + " [ " + t + " ]"
        }, t
    }(Zf), Oc = function () {
        this.array_ = []
    };
    Oc.prototype.addLast = function (e) {
        this.array_.push(e)
    }, Oc.prototype.removeFirst = function () {
        return this.array_.shift()
    }, Oc.prototype.isEmpty = function () {
        return 0 === this.array_.length
    };
    var Mc = function () {
        this._finder = null, this._dirEdgeList = new Tl, this._nodes = new Tl, this._rightMostCoord = null, this._env = null, this._finder = new Lc
    };
    Mc.prototype.clearVisitedEdges = function () {
        for (var e = this._dirEdgeList.iterator(); e.hasNext();) e.next().setVisited(!1)
    }, Mc.prototype.getRightmostCoordinate = function () {
        return this._rightMostCoord
    }, Mc.prototype.computeNodeDepth = function (e) {
        for (var t = null, n = e.getEdges().iterator(); n.hasNext();) {
            var r = n.next();
            if (r.isVisited() || r.getSym().isVisited()) {
                t = r;
                break
            }
        }
        if (null === t) throw new Ac("unable to find edge to compute depths at " + e.getCoordinate());
        e.getEdges().computeDepths(t);
        for (var i = e.getEdges().iterator(); i.hasNext();) {
            var s = i.next();
            s.setVisited(!0), this.copySymDepths(s)
        }
    }, Mc.prototype.computeDepth = function (e) {
        this.clearVisitedEdges();
        var t = this._finder.getEdge();
        t.setEdgeDepths(Cc.RIGHT, e), this.copySymDepths(t), this.computeDepths(t)
    }, Mc.prototype.create = function (e) {
        this.addReachable(e), this._finder.findEdge(this._dirEdgeList), this._rightMostCoord = this._finder.getCoordinate()
    }, Mc.prototype.findResultEdges = function () {
        for (var e = this._dirEdgeList.iterator(); e.hasNext();) {
            var t = e.next();
            t.getDepth(Cc.RIGHT) >= 1 && t.getDepth(Cc.LEFT) <= 0 && !t.isInteriorAreaEdge() && t.setInResult(!0)
        }
    }, Mc.prototype.computeDepths = function (e) {
        var t = new Dl, n = new Oc, r = e.getNode();
        for (n.addLast(r), t.add(r), e.setVisited(!0); !n.isEmpty();) {
            var i = n.removeFirst();
            t.add(i), this.computeNodeDepth(i);
            for (var s = i.getEdges().iterator(); s.hasNext();) {
                var o = s.next().getSym();
                if (!o.isVisited()) {
                    var u = o.getNode();
                    t.contains(u) || (n.addLast(u), t.add(u))
                }
            }
        }
    }, Mc.prototype.compareTo = function (e) {
        var t = e;
        return this._rightMostCoord.x < t._rightMostCoord.x ? -1 : this._rightMostCoord.x > t._rightMostCoord.x ? 1 : 0
    }, Mc.prototype.getEnvelope = function () {
        if (null === this._env) {
            for (var e = new Vf, t = this._dirEdgeList.iterator(); t.hasNext();) for (var n = t.next().getEdge().getCoordinates(), r = 0; r < n.length - 1; r++) e.expandToInclude(n[r]);
            this._env = e
        }
        return this._env
    }, Mc.prototype.addReachable = function (e) {
        var t = new zs;
        for (t.add(e); !t.empty();) {
            var n = t.pop();
            this.add(n, t)
        }
    }, Mc.prototype.copySymDepths = function (e) {
        var t = e.getSym();
        t.setDepth(Cc.LEFT, e.getDepth(Cc.RIGHT)), t.setDepth(Cc.RIGHT, e.getDepth(Cc.LEFT))
    }, Mc.prototype.add = function (e, t) {
        e.setVisited(!0), this._nodes.add(e);
        for (var n = e.getEdges().iterator(); n.hasNext();) {
            var r = n.next();
            this._dirEdgeList.add(r);
            var i = r.getSym().getNode();
            i.isVisited() || t.push(i)
        }
    }, Mc.prototype.getNodes = function () {
        return this._nodes
    }, Mc.prototype.getDirectedEdges = function () {
        return this._dirEdgeList
    }, Mc.prototype.interfaces_ = function () {
        return [Ef]
    }, Mc.prototype.getClass = function () {
        return Mc
    };
    var _c = function Bv() {
        if (this.location = null, 1 === arguments.length) {
            if (arguments[0] instanceof Array) {
                var e = arguments[0];
                this.init(e.length)
            } else if (Number.isInteger(arguments[0])) {
                var t = arguments[0];
                this.init(1), this.location[Cc.ON] = t
            } else if (arguments[0] instanceof Bv) {
                var n = arguments[0];
                if (this.init(n.location.length), null !== n) for (var r = 0; r < this.location.length; r++) this.location[r] = n.location[r]
            }
        } else if (3 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2];
            this.init(3), this.location[Cc.ON] = i, this.location[Cc.LEFT] = s, this.location[Cc.RIGHT] = o
        }
    };
    _c.prototype.setAllLocations = function (e) {
        for (var t = 0; t < this.location.length; t++) this.location[t] = e
    }, _c.prototype.isNull = function () {
        for (var e = 0; e < this.location.length; e++) if (this.location[e] !== Lf.NONE) return !1;
        return !0
    }, _c.prototype.setAllLocationsIfNull = function (e) {
        for (var t = 0; t < this.location.length; t++) this.location[t] === Lf.NONE && (this.location[t] = e)
    }, _c.prototype.isLine = function () {
        return 1 === this.location.length
    }, _c.prototype.merge = function (e) {
        if (e.location.length > this.location.length) {
            var t = (new Array(3)).fill(null);
            t[Cc.ON] = this.location[Cc.ON], t[Cc.LEFT] = Lf.NONE, t[Cc.RIGHT] = Lf.NONE, this.location = t
        }
        for (var n = 0; n < this.location.length; n++) this.location[n] === Lf.NONE && n < e.location.length && (this.location[n] = e.location[n])
    }, _c.prototype.getLocations = function () {
        return this.location
    }, _c.prototype.flip = function () {
        if (this.location.length <= 1) return null;
        var e = this.location[Cc.LEFT];
        this.location[Cc.LEFT] = this.location[Cc.RIGHT], this.location[Cc.RIGHT] = e
    }, _c.prototype.toString = function () {
        var e = new Df;
        return this.location.length > 1 && e.append(Lf.toLocationSymbol(this.location[Cc.LEFT])), e.append(Lf.toLocationSymbol(this.location[Cc.ON])), this.location.length > 1 && e.append(Lf.toLocationSymbol(this.location[Cc.RIGHT])), e.toString()
    }, _c.prototype.setLocations = function (e, t, n) {
        this.location[Cc.ON] = e, this.location[Cc.LEFT] = t, this.location[Cc.RIGHT] = n
    }, _c.prototype.get = function (e) {
        return e < this.location.length ? this.location[e] : Lf.NONE
    }, _c.prototype.isArea = function () {
        return this.location.length > 1
    }, _c.prototype.isAnyNull = function () {
        for (var e = 0; e < this.location.length; e++) if (this.location[e] === Lf.NONE) return !0;
        return !1
    }, _c.prototype.setLocation = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.setLocation(Cc.ON, e)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            this.location[t] = n
        }
    }, _c.prototype.init = function (e) {
        this.location = (new Array(e)).fill(null), this.setAllLocations(Lf.NONE)
    }, _c.prototype.isEqualOnSide = function (e, t) {
        return this.location[t] === e.location[t]
    }, _c.prototype.allPositionsEqual = function (e) {
        for (var t = 0; t < this.location.length; t++) if (this.location[t] !== e) return !1;
        return !0
    }, _c.prototype.interfaces_ = function () {
        return []
    }, _c.prototype.getClass = function () {
        return _c
    };
    var Dc = function jv() {
        if (this.elt = (new Array(2)).fill(null), 1 === arguments.length) {
            if (Number.isInteger(arguments[0])) {
                var e = arguments[0];
                this.elt[0] = new _c(e), this.elt[1] = new _c(e)
            } else if (arguments[0] instanceof jv) {
                var t = arguments[0];
                this.elt[0] = new _c(t.elt[0]), this.elt[1] = new _c(t.elt[1])
            }
        } else if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            this.elt[0] = new _c(Lf.NONE), this.elt[1] = new _c(Lf.NONE), this.elt[n].setLocation(r)
        } else if (3 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2];
            this.elt[0] = new _c(i, s, o), this.elt[1] = new _c(i, s, o)
        } else if (4 === arguments.length) {
            var u = arguments[0], a = arguments[1], f = arguments[2], l = arguments[3];
            this.elt[0] = new _c(Lf.NONE, Lf.NONE, Lf.NONE), this.elt[1] = new _c(Lf.NONE, Lf.NONE, Lf.NONE), this.elt[u].setLocations(a, f, l)
        }
    };
    Dc.prototype.getGeometryCount = function () {
        var e = 0;
        return this.elt[0].isNull() || e++, this.elt[1].isNull() || e++, e
    }, Dc.prototype.setAllLocations = function (e, t) {
        this.elt[e].setAllLocations(t)
    }, Dc.prototype.isNull = function (e) {
        return this.elt[e].isNull()
    }, Dc.prototype.setAllLocationsIfNull = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.setAllLocationsIfNull(0, e), this.setAllLocationsIfNull(1, e)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            this.elt[t].setAllLocationsIfNull(n)
        }
    }, Dc.prototype.isLine = function (e) {
        return this.elt[e].isLine()
    }, Dc.prototype.merge = function (e) {
        for (var t = 0; t < 2; t++) null === this.elt[t] && null !== e.elt[t] ? this.elt[t] = new _c(e.elt[t]) : this.elt[t].merge(e.elt[t])
    }, Dc.prototype.flip = function () {
        this.elt[0].flip(), this.elt[1].flip()
    }, Dc.prototype.getLocation = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return this.elt[e].get(Cc.ON)
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return this.elt[t].get(n)
        }
    }, Dc.prototype.toString = function () {
        var e = new Df;
        return null !== this.elt[0] && (e.append("A:"), e.append(this.elt[0].toString())), null !== this.elt[1] && (e.append(" B:"), e.append(this.elt[1].toString())), e.toString()
    }, Dc.prototype.isArea = function () {
        if (0 === arguments.length) return this.elt[0].isArea() || this.elt[1].isArea();
        if (1 === arguments.length) {
            var e = arguments[0];
            return this.elt[e].isArea()
        }
    }, Dc.prototype.isAnyNull = function (e) {
        return this.elt[e].isAnyNull()
    }, Dc.prototype.setLocation = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            this.elt[e].setLocation(Cc.ON, t)
        } else if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2];
            this.elt[n].setLocation(r, i)
        }
    }, Dc.prototype.isEqualOnSide = function (e, t) {
        return this.elt[0].isEqualOnSide(e.elt[0], t) && this.elt[1].isEqualOnSide(e.elt[1], t)
    }, Dc.prototype.allPositionsEqual = function (e, t) {
        return this.elt[e].allPositionsEqual(t)
    }, Dc.prototype.toLine = function (e) {
        this.elt[e].isArea() && (this.elt[e] = new _c(this.elt[e].location[0]))
    }, Dc.prototype.interfaces_ = function () {
        return []
    }, Dc.prototype.getClass = function () {
        return Dc
    }, Dc.toLineLabel = function (e) {
        for (var t = new Dc(Lf.NONE), n = 0; n < 2; n++) t.setLocation(n, e.getLocation(n));
        return t
    };
    var Pc = function () {
        this._startDe = null, this._maxNodeDegree = -1, this._edges = new Tl, this._pts = new Tl, this._label = new Dc(Lf.NONE), this._ring = null, this._isHole = null, this._shell = null, this._holes = new Tl, this._geometryFactory = null;
        var e = arguments[0], t = arguments[1];
        this._geometryFactory = t, this.computePoints(e), this.computeRing()
    };
    Pc.prototype.computeRing = function () {
        if (null !== this._ring) return null;
        for (var e = (new Array(this._pts.size())).fill(null), t = 0; t < this._pts.size(); t++) e[t] = this._pts.get(t);
        this._ring = this._geometryFactory.createLinearRing(e), this._isHole = ul.isCCW(this._ring.getCoordinates())
    }, Pc.prototype.isIsolated = function () {
        return 1 === this._label.getGeometryCount()
    }, Pc.prototype.computePoints = function (e) {
        this._startDe = e;
        var t = e, n = !0;
        do {
            if (null === t) throw new Ac("Found null DirectedEdge");
            if (t.getEdgeRing() === this) throw new Ac("Directed Edge visited twice during ring-building at " + t.getCoordinate());
            this._edges.add(t);
            var r = t.getLabel();
            tl.isTrue(r.isArea()), this.mergeLabel(r), this.addPoints(t.getEdge(), t.isForward(), n), n = !1, this.setEdgeRing(t, this), t = this.getNext(t)
        } while (t !== this._startDe)
    }, Pc.prototype.getLinearRing = function () {
        return this._ring
    }, Pc.prototype.getCoordinate = function (e) {
        return this._pts.get(e)
    }, Pc.prototype.computeMaxNodeDegree = function () {
        this._maxNodeDegree = 0;
        var e = this._startDe;
        do {
            var t = e.getNode().getEdges().getOutgoingDegree(this);
            t > this._maxNodeDegree && (this._maxNodeDegree = t), e = this.getNext(e)
        } while (e !== this._startDe);
        this._maxNodeDegree *= 2
    }, Pc.prototype.addPoints = function (e, t, n) {
        var r = e.getCoordinates();
        if (t) {
            var i = 1;
            n && (i = 0);
            for (var s = i; s < r.length; s++) this._pts.add(r[s])
        } else {
            var o = r.length - 2;
            n && (o = r.length - 1);
            for (var u = o; u >= 0; u--) this._pts.add(r[u])
        }
    }, Pc.prototype.isHole = function () {
        return this._isHole
    }, Pc.prototype.setInResult = function () {
        var e = this._startDe;
        do e.getEdge().setInResult(!0), e = e.getNext(); while (e !== this._startDe)
    }, Pc.prototype.containsPoint = function (e) {
        var t = this.getLinearRing();
        if (!t.getEnvelopeInternal().contains(e)) return !1;
        if (!ul.isPointInRing(e, t.getCoordinates())) return !1;
        for (var n = this._holes.iterator(); n.hasNext();) if (n.next().containsPoint(e)) return !1;
        return !0
    }, Pc.prototype.addHole = function (e) {
        this._holes.add(e)
    }, Pc.prototype.isShell = function () {
        return null === this._shell
    }, Pc.prototype.getLabel = function () {
        return this._label
    }, Pc.prototype.getEdges = function () {
        return this._edges
    }, Pc.prototype.getMaxNodeDegree = function () {
        return this._maxNodeDegree < 0 && this.computeMaxNodeDegree(), this._maxNodeDegree
    }, Pc.prototype.getShell = function () {
        return this._shell
    }, Pc.prototype.mergeLabel = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.mergeLabel(e, 0), this.mergeLabel(e, 1)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = t.getLocation(n, Cc.RIGHT);
            if (r === Lf.NONE) return null;
            if (this._label.getLocation(n) === Lf.NONE) return this._label.setLocation(n, r), null
        }
    }, Pc.prototype.setShell = function (e) {
        this._shell = e, null !== e && e.addHole(this)
    }, Pc.prototype.toPolygon = function (e) {
        for (var t = (new Array(this._holes.size())).fill(null), n = 0; n < this._holes.size(); n++) t[n] = this._holes.get(n).getLinearRing();
        return e.createPolygon(this.getLinearRing(), t)
    }, Pc.prototype.interfaces_ = function () {
        return []
    }, Pc.prototype.getClass = function () {
        return Pc
    };
    var Hc = function (e) {
        function t() {
            var t = arguments[0], n = arguments[1];
            e.call(this, t, n)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.setEdgeRing = function (e, t) {
            e.setMinEdgeRing(t)
        }, t.prototype.getNext = function (e) {
            return e.getNextMin()
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Pc), Bc = function (e) {
        function t() {
            var t = arguments[0], n = arguments[1];
            e.call(this, t, n)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.buildMinimalRings = function () {
            var e = new Tl, t = this._startDe;
            do {
                if (null === t.getMinEdgeRing()) {
                    var n = new Hc(t, this._geometryFactory);
                    e.add(n)
                }
                t = t.getNext()
            } while (t !== this._startDe);
            return e
        }, t.prototype.setEdgeRing = function (e, t) {
            e.setEdgeRing(t)
        }, t.prototype.linkDirectedEdgesForMinimalEdgeRings = function () {
            var e = this._startDe;
            do e.getNode().getEdges().linkMinimalDirectedEdges(this), e = e.getNext(); while (e !== this._startDe)
        }, t.prototype.getNext = function (e) {
            return e.getNext()
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Pc), jc = function () {
        if (this._label = null, this._isInResult = !1, this._isCovered = !1, this._isCoveredSet = !1, this._isVisited = !1, 0 !== arguments.length) if (1 === arguments.length) {
            var e = arguments[0];
            this._label = e
        }
    };
    jc.prototype.setVisited = function (e) {
        this._isVisited = e
    }, jc.prototype.setInResult = function (e) {
        this._isInResult = e
    }, jc.prototype.isCovered = function () {
        return this._isCovered
    }, jc.prototype.isCoveredSet = function () {
        return this._isCoveredSet
    }, jc.prototype.setLabel = function (e) {
        this._label = e
    }, jc.prototype.getLabel = function () {
        return this._label
    }, jc.prototype.setCovered = function (e) {
        this._isCovered = e, this._isCoveredSet = !0
    }, jc.prototype.updateIM = function (e) {
        tl.isTrue(this._label.getGeometryCount() >= 2, "found partial label"), this.computeIM(e)
    }, jc.prototype.isInResult = function () {
        return this._isInResult
    }, jc.prototype.isVisited = function () {
        return this._isVisited
    }, jc.prototype.interfaces_ = function () {
        return []
    }, jc.prototype.getClass = function () {
        return jc
    };
    var Fc = function (e) {
        function t() {
            e.call(this), this._coord = null, this._edges = null;
            var t = arguments[0], n = arguments[1];
            this._coord = t, this._edges = n, this._label = new Dc(0, Lf.NONE)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.isIncidentEdgeInResult = function () {
            for (var e = this.getEdges().getEdges().iterator(); e.hasNext();) if (e.next().getEdge().isInResult()) return !0;
            return !1
        }, t.prototype.isIsolated = function () {
            return 1 === this._label.getGeometryCount()
        }, t.prototype.getCoordinate = function () {
            return this._coord
        }, t.prototype.print = function (e) {
            e.println("node " + this._coord + " lbl: " + this._label)
        }, t.prototype.computeIM = function (e) {
        }, t.prototype.computeMergedLocation = function (e, t) {
            var n = Lf.NONE;
            if (n = this._label.getLocation(t), !e.isNull(t)) {
                var r = e.getLocation(t);
                n !== Lf.BOUNDARY && (n = r)
            }
            return n
        }, t.prototype.setLabel = function () {
            if (2 !== arguments.length) return e.prototype.setLabel.apply(this, arguments);
            var t = arguments[0], n = arguments[1];
            null === this._label ? this._label = new Dc(t, n) : this._label.setLocation(t, n)
        }, t.prototype.getEdges = function () {
            return this._edges
        }, t.prototype.mergeLabel = function () {
            if (arguments[0] instanceof t) {
                var e = arguments[0];
                this.mergeLabel(e._label)
            } else if (arguments[0] instanceof Dc) for (var n = arguments[0], r = 0; r < 2; r++) {
                var i = this.computeMergedLocation(n, r);
                this._label.getLocation(r) === Lf.NONE && this._label.setLocation(r, i)
            }
        }, t.prototype.add = function (e) {
            this._edges.insert(e), e.setNode(this)
        }, t.prototype.setLabelBoundary = function (e) {
            if (null === this._label) return null;
            var t = Lf.NONE;
            null !== this._label && (t = this._label.getLocation(e));
            var n = null;
            switch (t) {
                case Lf.BOUNDARY:
                    n = Lf.INTERIOR;
                    break;
                case Lf.INTERIOR:
                default:
                    n = Lf.BOUNDARY
            }
            this._label.setLocation(e, n)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(jc), Ic = function () {
        this.nodeMap = new Fs, this.nodeFact = null;
        var e = arguments[0];
        this.nodeFact = e
    };
    Ic.prototype.find = function (e) {
        return this.nodeMap.get(e)
    }, Ic.prototype.addNode = function () {
        if (arguments[0] instanceof Tf) {
            var e = arguments[0], t = this.nodeMap.get(e);
            return null === t && (t = this.nodeFact.createNode(e), this.nodeMap.put(e, t)), t
        }
        if (arguments[0] instanceof Fc) {
            var n = arguments[0], r = this.nodeMap.get(n.getCoordinate());
            return null === r ? (this.nodeMap.put(n.getCoordinate(), n), n) : (r.mergeLabel(n), r)
        }
    }, Ic.prototype.print = function (e) {
        for (var t = this.iterator(); t.hasNext();) t.next().print(e)
    }, Ic.prototype.iterator = function () {
        return this.nodeMap.values().iterator()
    }, Ic.prototype.values = function () {
        return this.nodeMap.values()
    }, Ic.prototype.getBoundaryNodes = function (e) {
        for (var t = new Tl, n = this.iterator(); n.hasNext();) {
            var r = n.next();
            r.getLabel().getLocation(e) === Lf.BOUNDARY && t.add(r)
        }
        return t
    }, Ic.prototype.add = function (e) {
        var t = e.getCoordinate();
        this.addNode(t).add(e)
    }, Ic.prototype.interfaces_ = function () {
        return []
    }, Ic.prototype.getClass = function () {
        return Ic
    };
    var qc = function () {
    }, Rc = {NE: {configurable: !0}, NW: {configurable: !0}, SW: {configurable: !0}, SE: {configurable: !0}};
    qc.prototype.interfaces_ = function () {
        return []
    }, qc.prototype.getClass = function () {
        return qc
    }, qc.isNorthern = function (e) {
        return e === qc.NE || e === qc.NW
    }, qc.isOpposite = function (e, t) {
        return e === t ? !1 : 2 === (e - t + 4) % 4
    }, qc.commonHalfPlane = function (e, t) {
        if (e === t) return e;
        if (2 === (e - t + 4) % 4) return -1;
        var n = e < t ? e : t;
        return 0 === n && 3 === (e > t ? e : t) ? 3 : n
    }, qc.isInHalfPlane = function (e, t) {
        return t === qc.SE ? e === qc.SE || e === qc.SW : e === t || e === t + 1
    }, qc.quadrant = function () {
        if ("number" == typeof arguments[0] && "number" == typeof arguments[1]) {
            var e = arguments[0], t = arguments[1];
            if (0 === e && 0 === t) throw new yf("Cannot compute the quadrant for point ( " + e + ", " + t + " )");
            return e >= 0 ? t >= 0 ? qc.NE : qc.SE : t >= 0 ? qc.NW : qc.SW
        }
        if (arguments[0] instanceof Tf && arguments[1] instanceof Tf) {
            var n = arguments[0], r = arguments[1];
            if (r.x === n.x && r.y === n.y) throw new yf("Cannot compute the quadrant for two identical points " + n);
            return r.x >= n.x ? r.y >= n.y ? qc.NE : qc.SE : r.y >= n.y ? qc.NW : qc.SW
        }
    }, Rc.NE.get = function () {
        return 0
    }, Rc.NW.get = function () {
        return 1
    }, Rc.SW.get = function () {
        return 2
    }, Rc.SE.get = function () {
        return 3
    }, Object.defineProperties(qc, Rc);
    var Uc = function () {
        if (this._edge = null, this._label = null, this._node = null, this._p0 = null, this._p1 = null, this._dx = null, this._dy = null, this._quadrant = null, 1 === arguments.length) {
            var e = arguments[0];
            this._edge = e
        } else if (3 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = arguments[2];
            this._edge = t, this.init(n, r), this._label = null
        } else if (4 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2], u = arguments[3];
            this._edge = i, this.init(s, o), this._label = u
        }
    };
    Uc.prototype.compareDirection = function (e) {
        return this._dx === e._dx && this._dy === e._dy ? 0 : this._quadrant > e._quadrant ? 1 : this._quadrant < e._quadrant ? -1 : ul.computeOrientation(e._p0, e._p1, this._p1)
    }, Uc.prototype.getDy = function () {
        return this._dy
    }, Uc.prototype.getCoordinate = function () {
        return this._p0
    }, Uc.prototype.setNode = function (e) {
        this._node = e
    }, Uc.prototype.print = function (e) {
        var t = Math.atan2(this._dy, this._dx), n = this.getClass().getName(), r = n.lastIndexOf("."),
            i = n.substring(r + 1);
        e.print("  " + i + ": " + this._p0 + " - " + this._p1 + " " + this._quadrant + ":" + t + "   " + this._label)
    }, Uc.prototype.compareTo = function (e) {
        var t = e;
        return this.compareDirection(t)
    }, Uc.prototype.getDirectedCoordinate = function () {
        return this._p1
    }, Uc.prototype.getDx = function () {
        return this._dx
    }, Uc.prototype.getLabel = function () {
        return this._label
    }, Uc.prototype.getEdge = function () {
        return this._edge
    }, Uc.prototype.getQuadrant = function () {
        return this._quadrant
    }, Uc.prototype.getNode = function () {
        return this._node
    }, Uc.prototype.toString = function () {
        var e = Math.atan2(this._dy, this._dx), t = this.getClass().getName(), n = t.lastIndexOf(".");
        return "  " + t.substring(n + 1) + ": " + this._p0 + " - " + this._p1 + " " + this._quadrant + ":" + e + "   " + this._label
    }, Uc.prototype.computeLabel = function (e) {
    }, Uc.prototype.init = function (e, t) {
        this._p0 = e, this._p1 = t, this._dx = t.x - e.x, this._dy = t.y - e.y, this._quadrant = qc.quadrant(this._dx, this._dy), tl.isTrue(0 !== this._dx || 0 !== this._dy, "EdgeEnd with identical endpoints found")
    }, Uc.prototype.interfaces_ = function () {
        return [Ef]
    }, Uc.prototype.getClass = function () {
        return Uc
    };
    var zc = function (e) {
        function t() {
            var t = arguments[0], n = arguments[1];
            if (e.call(this, t), this._isForward = null, this._isInResult = !1, this._isVisited = !1, this._sym = null, this._next = null, this._nextMin = null, this._edgeRing = null, this._minEdgeRing = null, this._depth = [0, -999, -999], this._isForward = n, n) this.init(t.getCoordinate(0), t.getCoordinate(1)); else {
                var r = t.getNumPoints() - 1;
                this.init(t.getCoordinate(r), t.getCoordinate(r - 1))
            }
            this.computeDirectedLabel()
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.getNextMin = function () {
            return this._nextMin
        }, t.prototype.getDepth = function (e) {
            return this._depth[e]
        }, t.prototype.setVisited = function (e) {
            this._isVisited = e
        }, t.prototype.computeDirectedLabel = function () {
            this._label = new Dc(this._edge.getLabel()), this._isForward || this._label.flip()
        }, t.prototype.getNext = function () {
            return this._next
        }, t.prototype.setDepth = function (e, t) {
            if (-999 !== this._depth[e] && this._depth[e] !== t) throw new Ac("assigned depths do not match", this.getCoordinate());
            this._depth[e] = t
        }, t.prototype.isInteriorAreaEdge = function () {
            for (var e = !0, t = 0; t < 2; t++) this._label.isArea(t) && this._label.getLocation(t, Cc.LEFT) === Lf.INTERIOR && this._label.getLocation(t, Cc.RIGHT) === Lf.INTERIOR || (e = !1);
            return e
        }, t.prototype.setNextMin = function (e) {
            this._nextMin = e
        }, t.prototype.print = function (t) {
            e.prototype.print.call(this, t), t.print(" " + this._depth[Cc.LEFT] + "/" + this._depth[Cc.RIGHT]), t.print(" (" + this.getDepthDelta() + ")"), this._isInResult && t.print(" inResult")
        }, t.prototype.setMinEdgeRing = function (e) {
            this._minEdgeRing = e
        }, t.prototype.isLineEdge = function () {
            var e = this._label.isLine(0) || this._label.isLine(1),
                t = !this._label.isArea(0) || this._label.allPositionsEqual(0, Lf.EXTERIOR),
                n = !this._label.isArea(1) || this._label.allPositionsEqual(1, Lf.EXTERIOR);
            return e && t && n
        }, t.prototype.setEdgeRing = function (e) {
            this._edgeRing = e
        }, t.prototype.getMinEdgeRing = function () {
            return this._minEdgeRing
        }, t.prototype.getDepthDelta = function () {
            var e = this._edge.getDepthDelta();
            return this._isForward || (e = -e), e
        }, t.prototype.setInResult = function (e) {
            this._isInResult = e
        }, t.prototype.getSym = function () {
            return this._sym
        }, t.prototype.isForward = function () {
            return this._isForward
        }, t.prototype.getEdge = function () {
            return this._edge
        }, t.prototype.printEdge = function (e) {
            this.print(e), e.print(" "), this._isForward ? this._edge.print(e) : this._edge.printReverse(e)
        }, t.prototype.setSym = function (e) {
            this._sym = e
        }, t.prototype.setVisitedEdge = function (e) {
            this.setVisited(e), this._sym.setVisited(e)
        }, t.prototype.setEdgeDepths = function (e, t) {
            var n = this.getEdge().getDepthDelta();
            this._isForward || (n = -n);
            var r = 1;
            e === Cc.LEFT && (r = -1);
            var i = Cc.opposite(e), s = t + n * r;
            this.setDepth(e, t), this.setDepth(i, s)
        }, t.prototype.getEdgeRing = function () {
            return this._edgeRing
        }, t.prototype.isInResult = function () {
            return this._isInResult
        }, t.prototype.setNext = function (e) {
            this._next = e
        }, t.prototype.isVisited = function () {
            return this._isVisited
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t.depthFactor = function (e, t) {
            return e === Lf.EXTERIOR && t === Lf.INTERIOR ? 1 : e === Lf.INTERIOR && t === Lf.EXTERIOR ? -1 : 0
        }, t
    }(Uc), Wc = function () {
    };
    Wc.prototype.createNode = function (e) {
        return new Fc(e, null)
    }, Wc.prototype.interfaces_ = function () {
        return []
    }, Wc.prototype.getClass = function () {
        return Wc
    };
    var Xc = function () {
        if (this._edges = new Tl, this._nodes = null, this._edgeEndList = new Tl, 0 === arguments.length) this._nodes = new Ic(new Wc); else if (1 === arguments.length) {
            var e = arguments[0];
            this._nodes = new Ic(e)
        }
    };
    Xc.prototype.printEdges = function (e) {
        e.println("Edges:");
        for (var t = 0; t < this._edges.size(); t++) {
            e.println("edge " + t + ":");
            var n = this._edges.get(t);
            n.print(e), n.eiList.print(e)
        }
    }, Xc.prototype.find = function (e) {
        return this._nodes.find(e)
    }, Xc.prototype.addNode = function () {
        if (arguments[0] instanceof Fc) {
            var e = arguments[0];
            return this._nodes.addNode(e)
        }
        if (arguments[0] instanceof Tf) {
            var t = arguments[0];
            return this._nodes.addNode(t)
        }
    }, Xc.prototype.getNodeIterator = function () {
        return this._nodes.iterator()
    }, Xc.prototype.linkResultDirectedEdges = function () {
        for (var e = this._nodes.iterator(); e.hasNext();) e.next().getEdges().linkResultDirectedEdges()
    }, Xc.prototype.debugPrintln = function (e) {
        Wf.out.println(e)
    }, Xc.prototype.isBoundaryNode = function (e, t) {
        var n = this._nodes.find(t);
        if (null === n) return !1;
        var r = n.getLabel();
        return null !== r && r.getLocation(e) === Lf.BOUNDARY
    }, Xc.prototype.linkAllDirectedEdges = function () {
        for (var e = this._nodes.iterator(); e.hasNext();) e.next().getEdges().linkAllDirectedEdges()
    }, Xc.prototype.matchInSameDirection = function (e, t, n, r) {
        return !!e.equals(n) && ul.computeOrientation(e, t, r) === ul.COLLINEAR && qc.quadrant(e, t) === qc.quadrant(n, r)
    }, Xc.prototype.getEdgeEnds = function () {
        return this._edgeEndList
    }, Xc.prototype.debugPrint = function (e) {
        Wf.out.print(e)
    }, Xc.prototype.getEdgeIterator = function () {
        return this._edges.iterator()
    }, Xc.prototype.findEdgeInSameDirection = function (e, t) {
        for (var n = 0; n < this._edges.size(); n++) {
            var r = this._edges.get(n), i = r.getCoordinates();
            if (this.matchInSameDirection(e, t, i[0], i[1])) return r;
            if (this.matchInSameDirection(e, t, i[i.length - 1], i[i.length - 2])) return r
        }
        return null
    }, Xc.prototype.insertEdge = function (e) {
        this._edges.add(e)
    }, Xc.prototype.findEdgeEnd = function (e) {
        for (var t = this.getEdgeEnds().iterator(); t.hasNext();) {
            var n = t.next();
            if (n.getEdge() === e) return n
        }
        return null
    }, Xc.prototype.addEdges = function (e) {
        for (var t = e.iterator(); t.hasNext();) {
            var n = t.next();
            this._edges.add(n);
            var r = new zc(n, !0), i = new zc(n, !1);
            r.setSym(i), i.setSym(r), this.add(r), this.add(i)
        }
    }, Xc.prototype.add = function (e) {
        this._nodes.add(e), this._edgeEndList.add(e)
    }, Xc.prototype.getNodes = function () {
        return this._nodes.values()
    }, Xc.prototype.findEdge = function (e, t) {
        for (var n = 0; n < this._edges.size(); n++) {
            var r = this._edges.get(n), i = r.getCoordinates();
            if (e.equals(i[0]) && t.equals(i[1])) return r
        }
        return null
    }, Xc.prototype.interfaces_ = function () {
        return []
    }, Xc.prototype.getClass = function () {
        return Xc
    }, Xc.linkResultDirectedEdges = function (e) {
        for (var t = e.iterator(); t.hasNext();) t.next().getEdges().linkResultDirectedEdges()
    };
    var Vc = function () {
        this._geometryFactory = null, this._shellList = new Tl;
        var e = arguments[0];
        this._geometryFactory = e
    };
    Vc.prototype.sortShellsAndHoles = function (e, t, n) {
        for (var r = e.iterator(); r.hasNext();) {
            var i = r.next();
            i.isHole() ? n.add(i) : t.add(i)
        }
    }, Vc.prototype.computePolygons = function (e) {
        for (var t = new Tl, n = e.iterator(); n.hasNext();) {
            var r = n.next().toPolygon(this._geometryFactory);
            t.add(r)
        }
        return t
    }, Vc.prototype.placeFreeHoles = function (e, t) {
        for (var n = t.iterator(); n.hasNext();) {
            var r = n.next();
            if (null === r.getShell()) {
                var i = this.findEdgeRingContaining(r, e);
                if (null === i) throw new Ac("unable to assign hole to a shell", r.getCoordinate(0));
                r.setShell(i)
            }
        }
    }, Vc.prototype.buildMinimalEdgeRings = function (e, t, n) {
        for (var r = new Tl, i = e.iterator(); i.hasNext();) {
            var s = i.next();
            if (s.getMaxNodeDegree() > 2) {
                s.linkDirectedEdgesForMinimalEdgeRings();
                var o = s.buildMinimalRings(), u = this.findShell(o);
                null !== u ? (this.placePolygonHoles(u, o), t.add(u)) : n.addAll(o)
            } else r.add(s)
        }
        return r
    }, Vc.prototype.containsPoint = function (e) {
        for (var t = this._shellList.iterator(); t.hasNext();) if (t.next().containsPoint(e)) return !0;
        return !1
    }, Vc.prototype.buildMaximalEdgeRings = function (e) {
        for (var t = new Tl, n = e.iterator(); n.hasNext();) {
            var r = n.next();
            if (r.isInResult() && r.getLabel().isArea() && null === r.getEdgeRing()) {
                var i = new Bc(r, this._geometryFactory);
                t.add(i), i.setInResult()
            }
        }
        return t
    }, Vc.prototype.placePolygonHoles = function (e, t) {
        for (var n = t.iterator(); n.hasNext();) {
            var r = n.next();
            r.isHole() && r.setShell(e)
        }
    }, Vc.prototype.getPolygons = function () {
        return this.computePolygons(this._shellList)
    }, Vc.prototype.findEdgeRingContaining = function (e, t) {
        for (var n = e.getLinearRing(), r = n.getEnvelopeInternal(), i = n.getCoordinateN(0), s = null, o = null, u = t.iterator(); u.hasNext();) {
            var a = u.next(), f = a.getLinearRing(), l = f.getEnvelopeInternal();
            null !== s && (o = s.getLinearRing().getEnvelopeInternal());
            var c = !1;
            l.contains(r) && ul.isPointInRing(i, f.getCoordinates()) && (c = !0), c && (null === s || o.contains(l)) && (s = a)
        }
        return s
    }, Vc.prototype.findShell = function (e) {
        for (var t = 0, n = null, r = e.iterator(); r.hasNext();) {
            var i = r.next();
            i.isHole() || (n = i, t++)
        }
        return tl.isTrue(t <= 1, "found two shells in MinimalEdgeRing list"), n
    }, Vc.prototype.add = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.add(e.getEdgeEnds(), e.getNodes())
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            Xc.linkResultDirectedEdges(n);
            var r = this.buildMaximalEdgeRings(t), i = new Tl, s = this.buildMinimalEdgeRings(r, this._shellList, i);
            this.sortShellsAndHoles(s, this._shellList, i), this.placeFreeHoles(this._shellList, i)
        }
    }, Vc.prototype.interfaces_ = function () {
        return []
    }, Vc.prototype.getClass = function () {
        return Vc
    };
    var $c = function () {
    };
    $c.prototype.getBounds = function () {
    }, $c.prototype.interfaces_ = function () {
        return []
    }, $c.prototype.getClass = function () {
        return $c
    };
    var Jc = function () {
        this._bounds = null, this._item = null;
        var e = arguments[0], t = arguments[1];
        this._bounds = e, this._item = t
    };
    Jc.prototype.getItem = function () {
        return this._item
    }, Jc.prototype.getBounds = function () {
        return this._bounds
    }, Jc.prototype.interfaces_ = function () {
        return [$c, As]
    }, Jc.prototype.getClass = function () {
        return Jc
    };
    var Kc = function () {
        this._size = null, this._items = null, this._size = 0, this._items = new Tl, this._items.add(null)
    };
    Kc.prototype.poll = function () {
        if (this.isEmpty()) return null;
        var e = this._items.get(1);
        return this._items.set(1, this._items.get(this._size)), this._size -= 1, this.reorder(1), e
    }, Kc.prototype.size = function () {
        return this._size
    }, Kc.prototype.reorder = function (e) {
        for (var t = null, n = this._items.get(e); 2 * e <= this._size && ((t = 2 * e) !== this._size && this._items.get(t + 1).compareTo(this._items.get(t)) < 0 && t++, this._items.get(t).compareTo(n) < 0); e = t) this._items.set(e, this._items.get(t));
        this._items.set(e, n)
    }, Kc.prototype.clear = function () {
        this._size = 0, this._items.clear()
    }, Kc.prototype.isEmpty = function () {
        return 0 === this._size
    }, Kc.prototype.add = function (e) {
        this._items.add(null), this._size += 1;
        var t = this._size;
        for (this._items.set(0, e); e.compareTo(this._items.get(Math.trunc(t / 2))) < 0; t /= 2) this._items.set(t, this._items.get(Math.trunc(t / 2)));
        this._items.set(t, e)
    }, Kc.prototype.interfaces_ = function () {
        return []
    }, Kc.prototype.getClass = function () {
        return Kc
    };
    var Qc = function () {
    };
    Qc.prototype.visitItem = function (e) {
    }, Qc.prototype.interfaces_ = function () {
        return []
    }, Qc.prototype.getClass = function () {
        return Qc
    };
    var Gc = function () {
    };
    Gc.prototype.insert = function (e, t) {
    }, Gc.prototype.remove = function (e, t) {
    }, Gc.prototype.query = function () {
    }, Gc.prototype.interfaces_ = function () {
        return []
    }, Gc.prototype.getClass = function () {
        return Gc
    };
    var Yc = function () {
        if (this._childBoundables = new Tl, this._bounds = null, this._level = null, 0 !== arguments.length) if (1 === arguments.length) {
            var e = arguments[0];
            this._level = e
        }
    }, Zc = {serialVersionUID: {configurable: !0}};
    Yc.prototype.getLevel = function () {
        return this._level
    }, Yc.prototype.size = function () {
        return this._childBoundables.size()
    }, Yc.prototype.getChildBoundables = function () {
        return this._childBoundables
    }, Yc.prototype.addChildBoundable = function (e) {
        tl.isTrue(null === this._bounds), this._childBoundables.add(e)
    }, Yc.prototype.isEmpty = function () {
        return this._childBoundables.isEmpty()
    }, Yc.prototype.getBounds = function () {
        return null === this._bounds && (this._bounds = this.computeBounds()), this._bounds
    }, Yc.prototype.interfaces_ = function () {
        return [$c, As]
    }, Yc.prototype.getClass = function () {
        return Yc
    }, Zc.serialVersionUID.get = function () {
        return 0x5a1e55ec41369800
    }, Object.defineProperties(Yc, Zc);
    var eh = function () {
    };
    eh.reverseOrder = function () {
        return {
            compare: function (e, t) {
                return t.compareTo(e)
            }
        }
    }, eh.min = function (e) {
        return eh.sort(e), e.get(0)
    }, eh.sort = function (e, t) {
        var n = e.toArray();
        t ? Fl.sort(n, t) : Fl.sort(n);
        for (var r = e.iterator(), i = 0, s = n.length; i < s; i++) r.next(), r.set(n[i])
    }, eh.singletonList = function (e) {
        var t = new Tl;
        return t.add(e), t
    };
    var th = function () {
        this._boundable1 = null, this._boundable2 = null, this._distance = null, this._itemDistance = null;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        this._boundable1 = e, this._boundable2 = t, this._itemDistance = n, this._distance = this.distance()
    };
    th.prototype.expandToQueue = function (e, t) {
        var n = th.isComposite(this._boundable1), r = th.isComposite(this._boundable2);
        if (n && r) return th.area(this._boundable1) > th.area(this._boundable2) ? (this.expand(this._boundable1, this._boundable2, e, t), null) : (this.expand(this._boundable2, this._boundable1, e, t), null);
        if (n) return this.expand(this._boundable1, this._boundable2, e, t), null;
        if (r) return this.expand(this._boundable2, this._boundable1, e, t), null;
        throw new yf("neither boundable is composite")
    }, th.prototype.isLeaves = function () {
        return !th.isComposite(this._boundable1) && !th.isComposite(this._boundable2)
    }, th.prototype.compareTo = function (e) {
        var t = e;
        return this._distance < t._distance ? -1 : this._distance > t._distance ? 1 : 0
    }, th.prototype.expand = function (e, t, n, r) {
        for (var i = e.getChildBoundables().iterator(); i.hasNext();) {
            var s = i.next(), o = new th(s, t, this._itemDistance);
            o.getDistance() < r && n.add(o)
        }
    }, th.prototype.getBoundable = function (e) {
        return 0 === e ? this._boundable1 : this._boundable2
    }, th.prototype.getDistance = function () {
        return this._distance
    }, th.prototype.distance = function () {
        return this.isLeaves() ? this._itemDistance.distance(this._boundable1, this._boundable2) : this._boundable1.getBounds().distance(this._boundable2.getBounds())
    }, th.prototype.interfaces_ = function () {
        return [Ef]
    }, th.prototype.getClass = function () {
        return th
    }, th.area = function (e) {
        return e.getBounds().getArea()
    }, th.isComposite = function (e) {
        return e instanceof Yc
    };
    var nh = function Fv() {
        if (this._root = null, this._built = !1, this._itemBoundables = new Tl, this._nodeCapacity = null, 0 === arguments.length) {
            var e = Fv.DEFAULT_NODE_CAPACITY;
            this._nodeCapacity = e
        } else if (1 === arguments.length) {
            var t = arguments[0];
            tl.isTrue(t > 1, "Node capacity must be greater than 1"), this._nodeCapacity = t
        }
    }, rh = {
        IntersectsOp: {configurable: !0},
        serialVersionUID: {configurable: !0},
        DEFAULT_NODE_CAPACITY: {configurable: !0}
    };
    nh.prototype.getNodeCapacity = function () {
        return this._nodeCapacity
    }, nh.prototype.lastNode = function (e) {
        return e.get(e.size() - 1)
    }, nh.prototype.size = function () {
        if (0 === arguments.length) return this.isEmpty() ? 0 : (this.build(), this.size(this._root));
        if (1 === arguments.length) {
            for (var e = 0, t = arguments[0].getChildBoundables().iterator(); t.hasNext();) {
                var n = t.next();
                n instanceof Yc ? e += this.size(n) : n instanceof Jc && (e += 1)
            }
            return e
        }
    }, nh.prototype.removeItem = function (e, t) {
        for (var n = null, r = e.getChildBoundables().iterator(); r.hasNext();) {
            var i = r.next();
            i instanceof Jc && i.getItem() === t && (n = i)
        }
        return null !== n && (e.getChildBoundables().remove(n), !0)
    }, nh.prototype.itemsTree = function () {
        if (0 === arguments.length) {
            this.build();
            var e = this.itemsTree(this._root);
            return null === e ? new Tl : e
        }
        if (1 === arguments.length) {
            for (var t = arguments[0], n = new Tl, r = t.getChildBoundables().iterator(); r.hasNext();) {
                var i = r.next();
                if (i instanceof Yc) {
                    var s = this.itemsTree(i);
                    null !== s && n.add(s)
                } else i instanceof Jc ? n.add(i.getItem()) : tl.shouldNeverReachHere()
            }
            return n.size() <= 0 ? null : n
        }
    }, nh.prototype.insert = function (e, t) {
        tl.isTrue(!this._built, "Cannot insert items into an STR packed R-tree after it has been built."), this._itemBoundables.add(new Jc(e, t))
    }, nh.prototype.boundablesAtLevel = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = new Tl;
            return this.boundablesAtLevel(e, this._root, t), t
        }
        if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2];
            if (tl.isTrue(n > -2), r.getLevel() === n) return i.add(r), null;
            for (var s = r.getChildBoundables().iterator(); s.hasNext();) {
                var o = s.next();
                o instanceof Yc ? this.boundablesAtLevel(n, o, i) : (tl.isTrue(o instanceof Jc), -1 === n && i.add(o))
            }
            return null
        }
    }, nh.prototype.query = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.build();
            var t = new Tl;
            return this.isEmpty() ? t : (this.getIntersectsOp().intersects(this._root.getBounds(), e) && this.query(e, this._root, t), t)
        }
        if (2 === arguments.length) {
            var n = arguments[0], r = arguments[1];
            if (this.build(), this.isEmpty()) return null;
            this.getIntersectsOp().intersects(this._root.getBounds(), n) && this.query(n, this._root, r)
        } else if (3 === arguments.length) if (Of(arguments[2], Qc) && arguments[0] instanceof Object && arguments[1] instanceof Yc) for (var i = arguments[0], s = arguments[1], o = arguments[2], u = s.getChildBoundables(), a = 0; a < u.size(); a++) {
            var f = u.get(a);
            this.getIntersectsOp().intersects(f.getBounds(), i) && (f instanceof Yc ? this.query(i, f, o) : f instanceof Jc ? o.visitItem(f.getItem()) : tl.shouldNeverReachHere())
        } else if (Of(arguments[2], xl) && arguments[0] instanceof Object && arguments[1] instanceof Yc) for (var l = arguments[0], c = arguments[1], h = arguments[2], p = c.getChildBoundables(), d = 0; d < p.size(); d++) {
            var v = p.get(d);
            this.getIntersectsOp().intersects(v.getBounds(), l) && (v instanceof Yc ? this.query(l, v, h) : v instanceof Jc ? h.add(v.getItem()) : tl.shouldNeverReachHere())
        }
    }, nh.prototype.build = function () {
        if (this._built) return null;
        this._root = this._itemBoundables.isEmpty() ? this.createNode(0) : this.createHigherLevels(this._itemBoundables, -1), this._itemBoundables = null, this._built = !0
    }, nh.prototype.getRoot = function () {
        return this.build(), this._root
    }, nh.prototype.remove = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            return this.build(), !!this.getIntersectsOp().intersects(this._root.getBounds(), e) && this.remove(e, this._root, t)
        }
        if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2], s = this.removeItem(r, i);
            if (s) return !0;
            for (var o = null, u = r.getChildBoundables().iterator(); u.hasNext();) {
                var a = u.next();
                if (this.getIntersectsOp().intersects(a.getBounds(), n) && a instanceof Yc && (s = this.remove(n, a, i))) {
                    o = a;
                    break
                }
            }
            return null !== o && o.getChildBoundables().isEmpty() && r.getChildBoundables().remove(o), s
        }
    }, nh.prototype.createHigherLevels = function (e, t) {
        tl.isTrue(!e.isEmpty());
        var n = this.createParentBoundables(e, t + 1);
        return 1 === n.size() ? n.get(0) : this.createHigherLevels(n, t + 1)
    }, nh.prototype.depth = function () {
        if (0 === arguments.length) return this.isEmpty() ? 0 : (this.build(), this.depth(this._root));
        if (1 === arguments.length) {
            for (var e = 0, t = arguments[0].getChildBoundables().iterator(); t.hasNext();) {
                var n = t.next();
                if (n instanceof Yc) {
                    var r = this.depth(n);
                    r > e && (e = r)
                }
            }
            return e + 1
        }
    }, nh.prototype.createParentBoundables = function (e, t) {
        tl.isTrue(!e.isEmpty());
        var n = new Tl;
        n.add(this.createNode(t));
        var r = new Tl(e);
        eh.sort(r, this.getComparator());
        for (var i = r.iterator(); i.hasNext();) {
            var s = i.next();
            this.lastNode(n).getChildBoundables().size() === this.getNodeCapacity() && n.add(this.createNode(t)), this.lastNode(n).addChildBoundable(s)
        }
        return n
    }, nh.prototype.isEmpty = function () {
        return this._built ? this._root.isEmpty() : this._itemBoundables.isEmpty()
    }, nh.prototype.interfaces_ = function () {
        return [As]
    }, nh.prototype.getClass = function () {
        return nh
    }, nh.compareDoubles = function (e, t) {
        return e > t ? 1 : e < t ? -1 : 0
    }, rh.IntersectsOp.get = function () {
        return ih
    }, rh.serialVersionUID.get = function () {
        return -0x35ef64c82d4c5400
    }, rh.DEFAULT_NODE_CAPACITY.get = function () {
        return 10
    }, Object.defineProperties(nh, rh);
    var ih = function () {
    }, sh = function () {
    };
    sh.prototype.distance = function (e, t) {
    }, sh.prototype.interfaces_ = function () {
        return []
    }, sh.prototype.getClass = function () {
        return sh
    };
    var oh = function (e) {
        function t(n) {
            n = n || t.DEFAULT_NODE_CAPACITY, e.call(this, n)
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {
            STRtreeNode: {configurable: !0},
            serialVersionUID: {configurable: !0},
            xComparator: {configurable: !0},
            yComparator: {configurable: !0},
            intersectsOp: {configurable: !0},
            DEFAULT_NODE_CAPACITY: {configurable: !0}
        };
        return t.prototype.createParentBoundablesFromVerticalSlices = function (e, t) {
            tl.isTrue(e.length > 0);
            for (var n = new Tl, r = 0; r < e.length; r++) n.addAll(this.createParentBoundablesFromVerticalSlice(e[r], t));
            return n
        }, t.prototype.createNode = function (e) {
            return new uh(e)
        }, t.prototype.size = function () {
            return 0 === arguments.length ? e.prototype.size.call(this) : e.prototype.size.apply(this, arguments)
        }, t.prototype.insert = function () {
            if (2 !== arguments.length) return e.prototype.insert.apply(this, arguments);
            var t = arguments[0], n = arguments[1];
            if (t.isNull()) return null;
            e.prototype.insert.call(this, t, n)
        }, t.prototype.getIntersectsOp = function () {
            return t.intersectsOp
        }, t.prototype.verticalSlices = function (e, t) {
            for (var n = Math.trunc(Math.ceil(e.size() / t)), r = (new Array(t)).fill(null), i = e.iterator(), s = 0; s < t; s++) {
                r[s] = new Tl;
                for (var o = 0; i.hasNext() && o < n;) {
                    var u = i.next();
                    r[s].add(u), o++
                }
            }
            return r
        }, t.prototype.query = function () {
            if (1 === arguments.length) {
                var t = arguments[0];
                return e.prototype.query.call(this, t)
            }
            if (2 === arguments.length) {
                var n = arguments[0], r = arguments[1];
                e.prototype.query.call(this, n, r)
            } else if (3 === arguments.length) if (Of(arguments[2], Qc) && arguments[0] instanceof Object && arguments[1] instanceof Yc) {
                var i = arguments[0], s = arguments[1], o = arguments[2];
                e.prototype.query.call(this, i, s, o)
            } else if (Of(arguments[2], xl) && arguments[0] instanceof Object && arguments[1] instanceof Yc) {
                var u = arguments[0], a = arguments[1], f = arguments[2];
                e.prototype.query.call(this, u, a, f)
            }
        }, t.prototype.getComparator = function () {
            return t.yComparator
        }, t.prototype.createParentBoundablesFromVerticalSlice = function (t, n) {
            return e.prototype.createParentBoundables.call(this, t, n)
        }, t.prototype.remove = function () {
            if (2 === arguments.length) {
                var t = arguments[0], n = arguments[1];
                return e.prototype.remove.call(this, t, n)
            }
            return e.prototype.remove.apply(this, arguments)
        }, t.prototype.depth = function () {
            return 0 === arguments.length ? e.prototype.depth.call(this) : e.prototype.depth.apply(this, arguments)
        }, t.prototype.createParentBoundables = function (e, n) {
            tl.isTrue(!e.isEmpty());
            var r = Math.trunc(Math.ceil(e.size() / this.getNodeCapacity())), i = new Tl(e);
            eh.sort(i, t.xComparator);
            var s = this.verticalSlices(i, Math.trunc(Math.ceil(Math.sqrt(r))));
            return this.createParentBoundablesFromVerticalSlices(s, n)
        }, t.prototype.nearestNeighbour = function () {
            if (1 === arguments.length) {
                if (Of(arguments[0], sh)) {
                    var e = arguments[0], n = new th(this.getRoot(), this.getRoot(), e);
                    return this.nearestNeighbour(n)
                }
                if (arguments[0] instanceof th) {
                    var r = arguments[0];
                    return this.nearestNeighbour(r, bf.POSITIVE_INFINITY)
                }
            } else if (2 === arguments.length) {
                if (arguments[0] instanceof t && Of(arguments[1], sh)) {
                    var i = arguments[0], s = arguments[1], o = new th(this.getRoot(), i.getRoot(), s);
                    return this.nearestNeighbour(o)
                }
                if (arguments[0] instanceof th && "number" == typeof arguments[1]) {
                    var u = arguments[0], a = arguments[1], f = null, l = new Kc;
                    for (l.add(u); !l.isEmpty() && a > 0;) {
                        var c = l.poll(), h = c.getDistance();
                        if (h >= a) break;
                        c.isLeaves() ? (a = h, f = c) : c.expandToQueue(l, a)
                    }
                    return [f.getBoundable(0).getItem(), f.getBoundable(1).getItem()]
                }
            } else if (3 === arguments.length) {
                var p = arguments[0], d = arguments[1], v = arguments[2], m = new Jc(p, d),
                    g = new th(this.getRoot(), m, v);
                return this.nearestNeighbour(g)[0]
            }
        }, t.prototype.interfaces_ = function () {
            return [Gc, As]
        }, t.prototype.getClass = function () {
            return t
        }, t.centreX = function (e) {
            return t.avg(e.getMinX(), e.getMaxX())
        }, t.avg = function (e, t) {
            return (e + t) / 2
        }, t.centreY = function (e) {
            return t.avg(e.getMinY(), e.getMaxY())
        }, n.STRtreeNode.get = function () {
            return uh
        }, n.serialVersionUID.get = function () {
            return 0x39920f7d5f261e0
        }, n.xComparator.get = function () {
            return {
                interfaces_: function () {
                    return [xf]
                }, compare: function (n, r) {
                    return e.compareDoubles(t.centreX(n.getBounds()), t.centreX(r.getBounds()))
                }
            }
        }, n.yComparator.get = function () {
            return {
                interfaces_: function () {
                    return [xf]
                }, compare: function (n, r) {
                    return e.compareDoubles(t.centreY(n.getBounds()), t.centreY(r.getBounds()))
                }
            }
        }, n.intersectsOp.get = function () {
            return {
                interfaces_: function () {
                    return [e.IntersectsOp]
                }, intersects: function (e, t) {
                    return e.intersects(t)
                }
            }
        }, n.DEFAULT_NODE_CAPACITY.get = function () {
            return 10
        }, Object.defineProperties(t, n), t
    }(nh), uh = function (e) {
        function t() {
            var t = arguments[0];
            e.call(this, t)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.computeBounds = function () {
            for (var e = null, t = this.getChildBoundables().iterator(); t.hasNext();) {
                var n = t.next();
                null === e ? e = new Vf(n.getBounds()) : e.expandToInclude(n.getBounds())
            }
            return e
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Yc), ah = function () {
    };
    ah.prototype.interfaces_ = function () {
        return []
    }, ah.prototype.getClass = function () {
        return ah
    }, ah.relativeSign = function (e, t) {
        return e < t ? -1 : e > t ? 1 : 0
    }, ah.compare = function (e, t, n) {
        if (t.equals2D(n)) return 0;
        var r = ah.relativeSign(t.x, n.x), i = ah.relativeSign(t.y, n.y);
        switch (e) {
            case 0:
                return ah.compareValue(r, i);
            case 1:
                return ah.compareValue(i, r);
            case 2:
                return ah.compareValue(i, -r);
            case 3:
                return ah.compareValue(-r, i);
            case 4:
                return ah.compareValue(-r, -i);
            case 5:
                return ah.compareValue(-i, -r);
            case 6:
                return ah.compareValue(-i, r);
            case 7:
                return ah.compareValue(r, -i)
        }
        return tl.shouldNeverReachHere("invalid octant value"), 0
    }, ah.compareValue = function (e, t) {
        return e < 0 ? -1 : e > 0 ? 1 : t < 0 ? -1 : t > 0 ? 1 : 0
    };
    var fh = function () {
        this._segString = null, this.coord = null, this.segmentIndex = null, this._segmentOctant = null, this._isInterior = null;
        var e = arguments[0], t = arguments[1], n = arguments[2], r = arguments[3];
        this._segString = e, this.coord = new Tf(t), this.segmentIndex = n, this._segmentOctant = r, this._isInterior = !t.equals2D(e.getCoordinate(n))
    };
    fh.prototype.getCoordinate = function () {
        return this.coord
    }, fh.prototype.print = function (e) {
        e.print(this.coord), e.print(" seg # = " + this.segmentIndex)
    }, fh.prototype.compareTo = function (e) {
        var t = e;
        return this.segmentIndex < t.segmentIndex ? -1 : this.segmentIndex > t.segmentIndex ? 1 : this.coord.equals2D(t.coord) ? 0 : ah.compare(this._segmentOctant, this.coord, t.coord)
    }, fh.prototype.isEndPoint = function (e) {
        return 0 === this.segmentIndex && !this._isInterior || this.segmentIndex === e
    }, fh.prototype.isInterior = function () {
        return this._isInterior
    }, fh.prototype.interfaces_ = function () {
        return [Ef]
    }, fh.prototype.getClass = function () {
        return fh
    };
    var lh = function () {
        this._nodeMap = new Fs, this._edge = null;
        var e = arguments[0];
        this._edge = e
    };
    lh.prototype.getSplitCoordinates = function () {
        var e = new Cl;
        this.addEndpoints();
        for (var t = this.iterator(), n = t.next(); t.hasNext();) {
            var r = t.next();
            this.addEdgeCoordinates(n, r, e), n = r
        }
        return e.toCoordinateArray()
    }, lh.prototype.addCollapsedNodes = function () {
        var e = new Tl;
        this.findCollapsesFromInsertedNodes(e), this.findCollapsesFromExistingVertices(e);
        for (var t = e.iterator(); t.hasNext();) {
            var n = t.next().intValue();
            this.add(this._edge.getCoordinate(n), n)
        }
    }, lh.prototype.print = function (e) {
        e.println("Intersections:");
        for (var t = this.iterator(); t.hasNext();) t.next().print(e)
    }, lh.prototype.findCollapsesFromExistingVertices = function (e) {
        for (var t = 0; t < this._edge.size() - 2; t++) {
            var n = this._edge.getCoordinate(t), r = this._edge.getCoordinate(t + 2);
            n.equals2D(r) && e.add(new Pf(t + 1))
        }
    }, lh.prototype.addEdgeCoordinates = function (e, t, n) {
        var r = this._edge.getCoordinate(t.segmentIndex), i = t.isInterior() || !t.coord.equals2D(r);
        n.add(new Tf(e.coord), !1);
        for (var s = e.segmentIndex + 1; s <= t.segmentIndex; s++) n.add(this._edge.getCoordinate(s));
        i && n.add(new Tf(t.coord))
    }, lh.prototype.iterator = function () {
        return this._nodeMap.values().iterator()
    }, lh.prototype.addSplitEdges = function (e) {
        this.addEndpoints(), this.addCollapsedNodes();
        for (var t = this.iterator(), n = t.next(); t.hasNext();) {
            var r = t.next(), i = this.createSplitEdge(n, r);
            e.add(i), n = r
        }
    }, lh.prototype.findCollapseIndex = function (e, t, n) {
        if (!e.coord.equals2D(t.coord)) return !1;
        var r = t.segmentIndex - e.segmentIndex;
        return t.isInterior() || r--, 1 === r && (n[0] = e.segmentIndex + 1, !0)
    }, lh.prototype.findCollapsesFromInsertedNodes = function (e) {
        for (var t = (new Array(1)).fill(null), n = this.iterator(), r = n.next(); n.hasNext();) {
            var i = n.next();
            this.findCollapseIndex(r, i, t) && e.add(new Pf(t[0])), r = i
        }
    }, lh.prototype.getEdge = function () {
        return this._edge
    }, lh.prototype.addEndpoints = function () {
        var e = this._edge.size() - 1;
        this.add(this._edge.getCoordinate(0), 0), this.add(this._edge.getCoordinate(e), e)
    }, lh.prototype.createSplitEdge = function (e, t) {
        var n = t.segmentIndex - e.segmentIndex + 2, r = this._edge.getCoordinate(t.segmentIndex),
            i = t.isInterior() || !t.coord.equals2D(r);
        i || n--;
        var s = (new Array(n)).fill(null), o = 0;
        s[o++] = new Tf(e.coord);
        for (var u = e.segmentIndex + 1; u <= t.segmentIndex; u++) s[o++] = this._edge.getCoordinate(u);
        return i && (s[o] = new Tf(t.coord)), new dh(s, this._edge.getData())
    }, lh.prototype.add = function (e, t) {
        var n = new fh(this._edge, e, t, this._edge.getSegmentOctant(t)), r = this._nodeMap.get(n);
        return null !== r ? (tl.isTrue(r.coord.equals2D(e), "Found equal nodes with different coordinates"), r) : (this._nodeMap.put(n, n), n)
    }, lh.prototype.checkSplitEdgesCorrectness = function (e) {
        var t = this._edge.getCoordinates(), n = e.get(0).getCoordinate(0);
        if (!n.equals2D(t[0])) throw new Zf("bad split edge start point at " + n);
        var r = e.get(e.size() - 1).getCoordinates(), i = r[r.length - 1];
        if (!i.equals2D(t[t.length - 1])) throw new Zf("bad split edge end point at " + i)
    }, lh.prototype.interfaces_ = function () {
        return []
    }, lh.prototype.getClass = function () {
        return lh
    };
    var ch = function () {
    };
    ch.prototype.interfaces_ = function () {
        return []
    }, ch.prototype.getClass = function () {
        return ch
    }, ch.octant = function () {
        if ("number" == typeof arguments[0] && "number" == typeof arguments[1]) {
            var e = arguments[0], t = arguments[1];
            if (0 === e && 0 === t) throw new yf("Cannot compute the octant for point ( " + e + ", " + t + " )");
            var n = Math.abs(e), r = Math.abs(t);
            return e >= 0 ? t >= 0 ? n >= r ? 0 : 1 : n >= r ? 7 : 6 : t >= 0 ? n >= r ? 3 : 2 : n >= r ? 4 : 5
        }
        if (arguments[0] instanceof Tf && arguments[1] instanceof Tf) {
            var i = arguments[0], s = arguments[1], o = s.x - i.x, u = s.y - i.y;
            if (0 === o && 0 === u) throw new yf("Cannot compute the octant for two identical points " + i);
            return ch.octant(o, u)
        }
    };
    var hh = function () {
    };
    hh.prototype.getCoordinates = function () {
    }, hh.prototype.size = function () {
    }, hh.prototype.getCoordinate = function (e) {
    }, hh.prototype.isClosed = function () {
    }, hh.prototype.setData = function (e) {
    }, hh.prototype.getData = function () {
    }, hh.prototype.interfaces_ = function () {
        return []
    }, hh.prototype.getClass = function () {
        return hh
    };
    var ph = function () {
    };
    ph.prototype.addIntersection = function (e, t) {
    }, ph.prototype.interfaces_ = function () {
        return [hh]
    }, ph.prototype.getClass = function () {
        return ph
    };
    var dh = function () {
        this._nodeList = new lh(this), this._pts = null, this._data = null;
        var e = arguments[0], t = arguments[1];
        this._pts = e, this._data = t
    };
    dh.prototype.getCoordinates = function () {
        return this._pts
    }, dh.prototype.size = function () {
        return this._pts.length
    }, dh.prototype.getCoordinate = function (e) {
        return this._pts[e]
    }, dh.prototype.isClosed = function () {
        return this._pts[0].equals(this._pts[this._pts.length - 1])
    }, dh.prototype.getSegmentOctant = function (e) {
        return e === this._pts.length - 1 ? -1 : this.safeOctant(this.getCoordinate(e), this.getCoordinate(e + 1))
    }, dh.prototype.setData = function (e) {
        this._data = e
    }, dh.prototype.safeOctant = function (e, t) {
        return e.equals2D(t) ? 0 : ch.octant(e, t)
    }, dh.prototype.getData = function () {
        return this._data
    }, dh.prototype.addIntersection = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            this.addIntersectionNode(e, t)
        } else if (4 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[3], s = new Tf(n.getIntersection(i));
            this.addIntersection(s, r)
        }
    }, dh.prototype.toString = function () {
        return Yf.toLineString(new fc(this._pts))
    }, dh.prototype.getNodeList = function () {
        return this._nodeList
    }, dh.prototype.addIntersectionNode = function (e, t) {
        var n = t, r = n + 1;
        if (r < this._pts.length) {
            var i = this._pts[r];
            e.equals2D(i) && (n = r)
        }
        return this._nodeList.add(e, n)
    }, dh.prototype.addIntersections = function (e, t, n) {
        for (var r = 0; r < e.getIntersectionNum(); r++) this.addIntersection(e, t, n, r)
    }, dh.prototype.interfaces_ = function () {
        return [ph]
    }, dh.prototype.getClass = function () {
        return dh
    }, dh.getNodedSubstrings = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = new Tl;
            return dh.getNodedSubstrings(e, t), t
        }
        if (2 === arguments.length) for (var n = arguments[0], r = arguments[1], i = n.iterator(); i.hasNext();) i.next().getNodeList().addSplitEdges(r)
    };
    var vh = function () {
        if (this.p0 = null, this.p1 = null, 0 === arguments.length) this.p0 = new Tf, this.p1 = new Tf; else if (1 === arguments.length) {
            var e = arguments[0];
            this.p0 = new Tf(e.p0), this.p1 = new Tf(e.p1)
        } else if (2 === arguments.length) this.p0 = arguments[0], this.p1 = arguments[1]; else if (4 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = arguments[2], i = arguments[3];
            this.p0 = new Tf(t, n), this.p1 = new Tf(r, i)
        }
    }, mh = {serialVersionUID: {configurable: !0}};
    vh.prototype.minX = function () {
        return Math.min(this.p0.x, this.p1.x)
    }, vh.prototype.orientationIndex = function () {
        if (arguments[0] instanceof vh) {
            var e = arguments[0], t = ul.orientationIndex(this.p0, this.p1, e.p0),
                n = ul.orientationIndex(this.p0, this.p1, e.p1);
            return t >= 0 && n >= 0 ? Math.max(t, n) : t <= 0 && n <= 0 ? Math.max(t, n) : 0
        }
        if (arguments[0] instanceof Tf) {
            var r = arguments[0];
            return ul.orientationIndex(this.p0, this.p1, r)
        }
    }, vh.prototype.toGeometry = function (e) {
        return e.createLineString([this.p0, this.p1])
    }, vh.prototype.isVertical = function () {
        return this.p0.x === this.p1.x
    }, vh.prototype.equals = function (e) {
        if (e instanceof vh) {
            var t = e;
            return this.p0.equals(t.p0) && this.p1.equals(t.p1)
        }
        return !1
    }, vh.prototype.intersection = function (e) {
        var t = new il;
        return t.computeIntersection(this.p0, this.p1, e.p0, e.p1), t.hasIntersection() ? t.getIntersection(0) : null
    }, vh.prototype.project = function () {
        if (arguments[0] instanceof Tf) {
            var e = arguments[0];
            if (e.equals(this.p0) || e.equals(this.p1)) return new Tf(e);
            var t = this.projectionFactor(e), n = new Tf;
            return n.x = this.p0.x + t * (this.p1.x - this.p0.x), n.y = this.p0.y + t * (this.p1.y - this.p0.y), n
        }
        if (arguments[0] instanceof vh) {
            var r = arguments[0], i = this.projectionFactor(r.p0), s = this.projectionFactor(r.p1);
            if (i >= 1 && s >= 1) return null;
            if (i <= 0 && s <= 0) return null;
            var o = this.project(r.p0);
            i < 0 && (o = this.p0), i > 1 && (o = this.p1);
            var u = this.project(r.p1);
            return s < 0 && (u = this.p0), s > 1 && (u = this.p1), new vh(o, u)
        }
    }, vh.prototype.normalize = function () {
        this.p1.compareTo(this.p0) < 0 && this.reverse()
    }, vh.prototype.angle = function () {
        return Math.atan2(this.p1.y - this.p0.y, this.p1.x - this.p0.x)
    }, vh.prototype.getCoordinate = function (e) {
        return 0 === e ? this.p0 : this.p1
    }, vh.prototype.distancePerpendicular = function (e) {
        return ul.distancePointLinePerpendicular(e, this.p0, this.p1)
    }, vh.prototype.minY = function () {
        return Math.min(this.p0.y, this.p1.y)
    }, vh.prototype.midPoint = function () {
        return vh.midPoint(this.p0, this.p1)
    }, vh.prototype.projectionFactor = function (e) {
        if (e.equals(this.p0)) return 0;
        if (e.equals(this.p1)) return 1;
        var t = this.p1.x - this.p0.x, n = this.p1.y - this.p0.y, r = t * t + n * n;
        return r <= 0 ? bf.NaN : ((e.x - this.p0.x) * t + (e.y - this.p0.y) * n) / r
    }, vh.prototype.closestPoints = function (e) {
        var t = this.intersection(e);
        if (null !== t) return [t, t];
        var n = (new Array(2)).fill(null), r = bf.MAX_VALUE, i = null, s = this.closestPoint(e.p0);
        r = s.distance(e.p0), n[0] = s, n[1] = e.p0;
        var o = this.closestPoint(e.p1);
        (i = o.distance(e.p1)) < r && (r = i, n[0] = o, n[1] = e.p1);
        var u = e.closestPoint(this.p0);
        (i = u.distance(this.p0)) < r && (r = i, n[0] = this.p0, n[1] = u);
        var a = e.closestPoint(this.p1);
        return (i = a.distance(this.p1)) < r && (r = i, n[0] = this.p1, n[1] = a), n
    }, vh.prototype.closestPoint = function (e) {
        var t = this.projectionFactor(e);
        return t > 0 && t < 1 ? this.project(e) : this.p0.distance(e) < this.p1.distance(e) ? this.p0 : this.p1
    }, vh.prototype.maxX = function () {
        return Math.max(this.p0.x, this.p1.x)
    }, vh.prototype.getLength = function () {
        return this.p0.distance(this.p1)
    }, vh.prototype.compareTo = function (e) {
        var t = e, n = this.p0.compareTo(t.p0);
        return 0 !== n ? n : this.p1.compareTo(t.p1)
    }, vh.prototype.reverse = function () {
        var e = this.p0;
        this.p0 = this.p1, this.p1 = e
    }, vh.prototype.equalsTopo = function (e) {
        return this.p0.equals(e.p0) && (this.p1.equals(e.p1) || this.p0.equals(e.p1)) && this.p1.equals(e.p0)
    }, vh.prototype.lineIntersection = function (e) {
        try {
            return Xf.intersection(this.p0, this.p1, e.p0, e.p1)
        } catch (e) {
            if (!(e instanceof zf)) throw e
        }
        return null
    }, vh.prototype.maxY = function () {
        return Math.max(this.p0.y, this.p1.y)
    }, vh.prototype.pointAlongOffset = function (e, t) {
        var n = this.p0.x + e * (this.p1.x - this.p0.x), r = this.p0.y + e * (this.p1.y - this.p0.y),
            i = this.p1.x - this.p0.x, s = this.p1.y - this.p0.y, o = Math.sqrt(i * i + s * s), u = 0, a = 0;
        if (0 !== t) {
            if (o <= 0) throw new Error("Cannot compute offset from zero-length line segment");
            u = t * i / o, a = t * s / o
        }
        return new Tf(n - a, r + u)
    }, vh.prototype.setCoordinates = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.setCoordinates(e.p0, e.p1)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            this.p0.x = t.x, this.p0.y = t.y, this.p1.x = n.x, this.p1.y = n.y
        }
    }, vh.prototype.segmentFraction = function (e) {
        var t = this.projectionFactor(e);
        return t < 0 ? t = 0 : (t > 1 || bf.isNaN(t)) && (t = 1), t
    }, vh.prototype.toString = function () {
        return "LINESTRING( " + this.p0.x + " " + this.p0.y + ", " + this.p1.x + " " + this.p1.y + ")"
    }, vh.prototype.isHorizontal = function () {
        return this.p0.y === this.p1.y
    }, vh.prototype.distance = function () {
        if (arguments[0] instanceof vh) {
            var e = arguments[0];
            return ul.distanceLineLine(this.p0, this.p1, e.p0, e.p1)
        }
        if (arguments[0] instanceof Tf) {
            var t = arguments[0];
            return ul.distancePointLine(t, this.p0, this.p1)
        }
    }, vh.prototype.pointAlong = function (e) {
        var t = new Tf;
        return t.x = this.p0.x + e * (this.p1.x - this.p0.x), t.y = this.p0.y + e * (this.p1.y - this.p0.y), t
    }, vh.prototype.hashCode = function () {
        var e = bf.doubleToLongBits(this.p0.x);
        e ^= 31 * bf.doubleToLongBits(this.p0.y);
        var t = Math.trunc(e) ^ Math.trunc(e >> 32), n = bf.doubleToLongBits(this.p1.x);
        return n ^= 31 * bf.doubleToLongBits(this.p1.y), t ^ (Math.trunc(n) ^ Math.trunc(n >> 32))
    }, vh.prototype.interfaces_ = function () {
        return [Ef, As]
    }, vh.prototype.getClass = function () {
        return vh
    }, vh.midPoint = function (e, t) {
        return new Tf((e.x + t.x) / 2, (e.y + t.y) / 2)
    }, mh.serialVersionUID.get = function () {
        return 0x2d2172135f411c00
    }, Object.defineProperties(vh, mh);
    var gh = function () {
        this.tempEnv1 = new Vf, this.tempEnv2 = new Vf, this._overlapSeg1 = new vh, this._overlapSeg2 = new vh
    };
    gh.prototype.overlap = function () {
        if (2 !== arguments.length && 4 === arguments.length) {
            var e = arguments[0], t = arguments[1], n = arguments[2], r = arguments[3];
            e.getLineSegment(t, this._overlapSeg1), n.getLineSegment(r, this._overlapSeg2), this.overlap(this._overlapSeg1, this._overlapSeg2)
        }
    }, gh.prototype.interfaces_ = function () {
        return []
    }, gh.prototype.getClass = function () {
        return gh
    };
    var yh = function () {
        this._pts = null, this._start = null, this._end = null, this._env = null, this._context = null, this._id = null;
        var e = arguments[0], t = arguments[1], n = arguments[2], r = arguments[3];
        this._pts = e, this._start = t, this._end = n, this._context = r
    };
    yh.prototype.getLineSegment = function (e, t) {
        t.p0 = this._pts[e], t.p1 = this._pts[e + 1]
    }, yh.prototype.computeSelect = function (e, t, n, r) {
        var i = this._pts[t], s = this._pts[n];
        if (r.tempEnv1.init(i, s), n - t == 1) return r.select(this, t), null;
        if (!e.intersects(r.tempEnv1)) return null;
        var o = Math.trunc((t + n) / 2);
        t < o && this.computeSelect(e, t, o, r), o < n && this.computeSelect(e, o, n, r)
    }, yh.prototype.getCoordinates = function () {
        for (var e = (new Array(this._end - this._start + 1)).fill(null), t = 0, n = this._start; n <= this._end; n++) e[t++] = this._pts[n];
        return e
    }, yh.prototype.computeOverlaps = function (e, t) {
        this.computeOverlapsInternal(this._start, this._end, e, e._start, e._end, t)
    }, yh.prototype.setId = function (e) {
        this._id = e
    }, yh.prototype.select = function (e, t) {
        this.computeSelect(e, this._start, this._end, t)
    }, yh.prototype.getEnvelope = function () {
        if (null === this._env) {
            var e = this._pts[this._start], t = this._pts[this._end];
            this._env = new Vf(e, t)
        }
        return this._env
    }, yh.prototype.getEndIndex = function () {
        return this._end
    }, yh.prototype.getStartIndex = function () {
        return this._start
    }, yh.prototype.getContext = function () {
        return this._context
    }, yh.prototype.getId = function () {
        return this._id
    }, yh.prototype.computeOverlapsInternal = function (e, t, n, r, i, s) {
        var o = this._pts[e], u = this._pts[t], a = n._pts[r], f = n._pts[i];
        if (t - e == 1 && i - r == 1) return s.overlap(this, e, n, r), null;
        if (s.tempEnv1.init(o, u), s.tempEnv2.init(a, f), !s.tempEnv1.intersects(s.tempEnv2)) return null;
        var l = Math.trunc((e + t) / 2), c = Math.trunc((r + i) / 2);
        e < l && (r < c && this.computeOverlapsInternal(e, l, n, r, c, s), c < i && this.computeOverlapsInternal(e, l, n, c, i, s)), l < t && (r < c && this.computeOverlapsInternal(l, t, n, r, c, s), c < i && this.computeOverlapsInternal(l, t, n, c, i, s))
    }, yh.prototype.interfaces_ = function () {
        return []
    }, yh.prototype.getClass = function () {
        return yh
    };
    var bh = function () {
    };
    bh.prototype.interfaces_ = function () {
        return []
    }, bh.prototype.getClass = function () {
        return bh
    }, bh.getChainStartIndices = function (e) {
        var t = 0, n = new Tl;
        n.add(new Pf(t));
        do {
            var r = bh.findChainEnd(e, t);
            n.add(new Pf(r)), t = r
        } while (t < e.length - 1);
        return bh.toIntArray(n)
    }, bh.findChainEnd = function (e, t) {
        for (var n = t; n < e.length - 1 && e[n].equals2D(e[n + 1]);) n++;
        if (n >= e.length - 1) return e.length - 1;
        for (var r = qc.quadrant(e[n], e[n + 1]), i = t + 1; i < e.length;) {
            if (!e[i - 1].equals2D(e[i]) && qc.quadrant(e[i - 1], e[i]) !== r) break;
            i++
        }
        return i - 1
    }, bh.getChains = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return bh.getChains(e, null)
        }
        if (2 === arguments.length) {
            for (var t = arguments[0], n = arguments[1], r = new Tl, i = bh.getChainStartIndices(t), s = 0; s < i.length - 1; s++) {
                var o = new yh(t, i[s], i[s + 1], n);
                r.add(o)
            }
            return r
        }
    }, bh.toIntArray = function (e) {
        for (var t = (new Array(e.size())).fill(null), n = 0; n < t.length; n++) t[n] = e.get(n).intValue();
        return t
    };
    var wh = function () {
    };
    wh.prototype.computeNodes = function (e) {
    }, wh.prototype.getNodedSubstrings = function () {
    }, wh.prototype.interfaces_ = function () {
        return []
    }, wh.prototype.getClass = function () {
        return wh
    };
    var Eh = function () {
        if (this._segInt = null, 0 !== arguments.length) if (1 === arguments.length) {
            var e = arguments[0];
            this.setSegmentIntersector(e)
        }
    };
    Eh.prototype.setSegmentIntersector = function (e) {
        this._segInt = e
    }, Eh.prototype.interfaces_ = function () {
        return [wh]
    }, Eh.prototype.getClass = function () {
        return Eh
    };
    var Sh = function (e) {
        function t(t) {
            t ? e.call(this, t) : e.call(this), this._monoChains = new Tl, this._index = new oh, this._idCounter = 0, this._nodedSegStrings = null, this._nOverlaps = 0
        }

        e && (t.__proto__ = e), (t.prototype = Object.create(e && e.prototype)).constructor = t;
        var n = {SegmentOverlapAction: {configurable: !0}};
        return t.prototype.getMonotoneChains = function () {
            return this._monoChains
        }, t.prototype.getNodedSubstrings = function () {
            return dh.getNodedSubstrings(this._nodedSegStrings)
        }, t.prototype.getIndex = function () {
            return this._index
        }, t.prototype.add = function (e) {
            for (var t = bh.getChains(e.getCoordinates(), e).iterator(); t.hasNext();) {
                var n = t.next();
                n.setId(this._idCounter++), this._index.insert(n.getEnvelope(), n), this._monoChains.add(n)
            }
        }, t.prototype.computeNodes = function (e) {
            this._nodedSegStrings = e;
            for (var t = e.iterator(); t.hasNext();) this.add(t.next());
            this.intersectChains()
        }, t.prototype.intersectChains = function () {
            for (var e = new xh(this._segInt), t = this._monoChains.iterator(); t.hasNext();) for (var n = t.next(), r = this._index.query(n.getEnvelope()).iterator(); r.hasNext();) {
                var i = r.next();
                if (i.getId() > n.getId() && (n.computeOverlaps(i, e), this._nOverlaps++), this._segInt.isDone()) return null
            }
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, n.SegmentOverlapAction.get = function () {
            return xh
        }, Object.defineProperties(t, n), t
    }(Eh), xh = function (e) {
        function t() {
            e.call(this), this._si = null;
            var t = arguments[0];
            this._si = t
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.overlap = function () {
            if (4 !== arguments.length) return e.prototype.overlap.apply(this, arguments);
            var t = arguments[0], n = arguments[1], r = arguments[2], i = arguments[3], s = t.getContext(),
                o = r.getContext();
            this._si.processIntersections(s, n, o, i)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(gh), Th = function Iv() {
        if (this._quadrantSegments = Iv.DEFAULT_QUADRANT_SEGMENTS, this._endCapStyle = Iv.CAP_ROUND, this._joinStyle = Iv.JOIN_ROUND, this._mitreLimit = Iv.DEFAULT_MITRE_LIMIT, this._isSingleSided = !1, this._simplifyFactor = Iv.DEFAULT_SIMPLIFY_FACTOR, 0 !== arguments.length) if (1 === arguments.length) {
            var e = arguments[0];
            this.setQuadrantSegments(e)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            this.setQuadrantSegments(t), this.setEndCapStyle(n)
        } else if (4 === arguments.length) {
            var r = arguments[0], i = arguments[1], s = arguments[2], o = arguments[3];
            this.setQuadrantSegments(r), this.setEndCapStyle(i), this.setJoinStyle(s), this.setMitreLimit(o)
        }
    }, Nh = {
        CAP_ROUND: {configurable: !0},
        CAP_FLAT: {configurable: !0},
        CAP_SQUARE: {configurable: !0},
        JOIN_ROUND: {configurable: !0},
        JOIN_MITRE: {configurable: !0},
        JOIN_BEVEL: {configurable: !0},
        DEFAULT_QUADRANT_SEGMENTS: {configurable: !0},
        DEFAULT_MITRE_LIMIT: {configurable: !0},
        DEFAULT_SIMPLIFY_FACTOR: {configurable: !0}
    };
    Th.prototype.getEndCapStyle = function () {
        return this._endCapStyle
    }, Th.prototype.isSingleSided = function () {
        return this._isSingleSided
    }, Th.prototype.setQuadrantSegments = function (e) {
        this._quadrantSegments = e, 0 === this._quadrantSegments && (this._joinStyle = Th.JOIN_BEVEL), this._quadrantSegments < 0 && (this._joinStyle = Th.JOIN_MITRE, this._mitreLimit = Math.abs(this._quadrantSegments)), e <= 0 && (this._quadrantSegments = 1), this._joinStyle !== Th.JOIN_ROUND && (this._quadrantSegments = Th.DEFAULT_QUADRANT_SEGMENTS)
    }, Th.prototype.getJoinStyle = function () {
        return this._joinStyle
    }, Th.prototype.setJoinStyle = function (e) {
        this._joinStyle = e
    }, Th.prototype.setSimplifyFactor = function (e) {
        this._simplifyFactor = e < 0 ? 0 : e
    }, Th.prototype.getSimplifyFactor = function () {
        return this._simplifyFactor
    }, Th.prototype.getQuadrantSegments = function () {
        return this._quadrantSegments
    }, Th.prototype.setEndCapStyle = function (e) {
        this._endCapStyle = e
    }, Th.prototype.getMitreLimit = function () {
        return this._mitreLimit
    }, Th.prototype.setMitreLimit = function (e) {
        this._mitreLimit = e
    }, Th.prototype.setSingleSided = function (e) {
        this._isSingleSided = e
    }, Th.prototype.interfaces_ = function () {
        return []
    }, Th.prototype.getClass = function () {
        return Th
    }, Th.bufferDistanceError = function (e) {
        var t = Math.PI / 2 / e;
        return 1 - Math.cos(t / 2)
    }, Nh.CAP_ROUND.get = function () {
        return 1
    }, Nh.CAP_FLAT.get = function () {
        return 2
    }, Nh.CAP_SQUARE.get = function () {
        return 3
    }, Nh.JOIN_ROUND.get = function () {
        return 1
    }, Nh.JOIN_MITRE.get = function () {
        return 2
    }, Nh.JOIN_BEVEL.get = function () {
        return 3
    }, Nh.DEFAULT_QUADRANT_SEGMENTS.get = function () {
        return 8
    }, Nh.DEFAULT_MITRE_LIMIT.get = function () {
        return 5
    }, Nh.DEFAULT_SIMPLIFY_FACTOR.get = function () {
        return .01
    }, Object.defineProperties(Th, Nh);
    var Ch = function (e) {
        this._distanceTol = null, this._isDeleted = null, this._angleOrientation = ul.COUNTERCLOCKWISE, this._inputLine = e || null
    }, kh = {
        INIT: {configurable: !0},
        DELETE: {configurable: !0},
        KEEP: {configurable: !0},
        NUM_PTS_TO_CHECK: {configurable: !0}
    };
    Ch.prototype.isDeletable = function (e, t, n, r) {
        var i = this._inputLine[e], s = this._inputLine[t], o = this._inputLine[n];
        return !!this.isConcave(i, s, o) && !!this.isShallow(i, s, o, r) && this.isShallowSampled(i, s, e, n, r)
    }, Ch.prototype.deleteShallowConcavities = function () {
        for (var e = 1, t = this.findNextNonDeletedIndex(e), n = this.findNextNonDeletedIndex(t), r = !1; n < this._inputLine.length;) {
            var i = !1;
            this.isDeletable(e, t, n, this._distanceTol) && (this._isDeleted[t] = Ch.DELETE, i = !0, r = !0), e = i ? n : t, t = this.findNextNonDeletedIndex(e), n = this.findNextNonDeletedIndex(t)
        }
        return r
    }, Ch.prototype.isShallowConcavity = function (e, t, n, r) {
        return ul.computeOrientation(e, t, n) !== this._angleOrientation ? !1 : ul.distancePointLine(t, e, n) < r
    }, Ch.prototype.isShallowSampled = function (e, t, n, r, i) {
        var s = Math.trunc((r - n) / Ch.NUM_PTS_TO_CHECK);
        s <= 0 && (s = 1);
        for (var o = n; o < r; o += s) if (!this.isShallow(e, t, this._inputLine[o], i)) return !1;
        return !0
    }, Ch.prototype.isConcave = function (e, t, n) {
        var r = ul.computeOrientation(e, t, n) === this._angleOrientation;
        return r
    }, Ch.prototype.simplify = function (e) {
        this._distanceTol = Math.abs(e), e < 0 && (this._angleOrientation = ul.CLOCKWISE), this._isDeleted = (new Array(this._inputLine.length)).fill(null);
        var t = !1;
        do t = this.deleteShallowConcavities(); while (t);
        return this.collapseLine()
    }, Ch.prototype.findNextNonDeletedIndex = function (e) {
        for (var t = e + 1; t < this._inputLine.length && this._isDeleted[t] === Ch.DELETE;) t++;
        return t
    }, Ch.prototype.isShallow = function (e, t, n, r) {
        return ul.distancePointLine(t, e, n) < r
    }, Ch.prototype.collapseLine = function () {
        for (var e = new Cl, t = 0; t < this._inputLine.length; t++) this._isDeleted[t] !== Ch.DELETE && e.add(this._inputLine[t]);
        return e.toCoordinateArray()
    }, Ch.prototype.interfaces_ = function () {
        return []
    }, Ch.prototype.getClass = function () {
        return Ch
    }, Ch.simplify = function (e, t) {
        return (new Ch(e)).simplify(t)
    }, kh.INIT.get = function () {
        return 0
    }, kh.DELETE.get = function () {
        return 1
    }, kh.KEEP.get = function () {
        return 1
    }, kh.NUM_PTS_TO_CHECK.get = function () {
        return 10
    }, Object.defineProperties(Ch, kh);
    var Lh = function () {
        this._ptList = null, this._precisionModel = null, this._minimimVertexDistance = 0, this._ptList = new Tl
    }, Ah = {COORDINATE_ARRAY_TYPE: {configurable: !0}};
    Lh.prototype.getCoordinates = function () {
        return this._ptList.toArray(Lh.COORDINATE_ARRAY_TYPE)
    }, Lh.prototype.setPrecisionModel = function (e) {
        this._precisionModel = e
    }, Lh.prototype.addPt = function (e) {
        var t = new Tf(e);
        if (this._precisionModel.makePrecise(t), this.isRedundant(t)) return null;
        this._ptList.add(t)
    }, Lh.prototype.revere = function () {
    }, Lh.prototype.addPts = function (e, t) {
        if (t) for (var n = 0; n < e.length; n++) this.addPt(e[n]); else for (var r = e.length - 1; r >= 0; r--) this.addPt(e[r])
    }, Lh.prototype.isRedundant = function (e) {
        if (this._ptList.size() < 1) return !1;
        var t = this._ptList.get(this._ptList.size() - 1);
        return e.distance(t) < this._minimimVertexDistance
    }, Lh.prototype.toString = function () {
        return (new yc).createLineString(this.getCoordinates()).toString()
    }, Lh.prototype.closeRing = function () {
        if (this._ptList.size() < 1) return null;
        var e = new Tf(this._ptList.get(0)), t = this._ptList.get(this._ptList.size() - 1);
        if (e.equals(t)) return null;
        this._ptList.add(e)
    }, Lh.prototype.setMinimumVertexDistance = function (e) {
        this._minimimVertexDistance = e
    }, Lh.prototype.interfaces_ = function () {
        return []
    }, Lh.prototype.getClass = function () {
        return Lh
    }, Ah.COORDINATE_ARRAY_TYPE.get = function () {
        return (new Array(0)).fill(null)
    }, Object.defineProperties(Lh, Ah);
    var Oh = function () {
    }, Mh = {
        PI_TIMES_2: {configurable: !0},
        PI_OVER_2: {configurable: !0},
        PI_OVER_4: {configurable: !0},
        COUNTERCLOCKWISE: {configurable: !0},
        CLOCKWISE: {configurable: !0},
        NONE: {configurable: !0}
    };
    Oh.prototype.interfaces_ = function () {
        return []
    }, Oh.prototype.getClass = function () {
        return Oh
    }, Oh.toDegrees = function (e) {
        return 180 * e / Math.PI
    }, Oh.normalize = function (e) {
        for (; e > Math.PI;) e -= Oh.PI_TIMES_2;
        for (; e <= -Math.PI;) e += Oh.PI_TIMES_2;
        return e
    }, Oh.angle = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return Math.atan2(e.y, e.x)
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = n.x - t.x, i = n.y - t.y;
            return Math.atan2(i, r)
        }
    }, Oh.isAcute = function (e, t, n) {
        var r = e.x - t.x, i = e.y - t.y;
        return r * (n.x - t.x) + i * (n.y - t.y) > 0
    }, Oh.isObtuse = function (e, t, n) {
        var r = e.x - t.x, i = e.y - t.y;
        return r * (n.x - t.x) + i * (n.y - t.y) < 0
    }, Oh.interiorAngle = function (e, t, n) {
        var r = Oh.angle(t, e), i = Oh.angle(t, n);
        return Math.abs(i - r)
    }, Oh.normalizePositive = function (e) {
        if (e < 0) {
            for (; e < 0;) e += Oh.PI_TIMES_2;
            e >= Oh.PI_TIMES_2 && (e = 0)
        } else {
            for (; e >= Oh.PI_TIMES_2;) e -= Oh.PI_TIMES_2;
            e < 0 && (e = 0)
        }
        return e
    }, Oh.angleBetween = function (e, t, n) {
        var r = Oh.angle(t, e), i = Oh.angle(t, n);
        return Oh.diff(r, i)
    }, Oh.diff = function (e, t) {
        var n = null;
        return (n = e < t ? t - e : e - t) > Math.PI && (n = 2 * Math.PI - n), n
    }, Oh.toRadians = function (e) {
        return e * Math.PI / 180
    }, Oh.getTurn = function (e, t) {
        var n = Math.sin(t - e);
        return n > 0 ? Oh.COUNTERCLOCKWISE : n < 0 ? Oh.CLOCKWISE : Oh.NONE
    }, Oh.angleBetweenOriented = function (e, t, n) {
        var r = Oh.angle(t, e), i = Oh.angle(t, n) - r;
        return i <= -Math.PI ? i + Oh.PI_TIMES_2 : i > Math.PI ? i - Oh.PI_TIMES_2 : i
    }, Mh.PI_TIMES_2.get = function () {
        return 2 * Math.PI
    }, Mh.PI_OVER_2.get = function () {
        return Math.PI / 2
    }, Mh.PI_OVER_4.get = function () {
        return Math.PI / 4
    }, Mh.COUNTERCLOCKWISE.get = function () {
        return ul.COUNTERCLOCKWISE
    }, Mh.CLOCKWISE.get = function () {
        return ul.CLOCKWISE
    }, Mh.NONE.get = function () {
        return ul.COLLINEAR
    }, Object.defineProperties(Oh, Mh);
    var _h = function qv() {
        this._maxCurveSegmentError = 0, this._filletAngleQuantum = null, this._closingSegLengthFactor = 1, this._segList = null, this._distance = 0, this._precisionModel = null, this._bufParams = null, this._li = null, this._s0 = null, this._s1 = null, this._s2 = null, this._seg0 = new vh, this._seg1 = new vh, this._offset0 = new vh, this._offset1 = new vh, this._side = 0, this._hasNarrowConcaveAngle = !1;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        this._precisionModel = e, this._bufParams = t, this._li = new il, this._filletAngleQuantum = Math.PI / 2 / t.getQuadrantSegments(), t.getQuadrantSegments() >= 8 && t.getJoinStyle() === Th.JOIN_ROUND && (this._closingSegLengthFactor = qv.MAX_CLOSING_SEG_LEN_FACTOR), this.init(n)
    }, Dh = {
        OFFSET_SEGMENT_SEPARATION_FACTOR: {configurable: !0},
        INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR: {configurable: !0},
        CURVE_VERTEX_SNAP_DISTANCE_FACTOR: {configurable: !0},
        MAX_CLOSING_SEG_LEN_FACTOR: {configurable: !0}
    };
    _h.prototype.addNextSegment = function (e, t) {
        if (this._s0 = this._s1, this._s1 = this._s2, this._s2 = e, this._seg0.setCoordinates(this._s0, this._s1), this.computeOffsetSegment(this._seg0, this._side, this._distance, this._offset0), this._seg1.setCoordinates(this._s1, this._s2), this.computeOffsetSegment(this._seg1, this._side, this._distance, this._offset1), this._s1.equals(this._s2)) return null;
        var n = ul.computeOrientation(this._s0, this._s1, this._s2),
            r = n === ul.CLOCKWISE && this._side === Cc.LEFT || n === ul.COUNTERCLOCKWISE && this._side === Cc.RIGHT;
        0 === n ? this.addCollinear(t) : r ? this.addOutsideTurn(n, t) : this.addInsideTurn(n, t)
    }, _h.prototype.addLineEndCap = function (e, t) {
        var n = new vh(e, t), r = new vh;
        this.computeOffsetSegment(n, Cc.LEFT, this._distance, r);
        var i = new vh;
        this.computeOffsetSegment(n, Cc.RIGHT, this._distance, i);
        var s = t.x - e.x, o = t.y - e.y, u = Math.atan2(o, s);
        switch (this._bufParams.getEndCapStyle()) {
            case Th.CAP_ROUND:
                this._segList.addPt(r.p1), this.addFilletArc(t, u + Math.PI / 2, u - Math.PI / 2, ul.CLOCKWISE, this._distance), this._segList.addPt(i.p1);
                break;
            case Th.CAP_FLAT:
                this._segList.addPt(r.p1), this._segList.addPt(i.p1);
                break;
            case Th.CAP_SQUARE:
                var a = new Tf;
                a.x = Math.abs(this._distance) * Math.cos(u), a.y = Math.abs(this._distance) * Math.sin(u);
                var f = new Tf(r.p1.x + a.x, r.p1.y + a.y), l = new Tf(i.p1.x + a.x, i.p1.y + a.y);
                this._segList.addPt(f), this._segList.addPt(l)
        }
    }, _h.prototype.getCoordinates = function () {
        return this._segList.getCoordinates()
    }, _h.prototype.addMitreJoin = function (e, t, n, r) {
        var i = !0, s = null;
        try {
            s = Xf.intersection(t.p0, t.p1, n.p0, n.p1), (r <= 0 ? 1 : s.distance(e) / Math.abs(r)) > this._bufParams.getMitreLimit() && (i = !1)
        } catch (e) {
            if (!(e instanceof zf)) throw e;
            s = new Tf(0, 0), i = !1
        }
        i ? this._segList.addPt(s) : this.addLimitedMitreJoin(t, n, r, this._bufParams.getMitreLimit())
    }, _h.prototype.addFilletCorner = function (e, t, n, r, i) {
        var s = t.x - e.x, o = t.y - e.y, u = Math.atan2(o, s), a = n.x - e.x, f = n.y - e.y, l = Math.atan2(f, a);
        r === ul.CLOCKWISE ? u <= l && (u += 2 * Math.PI) : u >= l && (u -= 2 * Math.PI), this._segList.addPt(t), this.addFilletArc(e, u, l, r, i), this._segList.addPt(n)
    }, _h.prototype.addOutsideTurn = function (e, t) {
        if (this._offset0.p1.distance(this._offset1.p0) < this._distance * _h.OFFSET_SEGMENT_SEPARATION_FACTOR) return this._segList.addPt(this._offset0.p1), null;
        this._bufParams.getJoinStyle() === Th.JOIN_MITRE ? this.addMitreJoin(this._s1, this._offset0, this._offset1, this._distance) : this._bufParams.getJoinStyle() === Th.JOIN_BEVEL ? this.addBevelJoin(this._offset0, this._offset1) : (t && this._segList.addPt(this._offset0.p1), this.addFilletCorner(this._s1, this._offset0.p1, this._offset1.p0, e, this._distance), this._segList.addPt(this._offset1.p0))
    }, _h.prototype.createSquare = function (e) {
        this._segList.addPt(new Tf(e.x + this._distance, e.y + this._distance)), this._segList.addPt(new Tf(e.x + this._distance, e.y - this._distance)), this._segList.addPt(new Tf(e.x - this._distance, e.y - this._distance)), this._segList.addPt(new Tf(e.x - this._distance, e.y + this._distance)), this._segList.closeRing()
    }, _h.prototype.addSegments = function (e, t) {
        this._segList.addPts(e, t)
    }, _h.prototype.addFirstSegment = function () {
        this._segList.addPt(this._offset1.p0)
    }, _h.prototype.addLastSegment = function () {
        this._segList.addPt(this._offset1.p1)
    }, _h.prototype.initSideSegments = function (e, t, n) {
        this._s1 = e, this._s2 = t, this._side = n, this._seg1.setCoordinates(e, t), this.computeOffsetSegment(this._seg1, n, this._distance, this._offset1)
    }, _h.prototype.addLimitedMitreJoin = function (e, t, n, r) {
        var i = this._seg0.p1, s = Oh.angle(i, this._seg0.p0),
            o = Oh.angleBetweenOriented(this._seg0.p0, i, this._seg1.p1) / 2, u = Oh.normalize(s + o),
            a = Oh.normalize(u + Math.PI), f = r * n, l = n - f * Math.abs(Math.sin(o)), c = i.x + f * Math.cos(a),
            h = i.y + f * Math.sin(a), p = new Tf(c, h), d = new vh(i, p), v = d.pointAlongOffset(1, l),
            m = d.pointAlongOffset(1, -l);
        this._side === Cc.LEFT ? (this._segList.addPt(v), this._segList.addPt(m)) : (this._segList.addPt(m), this._segList.addPt(v))
    }, _h.prototype.computeOffsetSegment = function (e, t, n, r) {
        var i = t === Cc.LEFT ? 1 : -1, s = e.p1.x - e.p0.x, o = e.p1.y - e.p0.y, u = Math.sqrt(s * s + o * o),
            a = i * n * s / u, f = i * n * o / u;
        r.p0.x = e.p0.x - f, r.p0.y = e.p0.y + a, r.p1.x = e.p1.x - f, r.p1.y = e.p1.y + a
    }, _h.prototype.addFilletArc = function (e, t, n, r, i) {
        var s = r === ul.CLOCKWISE ? -1 : 1, o = Math.abs(t - n), u = Math.trunc(o / this._filletAngleQuantum + .5);
        if (u < 1) return null;
        for (var a = o / u, f = 0, l = new Tf; f < o;) {
            var c = t + s * f;
            l.x = e.x + i * Math.cos(c), l.y = e.y + i * Math.sin(c), this._segList.addPt(l), f += a
        }
    }, _h.prototype.addInsideTurn = function (e, t) {
        if (this._li.computeIntersection(this._offset0.p0, this._offset0.p1, this._offset1.p0, this._offset1.p1), this._li.hasIntersection()) this._segList.addPt(this._li.getIntersection(0)); else if (this._hasNarrowConcaveAngle = !0, this._offset0.p1.distance(this._offset1.p0) < this._distance * _h.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR) this._segList.addPt(this._offset0.p1); else {
            if (this._segList.addPt(this._offset0.p1), this._closingSegLengthFactor > 0) {
                var n = new Tf((this._closingSegLengthFactor * this._offset0.p1.x + this._s1.x) / (this._closingSegLengthFactor + 1), (this._closingSegLengthFactor * this._offset0.p1.y + this._s1.y) / (this._closingSegLengthFactor + 1));
                this._segList.addPt(n);
                var r = new Tf((this._closingSegLengthFactor * this._offset1.p0.x + this._s1.x) / (this._closingSegLengthFactor + 1), (this._closingSegLengthFactor * this._offset1.p0.y + this._s1.y) / (this._closingSegLengthFactor + 1));
                this._segList.addPt(r)
            } else this._segList.addPt(this._s1);
            this._segList.addPt(this._offset1.p0)
        }
    }, _h.prototype.createCircle = function (e) {
        var t = new Tf(e.x + this._distance, e.y);
        this._segList.addPt(t), this.addFilletArc(e, 0, 2 * Math.PI, -1, this._distance), this._segList.closeRing()
    }, _h.prototype.addBevelJoin = function (e, t) {
        this._segList.addPt(e.p1), this._segList.addPt(t.p0)
    }, _h.prototype.init = function (e) {
        this._distance = e, this._maxCurveSegmentError = e * (1 - Math.cos(this._filletAngleQuantum / 2)), this._segList = new Lh, this._segList.setPrecisionModel(this._precisionModel), this._segList.setMinimumVertexDistance(e * _h.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)
    }, _h.prototype.addCollinear = function (e) {
        this._li.computeIntersection(this._s0, this._s1, this._s1, this._s2), this._li.getIntersectionNum() >= 2 && (this._bufParams.getJoinStyle() === Th.JOIN_BEVEL || this._bufParams.getJoinStyle() === Th.JOIN_MITRE ? (e && this._segList.addPt(this._offset0.p1), this._segList.addPt(this._offset1.p0)) : this.addFilletCorner(this._s1, this._offset0.p1, this._offset1.p0, ul.CLOCKWISE, this._distance))
    }, _h.prototype.closeRing = function () {
        this._segList.closeRing()
    }, _h.prototype.hasNarrowConcaveAngle = function () {
        return this._hasNarrowConcaveAngle
    }, _h.prototype.interfaces_ = function () {
        return []
    }, _h.prototype.getClass = function () {
        return _h
    }, Dh.OFFSET_SEGMENT_SEPARATION_FACTOR.get = function () {
        return .001
    }, Dh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get = function () {
        return .001
    }, Dh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get = function () {
        return 1e-6
    }, Dh.MAX_CLOSING_SEG_LEN_FACTOR.get = function () {
        return 80
    }, Object.defineProperties(_h, Dh);
    var Ph = function () {
        this._distance = 0, this._precisionModel = null, this._bufParams = null;
        var e = arguments[0], t = arguments[1];
        this._precisionModel = e, this._bufParams = t
    };
    Ph.prototype.getOffsetCurve = function (e, t) {
        if (this._distance = t, 0 === t) return null;
        var n = t < 0, r = Math.abs(t), i = this.getSegGen(r);
        e.length <= 1 ? this.computePointCurve(e[0], i) : this.computeOffsetCurve(e, n, i);
        var s = i.getCoordinates();
        return n && kl.reverse(s), s
    }, Ph.prototype.computeSingleSidedBufferCurve = function (e, t, n) {
        var r = this.simplifyTolerance(this._distance);
        if (t) {
            n.addSegments(e, !0);
            var i = Ch.simplify(e, -r), s = i.length - 1;
            n.initSideSegments(i[s], i[s - 1], Cc.LEFT), n.addFirstSegment();
            for (var o = s - 2; o >= 0; o--) n.addNextSegment(i[o], !0)
        } else {
            n.addSegments(e, !1);
            var u = Ch.simplify(e, r), a = u.length - 1;
            n.initSideSegments(u[0], u[1], Cc.LEFT), n.addFirstSegment();
            for (var f = 2; f <= a; f++) n.addNextSegment(u[f], !0)
        }
        n.addLastSegment(), n.closeRing()
    }, Ph.prototype.computeRingBufferCurve = function (e, t, n) {
        var r = this.simplifyTolerance(this._distance);
        t === Cc.RIGHT && (r = -r);
        var i = Ch.simplify(e, r), s = i.length - 1;
        n.initSideSegments(i[s - 1], i[0], t);
        for (var o = 1; o <= s; o++) {
            var u = 1 !== o;
            n.addNextSegment(i[o], u)
        }
        n.closeRing()
    }, Ph.prototype.computeLineBufferCurve = function (e, t) {
        var n = this.simplifyTolerance(this._distance), r = Ch.simplify(e, n), i = r.length - 1;
        t.initSideSegments(r[0], r[1], Cc.LEFT);
        for (var s = 2; s <= i; s++) t.addNextSegment(r[s], !0);
        t.addLastSegment(), t.addLineEndCap(r[i - 1], r[i]);
        var o = Ch.simplify(e, -n), u = o.length - 1;
        t.initSideSegments(o[u], o[u - 1], Cc.LEFT);
        for (var a = u - 2; a >= 0; a--) t.addNextSegment(o[a], !0);
        t.addLastSegment(), t.addLineEndCap(o[1], o[0]), t.closeRing()
    }, Ph.prototype.computePointCurve = function (e, t) {
        switch (this._bufParams.getEndCapStyle()) {
            case Th.CAP_ROUND:
                t.createCircle(e);
                break;
            case Th.CAP_SQUARE:
                t.createSquare(e)
        }
    }, Ph.prototype.getLineCurve = function (e, t) {
        if (this._distance = t, t < 0 && !this._bufParams.isSingleSided()) return null;
        if (0 === t) return null;
        var n = Math.abs(t), r = this.getSegGen(n);
        if (e.length <= 1) this.computePointCurve(e[0], r); else if (this._bufParams.isSingleSided()) {
            var i = t < 0;
            this.computeSingleSidedBufferCurve(e, i, r)
        } else this.computeLineBufferCurve(e, r);
        return r.getCoordinates()
    }, Ph.prototype.getBufferParameters = function () {
        return this._bufParams
    }, Ph.prototype.simplifyTolerance = function (e) {
        return e * this._bufParams.getSimplifyFactor()
    }, Ph.prototype.getRingCurve = function (e, t, n) {
        if (this._distance = n, e.length <= 2) return this.getLineCurve(e, n);
        if (0 === n) return Ph.copyCoordinates(e);
        var r = this.getSegGen(n);
        return this.computeRingBufferCurve(e, t, r), r.getCoordinates()
    }, Ph.prototype.computeOffsetCurve = function (e, t, n) {
        var r = this.simplifyTolerance(this._distance);
        if (t) {
            var i = Ch.simplify(e, -r), s = i.length - 1;
            n.initSideSegments(i[s], i[s - 1], Cc.LEFT), n.addFirstSegment();
            for (var o = s - 2; o >= 0; o--) n.addNextSegment(i[o], !0)
        } else {
            var u = Ch.simplify(e, r), a = u.length - 1;
            n.initSideSegments(u[0], u[1], Cc.LEFT), n.addFirstSegment();
            for (var f = 2; f <= a; f++) n.addNextSegment(u[f], !0)
        }
        n.addLastSegment()
    }, Ph.prototype.getSegGen = function (e) {
        return new _h(this._precisionModel, this._bufParams, e)
    }, Ph.prototype.interfaces_ = function () {
        return []
    }, Ph.prototype.getClass = function () {
        return Ph
    }, Ph.copyCoordinates = function (e) {
        for (var t = (new Array(e.length)).fill(null), n = 0; n < t.length; n++) t[n] = new Tf(e[n]);
        return t
    };
    var Hh = function () {
        this._subgraphs = null, this._seg = new vh, this._cga = new ul;
        var e = arguments[0];
        this._subgraphs = e
    }, Bh = {DepthSegment: {configurable: !0}};
    Hh.prototype.findStabbedSegments = function () {
        if (1 === arguments.length) {
            for (var e = arguments[0], t = new Tl, n = this._subgraphs.iterator(); n.hasNext();) {
                var r = n.next(), i = r.getEnvelope();
                e.y < i.getMinY() || e.y > i.getMaxY() || this.findStabbedSegments(e, r.getDirectedEdges(), t)
            }
            return t
        }
        if (3 === arguments.length) if (Of(arguments[2], xl) && arguments[0] instanceof Tf && arguments[1] instanceof zc) for (var s = arguments[0], o = arguments[1], u = arguments[2], a = o.getEdge().getCoordinates(), f = 0; f < a.length - 1; f++) {
            this._seg.p0 = a[f], this._seg.p1 = a[f + 1], this._seg.p0.y > this._seg.p1.y && this._seg.reverse();
            if (!(Math.max(this._seg.p0.x, this._seg.p1.x) < s.x) && !(this._seg.isHorizontal() || s.y < this._seg.p0.y || s.y > this._seg.p1.y || ul.computeOrientation(this._seg.p0, this._seg.p1, s) === ul.RIGHT)) {
                var l = o.getDepth(Cc.LEFT);
                this._seg.p0.equals(a[f]) || (l = o.getDepth(Cc.RIGHT));
                var c = new jh(this._seg, l);
                u.add(c)
            }
        } else if (Of(arguments[2], xl) && arguments[0] instanceof Tf && Of(arguments[1], xl)) for (var h = arguments[0], p = arguments[1], d = arguments[2], v = p.iterator(); v.hasNext();) {
            var m = v.next();
            m.isForward() && this.findStabbedSegments(h, m, d)
        }
    }, Hh.prototype.getDepth = function (e) {
        var t = this.findStabbedSegments(e);
        return 0 === t.size() ? 0 : eh.min(t)._leftDepth
    }, Hh.prototype.interfaces_ = function () {
        return []
    }, Hh.prototype.getClass = function () {
        return Hh
    }, Bh.DepthSegment.get = function () {
        return jh
    }, Object.defineProperties(Hh, Bh);
    var jh = function () {
        this._upwardSeg = null, this._leftDepth = null;
        var e = arguments[0], t = arguments[1];
        this._upwardSeg = new vh(e), this._leftDepth = t
    };
    jh.prototype.compareTo = function (e) {
        var t = e;
        if (this._upwardSeg.minX() >= t._upwardSeg.maxX()) return 1;
        if (this._upwardSeg.maxX() <= t._upwardSeg.minX()) return -1;
        var n = this._upwardSeg.orientationIndex(t._upwardSeg);
        return 0 !== n ? n : 0 != (n = -1 * t._upwardSeg.orientationIndex(this._upwardSeg)) ? n : this._upwardSeg.compareTo(t._upwardSeg)
    }, jh.prototype.compareX = function (e, t) {
        var n = e.p0.compareTo(t.p0);
        return 0 !== n ? n : e.p1.compareTo(t.p1)
    }, jh.prototype.toString = function () {
        return this._upwardSeg.toString()
    }, jh.prototype.interfaces_ = function () {
        return [Ef]
    }, jh.prototype.getClass = function () {
        return jh
    };
    var Fh = function (e, t, n) {
        this.p0 = e || null, this.p1 = t || null, this.p2 = n || null
    };
    Fh.prototype.area = function () {
        return Fh.area(this.p0, this.p1, this.p2)
    }, Fh.prototype.signedArea = function () {
        return Fh.signedArea(this.p0, this.p1, this.p2)
    }, Fh.prototype.interpolateZ = function (e) {
        if (null === e) throw new yf("Supplied point is null.");
        return Fh.interpolateZ(e, this.p0, this.p1, this.p2)
    }, Fh.prototype.longestSideLength = function () {
        return Fh.longestSideLength(this.p0, this.p1, this.p2)
    }, Fh.prototype.isAcute = function () {
        return Fh.isAcute(this.p0, this.p1, this.p2)
    }, Fh.prototype.circumcentre = function () {
        return Fh.circumcentre(this.p0, this.p1, this.p2)
    }, Fh.prototype.area3D = function () {
        return Fh.area3D(this.p0, this.p1, this.p2)
    }, Fh.prototype.centroid = function () {
        return Fh.centroid(this.p0, this.p1, this.p2)
    }, Fh.prototype.inCentre = function () {
        return Fh.inCentre(this.p0, this.p1, this.p2)
    }, Fh.prototype.interfaces_ = function () {
        return []
    }, Fh.prototype.getClass = function () {
        return Fh
    }, Fh.area = function (e, t, n) {
        return Math.abs(((n.x - e.x) * (t.y - e.y) - (t.x - e.x) * (n.y - e.y)) / 2)
    }, Fh.signedArea = function (e, t, n) {
        return ((n.x - e.x) * (t.y - e.y) - (t.x - e.x) * (n.y - e.y)) / 2
    }, Fh.det = function (e, t, n, r) {
        return e * r - t * n
    }, Fh.interpolateZ = function (e, t, n, r) {
        var i = t.x, s = t.y, o = n.x - i, u = r.x - i, a = n.y - s, f = r.y - s, l = o * f - u * a, c = e.x - i,
            h = e.y - s, p = (f * c - u * h) / l, d = (-a * c + o * h) / l;
        return t.z + p * (n.z - t.z) + d * (r.z - t.z)
    }, Fh.longestSideLength = function (e, t, n) {
        var r = e.distance(t), i = t.distance(n), s = n.distance(e), o = r;
        return i > o && (o = i), s > o && (o = s), o
    }, Fh.isAcute = function (e, t, n) {
        return !!Oh.isAcute(e, t, n) && !!Oh.isAcute(t, n, e) && !!Oh.isAcute(n, e, t)
    }, Fh.circumcentre = function (e, t, n) {
        var r = n.x, i = n.y, s = e.x - r, o = e.y - i, u = t.x - r, a = t.y - i, f = 2 * Fh.det(s, o, u, a),
            l = Fh.det(o, s * s + o * o, a, u * u + a * a), c = Fh.det(s, s * s + o * o, u, u * u + a * a);
        return new Tf(r - l / f, i + c / f)
    }, Fh.perpendicularBisector = function (e, t) {
        var n = t.x - e.x, r = t.y - e.y, i = new Xf(e.x + n / 2, e.y + r / 2, 1),
            s = new Xf(e.x - r + n / 2, e.y + n + r / 2, 1);
        return new Xf(i, s)
    }, Fh.angleBisector = function (e, t, n) {
        var r = t.distance(e), i = r / (r + t.distance(n)), s = n.x - e.x, o = n.y - e.y;
        return new Tf(e.x + i * s, e.y + i * o)
    }, Fh.area3D = function (e, t, n) {
        var r = t.x - e.x, i = t.y - e.y, s = t.z - e.z, o = n.x - e.x, u = n.y - e.y, a = n.z - e.z, f = i * a - s * u,
            l = s * o - r * a, c = r * u - i * o, h = f * f + l * l + c * c, p = Math.sqrt(h) / 2;
        return p
    }, Fh.centroid = function (e, t, n) {
        var r = (e.x + t.x + n.x) / 3, i = (e.y + t.y + n.y) / 3;
        return new Tf(r, i)
    }, Fh.inCentre = function (e, t, n) {
        var r = t.distance(n), i = e.distance(n), s = e.distance(t), o = r + i + s,
            u = (r * e.x + i * t.x + s * n.x) / o, a = (r * e.y + i * t.y + s * n.y) / o;
        return new Tf(u, a)
    };
    var Ih = function () {
        this._inputGeom = null, this._distance = null, this._curveBuilder = null, this._curveList = new Tl;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        this._inputGeom = e, this._distance = t, this._curveBuilder = n
    };
    Ih.prototype.addPoint = function (e) {
        if (this._distance <= 0) return null;
        var t = e.getCoordinates(), n = this._curveBuilder.getLineCurve(t, this._distance);
        this.addCurve(n, Lf.EXTERIOR, Lf.INTERIOR)
    }, Ih.prototype.addPolygon = function (e) {
        var t = this._distance, n = Cc.LEFT;
        this._distance < 0 && (t = -this._distance, n = Cc.RIGHT);
        var r = e.getExteriorRing(), i = kl.removeRepeatedPoints(r.getCoordinates());
        if (this._distance < 0 && this.isErodedCompletely(r, this._distance)) return null;
        if (this._distance <= 0 && i.length < 3) return null;
        this.addPolygonRing(i, t, n, Lf.EXTERIOR, Lf.INTERIOR);
        for (var s = 0; s < e.getNumInteriorRing(); s++) {
            var o = e.getInteriorRingN(s), u = kl.removeRepeatedPoints(o.getCoordinates());
            this._distance > 0 && this.isErodedCompletely(o, -this._distance) || this.addPolygonRing(u, t, Cc.opposite(n), Lf.INTERIOR, Lf.EXTERIOR)
        }
    }, Ih.prototype.isTriangleErodedCompletely = function (e, t) {
        var n = new Fh(e[0], e[1], e[2]), r = n.inCentre();
        return ul.distancePointLine(r, n.p0, n.p1) < Math.abs(t)
    }, Ih.prototype.addLineString = function (e) {
        if (this._distance <= 0 && !this._curveBuilder.getBufferParameters().isSingleSided()) return null;
        var t = kl.removeRepeatedPoints(e.getCoordinates()), n = this._curveBuilder.getLineCurve(t, this._distance);
        this.addCurve(n, Lf.EXTERIOR, Lf.INTERIOR)
    }, Ih.prototype.addCurve = function (e, t, n) {
        if (null === e || e.length < 2) return null;
        var r = new dh(e, new Dc(0, Lf.BOUNDARY, t, n));
        this._curveList.add(r)
    }, Ih.prototype.getCurves = function () {
        return this.add(this._inputGeom), this._curveList
    }, Ih.prototype.addPolygonRing = function (e, t, n, r, i) {
        if (0 === t && e.length < nc.MINIMUM_VALID_SIZE) return null;
        var s = r, o = i;
        e.length >= nc.MINIMUM_VALID_SIZE && ul.isCCW(e) && (s = i, o = r, n = Cc.opposite(n));
        var u = this._curveBuilder.getRingCurve(e, n, t);
        this.addCurve(u, s, o)
    }, Ih.prototype.add = function (e) {
        if (e.isEmpty()) return null;
        e instanceof ec ? this.addPolygon(e) : e instanceof Ql ? this.addLineString(e) : e instanceof Yl ? this.addPoint(e) : e instanceof tc ? this.addCollection(e) : e instanceof Wl ? this.addCollection(e) : e instanceof rc ? this.addCollection(e) : e instanceof zl && this.addCollection(e)
    }, Ih.prototype.isErodedCompletely = function (e, t) {
        var n = e.getCoordinates();
        if (n.length < 4) return t < 0;
        if (4 === n.length) return this.isTriangleErodedCompletely(n, t);
        var r = e.getEnvelopeInternal(), i = Math.min(r.getHeight(), r.getWidth());
        return t < 0 && 2 * Math.abs(t) > i
    }, Ih.prototype.addCollection = function (e) {
        for (var t = 0; t < e.getNumGeometries(); t++) {
            var n = e.getGeometryN(t);
            this.add(n)
        }
    }, Ih.prototype.interfaces_ = function () {
        return []
    }, Ih.prototype.getClass = function () {
        return Ih
    };
    var qh = function () {
    };
    qh.prototype.locate = function (e) {
    }, qh.prototype.interfaces_ = function () {
        return []
    }, qh.prototype.getClass = function () {
        return qh
    };
    var Rh = function () {
        this._parent = null, this._atStart = null, this._max = null, this._index = null, this._subcollectionIterator = null;
        var e = arguments[0];
        this._parent = e, this._atStart = !0, this._index = 0, this._max = e.getNumGeometries()
    };
    Rh.prototype.next = function () {
        if (this._atStart) return this._atStart = !1, Rh.isAtomic(this._parent) && this._index++, this._parent;
        if (null !== this._subcollectionIterator) {
            if (this._subcollectionIterator.hasNext()) return this._subcollectionIterator.next();
            this._subcollectionIterator = null
        }
        if (this._index >= this._max) throw new Os;
        var e = this._parent.getGeometryN(this._index++);
        return e instanceof zl ? (this._subcollectionIterator = new Rh(e), this._subcollectionIterator.next()) : e
    }, Rh.prototype.remove = function () {
        throw new Error(this.getClass().getName())
    }, Rh.prototype.hasNext = function () {
        if (this._atStart) return !0;
        if (null !== this._subcollectionIterator) {
            if (this._subcollectionIterator.hasNext()) return !0;
            this._subcollectionIterator = null
        }
        return !(this._index >= this._max)
    }, Rh.prototype.interfaces_ = function () {
        return [Sl]
    }, Rh.prototype.getClass = function () {
        return Rh
    }, Rh.isAtomic = function (e) {
        return !(e instanceof zl)
    };
    var Uh = function () {
        this._geom = null;
        var e = arguments[0];
        this._geom = e
    };
    Uh.prototype.locate = function (e) {
        return Uh.locate(e, this._geom)
    }, Uh.prototype.interfaces_ = function () {
        return [qh]
    }, Uh.prototype.getClass = function () {
        return Uh
    }, Uh.isPointInRing = function (e, t) {
        return !!t.getEnvelopeInternal().intersects(e) && ul.isPointInRing(e, t.getCoordinates())
    }, Uh.containsPointInPolygon = function (e, t) {
        if (t.isEmpty()) return !1;
        var n = t.getExteriorRing();
        if (!Uh.isPointInRing(e, n)) return !1;
        for (var r = 0; r < t.getNumInteriorRing(); r++) {
            var i = t.getInteriorRingN(r);
            if (Uh.isPointInRing(e, i)) return !1
        }
        return !0
    }, Uh.containsPoint = function (e, t) {
        if (t instanceof ec) return Uh.containsPointInPolygon(e, t);
        if (t instanceof zl) for (var n = new Rh(t); n.hasNext();) {
            var r = n.next();
            if (r !== t && Uh.containsPoint(e, r)) return !0
        }
        return !1
    }, Uh.locate = function (e, t) {
        return t.isEmpty() ? Lf.EXTERIOR : Uh.containsPoint(e, t) ? Lf.INTERIOR : Lf.EXTERIOR
    };
    var zh = function () {
        this._edgeMap = new Fs, this._edgeList = null, this._ptInAreaLocation = [Lf.NONE, Lf.NONE]
    };
    zh.prototype.getNextCW = function (e) {
        this.getEdges();
        var t = this._edgeList.indexOf(e), n = t - 1;
        return 0 === t && (n = this._edgeList.size() - 1), this._edgeList.get(n)
    }, zh.prototype.propagateSideLabels = function (e) {
        for (var t = Lf.NONE, n = this.iterator(); n.hasNext();) {
            var r = n.next().getLabel();
            r.isArea(e) && r.getLocation(e, Cc.LEFT) !== Lf.NONE && (t = r.getLocation(e, Cc.LEFT))
        }
        if (t === Lf.NONE) return null;
        for (var i = t, s = this.iterator(); s.hasNext();) {
            var o = s.next(), u = o.getLabel();
            if (u.getLocation(e, Cc.ON) === Lf.NONE && u.setLocation(e, Cc.ON, i), u.isArea(e)) {
                var a = u.getLocation(e, Cc.LEFT), f = u.getLocation(e, Cc.RIGHT);
                if (f !== Lf.NONE) {
                    if (f !== i) throw new Ac("side location conflict", o.getCoordinate());
                    a === Lf.NONE && tl.shouldNeverReachHere("found single null side (at " + o.getCoordinate() + ")"), i = a
                } else tl.isTrue(u.getLocation(e, Cc.LEFT) === Lf.NONE, "found single null side"), u.setLocation(e, Cc.RIGHT, i), u.setLocation(e, Cc.LEFT, i)
            }
        }
    }, zh.prototype.getCoordinate = function () {
        var e = this.iterator();
        return e.hasNext() ? e.next().getCoordinate() : null
    }, zh.prototype.print = function (e) {
        Wf.out.println("EdgeEndStar:   " + this.getCoordinate());
        for (var t = this.iterator(); t.hasNext();) t.next().print(e)
    }, zh.prototype.isAreaLabelsConsistent = function (e) {
        return this.computeEdgeEndLabels(e.getBoundaryNodeRule()), this.checkAreaLabelsConsistent(0)
    }, zh.prototype.checkAreaLabelsConsistent = function (e) {
        var t = this.getEdges();
        if (t.size() <= 0) return !0;
        var n = t.size() - 1, r = t.get(n).getLabel().getLocation(e, Cc.LEFT);
        tl.isTrue(r !== Lf.NONE, "Found unlabelled area edge");
        for (var i = r, s = this.iterator(); s.hasNext();) {
            var o = s.next().getLabel();
            tl.isTrue(o.isArea(e), "Found non-area edge");
            var u = o.getLocation(e, Cc.LEFT), a = o.getLocation(e, Cc.RIGHT);
            if (u === a) return !1;
            if (a !== i) return !1;
            i = u
        }
        return !0
    }, zh.prototype.findIndex = function (e) {
        this.iterator();
        for (var t = 0; t < this._edgeList.size(); t++) if (this._edgeList.get(t) === e) return t;
        return -1
    }, zh.prototype.iterator = function () {
        return this.getEdges().iterator()
    }, zh.prototype.getEdges = function () {
        return null === this._edgeList && (this._edgeList = new Tl(this._edgeMap.values())), this._edgeList
    }, zh.prototype.getLocation = function (e, t, n) {
        return this._ptInAreaLocation[e] === Lf.NONE && (this._ptInAreaLocation[e] = Uh.locate(t, n[e].getGeometry())), this._ptInAreaLocation[e]
    }, zh.prototype.toString = function () {
        var e = new Df;
        e.append("EdgeEndStar:   " + this.getCoordinate()), e.append("\n");
        for (var t = this.iterator(); t.hasNext();) {
            var n = t.next();
            e.append(n), e.append("\n")
        }
        return e.toString()
    }, zh.prototype.computeEdgeEndLabels = function (e) {
        for (var t = this.iterator(); t.hasNext();) t.next().computeLabel(e)
    }, zh.prototype.computeLabelling = function (e) {
        this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()), this.propagateSideLabels(0), this.propagateSideLabels(1);
        for (var t = [!1, !1], n = this.iterator(); n.hasNext();) for (var r = n.next().getLabel(), i = 0; i < 2; i++) r.isLine(i) && r.getLocation(i) === Lf.BOUNDARY && (t[i] = !0);
        for (var s = this.iterator(); s.hasNext();) for (var o = s.next(), u = o.getLabel(), a = 0; a < 2; a++) if (u.isAnyNull(a)) {
            var f = Lf.NONE;
            if (t[a]) f = Lf.EXTERIOR; else {
                var l = o.getCoordinate();
                f = this.getLocation(a, l, e)
            }
            u.setAllLocationsIfNull(a, f)
        }
    }, zh.prototype.getDegree = function () {
        return this._edgeMap.size()
    }, zh.prototype.insertEdgeEnd = function (e, t) {
        this._edgeMap.put(e, t), this._edgeList = null
    }, zh.prototype.interfaces_ = function () {
        return []
    }, zh.prototype.getClass = function () {
        return zh
    };
    var Wh = function (e) {
        function t() {
            e.call(this), this._resultAreaEdgeList = null, this._label = null, this._SCANNING_FOR_INCOMING = 1, this._LINKING_TO_OUTGOING = 2
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.linkResultDirectedEdges = function () {
            this.getResultAreaEdges();
            for (var e = null, t = null, n = this._SCANNING_FOR_INCOMING, r = 0; r < this._resultAreaEdgeList.size(); r++) {
                var i = this._resultAreaEdgeList.get(r), s = i.getSym();
                if (i.getLabel().isArea()) switch (null === e && i.isInResult() && (e = i), n) {
                    case this._SCANNING_FOR_INCOMING:
                        if (!s.isInResult()) continue;
                        t = s, n = this._LINKING_TO_OUTGOING;
                        break;
                    case this._LINKING_TO_OUTGOING:
                        if (!i.isInResult()) continue;
                        t.setNext(i), n = this._SCANNING_FOR_INCOMING
                }
            }
            if (n === this._LINKING_TO_OUTGOING) {
                if (null === e) throw new Ac("no outgoing dirEdge found", this.getCoordinate());
                tl.isTrue(e.isInResult(), "unable to link last incoming dirEdge"), t.setNext(e)
            }
        }, t.prototype.insert = function (e) {
            var t = e;
            this.insertEdgeEnd(t, t)
        }, t.prototype.getRightmostEdge = function () {
            var e = this.getEdges(), t = e.size();
            if (t < 1) return null;
            var n = e.get(0);
            if (1 === t) return n;
            var r = e.get(t - 1), i = n.getQuadrant(), s = r.getQuadrant();
            return qc.isNorthern(i) && qc.isNorthern(s) ? n : qc.isNorthern(i) || qc.isNorthern(s) ? 0 !== n.getDy() ? n : 0 !== r.getDy() ? r : (tl.shouldNeverReachHere("found two horizontal edges incident on node"), null) : r
        }, t.prototype.print = function (e) {
            Wf.out.println("DirectedEdgeStar: " + this.getCoordinate());
            for (var t = this.iterator(); t.hasNext();) {
                var n = t.next();
                e.print("out "), n.print(e), e.println(), e.print("in "), n.getSym().print(e), e.println()
            }
        }, t.prototype.getResultAreaEdges = function () {
            if (null !== this._resultAreaEdgeList) return this._resultAreaEdgeList;
            this._resultAreaEdgeList = new Tl;
            for (var e = this.iterator(); e.hasNext();) {
                var t = e.next();
                (t.isInResult() || t.getSym().isInResult()) && this._resultAreaEdgeList.add(t)
            }
            return this._resultAreaEdgeList
        }, t.prototype.updateLabelling = function (e) {
            for (var t = this.iterator(); t.hasNext();) {
                var n = t.next().getLabel();
                n.setAllLocationsIfNull(0, e.getLocation(0)), n.setAllLocationsIfNull(1, e.getLocation(1))
            }
        }, t.prototype.linkAllDirectedEdges = function () {
            this.getEdges();
            for (var e = null, t = null, n = this._edgeList.size() - 1; n >= 0; n--) {
                var r = this._edgeList.get(n), i = r.getSym();
                null === t && (t = i), null !== e && i.setNext(e), e = r
            }
            t.setNext(e)
        }, t.prototype.computeDepths = function () {
            if (1 === arguments.length) {
                var e = arguments[0], t = this.findIndex(e), n = e.getDepth(Cc.LEFT), r = e.getDepth(Cc.RIGHT),
                    i = this.computeDepths(t + 1, this._edgeList.size(), n);
                if (this.computeDepths(0, t, i) !== r) throw new Ac("depth mismatch at " + e.getCoordinate())
            } else if (3 === arguments.length) {
                for (var s = arguments[0], o = arguments[1], u = arguments[2], a = s; a < o; a++) {
                    var f = this._edgeList.get(a);
                    f.setEdgeDepths(Cc.RIGHT, u), u = f.getDepth(Cc.LEFT)
                }
                return u
            }
        }, t.prototype.mergeSymLabels = function () {
            for (var e = this.iterator(); e.hasNext();) {
                var t = e.next();
                t.getLabel().merge(t.getSym().getLabel())
            }
        }, t.prototype.linkMinimalDirectedEdges = function (e) {
            for (var t = null, n = null, r = this._SCANNING_FOR_INCOMING, i = this._resultAreaEdgeList.size() - 1; i >= 0; i--) {
                var s = this._resultAreaEdgeList.get(i), o = s.getSym();
                switch (null === t && s.getEdgeRing() === e && (t = s), r) {
                    case this._SCANNING_FOR_INCOMING:
                        if (o.getEdgeRing() !== e) continue;
                        n = o, r = this._LINKING_TO_OUTGOING;
                        break;
                    case this._LINKING_TO_OUTGOING:
                        if (s.getEdgeRing() !== e) continue;
                        n.setNextMin(s), r = this._SCANNING_FOR_INCOMING
                }
            }
            r === this._LINKING_TO_OUTGOING && (tl.isTrue(null !== t, "found null for first outgoing dirEdge"), tl.isTrue(t.getEdgeRing() === e, "unable to link last incoming dirEdge"), n.setNextMin(t))
        }, t.prototype.getOutgoingDegree = function () {
            if (0 === arguments.length) {
                for (var e = 0, t = this.iterator(); t.hasNext();) t.next().isInResult() && e++;
                return e
            }
            if (1 === arguments.length) {
                for (var n = arguments[0], r = 0, i = this.iterator(); i.hasNext();) i.next().getEdgeRing() === n && r++;
                return r
            }
        }, t.prototype.getLabel = function () {
            return this._label
        }, t.prototype.findCoveredLineEdges = function () {
            for (var e = Lf.NONE, t = this.iterator(); t.hasNext();) {
                var n = t.next(), r = n.getSym();
                if (!n.isLineEdge()) {
                    if (n.isInResult()) {
                        e = Lf.INTERIOR;
                        break
                    }
                    if (r.isInResult()) {
                        e = Lf.EXTERIOR;
                        break
                    }
                }
            }
            if (e === Lf.NONE) return null;
            for (var i = e, s = this.iterator(); s.hasNext();) {
                var o = s.next(), u = o.getSym();
                o.isLineEdge() ? o.getEdge().setCovered(i === Lf.INTERIOR) : (o.isInResult() && (i = Lf.EXTERIOR), u.isInResult() && (i = Lf.INTERIOR))
            }
        }, t.prototype.computeLabelling = function (t) {
            e.prototype.computeLabelling.call(this, t), this._label = new Dc(Lf.NONE);
            for (var n = this.iterator(); n.hasNext();) for (var r = n.next().getEdge().getLabel(), i = 0; i < 2; i++) {
                var s = r.getLocation(i);
                s !== Lf.INTERIOR && s !== Lf.BOUNDARY || this._label.setLocation(i, Lf.INTERIOR)
            }
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(zh), Xh = function (e) {
        function t() {
            e.apply(this, arguments)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.createNode = function (e) {
            return new Fc(e, new Wh)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Wc), Vh = function Rv() {
        this._pts = null, this._orientation = null;
        var e = arguments[0];
        this._pts = e, this._orientation = Rv.orientation(e)
    };
    Vh.prototype.compareTo = function (e) {
        var t = e;
        return Vh.compareOriented(this._pts, this._orientation, t._pts, t._orientation)
    }, Vh.prototype.interfaces_ = function () {
        return [Ef]
    }, Vh.prototype.getClass = function () {
        return Vh
    }, Vh.orientation = function (e) {
        return 1 === kl.increasingDirection(e)
    }, Vh.compareOriented = function (e, t, n, r) {
        for (var i = t ? 1 : -1, s = r ? 1 : -1, o = t ? e.length : -1, u = r ? n.length : -1, a = t ? 0 : e.length - 1, f = r ? 0 : n.length - 1; ;) {
            var l = e[a].compareTo(n[f]);
            if (0 !== l) return l;
            var c = (a += i) === o, h = (f += s) === u;
            if (c && !h) return -1;
            if (!c && h) return 1;
            if (c && h) return 0
        }
    };
    var $h = function () {
        this._edges = new Tl, this._ocaMap = new Fs
    };
    $h.prototype.print = function (e) {
        e.print("MULTILINESTRING ( ");
        for (var t = 0; t < this._edges.size(); t++) {
            var n = this._edges.get(t);
            t > 0 && e.print(","), e.print("(");
            for (var r = n.getCoordinates(), i = 0; i < r.length; i++) i > 0 && e.print(","), e.print(r[i].x + " " + r[i].y);
            e.println(")")
        }
        e.print(")  ")
    }, $h.prototype.addAll = function (e) {
        for (var t = e.iterator(); t.hasNext();) this.add(t.next())
    }, $h.prototype.findEdgeIndex = function (e) {
        for (var t = 0; t < this._edges.size(); t++) if (this._edges.get(t).equals(e)) return t;
        return -1
    }, $h.prototype.iterator = function () {
        return this._edges.iterator()
    }, $h.prototype.getEdges = function () {
        return this._edges
    }, $h.prototype.get = function (e) {
        return this._edges.get(e)
    }, $h.prototype.findEqualEdge = function (e) {
        var t = new Vh(e.getCoordinates());
        return this._ocaMap.get(t)
    }, $h.prototype.add = function (e) {
        this._edges.add(e);
        var t = new Vh(e.getCoordinates());
        this._ocaMap.put(t, e)
    }, $h.prototype.interfaces_ = function () {
        return []
    }, $h.prototype.getClass = function () {
        return $h
    };
    var Jh = function () {
    };
    Jh.prototype.processIntersections = function (e, t, n, r) {
    }, Jh.prototype.isDone = function () {
    }, Jh.prototype.interfaces_ = function () {
        return []
    }, Jh.prototype.getClass = function () {
        return Jh
    };
    var Kh = function () {
        this._hasIntersection = !1, this._hasProper = !1, this._hasProperInterior = !1, this._hasInterior = !1, this._properIntersectionPoint = null, this._li = null, this._isSelfIntersection = null, this.numIntersections = 0, this.numInteriorIntersections = 0, this.numProperIntersections = 0, this.numTests = 0;
        var e = arguments[0];
        this._li = e
    };
    Kh.prototype.isTrivialIntersection = function (e, t, n, r) {
        if (e === n && 1 === this._li.getIntersectionNum()) {
            if (Kh.isAdjacentSegments(t, r)) return !0;
            if (e.isClosed()) {
                var i = e.size() - 1;
                if (0 === t && r === i || 0 === r && t === i) return !0
            }
        }
        return !1
    }, Kh.prototype.getProperIntersectionPoint = function () {
        return this._properIntersectionPoint
    }, Kh.prototype.hasProperInteriorIntersection = function () {
        return this._hasProperInterior
    }, Kh.prototype.getLineIntersector = function () {
        return this._li
    }, Kh.prototype.hasProperIntersection = function () {
        return this._hasProper
    }, Kh.prototype.processIntersections = function (e, t, n, r) {
        if (e === n && t === r) return null;
        this.numTests++;
        var i = e.getCoordinates()[t], s = e.getCoordinates()[t + 1], o = n.getCoordinates()[r],
            u = n.getCoordinates()[r + 1];
        this._li.computeIntersection(i, s, o, u), this._li.hasIntersection() && (this.numIntersections++, this._li.isInteriorIntersection() && (this.numInteriorIntersections++, this._hasInterior = !0), this.isTrivialIntersection(e, t, n, r) || (this._hasIntersection = !0, e.addIntersections(this._li, t, 0), n.addIntersections(this._li, r, 1), this._li.isProper() && (this.numProperIntersections++, this._hasProper = !0, this._hasProperInterior = !0)))
    }, Kh.prototype.hasIntersection = function () {
        return this._hasIntersection
    }, Kh.prototype.isDone = function () {
        return !1
    }, Kh.prototype.hasInteriorIntersection = function () {
        return this._hasInterior
    }, Kh.prototype.interfaces_ = function () {
        return [Jh]
    }, Kh.prototype.getClass = function () {
        return Kh
    }, Kh.isAdjacentSegments = function (e, t) {
        return 1 === Math.abs(e - t)
    };
    var Qh = function () {
        this.coord = null, this.segmentIndex = null, this.dist = null;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        this.coord = new Tf(e), this.segmentIndex = t, this.dist = n
    };
    Qh.prototype.getSegmentIndex = function () {
        return this.segmentIndex
    }, Qh.prototype.getCoordinate = function () {
        return this.coord
    }, Qh.prototype.print = function (e) {
        e.print(this.coord), e.print(" seg # = " + this.segmentIndex), e.println(" dist = " + this.dist)
    }, Qh.prototype.compareTo = function (e) {
        var t = e;
        return this.compare(t.segmentIndex, t.dist)
    }, Qh.prototype.isEndPoint = function (e) {
        return 0 === this.segmentIndex && 0 === this.dist || this.segmentIndex === e
    }, Qh.prototype.toString = function () {
        return this.coord + " seg # = " + this.segmentIndex + " dist = " + this.dist
    }, Qh.prototype.getDistance = function () {
        return this.dist
    }, Qh.prototype.compare = function (e, t) {
        return this.segmentIndex < e ? -1 : this.segmentIndex > e ? 1 : this.dist < t ? -1 : this.dist > t ? 1 : 0
    }, Qh.prototype.interfaces_ = function () {
        return [Ef]
    }, Qh.prototype.getClass = function () {
        return Qh
    };
    var Gh = function () {
        this._nodeMap = new Fs, this.edge = null;
        var e = arguments[0];
        this.edge = e
    };
    Gh.prototype.print = function (e) {
        e.println("Intersections:");
        for (var t = this.iterator(); t.hasNext();) t.next().print(e)
    }, Gh.prototype.iterator = function () {
        return this._nodeMap.values().iterator()
    }, Gh.prototype.addSplitEdges = function (e) {
        this.addEndpoints();
        for (var t = this.iterator(), n = t.next(); t.hasNext();) {
            var r = t.next(), i = this.createSplitEdge(n, r);
            e.add(i), n = r
        }
    }, Gh.prototype.addEndpoints = function () {
        var e = this.edge.pts.length - 1;
        this.add(this.edge.pts[0], 0, 0), this.add(this.edge.pts[e], e, 0)
    }, Gh.prototype.createSplitEdge = function (e, t) {
        var n = t.segmentIndex - e.segmentIndex + 2, r = this.edge.pts[t.segmentIndex],
            i = t.dist > 0 || !t.coord.equals2D(r);
        i || n--;
        var s = (new Array(n)).fill(null), o = 0;
        s[o++] = new Tf(e.coord);
        for (var u = e.segmentIndex + 1; u <= t.segmentIndex; u++) s[o++] = this.edge.pts[u];
        return i && (s[o] = t.coord), new np(s, new Dc(this.edge._label))
    }, Gh.prototype.add = function (e, t, n) {
        var r = new Qh(e, t, n), i = this._nodeMap.get(r);
        return null !== i ? i : (this._nodeMap.put(r, r), r)
    }, Gh.prototype.isIntersection = function (e) {
        for (var t = this.iterator(); t.hasNext();) if (t.next().coord.equals(e)) return !0;
        return !1
    }, Gh.prototype.interfaces_ = function () {
        return []
    }, Gh.prototype.getClass = function () {
        return Gh
    };
    var Yh = function () {
    };
    Yh.prototype.getChainStartIndices = function (e) {
        var t = 0, n = new Tl;
        n.add(new Pf(t));
        do {
            var r = this.findChainEnd(e, t);
            n.add(new Pf(r)), t = r
        } while (t < e.length - 1);
        return Yh.toIntArray(n)
    }, Yh.prototype.findChainEnd = function (e, t) {
        for (var n = qc.quadrant(e[t], e[t + 1]), r = t + 1; r < e.length;) {
            if (qc.quadrant(e[r - 1], e[r]) !== n) break;
            r++
        }
        return r - 1
    }, Yh.prototype.interfaces_ = function () {
        return []
    }, Yh.prototype.getClass = function () {
        return Yh
    }, Yh.toIntArray = function (e) {
        for (var t = (new Array(e.size())).fill(null), n = 0; n < t.length; n++) t[n] = e.get(n).intValue();
        return t
    };
    var Zh = function () {
        this.e = null, this.pts = null, this.startIndex = null, this.env1 = new Vf, this.env2 = new Vf;
        var e = arguments[0];
        this.e = e, this.pts = e.getCoordinates();
        var t = new Yh;
        this.startIndex = t.getChainStartIndices(this.pts)
    };
    Zh.prototype.getCoordinates = function () {
        return this.pts
    }, Zh.prototype.getMaxX = function (e) {
        var t = this.pts[this.startIndex[e]].x, n = this.pts[this.startIndex[e + 1]].x;
        return t > n ? t : n
    }, Zh.prototype.getMinX = function (e) {
        var t = this.pts[this.startIndex[e]].x, n = this.pts[this.startIndex[e + 1]].x;
        return t < n ? t : n
    }, Zh.prototype.computeIntersectsForChain = function () {
        if (4 === arguments.length) {
            var e = arguments[0], t = arguments[1], n = arguments[2], r = arguments[3];
            this.computeIntersectsForChain(this.startIndex[e], this.startIndex[e + 1], t, t.startIndex[n], t.startIndex[n + 1], r)
        } else if (6 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2], u = arguments[3], a = arguments[4],
                f = arguments[5], l = this.pts[i], c = this.pts[s], h = o.pts[u], p = o.pts[a];
            if (s - i == 1 && a - u == 1) return f.addIntersections(this.e, i, o.e, u), null;
            if (this.env1.init(l, c), this.env2.init(h, p), !this.env1.intersects(this.env2)) return null;
            var d = Math.trunc((i + s) / 2), v = Math.trunc((u + a) / 2);
            i < d && (u < v && this.computeIntersectsForChain(i, d, o, u, v, f), v < a && this.computeIntersectsForChain(i, d, o, v, a, f)), d < s && (u < v && this.computeIntersectsForChain(d, s, o, u, v, f), v < a && this.computeIntersectsForChain(d, s, o, v, a, f))
        }
    }, Zh.prototype.getStartIndexes = function () {
        return this.startIndex
    }, Zh.prototype.computeIntersects = function (e, t) {
        for (var n = 0; n < this.startIndex.length - 1; n++) for (var r = 0; r < e.startIndex.length - 1; r++) this.computeIntersectsForChain(n, e, r, t)
    }, Zh.prototype.interfaces_ = function () {
        return []
    }, Zh.prototype.getClass = function () {
        return Zh
    };
    var ep = function Uv() {
        this._depth = Array(2).fill().map(function () {
            return Array(3)
        });
        for (var e = 0; e < 2; e++) for (var t = 0; t < 3; t++) this._depth[e][t] = Uv.NULL_VALUE
    }, tp = {NULL_VALUE: {configurable: !0}};
    ep.prototype.getDepth = function (e, t) {
        return this._depth[e][t]
    }, ep.prototype.setDepth = function (e, t, n) {
        this._depth[e][t] = n
    }, ep.prototype.isNull = function () {
        if (0 === arguments.length) {
            for (var e = 0; e < 2; e++) for (var t = 0; t < 3; t++) if (this._depth[e][t] !== ep.NULL_VALUE) return !1;
            return !0
        }
        if (1 === arguments.length) {
            var n = arguments[0];
            return this._depth[n][1] === ep.NULL_VALUE
        }
        if (2 === arguments.length) {
            var r = arguments[0], i = arguments[1];
            return this._depth[r][i] === ep.NULL_VALUE
        }
    }, ep.prototype.normalize = function () {
        for (var e = 0; e < 2; e++) if (!this.isNull(e)) {
            var t = this._depth[e][1];
            this._depth[e][2] < t && (t = this._depth[e][2]), t < 0 && (t = 0);
            for (var n = 1; n < 3; n++) {
                var r = 0;
                this._depth[e][n] > t && (r = 1), this._depth[e][n] = r
            }
        }
    }, ep.prototype.getDelta = function (e) {
        return this._depth[e][Cc.RIGHT] - this._depth[e][Cc.LEFT]
    }, ep.prototype.getLocation = function (e, t) {
        return this._depth[e][t] <= 0 ? Lf.EXTERIOR : Lf.INTERIOR
    }, ep.prototype.toString = function () {
        return "A: " + this._depth[0][1] + "," + this._depth[0][2] + " B: " + this._depth[1][1] + "," + this._depth[1][2]
    }, ep.prototype.add = function () {
        if (1 === arguments.length) for (var e = arguments[0], t = 0; t < 2; t++) for (var n = 1; n < 3; n++) {
            var r = e.getLocation(t, n);
            r !== Lf.EXTERIOR && r !== Lf.INTERIOR || (this.isNull(t, n) ? this._depth[t][n] = ep.depthAtLocation(r) : this._depth[t][n] += ep.depthAtLocation(r))
        } else if (3 === arguments.length) {
            var i = arguments[0], s = arguments[1];
            arguments[2] === Lf.INTERIOR && this._depth[i][s]++
        }
    }, ep.prototype.interfaces_ = function () {
        return []
    }, ep.prototype.getClass = function () {
        return ep
    }, ep.depthAtLocation = function (e) {
        return e === Lf.EXTERIOR ? 0 : e === Lf.INTERIOR ? 1 : ep.NULL_VALUE
    }, tp.NULL_VALUE.get = function () {
        return -1
    }, Object.defineProperties(ep, tp);
    var np = function (e) {
        function t() {
            if (e.call(this), this.pts = null, this._env = null, this.eiList = new Gh(this), this._name = null, this._mce = null, this._isIsolated = !0, this._depth = new ep, this._depthDelta = 0, 1 === arguments.length) {
                var n = arguments[0];
                t.call(this, n, null)
            } else if (2 === arguments.length) {
                var r = arguments[0], i = arguments[1];
                this.pts = r, this._label = i
            }
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.getDepth = function () {
            return this._depth
        }, t.prototype.getCollapsedEdge = function () {
            var e = (new Array(2)).fill(null);
            return e[0] = this.pts[0], e[1] = this.pts[1], new t(e, Dc.toLineLabel(this._label))
        }, t.prototype.isIsolated = function () {
            return this._isIsolated
        }, t.prototype.getCoordinates = function () {
            return this.pts
        }, t.prototype.setIsolated = function (e) {
            this._isIsolated = e
        }, t.prototype.setName = function (e) {
            this._name = e
        }, t.prototype.equals = function (e) {
            if (e instanceof t) {
                var n = e;
                if (this.pts.length !== n.pts.length) return !1;
                for (var r = !0, i = !0, s = this.pts.length, o = 0; o < this.pts.length; o++) if (this.pts[o].equals2D(n.pts[o]) || (r = !1), this.pts[o].equals2D(n.pts[--s]) || (i = !1), !r && !i) return !1;
                return !0
            }
            return !1
        }, t.prototype.getCoordinate = function () {
            if (0 === arguments.length) return this.pts.length > 0 ? this.pts[0] : null;
            if (1 === arguments.length) {
                var e = arguments[0];
                return this.pts[e]
            }
        }, t.prototype.print = function (e) {
            e.print("edge " + this._name + ": "), e.print("LINESTRING (");
            for (var t = 0; t < this.pts.length; t++) t > 0 && e.print(","), e.print(this.pts[t].x + " " + this.pts[t].y);
            e.print(")  " + this._label + " " + this._depthDelta)
        }, t.prototype.computeIM = function (e) {
            t.updateIM(this._label, e)
        }, t.prototype.isCollapsed = function () {
            return !!this._label.isArea() && 3 === this.pts.length && !!this.pts[0].equals(this.pts[2])
        }, t.prototype.isClosed = function () {
            return this.pts[0].equals(this.pts[this.pts.length - 1])
        }, t.prototype.getMaximumSegmentIndex = function () {
            return this.pts.length - 1
        }, t.prototype.getDepthDelta = function () {
            return this._depthDelta
        }, t.prototype.getNumPoints = function () {
            return this.pts.length
        }, t.prototype.printReverse = function (e) {
            e.print("edge " + this._name + ": ");
            for (var t = this.pts.length - 1; t >= 0; t--) e.print(this.pts[t] + " ");
            e.println("")
        }, t.prototype.getMonotoneChainEdge = function () {
            return null === this._mce && (this._mce = new Zh(this)), this._mce
        }, t.prototype.getEnvelope = function () {
            if (null === this._env) {
                this._env = new Vf;
                for (var e = 0; e < this.pts.length; e++) this._env.expandToInclude(this.pts[e])
            }
            return this._env
        }, t.prototype.addIntersection = function (e, t, n, r) {
            var i = new Tf(e.getIntersection(r)), s = t, o = e.getEdgeDistance(n, r), u = s + 1;
            if (u < this.pts.length) {
                var a = this.pts[u];
                i.equals2D(a) && (s = u, o = 0)
            }
            this.eiList.add(i, s, o)
        }, t.prototype.toString = function () {
            var e = new Df;
            e.append("edge " + this._name + ": "), e.append("LINESTRING (");
            for (var t = 0; t < this.pts.length; t++) t > 0 && e.append(","), e.append(this.pts[t].x + " " + this.pts[t].y);
            return e.append(")  " + this._label + " " + this._depthDelta), e.toString()
        }, t.prototype.isPointwiseEqual = function (e) {
            if (this.pts.length !== e.pts.length) return !1;
            for (var t = 0; t < this.pts.length; t++) if (!this.pts[t].equals2D(e.pts[t])) return !1;
            return !0
        }, t.prototype.setDepthDelta = function (e) {
            this._depthDelta = e
        }, t.prototype.getEdgeIntersectionList = function () {
            return this.eiList
        }, t.prototype.addIntersections = function (e, t, n) {
            for (var r = 0; r < e.getIntersectionNum(); r++) this.addIntersection(e, t, n, r)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t.updateIM = function () {
            if (2 !== arguments.length) return e.prototype.updateIM.apply(this, arguments);
            var t = arguments[0], n = arguments[1];
            n.setAtLeastIfValid(t.getLocation(0, Cc.ON), t.getLocation(1, Cc.ON), 1), t.isArea() && (n.setAtLeastIfValid(t.getLocation(0, Cc.LEFT), t.getLocation(1, Cc.LEFT), 2), n.setAtLeastIfValid(t.getLocation(0, Cc.RIGHT), t.getLocation(1, Cc.RIGHT), 2))
        }, t
    }(jc), rp = function (e) {
        this._workingPrecisionModel = null, this._workingNoder = null, this._geomFact = null, this._graph = null, this._edgeList = new $h, this._bufParams = e || null
    };
    rp.prototype.setWorkingPrecisionModel = function (e) {
        this._workingPrecisionModel = e
    }, rp.prototype.insertUniqueEdge = function (e) {
        var t = this._edgeList.findEqualEdge(e);
        if (null !== t) {
            var n = t.getLabel(), r = e.getLabel();
            t.isPointwiseEqual(e) || (r = new Dc(e.getLabel())).flip(), n.merge(r);
            var i = rp.depthDelta(r), s = t.getDepthDelta() + i;
            t.setDepthDelta(s)
        } else this._edgeList.add(e), e.setDepthDelta(rp.depthDelta(e.getLabel()))
    }, rp.prototype.buildSubgraphs = function (e, t) {
        for (var n = new Tl, r = e.iterator(); r.hasNext();) {
            var i = r.next(), s = i.getRightmostCoordinate(), o = (new Hh(n)).getDepth(s);
            i.computeDepth(o), i.findResultEdges(), n.add(i), t.add(i.getDirectedEdges(), i.getNodes())
        }
    }, rp.prototype.createSubgraphs = function (e) {
        for (var t = new Tl, n = e.getNodes().iterator(); n.hasNext();) {
            var r = n.next();
            if (!r.isVisited()) {
                var i = new Mc;
                i.create(r), t.add(i)
            }
        }
        return eh.sort(t, eh.reverseOrder()), t
    }, rp.prototype.createEmptyResultGeometry = function () {
        return this._geomFact.createPolygon()
    }, rp.prototype.getNoder = function (e) {
        if (null !== this._workingNoder) return this._workingNoder;
        var t = new Sh, n = new il;
        return n.setPrecisionModel(e), t.setSegmentIntersector(new Kh(n)), t
    }, rp.prototype.buffer = function (e, t) {
        var n = this._workingPrecisionModel;
        null === n && (n = e.getPrecisionModel()), this._geomFact = e.getFactory();
        var r = new Ph(n, this._bufParams), i = (new Ih(e, t, r)).getCurves();
        if (i.size() <= 0) return this.createEmptyResultGeometry();
        this.computeNodedEdges(i, n), this._graph = new Xc(new Xh), this._graph.addEdges(this._edgeList.getEdges());
        var s = this.createSubgraphs(this._graph), o = new Vc(this._geomFact);
        this.buildSubgraphs(s, o);
        var u = o.getPolygons();
        return u.size() <= 0 ? this.createEmptyResultGeometry() : this._geomFact.buildGeometry(u)
    }, rp.prototype.computeNodedEdges = function (e, t) {
        var n = this.getNoder(t);
        n.computeNodes(e);
        for (var r = n.getNodedSubstrings().iterator(); r.hasNext();) {
            var i = r.next(), s = i.getCoordinates();
            if (2 !== s.length || !s[0].equals2D(s[1])) {
                var o = i.getData(), u = new np(i.getCoordinates(), new Dc(o));
                this.insertUniqueEdge(u)
            }
        }
    }, rp.prototype.setNoder = function (e) {
        this._workingNoder = e
    }, rp.prototype.interfaces_ = function () {
        return []
    }, rp.prototype.getClass = function () {
        return rp
    }, rp.depthDelta = function (e) {
        var t = e.getLocation(0, Cc.LEFT), n = e.getLocation(0, Cc.RIGHT);
        return t === Lf.INTERIOR && n === Lf.EXTERIOR ? 1 : t === Lf.EXTERIOR && n === Lf.INTERIOR ? -1 : 0
    }, rp.convertSegStrings = function (e) {
        for (var t = new yc, n = new Tl; e.hasNext();) {
            var r = e.next(), i = t.createLineString(r.getCoordinates());
            n.add(i)
        }
        return t.buildGeometry(n)
    };
    var ip = function () {
        if (this._noder = null, this._scaleFactor = null, this._offsetX = null, this._offsetY = null, this._isScaled = !1, 2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            this._noder = e, this._scaleFactor = t, this._offsetX = 0, this._offsetY = 0, this._isScaled = !this.isIntegerPrecision()
        } else if (4 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2], s = arguments[3];
            this._noder = n, this._scaleFactor = r, this._offsetX = i, this._offsetY = s, this._isScaled = !this.isIntegerPrecision()
        }
    };
    ip.prototype.rescale = function () {
        if (Of(arguments[0], wl)) for (var e = arguments[0].iterator(); e.hasNext();) {
            var t = e.next();
            this.rescale(t.getCoordinates())
        } else if (arguments[0] instanceof Array) {
            for (var n = arguments[0], r = 0; r < n.length; r++) n[r].x = n[r].x / this._scaleFactor + this._offsetX, n[r].y = n[r].y / this._scaleFactor + this._offsetY;
            2 === n.length && n[0].equals2D(n[1]) && Wf.out.println(n)
        }
    }, ip.prototype.scale = function () {
        if (Of(arguments[0], wl)) {
            for (var e = arguments[0], t = new Tl, n = e.iterator(); n.hasNext();) {
                var r = n.next();
                t.add(new dh(this.scale(r.getCoordinates()), r.getData()))
            }
            return t
        }
        if (arguments[0] instanceof Array) {
            for (var i = arguments[0], s = (new Array(i.length)).fill(null), o = 0; o < i.length; o++) s[o] = new Tf(Math.round((i[o].x - this._offsetX) * this._scaleFactor), Math.round((i[o].y - this._offsetY) * this._scaleFactor), i[o].z);
            return kl.removeRepeatedPoints(s)
        }
    }, ip.prototype.isIntegerPrecision = function () {
        return 1 === this._scaleFactor
    }, ip.prototype.getNodedSubstrings = function () {
        var e = this._noder.getNodedSubstrings();
        return this._isScaled && this.rescale(e), e
    }, ip.prototype.computeNodes = function (e) {
        var t = e;
        this._isScaled && (t = this.scale(e)), this._noder.computeNodes(t)
    }, ip.prototype.interfaces_ = function () {
        return [wh]
    }, ip.prototype.getClass = function () {
        return ip
    };
    var sp = function () {
        this._li = new il, this._segStrings = null;
        var e = arguments[0];
        this._segStrings = e
    }, op = {fact: {configurable: !0}};
    sp.prototype.checkEndPtVertexIntersections = function () {
        if (0 === arguments.length) for (var e = this._segStrings.iterator(); e.hasNext();) {
            var t = e.next().getCoordinates();
            this.checkEndPtVertexIntersections(t[0], this._segStrings), this.checkEndPtVertexIntersections(t[t.length - 1], this._segStrings)
        } else if (2 === arguments.length) for (var n = arguments[0], r = arguments[1].iterator(); r.hasNext();) for (var i = r.next().getCoordinates(), s = 1; s < i.length - 1; s++) if (i[s].equals(n)) throw new Zf("found endpt/interior pt intersection at index " + s + " :pt " + n)
    }, sp.prototype.checkInteriorIntersections = function () {
        if (0 === arguments.length) for (var e = this._segStrings.iterator(); e.hasNext();) for (var t = e.next(), n = this._segStrings.iterator(); n.hasNext();) {
            var r = n.next();
            this.checkInteriorIntersections(t, r)
        } else if (2 === arguments.length) for (var i = arguments[0], s = arguments[1], o = i.getCoordinates(), u = s.getCoordinates(), a = 0; a < o.length - 1; a++) for (var f = 0; f < u.length - 1; f++) this.checkInteriorIntersections(i, a, s, f); else if (4 === arguments.length) {
            var l = arguments[0], c = arguments[1], h = arguments[2], p = arguments[3];
            if (l === h && c === p) return null;
            var d = l.getCoordinates()[c], v = l.getCoordinates()[c + 1], m = h.getCoordinates()[p],
                g = h.getCoordinates()[p + 1];
            if (this._li.computeIntersection(d, v, m, g), this._li.hasIntersection() && (this._li.isProper() || this.hasInteriorIntersection(this._li, d, v) || this.hasInteriorIntersection(this._li, m, g))) throw new Zf("found non-noded intersection at " + d + "-" + v + " and " + m + "-" + g)
        }
    }, sp.prototype.checkValid = function () {
        this.checkEndPtVertexIntersections(), this.checkInteriorIntersections(), this.checkCollapses()
    }, sp.prototype.checkCollapses = function () {
        if (0 === arguments.length) for (var e = this._segStrings.iterator(); e.hasNext();) {
            var t = e.next();
            this.checkCollapses(t)
        } else if (1 === arguments.length) for (var n = arguments[0].getCoordinates(), r = 0; r < n.length - 2; r++) this.checkCollapse(n[r], n[r + 1], n[r + 2])
    }, sp.prototype.hasInteriorIntersection = function (e, t, n) {
        for (var r = 0; r < e.getIntersectionNum(); r++) {
            var i = e.getIntersection(r);
            if (!i.equals(t) && !i.equals(n)) return !0
        }
        return !1
    }, sp.prototype.checkCollapse = function (e, t, n) {
        if (e.equals(n)) throw new Zf("found non-noded collapse at " + sp.fact.createLineString([e, t, n]))
    }, sp.prototype.interfaces_ = function () {
        return []
    }, sp.prototype.getClass = function () {
        return sp
    }, op.fact.get = function () {
        return new yc
    }, Object.defineProperties(sp, op);
    var up = function () {
        this._li = null, this._pt = null, this._originalPt = null, this._ptScaled = null, this._p0Scaled = null, this._p1Scaled = null, this._scaleFactor = null, this._minx = null, this._maxx = null, this._miny = null, this._maxy = null, this._corner = (new Array(4)).fill(null), this._safeEnv = null;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        if (this._originalPt = e, this._pt = e, this._scaleFactor = t, this._li = n, t <= 0) throw new yf("Scale factor must be non-zero");
        1 !== t && (this._pt = new Tf(this.scale(e.x), this.scale(e.y)), this._p0Scaled = new Tf, this._p1Scaled = new Tf), this.initCorners(this._pt)
    }, ap = {SAFE_ENV_EXPANSION_FACTOR: {configurable: !0}};
    up.prototype.intersectsScaled = function (e, t) {
        var n = Math.min(e.x, t.x), r = Math.max(e.x, t.x), i = Math.min(e.y, t.y), s = Math.max(e.y, t.y),
            o = this._maxx < n || this._minx > r || this._maxy < i || this._miny > s;
        if (o) return !1;
        var u = this.intersectsToleranceSquare(e, t);
        return tl.isTrue(!o || !u, "Found bad envelope test"), u
    }, up.prototype.initCorners = function (e) {
        this._minx = e.x - .5, this._maxx = e.x + .5, this._miny = e.y - .5, this._maxy = e.y + .5, this._corner[0] = new Tf(this._maxx, this._maxy), this._corner[1] = new Tf(this._minx, this._maxy), this._corner[2] = new Tf(this._minx, this._miny), this._corner[3] = new Tf(this._maxx, this._miny)
    }, up.prototype.intersects = function (e, t) {
        return 1 === this._scaleFactor ? this.intersectsScaled(e, t) : (this.copyScaled(e, this._p0Scaled), this.copyScaled(t, this._p1Scaled), this.intersectsScaled(this._p0Scaled, this._p1Scaled))
    }, up.prototype.scale = function (e) {
        return Math.round(e * this._scaleFactor)
    }, up.prototype.getCoordinate = function () {
        return this._originalPt
    }, up.prototype.copyScaled = function (e, t) {
        t.x = this.scale(e.x), t.y = this.scale(e.y)
    }, up.prototype.getSafeEnvelope = function () {
        if (null === this._safeEnv) {
            var e = up.SAFE_ENV_EXPANSION_FACTOR / this._scaleFactor;
            this._safeEnv = new Vf(this._originalPt.x - e, this._originalPt.x + e, this._originalPt.y - e, this._originalPt.y + e)
        }
        return this._safeEnv
    }, up.prototype.intersectsPixelClosure = function (e, t) {
        return this._li.computeIntersection(e, t, this._corner[0], this._corner[1]), !!this._li.hasIntersection() || (this._li.computeIntersection(e, t, this._corner[1], this._corner[2]), !!this._li.hasIntersection() || (this._li.computeIntersection(e, t, this._corner[2], this._corner[3]), !!this._li.hasIntersection() || (this._li.computeIntersection(e, t, this._corner[3], this._corner[0]), !!this._li.hasIntersection())))
    }, up.prototype.intersectsToleranceSquare = function (e, t) {
        var n = !1, r = !1;
        return this._li.computeIntersection(e, t, this._corner[0], this._corner[1]), !!this._li.isProper() || (this._li.computeIntersection(e, t, this._corner[1], this._corner[2]), !!this._li.isProper() || (this._li.hasIntersection() && (n = !0), this._li.computeIntersection(e, t, this._corner[2], this._corner[3]), !!this._li.isProper() || (this._li.hasIntersection() && (r = !0), this._li.computeIntersection(e, t, this._corner[3], this._corner[0]), !!this._li.isProper() || !!n && !!r || !!e.equals(this._pt) || !!t.equals(this._pt))))
    }, up.prototype.addSnappedNode = function (e, t) {
        var n = e.getCoordinate(t), r = e.getCoordinate(t + 1);
        return !!this.intersects(n, r) && (e.addIntersection(this.getCoordinate(), t), !0)
    }, up.prototype.interfaces_ = function () {
        return []
    }, up.prototype.getClass = function () {
        return up
    }, ap.SAFE_ENV_EXPANSION_FACTOR.get = function () {
        return .75
    }, Object.defineProperties(up, ap);
    var fp = function () {
        this.tempEnv1 = new Vf, this.selectedSegment = new vh
    };
    fp.prototype.select = function () {
        if (1 !== arguments.length && 2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            e.getLineSegment(t, this.selectedSegment), this.select(this.selectedSegment)
        }
    }, fp.prototype.interfaces_ = function () {
        return []
    }, fp.prototype.getClass = function () {
        return fp
    };
    var lp = function () {
        this._index = null;
        var e = arguments[0];
        this._index = e
    }, cp = {HotPixelSnapAction: {configurable: !0}};
    lp.prototype.snap = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return this.snap(e, null, -1)
        }
        if (3 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = arguments[2], i = t.getSafeEnvelope(), s = new hp(t, n, r);
            return this._index.query(i, {
                interfaces_: function () {
                    return [Qc]
                }, visitItem: function (e) {
                    e.select(i, s)
                }
            }), s.isNodeAdded()
        }
    }, lp.prototype.interfaces_ = function () {
        return []
    }, lp.prototype.getClass = function () {
        return lp
    }, cp.HotPixelSnapAction.get = function () {
        return hp
    }, Object.defineProperties(lp, cp);
    var hp = function (e) {
        function t() {
            e.call(this), this._hotPixel = null, this._parentEdge = null, this._hotPixelVertexIndex = null, this._isNodeAdded = !1;
            var t = arguments[0], n = arguments[1], r = arguments[2];
            this._hotPixel = t, this._parentEdge = n, this._hotPixelVertexIndex = r
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.isNodeAdded = function () {
            return this._isNodeAdded
        }, t.prototype.select = function () {
            if (2 !== arguments.length) return e.prototype.select.apply(this, arguments);
            var t = arguments[0], n = arguments[1], r = t.getContext();
            if (null !== this._parentEdge && r === this._parentEdge && n === this._hotPixelVertexIndex) return null;
            this._isNodeAdded = this._hotPixel.addSnappedNode(r, n)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(fp), pp = function () {
        this._li = null, this._interiorIntersections = null;
        var e = arguments[0];
        this._li = e, this._interiorIntersections = new Tl
    };
    pp.prototype.processIntersections = function (e, t, n, r) {
        if (e === n && t === r) return null;
        var i = e.getCoordinates()[t], s = e.getCoordinates()[t + 1], o = n.getCoordinates()[r],
            u = n.getCoordinates()[r + 1];
        if (this._li.computeIntersection(i, s, o, u), this._li.hasIntersection() && this._li.isInteriorIntersection()) {
            for (var a = 0; a < this._li.getIntersectionNum(); a++) this._interiorIntersections.add(this._li.getIntersection(a));
            e.addIntersections(this._li, t, 0), n.addIntersections(this._li, r, 1)
        }
    }, pp.prototype.isDone = function () {
        return !1
    }, pp.prototype.getInteriorIntersections = function () {
        return this._interiorIntersections
    }, pp.prototype.interfaces_ = function () {
        return [Jh]
    }, pp.prototype.getClass = function () {
        return pp
    };
    var dp = function () {
        this._pm = null, this._li = null, this._scaleFactor = null, this._noder = null, this._pointSnapper = null, this._nodedSegStrings = null;
        var e = arguments[0];
        this._pm = e, this._li = new il, this._li.setPrecisionModel(e), this._scaleFactor = e.getScale()
    };
    dp.prototype.checkCorrectness = function (e) {
        var t = dh.getNodedSubstrings(e), n = new sp(t);
        try {
            n.checkValid()
        } catch (e) {
            if (!(e instanceof Uf)) throw e;
            e.printStackTrace()
        }
    }, dp.prototype.getNodedSubstrings = function () {
        return dh.getNodedSubstrings(this._nodedSegStrings)
    }, dp.prototype.snapRound = function (e, t) {
        var n = this.findInteriorIntersections(e, t);
        this.computeIntersectionSnaps(n), this.computeVertexSnaps(e)
    }, dp.prototype.findInteriorIntersections = function (e, t) {
        var n = new pp(t);
        return this._noder.setSegmentIntersector(n), this._noder.computeNodes(e), n.getInteriorIntersections()
    }, dp.prototype.computeVertexSnaps = function () {
        if (Of(arguments[0], wl)) for (var e = arguments[0].iterator(); e.hasNext();) {
            var t = e.next();
            this.computeVertexSnaps(t)
        } else if (arguments[0] instanceof dh) for (var n = arguments[0], r = n.getCoordinates(), i = 0; i < r.length; i++) {
            var s = new up(r[i], this._scaleFactor, this._li);
            this._pointSnapper.snap(s, n, i) && n.addIntersection(r[i], i)
        }
    }, dp.prototype.computeNodes = function (e) {
        this._nodedSegStrings = e, this._noder = new Sh, this._pointSnapper = new lp(this._noder.getIndex()), this.snapRound(e, this._li)
    }, dp.prototype.computeIntersectionSnaps = function (e) {
        for (var t = e.iterator(); t.hasNext();) {
            var n = t.next(), r = new up(n, this._scaleFactor, this._li);
            this._pointSnapper.snap(r)
        }
    }, dp.prototype.interfaces_ = function () {
        return [wh]
    }, dp.prototype.getClass = function () {
        return dp
    };
    var vp = function () {
        if (this._argGeom = null, this._distance = null, this._bufParams = new Th, this._resultGeometry = null, this._saveException = null, 1 === arguments.length) {
            var e = arguments[0];
            this._argGeom = e
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            this._argGeom = t, this._bufParams = n
        }
    }, mp = {
        CAP_ROUND: {configurable: !0},
        CAP_BUTT: {configurable: !0},
        CAP_FLAT: {configurable: !0},
        CAP_SQUARE: {configurable: !0},
        MAX_PRECISION_DIGITS: {configurable: !0}
    };
    vp.prototype.bufferFixedPrecision = function (e) {
        var t = new ip(new dp(new dc(1)), e.getScale()), n = new rp(this._bufParams);
        n.setWorkingPrecisionModel(e), n.setNoder(t), this._resultGeometry = n.buffer(this._argGeom, this._distance)
    }, vp.prototype.bufferReducedPrecision = function () {
        var e = this;
        if (0 === arguments.length) {
            for (var t = vp.MAX_PRECISION_DIGITS; t >= 0; t--) {
                try {
                    e.bufferReducedPrecision(t)
                } catch (t) {
                    if (!(t instanceof Ac)) throw t;
                    e._saveException = t
                }
                if (null !== e._resultGeometry) return null
            }
            throw this._saveException
        }
        if (1 === arguments.length) {
            var n = arguments[0], r = vp.precisionScaleFactor(this._argGeom, this._distance, n), i = new dc(r);
            this.bufferFixedPrecision(i)
        }
    }, vp.prototype.computeGeometry = function () {
        if (this.bufferOriginalPrecision(), null !== this._resultGeometry) return null;
        var e = this._argGeom.getFactory().getPrecisionModel();
        e.getType() === dc.FIXED ? this.bufferFixedPrecision(e) : this.bufferReducedPrecision()
    }, vp.prototype.setQuadrantSegments = function (e) {
        this._bufParams.setQuadrantSegments(e)
    }, vp.prototype.bufferOriginalPrecision = function () {
        try {
            var e = new rp(this._bufParams);
            this._resultGeometry = e.buffer(this._argGeom, this._distance)
        } catch (e) {
            if (!(e instanceof Zf)) throw e;
            this._saveException = e
        }
    }, vp.prototype.getResultGeometry = function (e) {
        return this._distance = e, this.computeGeometry(), this._resultGeometry
    }, vp.prototype.setEndCapStyle = function (e) {
        this._bufParams.setEndCapStyle(e)
    }, vp.prototype.interfaces_ = function () {
        return []
    }, vp.prototype.getClass = function () {
        return vp
    }, vp.bufferOp = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            return (new vp(e)).getResultGeometry(t)
        }
        if (3 === arguments.length) {
            if (Number.isInteger(arguments[2]) && arguments[0] instanceof ll && "number" == typeof arguments[1]) {
                var n = arguments[0], r = arguments[1], i = arguments[2], s = new vp(n);
                return s.setQuadrantSegments(i), s.getResultGeometry(r)
            }
            if (arguments[2] instanceof Th && arguments[0] instanceof ll && "number" == typeof arguments[1]) {
                var o = arguments[0], u = arguments[1], a = arguments[2];
                return (new vp(o, a)).getResultGeometry(u)
            }
        } else if (4 === arguments.length) {
            var f = arguments[0], l = arguments[1], c = arguments[2], h = arguments[3], p = new vp(f);
            return p.setQuadrantSegments(c), p.setEndCapStyle(h), p.getResultGeometry(l)
        }
    }, vp.precisionScaleFactor = function (e, t, n) {
        var r = e.getEnvelopeInternal(),
            i = Mf.max(Math.abs(r.getMaxX()), Math.abs(r.getMaxY()), Math.abs(r.getMinX()), Math.abs(r.getMinY())) + 2 * (t > 0 ? t : 0),
            s = n - Math.trunc(Math.log(i) / Math.log(10) + 1);
        return Math.pow(10, s)
    }, mp.CAP_ROUND.get = function () {
        return Th.CAP_ROUND
    }, mp.CAP_BUTT.get = function () {
        return Th.CAP_FLAT
    }, mp.CAP_FLAT.get = function () {
        return Th.CAP_FLAT
    }, mp.CAP_SQUARE.get = function () {
        return Th.CAP_SQUARE
    }, mp.MAX_PRECISION_DIGITS.get = function () {
        return 12
    }, Object.defineProperties(vp, mp);
    var gp = function () {
        this._pt = [new Tf, new Tf], this._distance = bf.NaN, this._isNull = !0
    };
    gp.prototype.getCoordinates = function () {
        return this._pt
    }, gp.prototype.getCoordinate = function (e) {
        return this._pt[e]
    }, gp.prototype.setMinimum = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.setMinimum(e._pt[0], e._pt[1])
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            if (this._isNull) return this.initialize(t, n), null;
            var r = t.distance(n);
            r < this._distance && this.initialize(t, n, r)
        }
    }, gp.prototype.initialize = function () {
        if (0 === arguments.length) this._isNull = !0; else if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            this._pt[0].setCoordinate(e), this._pt[1].setCoordinate(t), this._distance = e.distance(t), this._isNull = !1
        } else if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2];
            this._pt[0].setCoordinate(n), this._pt[1].setCoordinate(r), this._distance = i, this._isNull = !1
        }
    }, gp.prototype.getDistance = function () {
        return this._distance
    }, gp.prototype.setMaximum = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.setMaximum(e._pt[0], e._pt[1])
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            if (this._isNull) return this.initialize(t, n), null;
            var r = t.distance(n);
            r > this._distance && this.initialize(t, n, r)
        }
    }, gp.prototype.interfaces_ = function () {
        return []
    }, gp.prototype.getClass = function () {
        return gp
    };
    var yp = function () {
    };
    yp.prototype.interfaces_ = function () {
        return []
    }, yp.prototype.getClass = function () {
        return yp
    }, yp.computeDistance = function () {
        if (arguments[2] instanceof gp && arguments[0] instanceof Ql && arguments[1] instanceof Tf) for (var e = arguments[0], t = arguments[1], n = arguments[2], r = e.getCoordinates(), i = new vh, s = 0; s < r.length - 1; s++) {
            i.setCoordinates(r[s], r[s + 1]);
            var o = i.closestPoint(t);
            n.setMinimum(o, t)
        } else if (arguments[2] instanceof gp && arguments[0] instanceof ec && arguments[1] instanceof Tf) {
            var u = arguments[0], a = arguments[1], f = arguments[2];
            yp.computeDistance(u.getExteriorRing(), a, f);
            for (var l = 0; l < u.getNumInteriorRing(); l++) yp.computeDistance(u.getInteriorRingN(l), a, f)
        } else if (arguments[2] instanceof gp && arguments[0] instanceof ll && arguments[1] instanceof Tf) {
            var c = arguments[0], h = arguments[1], p = arguments[2];
            if (c instanceof Ql) yp.computeDistance(c, h, p); else if (c instanceof ec) yp.computeDistance(c, h, p); else if (c instanceof zl) for (var d = c, v = 0; v < d.getNumGeometries(); v++) {
                var m = d.getGeometryN(v);
                yp.computeDistance(m, h, p)
            } else p.setMinimum(c.getCoordinate(), h)
        } else if (arguments[2] instanceof gp && arguments[0] instanceof vh && arguments[1] instanceof Tf) {
            var g = arguments[0], y = arguments[1], b = arguments[2], w = g.closestPoint(y);
            b.setMinimum(w, y)
        }
    };
    var bp = function (e) {
        this._maxPtDist = new gp, this._inputGeom = e || null
    }, wp = {MaxPointDistanceFilter: {configurable: !0}, MaxMidpointDistanceFilter: {configurable: !0}};
    bp.prototype.computeMaxMidpointDistance = function (e) {
        var t = new Sp(this._inputGeom);
        e.apply(t), this._maxPtDist.setMaximum(t.getMaxPointDistance())
    }, bp.prototype.computeMaxVertexDistance = function (e) {
        var t = new Ep(this._inputGeom);
        e.apply(t), this._maxPtDist.setMaximum(t.getMaxPointDistance())
    }, bp.prototype.findDistance = function (e) {
        return this.computeMaxVertexDistance(e), this.computeMaxMidpointDistance(e), this._maxPtDist.getDistance()
    }, bp.prototype.getDistancePoints = function () {
        return this._maxPtDist
    }, bp.prototype.interfaces_ = function () {
        return []
    }, bp.prototype.getClass = function () {
        return bp
    }, wp.MaxPointDistanceFilter.get = function () {
        return Ep
    }, wp.MaxMidpointDistanceFilter.get = function () {
        return Sp
    }, Object.defineProperties(bp, wp);
    var Ep = function (e) {
        this._maxPtDist = new gp, this._minPtDist = new gp, this._geom = e || null
    };
    Ep.prototype.filter = function (e) {
        this._minPtDist.initialize(), yp.computeDistance(this._geom, e, this._minPtDist), this._maxPtDist.setMaximum(this._minPtDist)
    }, Ep.prototype.getMaxPointDistance = function () {
        return this._maxPtDist
    }, Ep.prototype.interfaces_ = function () {
        return [pl]
    }, Ep.prototype.getClass = function () {
        return Ep
    };
    var Sp = function (e) {
        this._maxPtDist = new gp, this._minPtDist = new gp, this._geom = e || null
    };
    Sp.prototype.filter = function (e, t) {
        if (0 === t) return null;
        var n = e.getCoordinate(t - 1), r = e.getCoordinate(t), i = new Tf((n.x + r.x) / 2, (n.y + r.y) / 2);
        this._minPtDist.initialize(), yp.computeDistance(this._geom, i, this._minPtDist), this._maxPtDist.setMaximum(this._minPtDist)
    }, Sp.prototype.isDone = function () {
        return !1
    }, Sp.prototype.isGeometryChanged = function () {
        return !1
    }, Sp.prototype.getMaxPointDistance = function () {
        return this._maxPtDist
    }, Sp.prototype.interfaces_ = function () {
        return [Ul]
    }, Sp.prototype.getClass = function () {
        return Sp
    };
    var xp = function (e) {
        this._comps = e || null
    };
    xp.prototype.filter = function (e) {
        e instanceof ec && this._comps.add(e)
    }, xp.prototype.interfaces_ = function () {
        return [Rl]
    }, xp.prototype.getClass = function () {
        return xp
    }, xp.getPolygons = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return xp.getPolygons(e, new Tl)
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return t instanceof ec ? n.add(t) : t instanceof zl && t.apply(new xp(n)), n
        }
    };
    var Tp = function () {
        if (this._lines = null, this._isForcedToLineString = !1, 1 === arguments.length) {
            var e = arguments[0];
            this._lines = e
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            this._lines = t, this._isForcedToLineString = n
        }
    };
    Tp.prototype.filter = function (e) {
        if (this._isForcedToLineString && e instanceof nc) {
            var t = e.getFactory().createLineString(e.getCoordinateSequence());
            return this._lines.add(t), null
        }
        e instanceof Ql && this._lines.add(e)
    }, Tp.prototype.setForceToLineString = function (e) {
        this._isForcedToLineString = e
    }, Tp.prototype.interfaces_ = function () {
        return [fl]
    }, Tp.prototype.getClass = function () {
        return Tp
    }, Tp.getGeometry = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return e.getFactory().buildGeometry(Tp.getLines(e))
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return t.getFactory().buildGeometry(Tp.getLines(t, n))
        }
    }, Tp.getLines = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return Tp.getLines(e, !1)
        }
        if (2 === arguments.length) {
            if (Of(arguments[0], wl) && Of(arguments[1], wl)) {
                for (var t = arguments[0], n = arguments[1], r = t.iterator(); r.hasNext();) {
                    var i = r.next();
                    Tp.getLines(i, n)
                }
                return n
            }
            if (arguments[0] instanceof ll && "boolean" == typeof arguments[1]) {
                var s = arguments[0], o = arguments[1], u = new Tl;
                return s.apply(new Tp(u, o)), u
            }
            if (arguments[0] instanceof ll && Of(arguments[1], wl)) {
                var a = arguments[0], f = arguments[1];
                return a instanceof Ql ? f.add(a) : a.apply(new Tp(f)), f
            }
        } else if (3 === arguments.length) {
            if ("boolean" == typeof arguments[2] && Of(arguments[0], wl) && Of(arguments[1], wl)) {
                for (var l = arguments[0], c = arguments[1], h = arguments[2], p = l.iterator(); p.hasNext();) {
                    var d = p.next();
                    Tp.getLines(d, c, h)
                }
                return c
            }
            if ("boolean" == typeof arguments[2] && arguments[0] instanceof ll && Of(arguments[1], wl)) {
                var v = arguments[0], m = arguments[1], g = arguments[2];
                return v.apply(new Tp(m, g)), m
            }
        }
    };
    var Np = function () {
        if (this._boundaryRule = dl.OGC_SFS_BOUNDARY_RULE, this._isIn = null, this._numBoundaries = null, 0 !== arguments.length) if (1 === arguments.length) {
            var e = arguments[0];
            if (null === e) throw new yf("Rule must be non-null");
            this._boundaryRule = e
        }
    };
    Np.prototype.locateInternal = function () {
        if (arguments[0] instanceof Tf && arguments[1] instanceof ec) {
            var e = arguments[0], t = arguments[1];
            if (t.isEmpty()) return Lf.EXTERIOR;
            var n = t.getExteriorRing(), r = this.locateInPolygonRing(e, n);
            if (r === Lf.EXTERIOR) return Lf.EXTERIOR;
            if (r === Lf.BOUNDARY) return Lf.BOUNDARY;
            for (var i = 0; i < t.getNumInteriorRing(); i++) {
                var s = t.getInteriorRingN(i), o = this.locateInPolygonRing(e, s);
                if (o === Lf.INTERIOR) return Lf.EXTERIOR;
                if (o === Lf.BOUNDARY) return Lf.BOUNDARY
            }
            return Lf.INTERIOR
        }
        if (arguments[0] instanceof Tf && arguments[1] instanceof Ql) {
            var u = arguments[0], a = arguments[1];
            if (!a.getEnvelopeInternal().intersects(u)) return Lf.EXTERIOR;
            var f = a.getCoordinates();
            return a.isClosed() || !u.equals(f[0]) && !u.equals(f[f.length - 1]) ? ul.isOnLine(u, f) ? Lf.INTERIOR : Lf.EXTERIOR : Lf.BOUNDARY
        }
        if (arguments[0] instanceof Tf && arguments[1] instanceof Yl) {
            var l = arguments[0];
            return arguments[1].getCoordinate().equals2D(l) ? Lf.INTERIOR : Lf.EXTERIOR
        }
    }, Np.prototype.locateInPolygonRing = function (e, t) {
        return t.getEnvelopeInternal().intersects(e) ? ul.locatePointInRing(e, t.getCoordinates()) : Lf.EXTERIOR
    }, Np.prototype.intersects = function (e, t) {
        return this.locate(e, t) !== Lf.EXTERIOR
    }, Np.prototype.updateLocationInfo = function (e) {
        e === Lf.INTERIOR && (this._isIn = !0), e === Lf.BOUNDARY && this._numBoundaries++
    }, Np.prototype.computeLocation = function (e, t) {
        if (t instanceof Yl && this.updateLocationInfo(this.locateInternal(e, t)), t instanceof Ql) this.updateLocationInfo(this.locateInternal(e, t)); else if (t instanceof ec) this.updateLocationInfo(this.locateInternal(e, t)); else if (t instanceof Wl) for (var n = t, r = 0; r < n.getNumGeometries(); r++) {
            var i = n.getGeometryN(r);
            this.updateLocationInfo(this.locateInternal(e, i))
        } else if (t instanceof rc) for (var s = t, o = 0; o < s.getNumGeometries(); o++) {
            var u = s.getGeometryN(o);
            this.updateLocationInfo(this.locateInternal(e, u))
        } else if (t instanceof zl) for (var a = new Rh(t); a.hasNext();) {
            var f = a.next();
            f !== t && this.computeLocation(e, f)
        }
    }, Np.prototype.locate = function (e, t) {
        return t.isEmpty() ? Lf.EXTERIOR : t instanceof Ql ? this.locateInternal(e, t) : t instanceof ec ? this.locateInternal(e, t) : (this._isIn = !1, this._numBoundaries = 0, this.computeLocation(e, t), this._boundaryRule.isInBoundary(this._numBoundaries) ? Lf.BOUNDARY : this._numBoundaries > 0 || this._isIn ? Lf.INTERIOR : Lf.EXTERIOR)
    }, Np.prototype.interfaces_ = function () {
        return []
    }, Np.prototype.getClass = function () {
        return Np
    };
    var Cp = function zv() {
        if (this._component = null, this._segIndex = null, this._pt = null, 2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            zv.call(this, e, zv.INSIDE_AREA, t)
        } else if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2];
            this._component = n, this._segIndex = r, this._pt = i
        }
    }, kp = {INSIDE_AREA: {configurable: !0}};
    Cp.prototype.isInsideArea = function () {
        return this._segIndex === Cp.INSIDE_AREA
    }, Cp.prototype.getCoordinate = function () {
        return this._pt
    }, Cp.prototype.getGeometryComponent = function () {
        return this._component
    }, Cp.prototype.getSegmentIndex = function () {
        return this._segIndex
    }, Cp.prototype.interfaces_ = function () {
        return []
    }, Cp.prototype.getClass = function () {
        return Cp
    }, kp.INSIDE_AREA.get = function () {
        return -1
    }, Object.defineProperties(Cp, kp);
    var Lp = function (e) {
        this._pts = e || null
    };
    Lp.prototype.filter = function (e) {
        e instanceof Yl && this._pts.add(e)
    }, Lp.prototype.interfaces_ = function () {
        return [Rl]
    }, Lp.prototype.getClass = function () {
        return Lp
    }, Lp.getPoints = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return e instanceof Yl ? eh.singletonList(e) : Lp.getPoints(e, new Tl)
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return t instanceof Yl ? n.add(t) : t instanceof zl && t.apply(new Lp(n)), n
        }
    };
    var Ap = function () {
        this._locations = null;
        var e = arguments[0];
        this._locations = e
    };
    Ap.prototype.filter = function (e) {
        (e instanceof Yl || e instanceof Ql || e instanceof ec) && this._locations.add(new Cp(e, 0, e.getCoordinate()))
    }, Ap.prototype.interfaces_ = function () {
        return [Rl]
    }, Ap.prototype.getClass = function () {
        return Ap
    }, Ap.getLocations = function (e) {
        var t = new Tl;
        return e.apply(new Ap(t)), t
    };
    var Op = function () {
        if (this._geom = null, this._terminateDistance = 0, this._ptLocator = new Np, this._minDistanceLocation = null, this._minDistance = bf.MAX_VALUE, 2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            this._geom = [e, t], this._terminateDistance = 0
        } else if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2];
            this._geom = (new Array(2)).fill(null), this._geom[0] = n, this._geom[1] = r, this._terminateDistance = i
        }
    };
    Op.prototype.computeContainmentDistance = function () {
        if (0 === arguments.length) {
            var e = (new Array(2)).fill(null);
            if (this.computeContainmentDistance(0, e), this._minDistance <= this._terminateDistance) return null;
            this.computeContainmentDistance(1, e)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = 1 - t, i = xp.getPolygons(this._geom[t]);
            if (i.size() > 0) {
                var s = Ap.getLocations(this._geom[r]);
                if (this.computeContainmentDistance(s, i, n), this._minDistance <= this._terminateDistance) return this._minDistanceLocation[r] = n[0], this._minDistanceLocation[t] = n[1], null
            }
        } else if (3 === arguments.length) if (arguments[2] instanceof Array && Of(arguments[0], xl) && Of(arguments[1], xl)) {
            for (var o = arguments[0], u = arguments[1], a = arguments[2], f = 0; f < o.size(); f++) for (var l = o.get(f), c = 0; c < u.size(); c++) if (this.computeContainmentDistance(l, u.get(c), a), this._minDistance <= this._terminateDistance) return null
        } else if (arguments[2] instanceof Array && arguments[0] instanceof Cp && arguments[1] instanceof ec) {
            var h = arguments[0], p = arguments[1], d = arguments[2], v = h.getCoordinate();
            if (Lf.EXTERIOR !== this._ptLocator.locate(v, p)) return this._minDistance = 0, d[0] = h, d[1] = new Cp(p, v), null
        }
    }, Op.prototype.computeMinDistanceLinesPoints = function (e, t, n) {
        for (var r = 0; r < e.size(); r++) for (var i = e.get(r), s = 0; s < t.size(); s++) {
            var o = t.get(s);
            if (this.computeMinDistance(i, o, n), this._minDistance <= this._terminateDistance) return null
        }
    }, Op.prototype.computeFacetDistance = function () {
        var e = (new Array(2)).fill(null), t = Tp.getLines(this._geom[0]), n = Tp.getLines(this._geom[1]),
            r = Lp.getPoints(this._geom[0]), i = Lp.getPoints(this._geom[1]);
        return this.computeMinDistanceLines(t, n, e), this.updateMinDistance(e, !1), this._minDistance <= this._terminateDistance ? null : (e[0] = null, e[1] = null, this.computeMinDistanceLinesPoints(t, i, e), this.updateMinDistance(e, !1), this._minDistance <= this._terminateDistance ? null : (e[0] = null, e[1] = null, this.computeMinDistanceLinesPoints(n, r, e), this.updateMinDistance(e, !0), this._minDistance <= this._terminateDistance ? null : (e[0] = null, e[1] = null, this.computeMinDistancePoints(r, i, e), void this.updateMinDistance(e, !1))))
    }, Op.prototype.nearestLocations = function () {
        return this.computeMinDistance(), this._minDistanceLocation
    }, Op.prototype.updateMinDistance = function (e, t) {
        if (null === e[0]) return null;
        t ? (this._minDistanceLocation[0] = e[1], this._minDistanceLocation[1] = e[0]) : (this._minDistanceLocation[0] = e[0], this._minDistanceLocation[1] = e[1])
    }, Op.prototype.nearestPoints = function () {
        return this.computeMinDistance(), [this._minDistanceLocation[0].getCoordinate(), this._minDistanceLocation[1].getCoordinate()]
    }, Op.prototype.computeMinDistance = function () {
        if (0 === arguments.length) {
            if (null !== this._minDistanceLocation) return null;
            if (this._minDistanceLocation = (new Array(2)).fill(null), this.computeContainmentDistance(), this._minDistance <= this._terminateDistance) return null;
            this.computeFacetDistance()
        } else if (3 === arguments.length) if (arguments[2] instanceof Array && arguments[0] instanceof Ql && arguments[1] instanceof Yl) {
            var e = arguments[0], t = arguments[1], n = arguments[2];
            if (e.getEnvelopeInternal().distance(t.getEnvelopeInternal()) > this._minDistance) return null;
            for (var r = e.getCoordinates(), i = t.getCoordinate(), s = 0; s < r.length - 1; s++) {
                var o = ul.distancePointLine(i, r[s], r[s + 1]);
                if (o < this._minDistance) {
                    this._minDistance = o;
                    var u = (new vh(r[s], r[s + 1])).closestPoint(i);
                    n[0] = new Cp(e, s, u), n[1] = new Cp(t, 0, i)
                }
                if (this._minDistance <= this._terminateDistance) return null
            }
        } else if (arguments[2] instanceof Array && arguments[0] instanceof Ql && arguments[1] instanceof Ql) {
            var a = arguments[0], f = arguments[1], l = arguments[2];
            if (a.getEnvelopeInternal().distance(f.getEnvelopeInternal()) > this._minDistance) return null;
            for (var c = a.getCoordinates(), h = f.getCoordinates(), p = 0; p < c.length - 1; p++) for (var d = 0; d < h.length - 1; d++) {
                var v = ul.distanceLineLine(c[p], c[p + 1], h[d], h[d + 1]);
                if (v < this._minDistance) {
                    this._minDistance = v;
                    var m = new vh(c[p], c[p + 1]), g = new vh(h[d], h[d + 1]), y = m.closestPoints(g);
                    l[0] = new Cp(a, p, y[0]), l[1] = new Cp(f, d, y[1])
                }
                if (this._minDistance <= this._terminateDistance) return null
            }
        }
    }, Op.prototype.computeMinDistancePoints = function (e, t, n) {
        for (var r = 0; r < e.size(); r++) for (var i = e.get(r), s = 0; s < t.size(); s++) {
            var o = t.get(s), u = i.getCoordinate().distance(o.getCoordinate());
            if (u < this._minDistance && (this._minDistance = u, n[0] = new Cp(i, 0, i.getCoordinate()), n[1] = new Cp(o, 0, o.getCoordinate())), this._minDistance <= this._terminateDistance) return null
        }
    }, Op.prototype.distance = function () {
        if (null === this._geom[0] || null === this._geom[1]) throw new yf("null geometries are not supported");
        return this._geom[0].isEmpty() || this._geom[1].isEmpty() ? 0 : (this.computeMinDistance(), this._minDistance)
    }, Op.prototype.computeMinDistanceLines = function (e, t, n) {
        for (var r = 0; r < e.size(); r++) for (var i = e.get(r), s = 0; s < t.size(); s++) {
            var o = t.get(s);
            if (this.computeMinDistance(i, o, n), this._minDistance <= this._terminateDistance) return null
        }
    }, Op.prototype.interfaces_ = function () {
        return []
    }, Op.prototype.getClass = function () {
        return Op
    }, Op.distance = function (e, t) {
        return (new Op(e, t)).distance()
    }, Op.isWithinDistance = function (e, t, n) {
        return (new Op(e, t, n)).distance() <= n
    }, Op.nearestPoints = function (e, t) {
        return (new Op(e, t)).nearestPoints()
    };
    var Mp = function () {
        this._pt = [new Tf, new Tf], this._distance = bf.NaN, this._isNull = !0
    };
    Mp.prototype.getCoordinates = function () {
        return this._pt
    }, Mp.prototype.getCoordinate = function (e) {
        return this._pt[e]
    }, Mp.prototype.setMinimum = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.setMinimum(e._pt[0], e._pt[1])
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            if (this._isNull) return this.initialize(t, n), null;
            var r = t.distance(n);
            r < this._distance && this.initialize(t, n, r)
        }
    }, Mp.prototype.initialize = function () {
        if (0 === arguments.length) this._isNull = !0; else if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            this._pt[0].setCoordinate(e), this._pt[1].setCoordinate(t), this._distance = e.distance(t), this._isNull = !1
        } else if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2];
            this._pt[0].setCoordinate(n), this._pt[1].setCoordinate(r), this._distance = i, this._isNull = !1
        }
    }, Mp.prototype.toString = function () {
        return Yf.toLineString(this._pt[0], this._pt[1])
    }, Mp.prototype.getDistance = function () {
        return this._distance
    }, Mp.prototype.setMaximum = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            this.setMaximum(e._pt[0], e._pt[1])
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            if (this._isNull) return this.initialize(t, n), null;
            var r = t.distance(n);
            r > this._distance && this.initialize(t, n, r)
        }
    }, Mp.prototype.interfaces_ = function () {
        return []
    }, Mp.prototype.getClass = function () {
        return Mp
    };
    var _p = function () {
    };
    _p.prototype.interfaces_ = function () {
        return []
    }, _p.prototype.getClass = function () {
        return _p
    }, _p.computeDistance = function () {
        if (arguments[2] instanceof Mp && arguments[0] instanceof Ql && arguments[1] instanceof Tf) for (var e = arguments[0], t = arguments[1], n = arguments[2], r = new vh, i = e.getCoordinates(), s = 0; s < i.length - 1; s++) {
            r.setCoordinates(i[s], i[s + 1]);
            var o = r.closestPoint(t);
            n.setMinimum(o, t)
        } else if (arguments[2] instanceof Mp && arguments[0] instanceof ec && arguments[1] instanceof Tf) {
            var u = arguments[0], a = arguments[1], f = arguments[2];
            _p.computeDistance(u.getExteriorRing(), a, f);
            for (var l = 0; l < u.getNumInteriorRing(); l++) _p.computeDistance(u.getInteriorRingN(l), a, f)
        } else if (arguments[2] instanceof Mp && arguments[0] instanceof ll && arguments[1] instanceof Tf) {
            var c = arguments[0], h = arguments[1], p = arguments[2];
            if (c instanceof Ql) _p.computeDistance(c, h, p); else if (c instanceof ec) _p.computeDistance(c, h, p); else if (c instanceof zl) for (var d = c, v = 0; v < d.getNumGeometries(); v++) {
                var m = d.getGeometryN(v);
                _p.computeDistance(m, h, p)
            } else p.setMinimum(c.getCoordinate(), h)
        } else if (arguments[2] instanceof Mp && arguments[0] instanceof vh && arguments[1] instanceof Tf) {
            var g = arguments[0], y = arguments[1], b = arguments[2], w = g.closestPoint(y);
            b.setMinimum(w, y)
        }
    };
    var Dp = function () {
        this._g0 = null, this._g1 = null, this._ptDist = new Mp, this._densifyFrac = 0;
        var e = arguments[0], t = arguments[1];
        this._g0 = e, this._g1 = t
    }, Pp = {MaxPointDistanceFilter: {configurable: !0}, MaxDensifiedByFractionDistanceFilter: {configurable: !0}};
    Dp.prototype.getCoordinates = function () {
        return this._ptDist.getCoordinates()
    }, Dp.prototype.setDensifyFraction = function (e) {
        if (e > 1 || e <= 0) throw new yf("Fraction is not in range (0.0 - 1.0]");
        this._densifyFrac = e
    }, Dp.prototype.compute = function (e, t) {
        this.computeOrientedDistance(e, t, this._ptDist), this.computeOrientedDistance(t, e, this._ptDist)
    }, Dp.prototype.distance = function () {
        return this.compute(this._g0, this._g1), this._ptDist.getDistance()
    }, Dp.prototype.computeOrientedDistance = function (e, t, n) {
        var r = new Hp(t);
        if (e.apply(r), n.setMaximum(r.getMaxPointDistance()), this._densifyFrac > 0) {
            var i = new Bp(t, this._densifyFrac);
            e.apply(i), n.setMaximum(i.getMaxPointDistance())
        }
    }, Dp.prototype.orientedDistance = function () {
        return this.computeOrientedDistance(this._g0, this._g1, this._ptDist), this._ptDist.getDistance()
    }, Dp.prototype.interfaces_ = function () {
        return []
    }, Dp.prototype.getClass = function () {
        return Dp
    }, Dp.distance = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            return (new Dp(e, t)).distance()
        }
        if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2], s = new Dp(n, r);
            return s.setDensifyFraction(i), s.distance()
        }
    }, Pp.MaxPointDistanceFilter.get = function () {
        return Hp
    }, Pp.MaxDensifiedByFractionDistanceFilter.get = function () {
        return Bp
    }, Object.defineProperties(Dp, Pp);
    var Hp = function () {
        this._maxPtDist = new Mp, this._minPtDist = new Mp, this._euclideanDist = new _p, this._geom = null;
        var e = arguments[0];
        this._geom = e
    };
    Hp.prototype.filter = function (e) {
        this._minPtDist.initialize(), _p.computeDistance(this._geom, e, this._minPtDist), this._maxPtDist.setMaximum(this._minPtDist)
    }, Hp.prototype.getMaxPointDistance = function () {
        return this._maxPtDist
    }, Hp.prototype.interfaces_ = function () {
        return [pl]
    }, Hp.prototype.getClass = function () {
        return Hp
    };
    var Bp = function () {
        this._maxPtDist = new Mp, this._minPtDist = new Mp, this._geom = null, this._numSubSegs = 0;
        var e = arguments[0], t = arguments[1];
        this._geom = e, this._numSubSegs = Math.trunc(Math.round(1 / t))
    };
    Bp.prototype.filter = function (e, t) {
        if (0 === t) return null;
        for (var n = e.getCoordinate(t - 1), r = e.getCoordinate(t), i = (r.x - n.x) / this._numSubSegs, s = (r.y - n.y) / this._numSubSegs, o = 0; o < this._numSubSegs; o++) {
            var u = n.x + o * i, a = n.y + o * s, f = new Tf(u, a);
            this._minPtDist.initialize(), _p.computeDistance(this._geom, f, this._minPtDist), this._maxPtDist.setMaximum(this._minPtDist)
        }
    }, Bp.prototype.isDone = function () {
        return !1
    }, Bp.prototype.isGeometryChanged = function () {
        return !1
    }, Bp.prototype.getMaxPointDistance = function () {
        return this._maxPtDist
    }, Bp.prototype.interfaces_ = function () {
        return [Ul]
    }, Bp.prototype.getClass = function () {
        return Bp
    };
    var jp = function (e, t, n) {
        this._minValidDistance = null, this._maxValidDistance = null, this._minDistanceFound = null, this._maxDistanceFound = null, this._isValid = !0, this._errMsg = null, this._errorLocation = null, this._errorIndicator = null, this._input = e || null, this._bufDistance = t || null, this._result = n || null
    }, Fp = {VERBOSE: {configurable: !0}, MAX_DISTANCE_DIFF_FRAC: {configurable: !0}};
    jp.prototype.checkMaximumDistance = function (e, t, n) {
        var r = new Dp(t, e);
        if (r.setDensifyFraction(.25), this._maxDistanceFound = r.orientedDistance(), this._maxDistanceFound > n) {
            this._isValid = !1;
            var i = r.getCoordinates();
            this._errorLocation = i[1], this._errorIndicator = e.getFactory().createLineString(i), this._errMsg = "Distance between buffer curve and input is too large (" + this._maxDistanceFound + " at " + Yf.toLineString(i[0], i[1]) + ")"
        }
    }, jp.prototype.isValid = function () {
        var e = Math.abs(this._bufDistance), t = jp.MAX_DISTANCE_DIFF_FRAC * e;
        return this._minValidDistance = e - t, this._maxValidDistance = e + t, !!this._input.isEmpty() || !!this._result.isEmpty() || (this._bufDistance > 0 ? this.checkPositiveValid() : this.checkNegativeValid(), jp.VERBOSE && Wf.out.println("Min Dist= " + this._minDistanceFound + "  err= " + (1 - this._minDistanceFound / this._bufDistance) + "  Max Dist= " + this._maxDistanceFound + "  err= " + (this._maxDistanceFound / this._bufDistance - 1)), this._isValid)
    }, jp.prototype.checkNegativeValid = function () {
        if (!(this._input instanceof ec || this._input instanceof rc || this._input instanceof zl)) return null;
        var e = this.getPolygonLines(this._input);
        if (this.checkMinimumDistance(e, this._result, this._minValidDistance), !this._isValid) return null;
        this.checkMaximumDistance(e, this._result, this._maxValidDistance)
    }, jp.prototype.getErrorIndicator = function () {
        return this._errorIndicator
    }, jp.prototype.checkMinimumDistance = function (e, t, n) {
        var r = new Op(e, t, n);
        if (this._minDistanceFound = r.distance(), this._minDistanceFound < n) {
            this._isValid = !1;
            var i = r.nearestPoints();
            this._errorLocation = r.nearestPoints()[1], this._errorIndicator = e.getFactory().createLineString(i), this._errMsg = "Distance between buffer curve and input is too small (" + this._minDistanceFound + " at " + Yf.toLineString(i[0], i[1]) + " )"
        }
    }, jp.prototype.checkPositiveValid = function () {
        var e = this._result.getBoundary();
        if (this.checkMinimumDistance(this._input, e, this._minValidDistance), !this._isValid) return null;
        this.checkMaximumDistance(this._input, e, this._maxValidDistance)
    }, jp.prototype.getErrorLocation = function () {
        return this._errorLocation
    }, jp.prototype.getPolygonLines = function (e) {
        for (var t = new Tl, n = new Tp(t), r = xp.getPolygons(e).iterator(); r.hasNext();) r.next().apply(n);
        return e.getFactory().buildGeometry(t)
    }, jp.prototype.getErrorMessage = function () {
        return this._errMsg
    }, jp.prototype.interfaces_ = function () {
        return []
    }, jp.prototype.getClass = function () {
        return jp
    }, Fp.VERBOSE.get = function () {
        return !1
    }, Fp.MAX_DISTANCE_DIFF_FRAC.get = function () {
        return .012
    }, Object.defineProperties(jp, Fp);
    var Ip = function (e, t, n) {
        this._isValid = !0, this._errorMsg = null, this._errorLocation = null, this._errorIndicator = null, this._input = e || null, this._distance = t || null, this._result = n || null
    }, qp = {VERBOSE: {configurable: !0}, MAX_ENV_DIFF_FRAC: {configurable: !0}};
    Ip.prototype.isValid = function () {
        return this.checkPolygonal(), this._isValid ? (this.checkExpectedEmpty(), this._isValid ? (this.checkEnvelope(), this._isValid ? (this.checkArea(), this._isValid ? (this.checkDistance(), this._isValid) : this._isValid) : this._isValid) : this._isValid) : this._isValid
    }, Ip.prototype.checkEnvelope = function () {
        if (this._distance < 0) return null;
        var e = this._distance * Ip.MAX_ENV_DIFF_FRAC;
        0 === e && (e = .001);
        var t = new Vf(this._input.getEnvelopeInternal());
        t.expandBy(this._distance);
        var n = new Vf(this._result.getEnvelopeInternal());
        n.expandBy(e), n.contains(t) || (this._isValid = !1, this._errorMsg = "Buffer envelope is incorrect", this._errorIndicator = this._input.getFactory().toGeometry(n)), this.report("Envelope")
    }, Ip.prototype.checkDistance = function () {
        var e = new jp(this._input, this._distance, this._result);
        e.isValid() || (this._isValid = !1, this._errorMsg = e.getErrorMessage(), this._errorLocation = e.getErrorLocation(), this._errorIndicator = e.getErrorIndicator()), this.report("Distance")
    }, Ip.prototype.checkArea = function () {
        var e = this._input.getArea(), t = this._result.getArea();
        this._distance > 0 && e > t && (this._isValid = !1, this._errorMsg = "Area of positive buffer is smaller than input", this._errorIndicator = this._result), this._distance < 0 && e < t && (this._isValid = !1, this._errorMsg = "Area of negative buffer is larger than input", this._errorIndicator = this._result), this.report("Area")
    }, Ip.prototype.checkPolygonal = function () {
        this._result instanceof ec || this._result instanceof rc || (this._isValid = !1), this._errorMsg = "Result is not polygonal", this._errorIndicator = this._result, this.report("Polygonal")
    }, Ip.prototype.getErrorIndicator = function () {
        return this._errorIndicator
    }, Ip.prototype.getErrorLocation = function () {
        return this._errorLocation
    }, Ip.prototype.checkExpectedEmpty = function () {
        return this._input.getDimension() >= 2 ? null : this._distance > 0 ? null : (this._result.isEmpty() || (this._isValid = !1, this._errorMsg = "Result is non-empty", this._errorIndicator = this._result), void this.report("ExpectedEmpty"))
    }, Ip.prototype.report = function (e) {
        if (!Ip.VERBOSE) return null;
        Wf.out.println("Check " + e + ": " + (this._isValid ? "passed" : "FAILED"))
    }, Ip.prototype.getErrorMessage = function () {
        return this._errorMsg
    }, Ip.prototype.interfaces_ = function () {
        return []
    }, Ip.prototype.getClass = function () {
        return Ip
    }, Ip.isValidMsg = function (e, t, n) {
        var r = new Ip(e, t, n);
        return r.isValid() ? null : r.getErrorMessage()
    }, Ip.isValid = function (e, t, n) {
        return !!(new Ip(e, t, n)).isValid()
    }, qp.VERBOSE.get = function () {
        return !1
    }, qp.MAX_ENV_DIFF_FRAC.get = function () {
        return .012
    }, Object.defineProperties(Ip, qp);
    var Rp = function () {
        this._pts = null, this._data = null;
        var e = arguments[0], t = arguments[1];
        this._pts = e, this._data = t
    };
    Rp.prototype.getCoordinates = function () {
        return this._pts
    }, Rp.prototype.size = function () {
        return this._pts.length
    }, Rp.prototype.getCoordinate = function (e) {
        return this._pts[e]
    }, Rp.prototype.isClosed = function () {
        return this._pts[0].equals(this._pts[this._pts.length - 1])
    }, Rp.prototype.getSegmentOctant = function (e) {
        return e === this._pts.length - 1 ? -1 : ch.octant(this.getCoordinate(e), this.getCoordinate(e + 1))
    }, Rp.prototype.setData = function (e) {
        this._data = e
    }, Rp.prototype.getData = function () {
        return this._data
    }, Rp.prototype.toString = function () {
        return Yf.toLineString(new fc(this._pts))
    }, Rp.prototype.interfaces_ = function () {
        return [hh]
    }, Rp.prototype.getClass = function () {
        return Rp
    };
    var Up = function () {
        this._findAllIntersections = !1, this._isCheckEndSegmentsOnly = !1, this._li = null, this._interiorIntersection = null, this._intSegments = null, this._intersections = new Tl, this._intersectionCount = 0, this._keepIntersections = !0;
        var e = arguments[0];
        this._li = e, this._interiorIntersection = null
    };
    Up.prototype.getInteriorIntersection = function () {
        return this._interiorIntersection
    }, Up.prototype.setCheckEndSegmentsOnly = function (e) {
        this._isCheckEndSegmentsOnly = e
    }, Up.prototype.getIntersectionSegments = function () {
        return this._intSegments
    }, Up.prototype.count = function () {
        return this._intersectionCount
    }, Up.prototype.getIntersections = function () {
        return this._intersections
    }, Up.prototype.setFindAllIntersections = function (e) {
        this._findAllIntersections = e
    }, Up.prototype.setKeepIntersections = function (e) {
        this._keepIntersections = e
    }, Up.prototype.processIntersections = function (e, t, n, r) {
        if (!this._findAllIntersections && this.hasIntersection()) return null;
        if (e === n && t === r) return null;
        if (this._isCheckEndSegmentsOnly && !this.isEndSegment(e, t) && !this.isEndSegment(n, r)) return null;
        var i = e.getCoordinates()[t], s = e.getCoordinates()[t + 1], o = n.getCoordinates()[r],
            u = n.getCoordinates()[r + 1];
        this._li.computeIntersection(i, s, o, u), this._li.hasIntersection() && this._li.isInteriorIntersection() && (this._intSegments = (new Array(4)).fill(null), this._intSegments[0] = i, this._intSegments[1] = s, this._intSegments[2] = o, this._intSegments[3] = u, this._interiorIntersection = this._li.getIntersection(0), this._keepIntersections && this._intersections.add(this._interiorIntersection), this._intersectionCount++)
    }, Up.prototype.isEndSegment = function (e, t) {
        return 0 === t || t >= e.size() - 2
    }, Up.prototype.hasIntersection = function () {
        return null !== this._interiorIntersection
    }, Up.prototype.isDone = function () {
        return !this._findAllIntersections && null !== this._interiorIntersection
    }, Up.prototype.interfaces_ = function () {
        return [Jh]
    }, Up.prototype.getClass = function () {
        return Up
    }, Up.createAllIntersectionsFinder = function (e) {
        var t = new Up(e);
        return t.setFindAllIntersections(!0), t
    }, Up.createAnyIntersectionFinder = function (e) {
        return new Up(e)
    }, Up.createIntersectionCounter = function (e) {
        var t = new Up(e);
        return t.setFindAllIntersections(!0), t.setKeepIntersections(!1), t
    };
    var zp = function () {
        this._li = new il, this._segStrings = null, this._findAllIntersections = !1, this._segInt = null, this._isValid = !0;
        var e = arguments[0];
        this._segStrings = e
    };
    zp.prototype.execute = function () {
        if (null !== this._segInt) return null;
        this.checkInteriorIntersections()
    }, zp.prototype.getIntersections = function () {
        return this._segInt.getIntersections()
    }, zp.prototype.isValid = function () {
        return this.execute(), this._isValid
    }, zp.prototype.setFindAllIntersections = function (e) {
        this._findAllIntersections = e
    }, zp.prototype.checkInteriorIntersections = function () {
        this._isValid = !0, this._segInt = new Up(this._li), this._segInt.setFindAllIntersections(this._findAllIntersections);
        var e = new Sh;
        if (e.setSegmentIntersector(this._segInt), e.computeNodes(this._segStrings), this._segInt.hasIntersection()) return this._isValid = !1, null
    }, zp.prototype.checkValid = function () {
        if (this.execute(), !this._isValid) throw new Ac(this.getErrorMessage(), this._segInt.getInteriorIntersection())
    }, zp.prototype.getErrorMessage = function () {
        if (this._isValid) return "no intersections found";
        var e = this._segInt.getIntersectionSegments();
        return "found non-noded intersection between " + Yf.toLineString(e[0], e[1]) + " and " + Yf.toLineString(e[2], e[3])
    }, zp.prototype.interfaces_ = function () {
        return []
    }, zp.prototype.getClass = function () {
        return zp
    }, zp.computeIntersections = function (e) {
        var t = new zp(e);
        return t.setFindAllIntersections(!0), t.isValid(), t.getIntersections()
    };
    var Wp = function Wv() {
        this._nv = null;
        var e = arguments[0];
        this._nv = new zp(Wv.toSegmentStrings(e))
    };
    Wp.prototype.checkValid = function () {
        this._nv.checkValid()
    }, Wp.prototype.interfaces_ = function () {
        return []
    }, Wp.prototype.getClass = function () {
        return Wp
    }, Wp.toSegmentStrings = function (e) {
        for (var t = new Tl, n = e.iterator(); n.hasNext();) {
            var r = n.next();
            t.add(new Rp(r.getCoordinates(), r))
        }
        return t
    }, Wp.checkValid = function (e) {
        (new Wp(e)).checkValid()
    };
    var Xp = function (e) {
        this._mapOp = e
    };
    Xp.prototype.map = function (e) {
        for (var t = new Tl, n = 0; n < e.getNumGeometries(); n++) {
            var r = this._mapOp.map(e.getGeometryN(n));
            r.isEmpty() || t.add(r)
        }
        return e.getFactory().createGeometryCollection(yc.toGeometryArray(t))
    }, Xp.prototype.interfaces_ = function () {
        return []
    }, Xp.prototype.getClass = function () {
        return Xp
    }, Xp.map = function (e, t) {
        return (new Xp(t)).map(e)
    };
    var Vp = function () {
        this._op = null, this._geometryFactory = null, this._ptLocator = null, this._lineEdgesList = new Tl, this._resultLineList = new Tl;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        this._op = e, this._geometryFactory = t, this._ptLocator = n
    };
    Vp.prototype.collectLines = function (e) {
        for (var t = this._op.getGraph().getEdgeEnds().iterator(); t.hasNext();) {
            var n = t.next();
            this.collectLineEdge(n, e, this._lineEdgesList), this.collectBoundaryTouchEdge(n, e, this._lineEdgesList)
        }
    }, Vp.prototype.labelIsolatedLine = function (e, t) {
        var n = this._ptLocator.locate(e.getCoordinate(), this._op.getArgGeometry(t));
        e.getLabel().setLocation(t, n)
    }, Vp.prototype.build = function (e) {
        return this.findCoveredLineEdges(), this.collectLines(e), this.buildLines(e), this._resultLineList
    }, Vp.prototype.collectLineEdge = function (e, t, n) {
        var r = e.getLabel(), i = e.getEdge();
        e.isLineEdge() && (e.isVisited() || !Cd.isResultOfOp(r, t) || i.isCovered() || (n.add(i), e.setVisitedEdge(!0)))
    }, Vp.prototype.findCoveredLineEdges = function () {
        for (var e = this._op.getGraph().getNodes().iterator(); e.hasNext();) e.next().getEdges().findCoveredLineEdges();
        for (var t = this._op.getGraph().getEdgeEnds().iterator(); t.hasNext();) {
            var n = t.next(), r = n.getEdge();
            if (n.isLineEdge() && !r.isCoveredSet()) {
                var i = this._op.isCoveredByA(n.getCoordinate());
                r.setCovered(i)
            }
        }
    }, Vp.prototype.labelIsolatedLines = function (e) {
        for (var t = e.iterator(); t.hasNext();) {
            var n = t.next(), r = n.getLabel();
            n.isIsolated() && (r.isNull(0) ? this.labelIsolatedLine(n, 0) : this.labelIsolatedLine(n, 1))
        }
    }, Vp.prototype.buildLines = function (e) {
        for (var t = this._lineEdgesList.iterator(); t.hasNext();) {
            var n = t.next(), r = this._geometryFactory.createLineString(n.getCoordinates());
            this._resultLineList.add(r), n.setInResult(!0)
        }
    }, Vp.prototype.collectBoundaryTouchEdge = function (e, t, n) {
        var r = e.getLabel();
        return e.isLineEdge() ? null : e.isVisited() ? null : e.isInteriorAreaEdge() ? null : e.getEdge().isInResult() ? null : (tl.isTrue(!e.isInResult() && !e.getSym().isInResult() || !e.getEdge().isInResult()), void (Cd.isResultOfOp(r, t) && t === Cd.INTERSECTION && (n.add(e.getEdge()), e.setVisitedEdge(!0))))
    }, Vp.prototype.interfaces_ = function () {
        return []
    }, Vp.prototype.getClass = function () {
        return Vp
    };
    var $p = function () {
        this._op = null, this._geometryFactory = null, this._resultPointList = new Tl;
        var e = arguments[0], t = arguments[1];
        this._op = e, this._geometryFactory = t
    };
    $p.prototype.filterCoveredNodeToPoint = function (e) {
        var t = e.getCoordinate();
        if (!this._op.isCoveredByLA(t)) {
            var n = this._geometryFactory.createPoint(t);
            this._resultPointList.add(n)
        }
    }, $p.prototype.extractNonCoveredResultNodes = function (e) {
        for (var t = this._op.getGraph().getNodes().iterator(); t.hasNext();) {
            var n = t.next();
            if (!n.isInResult() && !n.isIncidentEdgeInResult() && (0 === n.getEdges().getDegree() || e === Cd.INTERSECTION)) {
                var r = n.getLabel();
                Cd.isResultOfOp(r, e) && this.filterCoveredNodeToPoint(n)
            }
        }
    }, $p.prototype.build = function (e) {
        return this.extractNonCoveredResultNodes(e), this._resultPointList
    }, $p.prototype.interfaces_ = function () {
        return []
    }, $p.prototype.getClass = function () {
        return $p
    };
    var Jp = function () {
        this._inputGeom = null, this._factory = null, this._pruneEmptyGeometry = !0, this._preserveGeometryCollectionType = !0, this._preserveCollections = !1, this._preserveType = !1
    };
    Jp.prototype.transformPoint = function (e, t) {
        return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(), e))
    }, Jp.prototype.transformPolygon = function (e, t) {
        var n = !0, r = this.transformLinearRing(e.getExteriorRing(), e);
        null !== r && r instanceof nc && !r.isEmpty() || (n = !1);
        for (var i = new Tl, s = 0; s < e.getNumInteriorRing(); s++) {
            var o = this.transformLinearRing(e.getInteriorRingN(s), e);
            null === o || o.isEmpty() || (o instanceof nc || (n = !1), i.add(o))
        }
        if (n) return this._factory.createPolygon(r, i.toArray([]));
        var u = new Tl;
        return null !== r && u.add(r), u.addAll(i), this._factory.buildGeometry(u)
    }, Jp.prototype.createCoordinateSequence = function (e) {
        return this._factory.getCoordinateSequenceFactory().create(e)
    }, Jp.prototype.getInputGeometry = function () {
        return this._inputGeom
    }, Jp.prototype.transformMultiLineString = function (e, t) {
        for (var n = new Tl, r = 0; r < e.getNumGeometries(); r++) {
            var i = this.transformLineString(e.getGeometryN(r), e);
            null !== i && (i.isEmpty() || n.add(i))
        }
        return this._factory.buildGeometry(n)
    }, Jp.prototype.transformCoordinates = function (e, t) {
        return this.copy(e)
    }, Jp.prototype.transformLineString = function (e, t) {
        return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(), e))
    }, Jp.prototype.transformMultiPoint = function (e, t) {
        for (var n = new Tl, r = 0; r < e.getNumGeometries(); r++) {
            var i = this.transformPoint(e.getGeometryN(r), e);
            null !== i && (i.isEmpty() || n.add(i))
        }
        return this._factory.buildGeometry(n)
    }, Jp.prototype.transformMultiPolygon = function (e, t) {
        for (var n = new Tl, r = 0; r < e.getNumGeometries(); r++) {
            var i = this.transformPolygon(e.getGeometryN(r), e);
            null !== i && (i.isEmpty() || n.add(i))
        }
        return this._factory.buildGeometry(n)
    }, Jp.prototype.copy = function (e) {
        return e.copy()
    }, Jp.prototype.transformGeometryCollection = function (e, t) {
        for (var n = new Tl, r = 0; r < e.getNumGeometries(); r++) {
            var i = this.transform(e.getGeometryN(r));
            null !== i && (this._pruneEmptyGeometry && i.isEmpty() || n.add(i))
        }
        return this._preserveGeometryCollectionType ? this._factory.createGeometryCollection(yc.toGeometryArray(n)) : this._factory.buildGeometry(n)
    }, Jp.prototype.transform = function (e) {
        if (this._inputGeom = e, this._factory = e.getFactory(), e instanceof Yl) return this.transformPoint(e, null);
        if (e instanceof tc) return this.transformMultiPoint(e, null);
        if (e instanceof nc) return this.transformLinearRing(e, null);
        if (e instanceof Ql) return this.transformLineString(e, null);
        if (e instanceof Wl) return this.transformMultiLineString(e, null);
        if (e instanceof ec) return this.transformPolygon(e, null);
        if (e instanceof rc) return this.transformMultiPolygon(e, null);
        if (e instanceof zl) return this.transformGeometryCollection(e, null);
        throw new yf("Unknown Geometry subtype: " + e.getClass().getName())
    }, Jp.prototype.transformLinearRing = function (e, t) {
        var n = this.transformCoordinates(e.getCoordinateSequence(), e);
        if (null === n) return this._factory.createLinearRing(null);
        var r = n.size();
        return r > 0 && r < 4 && !this._preserveType ? this._factory.createLineString(n) : this._factory.createLinearRing(n)
    }, Jp.prototype.interfaces_ = function () {
        return []
    }, Jp.prototype.getClass = function () {
        return Jp
    };
    var Kp = function Xv() {
        if (this._snapTolerance = 0, this._srcPts = null, this._seg = new vh, this._allowSnappingToSourceVertices = !1, this._isClosed = !1, arguments[0] instanceof Ql && "number" == typeof arguments[1]) {
            var e = arguments[0], t = arguments[1];
            Xv.call(this, e.getCoordinates(), t)
        } else if (arguments[0] instanceof Array && "number" == typeof arguments[1]) {
            var n = arguments[0], r = arguments[1];
            this._srcPts = n, this._isClosed = Xv.isClosed(n), this._snapTolerance = r
        }
    };
    Kp.prototype.snapVertices = function (e, t) {
        for (var n = this._isClosed ? e.size() - 1 : e.size(), r = 0; r < n; r++) {
            var i = e.get(r), s = this.findSnapForVertex(i, t);
            null !== s && (e.set(r, new Tf(s)), 0 === r && this._isClosed && e.set(e.size() - 1, new Tf(s)))
        }
    }, Kp.prototype.findSnapForVertex = function (e, t) {
        for (var n = 0; n < t.length; n++) {
            if (e.equals2D(t[n])) return null;
            if (e.distance(t[n]) < this._snapTolerance) return t[n]
        }
        return null
    }, Kp.prototype.snapTo = function (e) {
        var t = new Cl(this._srcPts);
        return this.snapVertices(t, e), this.snapSegments(t, e), t.toCoordinateArray()
    }, Kp.prototype.snapSegments = function (e, t) {
        if (0 === t.length) return null;
        var n = t.length;
        t[0].equals2D(t[t.length - 1]) && (n = t.length - 1);
        for (var r = 0; r < n; r++) {
            var i = t[r], s = this.findSegmentIndexToSnap(i, e);
            s >= 0 && e.add(s + 1, new Tf(i), !1)
        }
    }, Kp.prototype.findSegmentIndexToSnap = function (e, t) {
        for (var n = bf.MAX_VALUE, r = -1, i = 0; i < t.size() - 1; i++) {
            if (this._seg.p0 = t.get(i), this._seg.p1 = t.get(i + 1), this._seg.p0.equals2D(e) || this._seg.p1.equals2D(e)) {
                if (this._allowSnappingToSourceVertices) continue;
                return -1
            }
            var s = this._seg.distance(e);
            s < this._snapTolerance && s < n && (n = s, r = i)
        }
        return r
    }, Kp.prototype.setAllowSnappingToSourceVertices = function (e) {
        this._allowSnappingToSourceVertices = e
    }, Kp.prototype.interfaces_ = function () {
        return []
    }, Kp.prototype.getClass = function () {
        return Kp
    }, Kp.isClosed = function (e) {
        return !(e.length <= 1) && e[0].equals2D(e[e.length - 1])
    };
    var Qp = function (e) {
        this._srcGeom = e || null
    }, Gp = {SNAP_PRECISION_FACTOR: {configurable: !0}};
    Qp.prototype.snapTo = function (e, t) {
        var n = this.extractTargetCoordinates(e);
        return (new Yp(t, n)).transform(this._srcGeom)
    }, Qp.prototype.snapToSelf = function (e, t) {
        var n = this.extractTargetCoordinates(this._srcGeom), r = (new Yp(e, n, !0)).transform(this._srcGeom), i = r;
        return t && Of(i, Zl) && (i = r.buffer(0)), i
    }, Qp.prototype.computeSnapTolerance = function (e) {
        return this.computeMinimumSegmentLength(e) / 10
    }, Qp.prototype.extractTargetCoordinates = function (e) {
        for (var t = new qs, n = e.getCoordinates(), r = 0; r < n.length; r++) t.add(n[r]);
        return t.toArray((new Array(0)).fill(null))
    }, Qp.prototype.computeMinimumSegmentLength = function (e) {
        for (var t = bf.MAX_VALUE, n = 0; n < e.length - 1; n++) {
            var r = e[n].distance(e[n + 1]);
            r < t && (t = r)
        }
        return t
    }, Qp.prototype.interfaces_ = function () {
        return []
    }, Qp.prototype.getClass = function () {
        return Qp
    }, Qp.snap = function (e, t, n) {
        var r = (new Array(2)).fill(null), i = new Qp(e);
        r[0] = i.snapTo(t, n);
        var s = new Qp(t);
        return r[1] = s.snapTo(r[0], n), r
    }, Qp.computeOverlaySnapTolerance = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = Qp.computeSizeBasedSnapTolerance(e), n = e.getPrecisionModel();
            if (n.getType() === dc.FIXED) {
                var r = 1 / n.getScale() * 2 / 1.415;
                r > t && (t = r)
            }
            return t
        }
        if (2 === arguments.length) {
            var i = arguments[0], s = arguments[1];
            return Math.min(Qp.computeOverlaySnapTolerance(i), Qp.computeOverlaySnapTolerance(s))
        }
    }, Qp.computeSizeBasedSnapTolerance = function (e) {
        var t = e.getEnvelopeInternal();
        return Math.min(t.getHeight(), t.getWidth()) * Qp.SNAP_PRECISION_FACTOR
    }, Qp.snapToSelf = function (e, t, n) {
        return (new Qp(e)).snapToSelf(t, n)
    }, Gp.SNAP_PRECISION_FACTOR.get = function () {
        return 1e-9
    }, Object.defineProperties(Qp, Gp);
    var Yp = function (e) {
        function t(t, n, r) {
            e.call(this), this._snapTolerance = t || null, this._snapPts = n || null, this._isSelfSnap = void 0 !== r && r
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.snapLine = function (e, t) {
            var n = new Kp(e, this._snapTolerance);
            return n.setAllowSnappingToSourceVertices(this._isSelfSnap), n.snapTo(t)
        }, t.prototype.transformCoordinates = function (e, t) {
            var n = e.toCoordinateArray(), r = this.snapLine(n, this._snapPts);
            return this._factory.getCoordinateSequenceFactory().create(r)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Jp), Zp = function () {
        this._isFirst = !0, this._commonMantissaBitsCount = 53, this._commonBits = 0, this._commonSignExp = null
    };
    Zp.prototype.getCommon = function () {
        return bf.longBitsToDouble(this._commonBits)
    }, Zp.prototype.add = function (e) {
        var t = bf.doubleToLongBits(e);
        if (this._isFirst) return this._commonBits = t, this._commonSignExp = Zp.signExpBits(this._commonBits), this._isFirst = !1, null;
        if (Zp.signExpBits(t) !== this._commonSignExp) return this._commonBits = 0, null;
        this._commonMantissaBitsCount = Zp.numCommonMostSigMantissaBits(this._commonBits, t), this._commonBits = Zp.zeroLowerBits(this._commonBits, 64 - (12 + this._commonMantissaBitsCount))
    }, Zp.prototype.toString = function () {
        if (1 === arguments.length) {
            var e = arguments[0], t = bf.longBitsToDouble(e),
                n = "0000000000000000000000000000000000000000000000000000000000000000" + bf.toBinaryString(e),
                r = n.substring(n.length - 64);
            return r.substring(0, 1) + "  " + r.substring(1, 12) + "(exp) " + r.substring(12) + " [ " + t + " ]"
        }
    }, Zp.prototype.interfaces_ = function () {
        return []
    }, Zp.prototype.getClass = function () {
        return Zp
    }, Zp.getBit = function (e, t) {
        return 0 != (e & 1 << t) ? 1 : 0
    }, Zp.signExpBits = function (e) {
        return e >> 52
    }, Zp.zeroLowerBits = function (e, t) {
        return e & ~((1 << t) - 1)
    }, Zp.numCommonMostSigMantissaBits = function (e, t) {
        for (var n = 0, r = 52; r >= 0; r--) {
            if (Zp.getBit(e, r) !== Zp.getBit(t, r)) return n;
            n++
        }
        return 52
    };
    var ed = function () {
        this._commonCoord = null, this._ccFilter = new nd
    }, td = {CommonCoordinateFilter: {configurable: !0}, Translater: {configurable: !0}};
    ed.prototype.addCommonBits = function (e) {
        var t = new rd(this._commonCoord);
        e.apply(t), e.geometryChanged()
    }, ed.prototype.removeCommonBits = function (e) {
        if (0 === this._commonCoord.x && 0 === this._commonCoord.y) return e;
        var t = new Tf(this._commonCoord);
        t.x = -t.x, t.y = -t.y;
        var n = new rd(t);
        return e.apply(n), e.geometryChanged(), e
    }, ed.prototype.getCommonCoordinate = function () {
        return this._commonCoord
    }, ed.prototype.add = function (e) {
        e.apply(this._ccFilter), this._commonCoord = this._ccFilter.getCommonCoordinate()
    }, ed.prototype.interfaces_ = function () {
        return []
    }, ed.prototype.getClass = function () {
        return ed
    }, td.CommonCoordinateFilter.get = function () {
        return nd
    }, td.Translater.get = function () {
        return rd
    }, Object.defineProperties(ed, td);
    var nd = function () {
        this._commonBitsX = new Zp, this._commonBitsY = new Zp
    };
    nd.prototype.filter = function (e) {
        this._commonBitsX.add(e.x), this._commonBitsY.add(e.y)
    }, nd.prototype.getCommonCoordinate = function () {
        return new Tf(this._commonBitsX.getCommon(), this._commonBitsY.getCommon())
    }, nd.prototype.interfaces_ = function () {
        return [pl]
    }, nd.prototype.getClass = function () {
        return nd
    };
    var rd = function () {
        this.trans = null;
        var e = arguments[0];
        this.trans = e
    };
    rd.prototype.filter = function (e, t) {
        var n = e.getOrdinate(t, 0) + this.trans.x, r = e.getOrdinate(t, 1) + this.trans.y;
        e.setOrdinate(t, 0, n), e.setOrdinate(t, 1, r)
    }, rd.prototype.isDone = function () {
        return !1
    }, rd.prototype.isGeometryChanged = function () {
        return !0
    }, rd.prototype.interfaces_ = function () {
        return [Ul]
    }, rd.prototype.getClass = function () {
        return rd
    };
    var id = function (e, t) {
        this._geom = (new Array(2)).fill(null), this._snapTolerance = null, this._cbr = null, this._geom[0] = e, this._geom[1] = t, this.computeSnapTolerance()
    };
    id.prototype.selfSnap = function (e) {
        return (new Qp(e)).snapTo(e, this._snapTolerance)
    }, id.prototype.removeCommonBits = function (e) {
        this._cbr = new ed, this._cbr.add(e[0]), this._cbr.add(e[1]);
        var t = (new Array(2)).fill(null);
        return t[0] = this._cbr.removeCommonBits(e[0].copy()), t[1] = this._cbr.removeCommonBits(e[1].copy()), t
    }, id.prototype.prepareResult = function (e) {
        return this._cbr.addCommonBits(e), e
    }, id.prototype.getResultGeometry = function (e) {
        var t = this.snap(this._geom), n = Cd.overlayOp(t[0], t[1], e);
        return this.prepareResult(n)
    }, id.prototype.checkValid = function (e) {
        e.isValid() || Wf.out.println("Snapped geometry is invalid")
    }, id.prototype.computeSnapTolerance = function () {
        this._snapTolerance = Qp.computeOverlaySnapTolerance(this._geom[0], this._geom[1])
    }, id.prototype.snap = function (e) {
        var t = this.removeCommonBits(e);
        return Qp.snap(t[0], t[1], this._snapTolerance)
    }, id.prototype.interfaces_ = function () {
        return []
    }, id.prototype.getClass = function () {
        return id
    }, id.overlayOp = function (e, t, n) {
        return (new id(e, t)).getResultGeometry(n)
    }, id.union = function (e, t) {
        return id.overlayOp(e, t, Cd.UNION)
    }, id.intersection = function (e, t) {
        return id.overlayOp(e, t, Cd.INTERSECTION)
    }, id.symDifference = function (e, t) {
        return id.overlayOp(e, t, Cd.SYMDIFFERENCE)
    }, id.difference = function (e, t) {
        return id.overlayOp(e, t, Cd.DIFFERENCE)
    };
    var sd = function (e, t) {
        this._geom = (new Array(2)).fill(null), this._geom[0] = e, this._geom[1] = t
    };
    sd.prototype.getResultGeometry = function (e) {
        var t = null, n = !1, r = null;
        try {
            t = Cd.overlayOp(this._geom[0], this._geom[1], e), n = !0
        } catch (e) {
            if (!(e instanceof Zf)) throw e;
            r = e
        }
        if (!n) try {
            t = id.overlayOp(this._geom[0], this._geom[1], e)
        } catch (e) {
            throw e instanceof Zf ? r : e
        }
        return t
    }, sd.prototype.interfaces_ = function () {
        return []
    }, sd.prototype.getClass = function () {
        return sd
    }, sd.overlayOp = function (e, t, n) {
        return (new sd(e, t)).getResultGeometry(n)
    }, sd.union = function (e, t) {
        return sd.overlayOp(e, t, Cd.UNION)
    }, sd.intersection = function (e, t) {
        return sd.overlayOp(e, t, Cd.INTERSECTION)
    }, sd.symDifference = function (e, t) {
        return sd.overlayOp(e, t, Cd.SYMDIFFERENCE)
    }, sd.difference = function (e, t) {
        return sd.overlayOp(e, t, Cd.DIFFERENCE)
    };
    var od = function () {
        this.mce = null, this.chainIndex = null;
        var e = arguments[0], t = arguments[1];
        this.mce = e, this.chainIndex = t
    };
    od.prototype.computeIntersections = function (e, t) {
        this.mce.computeIntersectsForChain(this.chainIndex, e.mce, e.chainIndex, t)
    }, od.prototype.interfaces_ = function () {
        return []
    }, od.prototype.getClass = function () {
        return od
    };
    var ud = function Vv() {
        if (this._label = null, this._xValue = null, this._eventType = null, this._insertEvent = null, this._deleteEventIndex = null, this._obj = null, 2 === arguments.length) {
            var e = arguments[0], t = arguments[1];
            this._eventType = Vv.DELETE, this._xValue = e, this._insertEvent = t
        } else if (3 === arguments.length) {
            var n = arguments[0], r = arguments[1], i = arguments[2];
            this._eventType = Vv.INSERT, this._label = n, this._xValue = r, this._obj = i
        }
    }, ad = {INSERT: {configurable: !0}, DELETE: {configurable: !0}};
    ud.prototype.isDelete = function () {
        return this._eventType === ud.DELETE
    }, ud.prototype.setDeleteEventIndex = function (e) {
        this._deleteEventIndex = e
    }, ud.prototype.getObject = function () {
        return this._obj
    }, ud.prototype.compareTo = function (e) {
        var t = e;
        return this._xValue < t._xValue ? -1 : this._xValue > t._xValue ? 1 : this._eventType < t._eventType ? -1 : this._eventType > t._eventType ? 1 : 0
    }, ud.prototype.getInsertEvent = function () {
        return this._insertEvent
    }, ud.prototype.isInsert = function () {
        return this._eventType === ud.INSERT
    }, ud.prototype.isSameLabel = function (e) {
        return null !== this._label && this._label === e._label
    }, ud.prototype.getDeleteEventIndex = function () {
        return this._deleteEventIndex
    }, ud.prototype.interfaces_ = function () {
        return [Ef]
    }, ud.prototype.getClass = function () {
        return ud
    }, ad.INSERT.get = function () {
        return 1
    }, ad.DELETE.get = function () {
        return 2
    }, Object.defineProperties(ud, ad);
    var fd = function () {
    };
    fd.prototype.interfaces_ = function () {
        return []
    }, fd.prototype.getClass = function () {
        return fd
    };
    var ld = function () {
        this._hasIntersection = !1, this._hasProper = !1, this._hasProperInterior = !1, this._properIntersectionPoint = null, this._li = null, this._includeProper = null, this._recordIsolated = null, this._isSelfIntersection = null, this._numIntersections = 0, this.numTests = 0, this._bdyNodes = null, this._isDone = !1, this._isDoneWhenProperInt = !1;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        this._li = e, this._includeProper = t, this._recordIsolated = n
    };
    ld.prototype.isTrivialIntersection = function (e, t, n, r) {
        if (e === n && 1 === this._li.getIntersectionNum()) {
            if (ld.isAdjacentSegments(t, r)) return !0;
            if (e.isClosed()) {
                var i = e.getNumPoints() - 1;
                if (0 === t && r === i || 0 === r && t === i) return !0
            }
        }
        return !1
    }, ld.prototype.getProperIntersectionPoint = function () {
        return this._properIntersectionPoint
    }, ld.prototype.setIsDoneIfProperInt = function (e) {
        this._isDoneWhenProperInt = e
    }, ld.prototype.hasProperInteriorIntersection = function () {
        return this._hasProperInterior
    }, ld.prototype.isBoundaryPointInternal = function (e, t) {
        for (var n = t.iterator(); n.hasNext();) {
            var r = n.next().getCoordinate();
            if (e.isIntersection(r)) return !0
        }
        return !1
    }, ld.prototype.hasProperIntersection = function () {
        return this._hasProper
    }, ld.prototype.hasIntersection = function () {
        return this._hasIntersection
    }, ld.prototype.isDone = function () {
        return this._isDone
    }, ld.prototype.isBoundaryPoint = function (e, t) {
        return null !== t && (!!this.isBoundaryPointInternal(e, t[0]) || !!this.isBoundaryPointInternal(e, t[1]))
    }, ld.prototype.setBoundaryNodes = function (e, t) {
        this._bdyNodes = (new Array(2)).fill(null), this._bdyNodes[0] = e, this._bdyNodes[1] = t
    }, ld.prototype.addIntersections = function (e, t, n, r) {
        if (e === n && t === r) return null;
        this.numTests++;
        var i = e.getCoordinates()[t], s = e.getCoordinates()[t + 1], o = n.getCoordinates()[r],
            u = n.getCoordinates()[r + 1];
        this._li.computeIntersection(i, s, o, u), this._li.hasIntersection() && (this._recordIsolated && (e.setIsolated(!1), n.setIsolated(!1)), this._numIntersections++, this.isTrivialIntersection(e, t, n, r) || (this._hasIntersection = !0, !this._includeProper && this._li.isProper() || (e.addIntersections(this._li, t, 0), n.addIntersections(this._li, r, 1)), this._li.isProper() && (this._properIntersectionPoint = this._li.getIntersection(0).copy(), this._hasProper = !0, this._isDoneWhenProperInt && (this._isDone = !0), this.isBoundaryPoint(this._li, this._bdyNodes) || (this._hasProperInterior = !0))))
    }, ld.prototype.interfaces_ = function () {
        return []
    }, ld.prototype.getClass = function () {
        return ld
    }, ld.isAdjacentSegments = function (e, t) {
        return 1 === Math.abs(e - t)
    };
    var cd = function (e) {
        function t() {
            e.call(this), this.events = new Tl, this.nOverlaps = null
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.prepareEvents = function () {
            eh.sort(this.events);
            for (var e = 0; e < this.events.size(); e++) {
                var t = this.events.get(e);
                t.isDelete() && t.getInsertEvent().setDeleteEventIndex(e)
            }
        }, t.prototype.computeIntersections = function () {
            if (1 === arguments.length) {
                var e = arguments[0];
                this.nOverlaps = 0, this.prepareEvents();
                for (var t = 0; t < this.events.size(); t++) {
                    var n = this.events.get(t);
                    if (n.isInsert() && this.processOverlaps(t, n.getDeleteEventIndex(), n, e), e.isDone()) break
                }
            } else if (3 === arguments.length) if (arguments[2] instanceof ld && Of(arguments[0], xl) && Of(arguments[1], xl)) {
                var r = arguments[0], i = arguments[1], s = arguments[2];
                this.addEdges(r, r), this.addEdges(i, i), this.computeIntersections(s)
            } else if ("boolean" == typeof arguments[2] && Of(arguments[0], xl) && arguments[1] instanceof ld) {
                var o = arguments[0], u = arguments[1];
                arguments[2] ? this.addEdges(o, null) : this.addEdges(o), this.computeIntersections(u)
            }
        }, t.prototype.addEdge = function (e, t) {
            for (var n = e.getMonotoneChainEdge(), r = n.getStartIndexes(), i = 0; i < r.length - 1; i++) {
                var s = new od(n, i), o = new ud(t, n.getMinX(i), s);
                this.events.add(o), this.events.add(new ud(n.getMaxX(i), o))
            }
        }, t.prototype.processOverlaps = function (e, t, n, r) {
            for (var i = n.getObject(), s = e; s < t; s++) {
                var o = this.events.get(s);
                if (o.isInsert()) {
                    var u = o.getObject();
                    n.isSameLabel(o) || (i.computeIntersections(u, r), this.nOverlaps++)
                }
            }
        }, t.prototype.addEdges = function () {
            if (1 === arguments.length) for (var e = arguments[0].iterator(); e.hasNext();) {
                var t = e.next();
                this.addEdge(t, t)
            } else if (2 === arguments.length) for (var n = arguments[0], r = arguments[1], i = n.iterator(); i.hasNext();) {
                var s = i.next();
                this.addEdge(s, r)
            }
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(fd), hd = function () {
        this._min = bf.POSITIVE_INFINITY, this._max = bf.NEGATIVE_INFINITY
    }, pd = {NodeComparator: {configurable: !0}};
    hd.prototype.getMin = function () {
        return this._min
    }, hd.prototype.intersects = function (e, t) {
        return !(this._min > t || this._max < e)
    }, hd.prototype.getMax = function () {
        return this._max
    }, hd.prototype.toString = function () {
        return Yf.toLineString(new Tf(this._min, 0), new Tf(this._max, 0))
    }, hd.prototype.interfaces_ = function () {
        return []
    }, hd.prototype.getClass = function () {
        return hd
    }, pd.NodeComparator.get = function () {
        return dd
    }, Object.defineProperties(hd, pd);
    var dd = function () {
    };
    dd.prototype.compare = function (e, t) {
        var n = e, r = t, i = (n._min + n._max) / 2, s = (r._min + r._max) / 2;
        return i < s ? -1 : i > s ? 1 : 0
    }, dd.prototype.interfaces_ = function () {
        return [xf]
    }, dd.prototype.getClass = function () {
        return dd
    };
    var vd = function (e) {
        function t() {
            e.call(this), this._item = null;
            var t = arguments[0], n = arguments[1], r = arguments[2];
            this._min = t, this._max = n, this._item = r
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.query = function (e, t, n) {
            if (!this.intersects(e, t)) return null;
            n.visitItem(this._item)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(hd), md = function (e) {
        function t() {
            e.call(this), this._node1 = null, this._node2 = null;
            var t = arguments[0], n = arguments[1];
            this._node1 = t, this._node2 = n, this.buildExtent(this._node1, this._node2)
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.buildExtent = function (e, t) {
            this._min = Math.min(e._min, t._min), this._max = Math.max(e._max, t._max)
        }, t.prototype.query = function (e, t, n) {
            if (!this.intersects(e, t)) return null;
            null !== this._node1 && this._node1.query(e, t, n), null !== this._node2 && this._node2.query(e, t, n)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(hd), gd = function () {
        this._leaves = new Tl, this._root = null, this._level = 0
    };
    gd.prototype.buildTree = function () {
        eh.sort(this._leaves, new hd.NodeComparator);
        for (var e = this._leaves, t = null, n = new Tl; ;) {
            if (this.buildLevel(e, n), 1 === n.size()) return n.get(0);
            t = e, e = n, n = t
        }
    }, gd.prototype.insert = function (e, t, n) {
        if (null !== this._root) throw new Error("Index cannot be added to once it has been queried");
        this._leaves.add(new vd(e, t, n))
    }, gd.prototype.query = function (e, t, n) {
        this.init(), this._root.query(e, t, n)
    }, gd.prototype.buildRoot = function () {
        if (null !== this._root) return null;
        this._root = this.buildTree()
    }, gd.prototype.printNode = function (e) {
        Wf.out.println(Yf.toLineString(new Tf(e._min, this._level), new Tf(e._max, this._level)))
    }, gd.prototype.init = function () {
        if (null !== this._root) return null;
        this.buildRoot()
    }, gd.prototype.buildLevel = function (e, t) {
        this._level++, t.clear();
        for (var n = 0; n < e.size(); n += 2) {
            var r = e.get(n);
            if (null === (n + 1 < e.size() ? e.get(n) : null)) t.add(r); else {
                var i = new md(e.get(n), e.get(n + 1));
                t.add(i)
            }
        }
    }, gd.prototype.interfaces_ = function () {
        return []
    }, gd.prototype.getClass = function () {
        return gd
    };
    var yd = function () {
        this._items = new Tl
    };
    yd.prototype.visitItem = function (e) {
        this._items.add(e)
    }, yd.prototype.getItems = function () {
        return this._items
    }, yd.prototype.interfaces_ = function () {
        return [Qc]
    }, yd.prototype.getClass = function () {
        return yd
    };
    var bd = function () {
        this._index = null;
        var e = arguments[0];
        if (!Of(e, Zl)) throw new yf("Argument must be Polygonal");
        this._index = new Sd(e)
    }, wd = {SegmentVisitor: {configurable: !0}, IntervalIndexedGeometry: {configurable: !0}};
    bd.prototype.locate = function (e) {
        var t = new ol(e), n = new Ed(t);
        return this._index.query(e.y, e.y, n), t.getLocation()
    }, bd.prototype.interfaces_ = function () {
        return [qh]
    }, bd.prototype.getClass = function () {
        return bd
    }, wd.SegmentVisitor.get = function () {
        return Ed
    }, wd.IntervalIndexedGeometry.get = function () {
        return Sd
    }, Object.defineProperties(bd, wd);
    var Ed = function () {
        this._counter = null;
        var e = arguments[0];
        this._counter = e
    };
    Ed.prototype.visitItem = function (e) {
        var t = e;
        this._counter.countSegment(t.getCoordinate(0), t.getCoordinate(1))
    }, Ed.prototype.interfaces_ = function () {
        return [Qc]
    }, Ed.prototype.getClass = function () {
        return Ed
    };
    var Sd = function () {
        this._index = new gd;
        var e = arguments[0];
        this.init(e)
    };
    Sd.prototype.init = function (e) {
        for (var t = Tp.getLines(e).iterator(); t.hasNext();) {
            var n = t.next().getCoordinates();
            this.addLine(n)
        }
    }, Sd.prototype.addLine = function (e) {
        for (var t = 1; t < e.length; t++) {
            var n = new vh(e[t - 1], e[t]), r = Math.min(n.p0.y, n.p1.y), i = Math.max(n.p0.y, n.p1.y);
            this._index.insert(r, i, n)
        }
    }, Sd.prototype.query = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1], n = new yd;
            return this._index.query(e, t, n), n.getItems()
        }
        if (3 === arguments.length) {
            var r = arguments[0], i = arguments[1], s = arguments[2];
            this._index.query(r, i, s)
        }
    }, Sd.prototype.interfaces_ = function () {
        return []
    }, Sd.prototype.getClass = function () {
        return Sd
    };
    var xd = function (e) {
        function t() {
            if (e.call(this), this._parentGeom = null, this._lineEdgeMap = new pc, this._boundaryNodeRule = null, this._useBoundaryDeterminationRule = !0, this._argIndex = null, this._boundaryNodes = null, this._hasTooFewPoints = !1, this._invalidPoint = null, this._areaPtLocator = null, this._ptLocator = new Np, 2 === arguments.length) {
                var t = arguments[0], n = arguments[1], r = dl.OGC_SFS_BOUNDARY_RULE;
                this._argIndex = t, this._parentGeom = n, this._boundaryNodeRule = r, null !== n && this.add(n)
            } else if (3 === arguments.length) {
                var i = arguments[0], s = arguments[1], o = arguments[2];
                this._argIndex = i, this._parentGeom = s, this._boundaryNodeRule = o, null !== s && this.add(s)
            }
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.insertBoundaryPoint = function (e, n) {
            var r = this._nodes.addNode(n).getLabel(), i = 1;
            Lf.NONE, r.getLocation(e, Cc.ON) === Lf.BOUNDARY && i++;
            var s = t.determineBoundary(this._boundaryNodeRule, i);
            r.setLocation(e, s)
        }, t.prototype.computeSelfNodes = function () {
            if (2 === arguments.length) {
                var e = arguments[0], t = arguments[1];
                return this.computeSelfNodes(e, t, !1)
            }
            if (3 === arguments.length) {
                var n = arguments[0], r = arguments[1], i = arguments[2], s = new ld(n, !0, !1);
                s.setIsDoneIfProperInt(i);
                var o = this.createEdgeSetIntersector(),
                    u = this._parentGeom instanceof nc || this._parentGeom instanceof ec || this._parentGeom instanceof rc,
                    a = r || !u;
                return o.computeIntersections(this._edges, s, a), this.addSelfIntersectionNodes(this._argIndex), s
            }
        }, t.prototype.computeSplitEdges = function (e) {
            for (var t = this._edges.iterator(); t.hasNext();) t.next().eiList.addSplitEdges(e)
        }, t.prototype.computeEdgeIntersections = function (e, t, n) {
            var r = new ld(t, n, !0);
            return r.setBoundaryNodes(this.getBoundaryNodes(), e.getBoundaryNodes()), this.createEdgeSetIntersector().computeIntersections(this._edges, e._edges, r), r
        }, t.prototype.getGeometry = function () {
            return this._parentGeom
        }, t.prototype.getBoundaryNodeRule = function () {
            return this._boundaryNodeRule
        }, t.prototype.hasTooFewPoints = function () {
            return this._hasTooFewPoints
        }, t.prototype.addPoint = function () {
            if (arguments[0] instanceof Yl) {
                var e = arguments[0].getCoordinate();
                this.insertPoint(this._argIndex, e, Lf.INTERIOR)
            } else if (arguments[0] instanceof Tf) {
                var t = arguments[0];
                this.insertPoint(this._argIndex, t, Lf.INTERIOR)
            }
        }, t.prototype.addPolygon = function (e) {
            this.addPolygonRing(e.getExteriorRing(), Lf.EXTERIOR, Lf.INTERIOR);
            for (var t = 0; t < e.getNumInteriorRing(); t++) {
                var n = e.getInteriorRingN(t);
                this.addPolygonRing(n, Lf.INTERIOR, Lf.EXTERIOR)
            }
        }, t.prototype.addEdge = function (e) {
            this.insertEdge(e);
            var t = e.getCoordinates();
            this.insertPoint(this._argIndex, t[0], Lf.BOUNDARY), this.insertPoint(this._argIndex, t[t.length - 1], Lf.BOUNDARY)
        }, t.prototype.addLineString = function (e) {
            var t = kl.removeRepeatedPoints(e.getCoordinates());
            if (t.length < 2) return this._hasTooFewPoints = !0, this._invalidPoint = t[0], null;
            var n = new np(t, new Dc(this._argIndex, Lf.INTERIOR));
            this._lineEdgeMap.put(e, n), this.insertEdge(n), tl.isTrue(t.length >= 2, "found LineString with single point"), this.insertBoundaryPoint(this._argIndex, t[0]), this.insertBoundaryPoint(this._argIndex, t[t.length - 1])
        }, t.prototype.getInvalidPoint = function () {
            return this._invalidPoint
        }, t.prototype.getBoundaryPoints = function () {
            for (var e = this.getBoundaryNodes(), t = (new Array(e.size())).fill(null), n = 0, r = e.iterator(); r.hasNext();) {
                var i = r.next();
                t[n++] = i.getCoordinate().copy()
            }
            return t
        }, t.prototype.getBoundaryNodes = function () {
            return null === this._boundaryNodes && (this._boundaryNodes = this._nodes.getBoundaryNodes(this._argIndex)), this._boundaryNodes
        }, t.prototype.addSelfIntersectionNode = function (e, t, n) {
            if (this.isBoundaryNode(e, t)) return null;
            n === Lf.BOUNDARY && this._useBoundaryDeterminationRule ? this.insertBoundaryPoint(e, t) : this.insertPoint(e, t, n)
        }, t.prototype.addPolygonRing = function (e, t, n) {
            if (e.isEmpty()) return null;
            var r = kl.removeRepeatedPoints(e.getCoordinates());
            if (r.length < 4) return this._hasTooFewPoints = !0, this._invalidPoint = r[0], null;
            var i = t, s = n;
            ul.isCCW(r) && (i = n, s = t);
            var o = new np(r, new Dc(this._argIndex, Lf.BOUNDARY, i, s));
            this._lineEdgeMap.put(e, o), this.insertEdge(o), this.insertPoint(this._argIndex, r[0], Lf.BOUNDARY)
        }, t.prototype.insertPoint = function (e, t, n) {
            var r = this._nodes.addNode(t), i = r.getLabel();
            null === i ? r._label = new Dc(e, n) : i.setLocation(e, n)
        }, t.prototype.createEdgeSetIntersector = function () {
            return new cd
        }, t.prototype.addSelfIntersectionNodes = function (e) {
            for (var t = this._edges.iterator(); t.hasNext();) for (var n = t.next(), r = n.getLabel().getLocation(e), i = n.eiList.iterator(); i.hasNext();) {
                var s = i.next();
                this.addSelfIntersectionNode(e, s.coord, r)
            }
        }, t.prototype.add = function () {
            if (1 !== arguments.length) return e.prototype.add.apply(this, arguments);
            var t = arguments[0];
            if (t.isEmpty()) return null;
            if (t instanceof rc && (this._useBoundaryDeterminationRule = !1), t instanceof ec) this.addPolygon(t); else if (t instanceof Ql) this.addLineString(t); else if (t instanceof Yl) this.addPoint(t); else if (t instanceof tc) this.addCollection(t); else if (t instanceof Wl) this.addCollection(t); else if (t instanceof rc) this.addCollection(t); else {
                if (!(t instanceof zl)) throw new Error(t.getClass().getName());
                this.addCollection(t)
            }
        }, t.prototype.addCollection = function (e) {
            for (var t = 0; t < e.getNumGeometries(); t++) {
                var n = e.getGeometryN(t);
                this.add(n)
            }
        }, t.prototype.locate = function (e) {
            return Of(this._parentGeom, Zl) && this._parentGeom.getNumGeometries() > 50 ? (null === this._areaPtLocator && (this._areaPtLocator = new bd(this._parentGeom)), this._areaPtLocator.locate(e)) : this._ptLocator.locate(e, this._parentGeom)
        }, t.prototype.findEdge = function () {
            if (1 === arguments.length) {
                var t = arguments[0];
                return this._lineEdgeMap.get(t)
            }
            return e.prototype.findEdge.apply(this, arguments)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t.determineBoundary = function (e, t) {
            return e.isInBoundary(t) ? Lf.BOUNDARY : Lf.INTERIOR
        }, t
    }(Xc), Td = function () {
        if (this._li = new il, this._resultPrecisionModel = null, this._arg = null, 1 === arguments.length) {
            var e = arguments[0];
            this.setComputationPrecision(e.getPrecisionModel()), this._arg = (new Array(1)).fill(null), this._arg[0] = new xd(0, e)
        } else if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = dl.OGC_SFS_BOUNDARY_RULE;
            t.getPrecisionModel().compareTo(n.getPrecisionModel()) >= 0 ? this.setComputationPrecision(t.getPrecisionModel()) : this.setComputationPrecision(n.getPrecisionModel()), this._arg = (new Array(2)).fill(null), this._arg[0] = new xd(0, t, r), this._arg[1] = new xd(1, n, r)
        } else if (3 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2];
            i.getPrecisionModel().compareTo(s.getPrecisionModel()) >= 0 ? this.setComputationPrecision(i.getPrecisionModel()) : this.setComputationPrecision(s.getPrecisionModel()), this._arg = (new Array(2)).fill(null), this._arg[0] = new xd(0, i, o), this._arg[1] = new xd(1, s, o)
        }
    };
    Td.prototype.getArgGeometry = function (e) {
        return this._arg[e].getGeometry()
    }, Td.prototype.setComputationPrecision = function (e) {
        this._resultPrecisionModel = e, this._li.setPrecisionModel(this._resultPrecisionModel)
    }, Td.prototype.interfaces_ = function () {
        return []
    }, Td.prototype.getClass = function () {
        return Td
    };
    var Nd = function () {
    };
    Nd.prototype.interfaces_ = function () {
        return []
    }, Nd.prototype.getClass = function () {
        return Nd
    }, Nd.map = function () {
        if (arguments[0] instanceof ll && Of(arguments[1], Nd.MapOp)) {
            for (var e = arguments[0], t = arguments[1], n = new Tl, r = 0; r < e.getNumGeometries(); r++) {
                var i = t.map(e.getGeometryN(r));
                null !== i && n.add(i)
            }
            return e.getFactory().buildGeometry(n)
        }
        if (Of(arguments[0], wl) && Of(arguments[1], Nd.MapOp)) {
            for (var s = arguments[0], o = arguments[1], u = new Tl, a = s.iterator(); a.hasNext();) {
                var f = a.next(), l = o.map(f);
                null !== l && u.add(l)
            }
            return u
        }
    }, Nd.MapOp = function () {
    };
    var Cd = function (e) {
        function t() {
            var t = arguments[0], n = arguments[1];
            e.call(this, t, n), this._ptLocator = new Np, this._geomFact = null, this._resultGeom = null, this._graph = null, this._edgeList = new $h, this._resultPolyList = new Tl, this._resultLineList = new Tl, this._resultPointList = new Tl, this._graph = new Xc(new Xh), this._geomFact = t.getFactory()
        }

        return e && (t.__proto__ = e), t.prototype = Object.create(e && e.prototype), t.prototype.constructor = t, t.prototype.insertUniqueEdge = function (e) {
            var t = this._edgeList.findEqualEdge(e);
            if (null !== t) {
                var n = t.getLabel(), r = e.getLabel();
                t.isPointwiseEqual(e) || (r = new Dc(e.getLabel())).flip();
                var i = t.getDepth();
                i.isNull() && i.add(n), i.add(r), n.merge(r)
            } else this._edgeList.add(e)
        }, t.prototype.getGraph = function () {
            return this._graph
        }, t.prototype.cancelDuplicateResultEdges = function () {
            for (var e = this._graph.getEdgeEnds().iterator(); e.hasNext();) {
                var t = e.next(), n = t.getSym();
                t.isInResult() && n.isInResult() && (t.setInResult(!1), n.setInResult(!1))
            }
        }, t.prototype.isCoveredByLA = function (e) {
            return !!this.isCovered(e, this._resultLineList) || !!this.isCovered(e, this._resultPolyList)
        }, t.prototype.computeGeometry = function (e, n, r, i) {
            var s = new Tl;
            return s.addAll(e), s.addAll(n), s.addAll(r), s.isEmpty() ? t.createEmptyResult(i, this._arg[0].getGeometry(), this._arg[1].getGeometry(), this._geomFact) : this._geomFact.buildGeometry(s)
        }, t.prototype.mergeSymLabels = function () {
            for (var e = this._graph.getNodes().iterator(); e.hasNext();) e.next().getEdges().mergeSymLabels()
        }, t.prototype.isCovered = function (e, t) {
            for (var n = t.iterator(); n.hasNext();) {
                var r = n.next();
                if (this._ptLocator.locate(e, r) !== Lf.EXTERIOR) return !0
            }
            return !1
        }, t.prototype.replaceCollapsedEdges = function () {
            for (var e = new Tl, t = this._edgeList.iterator(); t.hasNext();) {
                var n = t.next();
                n.isCollapsed() && (t.remove(), e.add(n.getCollapsedEdge()))
            }
            this._edgeList.addAll(e)
        }, t.prototype.updateNodeLabelling = function () {
            for (var e = this._graph.getNodes().iterator(); e.hasNext();) {
                var t = e.next(), n = t.getEdges().getLabel();
                t.getLabel().merge(n)
            }
        }, t.prototype.getResultGeometry = function (e) {
            return this.computeOverlay(e), this._resultGeom
        }, t.prototype.insertUniqueEdges = function (e) {
            for (var t = e.iterator(); t.hasNext();) {
                var n = t.next();
                this.insertUniqueEdge(n)
            }
        }, t.prototype.computeOverlay = function (e) {
            this.copyPoints(0), this.copyPoints(1), this._arg[0].computeSelfNodes(this._li, !1), this._arg[1].computeSelfNodes(this._li, !1), this._arg[0].computeEdgeIntersections(this._arg[1], this._li, !0);
            var t = new Tl;
            this._arg[0].computeSplitEdges(t), this._arg[1].computeSplitEdges(t), this.insertUniqueEdges(t), this.computeLabelsFromDepths(), this.replaceCollapsedEdges(), Wp.checkValid(this._edgeList.getEdges()), this._graph.addEdges(this._edgeList.getEdges()), this.computeLabelling(), this.labelIncompleteNodes(), this.findResultAreaEdges(e), this.cancelDuplicateResultEdges();
            var n = new Vc(this._geomFact);
            n.add(this._graph), this._resultPolyList = n.getPolygons();
            var r = new Vp(this, this._geomFact, this._ptLocator);
            this._resultLineList = r.build(e);
            var i = new $p(this, this._geomFact, this._ptLocator);
            this._resultPointList = i.build(e), this._resultGeom = this.computeGeometry(this._resultPointList, this._resultLineList, this._resultPolyList, e)
        }, t.prototype.labelIncompleteNode = function (e, t) {
            var n = this._ptLocator.locate(e.getCoordinate(), this._arg[t].getGeometry());
            e.getLabel().setLocation(t, n)
        }, t.prototype.copyPoints = function (e) {
            for (var t = this._arg[e].getNodeIterator(); t.hasNext();) {
                var n = t.next();
                this._graph.addNode(n.getCoordinate()).setLabel(e, n.getLabel().getLocation(e))
            }
        }, t.prototype.findResultAreaEdges = function (e) {
            for (var n = this._graph.getEdgeEnds().iterator(); n.hasNext();) {
                var r = n.next(), i = r.getLabel();
                i.isArea() && !r.isInteriorAreaEdge() && t.isResultOfOp(i.getLocation(0, Cc.RIGHT), i.getLocation(1, Cc.RIGHT), e) && r.setInResult(!0)
            }
        }, t.prototype.computeLabelsFromDepths = function () {
            for (var e = this._edgeList.iterator(); e.hasNext();) {
                var t = e.next(), n = t.getLabel(), r = t.getDepth();
                if (!r.isNull()) {
                    r.normalize();
                    for (var i = 0; i < 2; i++) n.isNull(i) || !n.isArea() || r.isNull(i) || (0 === r.getDelta(i) ? n.toLine(i) : (tl.isTrue(!r.isNull(i, Cc.LEFT), "depth of LEFT side has not been initialized"), n.setLocation(i, Cc.LEFT, r.getLocation(i, Cc.LEFT)), tl.isTrue(!r.isNull(i, Cc.RIGHT), "depth of RIGHT side has not been initialized"), n.setLocation(i, Cc.RIGHT, r.getLocation(i, Cc.RIGHT))))
                }
            }
        }, t.prototype.computeLabelling = function () {
            for (var e = this._graph.getNodes().iterator(); e.hasNext();) e.next().getEdges().computeLabelling(this._arg);
            this.mergeSymLabels(), this.updateNodeLabelling()
        }, t.prototype.labelIncompleteNodes = function () {
            for (var e = this._graph.getNodes().iterator(); e.hasNext();) {
                var t = e.next(), n = t.getLabel();
                t.isIsolated() && (n.isNull(0) ? this.labelIncompleteNode(t, 0) : this.labelIncompleteNode(t, 1)), t.getEdges().updateLabelling(n)
            }
        }, t.prototype.isCoveredByA = function (e) {
            return !!this.isCovered(e, this._resultPolyList)
        }, t.prototype.interfaces_ = function () {
            return []
        }, t.prototype.getClass = function () {
            return t
        }, t
    }(Td);
    Cd.overlayOp = function (e, t, n) {
        return (new Cd(e, t)).getResultGeometry(n)
    }, Cd.intersection = function (e, t) {
        if (e.isEmpty() || t.isEmpty()) return Cd.createEmptyResult(Cd.INTERSECTION, e, t, e.getFactory());
        if (e.isGeometryCollection()) {
            var n = t;
            return Xp.map(e, {
                interfaces_: function () {
                    return [Nd.MapOp]
                }, map: function (e) {
                    return e.intersection(n)
                }
            })
        }
        return e.checkNotGeometryCollection(e), e.checkNotGeometryCollection(t), sd.overlayOp(e, t, Cd.INTERSECTION)
    }, Cd.symDifference = function (e, t) {
        if (e.isEmpty() || t.isEmpty()) {
            if (e.isEmpty() && t.isEmpty()) return Cd.createEmptyResult(Cd.SYMDIFFERENCE, e, t, e.getFactory());
            if (e.isEmpty()) return t.copy();
            if (t.isEmpty()) return e.copy()
        }
        return e.checkNotGeometryCollection(e), e.checkNotGeometryCollection(t), sd.overlayOp(e, t, Cd.SYMDIFFERENCE)
    }, Cd.resultDimension = function (e, t, n) {
        var r = t.getDimension(), i = n.getDimension(), s = -1;
        switch (e) {
            case Cd.INTERSECTION:
                s = Math.min(r, i);
                break;
            case Cd.UNION:
                s = Math.max(r, i);
                break;
            case Cd.DIFFERENCE:
                s = r;
                break;
            case Cd.SYMDIFFERENCE:
                s = Math.max(r, i)
        }
        return s
    }, Cd.createEmptyResult = function (e, t, n, r) {
        var i = null;
        switch (Cd.resultDimension(e, t, n)) {
            case-1:
                i = r.createGeometryCollection((new Array(0)).fill(null));
                break;
            case 0:
                i = r.createPoint();
                break;
            case 1:
                i = r.createLineString();
                break;
            case 2:
                i = r.createPolygon()
        }
        return i
    }, Cd.difference = function (e, t) {
        return e.isEmpty() ? Cd.createEmptyResult(Cd.DIFFERENCE, e, t, e.getFactory()) : t.isEmpty() ? e.copy() : (e.checkNotGeometryCollection(e), e.checkNotGeometryCollection(t), sd.overlayOp(e, t, Cd.DIFFERENCE))
    }, Cd.isResultOfOp = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1], n = e.getLocation(0), r = e.getLocation(1);
            return Cd.isResultOfOp(n, r, t)
        }
        if (3 === arguments.length) {
            var i = arguments[0], s = arguments[1], o = arguments[2];
            switch (i === Lf.BOUNDARY && (i = Lf.INTERIOR), s === Lf.BOUNDARY && (s = Lf.INTERIOR), o) {
                case Cd.INTERSECTION:
                    return i === Lf.INTERIOR && s === Lf.INTERIOR;
                case Cd.UNION:
                    return i === Lf.INTERIOR || s === Lf.INTERIOR;
                case Cd.DIFFERENCE:
                    return i === Lf.INTERIOR && s !== Lf.INTERIOR;
                case Cd.SYMDIFFERENCE:
                    return i === Lf.INTERIOR && s !== Lf.INTERIOR || i !== Lf.INTERIOR && s === Lf.INTERIOR
            }
            return !1
        }
    }, Cd.INTERSECTION = 1, Cd.UNION = 2, Cd.DIFFERENCE = 3, Cd.SYMDIFFERENCE = 4;
    var kd = function () {
        this._g = null, this._boundaryDistanceTolerance = null, this._linework = null, this._ptLocator = new Np, this._seg = new vh;
        var e = arguments[0], t = arguments[1];
        this._g = e, this._boundaryDistanceTolerance = t, this._linework = this.extractLinework(e)
    };
    kd.prototype.isWithinToleranceOfBoundary = function (e) {
        for (var t = 0; t < this._linework.getNumGeometries(); t++) for (var n = this._linework.getGeometryN(t).getCoordinateSequence(), r = 0; r < n.size() - 1; r++) {
            n.getCoordinate(r, this._seg.p0), n.getCoordinate(r + 1, this._seg.p1);
            if (this._seg.distance(e) <= this._boundaryDistanceTolerance) return !0
        }
        return !1
    }, kd.prototype.getLocation = function (e) {
        return this.isWithinToleranceOfBoundary(e) ? Lf.BOUNDARY : this._ptLocator.locate(e, this._g)
    }, kd.prototype.extractLinework = function (e) {
        var t = new Ld;
        e.apply(t);
        var n = t.getLinework(), r = yc.toLineStringArray(n);
        return e.getFactory().createMultiLineString(r)
    }, kd.prototype.interfaces_ = function () {
        return []
    }, kd.prototype.getClass = function () {
        return kd
    };
    var Ld = function () {
        this._linework = null, this._linework = new Tl
    };
    Ld.prototype.getLinework = function () {
        return this._linework
    }, Ld.prototype.filter = function (e) {
        if (e instanceof ec) {
            var t = e;
            this._linework.add(t.getExteriorRing());
            for (var n = 0; n < t.getNumInteriorRing(); n++) this._linework.add(t.getInteriorRingN(n))
        }
    }, Ld.prototype.interfaces_ = function () {
        return [Rl]
    }, Ld.prototype.getClass = function () {
        return Ld
    };
    var Ad = function () {
        this._g = null, this._doLeft = !0, this._doRight = !0;
        var e = arguments[0];
        this._g = e
    };
    Ad.prototype.extractPoints = function (e, t, n) {
        for (var r = e.getCoordinates(), i = 0; i < r.length - 1; i++) this.computeOffsetPoints(r[i], r[i + 1], t, n)
    }, Ad.prototype.setSidesToGenerate = function (e, t) {
        this._doLeft = e, this._doRight = t
    }, Ad.prototype.getPoints = function (e) {
        for (var t = new Tl, n = Tp.getLines(this._g).iterator(); n.hasNext();) {
            var r = n.next();
            this.extractPoints(r, e, t)
        }
        return t
    }, Ad.prototype.computeOffsetPoints = function (e, t, n, r) {
        var i = t.x - e.x, s = t.y - e.y, o = Math.sqrt(i * i + s * s), u = n * i / o, a = n * s / o,
            f = (t.x + e.x) / 2, l = (t.y + e.y) / 2;
        if (this._doLeft) {
            var c = new Tf(f - a, l + u);
            r.add(c)
        }
        if (this._doRight) {
            var h = new Tf(f + a, l - u);
            r.add(h)
        }
    }, Ad.prototype.interfaces_ = function () {
        return []
    }, Ad.prototype.getClass = function () {
        return Ad
    };
    var Od = function $v() {
        this._geom = null, this._locFinder = null, this._location = (new Array(3)).fill(null), this._invalidLocation = null, this._boundaryDistanceTolerance = $v.TOLERANCE, this._testCoords = new Tl;
        var e = arguments[0], t = arguments[1], n = arguments[2];
        this._boundaryDistanceTolerance = $v.computeBoundaryDistanceTolerance(e, t), this._geom = [e, t, n], this._locFinder = [new kd(this._geom[0], this._boundaryDistanceTolerance), new kd(this._geom[1], this._boundaryDistanceTolerance), new kd(this._geom[2], this._boundaryDistanceTolerance)]
    }, Md = {TOLERANCE: {configurable: !0}};
    Od.prototype.reportResult = function (e, t, n) {
        Wf.out.println("Overlay result invalid - A:" + Lf.toLocationSymbol(t[0]) + " B:" + Lf.toLocationSymbol(t[1]) + " expected:" + (n ? "i" : "e") + " actual:" + Lf.toLocationSymbol(t[2]))
    }, Od.prototype.isValid = function (e) {
        this.addTestPts(this._geom[0]), this.addTestPts(this._geom[1]);
        var t = this.checkValid(e);
        return t
    }, Od.prototype.checkValid = function () {
        if (1 === arguments.length) {
            for (var e = arguments[0], t = 0; t < this._testCoords.size(); t++) {
                var n = this._testCoords.get(t);
                if (!this.checkValid(e, n)) return this._invalidLocation = n, !1
            }
            return !0
        }
        if (2 === arguments.length) {
            var r = arguments[0], i = arguments[1];
            return this._location[0] = this._locFinder[0].getLocation(i), this._location[1] = this._locFinder[1].getLocation(i), this._location[2] = this._locFinder[2].getLocation(i), !!Od.hasLocation(this._location, Lf.BOUNDARY) || this.isValidResult(r, this._location)
        }
    }, Od.prototype.addTestPts = function (e) {
        var t = new Ad(e);
        this._testCoords.addAll(t.getPoints(5 * this._boundaryDistanceTolerance))
    }, Od.prototype.isValidResult = function (e, t) {
        var n = Cd.isResultOfOp(t[0], t[1], e), r = !(n ^ t[2] === Lf.INTERIOR);
        return r || this.reportResult(e, t, n), r
    }, Od.prototype.getInvalidLocation = function () {
        return this._invalidLocation
    }, Od.prototype.interfaces_ = function () {
        return []
    }, Od.prototype.getClass = function () {
        return Od
    }, Od.hasLocation = function (e, t) {
        for (var n = 0; n < 3; n++) if (e[n] === t) return !0;
        return !1
    }, Od.computeBoundaryDistanceTolerance = function (e, t) {
        return Math.min(Qp.computeSizeBasedSnapTolerance(e), Qp.computeSizeBasedSnapTolerance(t))
    }, Od.isValid = function (e, t, n, r) {
        return (new Od(e, t, r)).isValid(n)
    }, Md.TOLERANCE.get = function () {
        return 1e-6
    }, Object.defineProperties(Od, Md);
    var _d = function Jv(e) {
        this._geomFactory = null, this._skipEmpty = !1, this._inputGeoms = null, this._geomFactory = Jv.extractFactory(e), this._inputGeoms = e
    };
    _d.prototype.extractElements = function (e, t) {
        if (null === e) return null;
        for (var n = 0; n < e.getNumGeometries(); n++) {
            var r = e.getGeometryN(n);
            this._skipEmpty && r.isEmpty() || t.add(r)
        }
    }, _d.prototype.combine = function () {
        for (var e = new Tl, t = this._inputGeoms.iterator(); t.hasNext();) {
            var n = t.next();
            this.extractElements(n, e)
        }
        return 0 === e.size() ? null !== this._geomFactory ? this._geomFactory.createGeometryCollection(null) : null : this._geomFactory.buildGeometry(e)
    }, _d.prototype.interfaces_ = function () {
        return []
    }, _d.prototype.getClass = function () {
        return _d
    }, _d.combine = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return (new _d(e)).combine()
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return (new _d(_d.createList(t, n))).combine()
        }
        if (3 === arguments.length) {
            var r = arguments[0], i = arguments[1], s = arguments[2];
            return (new _d(_d.createList(r, i, s))).combine()
        }
    }, _d.extractFactory = function (e) {
        return e.isEmpty() ? null : e.iterator().next().getFactory()
    }, _d.createList = function () {
        if (2 === arguments.length) {
            var e = arguments[0], t = arguments[1], n = new Tl;
            return n.add(e), n.add(t), n
        }
        if (3 === arguments.length) {
            var r = arguments[0], i = arguments[1], s = arguments[2], o = new Tl;
            return o.add(r), o.add(i), o.add(s), o
        }
    };
    var Dd = function () {
        this._inputPolys = null, this._geomFactory = null;
        var e = arguments[0];
        this._inputPolys = e, null === this._inputPolys && (this._inputPolys = new Tl)
    }, Pd = {STRTREE_NODE_CAPACITY: {configurable: !0}};
    Dd.prototype.reduceToGeometries = function (e) {
        for (var t = new Tl, n = e.iterator(); n.hasNext();) {
            var r = n.next(), i = null;
            Of(r, xl) ? i = this.unionTree(r) : r instanceof ll && (i = r), t.add(i)
        }
        return t
    }, Dd.prototype.extractByEnvelope = function (e, t, n) {
        for (var r = new Tl, i = 0; i < t.getNumGeometries(); i++) {
            var s = t.getGeometryN(i);
            s.getEnvelopeInternal().intersects(e) ? r.add(s) : n.add(s)
        }
        return this._geomFactory.buildGeometry(r)
    }, Dd.prototype.unionOptimized = function (e, t) {
        var n = e.getEnvelopeInternal(), r = t.getEnvelopeInternal();
        if (!n.intersects(r)) return _d.combine(e, t);
        if (e.getNumGeometries() <= 1 && t.getNumGeometries() <= 1) return this.unionActual(e, t);
        var i = n.intersection(r);
        return this.unionUsingEnvelopeIntersection(e, t, i)
    }, Dd.prototype.union = function () {
        if (null === this._inputPolys) throw new Error("union() method cannot be called twice");
        if (this._inputPolys.isEmpty()) return null;
        this._geomFactory = this._inputPolys.iterator().next().getFactory();
        for (var e = new oh(Dd.STRTREE_NODE_CAPACITY), t = this._inputPolys.iterator(); t.hasNext();) {
            var n = t.next();
            e.insert(n.getEnvelopeInternal(), n)
        }
        this._inputPolys = null;
        var r = e.itemsTree();
        return this.unionTree(r)
    }, Dd.prototype.binaryUnion = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return this.binaryUnion(e, 0, e.size())
        }
        if (3 === arguments.length) {
            var t = arguments[0], n = arguments[1], r = arguments[2];
            if (r - n <= 1) {
                var i = Dd.getGeometry(t, n);
                return this.unionSafe(i, null)
            }
            if (r - n == 2) return this.unionSafe(Dd.getGeometry(t, n), Dd.getGeometry(t, n + 1));
            var s = Math.trunc((r + n) / 2), o = this.binaryUnion(t, n, s), u = this.binaryUnion(t, s, r);
            return this.unionSafe(o, u)
        }
    }, Dd.prototype.repeatedUnion = function (e) {
        for (var t = null, n = e.iterator(); n.hasNext();) {
            var r = n.next();
            t = null === t ? r.copy() : t.union(r)
        }
        return t
    }, Dd.prototype.unionSafe = function (e, t) {
        return null === e && null === t ? null : null === e ? t.copy() : null === t ? e.copy() : this.unionOptimized(e, t)
    }, Dd.prototype.unionActual = function (e, t) {
        return Dd.restrictToPolygons(e.union(t))
    }, Dd.prototype.unionTree = function (e) {
        var t = this.reduceToGeometries(e);
        return this.binaryUnion(t)
    }, Dd.prototype.unionUsingEnvelopeIntersection = function (e, t, n) {
        var r = new Tl, i = this.extractByEnvelope(n, e, r), s = this.extractByEnvelope(n, t, r),
            o = this.unionActual(i, s);
        return r.add(o), _d.combine(r)
    }, Dd.prototype.bufferUnion = function () {
        if (1 === arguments.length) {
            var e = arguments[0];
            return e.get(0).getFactory().buildGeometry(e).buffer(0)
        }
        if (2 === arguments.length) {
            var t = arguments[0], n = arguments[1];
            return t.getFactory().createGeometryCollection([t, n]).buffer(0)
        }
    }, Dd.prototype.interfaces_ = function () {
        return []
    }, Dd.prototype.getClass = function () {
        return Dd
    }, Dd.restrictToPolygons = function (e) {
        if (Of(e, Zl)) return e;
        var t = xp.getPolygons(e);
        return 1 === t.size() ? t.get(0) : e.getFactory().createMultiPolygon(yc.toPolygonArray(t))
    }, Dd.getGeometry = function (e, t) {
        return t >= e.size() ? null : e.get(t)
    }, Dd.union = function (e) {
        return (new Dd(e)).union()
    }, Pd.STRTREE_NODE_CAPACITY.get = function () {
        return 4
    }, Object.defineProperties(Dd, Pd);
    var Hd = function () {
    };
    Hd.prototype.interfaces_ = function () {
        return []
    }, Hd.prototype.getClass = function () {
        return Hd
    }, Hd.union = function (e, t) {
        if (e.isEmpty() || t.isEmpty()) {
            if (e.isEmpty() && t.isEmpty()) return Cd.createEmptyResult(Cd.UNION, e, t, e.getFactory());
            if (e.isEmpty()) return t.copy();
            if (t.isEmpty()) return e.copy()
        }
        return e.checkNotGeometryCollection(e), e.checkNotGeometryCollection(t), sd.overlayOp(e, t, Cd.UNION)
    };
    var Bd = function () {
        return new Xs
    };
    Xs.prototype = {
        constructor: Xs, reset: function () {
            this.s = this.t = 0
        }, add: function (e) {
            Vs(jd, e, this.t), Vs(this, jd.s, this.s), this.s ? this.t += jd.t : this.s = jd.t
        }, valueOf: function () {
            return this.s
        }
    };
    var jd = new Xs, Fd = 1e-6, Id = Math.PI, qd = Id / 2, Rd = Id / 4, Ud = 2 * Id, zd = 180 / Id, Wd = Id / 180,
        Xd = Math.abs, Vd = Math.atan, $d = Math.atan2, Jd = Math.cos, Kd = Math.exp, Qd = Math.log, Gd = Math.sin,
        Yd = Math.sqrt, Zd = Math.tan, ev = {
            Feature: function (e, t) {
                Ks(e.geometry, t)
            }, FeatureCollection: function (e, t) {
                for (var n = e.features, r = -1, i = n.length; ++r < i;) Ks(n[r].geometry, t)
            }
        }, tv = {
            Sphere: function (e, t) {
                t.sphere()
            }, Point: function (e, t) {
                e = e.coordinates, t.point(e[0], e[1], e[2])
            }, MultiPoint: function (e, t) {
                for (var n = e.coordinates, r = -1, i = n.length; ++r < i;) e = n[r], t.point(e[0], e[1], e[2])
            }, LineString: function (e, t) {
                Qs(e.coordinates, t, 0)
            }, MultiLineString: function (e, t) {
                for (var n = e.coordinates, r = -1, i = n.length; ++r < i;) Qs(n[r], t, 0)
            }, Polygon: function (e, t) {
                Gs(e.coordinates, t)
            }, MultiPolygon: function (e, t) {
                for (var n = e.coordinates, r = -1, i = n.length; ++r < i;) Gs(n[r], t)
            }, GeometryCollection: function (e, t) {
                for (var n = e.geometries, r = -1, i = n.length; ++r < i;) Ks(n[r], t)
            }
        }, nv = function (e, t) {
            e && ev.hasOwnProperty(e.type) ? ev[e.type](e, t) : Ks(e, t)
        }, rv = (Bd(), Bd(), Bd(), function (e, t) {
            function n(n, r) {
                return n = e(n, r), t(n[0], n[1])
            }

            return e.invert && t.invert && (n.invert = function (n, r) {
                return (n = t.invert(n, r)) && e.invert(n[0], n[1])
            }), n
        });
    so.invert = so;
    var iv = function (e) {
        function t(t) {
            return t = e(t[0] * Wd, t[1] * Wd), t[0] *= zd, t[1] *= zd, t
        }

        return e = oo(e[0] * Wd, e[1] * Wd, e.length > 2 ? e[2] * Wd : 0), t.invert = function (t) {
            return t = e.invert(t[0] * Wd, t[1] * Wd), t[0] *= zd, t[1] *= zd, t
        }, t
    }, sv = function () {
        var e, t = [];
        return {
            point: function (t, n) {
                e.push([t, n])
            }, lineStart: function () {
                t.push(e = [])
            }, lineEnd: Js, rejoin: function () {
                t.length > 1 && t.push(t.pop().concat(t.shift()))
            }, result: function () {
                var n = t;
                return t = [], e = null, n
            }
        }
    }, ov = function (e, t, n, r, i, s) {
        var o, u = e[0], a = e[1], f = 0, l = 1, c = t[0] - u, h = t[1] - a;
        if (o = n - u, c || !(o > 0)) {
            if (o /= c, c < 0) {
                if (o < f) return;
                o < l && (l = o)
            } else if (c > 0) {
                if (o > l) return;
                o > f && (f = o)
            }
            if (o = i - u, c || !(o < 0)) {
                if (o /= c, c < 0) {
                    if (o > l) return;
                    o > f && (f = o)
                } else if (c > 0) {
                    if (o < f) return;
                    o < l && (l = o)
                }
                if (o = r - a, h || !(o > 0)) {
                    if (o /= h, h < 0) {
                        if (o < f) return;
                        o < l && (l = o)
                    } else if (h > 0) {
                        if (o > l) return;
                        o > f && (f = o)
                    }
                    if (o = s - a, h || !(o < 0)) {
                        if (o /= h, h < 0) {
                            if (o > l) return;
                            o > f && (f = o)
                        } else if (h > 0) {
                            if (o < f) return;
                            o < l && (l = o)
                        }
                        return f > 0 && (e[0] = u + f * c, e[1] = a + f * h), l < 1 && (t[0] = u + l * c, t[1] = a + l * h), !0
                    }
                }
            }
        }
    }, uv = function (e, t) {
        return Xd(e[0] - t[0]) < Fd && Xd(e[1] - t[1]) < Fd
    }, av = function (e, t, n, r, i) {
        var s, o, u = [], a = [];
        if (e.forEach(function (e) {
            if (!((t = e.length - 1) <= 0)) {
                var t, n, r = e[0], o = e[t];
                if (uv(r, o)) {
                    for (i.lineStart(), s = 0; s < t; ++s) i.point((r = e[s])[0], r[1]);
                    i.lineEnd()
                } else u.push(n = new co(r, e, null, !0)), a.push(n.o = new co(r, null, n, !1)), u.push(n = new co(o, e, null, !1)), a.push(n.o = new co(o, null, n, !0))
            }
        }), u.length) {
            for (a.sort(t), ho(u), ho(a), s = 0, o = a.length; s < o; ++s) a[s].e = n = !n;
            for (var f, l, c = u[0]; ;) {
                for (var h = c, p = !0; h.v;) if ((h = h.n) === c) return;
                f = h.z, i.lineStart();
                do {
                    if (h.v = h.o.v = !0, h.e) {
                        if (p) for (s = 0, o = f.length; s < o; ++s) i.point((l = f[s])[0], l[1]); else r(h.x, h.n.x, 1, i);
                        h = h.n
                    } else {
                        if (p) for (f = h.p.z, s = f.length - 1; s >= 0; --s) i.point((l = f[s])[0], l[1]); else r(h.x, h.p.x, -1, i);
                        h = h.p
                    }
                    f = (h = h.o).z, p = !p
                } while (!h.v);
                i.lineEnd()
            }
        }
    }, fv = function (e, t) {
        return e < t ? -1 : e > t ? 1 : e >= t ? 0 : NaN
    }, lv = (function (e) {
        1 === e.length && (e = function (e) {
            return function (t, n) {
                return fv(e(t), n)
            }
        }(e))
    }(fv), function (e) {
        for (var t, n, r, i = e.length, s = -1, o = 0; ++s < i;) o += e[s].length;
        for (n = new Array(o); --i >= 0;) for (t = (r = e[i]).length; --t >= 0;) n[--o] = r[t];
        return n
    }), cv = 1e9, hv = -cv, pv = Bd(), dv = (Bd(), function (e) {
        return e
    }), vv = (Bd(), Bd(), 1 / 0), mv = vv, gv = -vv, yv = gv, bv = {
        point: function (e, t) {
            e < vv && (vv = e), e > gv && (gv = e), t < mv && (mv = t), t > yv && (yv = t)
        }, lineStart: Js, lineEnd: Js, polygonStart: Js, polygonEnd: Js, result: function () {
            var e = [[vv, mv], [gv, yv]];
            return gv = yv = -(mv = vv = 1 / 0), e
        }
    }, wv = (Bd(), function (e, t, n, r) {
        return function (i, s) {
            function o(t, n) {
                var r = i(t, n);
                e(t = r[0], n = r[1]) && s.point(t, n)
            }

            function u(e, t) {
                var n = i(e, t);
                m.point(n[0], n[1])
            }

            function a() {
                E.point = u, m.lineStart()
            }

            function f() {
                E.point = o, m.lineEnd()
            }

            function l(e, t) {
                v.push([e, t]);
                var n = i(e, t);
                b.point(n[0], n[1])
            }

            function c() {
                b.lineStart(), v = []
            }

            function h() {
                l(v[0][0], v[0][1]), b.lineEnd();
                var e, t, n, r, i = b.clean(), o = y.result(), u = o.length;
                if (v.pop(), p.push(v), v = null, u) if (1 & i) {
                    if (n = o[0], (t = n.length - 1) > 0) {
                        for (w || (s.polygonStart(), w = !0), s.lineStart(), e = 0; e < t; ++e) s.point((r = n[e])[0], r[1]);
                        s.lineEnd()
                    }
                } else u > 1 && 2 & i && o.push(o.pop().concat(o.shift())), d.push(o.filter(vo))
            }

            var p, d, v, m = t(s), g = i.invert(r[0], r[1]), y = sv(), b = t(y), w = !1, E = {
                point: o, lineStart: a, lineEnd: f, polygonStart: function () {
                    E.point = l, E.lineStart = c, E.lineEnd = h, d = [], p = []
                }, polygonEnd: function () {
                    E.point = o, E.lineStart = a, E.lineEnd = f, d = lv(d);
                    var e = function (e, t) {
                        var n = t[0], r = t[1], i = [Gd(n), -Jd(n), 0], s = 0, o = 0;
                        pv.reset();
                        for (var u = 0, a = e.length; u < a; ++u) if (l = (f = e[u]).length) for (var f, l, c = f[l - 1], h = c[0], p = c[1] / 2 + Rd, d = Gd(p), v = Jd(p), m = 0; m < l; ++m, h = y, d = w, v = E, c = g) {
                            var g = f[m], y = g[0], b = g[1] / 2 + Rd, w = Gd(b), E = Jd(b), S = y - h,
                                x = S >= 0 ? 1 : -1, T = x * S, N = T > Id, C = d * w;
                            if (pv.add($d(C * x * Gd(T), v * E + C * Jd(T))), s += N ? S + x * Ud : S, N ^ h >= n ^ y >= n) {
                                var k = to(Zs(c), Zs(g));
                                io(k);
                                var L = to(i, k);
                                io(L);
                                var A = (N ^ S >= 0 ? -1 : 1) * $s(L[2]);
                                (r > A || r === A && (k[0] || k[1])) && (o += N ^ S >= 0 ? 1 : -1)
                            }
                        }
                        return (s < -Fd || s < Fd && pv < -Fd) ^ 1 & o
                    }(p, g);
                    d.length ? (w || (s.polygonStart(), w = !0), av(d, mo, e, n, s)) : e && (w || (s.polygonStart(), w = !0), s.lineStart(), n(null, null, 1, s), s.lineEnd()), w && (s.polygonEnd(), w = !1), d = p = null
                }, sphere: function () {
                    s.polygonStart(), s.lineStart(), n(null, null, 1, s), s.lineEnd(), s.polygonEnd()
                }
            };
            return E
        }
    }), Ev = wv(function () {
        return !0
    }, function (e) {
        var t, n = NaN, r = NaN, i = NaN;
        return {
            lineStart: function () {
                e.lineStart(), t = 1
            }, point: function (s, o) {
                var u = s > 0 ? Id : -Id, a = Xd(s - n);
                Xd(a - Id) < Fd ? (e.point(n, r = (r + o) / 2 > 0 ? qd : -qd), e.point(i, r), e.lineEnd(), e.lineStart(), e.point(u, r), e.point(s, r), t = 0) : i !== u && a >= Id && (Xd(n - i) < Fd && (n -= i * Fd), Xd(s - u) < Fd && (s -= u * Fd), r = function (e, t, n, r) {
                    var i, s, o = Gd(e - n);
                    return Xd(o) > Fd ? Vd((Gd(t) * (s = Jd(r)) * Gd(n) - Gd(r) * (i = Jd(t)) * Gd(e)) / (i * s * o)) : (t + r) / 2
                }(n, r, s, o), e.point(i, r), e.lineEnd(), e.lineStart(), e.point(u, r), t = 0), e.point(n = s, r = o), i = u
            }, lineEnd: function () {
                e.lineEnd(), n = r = NaN
            }, clean: function () {
                return 2 - t
            }
        }
    }, function (e, t, n, r) {
        var i;
        if (null == e) i = n * qd, r.point(-Id, i), r.point(0, i), r.point(Id, i), r.point(Id, 0), r.point(Id, -i), r.point(0, -i), r.point(-Id, -i), r.point(-Id, 0), r.point(-Id, i); else if (Xd(e[0] - t[0]) > Fd) {
            var s = e[0] < t[0] ? Id : -Id;
            i = n * s / 2, r.point(-s, i), r.point(0, i), r.point(s, i)
        } else r.point(t[0], t[1])
    }, [-Id, -qd]), Sv = function (e, t) {
        function n(e, t) {
            return Jd(e) * Jd(t) > s
        }

        function r(e, t, n) {
            var r = [1, 0, 0], i = to(Zs(e), Zs(t)), o = eo(i, i), u = i[0], a = o - u * u;
            if (!a) return !n && e;
            var f = s * o / a, l = -s * u / a, c = to(r, i), h = ro(r, f);
            no(h, ro(i, l));
            var p = c, d = eo(h, p), v = eo(p, p), m = d * d - v * (eo(h, h) - 1);
            if (!(m < 0)) {
                var g = Yd(m), y = ro(p, (-d - g) / v);
                if (no(y, h), y = Ys(y), !n) return y;
                var b, w = e[0], E = t[0], S = e[1], x = t[1];
                E < w && (b = w, w = E, E = b);
                var T = E - w, N = Xd(T - Id) < Fd;
                if (!N && x < S && (b = S, S = x, x = b), N || T < Fd ? N ? S + x > 0 ^ y[1] < (Xd(y[0] - w) < Fd ? S : x) : S <= y[1] && y[1] <= x : T > Id ^ (w <= y[0] && y[0] <= E)) {
                    var C = ro(p, (-d + g) / v);
                    return no(C, h), [y, Ys(C)]
                }
            }
        }

        function i(t, n) {
            var r = o ? e : Id - e, i = 0;
            return t < -r ? i |= 1 : t > r && (i |= 2), n < -r ? i |= 4 : n > r && (i |= 8), i
        }

        var s = Jd(e), o = s > 0, u = Xd(s) > Fd;
        return wv(n, function (e) {
            var t, s, a, f, l;
            return {
                lineStart: function () {
                    f = a = !1, l = 1
                }, point: function (c, h) {
                    var p, d = [c, h], v = n(c, h), m = o ? v ? 0 : i(c, h) : v ? i(c + (c < 0 ? Id : -Id), h) : 0;
                    if (!t && (f = a = v) && e.lineStart(), v !== a && (!(p = r(t, d)) || uv(t, p) || uv(d, p)) && (d[0] += Fd, d[1] += Fd, v = n(d[0], d[1])), v !== a) l = 0, v ? (e.lineStart(), p = r(d, t), e.point(p[0], p[1])) : (p = r(t, d), e.point(p[0], p[1]), e.lineEnd()), t = p; else if (u && t && o ^ v) {
                        var g;
                        m & s || !(g = r(d, t, !0)) || (l = 0, o ? (e.lineStart(), e.point(g[0][0], g[0][1]), e.point(g[1][0], g[1][1]), e.lineEnd()) : (e.point(g[1][0], g[1][1]), e.lineEnd(), e.lineStart(), e.point(g[0][0], g[0][1])))
                    }
                    !v || t && uv(t, d) || e.point(d[0], d[1]), t = d, a = v, s = m
                }, lineEnd: function () {
                    a && e.lineEnd(), t = null
                }, clean: function () {
                    return l | (f && a) << 1
                }
            }
        }, function (n, r, i, s) {
            !function (e, t, n, r, i, s) {
                if (n) {
                    var o = Jd(t), u = Gd(t), a = r * n;
                    null == i ? (i = t + r * Ud, s = t - a / 2) : (i = lo(o, i), s = lo(o, s), (r > 0 ? i < s : i > s) && (i += r * Ud));
                    for (var f, l = i; r > 0 ? l > s : l < s; l -= a) f = Ys([o, -u * Jd(l), -u * Gd(l)]), e.point(f[0], f[1])
                }
            }(s, e, t, i, n, r)
        }, o ? [0, -e] : [-Id, e - Id])
    };
    yo.prototype = {
        constructor: yo, point: function (e, t) {
            this.stream.point(e, t)
        }, sphere: function () {
            this.stream.sphere()
        }, lineStart: function () {
            this.stream.lineStart()
        }, lineEnd: function () {
            this.stream.lineEnd()
        }, polygonStart: function () {
            this.stream.polygonStart()
        }, polygonEnd: function () {
            this.stream.polygonEnd()
        }
    };
    var xv = 16, Tv = Jd(30 * Wd), Nv = function (e, t) {
        return +t ? function (e, t) {
            function n(r, i, s, o, u, a, f, l, c, h, p, d, v, m) {
                var g = f - r, y = l - i, b = g * g + y * y;
                if (b > 4 * t && v--) {
                    var w = o + h, E = u + p, S = a + d, x = Yd(w * w + E * E + S * S), T = $s(S /= x),
                        N = Xd(Xd(S) - 1) < Fd || Xd(s - c) < Fd ? (s + c) / 2 : $d(E, w), C = e(N, T), k = C[0],
                        L = C[1], A = k - r, O = L - i, M = y * A - g * O;
                    (M * M / b > t || Xd((g * A + y * O) / b - .5) > .3 || o * h + u * p + a * d < Tv) && (n(r, i, s, o, u, a, k, L, N, w /= x, E /= x, S, v, m), m.point(k, L), n(k, L, N, w, E, S, f, l, c, h, p, d, v, m))
                }
            }

            return function (t) {
                function r(n, r) {
                    n = e(n, r), t.point(n[0], n[1])
                }

                function i() {
                    g = NaN, S.point = s, t.lineStart()
                }

                function s(r, i) {
                    var s = Zs([r, i]), o = e(r, i);
                    n(g, y, m, b, w, E, g = o[0], y = o[1], m = r, b = s[0], w = s[1], E = s[2], xv, t), t.point(g, y)
                }

                function o() {
                    S.point = r, t.lineEnd()
                }

                function u() {
                    i(), S.point = a, S.lineEnd = f
                }

                function a(e, t) {
                    s(l = e, t), c = g, h = y, p = b, d = w, v = E, S.point = s
                }

                function f() {
                    n(g, y, m, b, w, E, c, h, l, p, d, v, xv, t), S.lineEnd = o, o()
                }

                var l, c, h, p, d, v, m, g, y, b, w, E, S = {
                    point: r, lineStart: i, lineEnd: o, polygonStart: function () {
                        t.polygonStart(), S.lineStart = u
                    }, polygonEnd: function () {
                        t.polygonEnd(), S.lineStart = i
                    }
                };
                return S
            }
        }(e, t) : function (e) {
            return go({
                point: function (t, n) {
                    t = e(t, n), this.stream.point(t[0], t[1])
                }
            })
        }(e)
    }, Cv = go({
        point: function (e, t) {
            this.stream.point(e * Wd, t * Wd)
        }
    });
    Eo.invert = function (e, t) {
        return [e, 2 * Vd(Kd(t)) - qd]
    }, So.invert = function (e, t) {
        return [-t, 2 * Vd(Kd(e)) - qd]
    };
    var kv = function () {
        var e = function (e) {
            function t() {
                var t = Id * u(), o = s(iv(s.rotate()).invert([0, 0]));
                return f(null == l ? [[o[0] - t, o[1] - t], [o[0] + t, o[1] + t]] : e === Eo ? [[Math.max(o[0] - t, l), n], [Math.min(o[0] + t, r), i]] : [[l, Math.max(o[1] - t, n)], [r, Math.min(o[1] + t, i)]])
            }

            var n, r, i, s = wo(e), o = s.center, u = s.scale, a = s.translate, f = s.clipExtent, l = null;
            return s.scale = function (e) {
                return arguments.length ? (u(e), t()) : u()
            }, s.translate = function (e) {
                return arguments.length ? (a(e), t()) : a()
            }, s.center = function (e) {
                return arguments.length ? (o(e), t()) : o()
            }, s.clipExtent = function (e) {
                return arguments.length ? (null == e ? l = n = r = i = null : (l = +e[0][0], n = +e[0][1], r = +e[1][0], i = +e[1][1]), t()) : null == l ? null : [[l, n], [r, i]]
            }, t()
        }(So), t = e.center, n = e.rotate;
        return e.center = function (e) {
            return arguments.length ? t([-e[1], e[0]]) : (e = t(), [e[1], -e[0]])
        }, e.rotate = function (e) {
            return arguments.length ? n([e[0], e[1], e.length > 2 ? e[2] + 90 : 90]) : (e = n(), [e[0], e[1], e[2] - 90])
        }, n([0, 0, 90]).scale(159.155)
    };
    e.projection = Cu, e.random = vf, e.clusters = mf, e.helpers = qo, e.invariant = Uo, e.meta = Ro, e.isolines = function (e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.zProperty || "elevation", i = n.commonProperties || {}, s = n.breaksProperties || [];
        if (J(e, "Point", "Input must contain Points"), !t) throw new Error("breaks is required");
        if (!Array.isArray(t)) throw new Error("breaks must be an Array");
        if (!T(i)) throw new Error("commonProperties must be an Object");
        if (!Array.isArray(s)) throw new Error("breaksProperties must be an Array");
        var o = rt(e, {zProperty: r, flip: !0});
        return f(function (e, t, n) {
            var r = U(n), i = r[2] - r[0], s = r[3] - r[1], o = r[0], u = r[1], a = t[0].length - 1, f = t.length - 1,
                l = i / a, c = s / f, h = function (e) {
                    e[0] = e[0] * l + o, e[1] = e[1] * c + u
                };
            return e.forEach(function (e) {
                k(e, h)
            }), e
        }(function (e, t, n, r, i) {
            for (var s = [], o = 1; o < t.length; o++) {
                var u = +t[o], a = Object.assign({}, r, i[o]);
                a[n] = u;
                var f = l(Y(e, u), a);
                s.push(f)
            }
            return s
        }(o, t, r, i, s), o, e))
    }, e.convex = At, e.pointsWithinPolygon = _t, e.concave = function (e, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        if (!e) throw new Error("points is required");
        var r = n.maxEdge || 1 / 0;
        if (!x(r)) throw new Error("maxEdge is invalid");
        var i = Dt(function (e) {
            var t = [], n = {};
            return M(e, function (e) {
                if (e.geometry) {
                    var r = e.geometry.coordinates.join("-");
                    n.hasOwnProperty(r) || (t.push(e), n[r] = !0)
                }
            }), f(t)
        }(e));
        if (i.features = i.features.filter(function (e) {
            var t = e.geometry.coordinates[0][0], i = e.geometry.coordinates[0][1], s = e.geometry.coordinates[0][2],
                o = jt(t, i, n), u = jt(i, s, n), a = jt(t, s, n);
            return o <= r && u <= r && a <= r
        }), i.features.length < 1) return null;
        var s = Zt(i, n);
        return 1 === s.coordinates.length && (s.coordinates = s.coordinates[0], s.type = "Polygon"), t(s)
    }, e.collect = function (e, t, n, r) {
        var i = Vo(6), s = t.features.map(function (e) {
            return {
                minX: e.geometry.coordinates[0],
                minY: e.geometry.coordinates[1],
                maxX: e.geometry.coordinates[0],
                maxY: e.geometry.coordinates[1],
                property: e.properties[n]
            }
        });
        return i.load(s), e.features.forEach(function (e) {
            e.properties || (e.properties = {});
            var t = U(e), n = [];
            i.search({minX: t[0], minY: t[1], maxX: t[2], maxY: t[3]}).forEach(function (t) {
                Ot([t.minX, t.minY], e) && n.push(t.property)
            }), e.properties[r] = n
        }), e
    }, e.flip = function (e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.mutate;
        if (!e) throw new Error("geojson is required");
        return !1 !== n && void 0 !== n || (e = Ft(e)), k(e, function (e) {
            var t = e[0], n = e[1];
            e[0] = n, e[1] = t
        }), e
    }, e.simplify = function (e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = void 0 !== t.tolerance ? t.tolerance : 1, r = t.highQuality || !1, i = t.mutate || !1;
        if (!e) throw new Error("geojson is required");
        if (n && n < 0) throw new Error("invalid tolerance");
        return !0 !== i && (e = Ft(e)), P(e, function (e) {
            !function (e, t, n) {
                var r = e.type;
                if ("Point" === r || "MultiPoint" === r) return e;
                en(e, !0);
                var i = e.coordinates;
                switch (r) {
                    case"LineString":
                        e.coordinates = un(i, t, n);
                        break;
                    case"MultiLineString":
                        e.coordinates = i.map(function (e) {
                            return un(e, t, n)
                        });
                        break;
                    case"Polygon":
                        e.coordinates = an(i, t, n);
                        break;
                    case"MultiPolygon":
                        e.coordinates = i.map(function (e) {
                            return an(e, t, n)
                        })
                }
            }(e, n, r)
        }), e
    }, e.bezierSpline = fn, e.tag = function (e, t, n, r) {
        return e = Ft(e), t = Ft(t), M(e, function (e) {
            e.properties || (e.properties = {}), M(t, function (t) {
                void 0 === e.properties[r] && Ot(e, t) && (e.properties[r] = t.properties[n])
            })
        }), e
    }, e.sample = function (e, t) {
        if (!e) throw new Error("featurecollection is required");
        if (null === t || void 0 === t) throw new Error("num is required");
        if ("number" != typeof t) throw new Error("num must be a number");
        return f(function (e, t) {
            for (var n, r, i = e.slice(0), s = e.length, o = s - t; s-- > o;) r = Math.floor((s + 1) * Math.random()), n = i[r], i[r] = i[s], i[s] = n;
            return i.slice(o)
        }(e.features, t))
    }, e.envelope = cn, e.square = hn, e.circle = dn, e.midpoint = function (e, t) {
        return pn(e, jt(e, t) / 2, vn(e, t))
    }, e.center = mn, e.centerOfMass = yn, e.centroid = gn, e.combine = function (e) {
        function n(e, t, n) {
            n ? r[t].coordinates = r[t].coordinates.concat(e.geometry.coordinates) : r[t].coordinates.push(e.geometry.coordinates), r[t].properties.push(e.properties)
        }

        var r = {
            MultiPoint: {coordinates: [], properties: []},
            MultiLineString: {coordinates: [], properties: []},
            MultiPolygon: {coordinates: [], properties: []}
        }, i = Object.keys(r).reduce(function (e, t) {
            return e[t.replace("Multi", "")] = t, e
        }, {});
        return M(e, function (e) {
            e.geometry && (r[e.geometry.type] ? n(e, e.geometry.type, !0) : i[e.geometry.type] && n(e, i[e.geometry.type], !1))
        }), f(Object.keys(r).filter(function (e) {
            return r[e].coordinates.length
        }).sort().map(function (e) {
            return t({type: e, coordinates: r[e].coordinates}, {collectedProperties: r[e].properties})
        }))
    }, e.distance = jt, e.explode = bn, e.bbox = U, e.tesselate = function (e) {
        if (!e.geometry || "Polygon" !== e.geometry.type && "MultiPolygon" !== e.geometry.type) throw new Error("input must be a Polygon or MultiPolygon");
        var t = {type: "FeatureCollection", features: []};
        return "Polygon" === e.geometry.type ? t.features = Bn(e.geometry.coordinates) : e.geometry.coordinates.forEach(function (e) {
            t.features = t.features.concat(Bn(e))
        }), t
    }, e.bboxPolygon = ln, e.booleanPointInPolygon = Ot, e.nearestPoint = jn, e.nearestPointOnLine = sr, e.nearestPointToLine = function (e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.units, i = n.properties || {};
        if (!e) throw new Error("points is required");
        if (!(e = function (e) {
            var t = [];
            switch (e.geometry ? e.geometry.type : e.type) {
                case"GeometryCollection":
                    return P(e, function (e) {
                        "Point" === e.type && t.push({type: "Feature", properties: {}, geometry: e})
                    }), {type: "FeatureCollection", features: t};
                case"FeatureCollection":
                    return e.features = e.features.filter(function (e) {
                        return "Point" === e.geometry.type
                    }), e;
                default:
                    throw new Error("points must be a Point Collection")
            }
        }(e)).features.length) throw new Error("points must contain features");
        if (!t) throw new Error("line is required");
        if ("LineString" !== G(t)) throw new Error("line must be a LineString");
        var s = 1 / 0, o = null;
        return M(e, function (e) {
            var n = dr(e, t, {units: r});
            n < s && (s = n, o = e)
        }), o && (o.properties = Object.assign({dist: s}, o.properties, i)), o
    }, e.planepoint = function (e, t) {
        var n = z(e), r = K(t).coordinates[0];
        if (r.length < 4) throw new Error("OuterRing of a Polygon must have 4 or more Positions.");
        var i = t.properties || {}, s = i.a, o = i.b, u = i.c, a = n[0], f = n[1], l = r[0][0], c = r[0][1],
            h = void 0 !== s ? s : r[0][2], p = r[1][0], d = r[1][1], v = void 0 !== o ? o : r[1][2], m = r[2][0],
            g = r[2][1], y = void 0 !== u ? u : r[2][2];
        return (y * (a - l) * (f - d) + h * (a - p) * (f - g) + v * (a - m) * (f - c) - v * (a - l) * (f - g) - y * (a - p) * (f - c) - h * (a - m) * (f - d)) / ((a - l) * (f - d) + (a - p) * (f - g) + (a - m) * (f - c) - (a - l) * (f - g) - (a - p) * (f - c) - (a - m) * (f - d))
    }, e.tin = Dt, e.bearing = vn, e.destination = pn, e.kinks = function (e) {
        var t, n, i = {type: "FeatureCollection", features: []};
        if ("LineString" === (n = "Feature" === e.type ? e.geometry : e).type) t = [n.coordinates]; else if ("MultiLineString" === n.type) t = n.coordinates; else if ("MultiPolygon" === n.type) t = [].concat.apply([], n.coordinates); else {
            if ("Polygon" !== n.type) throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");
            t = n.coordinates
        }
        return t.forEach(function (e) {
            t.forEach(function (t) {
                for (var n = 0; n < e.length - 1; n++) for (var s = n; s < t.length - 1; s++) {
                    if (e === t) {
                        if (1 === Math.abs(n - s)) continue;
                        if (0 === n && s === e.length - 2 && e[n][0] === e[e.length - 1][0] && e[n][1] === e[e.length - 1][1]) continue
                    }
                    var o = function (e, t, n, r, i, s, o, u) {
                        var a, f, l, c, h, p = {x: null, y: null, onLine1: !1, onLine2: !1};
                        return 0 == (a = (u - s) * (n - e) - (o - i) * (r - t)) ? null !== p.x && null !== p.y && p : (f = t - s, l = e - i, c = (o - i) * f - (u - s) * l, h = (n - e) * f - (r - t) * l, f = c / a, l = h / a, p.x = e + f * (n - e), p.y = t + f * (r - t), f >= 0 && f <= 1 && (p.onLine1 = !0), l >= 0 && l <= 1 && (p.onLine2 = !0), !!p.onLine1 && !!p.onLine2 && [p.x, p.y])
                    }(e[n][0], e[n][1], e[n + 1][0], e[n + 1][1], t[s][0], t[s][1], t[s + 1][0], t[s + 1][1]);
                    o && i.features.push(r([o[0], o[1]]))
                }
            })
        }), i
    }, e.pointOnFeature = mr, e.area = yr, e.along = function (e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var i;
        if ("Feature" === e.type) i = e.geometry.coordinates; else {
            if ("LineString" !== e.type) throw new Error("input must be a LineString Feature or Geometry");
            i = e.coordinates
        }
        if (!x(t)) throw new Error("distance must be a number");
        for (var s = 0, o = 0; o < i.length && !(t >= s && o === i.length - 1); o++) {
            if (s >= t) {
                var u = t - s;
                if (u) {
                    var a = vn(i[o], i[o - 1]) - 180;
                    return pn(i[o], u, a, n)
                }
                return r(i[o])
            }
            s += jt(i[o], i[o + 1], n)
        }
        return r(i[i.length - 1])
    }, e.length = xr, e.lineSlice = function (e, t, n) {
        var r = W(n);
        if ("LineString" !== G(n)) throw new Error("line must be a LineString");
        for (var i, s = sr(n, e), o = sr(n, t), a = [(i = s.properties.index <= o.properties.index ? [s, o] : [o, s])[0].geometry.coordinates], f = i[0].properties.index + 1; f < i[1].properties.index + 1; f++) a.push(r[f]);
        return a.push(i[1].geometry.coordinates), u(a, n.properties)
    }, e.lineSliceAlong = Tr, e.pointGrid = Ar, e.truncate = Or, e.flatten = function (e) {
        if (!e) throw new Error("geojson is required");
        var t = [];
        return B(e, function (e) {
            t.push(e)
        }), f(t)
    }, e.lineIntersect = rr, e.lineChunk = function (e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.units, i = n.reverse;
        if (!e) throw new Error("geojson is required");
        if (t <= 0) throw new Error("segmentLength must be greater than 0");
        var s = [];
        return B(e, function (e) {
            i && (e.geometry.coordinates = e.geometry.coordinates.reverse()), function (e, t, n, r) {
                var i = xr(e, {units: n});
                if (i <= t) return r(e);
                var s = i / t;
                Number.isInteger(s) || (s = Math.floor(s) + 1);
                for (var o = 0; o < s; o++) {
                    var u = Tr(e, t * o, t * (o + 1), {units: n});
                    r(u, o)
                }
            }(e, t, r, function (e) {
                s.push(e)
            })
        }), f(s)
    }, e.unkinkPolygon = function (e) {
        var t = [];
        return B(e, function (e) {
            "Polygon" === e.geometry.type && M(Au(e), function (n) {
                t.push(s(n.geometry.coordinates, e.properties))
            })
        }), f(t)
    }, e.greatCircle = function (e, t, n) {
        if ("object" != typeof (n = n || {})) throw new Error("options is invalid");
        var r = n.properties, i = n.npoints, s = n.offset;
        return e = z(e), t = z(t), r = r || {}, i = i || 100, s = s || 10, (new ju({x: e[0], y: e[1]}, {
            x: t[0],
            y: t[1]
        }, r)).Arc(i, {offset: s}).json()
    }, e.lineSegment = nr, e.lineSplit = function (e, t) {
        if (!e) throw new Error("line is required");
        if (!t) throw new Error("splitter is required");
        var n = G(e), r = G(t);
        if ("LineString" !== n) throw new Error("line must be LineString");
        if ("FeatureCollection" === r) throw new Error("splitter cannot be a FeatureCollection");
        if ("GeometryCollection" === r) throw new Error("splitter cannot be a GeometryCollection");
        var i = Or(t, {precision: 7});
        switch (r) {
            case"Point":
                return Hr(e, i);
            case"MultiPoint":
                return Pr(e, i);
            case"LineString":
            case"MultiLineString":
            case"Polygon":
            case"MultiPolygon":
                return Pr(e, rr(e, i))
        }
    }, e.lineArc = Fr, e.polygonToLine = qr, e.lineToPolygon = Ur, e.bboxClip = function (e, t) {
        var n = function (e) {
            return e.geometry ? e.geometry.type : e.type
        }(e), r = W(e), i = e.properties;
        switch (n) {
            case"LineString":
            case"MultiLineString":
                var o = [];
                return "LineString" === n && (r = [r]), r.forEach(function (e) {
                    Fu(e, t, o)
                }), 1 === o.length ? u(o[0], i) : l(o, i);
            case"Polygon":
                return s(Jr(r, t), i);
            case"MultiPolygon":
                return h(r.map(function (e) {
                    return Jr(e, t)
                }), i);
            default:
                throw new Error("geometry " + n + " not supported")
        }
    }, e.lineOverlap = Zr, e.sector = function (e, t, n, r, i) {
        if (i = i || {}, !T(i)) throw new Error("options is invalid");
        if (!e) throw new Error("center is required");
        if (void 0 === n || null === n) throw new Error("bearing1 is required");
        if (void 0 === r || null === r) throw new Error("bearing2 is required");
        if (!t) throw new Error("radius is required");
        if ("object" != typeof i) throw new Error("options must be an object");
        if (ti(n) === ti(r)) return dn(e, t, i);
        var o = W(e), u = [[o]];
        return k(Fr(e, t, n, r, i), function (e) {
            u[0].push(e)
        }), u[0].push(o), s(u)
    }, e.rhumbBearing = or, e.rhumbDistance = ar, e.rhumbDestination = ni, e.polygonTangents = function (e, t) {
        var n, i, s, o = W(e), u = W(t);
        switch (G(t)) {
            case"Polygon":
                n = u[0][0], i = u[0][0], s = ii(u[0][0], u[0][u[0].length - 1], o);
                var a = ri(u[0], o, s, void 0, n, i);
                n = a[0], i = a[1];
                break;
            case"MultiPolygon":
                n = u[0][0][0], i = u[0][0][0], s = ii(u[0][0][0], u[0][0][u[0][0].length - 1], o), u.forEach(function (e) {
                    var t = ri(e[0], o, s, void 0, n, i);
                    n = t[0], i = t[1]
                })
        }
        return f([r(n), r(i)])
    }, e.rewind = function (e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.reverse || !1, r = t.mutate || !1;
        if (!e) throw new Error("<geojson> is required");
        if ("boolean" != typeof n) throw new Error("<reverse> must be a boolean");
        if ("boolean" != typeof r) throw new Error("<mutate> must be a boolean");
        !1 === r && (e = Ft(e));
        var i = [];
        switch (e.type) {
            case"GeometryCollection":
                return P(e, function (e) {
                    oi(e, n)
                }), e;
            case"FeatureCollection":
                return M(e, function (e) {
                    M(oi(e, n), function (e) {
                        i.push(e)
                    })
                }), f(i)
        }
        return oi(e, n)
    }, e.isobands = function (e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.zProperty || "elevation", i = n.commonProperties || {}, o = n.breaksProperties || [];
        if (J(e, "Point", "Input must contain Points"), !t) throw new Error("breaks is required");
        if (!Array.isArray(t)) throw new Error("breaks is not an Array");
        if (!T(i)) throw new Error("commonProperties is not an Object");
        if (!Array.isArray(o)) throw new Error("breaksProperties is not an Array");
        var u = fi(e, {zProperty: r, flip: !0}), a = function (e, t, n) {
            for (var r = [], i = 1; i < t.length; i++) {
                var o = +t[i - 1], u = +t[i], a = li(e, o, u - o), f = function (e) {
                    var t = [], n = [];
                    e.forEach(function (e) {
                        var r = yr(s([e]));
                        n.push(r), t.push({ring: e, area: r})
                    }), n.sort(function (e, t) {
                        return t - e
                    });
                    var r = [];
                    return n.forEach(function (e) {
                        for (var n = 0; n < t.length; n++) if (t[n].area === e) {
                            r.push(t[n].ring), t.splice(n, 1);
                            break
                        }
                    }), r
                }(a), l = function (e) {
                    for (var t = e.map(function (e) {
                        return {lrCoordinates: e, grouped: !1}
                    }), n = []; !function (e) {
                        for (var t = 0; t < e.length; t++) if (!1 === e[t].grouped) return !1;
                        return !0
                    }(t);) for (var r = 0; r < t.length; r++) if (!t[r].grouped) {
                        var i = [];
                        i.push(t[r].lrCoordinates), t[r].grouped = !0;
                        for (var o = s([t[r].lrCoordinates]), u = r + 1; u < t.length; u++) if (!t[u].grouped) {
                            var a = s([t[u].lrCoordinates]);
                            (function (e, t) {
                                for (var n = bn(e), r = 0; r < n.features.length; r++) if (!Ot(n.features[r], t)) return !1;
                                return !0
                            })(a, o) && (i.push(t[u].lrCoordinates), t[u].grouped = !0)
                        }
                        n.push(i)
                    }
                    return n
                }(f), c = {};
                c.groupedRings = l, c[n] = o + "-" + u, r.push(c)
            }
            return r
        }(u, t, r);
        return f((a = function (e, t, n) {
            var r = U(n), i = r[2] - r[0], s = r[3] - r[1], o = r[0], u = r[1], a = t[0].length - 1, f = t.length - 1,
                l = i / a, c = s / f, h = function (e) {
                    e[0] = e[0] * l + o, e[1] = e[1] * c + u
                };
            return e.forEach(function (e) {
                e.groupedRings.forEach(function (e) {
                    e.forEach(function (e) {
                        e.forEach(h)
                    })
                })
            }), e
        }(a, u, e)).map(function (e, t) {
            if (o[t] && !T(o[t])) throw new Error("Each mappedProperty is required to be an Object");
            var n = Object.assign({}, i, o[t]);
            return n[r] = e[r], h(e.groupedRings, n)
        }))
    }, e.transformRotate = pi, e.transformScale = di, e.transformTranslate = function (e, t, n, r) {
        if (r = r || {}, !T(r)) throw new Error("options is invalid");
        var i = r.units, s = r.zTranslation, o = r.mutate;
        if (!e) throw new Error("geojson is required");
        if (void 0 === t || null === t || isNaN(t)) throw new Error("distance is required");
        if (s && "number" != typeof s && isNaN(s)) throw new Error("zTranslation is not a number");
        if (s = void 0 !== s ? s : 0, 0 === t && 0 === s) return e;
        if (void 0 === n || null === n || isNaN(n)) throw new Error("direction is required");
        return t < 0 && (t = -t, n = -n), !1 !== o && void 0 !== o || (e = Ft(e)), k(e, function (e) {
            var r = W(ni(e, t, n, {units: i}));
            e[0] = r[0], e[1] = r[1], s && 3 === e.length && (e[2] += s)
        }), e
    }, e.lineOffset = function (e, t, n) {
        if (n = n || {}, !T(n)) throw new Error("options is invalid");
        var r = n.units;
        if (!e) throw new Error("geojson is required");
        if (void 0 === t || null === t || isNaN(t)) throw new Error("distance is required");
        var i = G(e), s = e.properties;
        switch (i) {
            case"LineString":
                return bi(e, t, r);
            case"MultiLineString":
                var o = [];
                return B(e, function (e) {
                    o.push(bi(e, t, r).geometry.coordinates)
                }), l(o, s);
            default:
                throw new Error("geometry " + i + " is not supported")
        }
    }, e.polygonize = function (e) {
        var t = ja.fromGeoJson(e);
        t.deleteDangles(), t.deleteCutEdges();
        var n = [], r = [];
        return t.getEdgeRings().filter(function (e) {
            return e.isValid()
        }).forEach(function (e) {
            e.isHole() ? n.push(e) : r.push(e)
        }), n.forEach(function (e) {
            Ha.findEdgeRingContaining(e, r) && r.push(e)
        }), f(r.map(function (e) {
            return e.toPolygon()
        }))
    }, e.booleanDisjoint = function (e, t) {
        var n;
        return B(e, function (e) {
            B(t, function (t) {
                if (!1 === n) return !1;
                n = function (e, t) {
                    switch (e.type) {
                        case"Point":
                            switch (t.type) {
                                case"Point":
                                    return !function (e, t) {
                                        return e[0] === t[0] && e[1] === t[1]
                                    }(e.coordinates, t.coordinates);
                                case"LineString":
                                    return !Si(t, e);
                                case"Polygon":
                                    return !Ot(e, t)
                            }
                            break;
                        case"LineString":
                            switch (t.type) {
                                case"Point":
                                    return !Si(e, t);
                                case"LineString":
                                    return !function (e, t) {
                                        return rr(e, t).features.length > 0
                                    }(e, t);
                                case"Polygon":
                                    return !xi(t, e)
                            }
                            break;
                        case"Polygon":
                            switch (t.type) {
                                case"Point":
                                    return !Ot(t, e);
                                case"LineString":
                                    return !xi(e, t);
                                case"Polygon":
                                    return !function (e, t) {
                                        for (var n = 0; n < e.coordinates[0].length; n++) if (Ot(e.coordinates[0][n], t)) return !0;
                                        for (var r = 0; r < t.coordinates[0].length; r++) if (Ot(t.coordinates[0][r], e)) return !0;
                                        return !1
                                    }(t, e)
                            }
                    }
                }(e.geometry, t.geometry)
            })
        }), n
    }, e.booleanContains = function (e, t) {
        var n = G(e), r = G(t), i = K(e), s = K(t), o = W(e), u = W(t);
        switch (n) {
            case"Point":
                switch (r) {
                    case"Point":
                        return Ni(o, u);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"MultiPoint":
                switch (r) {
                    case"Point":
                        return function (e, t) {
                            var n, r = !1;
                            for (n = 0; n < e.coordinates.length; n++) if (Ni(e.coordinates[n], t.coordinates)) {
                                r = !0;
                                break
                            }
                            return r
                        }(i, s);
                    case"MultiPoint":
                        return function (e, t) {
                            for (var n = 0; n < t.coordinates.length; n++) {
                                for (var r = !1, i = 0; i < e.coordinates.length; i++) if (Ni(t.coordinates[n], e.coordinates[i])) {
                                    r = !0;
                                    break
                                }
                                if (!r) return !1
                            }
                            return !0
                        }(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"LineString":
                switch (r) {
                    case"Point":
                        return Nr(s, i, {ignoreEndVertices: !0});
                    case"LineString":
                        return function (e, t) {
                            for (var n = !1, r = 0; r < t.coordinates.length; r++) if (Nr({
                                type: "Point",
                                coordinates: t.coordinates[r]
                            }, e, {ignoreEndVertices: !0}) && (n = !0), !Nr({
                                type: "Point",
                                coordinates: t.coordinates[r]
                            }, e, {ignoreEndVertices: !1})) return !1;
                            return n
                        }(i, s);
                    case"MultiPoint":
                        return function (e, t) {
                            for (var n = !1, r = 0; r < t.coordinates.length; r++) if (Nr(t.coordinates[r], e, {ignoreEndVertices: !0}) && (n = !0), !Nr(t.coordinates[r], e)) return !1;
                            return !!n
                        }(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"Polygon":
                switch (r) {
                    case"Point":
                        return Ot(s, i, {ignoreBoundary: !0});
                    case"LineString":
                        return function (e, t) {
                            var n = !1, r = 0, i = U(e), s = U(t);
                            if (!Ti(i, s)) return !1;
                            for (; r < t.coordinates.length - 1; r++) {
                                var o = function (e, t) {
                                    return [(e[0] + t[0]) / 2, (e[1] + t[1]) / 2]
                                }(t.coordinates[r], t.coordinates[r + 1]);
                                if (Ot({type: "Point", coordinates: o}, e, {ignoreBoundary: !0})) {
                                    n = !0;
                                    break
                                }
                            }
                            return n
                        }(i, s);
                    case"Polygon":
                        return function (e, t) {
                            var n = U(e), r = U(t);
                            if (!Ti(n, r)) return !1;
                            for (var i = 0; i < t.coordinates[0].length; i++) if (!Ot(t.coordinates[0][i], e)) return !1;
                            return !0
                        }(i, s);
                    case"MultiPoint":
                        return function (e, t) {
                            for (var n = 0; n < t.coordinates.length; n++) if (!Ot(t.coordinates[n], e, {ignoreBoundary: !0})) return !1;
                            return !0
                        }(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            default:
                throw new Error("feature1 " + n + " geometry not supported")
        }
    }, e.booleanCrosses = function (e, t) {
        var n = G(e), r = G(t), i = K(e), s = K(t);
        switch (n) {
            case"MultiPoint":
                switch (r) {
                    case"LineString":
                        return Ci(i, s);
                    case"Polygon":
                        return Li(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"LineString":
                switch (r) {
                    case"MultiPoint":
                        return Ci(s, i);
                    case"LineString":
                        return function (e, t) {
                            if (rr(e, t).features.length > 0) for (var n = 0; n < e.coordinates.length - 1; n++) for (var r = 0; r < t.coordinates.length - 1; r++) {
                                var i = !0;
                                if (0 !== r && r !== t.coordinates.length - 2 || (i = !1), Ai(e.coordinates[n], e.coordinates[n + 1], t.coordinates[r], i)) return !0
                            }
                            return !1
                        }(i, s);
                    case"Polygon":
                        return ki(i, s);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            case"Polygon":
                switch (r) {
                    case"MultiPoint":
                        return Li(s, i);
                    case"LineString":
                        return ki(s, i);
                    default:
                        throw new Error("feature2 " + r + " geometry not supported")
                }
                ;
            default:
                throw new Error("feature1 " + n + " geometry not supported")
        }
    }, e.booleanClockwise = si, e.booleanOverlap = Di, e.booleanPointOnLine = Nr, e.booleanEqual = function (e, t) {
        if (!e) throw new Error("feature1 is required");
        if (!t) throw new Error("feature2 is required");
        return G(e) === G(t) && (new Ua({precision: 6})).compare(en(e), en(t))
    }, e.booleanWithin = Cr, e.clone = Ft, e.cleanCoords = en, e.clustersDbscan = function (e, t, n) {
        if ("object" != typeof (n = n || {})) throw new Error("options is invalid");
        var r = n.minPoints, i = n.units;
        if (J(e, "Point", "Input must contain Points"), null === t || void 0 === t) throw new Error("maxDistance is required");
        if (Math.sign(t) > 0) {
            if (void 0 === r || null === r || Math.sign(r) > 0) {
                e = Ft(e), r = r || 3;
                var s = new $a.DBSCAN, o = -1;
                return s.run(D(e), E(t, i), r, jt).forEach(function (t) {
                    o++, t.forEach(function (t) {
                        var n = e.features[t];
                        n.properties || (n.properties = {}), n.properties.cluster = o, n.properties.dbscan = "core"
                    })
                }), s.noise.forEach(function (t) {
                    var n = e.features[t];
                    n.properties || (n.properties = {}), n.properties.cluster ? n.properties.dbscan = "edge" : n.properties.dbscan = "noise"
                }), e
            }
            throw new Error("Invalid minPoints")
        }
        throw new Error("Invalid maxDistance")
    }, e.clustersKmeans = function (e, t) {
        if ("object" != typeof (t = t || {})) throw new Error("options is invalid");
        var n = t.numberOfClusters, r = t.mutate;
        J(e, "Point", "Input must contain Points");
        var i = e.features.length;
        (n = n || Math.round(Math.sqrt(i / 2))) > i && (n = i), !1 !== r && void 0 !== r || (e = Ft(e));
        var s = D(e), o = s.slice(0, n), u = tf(s, n, o), a = {};
        return u.centroids.forEach(function (e, t) {
            a[t] = e
        }), M(e, function (e, t) {
            var n = u.idxs[t];
            e.properties.cluster = n, e.properties.centroid = a[n]
        }), e
    }, e.pointToLineDistance = dr, e.booleanParallel = function (e, t) {
        if (!e) throw new Error("line1 is required");
        if (!t) throw new Error("line2 is required");
        if ("LineString" !== Hi(e, "line1")) throw new Error("line1 must be a LineString");
        if ("LineString" !== Hi(t, "line2")) throw new Error("line2 must be a LineString");
        for (var n = nr(en(e)).features, r = nr(en(t)).features, i = 0; i < n.length; i++) {
            var s = n[i].geometry.coordinates;
            if (!r[i]) break;
            if (!function (e, t) {
                var n = y(or(e[0], e[1])), r = y(or(t[0], t[1]));
                return n === r
            }(s, r[i].geometry.coordinates)) return !1
        }
        return !0
    }, e.shortestPath = function (e, n, i) {
        if (i = i || {}, !T(i)) throw new Error("options is invalid");
        var s = i.resolution, o = i.minDistance, a = i.obstacles || f([]);
        if (!e) throw new Error("start is required");
        if (!n) throw new Error("end is required");
        if (s && !x(s) || s <= 0) throw new Error("options.resolution must be a number, greater than 0");
        if (o) throw new Error("options.minDistance is not yet implemented");
        var l = z(e), c = z(n);
        switch (e = r(l), n = r(c), G(a)) {
            case"FeatureCollection":
                if (0 === a.features.length) return u([l, c]);
                break;
            case"Polygon":
                a = f([t(K(a))]);
                break;
            default:
                throw new Error("invalid obstacles")
        }
        var h = a;
        h.features.push(e), h.features.push(n);
        var p = U(di(ln(U(h)), 1.15));
        s || (s = jt([p[0], p[1]], [p[2], p[1]], i) / 100), h.features.pop(), h.features.pop();
        for (var d = p[0], v = p[1], m = p[2], g = p[3], y = s / jt([d, v], [m, v], i) * (m - d), b = s / jt([d, v], [d, g], i) * (g - v), w = m - d, E = g - v, S = (w - Math.floor(w / y) * y) / 2, N = [], C = [], k = [], L = [], A = 1 / 0, O = 1 / 0, M = g - (E - Math.floor(E / b) * b) / 2, _ = 0; M >= v;) {
            for (var D = [], P = [], H = d + S, B = 0; H <= m;) {
                var j = r([H, M]), F = function (e, t) {
                    for (var n = 0; n < t.features.length; n++) if (Ot(e, t.features[n])) return !0;
                    return !1
                }(j, a);
                D.push(F ? 0 : 1), P.push(H + "|" + M);
                var I = jt(j, e);
                !F && I < A && (A = I, k = {x: B, y: _});
                var q = jt(j, n);
                !F && q < O && (O = q, L = {x: B, y: _}), H += y, B++
            }
            C.push(D), N.push(P), M -= b, _++
        }
        var R = new ji(C, {diagonal: !0}), W = R.grid[k.y][k.x], X = R.grid[L.y][L.x], V = [l];
        return nf.search(R, W, X).forEach(function (e) {
            var t = N[e.x][e.y].split("|");
            V.push([+t[0], +t[1]])
        }), V.push(c), en(u(V))
    }, e.voronoi = function (e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.bbox || [-180, -85, 180, 85];
        if (!e) throw new Error("points is required");
        if (!Array.isArray(n)) throw new Error("bbox is invalid");
        return J(e, "Point", "points"), f(df().x(function (e) {
            return e.geometry.coordinates[0]
        }).y(function (e) {
            return e.geometry.coordinates[1]
        }).extent([[n[0], n[1]], [n[2], n[3]]]).polygons(e.features).map(cs))
    }, e.ellipse = hs, e.centerMean = ds, e.centerMedian = function (e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.counter || 10;
        if (!x(n)) throw new Error("counter must be a number");
        var r = t.weight, i = ds(e, {weight: t.weight}), s = f([]);
        return M(e, function (e) {
            s.features.push(gn(e, {weight: e.properties[r]}))
        }), s.properties = {tolerance: t.tolerance, medianCandidates: []}, vs(i.geometry.coordinates, [0, 0], s, n)
    }, e.standardDeviationalEllipse = function (e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.steps || 64, r = t.weight, i = t.properties || {};
        if (!x(n)) throw new Error("steps must be a number");
        if (!T(i)) throw new Error("properties must be a number");
        var s = D(e).length, o = ds(e, {weight: r}), u = 0, a = 0, l = 0;
        M(e, function (e) {
            var t = e.properties[r] || 1, n = ms(W(e), W(o));
            u += Math.pow(n.x, 2) * t, a += Math.pow(n.y, 2) * t, l += n.x * n.y * t
        });
        var c = u - a, h = Math.sqrt(Math.pow(c, 2) + 4 * Math.pow(l, 2)), p = 2 * l, d = Math.atan((c + h) / p),
            v = 180 * d / Math.PI, m = 0, g = 0, y = 0;
        M(e, function (e) {
            var t = e.properties[r] || 1, n = ms(W(e), W(o));
            m += Math.pow(n.x * Math.cos(d) - n.y * Math.sin(d), 2) * t, g += Math.pow(n.x * Math.sin(d) + n.y * Math.cos(d), 2) * t, y += t
        });
        var b = Math.sqrt(2 * m / y), w = Math.sqrt(2 * g / y),
            E = hs(o, b, w, {units: "degrees", angle: v, steps: n, properties: i}), S = _t(e, f([E])), N = {
                meanCenterCoordinates: W(o),
                semiMajorAxis: b,
                semiMinorAxis: w,
                numberOfFeatures: s,
                angle: v,
                percentageWithinEllipse: 100 * D(S).length / s
            };
        return E.properties.standardDeviationalEllipse = N, E
    }, e.difference = function (e, n) {
        var r = K(e), i = K(n), s = e.properties || {};
        if (r = Ws(r), i = Ws(i), !r) return null;
        if (!i) return t(r, s);
        var o = new Tc, u = o.read(r), a = o.read(i), f = Cd.difference(u, a);
        return f.isEmpty() ? null : t((new Nc).write(f), s)
    }, e.buffer = function (e, t, n) {
        var r = (n = n || {}).units, i = n.steps || 64;
        if (!e) throw new Error("geojson is required");
        if ("object" != typeof n) throw new Error("options must be an object");
        if ("number" != typeof i) throw new Error("steps must be an number");
        if (void 0 === t) throw new Error("radius is required");
        if (i <= 0) throw new Error("steps must be greater than 0");
        i = i || 64, r = r || "kilometers";
        var s = [];
        switch (e.type) {
            case"GeometryCollection":
                return P(e, function (e) {
                    var n = xo(e, t, r, i);
                    n && s.push(n)
                }), f(s);
            case"FeatureCollection":
                return M(e, function (e) {
                    var n = xo(e, t, r, i);
                    n && M(n, function (e) {
                        e && s.push(e)
                    })
                }), f(s)
        }
        return xo(e, t, r, i)
    }, e.union = Lo, e.intersect = Ao, e.dissolve = function (e, t) {
        if (t = t || {}, !T(t)) throw new Error("options is invalid");
        var n = t.propertyName;
        J(e, "Polygon", "dissolve");
        var r = Ft(e), i = r.features, s = [];
        i.forEach(function (e, t) {
            e.properties.origIndexPosition = t
        });
        var o = Zn();
        o.load(r);
        for (var a in i) {
            var f = i[a], l = !1;
            if (o.search(f).features.forEach(function (e) {
                f = i[a];
                var t = e.properties.origIndexPosition;
                if (s.length > 0 && 0 !== t) if (t > s[s.length - 1]) t -= s.length; else {
                    var r = Oo(t, s);
                    0 !== r && (t -= r)
                }
                if (t !== +a) {
                    var c = i[t];
                    c && f && (void 0 !== n && c.properties[n] !== f.properties[n] || Di(f, c) && function (e, t) {
                        var n = u(D(e)), r = u(D(t));
                        return rr(n, r).features.length > 0
                    }(f, c) && (i[a] = Lo(f, c), s.push(e.properties.origIndexPosition), s.sort(function (e, t) {
                        return e - t
                    }), o.remove(e), i.splice(t, 1), f.properties.origIndexPosition = a, o.remove(f, function (e, t) {
                        return e.properties.origIndexPosition === t.properties.origIndexPosition
                    }), l = !0))
                }
            }), l) {
                if (!f) continue;
                f.properties.origIndexPosition = a, o.insert(f), a--
            }
        }
        return i.forEach(function (e) {
            delete e.properties.origIndexPosition, delete e.bbox
        }), r
    }, e.hexGrid = Mo, e.mask = function (e, t) {
        var n = function (e) {
            return s(e && e.geometry.coordinates || [[[180, 90], [-180, 90], [-180, -90], [180, -90], [180, 90]]])
        }(t), r = function (e) {
            var t = [], n = [];
            return B(e, function (e) {
                var r = e.geometry.coordinates, i = r[0], o = r.slice(1);
                t.push(s([i])), o.forEach(function (e) {
                    n.push(s([e]))
                })
            }), [f(t), f(n)]
        }(e), i = r[0], o = r[1];
        return function (e, t, n) {
            var r = [];
            return r.push(e.geometry.coordinates[0]), B(t, function (e) {
                r.push(e.geometry.coordinates[0])
            }), B(n, function (e) {
                r.push(e.geometry.coordinates[0])
            }), s(r)
        }(n, i = _o(i), o = _o(o))
    }, e.squareGrid = Po, e.triangleGrid = Ho, e.interpolate = function (e, t, n) {
        if ("object" != typeof (n = n || {})) throw new Error("options is invalid");
        var r = n.gridType, i = n.property, s = n.weight;
        if (!e) throw new Error("points is required");
        if (J(e, "Point", "input must contain Points"), !t) throw new Error("cellSize is required");
        if (void 0 !== s && "number" != typeof s) throw new Error("weight must be a number");
        i = i || "elevation", r = r || "square", s = s || 1;
        var o, u = U(e);
        switch (r) {
            case"point":
            case"points":
                o = Ar(u, t, n);
                break;
            case"square":
            case"squares":
                o = Po(u, t, n);
                break;
            case"hex":
            case"hexes":
                o = Mo(u, t, n);
                break;
            case"triangle":
            case"triangles":
                o = Ho(u, t, n);
                break;
            default:
                throw new Error("invalid gridType")
        }
        var a = [];
        return M(o, function (t) {
            var o = 0, u = 0;
            M(e, function (e) {
                var a, f = jt("point" === r ? t : gn(t), e, n);
                if (void 0 !== i && (a = e.properties[i]), void 0 === a && (a = e.geometry.coordinates[2]), void 0 === a) throw new Error("zValue is missing");
                0 === f && (o = a);
                var l = 1 / Math.pow(f, s);
                u += l, o += l * a
            });
            var f = Ft(t);
            f.properties[i] = o / u, a.push(f)
        }), f(a)
    }, e.pointOnSurface = mr,e.polygonToLineString = qr,e.lineStringToPolygon = Ur,e.inside = Ot,e.within = _t,e.bezier = fn,e.nearest = jn,e.pointOnLine = sr,e.lineDistance = xr,e.radians2degrees = b,e.degrees2radians = w,e.distanceToDegrees = g,e.distanceToRadians = m,e.radiansToDistance = v,e.bearingToAngle = y,e.convertDistance = E,e.toMercator = fr,e.toWgs84 = lr,e.randomPosition = gs,e.randomPoint = ys,e.randomPolygon = bs,e.randomLineString = ws,e.getCluster = Ss,e.clusterEach = xs,e.clusterReduce = Ts,e.createBins = Ns,e.applyFilter = Cs,e.propertiesContainsFilter = ks,e.filterProperties = Ls,e.earthRadius = Bo,e.factors = jo,e.unitsFactors = Fo,e.areaFactors = Io,e.feature = t,e.geometry = n,e.point = r,e.points = i,e.polygon = s,e.polygons = o,e.lineString = u,e.lineStrings = a,e.featureCollection = f,e.multiLineString = l,e.multiPoint = c,e.multiPolygon = h,e.geometryCollection = p,e.round = d,e.radiansToLength = v,e.lengthToRadians = m,e.lengthToDegrees = g,e.bearingToAzimuth = y,e.radiansToDegrees = b,e.degreesToRadians = w,e.convertLength = E,e.convertArea = S,e.isNumber = x,e.isObject = T,e.validateBBox = N,e.validateId = C,e.getCoord = z,e.getCoords = W,e.containsNumber = X,e.geojsonType = V,e.featureOf = $,e.collectionOf = J,e.getGeom = K,e.getGeomType = Q,e.getType = G,e.coordEach = k,e.coordReduce = L,e.propEach = A,e.propReduce = O,e.featureEach = M,e.featureReduce = _,e.coordAll = D,e.geomEach = P,e.geomReduce = H,e.flattenEach = B,e.flattenReduce = j,e.segmentEach = F,e.segmentReduce = I,e.lineEach = q,e.lineReduce = R,Object.defineProperty(e, "__esModule", {value: !0})
}), define("internal/GeometryHelper", ["jquery", "TELang", "turf.min"], function (e, t, n) {
    "use strict";

    function i(e, t, n) {
        return (e > t || e > n) && (e < t || e < n) || t === n && t === e
    }

    function u(e, t, n, r) {
        var i = Cesium.Cartesian2.subtract(n, e, o), u = t.x * r.y - t.y * r.x, a = u * u,
            f = Cesium.Cartesian2.magnitudeSquared(t), l = Cesium.Cartesian2.magnitudeSquared(r);
        if (a > s * f * l) {
            var c = (i.x * r.y - i.y * r.x) / u;
            return Cesium.Cartesian2.add(e, Cesium.Cartesian2.multiplyByScalar(t, c, o), o)
        }
        return undefined
    }

    function c(e, t, n) {
        var r = Cesium.Cartesian2.subtract(t, e, f), s = n.length;
        for (var o = 0; o < s; o++) {
            var a = n[o].position, c = n[Cesium.Math.mod(o + 1, s)].position;
            if (Cesium.Cartesian2.equals(e, a) || Cesium.Cartesian2.equals(t, c) || Cesium.Cartesian2.equals(e, c) || Cesium.Cartesian2.equals(t, a)) continue;
            var h = Cesium.Cartesian2.subtract(c, a, l), p = u(e, r, a, h);
            if (!Cesium.defined(p)) continue;
            if (Cesium.Cartesian2.equals(p, e) || Cesium.Cartesian2.equals(p, t) || Cesium.Cartesian2.equals(p, a) || Cesium.Cartesian2.equals(p, c)) continue;
            var d = p.x, v = p.y, m = i(d, e.x, t.x) && i(v, e.y, t.y) && i(d, a.x, c.x) && i(v, a.y, c.y);
            if (m) return !0
        }
        return !1
    }

    function p(e, t, n, r) {
        var i = Cesium.EllipsoidTangentPlane.fromPoints(t, e), s = i.projectPointsOntoPlane(t, h),
            o = Cesium.PolygonPipeline.computeWindingOrder2D(s);
        o === Cesium.WindingOrder.CLOCKWISE && (s.reverse(), t.reverse());
        var u = Cesium.PolygonPipeline.triangulate(s);
        u.length < 3 && (u = [0, 1, 2]);
        var a;
        if (!r) a = Cesium.PolygonPipeline.computeSubdivision(e, t, u, n); else {
            var f = t.length, l = new Array(f * 3), c = 0;
            for (var p = 0; p < f; p++) {
                var d = t[p];
                l[c++] = d.x, l[c++] = d.y, l[c++] = d.z
            }
            a = new Cesium.Geometry({
                attributes: {
                    position: new Cesium.GeometryAttribute({
                        componentDatatype: Cesium.ComponentDatatype.DOUBLE,
                        componentsPerAttribute: 3,
                        values: l
                    })
                }, indices: u, primitiveType: Cesium.PrimitiveType.TRIANGLES
            })
        }
        return new Cesium.GeometryInstance({geometry: a})
    }

    var r = function () {
        this._currentPlaneXAxis = null, this._currentPlaneYAxis = null
    };
    r.EARTH_RADIUS = 0, Cesium.defineProperties(r.prototype, {});
    var s = Cesium.Math.EPSILON14, o = new Cesium.Cartesian2, a = new Cesium.Cartesian2, f = new Cesium.Cartesian2,
        l = new Cesium.Cartesian2;
    r.init = function () {
        r.EARTH_RADIUS = viewer.scene.globe.ellipsoid.maximumRadius
    }, r.latLong2Meter = function (e) {
        var t = new Cesium.Cartographic(e.longitude * -Math.PI / 180, e.latitude * Math.PI / 180, e.height),
            n = r.EARTH_RADIUS + t.height, i = n * Math.cos(t.latitude),
            s = new Cesium.Cartographic(i * Math.sin(t.longitude), i * Math.cos(t.longitude), n * Math.sin(t.latitude));
        return s
    }, r.geoDist = function (e, t, n) {
        n == undefined && (n = !1);
        var i, s, o;
        o = e instanceof Cesium.Cartesian3 ? viewer.scene.globe.ellipsoid.cartesianToCartographic(e) : e;
        if (o instanceof Cesium.Cartographic) {
            i = new Cesium.Cartographic(Cesium.Math.toDegrees(o.longitude), Cesium.Math.toDegrees(o.latitude), o.height), o = t instanceof Cesium.Cartesian3 ? viewer.scene.globe.ellipsoid.cartesianToCartographic(t) : t;
            if (o instanceof Cesium.Cartographic) {
                s = new Cesium.Cartographic(Cesium.Math.toDegrees(o.longitude), Cesium.Math.toDegrees(o.latitude), o.height), n && (s.height = i.height);
                var u = i.height + r.EARTH_RADIUS, a = s.height + r.EARTH_RADIUS, f = r.latLong2Meter(i),
                    l = r.latLong2Meter(s),
                    c = (f.longitude - l.longitude) * (f.longitude - l.longitude) + (f.height - l.height) * (f.height - l.height) + (f.latitude - l.latitude) * (f.latitude - l.latitude);
                if (c < 5) return Math.sqrt(c);
                f.longitude /= u, f.latitude /= u, f.height /= u, l.longitude /= a, l.latitude /= a, l.height /= a;
                var h = Math.max(Math.min(f.longitude * l.longitude + f.height * l.height + f.latitude * l.latitude, 1), -1),
                    p = Math.acos(h), d = Math.abs(p) * (u + a) / 2;
                return c = Math.sqrt(d * d + (u - a) * (u - a)), c
            }
            return undefined
        }
        return undefined
    }, r.geoDist2D = function (e, t) {
        return r.geoDist(e, t, !0)
    }, r.geoDist3D = function (e, t) {
        return r.geoDist(e, t, !1)
    }, r.getPlaneFromPoints = function (e, t, n) {
        if (!Cesium.defined(e) || !Cesium.defined(e) || !Cesium.defined(n)) return null;
        if (e instanceof Cesium.Cartesian3 && t instanceof Cesium.Cartesian3 && n instanceof Cesium.Cartesian3) {
            var r = new Cesium.Cartesian3;
            Cesium.Cartesian3.subtract(e, t, r);
            var i = new Cesium.Cartesian3;
            Cesium.Cartesian3.subtract(t, n, i);
            var s = new Cesium.Cartesian3;
            Cesium.Cartesian3.normalize(Cesium.Cartesian3.cross(r, i, s), s);
            var o = Cesium.Plane.fromPointNormal(e, s);
            return o
        }
        return null
    }, r.getShortArcDirection = function (e, t) {
        e = Cesium.Math.toDegrees(e), t = Cesium.Math.toDegrees(t), t += 360, e += 360;
        var n = t - e;
        return Math.abs(n) > 180 && (n < 0 ? n = 360 + n : n = -(360 - n)), Cesium.Math.toRadians(n)
    };
    var h = [];
    return r.prepareVerticesBeforePlanarSurfaceCalc = function (e) {
    }, r.area3DPlanarPolygon = function (e, t) {
        var n = 0, r, i, s, o, u, a, f, l, c = e.length, h = t.normal;
        if (c < 3) return 0;
        var p = new Cesium.Cartesian3, d = new Cesium.Cartesian3;
        e[0].clone(p), e[1].clone(d), e.push(p), e.push(d), i = h.x > 0 ? h.x : -h.x, s = h.y > 0 ? h.y : -h.y, o = h.z > 0 ? h.z : -h.z, u = 3, i > s ? i > o && (u = 1) : s > o && (u = 2);
        for (a = 1, f = 2, l = 0; a < c; a++, f++, l++) switch (u) {
            case 1:
                n += e[a].y * (e[f].z - e[l].z);
                continue;
            case 2:
                n += e[a].z * (e[f].x - e[l].x);
                continue;
            case 3:
                n += e[a].x * (e[f].y - e[l].y);
                continue
        }
        switch (u) {
            case 1:
                n += e[c].y * (e[1].z - e[c - 1].z);
                break;
            case 2:
                n += e[c].z * (e[1].x - e[c - 1].x);
                break;
            case 3:
                n += e[c].x * (e[1].y - e[c - 1].y)
        }
        r = Math.sqrt(i * i + s * s + o * o);
        switch (u) {
            case 1:
                n *= r / (2 * h.x);
                break;
            case 2:
                n *= r / (2 * h.y);
                break;
            case 3:
                n *= r / (2 * h.z)
        }
        return Math.abs(n)
    }, r.calcArea2D = function (e) {
        if (e.length < 3) return 0;
        var t = Cesium.EllipsoidTangentPlane.fromPoints(e, Cesium.Ellipsoid.WGS84), n = t.projectPointsOntoPlane(e, h),
            r = Math.abs(Cesium.PolygonPipeline.computeArea2D(n));
        return r
    }, r.isSelfIntersectLine = function (e) {
        if (e.length < 3) return !1;
        var t = e.length, r = [];
        e.forEach(function (e) {
            var t = [], n = viewer.scene.globe.ellipsoid.cartesianToCartographic(e);
            t.push(Cesium.Math.toDegrees(n.longitude)), t.push(Cesium.Math.toDegrees(n.latitude)), r.push(t)
        });
        var i = n.lineString([r[t - 1], r[t - 2]]), s = r.slice(0, t - 1), o = n.lineString(s),
            u = n.lineIntersect(i, o);
        return u !== undefined && u.features !== undefined && u.features.length > 1 ? !0 : !1
    }, r.isSelfIntersect = function (e) {
        if (e.length < 3) return !1;
        var t = Cesium.EllipsoidTangentPlane.fromPoints(e, Cesium.Ellipsoid.WGS84), n = t.projectPointsOntoPlane(e, h),
            r = [];
        for (var i = 0; i < n.length; i++) r.push({position: n[i], index: i});
        for (var i = 0; i < r.length - 1; i++) {
            var s = c(r[i].position, r[i + 1].position, r);
            if (s) return !0
        }
        return !1
    }, r.getGeometrySubdevision = function (e) {
        if (e.length < 3) return 0;
        var t = Cesium.BoundingSphere.fromPoints(e), n = t.radius / 1e6,
            r = p(Cesium.Ellipsoid.WGS84, e, Cesium.Math.RADIANS_PER_DEGREE * n, !1);
        return r
    }, r.TriArea = function (e, t, n) {
        var r = new Cesium.Cartesian3;
        Cesium.Cartesian3.subtract(e, t, r);
        var i = new Cesium.Cartesian3;
        Cesium.Cartesian3.subtract(e, n, i);
        var s = new Cesium.Cartesian3;
        Cesium.Cartesian3.cross(r, i, s);
        var o = Cesium.Cartesian3.magnitude(s) / 2;
        return o
    }, r.getHeadingPitchRange = function (e, t) {
        if (e == undefined || t == undefined) return undefined;
        var n = e instanceof Cesium.Cartesian3 ? viewer.scene.globe.ellipsoid.cartesianToCartographic(e) : e,
            i = t instanceof Cesium.Cartesian3 ? viewer.scene.globe.ellipsoid.cartesianToCartographic(t) : t,
            s = new Cesium.EllipsoidGeodesic(n, i), o = 0;
        try {
            o = s.startHeading
        } catch (u) {
            o = 0
        }
        var a = r.geoDist3D(e, t),
            f = Cesium.Cartesian3.subtract(Cesium.Cartesian3.fromRadians(n.longitude, n.latitude, n.height), Cesium.Cartesian3.fromRadians(n.longitude, n.latitude, n.height - 100), new Cesium.Cartesian3),
            l = Cesium.Cartesian3.subtract(viewer.scene.globe.ellipsoid.cartographicToCartesian(i), viewer.scene.globe.ellipsoid.cartographicToCartesian(n), new Cesium.Cartesian3),
            c = Cesium.Cartesian3.dot(l, f), h = c / (Cesium.Cartesian3.magnitude(l) * Cesium.Cartesian3.magnitude(f)),
            p = Cesium.Math.toRadians(90) - Math.acos(h);
        return new Cesium.HeadingPitchRange(o, p, a)
    }, r
}), function (e, t) {
    typeof exports == "object" && typeof module != "undefined" ? t(exports) : typeof define == "function" && define.amd ? define("mgrs", ["exports"], t) : t(e.mgrs = e.mgrs || {})
}(this, function (e) {
    "use strict";

    function l(e, t) {
        return t = t || 5, y(v({lat: e[1], lon: e[0]}), t)
    }

    function c(e) {
        var t = m(S(e.toUpperCase()));
        return t.lat && t.lon ? [t.lon, t.lat, t.lon, t.lat] : [t.left, t.bottom, t.right, t.top]
    }

    function h(e) {
        var t = m(S(e.toUpperCase()));
        return t.lat && t.lon ? [t.lon, t.lat] : [(t.left + t.right) / 2, (t.top + t.bottom) / 2]
    }

    function p(e) {
        return e * (Math.PI / 180)
    }

    function d(e) {
        return 180 * (e / Math.PI)
    }

    function v(e) {
        var t = e.lat, n = e.lon, r = 6378137, i = .00669438, s = .9996, o, u, a, f, l, c, h, d = p(t), v = p(n), m, y;
        y = Math.floor((n + 180) / 6) + 1, n === 180 && (y = 60), t >= 56 && t < 64 && n >= 3 && n < 12 && (y = 32), t >= 72 && t < 84 && (n >= 0 && n < 9 ? y = 31 : n >= 9 && n < 21 ? y = 33 : n >= 21 && n < 33 ? y = 35 : n >= 33 && n < 42 && (y = 37)), o = (y - 1) * 6 - 180 + 3, m = p(o), u = i / (1 - i), a = r / Math.sqrt(1 - i * Math.sin(d) * Math.sin(d)), f = Math.tan(d) * Math.tan(d), l = u * Math.cos(d) * Math.cos(d), c = Math.cos(d) * (v - m), h = r * ((1 - i / 4 - 3 * i * i / 64 - 5 * i * i * i / 256) * d - (3 * i / 8 + 3 * i * i / 32 + 45 * i * i * i / 1024) * Math.sin(2 * d) + (15 * i * i / 256 + 45 * i * i * i / 1024) * Math.sin(4 * d) - 35 * i * i * i / 3072 * Math.sin(6 * d));
        var b = s * a * (c + (1 - f + l) * c * c * c / 6 + (5 - 18 * f + f * f + 72 * l - 58 * u) * c * c * c * c * c / 120) + 5e5,
            w = s * (h + a * Math.tan(d) * (c * c / 2 + (5 - f + 9 * l + 4 * l * l) * c * c * c * c / 24 + (61 - 58 * f + f * f + 600 * l - 330 * u) * c * c * c * c * c * c / 720));
        return t < 0 && (w += 1e7), {northing: Math.trunc(w), easting: Math.trunc(b), zoneNumber: y, zoneLetter: g(t)}
    }

    function m(e) {
        var t = e.northing, n = e.easting, r = e.zoneLetter, i = e.zoneNumber;
        if (i < 0 || i > 60) return null;
        var s = .9996, o = 6378137, u = .00669438, a, f = (1 - Math.sqrt(1 - u)) / (1 + Math.sqrt(1 - u)), l, c, h, p,
            v, g, y, b, w, E = n - 5e5, S = t;
        r < "N" && (S -= 1e7), y = (i - 1) * 6 - 180 + 3, a = u / (1 - u), g = S / s, b = g / (o * (1 - u / 4 - 3 * u * u / 64 - 5 * u * u * u / 256)), w = b + (3 * f / 2 - 27 * f * f * f / 32) * Math.sin(2 * b) + (21 * f * f / 16 - 55 * f * f * f * f / 32) * Math.sin(4 * b) + 151 * f * f * f / 96 * Math.sin(6 * b), l = o / Math.sqrt(1 - u * Math.sin(w) * Math.sin(w)), c = Math.tan(w) * Math.tan(w), h = a * Math.cos(w) * Math.cos(w), p = o * (1 - u) / Math.pow(1 - u * Math.sin(w) * Math.sin(w), 1.5), v = E / (l * s);
        var x = w - l * Math.tan(w) / p * (v * v / 2 - (5 + 3 * c + 10 * h - 4 * h * h - 9 * a) * v * v * v * v / 24 + (61 + 90 * c + 298 * h + 45 * c * c - 252 * a - 3 * h * h) * v * v * v * v * v * v / 720);
        x = d(x);
        var T = (v - (1 + 2 * c + h) * v * v * v / 6 + (5 - 2 * h + 28 * c - 3 * h * h + 8 * a + 24 * c * c) * v * v * v * v * v / 120) / Math.cos(w);
        T = y + d(T);
        var N;
        if (e.accuracy) {
            var C = m({
                northing: e.northing + e.accuracy,
                easting: e.easting + e.accuracy,
                zoneLetter: e.zoneLetter,
                zoneNumber: e.zoneNumber
            });
            N = {top: C.lat, right: C.lon, bottom: x, left: T}
        } else N = {lat: x, lon: T};
        return N
    }

    function g(e) {
        var t = "Z";
        return 84 >= e && e >= 72 ? t = "X" : 72 > e && e >= 64 ? t = "W" : 64 > e && e >= 56 ? t = "V" : 56 > e && e >= 48 ? t = "U" : 48 > e && e >= 40 ? t = "T" : 40 > e && e >= 32 ? t = "S" : 32 > e && e >= 24 ? t = "R" : 24 > e && e >= 16 ? t = "Q" : 16 > e && e >= 8 ? t = "P" : 8 > e && e >= 0 ? t = "N" : 0 > e && e >= -8 ? t = "M" : -8 > e && e >= -16 ? t = "L" : -16 > e && e >= -24 ? t = "K" : -24 > e && e >= -32 ? t = "J" : -32 > e && e >= -40 ? t = "H" : -40 > e && e >= -48 ? t = "G" : -48 > e && e >= -56 ? t = "F" : -56 > e && e >= -64 ? t = "E" : -64 > e && e >= -72 ? t = "D" : -72 > e && e >= -80 && (t = "C"), t
    }

    function y(e, t) {
        var n = "00000" + e.easting, r = "00000" + e.northing;
        return e.zoneNumber + e.zoneLetter + b(e.easting, e.northing, e.zoneNumber) + n.substr(n.length - 5, t) + r.substr(r.length - 5, t)
    }

    function b(e, t, n) {
        var r = w(n), i = Math.floor(e / 1e5), s = Math.floor(t / 1e5) % 20;
        return E(i, s, r)
    }

    function w(e) {
        var n = e % t;
        return n === 0 && (n = t), n
    }

    function E(e, t, f) {
        var l = f - 1, c = n.charCodeAt(l), h = r.charCodeAt(l), p = c + e - 1, d = h + t, v = !1;
        p > a && (p = p - a + i - 1, v = !0), (p === s || c < s && p > s || (p > s || c < s) && v) && p++;
        if (p === o || c < o && p > o || (p > o || c < o) && v) p++, p === s && p++;
        p > a && (p = p - a + i - 1), d > u ? (d = d - u + i - 1, v = !0) : v = !1, (d === s || h < s && d > s || (d > s || h < s) && v) && d++;
        if (d === o || h < o && d > o || (d > o || h < o) && v) d++, d === s && d++;
        d > u && (d = d - u + i - 1);
        var m = String.fromCharCode(p) + String.fromCharCode(d);
        return m
    }

    function S(e) {
        if (e && e.length === 0) throw"MGRSPoint coverting from nothing";
        var t = e.length, n = null, r = "", i, s = 0;
        while (!/[A-Z]/.test(i = e.charAt(s))) {
            if (s >= 2) throw"MGRSPoint bad conversion from: " + e;
            r += i, s++
        }
        var o = parseInt(r, 10);
        if (s === 0 || s + 3 > t) throw"MGRSPoint bad conversion from: " + e;
        var u = e.charAt(s++);
        if (u <= "A" || u === "B" || u === "Y" || u >= "Z" || u === "I" || u === "O") throw"MGRSPoint zone letter " + u + " not handled: " + e;
        n = e.substring(s, s += 2);
        var a = w(o), f = x(n.charAt(0), a), l = T(n.charAt(1), a);
        while (l < N(u)) l += 2e6;
        var c = t - s;
        if (c % 2 !== 0) throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters" + e;
        var h = c / 2, p = 0, d = 0, v, m, g, y, b;
        return h > 0 && (v = 1e5 / Math.pow(10, h), m = e.substring(s, s + h), p = parseFloat(m) * v, g = e.substring(s + h), d = parseFloat(g) * v), y = p + f, b = d + l, {
            easting: y,
            northing: b,
            zoneLetter: u,
            zoneNumber: o,
            accuracy: v
        }
    }

    function x(e, t) {
        var r = n.charCodeAt(t - 1), u = 1e5, f = !1;
        while (r !== e.charCodeAt(0)) {
            r++, r === s && r++, r === o && r++;
            if (r > a) {
                if (f) throw"Bad character: " + e;
                r = i, f = !0
            }
            u += 1e5
        }
        return u
    }

    function T(e, t) {
        if (e > "V") throw"MGRSPoint given invalid Northing " + e;
        var n = r.charCodeAt(t - 1), a = 0, f = !1;
        while (n !== e.charCodeAt(0)) {
            n++, n === s && n++, n === o && n++;
            if (n > u) {
                if (f) throw"Bad character: " + e;
                n = i, f = !0
            }
            a += 1e5
        }
        return a
    }

    function N(e) {
        var t;
        switch (e) {
            case"C":
                t = 11e5;
                break;
            case"D":
                t = 2e6;
                break;
            case"E":
                t = 28e5;
                break;
            case"F":
                t = 37e5;
                break;
            case"G":
                t = 46e5;
                break;
            case"H":
                t = 55e5;
                break;
            case"J":
                t = 64e5;
                break;
            case"K":
                t = 73e5;
                break;
            case"L":
                t = 82e5;
                break;
            case"M":
                t = 91e5;
                break;
            case"N":
                t = 0;
                break;
            case"P":
                t = 8e5;
                break;
            case"Q":
                t = 17e5;
                break;
            case"R":
                t = 26e5;
                break;
            case"S":
                t = 35e5;
                break;
            case"T":
                t = 44e5;
                break;
            case"U":
                t = 53e5;
                break;
            case"V":
                t = 62e5;
                break;
            case"W":
                t = 7e6;
                break;
            case"X":
                t = 79e5;
                break;
            default:
                t = -1
        }
        if (t >= 0) return t;
        throw"Invalid zone letter: " + e
    }

    var t = 6, n = "AJSAJS", r = "AFAFAF", i = 65, s = 73, o = 79, u = 86, a = 90,
        f = {forward: l, inverse: c, toPoint: h};
    e["default"] = f, e.forward = l, e.inverse = c, e.toPoint = h, Object.defineProperty(e, "__esModule", {value: !0})
}), define("internal/Settings", ["jquery", "TELang"], function (e, t) {
    "use strict";
    var n = "_TEW_Settings_", r = function () {
        e.extend(this, JSON.parse(localStorage.getItem(n)))
    };
    Cesium.defineProperties(r.prototype, {}), r.prototype.init = function () {
    }, r.prototype.saveSettings = function () {
        localStorage.setItem(n, JSON.stringify(this))
    };
    var i = new r;
    return i
}), define("internal/Units", ["jquery", "TELang", "./GeometryHelper", "mgrs", "./Settings"], function (e, t, n, r, i) {
    "use strict";

    function u() {
        var e = new Cesium.Cartographic(0, 0, 0), t = Cesium.sampleTerrain(viewer.terrainProvider, s, [e]);
        Cesium.when(t, function (e) {
            e[0].height != undefined && s <= 23 ? (s++, u()) : o = !0
        })
    }

    var s = 0, o = !1, a = function () {
        this.AltitudeUnit = Cesium.defaultValue(i.altitudeUnit, a.prototype.METERS)
    };
    return Cesium.defineProperties(a.prototype, {
        AltitudeUnit: {
            get: function () {
                return this._altitudeUnit
            }, set: function (e) {
                e = Number(e);
                if (e != a.prototype.METERS && e != a.prototype.FEET) return;
                this._altitudeUnit = e
            }
        }, EARTH_RADIUS: {
            get: function () {
                return n.EARTH_RADIUS
            }
        }, TerrainMaxLevel: {
            get: function () {
                return s
            }
        }
    }), a.prototype.METERS = 0, a.prototype.FEET = 1, a.prototype.meterToFeet = function (e) {
        return e * 3.280839895013
    }, a.prototype.feetToMeter = function (e) {
        return e * .3048
    }, a.prototype.init = function () {
        u()
    }, a.prototype.formatDistance = function (e, n, r) {
        return n == undefined && (n = !0), this.AltitudeUnit == a.prototype.METERS ? Math.abs(e) < 1e4 ? this.format(e, r ? t.i18n("meters_short") : t.i18n("meters")) : this.format(e / 1e3, t.i18n("km")) : (n && (e = this.meterToFeet(e)), Math.abs(e) < 5280 ? this.format(e, r ? t.i18n("feet_short") : t.i18n("feet")) : this.format(e / 5280, t.i18n("mile")))
    }, a.prototype.format = function (e, t) {
        return e.toFixed(2) + " " + t
    }, a.prototype.latLong2Meter = function (e) {
        return n.latLong2Meter(e)
    }, a.prototype.formatArea = function (e) {
        if (this.AltitudeUnit == a.prototype.METERS) {
            var n = t.i18n("meters");
            e > 1e5 && (e /= 1e6, n = t.i18n("km"))
        } else {
            var n = t.i18n("feet");
            e *= 10.764, e > 1e6 && (e /= 27878400, n = t.i18n("mile"))
        }
        return this.format(e, t.i18n("measure_square") + " " + n)
    }, a.prototype.formatVolume = function (e) {
        if (this.AltitudeUnit == a.prototype.METERS) {
            var n = t.i18n("meters");
            e > 1e8 && (e /= 1e9, n = t.i18n("km"))
        } else {
            var n = t.i18n("feet");
            e *= 35.314666721484606, e > 1e9 && (e *= 6.79357278e-12, n = t.i18n("mile"))
        }
        return this.format(e, t.i18n("measure_cubic") + " " + n)
    }, a.prototype.blockWidthToTeLayerLevel = function (e) {
        if (e <= 0 || isNaN(Number(e))) e = 9783e3;
        var t = 2 * Math.PI * this.EARTH_RADIUS / e, n = Math.log(t) / Math.log(2), n = n < 1e-6 ? 0 : parseInt(n),
            r = Math.max(0, n);
        return r
    }, a.prototype.MGRS2LL = function (e) {
        if (e == undefined) {
            console.log("MGRS string is missing!");
            return
        }
        var t = r.toPoint(e);
        return {longitude: t[0], latitude: t[1]}
    }, a.prototype.LL2MGRS = function (e, t) {
        if (e == undefined || t == undefined) {
            console.log("LL coordinates are missing!");
            return
        }
        var n = [e, t];
        return r.forward(n)
    }, a.prototype.TeLayerLevelToCesiumLayerLevel = function (e) {
        return Math.max(0, e - 2)
    }, a.prototype.blockWidthToCesiumLayerLevel = function (e) {
        return this.TeLayerLevelToCesiumLayerLevel(this.blockWidthToTeLayerLevel(e))
    }, new a
}), define("internal/TEPosition", ["jquery", "./Units"], function (e, t) {
    "use strict";
    var n = function (e) {
        this.cartesian = null, this.headingPitchRange = null, this.altitudeType = 3;
        if (e == undefined) this.cartesian = new Cesium.Cartesian3, this.headingPitchRange = new Cesium.HeadingPitchRange; else for (var t in e) this[t] = e[t]
    };
    return n.ATC_TERRAIN_RELATIVE = 0, n.ATC_ON_TERRAIN = 2, n.ATC_TERRAIN_ABSOLUTE = 3, n.ATC_3DML_RELATIVE = 4, Cesium.defineProperties(n.prototype, {
        Cartesian: {
            get: function () {
                return this.cartesian
            }, set: function (e) {
                this.cartesian = e
            }
        }, HeadingPitchRange: {
            get: function () {
                return this.headingPitchRange
            }, set: function (e) {
                this.headingPitchRange = e
            }
        }, AltitudeType: {
            get: function () {
                return this.altitudeType
            }, set: function (e) {
                if (e != n.ATC_TERRAIN_RELATIVE && e != n.ATC_ON_TERRAIN && e != n.ATC_TERRAIN_ABSOLUTE) return;
                this.altitudeType = Number(e)
            }
        }
    }), n.prototype.clone = function () {
        var e = new n;
        return e.cartesian = new Cesium.Cartesian3(this.cartesian.x, this.cartesian.y, this.cartesian.z), e.headingPitchRange = Cesium.HeadingPitchRange.clone(this.headingPitchRange), e.altitudeType = this.altitudeType, e
    }, n
}), define("tools/TETools/FavoritesStorage", ["jquery", "TELang", "internal/NotificationCenter", "internal/TEPosition"], function (e, t, n, r) {
    "use strict";

    function i() {
        return "_TEW_Favorites_"
    }

    var s = null, o = function (e) {
        this.id = Cesium.createGuid(), this.name = "", this.icon = "./img/star_red.png", this.desc = "", this.showOn3D = !0, this.tePosition = new r
    }, u = function () {
        this._favorites = null
    };
    return Cesium.defineProperties(u.prototype, {
        DefaultStorage: {
            get: function () {
                return s
            }
        }, Favorites: {
            get: function () {
                return this._favorites == null && this.loadFavoritesLayer(), this._favorites
            }
        }
    }), u.prototype.createFavoriteItem = function () {
        return new o
    }, u.prototype.getAll = function () {
        var e = [];
        for (var t = 0; t < this.Favorites.length; t++) {
            var n = this.Favorites.get(t);
            e.push(n.favoriteItem)
        }
        return e
    }, u.prototype.iconList = function () {
        return ["./img/star_red.png", "./img/star_green.png", "./img/star_purple.png", "./img/star_blue.png", "./img/star_yellow.png"]
    }, u.prototype.descriptionForIcon = function (e) {
        if (e == "") return;
        var n = e.split("/").pop();
        return n = n.substr(0, n.lastIndexOf(".")) || n, t.i18n("favorite_icon_" + n)
    }, u.prototype.loadFavoritesLayer = function () {
        this._favorites == null && (this._favorites = new Cesium.BillboardCollection, TerraExplorer.internal.favorites = viewer.scene.primitives.add(this._favorites));
        var e = JSON.parse(localStorage.getItem(i()));
        if (e == null) return;
        for (var t = 0; t < e.length; t++) e[t].tePosition = new r(e[t].tePosition), this.updateOrCreateFeatureFromFavoriteItem(e[t])
    }, u.prototype.saveItem = function (e) {
        this.updateOrCreateFeatureFromFavoriteItem(e), this.save(), n.postNotification("TEN_FAVORITE_CHANGED", this, e)
    }, u.prototype.save = function () {
        localStorage.setItem(i(), JSON.stringify(this.getAll()))
    }, u.prototype.deleteItem = function (e) {
        var t = this.getFeatureById(e);
        t != null && (this.Favorites.remove(t), this.save())
    }, u.prototype.getItem = function (e) {
        var t = this.getFeatureById(e);
        return t == null ? null : t.favoriteItem
    }, u.prototype.getFeatureById = function (e) {
        for (var t = 0; t < this.Favorites.length; t++) {
            var n = this.Favorites.get(t);
            if (n.id == e) return n
        }
        return null
    }, u.prototype.updateOrCreateFeatureFromFavoriteItem = function (e) {
        if (e == null) return;
        var t = this.getFeatureById(e.id);
        t == null && (t = this.Favorites.add({
            position: e.tePosition.Cartesian,
            image: e.icon,
            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
            scale: .5,
            id: e.id,
            eyeOffset: Cesium.DynamicEyeOffset()
        })), t.show = e.showOn3D, t.image = e.icon, t.favoriteItem = e
    }, s = new u, s
}), define("tools/ToolContainer", ["jquery", "TELang", "internal/NotificationCenter"], function (e, t, n) {
    "use strict";

    function i() {
        return 1
    }

    function s() {
        return 48
    }

    function o() {
        return (s() + 2 * i()) * 2 + 8 * i()
    }

    function u() {
        return o() - s() - 2 * 2 * i()
    }

    function a() {
        return 22.5 * i()
    }

    function f() {
        return 6.5 * s()
    }

    function l() {
        return 45683704
    }

    function c() {
        return 78830222
    }

    function h() {
        return 3
    }

    var r = null, p = function () {
        this.ToolContainerCloseReasonAnotherToolOpening = 1, this.ToolContainerCloseReasonCloseButton = 2, this.ToolContainerCloseReasonApi = 3, this._toolDelegate = null, this._onContainerCloseStarting = null, this._mainButton = null, this._upperViewHidden = !1, this._animating = !1, this._afterHideCallback = null, this._lowerViewStartX = 0, this._enabled = !0, this._toolManager = null, this._selectedButtons = {}, this._radioButtons = {}, this._checkButtons = {}, this.buttonType = {
            BUTTON: 0,
            RADIO_BUTTON: 2,
            CHECKBOX_BUTTON: 4,
            SEPARATOR: 5
        }
    };
    return Cesium.defineProperties(p.prototype, {
        MainButton: {
            get: function () {
                return this._mainButton
            }, set: function (t) {
                this._mainButton = t;
                var n = e("<div id='ContainerRootDiv' style='position:absolute; display:none; width:400px; height:200px; left:275px;bottom:0px; z-index:50;'></div>");
                e("#" + window.divId).append(n);
                var r = e("<div class='container' id='ContainerDiv' style='position:absolute;width:100%; height:100%;'></div>");
                n.append(r);
                var i = e('<div id="headerDivContainer" class="headerDivContainer" style="position:relative;top:0;height:30px;width:100%;background-color:#2b2b2b;"></div>');
                n.append(i);
                var s = e("<div id='UpperView' style='position:relative;top:15px; border-bottom:2px solid black; background-color: #141414;  opacity:1.0;'></div>");
                s.css({height: 50});
                var o = e("<div id='LowerView' style='position:relative;top:13px;background-color:#141414;opacity:1.0;width:100%;height:112px;word-wrap: break-word;'></div>"),
                    u = e("<div style='width:95%; background-color: rgba(0, 0, 0, .0); color:white; border:0px; padding:0px;'><p id='TextView' style='margin:5px; font-size:10pt; font-family: helvetica;'>100</p></div> ");
                r.append(s), r.append(o), o.append(u);
                var f = this.containerHideBounds();
                n.css({left: 300, bottom: 30, width: f.width, height: f.height}), r.css({
                    left: 0,
                    bottom: 0
                }).css("width", "calc(100% - " + (a() / 2 + h()) + "px)").css("height", "calc(100% - " + (a() / 2 + h()) + "px)")
            }
        }, RadioButtons: {
            set: function (t) {
                var n = this;
                e(t).each(function (e, t) {
                    n._radioButtons[t] = !0
                })
            }
        }, UpperViewHidden: {
            get: function () {
                return this._upperViewHidden
            }, set: function (t) {
                this._upperViewHidden = t;
                if (this._animating || e("#UpperView").is(":visible") == this.UpperViewHidden) return;
                this.UpperViewHidden ? e("#UpperView").hide() : e("#UpperView").show(), this.UpperViewHidden ? frame.size.height -= u() : frame.size.height += u()
            }
        }, IsVisible: {
            get: function () {
                return e("#ContainerRootDiv").is(":visible")
            }
        }, ToolManager: {
            get: function () {
                return this._toolManager
            }, set: function (e) {
                this._toolManager = e
            }
        }, BUTTON_SIZE: {
            get: function () {
                return 44
            }
        }, BUTTON_IMG_SIZE: {
            get: function () {
                return 32
            }
        }, BUTTON_IMG_PADDING: {
            get: function () {
                return (this.BUTTON_SIZE - this.BUTTON_IMG_SIZE) / 2
            }
        }, SLIDER_PADDING: {
            get: function () {
                return 10
            }
        }, SLIDER_WIDTH: {
            get: function () {
                return this.BUTTON_IMG_SIZE * 5
            }
        }, SLIDER_HEIGHT: {
            get: function () {
                return this.BUTTON_IMG_SIZE * 1.5
            }
        }
    }), p.prototype.getInstance = function () {
        return r
    }, p.prototype.canClose = function (e) {
        return this._toolDelegate == null ? !0 : this._toolDelegate.onBeforeCloseToolContainer != undefined && this._toolDelegate.onBeforeCloseToolContainer(e) == 0 ? !1 : !0
    }, p.prototype.selectButton = function (t, n) {
        var r = e("#" + t);
        if (r.length > 0) {
            if (n) {
                r.css("background-color", "rgb(0, 73, 117)"), this._selectedButtons[t] = !0;
                if (this._radioButtons[t] != undefined) {
                    var i = this;
                    e(Object.keys(this._selectedButtons)).each(function (e, n) {
                        i._radioButtons[n] != undefined && n != t && i.selectButton(n, !1)
                    })
                }
            } else r.css("background-color", "rgb(20, 20, 20)"), this._selectedButtons[t] = !1;
            this._checkButtons[t] != undefined && (this._checkButtons[t] = n)
        }
    }, p.prototype.showWithDelegate = function (t, n) {
        if (!this.canClose(this.ToolContainerCloseReasonAnotherToolOpening)) return !1;
        this.resetUI(), this._afterHideCallback != null ? this._afterHideCallback(!0) : this._toolDelegate != null && (this._toolDelegate.ToolContainer = null), this._afterHideCallback = null, this._toolDelegate = t, this._onContainerCloseStarting = n, this._toolDelegate.ToolContainer = this;
        var r = !0;
        return this._toolDelegate.onBeforeOpenToolContainer != undefined && (r = this._toolDelegate.onBeforeOpenToolContainer()), r ? this.show() : e("#ContainerRootDiv").is(":visible") && this.hideAndClearDelegate(), !0
    }, p.prototype.show = function () {
        function r(e) {
            var t = /^function\s+([\w\$]+)\s*\(/.exec(e.toString());
            return t ? t[1] : ""
        }

        var t = e("#sideBar").width();
        e("#ContainerRootDiv").css({opacity: 1}), e("#ContainerRootDiv").show(), e("#ContainerRootDiv").css({
            left: t + 30,
            bottom: "15"
        }), e("#ContainerRootDiv").width(f()), e("#ContainerRootDiv").height("200"), e(".headerDivContainer").css("background-color", "#2b2b2b"), e(".headerDivContainer").width(e("#UpperView").width()), e(".headerDivContainer").css("bottom", e("#ContainerDiv").height() + 30);
        var i = "";
        if (r(this._toolDelegate.constructor).indexOf("Tool") != -1) {
            var s = r(this._toolDelegate.constructor).indexOf("Tool");
            i = r(this._toolDelegate.constructor).substring(0, s)
        } else i = this._toolDelegate;
        e(".headerDivContainer").empty(), e(".headerDivContainer").append(e('<span class="toolHeaderContainer"></span>')), e(e(".toolHeaderContainer")[0]).text(i);
        var o = 200;
        this._toolDelegate.onOpenedToolContainer != undefined && this._toolDelegate.onOpenedToolContainer(), n.postNotification("TEN_TOOL_CONTAINER_VISIBILITY_CHANGED", this, !0);
        var u = e("<img id='CloseImg' width=12 height=12 src='img/close.png' style='cursor:pointer; float:right; margin-right:5px; margin-top:5px; opacity:1'/>");
        u.click(e.proxy(this.hideAndClearDelegateFromCloseButton, this)), e("#headerDivContainer").append(u)
    }, p.prototype.hide = function (t) {
        this.onContainerCloseStarting != undefined && (this.onContainerCloseStarting(), this.onContainerCloseStarting = undefined);
        var r = e("#" + this._mainButton.DivId);
        r.css({visibility: "visible"}), e("#" + l()).css({opacity: 0});
        var i = this.containerHideBounds(), s = 0;
        this._animating = !0, this._afterHideCallback = this.afterHideCallback, this._afterHideCallback != null && this._afterHideCallback(t), n.postNotification("TEN_TOOL_CONTAINER_VISIBILITY_CHANGED", this, !1)
    }, p.prototype.containerShowBounds = function () {
        var t = this._upperViewHidden ? o() - u() : o(), n = e("#" + this._mainButton.DivId), r = n.offset(), i = r.top,
            s = e(window).height() - i - n.outerHeight();
        return new Cesium.BoundingRectangle(r.left, s, f() + a() / 2, t + a() / 2 - h())
    }, p.prototype.containerHideBounds = function () {
        var t = this._upperViewHidden ? o() - u() : o(), n = e("#" + this._mainButton.DivId), r = n.offset(), i = r.top,
            s = i - n.outerHeight();
        return new Cesium.BoundingRectangle(280, 60, 350, 250)
    }, p.prototype.hideAndClearDelegateFromCloseButton = function () {
        if (!this._enabled) return;
        this.canClose(this.ToolContainerCloseReasonCloseButton) == 1 && this.hide(!0)
    }, p.prototype.hideAndClearDelegate = function () {
        return this._enabled ? this.canClose(this.ToolContainerCloseReasonApi) == 0 ? !1 : (this.hide(!0), !0) : !1
    }, p.prototype.afterHideCallback = function (t) {
        this._animating = !1, this._afterHideCallback = null, e("#ContainerRootDiv").hide();
        var n = this._toolDelegate;
        t && this._toolDelegate != null && (this._toolDelegate.ToolContainer = null, this._toolDelegate = null), n != null && n.onClosedToolContainer != undefined && n.onClosedToolContainer()
    }, p.prototype.addSlider = function (t, n, r, i) {
        var s = null;
        return t = Cesium.defaultValue(t, 0), n = Cesium.defaultValue(n, 100), r = Cesium.defaultValue(r, 1), i = Cesium.defaultValue(i, Math.floor(Math.abs(n - t) / 2)), this._lowerViewStartX += this.SLIDER_PADDING + 5, s = e("<input class='slider' id='sliderId' type='range' min=" + t + " max=" + n + " step=" + r + " value=" + i + " data-orientation='vertical'>"), s.css({
            "margin-left": this._lowerViewStartX,
            width: this.SLIDER_WIDTH,
            height: this.SLIDER_HEIGHT,
            "background-color": "#141414"
        }), this._lowerViewStartX += s.outerWidth() + 10, e("#UpperView").append(s), s
    }, p.prototype.getLowerViewStartX = function () {
        return this._lowerViewStartX
    }, p.prototype.addButton = function (t, n, r, i, s) {
        var o = null;
        if (t == 0) throw{type: "TE_EXCEPTION", format: "Tag for button in TEAToolContainer must be positive integer"};
        return s == undefined && (s = p.BUTTON), s == this.buttonType.SEPARATOR ? (o = e("<div class='containerButton separatoClass' style='position:absolute; padding-right: 10px;'></div>"), o.css({left: this._lowerViewStartX})) : r == undefined ? (o = e("<img class='containerButton' id='" + t.toString() + "'src='" + n + "' style='margin-top:0px; vertical-align:middle;'></img>"), o.on("mouseover", function () {
            e(this).css("background-color", "rgb(13, 194, 223)")
        }), o.on("mouseout", function () {
            var t = TerraExplorer.tools.ToolContainer;
            t._checkButtons[this.id] != 1 && t._radioButtons[this.id] != 1 || t._selectedButtons[this.id] != 1 ? e(this).css("background-color", "#141414") : e(this).css("background-color", "rgb(0, 73, 117)")
        }), o.css({
            left: this._lowerViewStartX,
            width: this.BUTTON_IMG_SIZE,
            height: this.BUTTON_IMG_SIZE,
            padding: this.BUTTON_IMG_PADDING
        })) : (o = e("<div class='containerButton' id='" + t.toString() + "'style='position:absolute; padding-right: 10px;'><table style='border-collapse: collapse!important; width:100%'><tr style='padding:0;'><td id='btnTD' style='padding:0;'><img src='" + n + "' style='margin-top:0px; vertical-align:middle; width:" + this.BUTTON_IMG_SIZE + "px; height:" + this.BUTTON_IMG_SIZE + "px; padding:" + this.BUTTON_IMG_PADDING + "px;'></img><span style='color:white; font-family: helvetica;'>" + r + "</span></td></tr></table></div>"), o.css({left: this._lowerViewStartX})), i != undefined && o.attr("title", i), e("#UpperView").append(o), this._lowerViewStartX += o.outerWidth(), o.click(t, e.proxy(this.handleButtonClick, this)), s == this.buttonType.RADIO_BUTTON ? this._radioButtons[t.toString()] = !0 : s == this.buttonType.CHECKBOX_BUTTON && (this._checkButtons[t.toString()] = !1), o
    }, p.prototype.updateButton = function (t, n, r) {
        var i = e("#UpperView #" + t);
        if (i.length == 0) return;
        i.attr("src", n), r != undefined && i.find("span").text(r)
    }, p.prototype.enableButton = function (t, n) {
        var r = e("#UpperView #" + t);
        if (r.length == 0) return;
        r.css({opacity: n ? "1.0" : "0.3"})
    }, p.prototype.addView = function (t) {
        t.css({right: this._lowerViewStartX}), e("#UpperView").append(t), this._lowerViewStartX += t.width()
    }, p.prototype.removeButtons = function () {
        e(".containerButton").remove(), e(".containerView").remove(), e(".slider").remove(), this._lowerViewStartX = 0
    }, p.prototype.resetUI = function () {
        this._upperViewHidden = !1, e("#TextView").text(""), this.removeButtons()
    }, p.prototype.setExplanationText = function (t) {
        e("#TextView").empty(), e("#TextView").addClass("explanation"), e("#TextView").append(t)
    }, p.prototype.handleButtonClick = function (t) {
        if (!this._enabled) return;
        var n = t.data;
        if (this._mainButton != null && n == l()) {
            var r = e("#" + this._mainButton.DivId);
            r.click()
        } else if (this._toolDelegate.onButtonClick != undefined) {
            var i = e("#UpperView #" + n);
            if (i.length == 0) return;
            if (i.css("opacity") == "0.3" || Number.parseFloat(i.css("opacity")).toFixed(1) == "0.3") return;
            this._checkButtons[n.toString()] != undefined && this.selectButton(n.toString(), this._checkButtons[n.toString()] != 1), this._radioButtons[n.toString()] != undefined && this.selectButton(n.toString(), !0), this._toolDelegate.onButtonClick(n)
        }
    }, p.prototype.setEnable = function (t, n) {
        var r = e("#ContainerRootDiv");
        if (r.is(":hidden") || this._animating) return;
        var i = e("#" + this._mainButton.DivId);
        this._enabled = t, t ? (r.prop("disabled", !1), r.css({opacity: "1"})) : (r.prop("disabled", !0), r.css({opacity: "0.3"}))
    }, p.prototype.getEnable = function () {
        return this._enabled
    }, p.prototype.getText = function () {
        return e("#TextView").text()
    }, p.prototype.setText = function (t) {
        e("#TextView").removeClass("explanation"), e("#TextView").empty(), e("#TextView").append(t)
    }, r = new p, r
}), define("internal/Globals", [], function () {
    "use strict";
    (function () {
        Function.prototype.inheritsFrom = function (e) {
            return e.constructor == Function ? (this.prototype = new e, this.prototype.constructor = this, this.prototype.parent = e.prototype) : (this.prototype = e, this.prototype.constructor = this, this.prototype.parent = e), this
        }
    })()
}), define("tools/ToolProtocol", ["jquery"], function (e) {
    var t = function () {
    };
    return t.prototype.getId = function () {
        throw{type: "TE_EXCEPTION", format: "getId() is an abstract method !"}
    }, t
}), define("tools/ToolDelegate", ["jquery", "TELang", "internal/Globals", "./ToolProtocol"], function (e, t, n, r) {
    "use strict";
    var i = function () {
        this._toolContainer = null, this._param = undefined, this._onBeforeCloseEvent = new Cesium.Event
    };
    return i.inheritsFrom(r), Cesium.defineProperties(i.prototype, {
        ToolContainer: {
            get: function () {
                return this._toolContainer
            }, set: function (e) {
                this._toolContainer = e
            }
        }, Param: {
            get: function () {
                return this._param
            }, set: function (e) {
                this._param = e
            }
        }
    }), i.prototype.onBeforeCloseToolContainer = function (e) {
        this._onBeforeCloseEvent.raiseEvent(e)
    }, i.prototype.onClosedToolContainer = function () {
    }, i.prototype.onBeforeOpenToolContainer = function () {
        return TerraExplorer.tools.SideBar.IsOccupyLargeScreenPortion && TerraExplorer.isTouch() && TerraExplorer.tools.SideBar.Hide(), !0
    }, i.prototype.onOpenedToolContainer = function () {
        return !0
    }, i.prototype.onButtonClick = function (e) {
    }, i.prototype.onTextClick = function () {
        return !0
    }, i.prototype.onSliderChanged = function (e) {
        return !0
    }, i
}), define("tools/MenuEntry", ["jquery", "TELang"], function (e, t) {
    "use strict";
    var n = function () {
        this._text = "", this._icon = "", this._toolId = "", this._param = null, this._parent = "", this._order = 0, this._group = "", this._isGlobalMode = !1, this._childEntries = new Array, this.addChildEntryOrdered = function (e) {
            var t = 0;
            while (t < this._childEntries.length && this._childEntries[t].Order < e.Order) t++;
            this._childEntries.splice(t, 0, e)
        }
    };
    return Cesium.defineProperties(n.prototype, {
        Text: {
            get: function () {
                return this._text
            }, set: function (e) {
                this._text = e
            }
        }, Icon: {
            get: function () {
                return this._icon
            }, set: function (e) {
                this._icon = e
            }
        }, ToolId: {
            get: function () {
                return this._toolId
            }, set: function (e) {
                this._toolId = e
            }
        }, Param: {
            get: function () {
                return this._param
            }, set: function (e) {
                this._param = e
            }
        }, Parent: {
            get: function () {
                return this._parent
            }, set: function (e) {
                this._parent = e
            }
        }, Order: {
            get: function () {
                return this._order
            }, set: function (e) {
                this._order = e
            }
        }, Group: {
            get: function () {
                return this._group
            }, set: function (e) {
                this._group = e
            }
        }, IsGlobalMode: {
            get: function () {
                return this._isGlobalMode
            }, set: function (e) {
                this._isGlobalMode = e
            }
        }, ChildEntries: {
            get: function () {
                return this._childEntries
            }
        }
    }), n.addToSidebar = function (e, t, r, i, s, o, u, a, f, l) {
        var c = new n;
        return c.ToolId = e.getId(), c.Text = t, c.Icon = r, c.Order = i, c.Parent = s, c.Group = o, c.IsGlobalMode = u, c.InContainer = a, c.SelectedImagePath = f, c.DisplayCheckButton = l, c.Parent == undefined && (c.Parent = ""), c
    }, n.MenuEntryAnalyze = function () {
        return t.i18n("Menu_Analyze") + "|./img/newDesign/bt_analyze.png|30"
    }, n.MenuEntryAnalysis = n.MenuEntryAnalyze, n.MenuEntryNavigation = function () {
        return t.i18n("Menu_Navigation") + "|./img/newDesign/bt_navigate.png|20"
    }, n.MenuEntryNavigate = n.MenuEntryNavigation, n.MenuEntryLayers = function () {
        return t.i18n("Menu_Layers") + "|./img/newDesign/bt_layers.png|40"
    }, n.MenuEntryLayer = n.MenuEntryLayers, n
}), define("internal/InputMode", ["jquery"], function (e) {
    "use strict";
    var t = function () {
        this._inputMode = 0
    };
    return t.prototype.FREE_FLIGHT = 0, t.prototype.CLIENT = 1, t.prototype.CONTROLLED_FLIGHT = 2, t.prototype.EDIT = 3, t.prototype.MEASUREMENT = 4, Cesium.defineProperties(t.prototype, {
        Mode: {
            get: function () {
                return this._inputMode
            }, set: function (e) {
                if (e < t.FREE_FLIGHT || e > t.MEASUREMENT) return;
                this._inputMode = e
            }
        }
    }), t.prototype.test = function () {
    }, new t
}), define("tools/TETools/ProgressTool", ["jquery", "TELang", "internal/Globals", "../ToolDelegate", "../ToolContainer"], function (e, t, n, r, i) {
    "use strict";

    function s() {
        return 100
    }

    var o = function () {
        this._cancelWork = !1, this._onBeforeCloseEvent = new Cesium.Event
    };
    return o.inheritsFrom(r), Cesium.defineProperties(o.prototype, {
        CancelWork: {
            get: function () {
                return this._cancelWork
            }, set: function (e) {
                this._cancelWork = e, e && this.onWorkCompletedHandler()
            }
        }
    }), o.prototype.onBeforeOpenToolContainer = function () {
        return TerraExplorer.tools.SideBar.IsOccupyLargeScreenPortion && TerraExplorer.isTouch() && TerraExplorer.tools.SideBar.Hide(), !0
    }, o.prototype.onBeforeCloseToolContainer = function (t) {
        return e("#checkImageSubHeader").length > 0 && e("#checkImageSubHeader").remove(), this.CancelWork = !0, this._onBeforeCloseEvent.raiseEvent(t), !0
    }, o.prototype.onButtonClick = function (e) {
        e == s() && (this.CancelWork = !0)
    }, o.prototype.showNormalButtons = function () {
    }, o.prototype.doWorkAsync = function () {
        this.showProgressButtons(), this.CancelWork = !1, this.doWork(e.proxy(this.onWorkCompletedHandler, this))
    }, o.prototype.onWorkCompletedHandler = function () {
        this.showNormalButtons(), this.workCompleted(), this.CancelWork = !1
    }, o.prototype.showProgressButtons = function () {
        this._toolContainer.removeButtons();
        var n = e("<div class='containerView' style='border-right: 1px solid rgba(255, 255, 255, .5);'><table style='border-collapse: collapse!important;'><tr style='padding:0;'><td style='padding:0; width:100px' ><img id='progressAnim' src='./img/progress.gif' style='margin-top:0px; vertical-align:middle'></img><span id='progressTxt' style='color:white; font-family: helvetica;'>0%</span></td></tr></table></div>");
        this._toolContainer.addView(n), this._toolContainer.addButton(s(), "./img/stop_calc.png", t.i18n("Cancel"))
    }, o.prototype.workCompleted = function () {
    }, o.prototype.setProgress = function (t, n) {
        var r = t / n * 100;
        e("#progressTxt").text(r.toFixed(0) + "%")
    }, o.prototype.CreateNew = function () {
    }, o
}), define("tools/ToolDialog", ["jquery", "TELang"], function (e, t) {
    "use strict";
    var n = null, r = function () {
        this._title = "", this._icon = null, this._isOpen = !1, this._mainButton = null, this._position = null, this._lastPositionX = null, this._lastPositionY = null, this._eventListener = null, this._rightAnalyzePosition = 30, this._topAnalyzePosition = 100, this._containsFrame = !1, this._isResizing = !1
    };
    Cesium.defineProperties(r.prototype, {
        Title: {
            get: function () {
                return this._title
            }, set: function (e) {
                this._title = e
            }
        }, Icon: {
            get: function () {
                return this._icon
            }, set: function (e) {
                this._icon = e
            }
        }, IsOpen: {
            get: function () {
                return this._isOpen
            }
        }, MainButton: {
            get: function () {
                return this._mainButton
            }, set: function (e) {
                this._mainButton = e
            }
        }, Position: {
            get: function () {
                return this._position
            }, set: function (e) {
                this._position = e
            }
        }, PositionX: {
            get: function () {
                return this._lastPositionX
            }, set: function (e) {
                this._lastPositionX = e
            }
        }, PositionY: {
            get: function () {
                return this._lastPositionY
            }, set: function (e) {
                this._lastPositionY = e
            }
        }, ContainsFrame: {
            get: function () {
                return this._containsFrame
            }, set: function (e) {
                this._containsFrame = e
            }
        }, IsResizing: {
            get: function () {
                return this._isResizing
            }, set: function (e) {
                this._isResizing = e
            }
        }
    }), r.prototype.onClose = function () {
    }, r.prototype.openModeless = function (e, t, n, r) {
        this.open(e, t, n, r, !0)
    }, r.prototype.addLeftButton = function (n, r, i) {
        if (r == undefined) return;
        var s = e('<button class="link" id="leftButton" type="button" style="position:relative;height:22px;left:20px; top:7px; background-color:#2B2B2B; border:0px; color:#FFFFFF;">' + t.i18n(n) + "</button>");
        i != undefined && s.on("click", i), r.append(s)
    }, r.prototype.closeLoadLayersDialogOnly = function () {
        setTimeout(function () {
            e("#menuIconLayersTool").length > 0 && e("#menuIconLayersTool").click()
        }, 2e3);
        if (e(".toolDialog #titleTextID").length > 0 && e(".toolDialog #titleTextID")[0].textContent == t.i18n("Menu_Load_Layers") && e(".toolDialog").find("#closeXID") != undefined) e(".toolDialog").find("#closeXID").click(); else {
            if (!(e(".toolDialog #titleTextID").length > 0 && e(".toolDialog #titleTextID")[0].textContent == t.i18n("Menu_Load_Layers"))) return;
            e(".toolDialog").find("#CloseButton").click()
        }
    }, r.prototype.openAsSideToolDialog = function (t, n, r, i, s) {
        this._title = t, this._icon = n;
        var o = 40,
            u = e("<div id='toolDialogTitleID' class='toolDialogTitle' style='height:" + o + "px;'><img id='iconImageID' src='" + this._icon + "'style='height:16px; padding-left:5px; padding-right:5px;'></img><span id='titleTextID' style='color:white;'>" + this._title + "</span></div>"),
            a = e(r), f = e("<div class='ToolDialogSidebar' id='ToolDialog' style='z-index: 1000;'></div> ");
        f.append(a);
        var l = TerraExplorer.tools.ToolDialog.width;
        f.width(l), i && f.css("margin-top", "250px"), s ? e(s).append(f) : e("#sidebarContentDiv").append(f)
    }, r.prototype.open = function (n, r, s, o, u, a, f, l) {
        f = Cesium.defaultValue(f, !0), this._containsFrame = !1, e(".toolDialog").length > 0 && e(".toolDialog").remove(), e("#ui-datepicker-div").length > 0 && e("#ui-datepicker-div").remove(), u == undefined && (u = !1), l && (this._lastPositionX = undefined, this._lastPositionY = undefined), this._title = n, this._icon = r;
        var c = 40, h = 40;
        this._lastResizingState = !1, this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.SetPosition, this), Cesium.ScreenSpaceEventType.LEFT_UP);
        var p = e("<div id='toolDialogTitleID' class='toolDialogTitle' style='height:" + c + "px;'><img id='iconImageID' src='" + this._icon + "'></img><span id='titleTextID' style='color:white;'>" + this._title + "</span></div>"),
            d = e(s),
            v = e("<img id='closeXID' class='link' src='./img/dialogs/header_icons/header_close_x.png'></img>"),
            m = e("<div class='toolDialog' id='ToolDialog'></div> "),
            g = e("<div class='ToolDialogModalBackground'></div>"), y = e("<div class='CloseButtonDiv'></div>"),
            b = e("<button class='link' id='CloseButton' type='button'>" + t.i18n("Button_close") + "</button>");
        b.appendTo(y);
        var w = e("<button class='link' id='DialogSaveButton' type='button' disabled='disabled'>" + t.i18n("Button_save") + "</button>");
        w.appendTo(y), m.append(p), m.append(v), m.append(d), m.append(y), d.hasClass("iframeContainerClass") ? m.addClass("iframeContainerClassToolDialog") : d.hasClass("toolResponsiveClass") ? m.addClass("toolResponsive") : m.css({
            width: d.outerWidth(),
            height: d.height() + c + h
        }), d.css({
            top: c,
            "background-color": "white"
        }), e("#" + window.divId).append(m), u == 0 && e("#" + window.divId).append(g), Cesium.defined(this._lastPositionX) && Cesium.defined(this._lastPositionY) ? window.navigator.userAgent.indexOf("Edge") > -1 && i == 1 ? (m.css({
            right: this._lastPositionX,
            top: this._lastPositionY
        }), Cesium.defined(this._lastPositionX) && m.css({position: this._position})) : (m.css({
            left: this._lastPositionX,
            top: this._lastPositionY
        }), Cesium.defined(this._lastPositionX) && m.css({position: this._position})) : a ? e("#ContainerRootDiv").length > 0 && e("#LowerView").append(d) : m.center(), m.drags({
            onlyElements: [p.get(0)].concat(p.find("*").get()),
            cursor: "default"
        }), f || m.resizable({handles: "n, ne, nw, e, s, se, sw, w"});
        var E = e.proxy(function () {
            o != undefined && o(), this._mainButton != null && this._mainButton.onToolDialogClosed(), m.remove(), g.remove(), this._isOpen = !1
        }, this), S = this, E = function (e) {
            o != undefined && o(e), S._mainButton != null && S._mainButton.onToolDialogClosed(), m.remove(), g.remove(), S._isOpen = !1
        };
        b.click(function () {
            E(!1)
        }), v.click(function () {
            E(!0)
        }), this._isOpen = !0
    };
    var i = !1;
    return r.prototype.removeCloseButton = function () {
        var t = e("#CloseButton");
        t.remove();
        return
    }, r.prototype.SetPosition = function () {
        this._lastPositionY = e(".toolDialog").css("top");
        var t = e(".toolDialog").css("left");
        window.navigator.userAgent.indexOf("Edge") > -1 ? t == "auto" ? (this._lastPositionX = e(".toolDialog").css("right"), i = !0) : (this._lastPositionX = t, i = !1) : this._lastPositionX = t
    }, r.prototype.showAlertDialog = function (n) {
        var r = e("<div class='toolDialogLabel' style='position:absolute; font-color:red; width:435px; height:50px; padding:10px;'>" + n + "</div>");
        this.open(t.i18n("Alert_Message"), "./img/exclamations.png", r.get(0)), e("#iconImageID").remove(), e("#toolDialogTitleID span").css("padding-left", "10px")
    }, r.prototype.close = function () {
        this._lastResizingState = !1;
        if (TerraExplorer.tools.ToolDialog._title == "Edit Feature Layer Style") return;
        e(".toolDialog").find("#closeXID") != undefined ? e(".toolDialog").find("#closeXID").click() : e(".toolDialog").find("#CloseButton").click()
    }, n = new r, n
}), define("tools/ListControl", ["../jquery", "../TELang"], function (e, t) {
    "use strict";
    var n = 0, r = 1, i = !1, s = function (t) {
        this._sideStyle = !0, this._currentLine = null, this._ListDiv = e("<div class='listControl'></div>"), t.append(this._ListDiv), this._isAnalyzeToolList = !1, this._globalLeftRightPadding = 0
    };
    Cesium.defineProperties(s.prototype, {
        LinePadding: {
            get: function () {
                return this.this._globalLeftRightPadding
            }, set: function (e) {
                this._globalLeftRightPadding = e
            }
        }, IsAnalyzeToolList: {
            get: function () {
                return this._isAnalyzeToolList
            }, set: function (e) {
                this._isAnalyzeToolList = e
            }
        }
    });
    var o, u, a = function (t) {
        var n = e(".selectedLine").attr("selectedOn");
        if (n == null) return;
        var r = new Date;
        if (n && r.valueOf() - n.valueOf() < 200) {
            e.lastButtonClicked = r;
            return
        }
        t.data.onClickHandler(t)
    }, f = 34;
    return s.prototype.add = function (n) {
        var r = this._ListDiv.find(".parentToolsClass").length > 0, i = 16, s = 55 + this._globalLeftRightPadding / 2,
            o = this._ListDiv.find(".listControlLineClass.toolClass").length, u = Math.floor(o / 3);
        o % 3 !== 0 && u++;
        var l = this._ListDiv.find(".listControlLineSidebar").length - u,
            c = this._ListDiv.find(".listControlLineTextHeaderSidebar").length,
            h = this._ListDiv.find(".thumbImgLocation").length, p = 1;
        n.header != undefined && n.queryDetailsWindow != undefined ? f = 34 : n.header != undefined && n.text != t.i18n("measure_terrain_profile_show_header") ? f = 68 : n.image != undefined ? f = 134 : this._isAnalyzeToolList ? n.header != undefined ? f = 34 : f = 17 : f = 34, n.queryDetailsWindow && (p = 1);
        var d = "";
        if (n.text.replace(/[ ]/g, "") == t.i18n("NavigationPlaces_Header") || n.group && n.group.replace(/[ ]/g, "") == t.i18n("NavigationPlaces_Header")) {
            d = "listControlContainerLocationsandPresentations";
            var v = "listControlItemClassLocationsandPresentations"
        } else {
            d = "listControlContainer" + (n.group ? n.group.replace(/[ ]/g, "") : n.text.replace(/[ ]/g, ""));
            var v = "listControlItemClass" + (n.group ? n.group.replace(/\s/g, "") : n.text.replace(/\s/g, ""))
        }
        var m = e("<div class='listControlLineSidebar' style='height:" + f + "px;'></div>");
        this._isAnalyzeToolList ? m.css({top: (l - c) * 17 + h * 100 + c * 68}) : n.objectSubHeader ? m.css({top: e(".parentToolsClass")[0].offsetTop + e(".parentToolsClass").height()}) : n.thinHeader != undefined ? m.css({top: (l - c) * 17 + h * 100 + c * 17}) : TerraExplorer.browser.isIE && n.group == t.i18n("TerrainAnalysis_Header") ? m.css({top: (l - c) * 40 + h * 100 + p * c * 45}) : TerraExplorer.browser.isIE && n.isSideBarObject ? m.css({top: (l - c) * 35 + h * 100 + p * c * 92}) : TerraExplorer.browser.isIE && !n.isSideBarObject ? m.css({top: (l - c) * 27 + h * 100 + p * c * 54}) : n.isSideBarObject ? TerraExplorer.isMobile() ? m.css({top: (l - c) * 40 + h * 100 + p * c * 45}) : m.css({top: (l - c) * 35 + h * 100 + p * c * 85}) : n.locationsSubHeader ? m.css({top: (l - c) * 40 + h * 100 + p * c * 40 + 40}) : m.css({top: (l - c) * 40 + h * 100 + p * c * 40});
        if (r && !n.objectSubHeader) {
            var g = m.css("top"), y = g !== undefined ? g.replace("px", "") : 0;
            y = Number(y), y += 220, m.css("top", y.toString() + "px")
        }
        n.header && n.text == t.i18n("menuEntry_displayName_Layers") && m.css({top: (l - c) * 17 + h * 100 + c * 132}), n.inContainer == 1 && (e("#" + d).length > 0 ? m = e("#" + d).first() : m.attr("id", d), TerraExplorer.browser.isIE && d == "listControlContainerModes" && m.css("top", "42px")), e(this._ListDiv).parent().css("height", "100%");
        var b = e("<div class='listControlLineClass'></div>");
        n.inContainer && (TerraExplorer.browser.isIE ? b.css("display", "inline-block").css("float", "").css("width", "46px").css("padding-right", "15px").css("padding-left", "15px") : b.css("display", "inline-block").css("float", "").css("width", "68px")), this._isAnalyzeToolList && b.css("display", "block"), n.isSideBarObject && b.css("z-index", "999"), m.append(b), this._ListDiv.append(m);
        if (n.blankSpace) {
            var g = e("#sidebarContentDiv")[0].getElementsByClassName("listControlLineSidebar")[e("#sidebarContentDiv")[0].getElementsByClassName("listControlLineSidebar").length - 1].previousElementSibling.style.top,
                y = g !== undefined ? g.replace("px", "") : 0;
            y = Number(y), y += 40, e("#sidebarContentDiv")[0].getElementsByClassName("listControlLineSidebar")[e("#sidebarContentDiv")[0].getElementsByClassName("listControlLineSidebar").length - 1].style.top = y.toString() + "px"
        }
        b[0].selectedImagePath = n.selectedImagePath, b[0].unSelectedImagePath = n.img, b[0].id = n.toolId ? n.toolId : d + "header", TerraExplorer.browser.isIE && (b[0].top = "-15px");
        var w = this._ListDiv.find(".listControlLineTextHeaderSidebar").length;
        n.line != undefined && this._ListDiv.append(m);
        var E = null, S = null;
        n.img != undefined && n.paddingLeft != undefined && (E = e("<img class='listControlImg' src='" + n.img + "'></img>"), b.append(E));
        var x = 0, T = null, N, C = /(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;
        if (n.text != undefined) if (this._isAnalyzeToolList) {
            var i = E != null ? E.outerWidth() : 0;
            N = n.text.search(C);
            if (N > 0) {
                T = e("<span class='listControlLineTextAnalyzeToolURL' style=''>" + n.text + "</span>");
                var k = T[0].children[1], L = k.href;
                k.href = "#", k.addEventListener("click", function () {
                    return window.open(L), !1
                })
            } else n.header != undefined ? T = e("<span class='listControlLineHeaderToolContainer' style=''>" + n.text + "</span>") : T = e("<span class='listControlLineTextAnalyzeTool' style='display:inherit;'>" + n.text + "</span>");
            x = m.width() - i, T.css({width: x});
            if (n.calculateProp && n.calculateProp.className) {
                var A = e("<a class='" + n.calculateProp.className + "' onClick=" + n.calculateProp.onClick + ">" + n.calculateProp.aText + "</a>");
                T.append(A)
            }
            n.queryToolContainer != undefined && T.css("margin-left", "7px"), b.append(T)
        } else {
            var i = E != null ? E.outerWidth() : 0;
            n.text.length > 29 && n.query == undefined && n.presentation == undefined && (n.text = n.text.slice(0, 29) + "  . . .");
            if (n.text.search(C) > 0) {
                T = e("<span id='listItemID' class='listControlLineTextAnalyzeToolURL' style='word-wrap: break-word;width:270px;'>" + n.text + "</span>");
                var k = T[0].children[1], L = k.href;
                k.href = "#", k.addEventListener("click", function () {
                    return window.open(L), !1
                })
            } else T = e("<span id='listItemID' class='listControlLineTextNormalSidebar'>" + n.text + "</span>");
            n.presentation != undefined && (T.css("color", "black"), m.css("width", "100%")), x = m.width() - i, n.disabled != undefined && (T = e("<span class='listControlLineTextNormal' style='color:gray;font-size:11px;'><span style='text-decoration:line-through;'>" + n.text + "</span><br/>" + t.i18n("Disabled_Layer") + "</span>")), n.header != undefined && n.header == 1 && (T.attr("class", "listControlLineTextHeaderSidebar"), n.subHeader != undefined && (T.attr("class", "listControlLineTextSubHeaderSidebar"), n.img != undefined && (E = e("<img class='imgClass' src='" + n.img + "'></img>"), T.prepend(E))), e(".menuEntry")[3].isLayersToolMenu == 1 && (this.isLayersToolMenu = !0), TerraExplorer.browser.isIE && (n.text == t.i18n("TerrainAnalysis_Header") || n.text == t.i18n("measure_terrain_profile_show_header") || n.text == t.i18n("NavigationModes_Header") || this.isLayersToolMenu) && T.css("top", "0")), n.header != undefined && this._ListDiv._isAnalyzeToolList == 1 && T.attr("class", "listControlLineHeaderToolContainer"), (n.group != t.i18n("Measurement_Header") || n.group != t.i18n("NavigationTools_Header")) && T.css({width: x - 10}), n.id && T.data("id", n.id), b.append(T)
        }
        var O = this;
        n.group == t.i18n("NavigationModes_Header") && n.toolId != "UndergroundTool" && b.addClass("modesClass");
        if (n.group == t.i18n("Measurement_Header") || n.group == t.i18n("NavigationTools_Header")) m.addClass("parentToolsClass"), T.addClass("toolSpanClass"), b.addClass("toolClass");
        n.group && n.group.toLowerCase() == t.i18n("NavigationPlaces_Header").toLowerCase() && (this._ListDiv.find("#listControlContainerLocationsandPresentationsheader").parent().css({top: e(".parentToolsClass")[0].offsetTop + 100}), this._ListDiv.find("#listControlContainerLocationsandPresentationsheader").parent().addClass("SubHaederDiv"), this._ListDiv.find("#listControlContainerLocationsandPresentationsheader span").addClass("SubHeaderSpanClass")), n.group == t.i18n("menuEntry_displayName_Layers") && (this._ListDiv.find("#" + d + "header").parent().addClass("SubHaederLayersDiv"), this._ListDiv.find("#" + d + "header span").addClass("SubHeaderSpanClass")), n.isVieshedObjects && (m.addClass("viewshedObjectsContainer"), m.css({top: (l + 3.5 - c) * 40 + h * 100 + p * c * 40}));
        var M = 0;
        if (n.buttons != undefined) {
            var _ = e("<div class='listControlLineButtonsSidebar' style='overflow:hidden; position:relative; white-space: nowrap; display: none'></div>");
            _.append(e("<span class='verticalAlignHelper'></span>"));
            for (var D = 0; D < n.buttons.length; D++) {
                var P;
                n.buttons[D].img === null ? P = e("<div style='vertical-align: middle; cursor: pointer;'></div>") : P = e("<img src='" + n.buttons[D].img + "' style='vertical-align: middle; cursor: pointer;'></img>"), P.css({
                    width: 18,
                    height: 18,
                    padding: 5
                }), P.click({index: l - w, onClickHandler: n.buttons[D].onClick}, a), _.append(P);
                var H = TerraExplorer.browser.isIE || TerraExplorer.browser.isFirefox || TerraExplorer.browser.isEdge ? 12 : 0;
                _.css({width: n.buttons.length * 33 + H})
            }
            M = _.width(), b.append(_)
        }
        var B = null;
        if (n.checkbox != undefined) {
            n.checkbox.isDialogToolCheckBox && (l += 10);
            var j = n.greyCheckbox ? "css-label-grey" : "css-label";
            n.isvcheck && (j = n.greyCheckbox ? "css-v-check-label-grey" : "css-v-check-label"), B = e("<div id='checkboxDiv' style='margin-left:" + -this._globalLeftRightPadding + "px; height:100%; width:" + s + "px; overflow:hidden'><input type='checkbox' class='css-checkbox' id='lineCheckbox" + l + "' style='' /><label class='" + j + "' style='margin: 11px 15px 15px 10px; ' for='lineCheckbox" + l + "'></label></div>"), n.disabled != undefined && B.css("opacity", "0"), b.append(B), B.mouseenter(function (e) {
                B.css("opacity") == 1 && (e.stopPropagation(), O._currentLine = null)
            }), n.checkbox.onClick && B.find("#lineCheckbox" + l).click(l - w, n.checkbox.onClick), n.checkbox.isChecked && B.find("#lineCheckbox" + l).prop("checked", n.checkbox.isChecked)
        }
        if (n.image != undefined) {
            S = e("<img class='thumbImgLocation' src='" + n.image + "' style='cursor:pointer;height:" + 100 + "px; width:" + 225 + "px; vertical-align: middle; padding-left:0px; padding-right:5px;'></img>");
            var F = e('<div style="z-index:1;margin-left:10px;"></div>');
            F.append(S), S.click(function (e) {
                n.onClick(e)
            }), b.after(F)
        }
        T.css({width: b.width() - (n.checkbox != undefined ? s : 0)});
        if (n.onClick != undefined) {
            E != null && (E.click(l - w, n.onClick), E.css({cursor: "pointer"}));
            var I = function (t) {
                if (n.buttons == undefined && n.header) return;
                if (t.target.nodeName == "LABEL" || t.target.nodeName == "INPUT") return;
                if (t.target.nodeName == "DIV" && t.target.id === "checkboxDiv") {
                    var r = e(t.target).find("input");
                    r.length > 0 && e(r[0]).click();
                    return
                }
                var i = null, s, o, u;
                e.each(e(".selectedLine"), function (t, n) {
                    e(n).find(".listControlLineButtonsSidebar").length > 0 && (i = e(n).find(".listControlLineButtonsSidebar").first(), i.css({display: "none"}));
                    var r = e(n).find("span").first();
                    o = e(n).find("#checkboxDiv"), u = o.length > 0 ? o.first().width() : 0, r.css({width: e(n).width() - u}), e(n).css({"background-color": ""}), e(n).removeClass("selectedLine"), e(n).removeAttr("selectedOn")
                }), n.buttons != undefined ? (i = b.find(".listControlLineButtonsSidebar").first(), s = i.length > 0 ? i.first().width() : 0, i.css({display: "block"}), i.children().each(function (t, n) {
                    e(n).css("display", "inline")
                })) : s = 0, o = b.find("#checkboxDiv"), u = o.length > 0 ? o.first().width() : 0, T.css({width: b.width() - s - u - 10}), n.image == undefined && (b.closest("div").css({"background-color": "rgba(0, 73, 116, 1.0)"}), b.closest("div").addClass("selectedLine"), e(".selectedLine").attr("selectedOn") == null && e(".selectedLine").attr("selectedOn", (new Date).valueOf()))
            };
            b != null && (b.dblclick(function (e) {
                window.getSelection ? window.getSelection().removeAllRanges() : document.selection && document.selection.empty()
            }), b.dblclick(l - w, n.onClick), b.click(I), n.image != undefined && S.click(I), b.css({cursor: "pointer"}), n.buttons == undefined && b.click(l - w, n.onClick))
        }
        n.header == undefined && !this._ListDiv._isAnalyzeToolList && n.isLayerControl && m.addClass("layerLine")
    }, s.prototype.removeAll = function () {
        this._ListDiv.empty()
    }, s.prototype.highlightLine = function (t) {
        var n = this._ListDiv.find(".listControlLineSidebar");
        t >= 0 && t < n.length && (n.css({"background-color": "rgba(255, 255, 255, 1.0)"}), e(n[t]).css({"background-color": "rgba(220, 220, 220, 1.0)"}))
    }, s.prototype.ensureLineVisible = function (e) {
        var t = this._ListDiv.find(".listControlLineSidebar");
        e >= 0 && e < t.length && this._ListDiv.parent().scrollTo(e * f)
    }, s
}), define("jquery.plugs", ["jquery"], function (e) {
    "use strict";
    e.fn.mousecapture = function (t) {
        var n = e(document);
        return this.each(function () {
            var r = e(this), i = {};
            r.mousedown(function (e) {
                var s;
                t.move && (s = function (e) {
                    t.move.call(r, e, i)
                }, n.mousemove(s));
                var o, u = function () {
                    t.move && n.unbind("mousemove", s), n.unbind("mouseup", o)
                };
                return t.up ? o = function (e) {
                    return u(), t.up.call(r, e, i)
                } : o = u, n.mouseup(o), t.down.call(r, e, i)
            })
        }), this
    }, e.cookie = function (e, t, n) {
        if (typeof t == "undefined") {
            t = null;
            if (document.cookie && document.cookie != "") {
                n = document.cookie.split(";");
                for (r = 0; r < n.length; r++) if (i = jQuery.trim(n[r]), i.substring(0, e.length + 1) == e + "=") {
                    t = decodeURIComponent(i.substring(e.length + 1));
                    break
                }
            }
            return t
        }
        n = n || {}, t === null && (t = "", n.expires = -1);
        var r = "";
        n.expires && (typeof n.expires == "number" || n.expires.toUTCString) && (typeof n.expires == "number" ? (r = new Date, r.setTime(r.getTime() + n.expires * 864e5)) : r = n.expires, r = "; expires=" + r.toUTCString());
        var i = n.path ? "; path=" + n.path : "", s = n.domain ? "; domain=" + n.domain : "",
            n = n.secure ? "; secure" : "";
        document.cookie = [e, "=", encodeURIComponent(t), r, i, s, n].join("")
    }, e.fn.rotate = function (t) {
        return e(this).css({
            "-webkit-transform": "rotate(" + t + "deg)",
            "-moz-transform": "rotate(" + t + "deg)",
            "-ms-transform": "rotate(" + t + "deg)",
            transform: "rotate(" + t + "deg)"
        }), e(this)
    }, e.fn.disableSelection = function () {
        return this.attr("unselectable", "on").css("user-select", "none").on("selectstart", !1)
    }, e.fn.center = function () {
        return this.css("position", "absolute"), this.css("top", Math.max(0, (e(window).height() - e(this).outerHeight()) / 2 + e(window).scrollTop()) + "px"), this.css("left", Math.max(0, (e(window).width() - e(this).outerWidth()) / 2 + e(window).scrollLeft()) + "px"), this
    }, e.fn.drags = function (t) {
        t = e.extend({handle: "", cursor: "move"}, t);
        if (t.handle === "") var n = this; else var n = this.find(t.handle);
        return n.css("cursor", t.cursor).on("mousedown", function (n) {
            var r = n || window.event, i = r.target || r.srcElement;
            if (t.onlyElements != undefined && t.onlyElements.indexOf(i) == -1) return;
            if (t.handle === "") var s = e(this).addClass("draggable"); else var s = e(this).addClass("active-handle").parent().addClass("draggable");
            var o = s.css("z-index"), u = s.outerHeight(), a = s.outerWidth(), f = s.offset().top + u - n.pageY,
                l = s.offset().left + a - n.pageX;
            s.css("z-index", 1e3).parents().on("mousemove", function (t) {
                e(".draggable").offset({top: t.pageY + f - u, left: t.pageX + l - a}).on("mouseup", function () {
                    e(this).removeClass("draggable").css("z-index", o)
                })
            }), n.preventDefault()
        }).on("mouseup", function () {
            t.handle === "" ? e(this).removeClass("draggable") : e(this).removeClass("active-handle").parent().removeClass("draggable")
        })
    }, e.fn.newguid = function () {
        return this.val("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (e) {
            var t = Math.random() * 16 | 0, n = e == "x" ? t : t & 3 | 8;
            return n.toString(16)
        })), this
    }, e.fn.hasScrollBar = function () {
        return this.get(0).scrollHeight > this.height()
    }, e.fn.scrollTo = function (t, n, r) {
        typeof n == "function" && arguments.length == 2 && (r = n, n = t);
        var i = e.extend({scrollTarget: t, offsetTop: 50, duration: 500, easing: "swing"}, n);
        return this.each(function () {
            var t = e(this), n = typeof i.scrollTarget == "number" ? i.scrollTarget : e(i.scrollTarget),
                s = typeof n == "number" ? n : n.offset().top + t.scrollTop() - parseInt(i.offsetTop);
            t.animate({scrollTop: s}, parseInt(i.duration), i.easing, function () {
                typeof r == "function" && r.call(this)
            })
        })
    }
}), define("internal/FlyAround", ["jquery", "./GeometryHelper"], function (e, t) {
    "use strict";
    var n = function (e, t, n, r) {
        this.onStopHandler = null, this._prevOnFrameTime = 0, this._firstFrameAfterStart = !1, this._POI = e.clone(), this._currentPos = new Cesium.Cartesian3, Cesium.Cartesian3.clone(t || viewer.camera.position, this._currentPos), this._angularSpeed = n || Cesium.Math.toRadians(30), this._stopAtYaw = r, viewer.camera.setView({
            destination: this._currentPos,
            orientation: {heading: viewer.camera.heading, pitch: viewer.camera.pitch, roll: 0}
        })
    };
    return n.prototype.move = function (e) {
        if (this._stopAtYaw != undefined) {
            var n = t.getShortArcDirection(viewer.camera.heading, this._stopAtYaw);
            if (this.IsSameAngularDirection(n, this._angularSpeed)) {
                viewer.camera.rotateAroundPoint(this._POI, this._POI, this._angularSpeed * e);
                var r = t.getShortArcDirection(viewer.camera.heading, this._stopAtYaw);
                if (!this.IsSameAngularDirection(n, r)) return viewer.camera.rotateAroundPoint(this._POI, this._POI, r), !1
            }
        } else viewer.camera.rotateAroundPoint(this._POI, this._POI, this._angularSpeed * e);
        return !0
    }, n.prototype.IsSameAngularDirection = function (e, t) {
        return e == t || e != 0 && t != 0 ? e < 0 && t < 0 || e > 0 && t > 0 : !1
    }, n.prototype.start = function (e) {
        this._firstFrameAfterStart = !0, this.onStopHandler = e, viewer.scene.preRender.addEventListener(this.onPreFrame, this)
    }, n.prototype.stop = function () {
        viewer.scene.preRender.removeEventListener(this.onPreFrame, this), this.onStopHandler != null && this.onStopHandler()
    }, n.prototype.onPreFrame = function (e, t) {
        var n = Cesium.JulianDate.secondsDifference(t, this._prevOnFrameTime);
        this._prevOnFrameTime = t, this.move(this._firstFrameAfterStart ? 0 : n) == 0 && this.stop(), this._firstFrameAfterStart = !1
    }, n
}), define("wfs/TileManager", [], function () {
    "use strict";

    function e() {
        this._quadtree = undefined, this._tilingScheme = new Cesium.GeographicTilingScheme, this._errorEvent = new Cesium.Event, this._loadTileEvent = new Cesium.Event, this._levelZeroMaximumError = Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid, 128, this._tilingScheme.getNumberOfXTilesAtLevel(0)), this._tileCache = [], this._primitivesWaitingToBeAddedToTheScene = [], this._pauseStreaming = !1, this._numTilesInLevel = [], this.STREAM_SPEED_IMIDIATE = 0, this.STREAM_SPEED_FAST = 1, this.STREAM_SPEED_NORMAL = 2, this.STREAM_SPEED_SLOW = 3, this._streamSpeed = this.STREAM_SPEED_NORMAL
    }

    function u(e) {
        var t = [], n = viewer.scene.primitives, r = n.length;
        for (var i = 0; i < r; ++i) {
            var s = n.get(i);
            s.ID != undefined && e == s.ID && (t[s.ID] == undefined && (t[s.ID] = 0), t[s.ID]++)
        }
        for (var o in t) {
            var u = t[o];
            if (u > 1) return console.log("TileManager.replaceInScene Warning: More than one primitive with same ID exist in the scene"), !0
        }
        return !1
    }

    function a(e, n) {
        $.each(e._primitives, function (e, r) {
            if (r instanceof Cesium.BillboardCollection) {
                var i = r, e = t.indexOf(i);
                return i._parentCollection._primitiveOld = n, e !== -1 ? (viewer.scene.primitives.remove(t[e]._parentCollection), t[e] = i) : t.push(i), !1
            }
        })
    }

    function f(e, t) {
        viewer.scene.primitives.remove(t), e._onDestroyTilePrimitive = function () {
            viewer.scene.primitives.remove(t), this._onDestroyTilePrimitive = undefined
        }
    }

    function l(e, t, n) {
        Cesium.when.all(e, function () {
            viewer.scene.primitives.remove(n)
        }), t._onDestroyTilePrimitive = function () {
            viewer.scene.primitives.remove(n), this._onDestroyTilePrimitive = undefined
        }
    }

    function c(e, t) {
        var n = $.map(e._primitives, function (e) {
            return e.readyPromise
        });
        l(n, e, t)
    }

    function h(e, t) {
        var n = $.map(e._primitives[0]._primitives, function (e) {
            return e.readyPromise
        });
        l(n, e, t)
    }

    function p(e, t) {
        viewer.scene.primitives.remove(t)
    }

    function d(e, t) {
        var n = [e.readyPromise];
        l(n, e, t)
    }

    Object.defineProperties(e.prototype, {
        quadtree: {
            get: function () {
                return this._quadtree
            }, set: function (e) {
                this._quadtree = e
            }
        }, ready: {
            get: function () {
                return !0
            }
        }, tilingScheme: {
            get: function () {
                return this._tilingScheme
            }
        }, errorEvent: {
            get: function () {
                return this._errorEvent
            }
        }, loadTileEvent: {
            get: function () {
                return this._loadTileEvent
            }
        }, pauseStreaming: {
            get: function () {
                return this._pauseStreaming
            }, set: function (e) {
                this._pauseStreaming = e
            }
        }, streamSpeed: {
            get: function () {
                return this._streamSpeed
            }, set: function (e) {
                this._streamSpeed = e
            }
        }, bestLevelAvailable: {
            get: function () {
                var e = 0;
                for (var t = 0; t < 22; t++) this._numTilesInLevel[t] != undefined && this._numTilesInLevel[t] > 0 && e < t && (e = t);
                return e
            }
        }
    }), e.prototype.streamSpeedFactor = function () {
        switch (this._streamSpeed) {
            case this.STREAM_SPEED_FAST:
                return 1;
            case this.STREAM_SPEED_NORMAL:
                return 3;
            case this.STREAM_SPEED_SLOW:
                return 20;
            default:
                return 3
        }
    };
    var t = [], n = 0;
    e.prototype.onPreFrame = function (e, r) {
        n++;
        if (this._pauseStreaming) return;
        if (this._streamSpeed == this.STREAM_SPEED_IMIDIATE) while (this._primitivesWaitingToBeAddedToTheScene.length > 0) {
            var i = this._primitivesWaitingToBeAddedToTheScene.pop();
            i.onTerrain ? viewer.scene.groundPrimitives.add(i) : e.primitives.add(i)
        } else if (this._primitivesWaitingToBeAddedToTheScene.length > 0 && n % this.streamSpeedFactor() == 0) {
            var i = this._primitivesWaitingToBeAddedToTheScene.pop();
            i._instanceIds && i._instanceIds.length > 100 && this.streamSpeed === this.STREAM_SPEED_FAST && (this.streamSpeed = this.STREAM_SPEED_NORMAL), i.onTerrain ? viewer.scene.groundPrimitives.add(i) : e.primitives.add(i)
        }
        $.each(t, function (e, t) {
            t.ready && viewer.scene.primitives.remove(t._parentCollection._primitiveOld)
        })
    };
    var r = !1;
    e.prototype.initialize = function (e) {
        r || (viewer.scene.preRender.addEventListener(this.onPreFrame, this), r = !0)
    }, e.prototype.update = function (e) {
        this.quadtree.beginFrame(e)
    }, e.prototype.endUpdate = function (e) {
        var t = this;
        e.afterRender.push(function () {
            t.quadtree.endFrame(e)
        })
    }, e.prototype.updateForPick = function (e) {
    }, e.prototype.getLevelMaximumGeometricError = function (e) {
        return this._levelZeroMaximumError / (1 << e) * this._quadtree.maximumScreenSpaceError
    };
    var i = 180 / Math.PI, s = 1 / i;
    e.prototype.placeHolder = function (e, t) {
        t = t || Cesium.Color.fromBytes(0, 255, 0, 255);
        var n = new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.RectangleOutlineGeometry({
                    rectangle: e.rectangle,
                    height: viewer.camera.positionCartographic.height - TerraExplorer.internal.Navigate.HeightAboveGround * .99
                }), attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(t)}
            }), appearance: new Cesium.PerInstanceColorAppearance({flat: !0})
        });
        e.data.primitive.add(n)
    }, e.prototype.loadTile = function (e, t) {
        var n = this;
        this._numTilesInLevel[t._level] == undefined && (this._numTilesInLevel[t._level] = 0), this._numTilesInLevel[t._level]++;
        if (t.state === Cesium.QuadtreeTileLoadState.START) {
            t.data = {
                primitive: new Cesium.PrimitiveCollection,
                wfsLayerData: [],
                id: Cesium.createGuid(),
                freeResources: function () {
                    n._tileCache[t.data.id] && n._numTilesInLevel[t._level]--, n._numTilesInLevel[t._level] < 0 && (n._numTilesInLevel[t._level] = 0);
                    if (Cesium.defined(this.wfsLayerData)) {
                        for (var e in this.wfsLayerData) Cesium.defined(this.wfsLayerData[e]) && this.wfsLayerData[e].freeResources();
                        this.wfsLayerData = undefined
                    }
                    Cesium.defined(this.primitive) && (this.primitive.destroy(), this.primitive = undefined), delete n._tileCache[t.data.id]
                }
            }, this._tileCache[t.data.id] = t;
            var r = 6371e3, s = Math.abs(r * (t.rectangle.south - t.rectangle.north));
            t.data.boundingSphere3D = Cesium.BoundingSphere.fromRectangle3D(t.rectangle), t.data.boundingSphere2D = Cesium.BoundingSphere.fromRectangle2D(t.rectangle, e.mapProjection);
            var o = [i * t.rectangle.west, i * t.rectangle.south, i * t.rectangle.east, i * t.rectangle.north];
            this.loadTileEvent.raiseEvent(t), t.state = Cesium.QuadtreeTileLoadState.DONE, t.renderable = !0
        }
    }, e.prototype.getTile = function (e) {
        return this._tileCache[e]
    }, e.prototype.getAllTiles = function () {
        var e = [];
        for (var t in this._tileCache) e.push(this._tileCache[t]);
        return e
    }, e.prototype.computeTileVisibility = function (e, t, n) {
        var r = this.computeDistanceToTile(e, t);
        e._distance = r;
        if (t.fog.enabled && e._level > 9 && Cesium.Math.fog(r, t.fog.density) >= 1) return Cesium.Visibility.NONE;
        var i;
        return t.mode === Cesium.SceneMode.SCENE3D ? e.boundingSphere3D ? i = e.boundingSphere3D : i = Cesium.BoundingSphere.fromRectangle3D(e.rectangle) : e.boundingSphere2D ? i = e.boundingSphere2D : i = Cesium.BoundingSphere.fromRectangle2D(e.rectangle, t.mapProjection), t.cullingVolume.computeVisibility(i)
    }, e.prototype.showTileThisFrame = function (e, t) {
        e.data !== undefined && e.data.primitive !== undefined && e.data.primitive.update(t)
    };
    var o = new Cesium.Cartesian3;
    e.prototype.computeDistanceToTile = function (e, t) {
        var n;
        t.mode === Cesium.SceneMode.SCENE3D ? e.boundingSphere3D ? n = e.boundingSphere3D : n = e.boundingSphere3D = Cesium.BoundingSphere.fromRectangle3D(e.rectangle) : e.boundingSphere2D ? n = e.boundingSphere2D : e.boundingSphere2D = n = Cesium.BoundingSphere.fromRectangle2D(e.rectangle, t.mapProjection);
        var r = Cesium.Cartesian3.subtract(n.center, t.camera.positionWC, o), i = Cesium.Cartesian3.magnitude(r);
        return Math.max(1, i - TerraExplorer.internal.Navigate.GroundHeightAtCameraPosition)
    }, e.prototype.isDestroyed = function () {
        return !1
    }, e.prototype.destroy = function () {
        return Cesium.destroyObject(this)
    }, e.prototype.getInstance = function (t) {
        if (Cesium.defined(t.TileManager) == 0) {
            t.TileManager = new e;
            var n = new Cesium.QuadtreePrimitive({tileProvider: t.TileManager, maximumScreenSpaceError: 2});
            t.scene.primitives.add(n)
        }
        return t.TileManager
    }, e.prototype.canRefine = function (e, t) {
        return !0
    }, e.prototype.addToScene = function (e) {
        this._primitivesWaitingToBeAddedToTheScene.push(e)
    }, e.prototype.removeFromScene = function (e) {
        var t = this._primitivesWaitingToBeAddedToTheScene.indexOf(e);
        t != -1 ? (this._primitivesWaitingToBeAddedToTheScene[t].destroy(), this._primitivesWaitingToBeAddedToTheScene.splice(t, 1)) : (viewer.scene.primitives.remove(e), viewer.scene.groundPrimitives.remove(e))
    }, e.prototype.replaceInScene = function (e, t) {
        var n = this._primitivesWaitingToBeAddedToTheScene.indexOf(e);
        if (n != -1) this._primitivesWaitingToBeAddedToTheScene[n] = t; else {
            e.ID != t.ID && console.log("TileManager.replaceInScene Warning: new primitive has a different ID than old primitive"), e._replacmentPrimitive != undefined && viewer.scene.primitives.remove(e._replacmentPrimitive), e._replacmentPrimitive = t, viewer.scene.primitives.add(t);
            var r = t.ID.split(":")[0];
            switch (r) {
                case"billboards":
                    a(t, e);
                    break;
                case"labels":
                    f(t, e);
                    break;
                case"polygons":
                    c(t, e);
                    break;
                case"models":
                    h(t, e);
                    break;
                case"polylines":
                    d(t, e);
                    break;
                case"points":
                    p(t, e);
                    break;
                default:
                    console.log("Error updating layer"), viewer.scene.primitives.remove(e)
            }
        }
    };
    var v = {billboards: a, labels: f, polygons: c, models: h, polylines: d, points: p};
    return e.prototype.replaceInSceneNew = function (e, t) {
        var n = this._primitivesWaitingToBeAddedToTheScene.indexOf(e);
        if (n != -1) this._primitivesWaitingToBeAddedToTheScene[n] = t; else {
            e.ID !== t.ID && console.log("TileManager.replaceInScene Warning: new primitive has a different ID than old primitive"), this.addToScene(t);
            var r = undefined, i = t.ID.split(":")[0], s = v[i];
            s ? s(t, e) : (console.log("Error updating layer"), viewer.scene.primitives.remove(e))
        }
    }, new e
}), define("wfs/GmlParser", [], function () {
    "use strict";

    function e(e, t, n, r) {
        this._extractAttributes = e, this._featureName = t || "featureMember", this._xy = r, this._gmlns = n || "http://www.opengis.net/gml", this._regExes = {
            trimSpace: /^\s*|\s*$/g,
            removeSpace: /\s*/g,
            splitSpace: /\s+/,
            trimComma: /\s*,\s*/g
        }
    }

    return Object.defineProperties(e.prototype, {
        featureName: {
            get: function () {
                return this._featureName
            }, set: function (e) {
                this._featureName = e
            }
        }, extractAttributes: {
            get: function () {
                return this._extractAttributes
            }, set: function (e) {
                this._extractAttributes = e
            }
        }, xy: {
            get: function () {
                return this._xy
            }
        }
    }), e.prototype.getElementsByTagNameNS = function (e, t, n) {
        var r = [];
        if (e.getElementsByTagNameNS) r = e.getElementsByTagNameNS(t, n); else {
            var i = e.getElementsByTagName("*"), s, o;
            for (var u = 0, a = i.length; u < a; ++u) s = i[u], o = s.prefix ? s.prefix + ":" + n : n, (n == "*" || o == s.nodeName) && (t == "*" || t == s.namespaceURI) && r.push(s)
        }
        return r
    }, e.prototype.read = function (e) {
        var t = this.getElementsByTagNameNS(e.documentElement, this._gmlns, this.featureName), n = [];
        for (var r = 0; r < t.length; r++) {
            var i = this.parseFeature(t[r]);
            i && n.push(i)
        }
        return n
    }, e.prototype.parseFeature = function (e) {
        var t = ["MultiPolygon", "Polygon", "MultiLineString", "LineString", "MultiPoint", "Point", "Envelope"], n, r,
            i, s;
        for (var o = 0; o < t.length; ++o) {
            n = t[o], r = this.getElementsByTagNameNS(e, this._gmlns, n);
            if (r.length > 0) {
                s = this.parseGeometry[n.toLowerCase()], s ? i = s.apply(this, [r[0]]) : console.log("unsupportedGeometryType:" + n);
                break
            }
        }
        var u, a = this.getElementsByTagNameNS(e, this._gmlns, "Box");
        for (o = 0; o < a.length; ++o) {
            var f = a[o], l = this.parseGeometry.box.apply(this, [f]), c = f.parentNode,
                h = c.localName || c.nodeName.split(":").pop();
            h === "boundedBy" ? u = l : i = l.toGeometry()
        }
        var p;
        this.extractAttributes && (p = this.parseAttributes(e));
        var d = {geometryType: n.toLowerCase(), positions: i, attributes: p};
        d.bounds = u;
        var v = e.firstChild, m;
        while (v) {
            if (v.nodeType == 1) {
                m = v.getAttribute("fid") || v.getAttribute("id");
                if (m) break
            }
            v = v.nextSibling
        }
        return d.fid = m, d
    }, e.prototype.parseGeometry = {
        point: function (e) {
            var t, n, r = [], t = this.getElementsByTagNameNS(e, this._gmlns, "pos");
            t.length > 0 && (n = t[0].firstChild.nodeValue, n = n.replace(this._regExes.trimSpace, ""), r = n.split(this._regExes.splitSpace)), r.length == 0 && (t = this.getElementsByTagNameNS(e, this._gmlns, "coordinates"), t.length > 0 && (n = t[0].firstChild.nodeValue, n = n.replace(this._regExes.removeSpace, ""), r = n.split(",")));
            if (r.length == 0) {
                t = this.getElementsByTagNameNS(e, this._gmlns, "coord");
                if (t.length > 0) {
                    var i = this.getElementsByTagNameNS(t[0], this._gmlns, "X"),
                        s = this.getElementsByTagNameNS(t[0], this._gmlns, "Y");
                    i.length > 0 && s.length > 0 && (r = [i[0].firstChild.nodeValue, s[0].firstChild.nodeValue])
                }
            }
            return r.length == 2 && (r[2] = null), this.xy ? [parseFloat(r[0]), parseFloat(r[1]), parseFloat(r[2])] : [parseFloat(r[1]), parseFloat(r[0]), parseFloat(r[2])]
        }, multipoint: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "Point"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.point.apply(this, [t[i]]), r && n.push(r)
            }
            return n
        }, linestring: function (e, t) {
            var n, r, i = [], s = [];
            n = this.getElementsByTagNameNS(e, this._gmlns, "posList");
            if (n.length > 0) {
                r = this.getChildValue(n[0]), r = r.replace(this._regExes.trimSpace, ""), i = r.split(this._regExes.splitSpace);
                var o = parseInt(n[0].getAttribute("dimension")), u, a, f, l;
                for (var c = 0; c < i.length / o; ++c) u = c * o, a = parseFloat(i[u]), f = parseFloat(i[u + 1]), l = o == 2 ? null : parseFloat(i[u + 2]), this.xy ? s.push(a, f, l) : s.push(f, a, l)
            }
            if (i.length == 0) {
                n = this.getElementsByTagNameNS(e, this._gmlns, "coordinates");
                if (n.length > 0) {
                    r = this.getChildValue(n[0]), r = r.replace(this._regExes.trimSpace, ""), r = r.replace(this._regExes.trimComma, ",");
                    var h = r.split(this._regExes.splitSpace);
                    for (var c = 0; c < h.length; ++c) i = h[c].split(","), i.length == 2 && (i[2] = null), this.xy ? s.push(parseFloat(i[0]), parseFloat(i[1]), parseFloat(i[2])) : s.push(parseFloat(i[1]), parseFloat(i[0]), parseFloat(i[2]))
                }
            }
            return s
        }, multilinestring: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "LineString"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.linestring.apply(this, [t[i]]), r && n.push(r)
            }
            return n
        }, polygon: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "LinearRing"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.linestring.apply(this, [t[i], !0]), r && n.push(r)
            }
            return n
        }, multipolygon: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "Polygon"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.polygon.apply(this, [t[i]]), r && n.push(r)
            }
            return n
        }, envelope: function (e) {
            var t = [], n, r, i = this.getElementsByTagNameNS(e, this._gmlns, "lowerCorner");
            if (i.length > 0) {
                var s = [];
                i.length > 0 && (n = i[0].firstChild.nodeValue, n = n.replace(this._regExes.trimSpace, ""), s = n.split(this._regExes.splitSpace)), s.length == 2 && (s[2] = null);
                if (this.xy) var o = new OpenLayers_Geometry_Point(s[0], s[1], s[2]); else var o = new OpenLayers_Geometry_Point(s[1], s[0], s[2])
            }
            var u = this.getElementsByTagNameNS(e, this._gmlns, "upperCorner");
            if (u.length > 0) {
                var s = [];
                u.length > 0 && (n = u[0].firstChild.nodeValue, n = n.replace(this._regExes.trimSpace, ""), s = n.split(this._regExes.splitSpace)), s.length == 2 && (s[2] = null);
                if (this.xy) var a = new OpenLayers_Geometry_Point(s[0], s[1], s[2]); else var a = new OpenLayers_Geometry_Point(s[1], s[0], s[2])
            }
            return o && a && (t.push([o.x, o.y, null]), t.push([a.x, o.y, null]), t.push([a.x, a.y, null]), t.push([o.x, a.y, null]), t.push([o.x, o.y, null]), r = new OpenLayers_Geometry_Polygon([[t]])), r
        }, box: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "coordinates"), n, r, i = null, s = null;
            t.length > 0 && (n = t[0].firstChild.nodeValue, r = n.split(" "), r.length == 2 && (i = r[0].split(","), s = r[1].split(",")));
            if (i !== null && s !== null) return [parseFloat(i[0]), parseFloat(i[1]), null, parseFloat(s[0]), parseFloat(s[1]), null]
        }
    }, e.prototype.parseAttributes = function (e) {
        var t = {}, n = e.firstChild, r, i, s, o, u, a, f;
        while (n) {
            if (n.nodeType == 1) {
                r = n.childNodes;
                for (i = 0; i < r.length; ++i) {
                    s = r[i];
                    if (s.nodeType == 1) {
                        o = s.childNodes;
                        if (o.length == 1) {
                            u = o[0];
                            if (u.nodeType == 3 || u.nodeType == 4) a = s.prefix ? s.nodeName.split(":")[1] : s.nodeName, f = u.nodeValue.replace(this._regExes.trimSpace, ""), t[a] = f
                        } else t[s.nodeName.split(":").pop()] = null
                    }
                }
                break
            }
            n = n.nextSibling
        }
        return t
    }, e.prototype.getChildValue = function (e, t) {
        var n = t || "";
        if (e) for (var r = e.firstChild; r; r = r.nextSibling) switch (r.nodeType) {
            case 3:
            case 4:
                n += r.nodeValue
        }
        return n
    }, e
}), define("wfs/EntityCreator", [], function () {
    "use strict";

    function clamp(e, t, n) {
        return e <= t ? t : e >= n ? n : e
    }

    function convertFontSizeToTEFontSize(e) {
        return e * 3 / 4
    }

    function getFontSizeInPixels(e) {
        var t = e * 72 / 96;
        return -1 * t
    }

    function polygonFeaturesToPositionsArray(e) {
        var t = [], n = e.length;
        for (var r = 0; r < n; r++) {
            var i = e[r], s = i.positions.length;
            for (var o = 0; o < s; o++) {
                var u = i.positions[o];
                for (var a = 0; a < u.length; a += 3) t.push(Cesium.Cartographic.fromDegrees(u[a + 0], u[a + 1], 0))
            }
        }
        return t
    }

    function _hashCodeAsync(e) {
        return hashCodeWorker.scheduleTask({str: e})
    }

    function _hashCode(e) {
        var t = 0, n, r;
        if (e.length === 0) return t;
        for (n = 0; n < e.length; n++) r = e.charCodeAt(n), t = (t << 5) - t + r, t |= 0;
        return t
    }

    function convertPolygonsRelativeHeightToAbsoluteHeightFromTerrainHeights(e, t, n, r) {
        var i, s = 0;
        for (var o = 0; o < e.length; o++) {
            var u = e[o];
            i = r ? onTerrainAltitudeOffset : n(u), u.absoluteHeightPositions == undefined && (u.absoluteHeightPositions = []);
            for (var a = 0; a < u.positions.length; a++) {
                var f = u.positions[a], l = u.absoluteHeightPositions[a] = [];
                for (var c = 2; c < f.length; c += 3) {
                    var h = r ? 0 : f[c];
                    t[s].height == undefined && (t[s].height = 0), l[c - 2] = f[c - 2], l[c - 1] = f[c - 1], l[c - 0] = f[c - 0], l[c] = h + t[s].height + i, s++
                }
            }
        }
    }

    function linestringFeaturesToPositionsArray(e) {
        var t = [];
        for (var n = 0; n < e.length; n++) for (var r = 0; r < e[n].positions.length; r += 3) t.push(Cesium.Cartographic.fromDegrees(e[n].positions[r + 0], e[n].positions[r + 1], 0));
        return t
    }

    function convertLinestringsRelativeHeightToAbsoluteHeightFromTerrainHeights(e, t, n, r) {
        var i, s = 0;
        for (var o = 0; o < e.length; o++) {
            i = r ? onTerrainAltitudeOffset : n(e[o]);
            for (var u = 2; u < e[o].positions.length; u += 3) {
                t[s].height == undefined && (t[s].height = 0), e[o].absoluteHeightPositions == undefined && (e[o].absoluteHeightPositions = []), e[o].absoluteHeightPositions[u - 2] = e[o].positions[u - 2], e[o].absoluteHeightPositions[u - 1] = e[o].positions[u - 1], e[o].absoluteHeightPositions[u - 0] = e[o].positions[u - 0];
                var a = r ? 0 : e[o].positions[u];
                e[o].absoluteHeightPositions[u] = a + t[s].height + i, s++
            }
        }
    }

    function EntityCreator(e) {
        this._style = e || {}, viewer.scene.onHoverShowTextArray = {}, viewer.scene._lastObjectShowOnText = null, this.updatingDistance = TerraExplorer.internal.Navigate.horizonCullingDistance / 4, this._primitivesWaitingForUpdatingHeight = [], this._pauseUpdatingHeight = !1, this.UPDATING_HEIGHT_SPEED_IMIDIATE = 0, this.UPDATING_HEIGHT_SPEED_FAST = 1, this.UPDATING_HEIGHT_SPEED_NORMAL = 2, this.UPDATING_HEIGHT_SPEED_SLOW = 3, this.updatingHeightSpeed = this.UPDATING_HEIGHT_SPEED_NORMAL, viewer.scene.preRender.addEventListener(this.onPreFrame, this), this.setEyeOffset = function (e, t) {
            t === undefined && (t = 0), e.eyeOffset = Cesium.DynamicEyeOffset(t)
        }
    }

    function addAltitudeOffsetToFeatureHeights(e, t) {
        var n = e.length;
        for (var r = 0; r < n; r++) {
            var i = t(e[r]);
            if (e[r].geometryType == "polygon" || e[r].geometryType == "multipolygon") {
                var s = e[r], o = s.positions.length;
                for (var u = 0; u < o; u++) {
                    var a = s.positions[u];
                    for (var f = 2; f < a.length; f += 3) a[f] += i;
                    s.positions[u] = a
                }
                e[r] = s
            } else {
                var l = e[r], c = l.positions.length;
                for (var u = 2; u < c; u += 3) l.positions[u] += i;
                e[r] = l
            }
        }
        return e
    }

    function canAddFeature(e, t) {
        if (e.isQuery == undefined) if (e.originalInstanceIds == undefined) {
            if (e.parentLayer.isExistRenderedFeatureId(t)) return !1
        } else if (e.originalInstanceIds.indexOf(t) == -1) return !1;
        return !0
    }

    function getAltitudeOffsetFunc(e) {
        return function (t) {
            var n = Number(e.applyConditionalClassification(e._style.altitudeOffset, t.attributes));
            return isNaN(n) && (n = 0), n
        }
    }

    function teColorToCesiumColor(e) {
        if (typeof e != "string") return e;
        var t = Number(e);
        if (!isNaN(t)) {
            var n = t.toString(16);
            if (n.length < 6 && n != undefined) {
                var r = n.length;
                while (r < 6) n = "0" + n, r++
            }
            var i = "#" + n, s = Cesium.Color.fromCssColorString(i);
            if (s != undefined) {
                var o = s.red;
                s.red = s.blue, s.blue = o
            }
            return s
        }
        return e
    }

    function colorFromClassification(e) {
        if (e == undefined) return undefined;
        var t = parseInt(e);
        if (e.alpha == undefined && !isNaN(t)) {
            t < 0 && (t &= 16777215);
            var n = t.toString(16);
            if (n.length < 6 && n != undefined) {
                var r = n.length;
                while (r < 6) n = "0" + n, r++
            }
            var i = "#" + n;
            i = i.substring(0, 7);
            var s = Cesium.Color.fromCssColorString(i);
            if (s != undefined) {
                var o = s.red;
                s.red = s.blue, s.blue = o
            }
            return s
        }
        return e
    }

    function tryGetValueAsFloat(e) {
        return isNaN(e) ? e : parseFloat(e)
    }

    function applyClassificationFunc(e, t) {
        var n = [];
        $.each(e.attributeNames, function (e, r) {
            n.push(tryGetValueAsFloat(t[r]))
        });
        var r;
        return n.length === 1 ? r = e.func(n[0]) : e.attributeNames.length === 2 ? r = e.func(n[0], n[1]) : e.attributeNames.length === 3 ? r = e.func(n[0], n[1], n[2]) : e.attributeNames.length === 4 && (r = e.func(n[0], n[1], n[2], n[3])), r
    }

    function getClassificationValue(e, t) {
        if (e === undefined || e.condition.length === 0) return undefined;
        if (e.func === undefined) return tryGetValueAsFloat(e.value);
        var n = undefined, r = applyClassificationFunc(e, t);
        return r === !0 && (n = tryGetValueAsFloat(e.value)), n
    }

    function naiveVBStoJS(e) {
        var t = replaceAll(e, " and ", " && ");
        return t = replaceAll(t, " AND ", " && "), t = replaceAll(t, " or ", " || "), t = replaceAll(t, " OR ", " || "), t = t.replace(/([^=!<>])=([^=!<>])/g, "$1==$2"), t = replaceAll(t, " <> ", " != "), t = replaceAll(t, "=<", "<="), t = replaceAll(t, "=>", ">="), t
    }

    function escapeRegExp(e) {
        return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1")
    }

    function replaceAll(e, t, n) {
        return e.replace(new RegExp(escapeRegExp(t), "g"), n)
    }

    var convertTileLevelDelta = 1, writeDebugInfoToConsole = !1,
        hashCodeWorker = new Cesium.TaskProcessor("createHashCodeFromStringWorker", Number.POSITIVE_INFINITY),
        pointFeaturesToPositionsArray = linestringFeaturesToPositionsArray,
        convertPointsRelativeHeightToAbsoluteHeightFromTerrainHeights = convertLinestringsRelativeHeightToAbsoluteHeightFromTerrainHeights,
        onTerrainAltitudeOffset = 1;
    Object.defineProperties(EntityCreator.prototype, {
        style: {
            get: function () {
                return this._style
            }, set: function (e) {
                this._style = e
            }
        }
    }), EntityCreator.prototype.clonePartOfMultiFeature = function (e, t) {
        return {positions: e.positions[t], attributes: e.attributes, fid: e.fid, geometryType: e.geometryType}
    }, EntityCreator.prototype.createPrimitiveFromWFSFeatures = function (e) {
        var t = new Cesium.PrimitiveCollection;
        try {
            var n = [], r = [], i = [];
            e.features.numPositions = 0;
            for (var s = 0; s < e.features.length; s++) {
                var o = e.features[s];
                this.sanitizePositions(o.positions), e.features.numPositions += o.positions.length;
                switch (o.geometryType) {
                    case"polygon":
                        n.push(o);
                        break;
                    case"multipolygon":
                        var u = o.positions.length;
                        for (var a = 0; a < u; a++) n.push(this.clonePartOfMultiFeature(o, a));
                        break;
                    case"linestring":
                        r.push(o);
                        break;
                    case"multilinestring":
                        var u = o.positions.length;
                        for (var a = 0; a < u; a++) r.push(this.clonePartOfMultiFeature(o, a));
                        break;
                    case"point":
                        i.push(o);
                        break;
                    case"multipoint":
                        var u = o.positions.length;
                        for (var a = 0; a < u; a++) i.push(this.clonePartOfMultiFeature(o, a))
                }
            }
            n.length > 0 ? (e.features = n, this.createPolygonPrimitive(e)) : r.length > 0 ? (e.features = r, this.createLinestringPrimitive(e)) : i.length > 0 && (e.features = i, this.createPointPrimitive(e))
        } catch (f) {
            console.log("Failed to create primitive from features: " + f)
        }
    }, EntityCreator.prototype.createPolygonPrimitive = function (e) {
        var t = this, n = !1, r = function (e) {
            var t = e[0].attributes.color.value, n = !0;
            for (var r = 1, i = e.length; r < i; r++) {
                var s = e[r].attributes.color.value;
                if (t[0] !== s[0] || t[1] !== s[1] || t[2] !== s[2] || t[3] !== s[3]) {
                    n = !1;
                    break
                }
            }
            return n
        }, i = function (e) {
            var n = "", i = [], s = [], o = [], u = [], a = [];
            for (var f = 0; f < e.features.length; f++) {
                var l = e.features[f];
                if (!canAddFeature(e, l.fid)) continue;
                var c = l.absoluteHeightPositions ? l.absoluteHeightPositions : l.positions,
                    h = t.createPolygonOptions(c, l.attributes), p = t.createCommonOptions(l.attributes);
                l.absoluteHeightPositions && delete l.absoluteHeightPositions, i.push(Cesium.BoundingSphere.fromPoints(h.hierarchy.positions));
                if (e.isQuery) continue;
                if (h.outline) if (e.onTerrain) {
                    var d = new Cesium.GeometryInstance({
                        geometry: new Cesium.GroundPolylineGeometry({
                            positions: h.hierarchy.positions,
                            width: h.outlineWidth,
                            id: l.fid
                        }), attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(h.outlineColor)}
                    });
                    o.push(d)
                } else {
                    var d = t.createPolygonGeometryHelper(Cesium.PolygonOutlineGeometry, l.fid, h.hierarchy, h.outlineColor, h.perPositionHeight, h.extrudedHeight);
                    o.push(d)
                }
                if (h.fill) {
                    var d = t.createPolygonGeometryHelper(Cesium.PolygonGeometry, l.fid, h.hierarchy, h.material, h.perPositionHeight, h.extrudedHeight);
                    s.push(d)
                }
                e.parentLayer.addRenderedFeatureId(l.fid), n += l.fid + ";", u.push(l.fid), a.push(p.tooltip)
            }
            if (e.isQuery) {
                e.onFinishedQuery(i);
                return
            }
            if (n == "") return;
            var v = new Cesium.PrimitiveCollection;
            if (e.onTerrain && o.length > 0) var m = new Cesium.PrimitiveCollection;
            var g = new Cesium.PerInstanceColorAppearance({flat: !0, translucent: h.material.alpha < 1}),
                y = new Cesium.PerInstanceColorAppearance({flat: !0, translucent: h.material.alpha < 1}),
                b = e.onTerrain ? Cesium.GroundPrimitive : Cesium.Primitive;
            if (e.onTerrain) {
                var c = h.hierarchy.positions, w = Cesium.Rectangle.fromCartesianArray(c),
                    E = $.grep(TerraExplorer.internal.Project.MeshLayers, function (e) {
                        return e.show && e.rootFloorRectangle !== undefined && Cesium.Rectangle.intersection(w, e.rootFloorRectangle) !== undefined
                    });
                if (E.length > 0) {
                    var S = Number.MAX_VALUE, x = Number.MIN_VALUE;
                    $(E).each(function (e, t) {
                        S = Math.min(t.delta, S), x = Math.min(t.delta, x)
                    })
                }
            }
            if (s.length > 0) if (e.onTerrain && !r(s)) s.forEach(function (e) {
                var t = new b({
                    geometryInstances: e,
                    appearance: g,
                    minDeltaToAdd: S,
                    maxDeltaToAdd: x,
                    classificationType: Cesium.ClassificationType.TERRAIN
                });
                t._parentCollection = v, t.groundClampingMethod = Cesium.defaultValue(h.groundClampingMethod, TerraExplorer.GroundClampingMethod.CLAMPS_TO_FLOOR), v.add(t)
            }); else {
                var T = new b({
                    geometryInstances: s,
                    appearance: g,
                    minDeltaToAdd: S,
                    maxDeltaToAdd: x,
                    classificationType: Cesium.ClassificationType.TERRAIN
                });
                T._parentCollection = v, T.groundClampingMethod = Cesium.defaultValue(h.groundClampingMethod, TerraExplorer.GroundClampingMethod.CLAMPS_TO_FLOOR), v.add(T)
            }
            if (o.length > 0) if (e.onTerrain) {
                var T = new Cesium.GroundPolylinePrimitive({
                    geometryInstances: o,
                    appearance: new Cesium.PolylineColorAppearance({isOnTerrainAppearance: !0})
                });
                T._parentCollection = m, m.add(T)
            } else {
                var T = new b({geometryInstances: o, appearance: g});
                T._parentCollection = v, v.add(T)
            }
            v.ID = "polygons:" + _hashCode(n), v._instanceIds = u, v._tooltips = a, v.onTerrain = e.onTerrain;
            if (m !== undefined) {
                m.ID = "polygons:" + _hashCode(n), m._instanceIds = u, m._tooltips = a, m.onTerrain = !0;
                if (v.length > 0 && v.onTerrain) {
                    var N = v.update, C = function (e) {
                        m.show = this.show, N.call(this, e)
                    };
                    v.update = C;
                    var k = v.destroy, L = function () {
                        viewer.scene.groundPrimitives.removeAndDestroy(m), k.call(this)
                    };
                    v.destroy = L
                }
                e.onFinishedCreatePrimitive(m, i)
            }
            e.onFinishedCreatePrimitive(v, i)
        }, s = this.style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_TERRAIN_ABSOLUTE;
        if (!s) {
            var o = t._style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_ON_TERRAIN ? !0 : !1;
            if (o) e.onTerrain = !0, i(e); else {
                n = !0;
                var u = polygonFeaturesToPositionsArray(e.features),
                    a = Cesium.sampleRenderedData(u, Cesium.SampleRenderedDataFlags.TERRAIN | Cesium.SampleRenderedDataFlags.FLOOR);
                Cesium.when(a, function (n) {
                    writeDebugInfoToConsole && console.log("adding  polygon with " + n.length + " vertices"), convertPolygonsRelativeHeightToAbsoluteHeightFromTerrainHeights(e.features, n, getAltitudeOffsetFunc(t), o), i(e)
                })
            }
        } else e.features = addAltitudeOffsetToFeatureHeights(e.features, getAltitudeOffsetFunc(t)), i(e)
    }, EntityCreator.prototype.createPolygonGeometryHelper = function (e, t, n, r, i, s) {
        var o = s != undefined ? Cesium.PerInstanceColorAppearance.VERTEX_FORMAT : Cesium.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,
            u = new e({polygonHierarchy: n, vertexFormat: o, perPositionHeight: i, extrudedHeight: s}),
            a = new Cesium.GeometryInstance({
                geometry: u,
                id: t,
                attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(r)}
            });
        return a
    }, EntityCreator.prototype.createLinestringPrimitive = function (e) {
        var t = this, n = !1, r = viewer.scene.globe.ellipsoid, i = function (e) {
            var n = "", r = [], i, s = [], o = [], u = [];
            for (var a = 0; a < e.features.length; a++) {
                var f = e.features[a];
                if (!canAddFeature(e, f.fid)) continue;
                var l = f.absoluteHeightPositions ? f.absoluteHeightPositions : f.positions,
                    c = t.createLinestringOptions(l, f.attributes), h = t.createCommonOptions(f.attributes);
                TerraExplorer.USE_CORRIDOR_FOR_LINE_WIDTH_IN_METERS && i == undefined && (i = c.widthInMeters && t.style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_ON_TERRAIN ? !0 : !1), c.vertexFormat = i ? Cesium.PerInstanceColorAppearance.VERTEX_FORMAT : Cesium.PolylineColorAppearance.VERTEX_FORMAT, f.absoluteHeightPositions && delete f.absoluteHeightPositions, r.push(Cesium.BoundingSphere.fromPoints(c.positions));
                if (e.isQuery) continue;
                var p;
                if (i) c.height = l.reduce(function (e, t, n, r) {
                    return (n + 1) % 3 == 0 ? e + t / (r.length / 3) : e
                }, 0), c.cornerType = Cesium.CornerType.MITERED, c.granularity = Cesium.Math.RADIANS_PER_DEGREE, p = new Cesium.CorridorGeometry(c); else if (e.onTerrain) {
                    e.onModel && (TerraExplorer.onModelLargeRange = !0);
                    var d = TerraExplorer.internal.Engine.getMinMaxHeightPolylineGeom(c.positions), v = {
                        minHeightOnB3dm: d.minHeightOnB3dm,
                        maxHeightOnB3dm: d.maxHeightOnB3dm,
                        positions: c.positions,
                        width: c.width,
                        vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT
                    };
                    p = new Cesium.GroundPolylineGeometry(v)
                } else p = new Cesium.PolylineGeometry(c);
                var m = i ? TerraExplorer.USE_CORRIDOR_FOR_LINE_WIDTH_IN_METERS > 1 ? undefined : new Cesium.ZBiasGeometryInstanceAttribute(.1) : Cesium.ZBiasGeometryInstanceAttribute.defaultBias(),
                    g = new Cesium.GeometryInstance({
                        geometry: p,
                        id: f.fid,
                        attributes: {
                            color: Cesium.ColorGeometryInstanceAttribute.fromColor(c.material),
                            zbias: e.onTerrain ? undefined : m
                        }
                    });
                u.push(g), e.parentLayer.addRenderedFeatureId(f.fid), n += f.fid + ";", s.push(f.fid), o.push(h.tooltip)
            }
            if (e.isQuery) {
                e.onFinishedQuery(r);
                return
            }
            if (n == "") return;
            var y = e.onTerrain ? Cesium.PolylineColorAppearance : i ? Cesium.PerInstanceColorAppearance : Cesium.PolylineColorAppearance,
                b = e.onTerrain ? Cesium.GroundPolylinePrimitive : i ? TerraExplorer.USE_CORRIDOR_FOR_LINE_WIDTH_IN_METERS > 1 ? Cesium.GroundPrimitive : Cesium.Primitive : Cesium.Primitive,
                w = new b({
                    geometryInstances: u,
                    groundClampingMethod: c.groundClampingMethod,
                    appearance: new y({
                        translucent: c.material.alpha < 1,
                        closed: !1,
                        isOnTerrainAppearance: e.onTerrain ? !0 : undefined
                    }),
                    asynchronous: !0
                });
            Cesium.when(_hashCodeAsync(n), function (t) {
                w.ID = "polylines:" + t;
                var n = TerraExplorer.internal.Engine, i = c.positions.length;
                if (e.onTerrain && n.isOnMeshLayer(c.positions[0]) || n.isOnMeshLayer(c.positions[i - 1])) w.isOnMeshLayer = !0;
                c.minVisibilityDistance !== undefined && c.maxVisibilityDistance !== undefined && (w.minViewingDistance = c.minVisibilityDistance, w.maxViewingDistance = c.maxVisibilityDistance), w._instanceIds !== undefined && w._instanceIds.length === 0 && (w._instanceIds = s), w._tooltips = o, e.onFinishedCreatePrimitive(w, r)
            }).otherwise(function (e) {
                console.log(e)
            })
        }, s = this.style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_TERRAIN_ABSOLUTE;
        if (!s) {
            var o = t._style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_ON_TERRAIN ? !0 : !1;
            if (o) e.onTerrain = !0, e.onModel = t._style.polyline.groundClampingMethod === TerraExplorer.GroundClampingMethod.CLAMPS_TO_MODEL, i(e); else {
                n = !0;
                var u = linestringFeaturesToPositionsArray(e.features),
                    a = Cesium.sampleRenderedData(u, Cesium.SampleRenderedDataFlags.TERRAIN | Cesium.SampleRenderedDataFlags.FLOOR);
                Cesium.when(a, function (n) {
                    writeDebugInfoToConsole && console.log("adding  linestring with " + n.length + " vertices");
                    var r = t._style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_ON_TERRAIN ? !0 : !1;
                    convertLinestringsRelativeHeightToAbsoluteHeightFromTerrainHeights(e.features, n, getAltitudeOffsetFunc(t), r), i(e)
                })
            }
        } else e.features = addAltitudeOffsetToFeatureHeights(e.features, getAltitudeOffsetFunc(t)), i(e)
    }, EntityCreator.prototype.createPointPrimitive = function (e) {
        var t = this, n = viewer.scene.globe, r = function () {
            var e = this;
            i(this.position) && (this.updatePositionPromise = Cesium.sampleRenderedData([n.ellipsoid.cartesianToCartographic(this.position.clone())]), Cesium.when(e.updatePositionPromise, function (t) {
                var n = t[0].height + e.altitudeOffsetValue;
                e.position = Cesium.Cartesian3.fromRadians(t[0].longitude, t[0].latitude, n)
            }))
        }, i = function (e) {
            if (n._surface._debug.maxDepth < 9) return !1;
            var r = Cesium.Cartesian3.distance(viewer.camera.position, e);
            return r > t.updatingDistance ? !1 : !0
        }, s = function (e) {
            var n = "", i = [], s = [], o = [], u, a = new Cesium.LabelCollection;
            a.updatePositions = function () {
                this._labels.forEach(function (e) {
                    t._primitivesWaitingForUpdatingHeight.push(e)
                })
            };
            var f = new Cesium.PointPrimitiveCollection, l = new Cesium.BillboardCollection;
            l.updatePositions = function () {
                this._billboards.forEach(function (e) {
                    t._primitivesWaitingForUpdatingHeight.push(e)
                })
            };
            var c = new Cesium.PrimitiveCollection, h = new Cesium.PolylineCollection;
            for (var p = 0; p < e.features.length; p++) {
                var d = e.features[p];
                if (!canAddFeature(e, d.fid)) continue;
                var v = d.absoluteHeightPositions ? d.absoluteHeightPositions : d.positions,
                    m = t.createPointOptions(v, d.attributes), g = t.createCommonOptions(d.attributes);
                d.absoluteHeightPositions && delete d.absoluteHeightPositions, s.push(Cesium.BoundingSphere.fromPoints([m.position]));
                if (e.isQuery) continue;
                if (m.label) {
                    m.label.position = m.position, e.isRelative && (m.label.updatePosition = r, m.label.altitudeOffsetValue = Cesium.defaultValue(e.altitudeOffsetFunc(d), 0)), m.label.id = d.fid, t.setEyeOffset(m.label), m.label.imageFile != undefined && (m.label.image = t.applyConditionalClassification(m.label.imageFile, d.attributes), m.label.label = m.label, l.add(m.label), t.setEyeOffset(m.label, -5)), m.label.imageFile != undefined && m.label.showText != undefined && m.label.showText && (viewer.scene.onHoverShowTextArray[m.label.id] = !0);
                    if (m.label.isBold != undefined && m.label.isBold) {
                        m.label.image != undefined && delete m.label.image;
                        var y = $.extend({}, m.label);
                        y.outlineColor = m.label.fillColor, y.style = Cesium.LabelStyle.FILL_AND_OUTLINE, t.setEyeOffset(y, -5), y.outlineWidth = 1, a.add(y)
                    } else if (m.label.isUnderline != undefined && m.label.isUnderline) {
                        var b = "_", w = m.label.text.match(/[iljf1]/g) != null ? m.label.text.match(/[iljf1]/g) : [],
                            E = m.label.text.length, S = Array(Math.ceil(E - w.length * .5)).join(b);
                        u = $.extend({}, m.label), m.label.image != undefined && delete m.label.image, u.position = m.label.position, u.id = m.label.id, u.text = S, u.alignment = m.label.alignment != undefined ? m.label.alignment : undefined, u.underline = !0, u.textRelativeToImage = m.label.textRelativeToImage != undefined ? m.label.textRelativeToImage : undefined;
                        var x = m.label.font.indexOf("pt") > -1 ? Number(m.label.font.split("pt")[0]) * 4 / 3 : m.label.font.indexOf("px") > -1 ? Number(m.label.font.split("px")[0]) : 5;
                        u.pixelOffset = new Cesium.Cartesian2(0, -45), a.add(u)
                    } else a.add(m.label)
                }
                m.billboard && (m.billboard.position = m.position, e.isRelative && (m.billboard.updatePosition = r, m.billboard.altitudeOffsetValue = Cesium.defaultValue(e.altitudeOffsetFunc(d), 0)), m.billboard.id = d.fid, t.setEyeOffset(m.billboard), l.add(m.billboard));
                if (m.model) {
                    m.model.url = m.model.uri, m.model.id = d.fid;
                    var T = c.add(Cesium.Model.fromGltf(m.model))
                }
                m.point && (m.point.position = m.position, m.point.id = d.fid, t.setEyeOffset(m.point), f.add(m.point));
                if (m.lineToGround != 0) {
                    var N = Cesium.Cartographic.fromCartesian(m.position),
                        C = Cesium.Cartesian3.fromRadians(N.longitude, N.latitude, 0);
                    if (m.lineToGround == 2) {
                        var k = m.lineToGroundLength / Cesium.Cartesian3.distance(m.position, C);
                        Cesium.Cartesian3.lerp(m.position, C, k, C)
                    }
                    h.add({
                        show: !0,
                        width: 1,
                        positions: [m.position, C],
                        material: Cesium.Material.fromType("Color", {color: m.lineToGroundColor})
                    })
                }
                e.parentLayer.addRenderedFeatureId(d.fid), n += d.fid + ";", i.push(d.fid), o.push(g.tooltip)
            }
            if (e.isQuery) {
                e.onFinishedQuery(s);
                return
            }
            if (n == "") return;
            var L, A = new Cesium.PrimitiveCollection;
            A.type = "pointPrimitive", A.updatePositions = function () {
                this._primitives.forEach(function (e) {
                    e.updatePositions !== undefined && e.updatePositions()
                })
            }, a.length > 0 && ($.each(a._labels, function (e, t) {
                t._type = "Label"
            }), a._billboardCollection._parentCollection = A, A.add(a), L = "labels"), l.length > 0 && ($.each(l._billboards, function (e, t) {
                t._type = "Billboard"
            }), l._parentCollection = A, A.add(l), L = "billboards"), c.length > 0 && ($.each(c._primitives, function (e, t) {
                t._type = "Model", t._parentCollection = A
            }), A.add(c), L = "models"), f.length > 0 && ($.each(f._pointPrimitives, function (e, t) {
                t._type = "Point"
            }), f._parentCollection = A, A.add(f), L = "points"), h.length > 0 && ($.each(h._polylines, function (e, t) {
                t._type = "L2G"
            }), h._parentCollection = A, A.add(h), L = "L2G"), A.ID = L + ":" + _hashCode(n), A._instanceIds = i, A._tooltips = o, e.onFinishedCreatePrimitive(A, s)
        };
        e.altitudeOffsetFunc = getAltitudeOffsetFunc(t);
        var o = this.style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_TERRAIN_ABSOLUTE;
        e.isRelative = this.style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_TERRAIN_RELATIVE || this.style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_3DML_RELATIVE, e.isRelativeTo3DML = this.style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_3DML_RELATIVE;
        if (!o) {
            var u = pointFeaturesToPositionsArray(e.features),
                a = Cesium.sampleRenderedData(u, e.isRelativeTo3DML ? Cesium.SampleRenderedDataFlags.MESH : Cesium.SampleRenderedDataFlags.TERRAIN);
            Cesium.when(a, function (n) {
                var r = t._style.altitudeMethod == TerraExplorer.internal.TEPosition.ATC_ON_TERRAIN ? !0 : !1;
                convertPointsRelativeHeightToAbsoluteHeightFromTerrainHeights(e.features, n, e.altitudeOffsetFunc, r), s(e)
            })
        } else e.features = addAltitudeOffsetToFeatureHeights(e.features, e.altitudeOffsetFunc), s(e)
    }, EntityCreator.prototype.processingSpeedFactor = function () {
        switch (this.processingSpeed) {
            case this.UPDATING_HEIGHT_SPEED_FAST:
                return 1;
            case this.UPDATING_HEIGHT_SPEED_NORMAL:
                return 3;
            case this.UPDATING_HEIGHT_SPEED_SLOW:
                return 20;
            default:
                return 3
        }
    };
    var _frameCount = 0;
    EntityCreator.prototype.onPreFrame = function (e, t) {
        _frameCount++;
        if (this._pauseUpdatingHeight) return;
        if (this.processingSpeed == this.UPDATING_HEIGHT_SPEED_IMIDIATE) while (this._primitivesWaitingForUpdatingHeight.length > 0) {
            var n = this._primitivesWaitingForUpdatingHeight.pop();
            this.createPointPrimitive(n)
        } else if (this._primitivesWaitingForUpdatingHeight.length > 0 && _frameCount % this.processingSpeedFactor() == 0) {
            var n = this._primitivesWaitingForUpdatingHeight.pop();
            n.isDestroyed !== undefined && !n.isDestroyed() && n.updatePosition !== undefined && n.updatePosition()
        }
    }, EntityCreator.prototype.createCommonOptions = function (e) {
        var t = {};
        return t.tooltip = this.applyConditionalClassification(this.style.tooltip, e), t
    }, EntityCreator.prototype.createPolygonOptions = function (e, t) {
        var n = this.getPolygonStyle(this.style);
        n.polygon.hierarchy = {positions: Cesium.Cartesian3.fromDegreesArrayHeights(e[0]), holes: []};
        for (var r = 1; r < e.length; r++) n.polygon.hierarchy.holes.push({positions: Cesium.Cartesian3.fromDegreesArrayHeights(e[r])});
        var i = this.applyConditionalClassification(n.polygon.material, t);
        n.polygon.material = teColorToCesiumColor(i);
        if (n.polygon.fill != undefined && n.polygon.fromKml != undefined) {
            var s = this.applyConditionalClassification(n.polygon.fill, t);
            s > 1 && (s /= 100), n.polygon.material = new Cesium.Color(n.polygon.material.red, n.polygon.material.green, n.polygon.material.blue, s)
        }
        return i = this.applyConditionalClassification(n.polygon.outlineColor, t), n.polygon.outlineColor = teColorToCesiumColor(i), n.polygon.outline !== undefined && n.polygon.outline.defaultValue !== undefined && (n.polygon.outline = this.applyConditionalClassification(n.polygon.outline)), n.polygon.outlineWidth !== undefined && n.polygon.outlineWidth.defaultValue !== undefined && (n.polygon.outlineWidth = this.translateLineWidth(n, t, !0)), n.polygon.fill !== undefined && n.polygon.fill.defaultValue !== undefined && (n.polygon.fill = this.applyConditionalClassification(n.polygon.fill)), n.polygon
    }, EntityCreator.prototype.translateLineWidth = function (e, t, n) {
        var r, i;
        return n === undefined ? (i = e.polyline.width, r = this.applyConditionalClassification(i, t)) : (i = e.polygon.outlineWidth, r = this.applyConditionalClassification(i, t)), r > 0 ? TerraExplorer.USE_CORRIDOR_FOR_LINE_WIDTH_IN_METERS ? r > 1 && (i.widthInMeters = !0, r *= .8, i.backgroundOpacity > 0 && (r *= .8)) : r = r > 1 ? 2 : 1 : r < 0 ? r = Math.min(5, Math.abs(r)) : r == 0 && (r = 1), r
    }, EntityCreator.prototype.createLinestringOptions = function (e, t) {
        var n = this.getLinestringStyle(this.style);
        n.polyline.positions = Cesium.Cartesian3.fromDegreesArrayHeights(e);
        var r = this.applyConditionalClassification(n.polyline.material, t);
        n.polyline.material = teColorToCesiumColor(r);
        if (n.polyline.lineOpacity != undefined) {
            var i = this.applyConditionalClassification(n.polyline.lineOpacity, t);
            i > 1 && (i /= 100), n.polyline.material = new Cesium.Color(n.polyline.material.red, n.polyline.material.green, n.polyline.material.blue, i)
        }
        return n.polyline.width = this.translateLineWidth(n, t), n.polyline.maxVisibilityDistance = this.applyConditionalClassification(n.polyline.maxVisibilityDistance, t), n.polyline.minVisibilityDistance = this.applyConditionalClassification(n.polyline.minVisibilityDistance, t), n.polyline
    }, EntityCreator.prototype.applyConditionalClassification = function (e, t) {
        if (e == undefined) return undefined;
        if (e.defaultValue == undefined) return e;
        var n = tryGetValueAsFloat(e.defaultValue);
        if (e.classificationArray === undefined) {
            if (!isNaN(n)) return n;
            if (n instanceof Cesium.Color) return n
        }
        if (e.attributeName !== undefined) {
            var r = "[" + e.attributeName + "]";
            if (n === r) n = t[e.attributeName]; else if (e.multipleAttributeReplacementNeeded) for (name in t) n = replaceAll(n, "[" + name + "]", t[name]); else n = replaceAll(n, r, t[e.attributeName]);
            return n
        }
        if (e.classification !== undefined) return n = applyClassificationFunc(e.classification, t), n;
        var i = e.classificationArray;
        return i !== undefined ? ($(Object.keys(i)).each(function (e, r) {
            var s = getClassificationValue(i[r], t);
            s && (n = s)
        }), n) : n
    }, EntityCreator.prototype.createLineToGroundOptions = function (e, t) {
        var n = this.applyConditionalClassification(e.lineToGround, t);
        if (n != undefined && Number(n) != 0) {
            e.lineToGround = n;
            var r = this.applyConditionalClassification(e.lineToGroundColor, t);
            r = colorFromClassification(r), e.lineToGroundColor = r;
            var i = this.applyConditionalClassification(e.lineToGroundLength, t);
            e.lineToGroundLength = Number(i)
        } else e.lineToGround = 0, e.lineToGroundColor = 0, e.lineToGroundLength = 0
    }, EntityCreator.prototype.createPointOptions = function (e, t) {
        var n = this.getPointStyle(this.style);
        n.position = Cesium.Cartesian3.fromDegrees(e[0], e[1], e[2]);
        if (n.label) {
            var r = n.label.text;
            typeof r.indexOf != "function" && r.defaultValue !== undefined && (r = r.defaultValue);
            if (r !== undefined && r.indexOf("[") > -1 && r.indexOf("]") > -1) {
                var i = t[r.substring(1, r.length - 1)];
                i !== undefined && (n.label.text = i)
            }
            n.label.text = this.applyConditionalClassification(n.label.text, t);

            function s(e) {
                return e.split("").reverse().join("")
            }

            function o(e) {
                var t = "A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿", n = "֑-߿יִ-﷽ﹰ-ﻼ", r = new RegExp("^[^" + t + "]*[" + n + "]");
                return r.test(e[0])
            }

            n.label.text = o(n.label.text) ? s(n.label.text) : n.label.text;
            if (n.label.family != undefined) {
                var u = this.applyConditionalClassification(n.label.family, t),
                    a = this.applyConditionalClassification(n.label.font, t);
                a >= 0 ? n.label.font = convertFontSizeToTEFontSize(a).toString() + "pt " + u : n.label.font = convertFontSizeToTEFontSize(getFontSizeInPixels(a)).toString() + "pt " + u
            }
            n.label.fillColor = colorFromClassification(this.applyConditionalClassification(n.label.fillColor, t)), n.label.backgroundColor = colorFromClassification(this.applyConditionalClassification(n.label.backgroundColor, t)), n.label.backgroundColor == undefined && (n.label.backgroundColor = new Cesium.Color(.165, .165, .165, 0)), n.label.showBackground = !0;
            if (n.label.showText != undefined) {
                var f = this.applyConditionalClassification(n.label.showText, t);
                f && Number(f) === 1 && (n.label.onHoverShowText = !0);
                if (f && viewer.scene.canvas.onHoverShowText == undefined) {
                    var l = viewer.scene, c = new Cesium.ScreenSpaceEventHandler(l.canvas);
                    c.setInputAction(function (e) {
                        var t = {}, n = l.screenToWorld(e.endPosition, t);
                        Cesium.defined(t.pickPrimitive) && t.pickPrimitive.constructor.name == "Billboard" && t.pickPrimitive.label != undefined ? l.onHoverShowTextArray[t.pickPrimitive.label.id] != undefined && (l._lastObjectShowOnText != null && l._lastObjectShowOnText.id != t.pickPrimitive.label.id && l._lastObjectShowOnText.show != undefined && (l._lastObjectShowOnText.show = !1), viewer.scene._lastObjectShowOnText = l.onHoverShowTextArray[t.pickPrimitive.label.id], l._lastObjectShowOnText.show != undefined && (viewer.scene._lastObjectShowOnText.show = !0)) : l._lastObjectShowOnText != null && l._lastObjectShowOnText.show != undefined && (l._lastObjectShowOnText.show = !1)
                    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE), viewer.scene.canvas.onHoverShowText = !0
                }
            }
            n.label.textRelativeToImage != undefined && n.label.textAlignment != undefined && (n.label.textRelativeToImage = this.applyConditionalClassification(n.label.textRelativeToImage, t), n.label.alignment = this.applyConditionalClassification(n.label.textAlignment, t)), n.label.underline != undefined && (n.label.isUnderline = this.applyConditionalClassification(n.label.underline, t));
            if (n.label.italic != undefined) {
                var h = this.applyConditionalClassification(n.label.italic, t);
                h == 1 && (n.label.font = "italic " + n.label.font)
            }
            n.label.backgroundOpacity != undefined && (n.label.backgroundColor.alpha = this.applyConditionalClassification(n.label.backgroundOpacity, t));
            var p = parseFloat(n.label.scale.defaultValue);
            n.label.scale = clamp(this.applyConditionalClassification(n.label.scale, t) / p, .7, 1.3), n.label.scale = this.applyConditionalClassification(n.label.scale, t);
            if (n.label.minViewingHeight != undefined) {
                var d = this.applyConditionalClassification(n.label.minViewingHeight, t),
                    v = this.applyConditionalClassification(n.label.scaleMPP, t) * 650;
                n.label.distanceDisplayCondition = new Cesium.DistanceDisplayCondition(d, v)
            }
            isNaN(n.label.scale) && (n.label.scale = 1.5);
            if (n.label.limitGrowth != undefined && n.label.scaleMPP != undefined) {
                var m = this.applyConditionalClassification(n.label.limitGrowth, t),
                    g = this.applyConditionalClassification(n.label.scaleMPP, t) * 1e3;
                m ? n.label.scaleByDistance = new Cesium.NearFarScalar(g, 1, g * 10, 0) : n.label.scaleByDistance = new Cesium.NearFarScalar(15, 50, g * 10, .1)
            }
        }
        if (n.billboard) {
            n.billboard.sizeInMeters = !1;
            if (n.billboard.imageColor != undefined) {
                var y = this.applyConditionalClassification(n.billboard.imageColor, t);
                y = colorFromClassification(y), n.billboard.color = y
            }
            n.billboard.imageOpacity != undefined && n.billboard.color.alpha != undefined && (n.billboard.color.alpha = Number(this.applyConditionalClassification(n.billboard.imageOpacity, t))), n.billboard.image = this.applyConditionalClassification(n.billboard.image, t);
            if (n.billboard.limitGrowth != undefined && n.billboard.scaleTE != undefined) {
                var m = this.applyConditionalClassification(n.billboard.limitGrowth, t);
                m.defaultValue == undefined && !isNaN(Number(m)) && (m = Number(m));
                var g = this.applyConditionalClassification(n.billboard.scaleTE, t) * 1e3;
                m ? n.billboard.scaleByDistance = new Cesium.NearFarScalar(g, 1, g * 10, 0) : (n.billboard.sizeInMeters = !0, n.billboard.scaleByDistance = new Cesium.NearFarScalar(g, g / 1e3, g * 10, g / 1e3))
            }
        }
        if (n.model) {
            var b = function (e) {
                var t = Number(e);
                if (!Cesium.defined(t) || isNaN(t)) t = 0;
                return t
            };
            n.model.uri = this.applyClassification(n.model.uri, t), n.model.scale = b(this.applyClassification(n.model.scale, t));
            var w = b(this.applyClassification(n.model.heading, t)), E = b(this.applyClassification(n.model.pitch, t)),
                S = b(this.applyClassification(n.model.roll, t)),
                x = new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(w), Cesium.Math.toRadians(E), Cesium.Math.toRadians(S));
            n.model.modelMatrix = Cesium.Transforms.headingPitchRollToFixedFrame(n.position, x)
        }
        return this.createLineToGroundOptions(n, t), n
    }, EntityCreator.prototype.applyClassification = function (text, attributes) {
        if ($.type(text) !== "string") return text;
        if (/(\[([^\]]+)\])/g.exec(text) != null) for (var attr in attributes) text = replaceAll(text, "[" + attr + "]", attributes[attr]);
        text == "undefined" && (text = "");
        var myRegexp = /(\<([^\>]+)\>)/g, match = myRegexp.exec(text);
        while (match != null) {
            try {
                var expression = match[match.length - 1], value = (0, eval)(expression);
                text = text.replace(match[0], value)
            } catch (e) {
            }
            match = myRegexp.exec(text)
        }
        return text
    }, EntityCreator.prototype.getPolygonStyle = function (e) {
        var t = $.extend(!0, {}, PredefinedFeatureStyles.DEFAULT_POLYGON_STYLE, e);
        return t
    }, EntityCreator.prototype.getLinestringStyle = function (e) {
        var t = $.extend(!0, {}, PredefinedFeatureStyles.DEFAULT_POLYLINE_STYLE, e);
        return t
    }, EntityCreator.prototype.getPointStyle = function (e) {
        if (e.label != undefined) {
            var t = $.extend(!0, {}, PredefinedFeatureStyles.DEFAULT_LABEL_STYLE, e);
            return t
        }
        if (e.billboard != undefined) {
            var n = $.extend(!0, {}, PredefinedFeatureStyles.DEFAULT_BILLBOARD_STYLE, e);
            return n
        }
        if (e.model != undefined) {
            var r = $.extend(!0, {}, PredefinedFeatureStyles.DEFAULT_MODEL_STYLE, e);
            return r
        }
        if (e.point != undefined) {
            var i = $.extend(!0, {}, PredefinedFeatureStyles.DEFAULT_POINT_STYLE, e);
            return i
        }
        return PredefinedFeatureStyles.DEFAULT_POINT_STYLE
    }, EntityCreator.prototype.sanitizePositions = function (e) {
        for (var t = 0; t < e.length; t++) e[t] instanceof Array ? this.sanitizePositions(e[t]) : isNaN(e[t]) && (e[t] = 0)
    };
    var PredefinedFeatureStyles = {};
    return Object.defineProperties(PredefinedFeatureStyles, {
        DEFAULT_POLYGON_STYLE: {
            get: function () {
                return {
                    polygon: {
                        perPositionHeight: !0,
                        fill: 0,
                        material: Cesium.Color.GREEN,
                        outline: 1,
                        outlineColor: Cesium.Color.WHITE,
                        outlineWidth: 1
                    }
                }
            }
        }, DEFAULT_POLYLINE_STYLE: {
            get: function () {
                return {polyline: {material: Cesium.Color.WHITE, width: 1}}
            }
        }, DEFAULT_POINT_STYLE: {
            get: function () {
                return {
                    point: {
                        color: Cesium.Color.RED,
                        pixelSize: 5,
                        outlineColor: Cesium.Color.WHITE,
                        outlineWidth: 2
                    }
                }
            }
        }, DEFAULT_LABEL_STYLE: {
            get: function () {
                return {
                    label: {
                        text: "Text",
                        font: "18px arial",
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        fillColor: Cesium.Color.WHITE,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                        scale: 1,
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        eyeOffset: Cesium.Cartesian3.ZERO
                    }
                }
            }
        }, DEFAULT_BILLBOARD_STYLE: {
            get: function () {
                return {
                    billboard: {
                        image: "./img/defaulticon.png",
                        scale: 1,
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM
                    }
                }
            }
        }, DEFAULT_MODEL_STYLE: {
            get: function () {
                return {model: {uri: "./img/CesiumTexturedBoxTest.bgltf", scale: 1e3}}
            }
        }
    }), EntityCreator
}), define("WorkerPool", [], function () {
    "use strict";

    function t(e, t) {
        for (var n = 0; n < e.length; n++) if (t(e[n])) return n
    }

    var e = function (e) {
        e = e || [];
        if (!Cesium.defined(e.workerPath)) throw new Cesium.DeveloperError("workerPath is required.");
        this._workerPath = e.workerPath, this._poolSize = Cesium.defaultValue(e.poolSize, 16), this._workers = [], this._defered = []
    };
    return Object.defineProperties(e.prototype, {
        errorEvent: {
            get: function () {
                return this.errorEvent
            }
        }, poolSize: {
            get: function () {
                return this._poolSize
            }
        }
    }), e.prototype.queueWorkItem = function (e, t) {
        var n = Cesium.when.defer(), r = null, i = 999999;
        for (var s = 0; s < this._workers.length; s++) {
            var r = this._workers[s];
            this._workers[s].jobQueueSize < i && (r = this._workers[s], i = this._workers[s].jobQueueSize)
        }
        if (i > 0 && this._workers.length < this.poolSize) {
            r = new Worker(this._workerPath);
            var o = this;
            r.addEventListener("message", function (e) {
                o.onWorkerMessage(e)
            }, !1), r.addEventListener("error", function (e) {
                o.onWorkerError(e)
            }, !1), r.jobQueueSize = 0, this._workers.push(r), r.id = Cesium.createGuid()
        }
        e.workerId = r.id;
        var u = Cesium.createGuid();
        return e.deferedId = u, this._defered[u] = n, r.jobQueueSize++, r.postMessage(e, t), n
    }, e.prototype.trimPool = function (e) {
        var t = this;
        if (e == undefined) {
            this.timerId != null && clearTimeout(this.timerId), this.timerId = setTimeout(function () {
                t.trimPool(!0)
            }, 5e3);
            return
        }
        for (var n = 0; n < this._workers.length; n++) this._workers[n].jobQueueSize == 0 && (this._workers[n].terminate(), this._workers.splice(n, 1), n--);
        this._workers.length ? this.timerId = setTimeout(function () {
            t.trimPool(!0)
        }, 5e3) : this.timerId = null
    }, e.prototype.onWorkerMessage = function (e) {
        var n = e.data, r = t(this._workers, function (e) {
            return e.id === n.workerId
        });
        if (r != undefined) {
            var i = this._workers[r];
            i.jobQueueSize--, this.trimPool()
        }
        var s = this._defered[n.deferedId];
        delete this._defered[n.deferedId], s.resolve(n)
    }, e.prototype.onWorkerError = function (e) {
        console.log(e)
    }, e
}), define("internal/simpleSqlParser", ["require"], function (e) {
    "use strict";

    function t() {
    }

    function n(e) {
        return typeof e == "string" ? e.replace(/^\s+/g, "").replace(/\s+$/g, "") : e
    }

    function r(e, t) {
        var r = "######", i = !1, s = 0, o = "";
        for (var u = 0; u < t.length; u++) !i && /['"`]/.test(t[u]) ? i = t[u] : i && t[u] == i ? i = !1 : !i && t[u] == "(" ? s++ : !i && t[u] == ")" && s--, t[u] == e && (s > 0 || i) ? o += r : o += t[u];
        return t = o, t = t.split(e), t = t.map(function (t) {
            return n(t.replace(new RegExp(r, "g"), e))
        }), t
    }

    function i(e) {
        var t = "#", n = e.length;
        for (var r = 0; r < n; r++) t += e[r] + "#";
        return t
    }

    function s(e) {
        var t = "", n = e.length;
        for (var r = 1; r < n; r += 2) t += e[r];
        return t
    }

    function o(e) {
        this.source = e, this.cursor = 0, this.currentChar = "", this.readNextChar()
    }

    function u(e) {
        this.lexer = new o(e), this.currentToken = "", this.readNextToken()
    }

    function a(e, t) {
        var n = "";
        return typeof e.logic != "undefined" ? (n = e.terms.map(function (e) {
            return a(e, !0)
        }), n = n.join(" " + e.logic + " "), typeof t != "undefined" && (n = "(" + n + ")")) : typeof e.left != "undefined" ? (n = e.left, typeof e.operator != "undefined" && (n += " " + e.operator, typeof e.right != "undefined" && (e.operator === "IN" ? n += " (" + e.right + ")" : n += " " + e.right))) : n = e, n
    }

    return t.sql2ast = function (e, t) {
        function p(e, t) {
            return t
        }

        if (typeof t == "undefined" || t === null) t = !0;
        var o = "###semi-colon###";
        e = e.replace(/[("'`].*;.*[)"'`]/g, function (e) {
            return e.replace(/;/g, o)
        });
        var a = "###EOR###";
        e = e.replace(/;/g, a), e = e.split(a)[0], e = e.replace(new RegExp(o, "g"), ";");
        var f = ["SELECT", "FROM", "DELETE FROM", "INSERT INTO", "UPDATE", "JOIN", "LEFT JOIN", "RIGHT JOIN", "INNER JOIN", "ORDER BY", "GROUP BY", "HAVING", "WHERE", "LIMIT", "VALUES", "SET"],
            l = f.map(function (e) {
                return e + " "
            });
        l = l.concat(f.map(function (e) {
            return e + "("
        })), l = l.concat(l.map(function (e) {
            return e.toLowerCase()
        }));
        var c = l.map(function (e) {
            return e.replace("(", "[\\(]")
        });
        e = e.replace(/\((.+?)\)|"(.+?)"|'(.+?)'|`(.+?)`/gi, function (e) {
            return e.replace(new RegExp(c.join("|"), "gi"), i)
        });
        var h = [];
        l.forEach(function (t) {
            var n = 0, r;
            do {
                r = e.indexOf(t, n);
                if (r != -1) {
                    var i = t.replace(/^((\w|\s)+?)\s?\(?$/i, p);
                    h[r] = i, n = r + i.length
                }
            } while (r != -1)
        });
        var d = 0;
        h.forEach(function (e, t) {
            d > t ? delete h[t] : (d = parseInt(t, 10) + e.length, e == "JOIN" && (h[t] = "INNER JOIN"))
        });
        var v = c.slice(0);
        v = v.map(function (e) {
            return i(e)
        }), v = v.join("|");
        var m = e.split(new RegExp(c.join("|"), "i"));
        e = e.replace(/\((.+?)\)|"(.+?)"|'(.+?)'|`(.+?)`/gi, function (e) {
            return e.replace(new RegExp(v, "gi"), s)
        }), m = m.map(function (e) {
            return e.replace(/\((.+?)\)|"(.+?)"|'(.+?)'|`(.+?)`/gi, function (e) {
                return e.replace(new RegExp(v, "gi"), s)
            })
        });
        var g = [];
        g.SELECT = function (e) {
            var t = r(",", e);
            return t = t.filter(function (e) {
                return e !== ""
            }).map(function (e) {
                return {name: e}
            }), t
        }, g.SET = function (e) {
            var t = r(",", e);
            return t = t.filter(function (e) {
                return e !== ""
            }).map(function (e) {
                return {expression: e}
            }), t
        }, g.FROM = g["DELETE FROM"] = g.UPDATE = function (e) {
            var t = e.split(",");
            return t = t.map(function (e) {
                return n(e)
            }), t.forEach(function (e, n) {
                e === "" && t.splice(n)
            }), t = t.map(function (e) {
                var t = e.split(" AS "), n = t[1] || "";
                return n.indexOf('"') === 0 && n.lastIndexOf('"') == n.length - 1 && (n = n.substring(1, n.length - 1)), {
                    table: t[0],
                    as: n
                }
            }), t
        }, g["LEFT JOIN"] = g.JOIN = g["INNER JOIN"] = g["RIGHT JOIN"] = function (e) {
            e = e.split(" ON ");
            var t = e[0].split(" AS "), r = {};
            return r.table = n(t[0]), r.as = n(t[1]) || "", r.cond = n(e[1]), r
        }, g.WHERE = function (e) {
            return n(e)
        }, g["ORDER BY"] = function (e) {
            e = e.split(",");
            var t = [];
            return e.forEach(function (e, r) {
                var i = /([A-Za-z0-9_\.]+)\s*(ASC|DESC){0,1}/gi;
                i = i.exec(e);
                if (i !== null) {
                    var s = {};
                    s.column = n(i[1]), s.order = n(i[2]), i[2] === undefined && (s.order = "ASC"), t.push(s)
                }
            }), t
        }, g["GROUP BY"] = function (e) {
            e = e.split(",");
            var t = [];
            return e.forEach(function (e, r) {
                var i = /([A-Za-z0-9_\.]+)/gi;
                i = i.exec(e);
                if (i !== null) {
                    var s = {};
                    s.column = n(i[1]), t.push(s)
                }
            }), t
        }, g.LIMIT = function (e) {
            var t = /((\d+)\s*,\s*)?(\d+)/gi;
            t = t.exec(e), typeof t[2] == "undefined" && (t[2] = 0);
            var r = {};
            return r.nb = parseInt(n(t[3]), 10), r.from = parseInt(n(t[2]), 10), r
        }, g["INSERT INTO"] = function (e) {
            var t = /([A-Za-z0-9_\.]+)\s*(\(([A-Za-z0-9_\., ]+)\))?/gi;
            t = t.exec(e);
            var r = {};
            return r.table = n(t[1]), typeof t[3] != "undefined" && (r.columns = t[3].split(","), r.columns = r.columns.map(function (e) {
                return n(e)
            })), r
        }, g.VALUES = function (e) {
            e = n(e), e[0] != "(" && (e = "(" + e);
            var t = r(",", e), i = [];
            return t.forEach(function (e) {
                e = e.replace(/^\(/g, "").replace(/\)$/g, ""), e = r(",", e), i.push(e)
            }), i
        };
        var y = {}, b = 0;
        return h.forEach(function (e, t) {
            e = e.toUpperCase(), b++;
            if (typeof g[e] != "undefined") {
                var n = g[e](m[b]);
                if (typeof y[e] != "undefined") {
                    if (typeof y[e] == "string" || typeof y[e][0] == "undefined") {
                        var r = y[e];
                        y[e] = [], y[e].push(r)
                    }
                    y[e].push(n)
                } else y[e] = n
            } else console.log("Can't analyze statement \"" + e + '"')
        }), typeof y["LEFT JOIN"] != "undefined" && (typeof y["JOIN"] == "undefined" && (y.JOIN = []), typeof y["LEFT JOIN"][0] != "undefined" ? y["LEFT JOIN"].forEach(function (e) {
            e.type = "left", y.JOIN.push(e)
        }) : (y["LEFT JOIN"].type = "left", y.JOIN.push(y["LEFT JOIN"])), delete y["LEFT JOIN"]), typeof y["INNER JOIN"] != "undefined" && (typeof y["JOIN"] == "undefined" && (y.JOIN = []), typeof y["INNER JOIN"][0] != "undefined" ? y["INNER JOIN"].forEach(function (e) {
            e.type = "inner", y.JOIN.push(e)
        }) : (y["INNER JOIN"].type = "inner", y.JOIN.push(y["INNER JOIN"])), delete y["INNER JOIN"]), typeof y["RIGHT JOIN"] != "undefined" && (typeof y["JOIN"] == "undefined" && (y.JOIN = []), typeof y["RIGHT JOIN"][0] != "undefined" ? y["RIGHT JOIN"].forEach(function (e) {
            e.type = "right", y.JOIN.push(e)
        }) : (y["RIGHT JOIN"].type = "right", y.JOIN.push(y["RIGHT JOIN"])), delete y["RIGHT JOIN"]), t && (typeof y["WHERE"] == "string" && (y.WHERE = u.parse(y.WHERE)), typeof y["JOIN"] != "undefined" && y.JOIN.forEach(function (e, t) {
            y.JOIN[t].cond = u.parse(e.cond)
        })), y
    }, o.prototype = {
        constructor: o, readNextChar: function () {
            typeof this.source != "string" ? this.currentChar = "" : this.currentChar = this.source[this.cursor++] || ""
        }, readNextToken: function () {
            return /\w|[-]/.test(this.currentChar) ? this.readWord() : /["'`]/.test(this.currentChar) ? this.readString() : /[()]/.test(this.currentChar) ? this.readGroupSymbol() : /[!=<>]/.test(this.currentChar) ? this.readOperator() : this.currentChar === "" ? {
                type: "eot",
                value: ""
            } : (this.readNextChar(), {type: "empty", value: ""})
        }, readWord: function () {
            var e = "", t = 0, n = !1;
            while (/./.test(this.currentChar)) {
                if (!n && /['"`]/.test(this.currentChar)) n = this.currentChar; else if (n && this.currentChar == n) n = !1; else {
                    if (!n) {
                        if (this.currentChar == ")" && t <= 0) break;
                        this.currentChar == "(" ? t++ : this.currentChar == ")" && t--;
                        if (/[!=<>]/.test(this.currentChar)) break
                    }
                    if (this.currentChar == " " && t <= 0) break
                }
                e += this.currentChar, this.readNextChar()
            }
            return /^(AND|OR)$/i.test(e) ? {
                type: "logic",
                value: e
            } : /^(IN|IS|NOT|LIKE)$/i.test(e) ? {type: "operator", value: e} : {type: "word", value: e}
        }, readString: function () {
            var e = "", t = this.currentChar;
            e += this.currentChar, this.readNextChar();
            while (this.currentChar != t && this.currentChar !== "") e += this.currentChar, this.readNextChar();
            return e += this.currentChar, this.readNextChar(), this.currentChar == "." ? (e += this.currentChar, this.readNextChar(), e += this.readString().value, {
                type: "word",
                value: e
            }) : {type: "string", value: e}
        }, readGroupSymbol: function () {
            var e = this.currentChar;
            return this.readNextChar(), {type: "group", value: e}
        }, readOperator: function () {
            var e = this.currentChar;
            return this.readNextChar(), /[=<>]/.test(this.currentChar) && (e += this.currentChar, this.readNextChar()), {
                type: "operator",
                value: e
            }
        }
    }, o.tokenize = function (e) {
        var t = new o(e), n = [];
        do {
            var r = t.readNextToken();
            r.type != "empty" && n.push(r)
        } while (t.currentChar);
        return n
    }, u.prototype = {
        constructor: u, readNextToken: function () {
            this.currentToken = this.lexer.readNextToken();
            while (this.currentToken.type == "empty") this.currentToken = this.lexer.readNextToken();
            return this.currentToken
        }, parseExpressionsRecursively: function () {
            return this.parseLogicalExpression()
        }, parseLogicalExpression: function () {
            var e = this.parseConditionExpression();
            while (this.currentToken.type == "logic") {
                var t = this.currentToken.value;
                this.readNextToken();
                var n = this.parseConditionExpression();
                if (typeof e.logic != "undefined" && e.logic == t && typeof e.terms != "undefined") e.terms.push(n); else {
                    var r = [e, n];
                    e = {logic: t, terms: r.slice(0)}
                }
            }
            return e
        }, parseConditionExpression: function () {
            var e = this.parseBaseExpression();
            if (this.currentToken.type == "operator") {
                var t = this.currentToken.value;
                this.readNextToken(), this.currentToken.type == "operator" && (t += " " + this.currentToken.value, this.readNextToken());
                var n = this.parseBaseExpression();
                e = {operator: t, left: e, right: n}
            }
            return e
        }, parseBaseExpression: function () {
            var e = "";
            return this.currentToken.type == "word" || this.currentToken.type == "string" ? (e = this.currentToken.value, this.readNextToken()) : this.currentToken.type == "group" && (this.readNextToken(), e = this.parseExpressionsRecursively(), this.readNextToken()), e
        }
    }, u.parse = function (e) {
        return (new u(e)).parseExpressionsRecursively()
    }, t.ast2sql = function (e) {
        function n(e) {
            return typeof e["SELECT"] != "undefined" ? "SELECT " + e.SELECT.map(function (e) {
                return e.name
            }).join(", ") : ""
        }

        function r(e) {
            if (typeof e["FROM"] != "undefined") {
                var t = " FROM ", n = e.FROM.map(function (e) {
                    var t = e.table;
                    return e.as !== "" && (t += " AS " + e.as), t
                });
                return t += n.join(", "), t
            }
            return ""
        }

        function i(e) {
            if (typeof e["JOIN"] != "undefined") {
                var t = "";
                return e.JOIN.forEach(function (e) {
                    t += " " + e.type.toUpperCase() + " JOIN " + e.table, e.as !== "" && (t += " AS " + e.as), t += " ON " + a(e.cond)
                }), t
            }
            return ""
        }

        function s(e) {
            return typeof e["WHERE"] != "undefined" ? " WHERE " + a(e.WHERE) : ""
        }

        function o(e) {
            if (typeof e["ORDER BY"] != "undefined") {
                var t = " ORDER BY ", n = e["ORDER BY"].map(function (e) {
                    return e.column + " " + e.order
                });
                return t += n.join(", "), t
            }
            return ""
        }

        function u(e) {
            if (typeof e["GROUP BY"] != "undefined") {
                var t = " GROUP BY ", n = e["GROUP BY"].map(function (e) {
                    return e.column
                });
                return t += n.join(", "), t
            }
            return ""
        }

        function f(e) {
            if (typeof e["LIMIT"] != "undefined" && typeof e["LIMIT"].nb != "undefined" && parseInt(e.LIMIT.nb, 10) > 0) {
                var t = " LIMIT ";
                return typeof e["LIMIT"].from != "undefined" && parseInt(e.LIMIT.from, 10) > 1 && (t += e.LIMIT.from + ","), t += e.LIMIT.nb, t
            }
            return ""
        }

        function l(e) {
            if (typeof e["INSERT INTO"] != "undefined") {
                var t = "INSERT INTO " + e["INSERT INTO"].table;
                return typeof e["INSERT INTO"].columns != "undefined" && (t += " (", t += e["INSERT INTO"].columns.join(", "), t += ")"), t
            }
            return ""
        }

        function c(e) {
            if (typeof e["VALUES"] != "undefined") {
                var t = " VALUES ", n = e.VALUES.map(function (e) {
                    return "(" + e.join(", ") + ")"
                });
                return t += n.join(", "), t
            }
            return ""
        }

        function h(e) {
            if (typeof e["DELETE FROM"] != "undefined") {
                var t = "DELETE FROM ";
                return t += e["DELETE FROM"].map(function (e) {
                    var t = e.table;
                    return e.as !== "" && (t += " AS " + e.as), t
                }).join(", "), t
            }
            return ""
        }

        function p(e) {
            if (typeof e["UPDATE"] != "undefined") {
                var t = "UPDATE ";
                return t += e.UPDATE.map(function (e) {
                    var t = e.table;
                    return e.as !== "" && (t += " AS " + e.as), t
                }).join(", "), t
            }
            return ""
        }

        function d(e) {
            return typeof e["SET"] != "undefined" ? " SET " + e.SET.map(function (e) {
                return e.expression
            }).join(", ") : ""
        }

        var t = "";
        return typeof e["SELECT"] != "undefined" && typeof e["FROM"] != "undefined" ? t = n(e) + r(e) + i(e) + s(e) + u(e) + o(e) + f(e) : typeof e["INSERT INTO"] != "undefined" ? t = l(e) + c(e) : typeof e["UPDATE"] != "undefined" ? t = p(e) + d(e) + s(e) : typeof e["DELETE FROM"] != "undefined" ? t = h(e) + s(e) : t = null, t
    }, t.trim = n, t.protect = i, t.unprotect = s, t.protect_split = r, t.CondLexer = o, t.CondParser = u, t
}), define("wfs/Layer", ["./../jquery", "./GmlParser", "./EntityCreator", "./TileManager", "WorkerPool", "./../internal/simpleSqlParser"], function ($, GmlParser, EntityCreator, TileManager, WorkerPool, simpleSqlParser) {
    "use strict";

    function Layer(e, t, n, r, i, s, o, u, a) {
        i = i || {}, this._level = r, this._url = t, this._layerName = n, this._guid = Cesium.createGuid(), this._viewer = e, this._gmlParser = new GmlParser(!0, null, null, !0), this._tileManager = TileManager.getInstance(e), this._tileManager.loadTileEvent.addEventListener(Layer.prototype.loadTile, this), this._useWorkers = !0, this._layerDisplayName = s, this._showAttributesAsMessage = i.showAttributesAsMessage, delete i.showAttributesAsMessage, this._entityCreator = new EntityCreator(i), this._visible = !0, this._featuresMap = {}, this._boundingBox = undefined, this._geometryFieldName = undefined, this._operations = {}, this._subdomains = o, this.latLon = u, this._addedFeatures = [], this.simpleSqlParser = simpleSqlParser, this.myLayer = a, this._statistics = {
            numberOfAddedFeatures: 0,
            numberOfDeletedFeatures: 0,
            numberOfAddePositions: 0,
            numberOfDeletedPositions: 0,
            getNumberOfCurrentlyRenderedFeatures: function () {
                return this.numberOfAddedFeatures - this.numberOfDeletedFeatures
            },
            getNumberOfCurrentlyRenderedPositions: function () {
                return this.numberOfAddePositions - this.numberOfDeletedPositions
            }
        }, initLayerCapabilities(this), initFeatureType(this)
    }

    function ReplaceTagWithOriginalDomain(e, t) {
        var n;
        return e.indexOf("{s}") != -1 ? n = t != undefined && t.length > 0 ? e.replace("{s}", t[0]) : console.error("Error - sTag with no subdomains.") : n = e, n
    }

    function parseBBox(e, t) {
        TerraExplorer.getXmlTag(t, "FeatureType", "wfs").each(function (t, n) {
            var r = TerraExplorer.getXmlTag(n, "Name", "wfs").text();
            if (r == e._layerName || r.endsWith("." + e._layerName)) {
                var i = TerraExplorer.getXmlTag(n, "LatLongBoundingBox", "wfs");
                return i.length !== 1 ? !1 : (e._boundingBox = Cesium.Rectangle.fromDegrees(parseFloat(i[0].attributes.minx.value), parseFloat(i[0].attributes.miny.value), parseFloat(i[0].attributes.maxx.value), parseFloat(i[0].attributes.maxy.value)), !1)
            }
            return !0
        })
    }

    function initLayerCapabilities(e) {
        var t = e.cleanUrl(e._url).replace("{s}", e.sTag(e._layerName.length, e._layerName.length, e._level));
        t += TerraExplorer.functions.queryStringExist(t), t += "SERVICE=WFS&VERSION=1.0.0&REQUEST=GetCapabilities&outputFormat=GML2&typeName=" + e._layerName;
        var n = TerraExplorer.internal.Settings.connectionUrl,
            r = Cesium.TrustedServers.contains(ReplaceTagWithOriginalDomain(e._url, e._subdomains));
        $.ajax({
            dataType: "xml", xhrFields: {withCredentials: r}, url: encodeURI(t), success: function (t) {
                parseBBox(e, t), initAllowedOperations(e, t)
            }
        })
    }

    function initAllowedOperations(e, t) {
        $(t).find("FeatureType").each(function (t, n) {
            if ($(n).children("Name").text() == e._layerName) {
                var r = $(n).children("Operations");
                return r.length == 0 ? !1 : (r.children().each(function () {
                    e._operations[this.tagName.toLowerCase()] = {}
                }), !1)
            }
            return !0
        })
    }

    function initFeatureType(e) {
        e.featureColumnNames = null;
        var t = e.cleanUrl(e._url).replace("{s}", e.sTag(e._layerName.length, e._layerName.length, e._level));
        t += TerraExplorer.functions.queryStringExist(t), t += "SERVICE=WFS&VERSION=1.0.0&REQUEST=DescribeFeatureType&typeName=" + e._layerName;
        var n = TerraExplorer.internal.Settings.connectionUrl,
            r = Cesium.TrustedServers.contains(ReplaceTagWithOriginalDomain(e._url, e._subdomains));
        $.ajax({
            dataType: "xml", xhrFields: {withCredentials: r}, url: encodeURI(t), success: function (t) {
                parseDescribeFeatureResponse(e, t)
            }
        })
    }

    function getWfsNamespace(xmlText, testElementName) {
        if (xmlText == null) return null;
        try {
            var match = (new XMLSerializer).serializeToString(xmlText).match(eval("/[<]([a-z]+):" + testElementName + "[>]/i"));
            return match != null ? match[1] : null
        } catch (ex) {
            return !1
        }
    }

    function isElementNameExists(xmlText, testElementName) {
        if (xmlText == null) return !1;
        try {
            var match = (new XMLSerializer).serializeToString(xmlText.context != null ? xmlText.context : xmlText).match(eval("/[<](([a-z]+):)?" + testElementName + "[^>]*[>]/i"));
            return match != null
        } catch (ex) {
            return !1
        }
    }

    function parseDescribeFeatureResponse(e, t) {
        var n = $(t).find("[type^='gml:']");
        e._geometryFieldName = $(n).attr("name"), e.geometryResponseData = t, e.wfsNamespace = getWfsNamespace(e.geometryResponseData, "sequence"), e.wfsNamespace == null && (e.wfsNamespace = "xsd"), e.sgSchemaExists = $(e.geometryResponseData).find(e.wfsNamespace + "\\:schema").attr("xmlns:sfs"), e.sgSchemaExists || (e.sgSchemaExists = $(e.geometryResponseData).find("schema").attr("xmlns:sfs"));
        var r = $(e.geometryResponseData).find(e.wfsNamespace + "\\:sequence " + e.wfsNamespace + "\\:element");
        r.length == 0 && (r = $(e.geometryResponseData).find("sequence").find("element")), e.geomFields = [], r.each(function () {
            var t = $(this), n = t.attr("name"), r = t.attr("type");
            if (r == null) r = "string"; else {
                var i = r.match(/.*[:](\w+)/);
                i && (r = i[1])
            }
            e.geomFields.push({name: n, type: r})
        })
    }

    function sqlParserToWfs(e, t) {
        if (e.operator) {
            var n = "";
            switch (e.operator.toLowerCase()) {
                case"=":
                    n = "PropertyIsEqualTo";
                    break;
                case"<>":
                    n = "PropertyIsNotEqualTo";
                    break;
                case">":
                    n = "PropertyIsGreaterThan";
                    break;
                case">=":
                    n = "PropertyIsGreaterThanOrEqualTo";
                    break;
                case"<":
                    n = "PropertyIsLessThan";
                    break;
                case"<=":
                    n = "PropertyIsLessThanOrEqualTo";
                    break;
                case"like":
                    n = "PropertyIsLike"
            }
            var r = t.indexOf(e.right) != -1 ? e.right : e.left,
                i = "<ogc:" + n + (e.operator.toLowerCase() == "like" ? ' wildCard="*" singleChar="*" escape="*"' : "") + ">";
            i += "<ogc:PropertyName>" + r + "</ogc:PropertyName>";
            var s = t.indexOf(e.right) != -1 ? e.left : e.right;
            s = s.replace(/^'|'$/g, "");
            var o = s.match(/^[%]|[%]$/) == null;
            return e.operator.toLowerCase() == "like" && o && (s = "%" + s + "%"), i += "<ogc:Literal>" + s + "</ogc:Literal>", i += "</ogc:" + n + ">", i
        }
        var u = e.logic.toLowerCase() == "and" ? "And" : "Or", i = "<ogc:" + u + ">";
        return e.terms.length == 2 ? i += sqlParserToWfs(e.terms[0], t) : i += sqlParserToWfs({
            logic: u,
            terms: e.terms.slice(0, e.terms.length - 1)
        }, t), i += sqlParserToWfs(e.terms[e.terms.length - 1], t), i += "</ogc:" + u + ">", i
    }

    function parseFeaturesResult(e) {
        var t = [], n = $(e).find("gml\\:featureMember");
        return n.length == 0 && (n = $(e).find("featureMember")), n.each(function () {
            var e = {}, n = $(this).children().first();
            e.layerId = n[0].nodeName, e.originFid = n.attr("fid"), e.fid = n.attr("fid"), e.fid == null && (e.FEATURE_ID ? e.fid = e.FEATURE_ID : e.fid = "-1");
            var r = e.fid.match(/[.]?(\d+)$/);
            r && (e.fid = r[1]), e.node = n[0], n.children().each(function () {
                e[this.nodeName] = this.innerHTML, e[this.nodeName] == null && (e[this.nodeName] = $(this).text())
            }), t.push(e)
        }), t
    }

    function internalBlockRequestPrimitiveFromPrimitive(e) {
        return e == undefined ? undefined : e.parentLayer ? e : e._parentCollection ? e._parentCollection : e.primitive && e.primitive._parentCollection ? e.primitive._parentCollection : undefined
    }

    Cesium.defineProperties(Layer.prototype, {
        LayerDisplayName: {
            get: function () {
                return this._layerDisplayName
            }
        }, displayName: {
            get: function () {
                return this.LayerDisplayName
            }
        }, guid: {
            get: function () {
                return this._guid
            }
        }, Style: {
            get: function () {
                return this._entityCreator.style
            }
        }, show: {
            get: function () {
                return this._visible
            }, set: function (e) {
                this.setVisibility(e)
            }
        }, BoundingBox: {
            get: function () {
                return this._boundingBox
            }
        }, Statistics: {
            get: function () {
                return this._statistics
            }
        }
    });
    var DEGREES_PER_RADIAN = 180 / Math.PI, RADIAN_PER_DEGREEE = 1 / DEGREES_PER_RADIAN, REQUEST_MAX_FEATURES = 1e3;
    Layer.prototype.getRequestMaxFeatures = function () {
        return REQUEST_MAX_FEATURES
    }, Layer.prototype.isAttributeField = function (e, t) {
        return !t || !e || e.toLowerCase() == "" || e.toLowerCase() == "fid" ? !1 : t.toLowerCase() == "string" || t.toLowerCase() == "integer" || t.toLowerCase() == "double" ? !0 : !1
    }, Layer.prototype.updateFeatures = function (e, t) {
        if (e.length <= 0) {
            t();
            return
        }
        var n = this, r = [];
        $(this.geomFields).each(function () {
            n.isAttributeField(this.name, this.type) && r.push(this.name)
        });
        var i = "<wfs:Transaction version='1.0.0' service='WFS' username='' password='' xmlns:sfs='http://www.skylineglobe.com/sfs-schema' xmlns:ogc='http://www.opengis.net/ogc' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:wfs='http://www.opengis.net/wfs' xmlns:gml='http://www.opengis.net/gml'> {wfs_updates}</wfs:Transaction>",
            s = "";
        $(e).each(function () {
            var e = this, t = '<wfs:Update typeName="{lyaer_id}">'.replace("{lyaer_id}", this.layerId);
            $(r).each(function () {
                t += "<wfs:Property><wfs:Name>" + this + "</wfs:Name><wfs:Value>" + e[this] + "</wfs:Value></wfs:Property>"
            }), t += '<ogc:Filter><ogc:FeatureId fid="' + e.originFid + '"/></ogc:Filter>', t += "</wfs:Update>", s += t
        }), i = i.replace("{wfs_updates}", s);
        var o = "Failed to save changes to server",
            u = ReplaceTagWithOriginalDomain(this.cleanUrl(this._url), this._subdomains),
            a = Cesium.TrustedServers.contains(u);
        $.ajax({
            dataType: "xml",
            type: "POST",
            data: i,
            xhrFields: {withCredentials: a},
            url: encodeURI(u),
            success: function (e) {
                var n = (new XMLSerializer).serializeToString(e.documentElement).toLowerCase();
                if (n.match(/success\s*\//) == null) {
                    t(o);
                    return
                }
                t()
            },
            error: function (e, n, r) {
                t(o)
            },
            timeout: 1e4
        })
    }, Layer.prototype.getFeatures = function (e, t, n) {
        var r = this, i = [];
        $(this.geomFields).each(function () {
            r.isAttributeField(this.name, this.type) && i.push(this.name)
        });
        var s = "<wfs:GetFeature version='1.0.0' service='WFS' username='' password='' maxFeatures='{REQUEST_MAX_FEATURES}'  xmlns:sfs='http://www.skylineglobe.com/sfs-schema' xmlns:ogc='http://www.opengis.net/ogc' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:wfs='http://www.opengis.net/wfs' xmlns:gml='http://www.opengis.net/gml'> <wfs:Query typeName='{layer_name}'> {wfs_filter}</wfs:Query> </wfs:GetFeature>";
        s = s.replace("{layer_name}", this._layerName), s = s.replace("{REQUEST_MAX_FEATURES}", REQUEST_MAX_FEATURES);
        var o = "";
        if (e.replace(/[ ]/g, "") != "") {
            o = "<ogc:Filter  xmlns:sfs='http://www.skylineglobe.com/sfs-schema' xmlns:ogc='http://www.opengis.net/ogc' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:wfs='http://www.opengis.net/wfs' xmlns:gml='http://www.opengis.net/gml'>";
            var u = r.simpleSqlParser.sql2ast("SELECT * FROM x WHERE " + e);
            o += sqlParserToWfs(u.WHERE, i), o += "</ogc:Filter>"
        }
        s = s.replace("{wfs_filter}", o);
        var a = ReplaceTagWithOriginalDomain(this.cleanUrl(this._url), this._subdomains),
            f = Cesium.TrustedServers.contains(a);
        t.xhr = $.ajax({
            url: encodeURI(a),
            type: "POST",
            data: s,
            dataType: "xml",
            xhrFields: {withCredentials: f},
            success: function (e) {
                var t = isElementNameExists($(e), "FeatureCollection");
                if (!t) {
                    n(null, TELang.i18n("layer_error_reading_features"));
                    return
                }
                var r = parseFeaturesResult(e);
                n(r)
            },
            error: function (e, t, r) {
                n(null, e.statusText)
            },
            timeout: 1e4
        })
    }, Layer.prototype.getFeatureColumnNames = function () {
        if (this.featureColumnNames) return this.featureColumnNames;
        var e = $(this.geometryResponseData).find(this.wfsNamespace + "\\:sequence " + this.wfsNamespace + "\\:element");
        e.length == 0 && (e = $(this.geometryResponseData).find("sequence").find("element"));
        var t = [];
        return e.each(function () {
            var e = $(this);
            e.attr("name").toLowerCase() != "geom" && t.push(e.attr("name").toLowerCase())
        }), this.featureColumnNames = t, this.featureColumnNames
    }, Layer.prototype.refresh = function (e) {
        var t = this._tileManager.getAllTiles(), n = t.length;
        for (var r = 0; r < n; r++) t[r].data.wfsLayerData[this._guid] && t[r].data.wfsLayerData[this._guid].freeResources(), this.loadTile(t[r]);
        return e && initFeatureType(this), this
    }, Layer.prototype.setVisibility = function (e) {
        if (this._visible != e) {
            this._visible = e;
            if (e == 0) {
                var t = this._tileManager.getAllTiles(), n = t.length;
                for (var r = 0; r < n; r++) t[r].data.wfsLayerData[this._guid] && t[r].data.wfsLayerData[this._guid].primitive && (t[r].data.wfsLayerData[this._guid].primitive.show = !1)
            } else {
                var t = this._tileManager.getAllTiles(), n = t.length;
                for (var r = 0; r < n; r++) t[r].data.wfsLayerData[this._guid] && (t[r].data.wfsLayerData[this._guid].primitive ? t[r].data.wfsLayerData[this._guid].primitive.show = !0 : this.loadTile(t[r]))
            }
        }
    }, Layer.prototype.loadTile = function (e) {
        var t = this;
        e.data.wfsLayerData[this._guid] = {
            id: e.data.id, primitive: undefined, freeResources: function () {
                Cesium.defined(this.xhr) && (this.xhr.abort(), this.xhr = undefined), Cesium.defined(this.features) && (t.removeFeaturesFromLayer(this.features), this.features = undefined), Cesium.defined(this.primitive) && (t._tileManager.removeFromScene(this.primitive), this.primitive = undefined)
            }
        }, e.level === this._level && this.show && this.beginLoadWFSData(e)
    }, Layer.prototype.isDestroyed = function () {
        return !1
    }, Layer.prototype.destroy = function () {
        return this._tileManager.removeEventListener(Layer.prototype.loadTile, this), Cesium.destroyObject(this)
    }, Layer.prototype.sTag = function (e, t, n) {
        if (this._subdomains == undefined) return "";
        var r = (e + t + n) % this._subdomains.length;
        return this._subdomains[r]
    }, Layer.prototype.cleanUrl = function (e) {
        return e.indexOf("?") != -1 ? e.split("?")[0] : e
    }, Layer.prototype.beginLoadWFSData = function (e) {
        if (this.latLon != undefined && !this.latLon) return;
        this.BoundingBox != undefined && (this.BoundingBox.width == 0 || this.BoundingBox.height == 0) && (this.BoundingBox.east += 1, this.BoundingBox.north += 1, this.BoundingBox.beenModified = !0);
        if (this.BoundingBox !== undefined && Cesium.Rectangle.intersection(this.BoundingBox, e.rectangle) === undefined) return;
        var t = [DEGREES_PER_RADIAN * e.rectangle.west, DEGREES_PER_RADIAN * e.rectangle.south, DEGREES_PER_RADIAN * e.rectangle.east, DEGREES_PER_RADIAN * e.rectangle.north],
            n = this, r = this.cleanUrl(this._url).replace("{s}", this.sTag(e.x, e.y, e.level));
        r += TerraExplorer.functions.queryStringExist(r), r += "SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&outputFormat=GML2&typeName=" + this._layerName + "&srsName=EPSG:4326" + "&BBOX=" + t.join(",");
        var i = TerraExplorer.internal.Settings.connectionUrl,
            s = Cesium.TrustedServers.contains(ReplaceTagWithOriginalDomain(this._url, this._subdomains)), o = {
                dataType: this._useWorkers ? "text" : "xml",
                url: encodeURI(r),
                cache: !1,
                xhrFields: {withCredentials: s},
                success: function (t) {
                    n.processWFSData(e, t)
                },
                error: function (e, t, n) {
                    n !== "abort" && console.log("Failed to retrieve data from " + r + " :" + n)
                },
                complete: function () {
                    e.data.wfsLayerData !== undefined ? e.data.wfsLayerData[n._guid].xhr = undefined : console.log("wfsdata is undefined - check")
                }
            };
        e.data.wfsLayerData[this._guid].xhr = $.ajax(o)
    };
    var workerPool = new WorkerPool({workerPath: "./js/wfs/featurefetcherworker.js"});
    return Layer.prototype.processWFSData = function (e, t) {
        e.data.wfsLayerData !== undefined && (e.data.wfsLayerData[this._guid].xhr = undefined);
        if (this._useWorkers) {
            var n = this;
            workerPool.queueWorkItem({
                id: e.data.id,
                text: t,
                geometryFieldName: this._geometryFieldName
            }).then(function (e) {
                n.addFeaturesToTile(e)
            })
        } else {
            var r = this._gmlParser.read(t);
            this.addFeaturesToTile({id: e.data.id, features: r})
        }
    }, Layer.prototype.boundingSphereFromGML = function (e, t) {
        var n = viewer.scene.globe._surface.getRenderedBestLevelInfo().bestLevel, r = this;
        workerPool.queueWorkItem({id: "0", text: e, geometryFieldName: this._geometryFieldName}).then(function (e) {
            var i = {
                parentLayer: r,
                features: e.features,
                sampleTerrainLevel: n + 1,
                isQuery: !0,
                onFinishedQuery: function (e) {
                    var n;
                    e.length > 0 && (n = Cesium.BoundingSphere.fromBoundingSpheres(e)), t(n)
                }
            };
            r._entityCreator.createPrimitiveFromWFSFeatures(i)
        })
    }, Layer.prototype.boundingSphereFromFeature = function (e) {
        var t, n = viewer.scene.globe._surface.getRenderedBestLevelInfo().bestLevel, r = {
            parentLayer: this,
            features: [e],
            sampleTerrainLevel: n + 1,
            isQuery: !0,
            onFinishedQuery: function (e) {
                e.length > 0 && (t = Cesium.BoundingSphere.fromBoundingSpheres(e))
            }
        };
        return this._entityCreator.createPrimitiveFromWFSFeatures(r), t
    }, Layer.prototype.addRenderedFeatureId = function (e) {
        this._addedFeatures[e] == undefined && (this._addedFeatures[e] = 0), this._addedFeatures[e]++
    }, Layer.prototype.removeRenderedFeatureId = function (e) {
        this._addedFeatures[e] != undefined && this._addedFeatures[e]--, this._addedFeatures[e] == 0 && (this._addedFeatures[e] = undefined)
    }, Layer.prototype.isExistRenderedFeatureId = function (e) {
        return this._addedFeatures[e] != undefined
    }, Layer.prototype.addFeaturesToTile = function (e, t) {
        var n = this._tileManager.getTile(e.id);
        if (n === undefined) return;
        var r = viewer.scene.globe._surface.getRenderedBestLevelInfo().bestLevel,
            i = t ? n.data.wfsLayerData[this._guid].primitive._instanceIds : undefined, s = this, o = {
                parentLayer: this,
                originalInstanceIds: i,
                features: e.features,
                sampleTerrainLevel: r + 1,
                onFinishedCreatePrimitive: function (r) {
                    if (e.features == undefined || n.data.wfsLayerData == undefined) return;
                    n.data.wfsLayerData[s._guid].features = e.features, t || s.addFeaturesToLayer(n.data.wfsLayerData[s._guid].features);
                    if (r.length === undefined || r.length > 0) {
                        var i = n.data.wfsLayerData[s._guid].primitive;
                        r.show = s.show, n.data.wfsLayerData[s._guid].primitive = r, r.parentLayer = s, r.parentTileId = e.id, r._guid = Cesium.createGuid(), t ? s._tileManager.replaceInScene(i, r) : s._tileManager.addToScene(r)
                    }
                }
            }, u = n.data.wfsLayerData[s._guid].primitive;
        t && u !== undefined && u.type === "pointPrimitive" ? u.updatePositions !== undefined && u.updatePositions() : this._entityCreator.createPrimitiveFromWFSFeatures(o)
    }, Layer.prototype.addFeaturesToLayer = function (e) {
        this._statistics.numberOfAddedFeatures += e.length, this._statistics.numberOfAddePositions += Cesium.defaultValue(e.numPositions, 0);
        var t = e.length;
        for (var n = 0; n < t; n++) Object.prototype.hasOwnProperty.call(this._featuresMap, e[n].fid) === !1 ? this._featuresMap[e[n].fid] = {
            refCount: 1,
            feature: e[n]
        } : this._featuresMap[e[n].fid].refCount++
    }, Layer.prototype.removeFeaturesFromLayer = function (e) {
        this._statistics.numberOfDeletedFeatures += e.length, this._statistics.numberOfDeletedPositions += Cesium.defaultValue(e.numPositions, 0);
        var t = e.length;
        for (var n = 0; n < t; n++) {
            if (Object.prototype.hasOwnProperty.call(this._featuresMap, e[n].fid) === !1) continue;
            this._featuresMap[e[n].fid].refCount--, this._featuresMap[e[n].fid].refCount === 0 && delete this._featuresMap[e[n].fid]
        }
    }, Layer.prototype.getFeature = function (e) {
        return Object.prototype.hasOwnProperty.call(this._featuresMap, e) === !1 ? null : this._featuresMap[e]
    }, Layer.prototype.updateTile = function (e) {
        var t = this._tileManager.getTile(e);
        if (t === undefined) return;
        t.data.wfsLayerData[this._guid].features == undefined ? this.loadTile(t) : this.addFeaturesToTile(t.data.wfsLayerData[this._guid], !0)
    }, Layer.blockRequestPrimitiveFromPrimitive = function (e) {
        if (e == undefined) return undefined;
        var t = internalBlockRequestPrimitiveFromPrimitive(e);
        return t != undefined ? t : (e._labelCollection && e._labelCollection._billboardCollection ? t = internalBlockRequestPrimitiveFromPrimitive(e._labelCollection._billboardCollection) : e._billboardCollection && (t = internalBlockRequestPrimitiveFromPrimitive(e._billboardCollection)), t)
    }, Layer.prototype.resetAttributesTable = function () {
        this.lastEditedCell = null, this.attrTblDialogMemo = null
    }, Layer
}), define("internal/Navigate", ["jquery", "jquery.plugs", "./FlyAround", "./TEPosition", "./GeometryHelper", "./NotificationCenter", "./InputMode", "wfs/TileManager", "wfs/Layer"], function (e, t, n, r, i, s, o, u, a) {
    "use strict";

    function v(e) {
        var t = 0, n = 0;
        do isNaN(e.offsetLeft) || (t += e.offsetLeft), isNaN(e.offsetTop) || (n += e.offsetTop); while (e = e.offsetParent);
        return {left: t, top: n}
    }

    function m(e) {
        var t = v(document.getElementById(window.divId));
        e.normalizedTouchCoordX = e.clientX - t.left, e.normalizedTouchCoordY = e.clientY - t.top
    }

    function g(t) {
        var n = {};
        e.extend(n, t._inputFlags), t.stop(), t._inputFlags = n
    }

    function x(e, t) {
        var n = t.complete;
        t.complete = function () {
            e._flyToStartPosition = null, n && n()
        }, t.complete != undefined && t.duration > .2 && (e._flyToStartPosition = viewer.camera.position.clone(), setTimeout(function () {
            e._flyToStartPosition !== null && e._flyToStartPosition.equalsEpsilon(viewer.camera.position, 0, 1e-7) && (e.stop(), t.complete())
        }, 200))
    }

    var f = 1, l = 0, c = new Cesium.Cartesian3;
    const h = 6371010, p = 64;
    var d = function () {
        this._currentNavigationMode = 3, this._prevOnFrameTime = 0, this._Movement = null, this._flyToStartPosition = null, this._groundHeightAtCameraPosition = 0, this._floorHeightAtCameraPosition = 0, this._keyboardTurnSpeed = Cesium.Math.toRadians(20), this._minAltitudeAboveGround = 1, this._leftMouseDragParameters = {
            rotationAxis: undefined,
            rotationAngle: undefined,
            drageSphere: undefined
        }, this._prevFramePosition = null, this._useCesiumDrag = !1, this.horizonCullingDistance = 1e7, this.NavigationMode = {
            FREE_FLIGHT: 0,
            DRAG: 1,
            DRAG_ROTATE: 2,
            FLY_TO: 3
        }, this._navigationMode = this.NavigationMode.FREE_FLIGHT, this._inputFlags = {
            moveForward: !1,
            moveBackward: !1,
            moveUp: !1,
            moveDown: !1,
            moveLeft: !1,
            moveRight: !1,
            lookUp: !1,
            lookDown: !1,
            turnLeft: !1,
            turnRight: !1,
            controlKey: !1,
            leftMouseButton: !1,
            middleButton: !1,
            rightButton: !1,
            isTouch: !1
        }, this._screenSpaceEventHandler = undefined, this._enableShortLeftClickWhileDrag = !0, this._mouseDownStartTime = undefined, this._mousePosition = undefined, this._downMousePosition = undefined, this._prevFrameMousePosition = undefined, this._downMouseCameraPosition = undefined, this._downMouseCameraHeading = undefined, this._downMouseCameraPitch = undefined, this._rotateDirX = 0, this._rotateDirY = 0, this._northOnly = !1, this._useLinearFrustum = !1, this._draggingEvent = new Cesium.Event, this._twoPointersGestureStart = !1, this._startTouches = undefined, this._currentTouches = undefined, this._rotateAndZoom = !1, this._rotateAndPitch = !1, this._startRotateAngle = 0, this._pitchAngleFactor = 0, this._zoomFactor = 1, this._prevFrameZoomFactor = undefined, this._rotateAngle = 0, this._prevFrameRotateAngle = undefined, this._pitchRotateDirY = 0, this._prevFramePitchRotateDirY = undefined, this._pitchRotateDirX = 0, this._prevFramePitchRotateDirX = undefined, this._multiGestureNavigationTime = 0, this._downMouseTerrainPosition = undefined, this._dragRotateMarker = {
            ring: undefined,
            topCone: undefined,
            icon: undefined,
            alpha: .6,
            enableDragRotateMarker: !0,
            useIconMarker: !0,
            hide: function () {
                if (this.useIconMarker) this.icon != undefined && (this.icon.show = !1); else {
                    if (this.ring == undefined) return;
                    viewer.entities.remove(this.ring), this.ring = undefined, viewer.entities.remove(this.topCone), this.topCone = undefined
                }
            },
            show: function (e, t) {
                if (!this.enableDragRotateMarker) return;
                this.alpha = Cesium.defaultValue(t, this.useIconMarker ? 1 : .6), this.useIconMarker ? this.icon == undefined ? this.createIcon(e) : (this.icon.show = !0, this.icon.position = e) : (this.createRing(e), this.createCone(e))
            },
            isVisible: function () {
                return this.useIconMarker ? this.icon ? this.icon.show : !1 : this.ring != undefined
            },
            createIcon: function (e) {
                this.icon = viewer.entities.add({
                    position: e,
                    billboard: {
                        image: "./img/places.png",
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        scale: .7,
                        eyeOffset: Cesium.DynamicEyeOffset()
                    }
                })
            },
            markerSizeFactor: 36,
            createRing: function (e) {
                if (this.ring != undefined) return;
                var t = Cesium.Cartesian3.distance(e, viewer.camera.position), n = this.markerSizeFactor,
                    r = new Cesium.CircleOutlineGeometry({center: e, radius: t / n}),
                    i = Cesium.CircleOutlineGeometry.createGeometry(r), s = i.attributes.position.values, o = [];
                for (var u = 0; u < s.length - 2; u += 3) o.push(new Cesium.Cartesian3(s[u], s[u + 1], s[u + 2]));
                var a = new Cesium.CircleOutlineGeometry({center: e, radius: t / (n * 1.2)});
                i = Cesium.CircleOutlineGeometry.createGeometry(a), s = i.attributes.position.values;
                var f = [];
                for (var u = 0; u < s.length - 2; u += 3) f.push(new Cesium.Cartesian3(s[u], s[u + 1], s[u + 2]));
                this.ring = viewer.entities.add({
                    name: "ring",
                    position: e,
                    polygon: {
                        hierarchy: {positions: o, holes: [{positions: f}]},
                        height: viewer.scene.globe.ellipsoid.cartesianToCartographic(e).height,
                        material: Cesium.Color.WHITE.withAlpha(this.alpha),
                        outline: !0,
                        outlineColor: Cesium.Color.WHITE.withAlpha(this.alpha == 0 ? 0 : 1)
                    }
                })
            },
            createCone: function (e) {
                if (this.topCone != undefined) return;
                var t = this.markerSizeFactor * 1.28, n = Cesium.Cartesian3.distance(e, viewer.camera.position),
                    r = n / t, i = new Cesium.Matrix4;
                Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(e), new Cesium.Cartesian3(0, 0, r * .5), i);
                var s = new Cesium.Cartesian3;
                Cesium.Matrix4.getTranslation(i, s), this.topCone = viewer.entities.add({
                    name: "topCone",
                    position: s,
                    cylinder: {
                        length: r,
                        topRadius: n / (t * 4.45),
                        bottomRadius: 0,
                        material: Cesium.Color.WHITE.withAlpha(this.alpha),
                        outline: !0,
                        outlineColor: Cesium.Color.WHITE.withAlpha(this.alpha == 0 ? 0 : 1)
                    }
                })
            }
        }
    };
    d.prototype.DEFAULT_FLY_TO_DURATION = 6, d.prototype.MAX_ALTITUDE = 1e8, Cesium.defineProperties(d.prototype, {
        CurrentNavigationMode: {
            get: function () {
                return this._currentNavigationMode
            }, set: function (e) {
                if (e < 1 || e > 3) {
                    console.error("navigation mode can only be set to one of the three options: 1 - '2d north',2-'2d',3-'3d'");
                    return
                }
                this._currentNavigationMode = e
            }
        }, GroundHeightAtCameraPosition: {
            get: function () {
                return this._groundHeightAtCameraPosition
            }
        }, HeightAboveGround: {
            get: function () {
                return viewer.camera.positionCartographic.height - this._groundHeightAtCameraPosition
            }
        }, HeightAboveGround_HitTest: {
            get: function () {
                return viewer.camera.positionCartographic.height - this._floorHeightAtCameraPosition
            }
        }, KeyboardTurnSpeed: {
            get: function () {
                return this._keyboardTurnSpeed
            }, set: function (e) {
                this._keyboardTurnSpeed = e
            }
        }, MinAltitudeAboveGround: {
            get: function () {
                return this._minAltitudeAboveGround
            }, set: function (e) {
                this._minAltitudeAboveGround = e
            }
        }, Mode: {
            get: function () {
                return this._navigationMode
            }
        }, EnableShortLeftClickWhileDrag: {
            get: function () {
                return o.Mode != o.MEASUREMENT && this._enableShortLeftClickWhileDrag
            }, set: function (e) {
                this._enableShortLeftClickWhileDrag = e
            }
        }, EnableDragRotateMarker: {
            get: function () {
                return this._dragRotateMarker.enableDragRotateMarker
            }, set: function (e) {
                this._dragRotateMarker.enableDragRotateMarker = e
            }
        }, IsMultiGestureNavigation: {
            get: function () {
                return Date.now() - this._multiGestureNavigationTime < 500
            }
        }, NorthOnly: {
            get: function () {
                return this._northOnly
            }, set: function (e) {
                this._northOnly = e
            }
        }, UseLinearFrustum: {
            get: function () {
                return this._useLinearFrustum
            }, set: function (e) {
                this._useLinearFrustum = e
            }
        }
    }), d.prototype.init = function () {
        function u(e) {
            switch (e) {
                case"Q".charCodeAt(0):
                    return "moveLeft";
                case"W".charCodeAt(0):
                    return "moveRight";
                case"S".charCodeAt(0):
                    return "zoomIn";
                case"X".charCodeAt(0):
                    return "zoomOut";
                case"A".charCodeAt(0):
                    return "moveUp";
                case"Z".charCodeAt(0):
                    return "moveDown";
                case" ".charCodeAt(0):
                    return "stop";
                case 37:
                    return "turnLeft";
                case 39:
                    return "turnRight";
                case 38:
                    return "lookUp";
                case 40:
                    return "lookDown";
                case 17:
                    return "controlKey";
                default:
                    return undefined
            }
        }

        function f(e, t) {
            var n = e.x * t.x + e.y * t.y + 0, r = Math.sqrt(e.x * e.x + e.y * e.y + 0),
                i = Math.sqrt(t.x * t.x + t.y * t.y + 0), s = 0, o = r * i;
            if (o == 0) s = 0; else {
                var u = n / o;
                u = Math.max(-1, Math.min(1, u));
                var a = Math.acos(u);
                isNaN(a) && (a = 0), a *= 180 / Cesium.Math.PI, s = a
            }
            return s
        }

        function l(t) {
            if (t._twoPointersGestureStart == 0) return;
            var n = t._startTouches[0], r = t._currentTouches[0], i = t._startTouches[1], s = t._currentTouches[1],
                o = {
                    x: r.normalizedTouchCoordX - n.normalizedTouchCoordX,
                    y: r.normalizedTouchCoordY - n.normalizedTouchCoordY
                }, u = {
                    x: s.normalizedTouchCoordX - i.normalizedTouchCoordX,
                    y: s.normalizedTouchCoordY - i.normalizedTouchCoordY
                }, a = Math.sqrt(o.x * o.x + o.y * o.y), l = Math.sqrt(u.x * u.x + u.y * u.y);
            if (a + l > 40) {
                t._startRotateAngle = h(s, r);
                var c = Math.abs(r.normalizedTouchCoordX - s.normalizedTouchCoordX),
                    p = Math.abs(r.normalizedTouchCoordY - s.normalizedTouchCoordY);
                if (p > 3 * c) {
                    t._twoPointersGestureStart = !1, t._rotateAndZoom = !0, t._rotateAndPitch = !1;
                    return
                }
                t._startTouches = e.extend(!0, {}, t._currentTouches);
                var d = f(o, u);
                d < 60 && a != 0 && l != 0 ? (t._rotateAndZoom = !1, t._rotateAndPitch = !0) : (t._rotateAndZoom = !0, t._rotateAndPitch = !1), t._twoPointersGestureStart = !1
            }
            return
        }

        function c(e) {
            var t = e._startTouches[0], n = e._currentTouches[0], r = e._startTouches[1], i = e._currentTouches[1],
                s = r.normalizedTouchCoordX - t.normalizedTouchCoordX,
                o = r.normalizedTouchCoordY - t.normalizedTouchCoordY, u = Math.sqrt(s * s + o * o),
                a = i.normalizedTouchCoordX - n.normalizedTouchCoordX,
                f = i.normalizedTouchCoordY - n.normalizedTouchCoordY, l = Math.sqrt(a * a + f * f);
            l == 0 && (l = 1e-6);
            var c = u / l;
            return c
        }

        function h(e, t) {
            var n = {x: 100, y: 0}, r = {x: 0, y: 100}, i = {
                x: t.normalizedTouchCoordX - e.normalizedTouchCoordX,
                y: t.normalizedTouchCoordY - e.normalizedTouchCoordY
            }, s = f(n, i), o = f(r, i), u = Math.abs(o) > 90 ? s : 360 - s;
            return u
        }

        function p(e) {
            var t = e._currentTouches[0], n = e._currentTouches[1], r = h(n, t);
            return r -= e._startRotateAngle, r
        }

        function d(e) {
            var t = e._startTouches[0], n = e._currentTouches[0], r = e._startTouches[1], i = e._currentTouches[1],
                s = (i.clientY + n.clientY) / 2, o = (r.clientY + t.clientY) / 2, u = s - o;
            return u /= 700, u
        }

        var t = viewer.scene, n = viewer.canvas;
        n.setAttribute("tabindex", "0"), n.onclick = function () {
            n.focus()
        };
        var r = this;
        e(n).focusout(function () {
            r.clearInput(), a.resetCursor()
        });
        var i = viewer.scene.globe.ellipsoid;
        viewer.scene.screenSpaceCameraController.maximumZoomDistance = this.MAX_ALTITUDE, t.screenSpaceCameraController.enableRotate = this._useCesiumDrag, t.screenSpaceCameraController.enableTranslate = !1, t.screenSpaceCameraController.enableZoom = !1, t.screenSpaceCameraController.enableTilt = !1, t.screenSpaceCameraController.enableLook = !1, viewer.scene.preRender.addEventListener(this.onPreFrame, this);
        var a = this;
        document.addEventListener("keydown", function (e) {
            if (e.target == n || e.target == document.body) {
                var t = u(e.keyCode);
                typeof t != "undefined" && (a._inputFlags[t] = !0, a._inputFlags.controlKey && a._inputFlags.leftMouseButton == 0 && a.setCursor("./img/OpenHandDragRotate.png"))
            }
        }, !1), document.addEventListener("keyup", function (e) {
            if (e.target == n || e.target == document.body) {
                var t = u(e.keyCode);
                typeof t != "undefined" && (a._inputFlags[t] = !1, a._inputFlags.controlKey == 0 && a._inputFlags.leftMouseButton == 0 && a.resetCursor())
            }
        }, !1), this._screenSpaceEventHandler = new Cesium.ScreenSpaceEventHandler(n), this._screenSpaceEventHandler.setInputAction(function (e) {
            viewer.trackedEntity = undefined
        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);
        var v = 0;
        e("#cesiumContainer").on("touchstart", e.proxy(function (t) {
            t.preventDefault();
            if (t.target != viewer.scene.canvas) return;
            var n = (new Date).getTime(), r = n - v < 300 && t.originalEvent.touches.length == 1;
            v = n, this._inputFlags.isTouch = !0;
            if (r) {
                m(t.originalEvent.touches[0]), this.doubleClickHandler({position: new Cesium.Cartesian3(t.originalEvent.touches[0].normalizedTouchCoordX, t.originalEvent.touches[0].normalizedTouchCoordY)});
                return
            }
            this._currentTouches = t.originalEvent.targetTouches;
            for (var i in this._currentTouches) isNaN(i) || m(this._currentTouches[i]);
            this._startTouches = e.extend(!0, {}, this._currentTouches), this._currentTouches.length == 2 && (this._rotateAndZoom = !1, this._rotateAndPitch = !1, this._twoPointersGestureStart = !0, this._prevFrameRotateAngle = undefined, this._prevFrameZoomFactor = undefined, this._prevFramePitchRotateDirY = undefined), this.initMouseDownParametersTouch(t, "touchStart")
        }, this)), e("#cesiumContainer").on("touchcancel", e.proxy(function () {
            this._inputFlags.isTouch = !1
        }), this), e("canvas").on("touchend", e.proxy(function (t) {
            t.preventDefault(), TerraExplorer.isMobile() && TerraExplorer.tools.SideBar.IsShown && e("#sideBar #closeXID").click()
        }, this)), e("#cesiumContainer").on("touchend", e.proxy(function (e) {
            e.preventDefault(), this._inputFlags.isTouch = !1, this.resetMouseDownParameters(e, "touchEnd")
        }, this)), e("#cesiumContainer").on("touchmove", e.proxy(function (e) {
            e.preventDefault(), this._currentTouches = e.originalEvent.targetTouches;
            for (var t in this._currentTouches) isNaN(t) || m(this._currentTouches[t]);
            this._currentTouches.length > 1 && (this._multiGestureNavigationTime = Date.now());
            if (this._currentTouches.length == 2) {
                if (this._twoPointersGestureStart) l(this); else if (this._rotateAndZoom) this._zoomFactor = c(this), this._rotateAngle = p(this), this._prevFrameRotateAngle == undefined && (this._prevFrameRotateAngle = this._rotateAngle), this._prevFrameZoomFactor == undefined && (this._prevFrameZoomFactor = this._zoomFactor); else if (this._rotateAndPitch) {
                    this._pitchAngleFactor = d(this);
                    var n = {
                        x: (this._startTouches[0].normalizedTouchCoordX + this._startTouches[1].normalizedTouchCoordX) / 2,
                        y: (this._startTouches[0].normalizedTouchCoordY + this._startTouches[1].normalizedTouchCoordY) / 2
                    }, r = {
                        x: (this._currentTouches[0].normalizedTouchCoordX + this._currentTouches[1].normalizedTouchCoordX) / 2,
                        y: (this._currentTouches[0].normalizedTouchCoordY + this._currentTouches[1].normalizedTouchCoordY) / 2
                    };
                    this._pitchRotateDirX = r.x - n.x, this._pitchRotateDirY = r.y - n.y, this._prevFramePitchRotateDirX == undefined && (this._prevFramePitchRotateDirX = this._pitchRotateDirX), this._prevFramePitchRotateDirY == undefined && (this._prevFramePitchRotateDirY = this._pitchRotateDirY)
                }
            } else if (this._twoPointersGestureStart || this._rotateAndZoom || this._rotateAndPitch) this._rotateAndZoom = !1, this._rotateAndPitch = !1
        }, this)), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            o.Mode != o.CLIENT && this.initMouseDownParameters(e, Cesium.ScreenSpaceEventType.LEFT_DOWN)
        }, this), Cesium.ScreenSpaceEventType.LEFT_DOWN), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            this.initMouseDownParameters(e, Cesium.ScreenSpaceEventType.LEFT_DOWN)
        }, this), Cesium.ScreenSpaceEventType.LEFT_DOWN, Cesium.KeyboardEventModifier.CTRL), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            this.resetMouseDownParameters(e, Cesium.ScreenSpaceEventType.LEFT_UP)
        }, this), Cesium.ScreenSpaceEventType.LEFT_UP), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            this.resetMouseDownParameters(e, Cesium.ScreenSpaceEventType.LEFT_UP)
        }, this), Cesium.ScreenSpaceEventType.LEFT_UP, Cesium.KeyboardEventModifier.CTRL), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            o.Mode != o.CLIENT && this.initMouseDownParameters(e, Cesium.ScreenSpaceEventType.MIDDLE_DOWN)
        }, this), Cesium.ScreenSpaceEventType.MIDDLE_DOWN), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            this.initMouseDownParameters(e, Cesium.ScreenSpaceEventType.MIDDLE_DOWN)
        }, this), Cesium.ScreenSpaceEventType.MIDDLE_DOWN, Cesium.KeyboardEventModifier.CTRL), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            this.resetMouseDownParameters(e, Cesium.ScreenSpaceEventType.MIDDLE_UP)
        }, this), Cesium.ScreenSpaceEventType.MIDDLE_UP), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            this.resetMouseDownParameters(e, Cesium.ScreenSpaceEventType.MIDDLE_UP)
        }, this), Cesium.ScreenSpaceEventType.MIDDLE_UP, Cesium.KeyboardEventModifier.CTRL), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            o.Mode != o.CLIENT && (this._mousePosition = e.endPosition, this.handleObjectsTooltip())
        }, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE), this._screenSpaceEventHandler.setInputAction(e.proxy(function (e) {
            this._mousePosition = e.endPosition
        }, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE, Cesium.KeyboardEventModifier.CTRL), this._screenSpaceEventHandler.setInputAction(e.proxy(this.zoom, this), Cesium.ScreenSpaceEventType.WHEEL), this._screenSpaceEventHandler.setInputAction(e.proxy(this.doubleClickHandler, this), Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK), this.resetCursor(), s.addObserver(this, "toolContainerVisibilityChanged", "TEN_TOOL_CONTAINER_VISIBILITY_CHANGED", null), this._dragRotateMarker.show(Cesium.Cartesian3.ZERO);
        var g = e("<div class='tooltip' id='TooltipDiv'></div>").disableSelection();
        e("#" + window.divId).append(g), e("#TooltipDiv").hide()
    }, d.prototype.setCursor = function (t) {
        TerraExplorer.tools.ToolContainer.IsVisible ? this.resetCursor() : e(viewer.container).css({cursor: "url(" + t + ") 16 16, pointer"})
    }, d.prototype.resetCursor = function () {
        if (TerraExplorer.tools.ToolContainer.IsVisible && TerraExplorer.tools.ToolContainer.IsQuery) return;
        TerraExplorer.tools.ToolContainer.IsVisible ? e(viewer.container).css({cursor: ""}) : this.setCursor("./img/OpenHand.png")
    }, d.prototype.toolContainerVisibilityChanged = function (e) {
        this.resetCursor()
    }, d.prototype.initMouseDownParametersTouch = function (e, t) {
        var n = new Cesium.Cartesian3(this._startTouches[0].normalizedTouchCoordX, this._startTouches[0].normalizedTouchCoordY);
        this._startTouches.length == 2 && (n.x = (this._startTouches[0].normalizedTouchCoordX + this._startTouches[1].normalizedTouchCoordX) / 2, n.y = (this._startTouches[0].normalizedTouchCoordY + this._startTouches[1].normalizedTouchCoordY) / 2), this.initMouseDownParameters({position: n}, t)
    }, d.prototype.zoom = function (e) {
        e === undefined && (e = 0);
        if (this._navigationMode != this.NavigationMode.FREE_FLIGHT) return;
        var t = viewer.scene.canvas.width / 2, n = viewer.scene.canvas.height / 2,
            r = viewer.scene.screenToWorld(Cesium.Cartesian2.fromElements(t, n));
        if (r != undefined) {
            var i = Cesium.Cartesian3.distance(r, viewer.camera.position),
                s = Cesium.Math.sign(e) * i / (this.HeightAboveGround > 7e3 ? 4 : 6);
            viewer.scene.undergroundMode && (s = Cesium.Math.sign(e) * Math.max(10, Math.abs(s))), viewer.camera.zoomIn(s), s < 0 && viewer.camera.positionCartographic.height > this.MAX_ALTITUDE && viewer.camera.zoomIn(-s)
        } else {
            var s = Cesium.Math.sign(e) * Math.max(10, this.HeightAboveGround) / 4;
            viewer.camera.move(viewer.camera.direction, s)
        }
    }, d.prototype.doubleClickHandler = function (e) {
        if (TerraExplorer.internal.DrawingTool.Active) return;
        var t = e.position, n = viewer.scene.screenToWorld(t);
        if (n == undefined) return;
        var r = Cesium.Cartesian3.distance(n, viewer.camera.position);
        this.flyToCartesian(n, r / 4)
    }, d.prototype.initMouseDownParameters = function (e, t) {
        g(this), t == Cesium.ScreenSpaceEventType.LEFT_DOWN ? (TerraExplorer.tools.ToolManager._tools.Rotate.close(), this._inputFlags.leftMouseButton = !0, this.setCursor(this._inputFlags.controlKey ? "./img/CloseHandDragRotate.png" : "./img/CloseHand.png")) : t == Cesium.ScreenSpaceEventType.MIDDLE_DOWN && (this._inputFlags.middleMouseButton = !0), this._mouseDownStartTime = new Date, this._mousePosition = this._downMousePosition = Cesium.Cartesian3.clone(e.position), this._prevFrameMousePosition = this._mousePosition.clone(), this._downMouseCameraPosition = viewer.camera.position.clone(), this._downMouseCameraHeading = viewer.camera.heading, this._downMouseCameraPitch = viewer.camera.pitch, this._rotateDirX = 0, this._rotateDirY = 0, l = 0, this._dragRotateMarker.isVisible() && this._dragRotateMarker.hide();
        var n = {pickPrimitive: undefined};
        this._downMouseTerrainPosition = viewer.scene.screenToWorld(this._downMousePosition, n), this._leftMouseDragParameters.dragSphere = this._downMouseTerrainPosition ? new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO, Cesium.Cartesian3.magnitude(this._downMouseTerrainPosition)) : undefined
    }, d.prototype.resetMouseDownParameters = function (e, t) {
        t == Cesium.ScreenSpaceEventType.LEFT_UP || t == "touchEnd" ? (this._inputFlags.leftMouseButton = !1, this._draggingEvent.raiseEvent(!1)) : t == Cesium.ScreenSpaceEventType.MIDDLE_UP && (this._inputFlags.middleMouseButton = !1), this.resetCursor(), this._downMouseTerrainPosition = undefined, this._dragRotateMarker.hide(), this._navigationMode == this.NavigationMode.DRAG && (this._Movement = new T(this._leftMouseDragParameters.rotationAxis, this._leftMouseDragParameters.rotationAngle)), this._navigationMode = this.NavigationMode.FREE_FLIGHT, viewer.scene.screenSpaceCameraController.enableRotate = this._useCesiumDrag, TerraExplorer.tools.SideBar.IsOccupyLargeScreenPortion && TerraExplorer.isTouch() && t === "touchEnd" && Date.now() - this._mouseDownStartTime < 150 && TerraExplorer.tools.SideBar.Hide()
    }, d.prototype.isShortLeftClick = function () {
        return l <= 6 || Date.now() - this._mouseDownStartTime < 100
    }, d.prototype.onPreFrame = function (t, n) {
        var r = this;
        f = Cesium.JulianDate.secondsDifference(n, this._prevOnFrameTime), this._prevOnFrameTime = n;
        if (t.mode == Cesium.SceneMode.MORPHING) return;
        var i = viewer.camera.positionCartographic, s = t.globe.getHeight(i);
        this._groundHeightAtCameraPosition = s || this._groundHeightAtCameraPosition, Cesium.sampleRenderedData([i], 8).then(function (e) {
            var t = e[0].height;
            t !== 65535 ? r._floorHeightAtCameraPosition = t : r._floorHeightAtCameraPosition = r._groundHeightAtCameraPosition
        }), TerraExplorer.groundCollisionDetection && this.handleHitGround(), this.updateHorizonCulling(), this.handleMovement(), this.handleKeys(), this.handleMouseDrag(), TerraExplorer.disable_enforceZeroRoll || this.enforceZeroRoll(), this.handleStreamSpeed(), this.updateRelativeToTerrainPrimitives(t.frameState), this.handleUndergroundSurface(), this._useLinearFrustum && (viewer.scene.logarithmicDepthBuffer = !1), this._northOnly && viewer.camera.setView({orientation: {heading: 0}});
        if (TerraExplorer.disableOptimizationOnB3dm === undefined) {
            var o = [],
                u = viewer.camera.frustum.computeCullingVolume(viewer.camera.position, viewer.camera.direction, viewer.camera.up);
            e(TerraExplorer.internal.Project.MeshLayers).each(function (e, t) {
                t.ready && u.computeVisibility(t.boundingSphere) != Cesium.Intersect.OUTSIDE && o.push(t)
            });
            var a = e.grep(o, function (e) {
                return e.rootFloorAdded !== undefined
            });
            TerraExplorer.isMobile() && a.length > 0 ? viewer.scene.globe.depthTestAgainstTerrain = !1 : TerraExplorer.unlockDepthTestAgainstTerrain === undefined && (viewer.scene.globe.depthTestAgainstTerrain = !0), o.length > 0 ? (TerraExplorer.currentSSE === undefined && (TerraExplorer.currentSSE = viewer.scene.globe.maximumScreenSpaceError), e(o).each(function (e, t) {
                t.rootFloorPolygon !== undefined && TerraExplorer.currentSSE < p && TerraExplorer.internal.Engine.isCameraInsideMeshFloorPolygon(t) ? t.dynamicScreenSpaceError = !0 : TerraExplorer.currentSSE !== undefined && (t.dynamicScreenSpaceError = !1)
            })) : TerraExplorer.currentSSE !== undefined && (TerraExplorer.currentSSE = undefined)
        }
        this._mousePosition && (this._prevFrameMousePosition = this._mousePosition.clone()), this._prevFramePosition = viewer.camera.position.clone()
    };
    var y = {
        frameInterval: 60, terrainChangedDuringInterval: 0, getRelativeHeightCommand: function (t) {
            var n = e.grep(t, function (e) {
                if (e._owner) {
                    var t, n = a.blockRequestPrimitiveFromPrimitive(e._owner);
                    n && (t = n.parentLayer);
                    if (t != undefined && (t.Style.altitudeMethod === TerraExplorer.internal.TEPosition.ATC_TERRAIN_RELATIVE || t.Style.altitudeMethod === TerraExplorer.internal.TEPosition.ATC_3DML_RELATIVE)) return !0
                }
                return !1
            });
            return n
        }, getPrimitivesFromCommands: function (t) {
            var n = e.map(t, function (e) {
                return e._owner._guid ? e._owner : e._owner._parentCollection && e._owner._parentCollection._guid ? e._owner._parentCollection : e._owner.primitive && e._owner.primitive._parentCollection && e._owner.primitive._parentCollection._guid ? e._owner.primitive._parentCollection : undefined
            }).reduce(function (e, t) {
                for (var n in e) if (t._guid == e[n]._guid) return e;
                return e.push(t), e
            }, []);
            return n
        }, preFrame: function () {
            var e = viewer.scene.globe._surface;
            e._tileLoadQueueMedium.length > 0 && this.terrainChangedDuringInterval < this.frameInterval ? this.terrainChangedDuringInterval++ : e._tileLoadQueueMedium.length == 0 && this.terrainChangedDuringInterval > 0 && this.terrainChangedDuringInterval--
        }, getRelativeHeightPrimitivesForUpdate: function (e) {
            this._meshprogressCount = Cesium.Cesium3DTileset.progressCount;
            var t = this.getRelativeHeightCommand(e);
            return t != undefined && t.length > 0 ? this.getPrimitivesFromCommands(t) : []
        }, _meshprogressCount: 0, meshChangedDuringInterval: function () {
            return this._meshprogressCount < Cesium.Cesium3DTileset.progressCount
        }, canUpdate: function (e, t) {
            return e % this.frameInterval == 0 && t <= 6e4 && (this.terrainChangedDuringInterval > 0 || this.meshChangedDuringInterval()) ? !0 : !1
        }
    };
    d.prototype.updateHorizonCulling = function () {
        this.HeightAboveGround > 0 ? this.horizonCullingDistance = Math.sqrt(Math.pow(h + this.HeightAboveGround, 2) - Math.pow(h, 2)) : viewer.scene.undergroundMode && (this.horizonCullingDistance = 500)
    }, d.prototype.updateRelativeToTerrainPrimitives = function (e) {
        y.preFrame();
        if (y.canUpdate(e.frameNumber, this.HeightAboveGround)) {
            var t = y.getRelativeHeightPrimitivesForUpdate(e.commandList);
            for (var n = 0; n < t.length; n++) {
                var r = t[n];
                r.parentLayer == undefined && (r = r._parentCollection), r.parentLayer.updateTile(r.parentTileId)
            }
        }
    }, d.prototype.handleMouseDrag = function () {
        var e = (this._rotateAndPitch || this._rotateAndZoom) && this._currentTouches && this._currentTouches.length == 2;
        this._inputFlags.leftMouseButton && this._inputFlags.controlKey || this._inputFlags.middleMouseButton || e ? (this._navigationMode = this.NavigationMode.DRAG_ROTATE, this.handleMiddleButtonDrag()) : this._inputFlags.leftMouseButton && !this._inputFlags.controlKey && !this._inputFlags.middleMouseButton && (this._navigationMode = this.NavigationMode.DRAG, this.handleLeftButtonDrag())
    };
    var b;
    d.prototype.handleLeftButtonDrag = function () {
        if (this._prevFrameMousePosition == undefined) return;
        l++;
        if (this._navigationMode == this.NavigationMode.DRAG && !this._useCesiumDrag) {
            if (this.isShortLeftClick() && !this.EnableShortLeftClickWhileDrag) return;
            if (this._mousePosition.equals(this._prevFrameMousePosition)) {
                this._leftMouseDragParameters.rotationAngle = 0;
                return
            }
            var e = {pickPrimitive: undefined}, t;
            if (!this._leftMouseDragParameters.dragSphere) t = viewer.scene.screenToWorld(this._prevFrameMousePosition, e); else {
                var n = viewer.camera.getPickRay(this._prevFrameMousePosition),
                    r = Cesium.IntersectionTests.raySphere(n, this._leftMouseDragParameters.dragSphere), i = undefined;
                r != undefined && (i = r.start != 0 ? r.start : r.stop), t = i != undefined ? Cesium.Ray.getPoint(n, i) : undefined
            }
            if (t == undefined) {
                if (b == undefined) return;
                t = Cesium.IntersectionTests.rayPlane(viewer.camera.getPickRay(this._prevFrameMousePosition), b);
                if (t == undefined) return
            }
            var s;
            if (!this._leftMouseDragParameters.dragSphere) s = viewer.scene.screenToWorld(this._mousePosition, e); else {
                n = viewer.camera.getPickRay(this._mousePosition), r = Cesium.IntersectionTests.raySphere(n, this._leftMouseDragParameters.dragSphere);
                var i = undefined;
                r != undefined && (i = r.start != 0 ? r.start : r.stop), s = i != undefined ? Cesium.Ray.getPoint(n, i) : undefined
            }
            if (s == undefined) {
                if (b == undefined) return;
                s = Cesium.IntersectionTests.rayPlane(viewer.camera.getPickRay(this._mousePosition), b);
                if (s == undefined) return
            } else {
                var o = Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(s, viewer.camera.position, c), c);
                b = Cesium.Plane.fromPointNormal(s, o)
            }
            var u = Cesium.Cartesian3.normalize(s, new Cesium.Cartesian3),
                a = Cesium.Cartesian3.normalize(t, new Cesium.Cartesian3), f = -Math.acos(Cesium.Cartesian3.dot(u, a)),
                h = Cesium.Cartesian3.cross(u, a, new Cesium.Cartesian3);
            this._leftMouseDragParameters.rotationAngle = 0, !h.equals(Cesium.Cartesian3.ZERO) && !isNaN(f) && (viewer.camera.rotateAroundPoint(Cesium.Cartesian3.ZERO, h, f), this._leftMouseDragParameters.rotationAxis = h, this._leftMouseDragParameters.rotationAngle = f), (6 < Math.abs(this._prevFrameMousePosition.x - this._mousePosition.x) || Math.abs(this._prevFrameMousePosition.y - this._mousePosition.y) > 6) && this._draggingEvent.raiseEvent(!0)
        }
    }, d.prototype.handleMiddleButtonDrag = function () {
        if (this._navigationMode == this.NavigationMode.DRAG_ROTATE) {
            if (this._downMouseTerrainPosition == undefined) return;
            this._dragRotateMarker.show(this._downMouseTerrainPosition), e(viewer.container).css("cursor").indexOf("CloseHandDragRotate.png") == -1 && this.setCursor("./img/CloseHandDragRotate.png"), viewer.scene.screenSpaceCameraController.enableRotate = !1;
            var t = 20, n = 15, r = Math.min(Math.max(this.HeightAboveGround, 0), 1e4) / 1e4, s = 10 + r * 10, o, u;
            if (this._prevFrameMousePosition == undefined) return;
            if (this._twoPointersGestureStart == 1) return;
            var a = 1;
            this._rotateAndZoom ? (this._prevFrameRotateAngle == undefined ? o = 0 : (o = Math.round(Cesium.Math.toDegrees(i.getShortArcDirection(Cesium.Math.toRadians(this._prevFrameRotateAngle), Cesium.Math.toRadians(this._rotateAngle))) * 2), this._prevFrameRotateAngle = this._rotateAngle), this._prevFrameZoomFactor != undefined && (a = this._zoomFactor / this._prevFrameZoomFactor, viewer.camera.rotateAroundPoint(this._downMouseTerrainPosition, this._downMouseTerrainPosition, 0, a), this._prevFrameZoomFactor = this._zoomFactor), u = 0) : this._rotateAndPitch ? this._prevFramePitchRotateDirX == undefined || this._prevFramePitchRotateDirY == undefined ? (o = 0, u = 0) : (o = this._pitchRotateDirX - this._prevFramePitchRotateDirX, u = this._prevFramePitchRotateDirY - this._pitchRotateDirY, this._prevFramePitchRotateDirX = this._pitchRotateDirX, this._prevFramePitchRotateDirY = this._pitchRotateDirY) : (o = Cesium.Math.clamp(this._mousePosition.x - this._prevFrameMousePosition.x, -t, t), u = Cesium.Math.clamp(this._prevFrameMousePosition.y - this._mousePosition.y, -t, t));
            var l = Math.min(f, .1);
            viewer.camera.rotateAroundPoint(this._downMouseTerrainPosition, this._downMouseTerrainPosition, o * Cesium.Math.toRadians(s) * l);
            var c = Cesium.Cartesian3.subtract(viewer.camera.position, this._downMouseTerrainPosition, new Cesium.Cartesian3);
            c = Cesium.Cartesian3.normalize(c, new Cesium.Cartesian3);
            var h = Cesium.Cartesian3.normalize(this._downMouseTerrainPosition, new Cesium.Cartesian3),
                p = Cesium.Cartesian3.dot(c, h), d = Math.acos(p), v = Math.max(.1, Math.cos(d)),
                m = u * Cesium.Math.toRadians(n) * l * v;
            viewer.camera.rotateAroundPoint(this._downMouseTerrainPosition, viewer.camera.right, m);
            var d = Cesium.Cartesian3.angleBetween(viewer.camera.position, viewer.camera.up);
            d >= Cesium.Math.toRadians(90) && this.approximateUpLimit(m), u < 0 && (!viewer.scene.undergroundMode && this.HeightAboveGround_HitTest < this._minAltitudeAboveGround || viewer.scene.undergroundMode && viewer.camera.positionCartographic.height < viewer.scene.undergroundSurfaceHeight) && this.approximateDownLimit(m)
        }
    }, d.prototype.approximateDownLimit = function (e) {
        function n() {
            return viewer.scene.undergroundMode ? viewer.camera.positionCartographic.height < viewer.scene.undergroundSurfaceHeight : t.HeightAboveGround_HitTest < t._minAltitudeAboveGround
        }

        var t = this, r = 0;
        while (n() && e != 0) {
            viewer.camera.rotateAroundPoint(this._downMouseTerrainPosition, viewer.camera.right, -e);
            var i = viewer.scene.globe.getHeight(viewer.camera.positionCartographic);
            this._groundHeightAtCameraPosition = i || this._groundHeightAtCameraPosition, r++;
            if (r > 100) {
                console.log("Navigate.approximateDownLimit break");
                break
            }
        }
    }, d.prototype.approximateUpLimit = function (e, t) {
        t || (t = 0, viewer.camera.rotateAroundPoint(this._downMouseTerrainPosition, viewer.camera.right, -e)), t++, viewer.camera.rotateAroundPoint(this._downMouseTerrainPosition, viewer.camera.right, e);
        var n = Cesium.Cartesian3.angleBetween(viewer.camera.position, viewer.camera.up);
        if (n >= Cesium.Math.toRadians(90)) {
            viewer.camera.rotateAroundPoint(this._downMouseTerrainPosition, viewer.camera.right, -e);
            if (t > 5) return;
            this.approximateUpLimit(e / 2, t)
        } else this.approximateUpLimit(e, t)
    }, d.prototype.enforceZeroRoll = function () {
        viewer.camera.roll != 0 && viewer.camera.setView({
            orientation: {
                heading: viewer.camera.heading,
                pitch: viewer.camera.pitch,
                roll: 0
            }
        })
    }, d.prototype.handleMovement = function () {
        this._Movement != null && this._Movement.move(f) == 0 && (this._Movement instanceof T && (this._leftMouseDragParameters.rotationAngle = 0), this._Movement = null)
    }, d.prototype.handleKeys = function () {
        var e = 0, t = 0;
        this._inputFlags.stop && (TerraExplorer.tools.ToolManager._tools.Rotate.close(), this.stop(), s.postNotification("TEN_USER_INITIATE_STOP", this, this)), this._inputFlags.turnLeft && (e = -1), this._inputFlags.turnRight && (e = 1), this._inputFlags.lookUp && (t = 1), this._inputFlags.lookDown && (t = -1);
        if (this._inputFlags.moveLeft || this._inputFlags.moveRight || this._inputFlags.moveUp || this._inputFlags.moveDown) {
            var n = this._inputFlags.moveUp || this._inputFlags.moveRight ? -1 : 1,
                r = this._inputFlags.moveLeft || this._inputFlags.moveRight ? viewer.camera.right : viewer.camera.up,
                i = viewer.scene.globe.ellipsoid.cartesianToCartographic(viewer.camera.position).height,
                o = this._keyboardTurnSpeed * n * this.HeightAboveGround / 3e8, u = new Cesium.Cartesian3;
            Cesium.Cartesian3.cross(viewer.camera.position, r, u), viewer.camera.rotateAroundPoint(Cesium.Cartesian3.ZERO, u, o)
        }
        if (this._inputFlags.zoomIn) {
            var a = Math.max(10, this.HeightAboveGround / 10) * this._keyboardTurnSpeed;
            viewer.camera.zoomIn(a), this.HeightAboveGround_HitTest < 1 && !viewer.scene.showUndergroundSurface && viewer.camera.zoomOut(a)
        }
        if (this._inputFlags.zoomOut) {
            var a = Math.max(10, this.HeightAboveGround / 10) * this._keyboardTurnSpeed;
            viewer.camera.zoomOut(a), this.HeightAboveGround + a * 1.5 < this.MAX_ALTITUDE && viewer.camera.zoomOut(a * 1.5)
        }
        (e != 0 || t != 0) && viewer.camera.setView({
            orientation: {
                heading: viewer.camera.heading + e * this._keyboardTurnSpeed * f,
                pitch: Cesium.Math.clamp(viewer.camera.pitch + t * this._keyboardTurnSpeed * f, Cesium.Math.toRadians(-90), Cesium.Math.toRadians(87)),
                roll: 0
            }
        })
    }, d.prototype.clearInput = function () {
        for (var e in this._inputFlags) this._inputFlags[e] = !1
    }, d.prototype.handleHitGround = function () {
        var e, t;
        viewer.scene.undergroundMode ? (e = viewer.camera.positionCartographic.height < viewer.scene.undergroundSurfaceHeight, t = viewer.scene.undergroundSurfaceHeight + 10) : (e = this.HeightAboveGround_HitTest < .5, t = this._floorHeightAtCameraPosition + 1.6), e && (this.stop(), viewer.camera.setView({
            destination: Cesium.Cartesian3.fromRadians(viewer.camera.positionCartographic.longitude, viewer.camera.positionCartographic.latitude, t),
            orientation: {heading: viewer.camera.heading, pitch: viewer.camera.pitch, roll: 0}
        }))
    };
    var w;
    d.prototype.handleStreamSpeed = function () {
        viewer.camera.position.equals(this._prevFramePosition) ? w == 0 && (w = setTimeout(function () {
            u.getInstance(viewer).streamSpeed = u.STREAM_SPEED_FAST
        }, 500)) : (clearTimeout(w), w = 0, this._navigationMode != this.NavigationMode.DRAG_ROTATE ? u.getInstance(viewer).streamSpeed = u.STREAM_SPEED_NORMAL : u.getInstance(viewer).streamSpeed = u.STREAM_SPEED_SLOW)
    };
    var E;
    d.prototype.handleObjectsTooltip = function () {
        clearTimeout(E), e("#TooltipDiv").hide();
        var t = this;
        E = setTimeout(function () {
            var n = TerraExplorer.tools.SideBar, r = {}, i = viewer.scene.screenToWorld(t._mousePosition, r);
            if (Cesium.defined(r.pickPrimitive) && Cesium.defined(r.id)) {
                var s = a.blockRequestPrimitiveFromPrimitive(r.pickPrimitive);
                if (s && s._instanceIds !== undefined) {
                    var o = s._instanceIds.indexOf(r.id), u = s._tooltips[o];
                    u && u !== "" && (e("#TooltipDiv").text(u), e("#TooltipDiv").css({
                        top: t._mousePosition.y,
                        left: t._mousePosition.x + (n.IsShown ? n.Width + 10 : 10),
                        "z-index": 10
                    }), e("#TooltipDiv").show())
                }
            }
        }, 500)
    }, d.prototype.handleUndergroundSurface = function () {
        viewer.scene.updateUndergroundSurface(), viewer.scene.logarithmicDepthBuffer = this.HeightAboveGround > 0
    }, d.prototype.stop = function () {
        this._Movement = null, viewer.scene.tweens.removeAll(), viewer.trackedEntity != undefined, viewer.trackedEntity = undefined, this.clearInput()
    }, d.prototype.flyAround = function (e, t, r, i) {
        this._Movement = new n(e, t, r, i)
    }, d.prototype.isFlyAround = function () {
        return this._Movement instanceof n
    }, d.prototype.faceNorth = function () {
        this.stop();
        var e = i.getShortArcDirection(viewer.camera.heading, 0),
            t = new Cesium.Cartesian2(viewer.scene.canvas.width / 2, viewer.scene.canvas.height / 2),
            n = viewer.camera.pickEllipsoid(t);
        if (n != undefined && viewer.scene.mode == Cesium.SceneMode.SCENE3D || viewer.scene.mode == Cesium.SceneMode.COLUMBUS_VIEW) {
            var r = 2, s = Math.abs(e) / Cesium.Math.toRadians(100);
            s = Math.min(Math.max(.4, s), 2);
            var o = e / s * r;
            this.flyAround(n, viewer.camera.position, o, 0)
        } else this._Movement = new S(e >= 0 ? 1 : -1)
    };
    var S = function (e) {
        this._yawDir = e != undefined ? e : 1
    };
    S.prototype.move = function () {
        var e = !0, t = Cesium.Math.toRadians(60) * this._yawDir, n = viewer.camera.heading,
            r = i.getShortArcDirection(n, 0);
        if (Math.abs(r) > 0) {
            var s = t * f, o = n + s, u = i.getShortArcDirection(o, 0), a = u >= 0 ? 1 : -1;
            this._yawDir != a ? (n = 0, e = !1) : n = o
        } else e = !1;
        return viewer.camera.setView({orientation: {heading: n}}), e
    }, d.prototype.flyToCartesian = function (e, t, n) {
        viewer.camera.flyToBoundingSphere(new Cesium.BoundingSphere(e, t), {
            duration: this.DEFAULT_FLY_TO_DURATION,
            offset: new Cesium.HeadingPitchRange(viewer.camera.heading, Cesium.Math.toRadians(-50), t),
            complete: n || function () {
            }
        })
    }, d.prototype.flyToPosition = function (t, n) {
        n = e.extend(!0, {}, n);
        if (viewer.scene.mode == Cesium.SceneMode.MORPHING) return;
        TerraExplorer.groundCollisionDetection = !1, viewer.camera._scene.screenSpaceCameraController.enableCollisionDetection = !1;
        var r = this;
        this.convertToAbsolute(t, function (n, i) {
            o.Mode = o.CONTROLLED_FLIGHT;
            var s = {
                duration: i.slDuration ? undefined : r.DEFAULT_FLY_TO_DURATION,
                offset: n.HeadingPitchRange,
                hitGroundRetries: 0
            };
            e.extend(s, i), s.pausePresentation !== !1 && TerraExplorer.getCurrentPresentation() && TerraExplorer.getCurrentPresentation().pause();
            var u = s.complete;
            s.complete = function () {
                u != undefined && u(), TerraExplorer.groundCollisionDetection = !0, viewer.camera._scene.screenSpaceCameraController.enableCollisionDetection = !0, o.Mode = o.FREE_FLIGHT
            };
            var a = s.cancel;
            s.cancel = function () {
                if (r.HeightAboveGround < 0) {
                    t.cesiumCartesian3 = new Cesium.Cartesian3(t.cartesian.x, t.cartesian.y, t.cartesian.z), s.hitGroundRetries++;
                    if (!t.cesiumCartesian3.equalsEpsilon(viewer.camera.position, .01)) {
                        setTimeout(function () {
                            r.flyToPosition(n, s)
                        }, 200);
                        return
                    }
                }
                a != undefined && a(), o.Mode = o.FREE_FLIGHT
            }, x(r, s), viewer.camera.flyToBoundingSphere(new Cesium.BoundingSphere(n.Cartesian, n.HeadingPitchRange.range), s)
        }, n)
    }, d.prototype.convertToAbsolute = function (e, t, n) {
        if (e.AltitudeType == r.ATC_TERRAIN_RELATIVE) {
            var i = viewer.scene.globe.ellipsoid.cartesianToCartographic(e.Cartesian), s = i.height,
                o = Cesium.defaultValue(n.levelToSample, 13), u = Cesium.sampleTerrain(viewer.terrainProvider, o, [i]);
            Cesium.when(u, function (o) {
                o[0].height == undefined && (o[0].height = 0), i.height = o[0].height + s;
                var u = new r;
                u.Cartesian = viewer.scene.globe.ellipsoid.cartographicToCartesian(i), u.HeadingPitchRange = Cesium.HeadingPitchRange.clone(e.HeadingPitchRange), u.AltitudeType = r.ATC_TERRAIN_ABSOLUTE, t(u, n)
            })
        } else t(e.clone(), n)
    }, d.prototype.jumpToPosition = function (t, n) {
        if (viewer.scene.mode == Cesium.SceneMode.MORPHING) return;
        var r = {};
        e.extend(r, n), r.pausePresentation !== !1 && TerraExplorer.getCurrentPresentation() && TerraExplorer.getCurrentPresentation().pause(), this.convertToAbsolute(t, function (e) {
            e.HeadingPitchRange.range = Math.max(.001, e.HeadingPitchRange.range), viewer.camera.lookAt(e.Cartesian, e.HeadingPitchRange), viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)
        })
    };
    var T = function (e, t) {
        this.rotationAxis = e, this.startRotationAngle = t, this.rotationAngle = this.startRotationAngle, this.t = 1, this.isSpinning = !1
    };
    return T.prototype.move = function (e) {
        function t(e) {
            return e * (2 - e)
        }

        function n(e) {
            return e * e
        }

        return this.canSpin() ? (viewer.camera.rotateAroundPoint(Cesium.Cartesian3.ZERO, this.rotationAxis, this.rotationAngle), this.t = Math.max(0, this.t - e * 1), this.rotationAngle = this.startRotationAngle * n(this.t), !0) : (this.isSpinning = !1, !1)
    }, T.prototype.canSpin = function () {
        var e = Math.abs(this.rotationAngle / TerraExplorer.internal.Navigate.HeightAboveGround * Cesium.Cartesian3.magnitude(viewer.camera.position));
        return this.rotationAxis != undefined && this.rotationAngle != undefined && e > .001
    }, new d
}), define("tools/TETools/LayersStorage", ["jquery", "TELang", "internal/NotificationCenter", "internal/TEPosition"], function (e, t, n, r) {
    "use strict";

    function i() {
        return "_TEW_Layers_"
    }

    const s = "_FromStorage";
    var o = null, u = function (e) {
        this.id = Cesium.createGuid(), this.name = "", this.style = null, this.level = 0, this.displayName = "", this.url = ""
    }, a = function () {
        this._Layers = [], this._allLocalStorageObjects = {}
    };
    return Cesium.defineProperties(a.prototype, {
        DefaultStorage: {
            get: function () {
                return o
            }
        }, Layers: {
            get: function () {
                return this._Layers.length == 0 && this.loadLayersFromLocalStorage(), this._Layers
            }
        }
    }), a.prototype.createLayerItem = function () {
        return new u
    }, a.prototype.convertToArrayOfLayers = function () {
        var e = [];
        if (this._Layers == null) return null;
        for (var t = 0; t < this._Layers.length; t++) {
            var n = this._Layers[t];
            e.push(n)
        }
        return e
    }, a.prototype.loadLayersFromLocalStorage = function () {
        var t = TerraExplorer.internal.Project, n = TerraExplorer.getUrlParameters().site;
        n === undefined && (n = "99deafaultSite-99");
        var r = TerraExplorer.getUrlParameters().catalogid;
        if (r !== undefined) {
            var o = r.match(/(^|(.*\.))(\d+)$/);
            o !== null && (r = o[3])
        } else r = "99defaultProject-99";
        this._allLocalStorageObjects = JSON.parse(localStorage.getItem(i())), this._allLocalStorageObjects === null && (this._allLocalStorageObjects = {});
        var u = null;
        n && this._allLocalStorageObjects[n] && r && this._allLocalStorageObjects[n][r] && (u = this._allLocalStorageObjects[n][r]);
        if (u == null) {
            if (Array.isArray(this._allLocalStorageObjects)) {
                var a = this._allLocalStorageObjects;
                this._allLocalStorageObjects = {}, a && a.length > 0 && (this._allLocalStorageObjects.previousLayersAndObjectsFromStorage = a), this.saveAll()
            }
            return
        }
        u.sort(function (e, t) {
            return e.timestamp - t.timestamp
        });
        for (var f = 0; f < u.length; f++) {
            var l = u[f];
            if (l == null) continue;
            if (Cesium.defined(l.type)) {
                l.options === undefined && (l.options = {});
                var c = e.grep(Object.keys(t._objectTypes), function (e) {
                    return t._objectTypes[e] === l.type
                });
                if (c.length === 1 && t._objectTypes[c[0]] && t._objectsToSave[t._objectTypes[c[0]]]) TerraExplorer.internal.Settings.saveObjects == 0 ? TerraExplorer.tools.ToolManager._tools[l.tool].createObj(l) : (this._Layers = u, this.deleteItem(l.name), this._Layers = []); else if (l.type == "mesh") TerraExplorer.SGWorld.Creator.CreateMeshLayer(l.displayName, l.url + s + JSON.stringify(l.options), l.name, !0, l.timestamp); else if (l.type.substring(0, 7) == "Feature") TerraExplorer.SGWorld.Creator.CreateFeatureLayer(l.displayName, l.url + s + JSON.stringify(l.options), l.name, l.type, l.style, !0, l.timestamp); else if (l.type == "cpt") TerraExplorer.SGWorld.Creator.CreatePointCloudLayer(l.displayName, l.url + s + JSON.stringify(l.options), l.name, !0, l.timestamp); else if (l.type == "elevation") TerraExplorer.SGWorld.Creator.CreateElevationLayer(l.displayName, l.url + s + JSON.stringify(l.options), l.name, !0, l.timestamp); else if (l.type == "viewshed") l.viewshedObjOptions.fromStorage = !0, l.id !== undefined && (l.viewshedObjOptions.originalGuid = l.id), TerraExplorer.tools.ToolManager._tools.Viewshed.CreateViewshed(new Cesium.Cartesian3(l.position.x, l.position.y, l.position.z), l.distance, l.direction, l.viewshedObjOptions); else {
                    if (l.type === "videoOnTerrain" || l.type === "holeOnTerrain") return;
                    TerraExplorer.SGWorld.Creator.CreateImageryLayer(l.displayName, l.url + s + JSON.stringify(l.options), l.name, !0, l.timestamp)
                }
            }
        }
    }, a.prototype.getAll = function () {
        var e = [];
        for (var t = 0; t < this._Layers.length; t++) {
            var n = this._Layers.get(t);
            favorites.push(e)
        }
        return e
    }, a.prototype.getItemType = function (e) {
        if (e.Style == undefined) {
            if (e._imageryProvider != undefined) return "imagery";
            if (e.viewshedMap != undefined) return "viewshed";
            if (e.url !== undefined && e.url.indexOf("/pnts/") != -1) return "cpt";
            if (e.isElevationLayer != undefined && e.isElevationLayer) return "elevation";
            var t = e instanceof Cesium.KmlDataSource;
            return t ? "kmlLayer" : "mesh"
        }
        if (Cesium.defined(e.Style.label) || Cesium.defined(e.Style.billboard) || Cesium.defined(e.Style.model)) return "FeaturePoint";
        if (Cesium.defined(e.Style.polyline)) return "FeatureLine";
        if (Cesium.defined(e.Style.polygon)) return "FeaturePolygon"
    }, a.prototype.saveItem = function (t) {
        function o(e, t) {
            var n;
            return e.indexOf("{s}") != -1 ? n = t != undefined && t.length > 0 ? e.replace("{s}", t[0]) : console.error("Error - sTag with no subdomains.") : n = e, n
        }

        var n = TerraExplorer.internal.Project, r = TerraExplorer.getUrlParameters().site;
        r === undefined && (r = "99deafaultSite-99");
        var i = TerraExplorer.getUrlParameters().catalogid;
        if (i !== undefined) {
            var s = i.match(/(^|(.*\.))(\d+)$/);
            s !== null && (i = s[3])
        } else i = "99defaultProject-99";
        for (var u = 0; u < this._Layers.length; ++u) (t.guid == this._Layers[u].id || t.id == this._Layers[u].id) && this._Layers.splice(u, 1);
        t.type === undefined && (t.type = this.getItemType(t)), t.type === undefined && (t.type = "Feature");
        if (t.type == "mesh" || t.type == "cpt") var a = {
            id: t.guid,
            url: o(t.url, t._subdomains),
            name: t.name,
            displayName: t.displayName,
            myLayer: TerraExplorer.SGWorld.Creator.CreateFor.UI,
            type: t.type,
            timestamp: Cesium.defaultValue(t.timestamp, Date.now()),
            options: {
                visibility: Cesium.defaultValue(t.show, !0),
                currentPivot: !t.isDestroyed() && t.getCurrentPivot !== undefined ? t.getCurrentPivot() : undefined
            }
        }; else if (t.type.indexOf("Feature") != -1) var a = {
            id: t.guid,
            url: o(t._url, t._subdomains),
            name: t._layerName,
            displayName: t._layerDisplayName,
            style: t.Style,
            level: t._level,
            timestamp: Cesium.defaultValue(t.timestamp, Date.now()),
            myLayer: TerraExplorer.SGWorld.Creator.CreateFor.UI,
            type: t.type,
            options: {visibility: Cesium.defaultValue(t.show, !0)}
        }; else if (t.type == "imagery" || t.type == "elevation") {
            if (t.type == "imagery") var f = t._imageryProvider.url !== undefined ? t._imageryProvider.url : t._imageryProvider._url;
            var a = {
                id: t.guid,
                url: t.type == "imagery" ? o(f, t._imageryProvider._tileProvider._subdomains) : o(t.url, t.subdomains),
                rectangle: t.rectangle,
                name: t.name,
                displayName: t.displayName,
                style: t.Style,
                myLayer: TerraExplorer.SGWorld.Creator.CreateFor.UI,
                timestamp: Cesium.defaultValue(t.timestamp, Date.now()),
                type: t.type,
                alpha: t.alpha,
                isElevationLayer: t.isElevationLayer,
                options: {visibility: Cesium.defaultValue(Cesium.defaultValue(t.show, t.visibility), !0)}
            }
        } else if (t.type == "viewshed") {
            t.viewshedObjOptions.show = t.show;
            if (t.fromAPI && !TerraExplorer.saveViewshedsFromAPI) return;
            var a = {
                id: t.guid,
                displayName: t.displayName,
                position: t.position,
                distance: t.distance,
                direction: t.direction,
                viewshedObjOptions: t.viewshedObjOptions,
                type: t.type
            }
        } else {
            if (t.type === "videoOnTerrain") return;
            if (t.type === "modifyTerrain") return;
            if (t.type === "holeOnTerrain") return;
            var l = e.grep(Object.keys(n._objectTypes), function (e) {
                return n._objectTypes[e] === t.type
            });
            if (l.length === 1 && n._objectTypes[l[0]] && n._objectsToSave[n._objectTypes[l[0]]]) {
                var c = TerraExplorer.tools.ToolManager._tools[t.tool]._propertiesToSave, a = {};
                Object.keys(t).forEach(function (e) {
                    c[e] && (e === "prims" ? a[e] = TerraExplorer.tools.ToolManager._tools[t.tool].getPrimsToSave(t.prims) : a[e] = t[e])
                }), a.id = t.id
            }
        }
        this._Layers.push(a), this._allLocalStorageObjects[r] !== undefined ? this._allLocalStorageObjects[r][i] ? this._allLocalStorageObjects[r][i] = this._Layers : (this._allLocalStorageObjects[r][i] = [], this._allLocalStorageObjects[r][i].push(a)) : (this._allLocalStorageObjects[r] = {}, this._allLocalStorageObjects[r][i] = [], this._allLocalStorageObjects[r][i].push(a)), this.saveAll()
    }, a.prototype.saveAll = function () {
        localStorage.removeItem(i()), localStorage.setItem(i(), JSON.stringify(this._allLocalStorageObjects))
    }, a.prototype.deleteItem = function (e, t) {
        var n = 0;
        if (t == undefined) {
            for (var r = 0; r < this.Layers.length; ++r) if (e == this._Layers[r].displayName || e == this._Layers[r].name) n = r
        } else for (var r = 0; r < this.Layers.length; r++) e == this._Layers[r].id && (n = r);
        var i = TerraExplorer.internal.Project, s = TerraExplorer.getUrlParameters().site;
        s === undefined && (s = "99deafaultSite-99");
        var o = TerraExplorer.getUrlParameters().catalogid;
        if (o !== undefined) {
            var u = o.match(/(^|(.*\.))(\d+)$/);
            u !== null && (o = u[3])
        } else o = "99defaultProject-99";
        if (this._allLocalStorageObjects !== undefined && this._allLocalStorageObjects[s] !== undefined && this._allLocalStorageObjects[s][o] !== undefined) {
            for (var r = 0; r < this._allLocalStorageObjects[s][o].length; r++) this._allLocalStorageObjects[s][o][r] === this._Layers[r] && (this._allLocalStorageObjects[s][o].splice(n, 1), this._Layers.splice(n, 1));
            this._allLocalStorageObjects[s][o].length === 0 && delete this._allLocalStorageObjects[s]
        }
        this.saveAll()
    }, a.prototype.getFeatureById = function (e) {
        for (var t = 0; t < this.Layers.length; t++) {
            var n = this.Layers[t];
            if (n.id == e) return n
        }
        return null
    }, o = new a, o
}), define("tools/TETools/DistanceTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "internal/InputMode", "./ProgressTool", "internal/GeometryHelper", "internal/NotificationCenter", "tools/ToolDialog", "tools/ListControl", "internal/Navigate", "./LayersStorage"], function (e, t, n, r, i, s, o, u, a, f, l, c, h) {
    "use strict";

    function p() {
        this._explanationText = t.i18n("analysis_distance_explanation_text"), this._explanationTextOnStartOnly = !0, this._listControl = null, this._isLowResOriginal = null, this._isOnPrimitive = !1, this._beforeLastUpdatedpoint = null, this._lastMovedPoint = null, this._eventListener = null, this._levelToSample = Number.MAX_VALUE, this._groundLine = null, this._viewMode = !1, this._distanceLines = new Cesium.PrimitiveCollection, viewer.scene.primitives.add(this._distanceLines), this._distanceLines2 = new Cesium.PrimitiveCollection, viewer.scene.primitives.add(this._distanceLines2), this._samplesPerLineIndex = [], this._linesGroundDistances = [], this._numObj = 0, this._propertiesToSave = {
            name: !0,
            tool: !0,
            type: !0,
            prims: !0,
            arealDist: !0,
            totalHorizontalDist: !0,
            slope: !0,
            elevationDiff: !0,
            timestamp: !0,
            isLowResOriginal: !0,
            isOnPrimitive: !0
        }, this._layersStorage = h.DefaultStorage, this.reset(), this.getId = function () {
            return "DistanceTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Analyze_Distance"), "./img/newDesign/analyze_distance.png", 10, r.MenuEntryAnalyze(), t.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }, this.open = function (e) {
            this._groundDistance = 0, e ? (this._viewMode = !0, this._distanceLines = e.prims[0], m = e.prims[1], this._distanceLines2 = e.prims[2], v = e.prims[3], g = e.prims[4], this._currentObject = e, y = e.entities[0], this._linesGroundDistances = e.linesGroundDistances) : (this._viewMode = !1, this._currentObject = undefined)
        }
    }

    function w(e, t) {
        this.longitude = e.longitude, this.latitude = e.latitude, this._height = e.height, this._requestID = t
    }

    function E() {
        m = null, v = null, g = null
    }

    p.inheritsFrom(o), Cesium.defineProperties(p.prototype, {
        FirstPoint: {
            get: function () {
                return m.length == 0 ? null : m.get(0).position
            }
        }, LastPoint: {
            get: function () {
                return m.length == 0 ? null : m.get(m.length - 1).position
            }
        }, BeforeLastPoint: {
            get: function () {
                return m.length < 2 ? null : m.get(m.length - 2).position
            }
        }
    }), p.prototype.onOpenedToolContainer = function () {
        this._explanationTextOnStartOnly = !1, this._currentObject !== undefined && this._currentObject.name !== undefined ? (e("#headerDivContainer span:first")[0].innerText = this._currentObject.name, this.updateDistanceText()) : e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Analyze_Distance"))
    }, p.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0
    }, p.prototype.getPrimsToSave = function (e) {
        var t = [];
        return e.forEach(function (e) {
            e.toSave && e._billboards.forEach(function (e) {
                t.push(e.position)
            })
        }), t
    };
    var d = null;
    p.prototype.onBeforeOpenToolContainer = function () {
        return s.Mode = s.MEASUREMENT, e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this._viewMode || (this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this.drawingTool = TerraExplorer.internal.DrawingTool, m = new Cesium.BillboardCollection, viewer.scene.primitives.add(m), v = new Cesium.LabelCollection, viewer.scene.primitives.add(v), g = new Cesium.LabelCollection, viewer.scene.primitives.add(g), d = this.drawingTool.drawPolyline({
            style: {
                followSurface: !0,
                width: 2,
                material: new Cesium.Color(1, .84, 0, 1)
            },
            AltitudeMethod: this.drawingTool.ALTITUDE_METHODS.RELATIVE_TO_MODEL,
            Altitude: .1,
            onPointUpdate: e.proxy(this.onClickUpdate, this),
            onFinish: e.proxy(this.onFinish, this),
            onAbort: e.proxy(this.onAbort, this),
            onMouseMove: e.proxy(this.onMouseMove, this)
        })), this.parent.onBeforeOpenToolContainer.call(this), this.showNormalButtons(), this._viewMode ? (this.updateDistanceText(), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("4", !1), this._currentObject !== undefined && this._currentObject.isOnPrimitive && this.ToolContainer.enableButton("3", !1)) : (this.reset(), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText)), a.addObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, p.prototype.onBeforeCloseToolContainer = function (e) {
        return this.parent.onBeforeCloseToolContainer.call(this, e), d !== null && this.drawingTool !== undefined && this.drawingTool.Active && (e == 2 || e == 1 && !this._viewMode) && d.abort(), this._viewMode || this.reset(), s.Mode = s.FREE_FLIGHT, a.removeObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), f.IsOpen && f.close(), !0
    }, p.prototype.showNormalButtons = function () {
        this.ToolContainer.removeButtons(), this.ToolContainer.addButton(1, "./img/delete.png", undefined, t.i18n("measure_distance_tooltip_delete")), this.ToolContainer.addButton(2, "./img/delete_last_point.png", undefined, t.i18n("measure_distance_tooltip_delete_last_point")), this.ToolContainer.addButton(3, "./img/calc_distance.png", undefined, t.i18n("measure_distance_tooltip_ground_distance")), this.ToolContainer.addButton(4, "./img/newDesign/measurement_v.png", undefined, t.i18n("measure_finish_drawing_tool"))
    }, p.prototype.reset = function () {
        this._toolContainerText = "", this._listControl != null && this._listControl.removeAll(), this._levelToSample = Number.MAX_VALUE, viewer.entities.remove(y), y = null, this._viewMode || (this._distanceLines = null, this._distanceLines2 = null), this._isOnPrimitive = !1, this._distanceIndex = 0, this._totalArealDist = 0, this._totalHorizontalDist = 0, this._slopFirstToLast = 0, this._elevationDifference = 0, this._groundDistance = 0, this._groundDistanceRequestID = 0, this._isLowResOriginal = null, this._samplesPerLineIndex = [], this._linesGroundDistances = [], this._bboxObj = 0, this.distPointArray = [], this.distLabelsArray = [], this.ToolContainer && (this.ToolContainer.enableButton("1", !1), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("3", !1), this.ToolContainer.enableButton("4", !1))
    }, p.prototype.unitsChanged = function (e) {
        this.updateDistanceText(), this.updateUnitsLabels()
    }, p.prototype.updateUnitsLabels = function () {
        v !== undefined && v.length > 0 && v.removeAll();
        var e = null, t = null;
        for (var n = 0; n < m.length - 1; n++) {
            e = m._billboards[n]._position, t = m._billboards[n + 1].position;
            var r = viewer.scene.globe.ellipsoid.cartesianToCartographic(e),
                s = viewer.scene.globe.ellipsoid.cartesianToCartographic(t), o = u.geoDist(r, s),
                a = v.add(TerraExplorer.style.analysisLabelOptions(i.formatDistance(o, !0, !0), e, t));
            a.objNumber = o, a.createLabelText = function () {
                return TerraExplorer.internal.Units.formatDistance(this.objNumber, !0, !0)
            }
        }
        var r = viewer.scene.globe.ellipsoid.cartesianToCartographic(e),
            s = viewer.scene.globe.ellipsoid.cartesianToCartographic(t), o = u.geoDist(r, s),
            a = v.add(TerraExplorer.style.analysisLabelOptions(i.formatDistance(o, !0, !0), e, t));
        a.objNumber = o, a.createLabelText = function () {
            return TerraExplorer.internal.Units.formatDistance(this.objNumber, !0, !0)
        }, this._currentObject ? this.showTotalDistanceLabel(t, o) : this.onMouseMove(this._lastMovedPoint)
    }, p.prototype.onButtonClick = function (e) {
        this.parent.onButtonClick.call(this, e);
        switch (e) {
            case 1:
                this.drawingTool !== undefined && this.drawingTool.Active && this.drawingTool.abortDrawing(), this._viewMode ? TerraExplorer.internal.Project.deleteObject(this._currentObject) : (this.reset(), this.updateDistanceText(), this.ToolContainer._toolDelegate !== undefined && this.onBeforeOpenToolContainer());
                break;
            case 2:
                this.drawingTool.cancellationCallback();
                if (m.length >= 2) {
                    var t = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.BeforeLastPoint),
                        n = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.LastPoint);
                    this._totalArealDist -= u.geoDist(t, n), this._totalHorizontalDist -= u.geoDist2D(t, n), m.remove(m.get(m.length - 1)), v.remove(v.get(v.length - 1)), this._beforeLastUpdatedpoint = m._billboards[m._billboards.length - 2].position, this._lastMovedPoint !== null && this.onMouseMove(this._lastMovedPoint), this.asyncUpdateElevationAndSlopeDiff(), m.length == 0 && (this.ToolContainer.enableButton("1", !1), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("3", !1), this.ToolContainer.enableButton("4", !1));
                    if (this._linesGroundDistances.length > 0 && y != null) {
                        viewer.entities.remove(y), b.pop(), b.pop();
                        var r = {};
                        r.positions = b, r.clampToGround = !0, r.width = 3, r.material = new Cesium.Color(1, .84, 0, 1), y = viewer.entities.add(new Cesium.Entity({polyline: r}))
                    }
                    this._samplesPerLineIndex.pop(), this._linesGroundDistances.pop(), this._groundDistance = 0, m.length == 1 && this.reset()
                } else m.length == 1 ? this.reset() : this.reset();
                break;
            case 3:
                this._groundDistance = 0, this._linesGroundDistances = [], this._samplesPerLineIndex = [], m.length > 1 && this.doWorkAsync();
                break;
            case 4:
                this.drawingTool.finishDrawing()
        }
    }, p.prototype.updateDistanceText = function () {
        if (this._totalArealDist == 0 && this._totalHorizontalDist == 0 && this._slopFirstToLast == 0 && this._elevationDifference == 0 && this._currentObject !== undefined) this._toolContainerText = ""; else {
            this._currentObject !== undefined && (this._totalArealDist = this._currentObject.arealDist, this._totalHorizontalDist = this._currentObject.totalHorizontalDist, this._slopFirstToLast = this._currentObject.slope, this._elevationDifference = this._currentObject.elevationDiff);
            var n = e("<div style='position:relative;overflow:hidden; width:100%; height:100%;'></div>"),
                r = e("<div id='MessageClientId' style='position:relative; margin-left:5px; margin-top:0px; overflow-y:auto; width:100%;'></div>");
            n.append(r), TerraExplorer.tools.ToolContainer.setText(""), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), e("#LowerView").append(n), r.css({height: n.height()}), this._listControl = new l(r), this._listControl.IsAnalyzeToolList = !0;
            var s = t.i18n("measure_distance_aerial", {adist: i.formatDistance(this._totalArealDist)}),
                o = t.i18n("measure_distance_horizontal", {hdist: i.formatDistance(this._totalHorizontalDist)}),
                u = t.i18n("measure_distance_slope", {slope: this._slopFirstToLast.toFixed(2)}),
                a = t.i18n("measure_distance_elevation", {elevationDiff: i.formatDistance(this._elevationDifference)}),
                f = this._linesGroundDistances.length;
            if (f > 0) {
                this._groundDistance = 0;
                for (var c = 0; c < f; c++) this._groundDistance += this._linesGroundDistances[c]
            }
            if (this._groundDistance > 0) {
                var h = t.i18n("measure_distance_ground", {gdist: i.formatDistance(this._groundDistance)});
                this._toolContainerText = "<b>" + h + "</b><br>" + this._toolContainerText, this._listControl.add({
                    text: h,
                    header: undefined
                }), this._listControl.add({text: "", header: undefined})
            } else this._listControl.add({text: ""});
            this._listControl.add({text: s}), this._listControl.add({text: o}), this._listControl.add({text: a}), this._listControl.add({text: u})
        }
    }, p.prototype.asyncUpdateElevationAndSlopeDiff = function () {
        var t = this, n = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.FirstPoint),
            r = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.LastPoint);
        n.onTerrain = this.FirstPoint.onTerrain, r.onTerrain = this.LastPoint.onTerrain;
        var i = TerraExplorer.functions.queryBestLevel(n), s = TerraExplorer.functions.queryBestLevel(r);
        Cesium.when.all([i, s], function (i) {
            if (d === null) return;
            var s = Math.min(i[0], i[1]), o = Cesium.sampleTerrain(viewer.terrainProvider, s, [n, r]);
            Cesium.when(o, e.proxy(function (e) {
                e[0].onTerrain == 0 && (e[0] = viewer.scene.globe.ellipsoid.cartesianToCartographic(t.FirstPoint)), e[1].onTerrain == 0 && (e[1] = viewer.scene.globe.ellipsoid.cartesianToCartographic(t.LastPoint)), t._elevationDifference = e[1].height - e[0].height;
                var i = u.geoDist2D(n, r);
                t._slopFirstToLast = Cesium.Math.toDegrees(Math.atan2(t._elevationDifference, i)), t.updateDistanceText(), t._levelToSample = s
            }, this))
        })
    };
    var v = null, m = null, g = null, y = null, b = [];
    return p.prototype.onClickUpdate = function (e, t, n, r) {
        if (c.IsMultiGestureNavigation) return;
        if (e.length !== m.length + 1) return;
        r !== undefined && r.isPrimitive && (this._isOnPrimitive = r.isPrimitive);
        var r = {}, s = e[t];
        this._beforeLastUpdatedpoint = s;
        if (s) {
            this._groundDistance = 0, this._linesGroundDistances = [], this._samplesPerLineIndex = [];
            var o = m.add({position: s, image: "img/point_white.png", eyeOffset: Cesium.DynamicEyeOffset()});
            o.position.onTerrain = !Cesium.defined(this._isOnPrimitive), m.length == 1 && !o.position.onTerrain && this.ToolContainer.enableButton("3", !1), m.length > 0 && this.ToolContainer.enableButton("1", !0);
            if (m.length > 1) {
                this.ToolContainer.enableButton("2", !0), this.ToolContainer.enableButton("4", !0);
                var a = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.BeforeLastPoint),
                    f = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.LastPoint), l = u.geoDist(a, f);
                this._totalArealDist += l, this._totalHorizontalDist += u.geoDist2D(a, f), this._bboxObj = Cesium.BoundingRectangle.fromPoints(e), this.distanceCondition = (this._bboxObj.width + this._bboxObj.height) * 2, this.asyncUpdateElevationAndSlopeDiff();
                var h = v.add(TerraExplorer.style.analysisLabelOptions(i.formatDistance(l, !0, !0), this.BeforeLastPoint, this.LastPoint, this.distanceCondition));
                h.objNumber = l, h.createLabelText = function () {
                    return TerraExplorer.internal.Units.formatDistance(this.objNumber, !0, !0)
                }
            }
            this.updateDistanceText()
        }
    }, p.prototype.showTotalDistanceLabel = function (e, n) {
        g !== null ? g.remove(g.get(g.length - 1)) : (g = new Cesium.LabelCollection, viewer.scene.primitives.add(g));
        var r;
        n ? r = this._totalArealDist + n : r = this._totalArealDist;
        var s = t.i18n("measure_distance_Total_distance", {adist: i.formatDistance(r, !0, !0)});
        if (e !== undefined) {
            var o = Cesium.Cartographic.fromCartesian(e);
            g.add(TerraExplorer.style.analysisLabelOptions(s, o, null, (this._bboxObj.width + this._bboxObj.height) * 2, {
                color: new Cesium.Color(.12, .12, .12, 1),
                backgroundColor: new Cesium.Color(1, .84, 0, 1),
                pixelOffset: new Cesium.Cartesian2(0, -20),
                isLowResOriginal: this._isLowResOriginal
            })), g.get(g.length - 1).objNumber = r, g.get(g.length - 1).createLabelText = function () {
                return t.i18n("measure_distance_Total_distance", {adist: TerraExplorer.internal.Units.formatDistance(this.objNumber, !0, !0)})
            }
        }
    }, p.prototype.isDistanceOnTerrain = function () {
        for (var e = 0; e < m.length; e++) if (!m.get(e).onTerrain) return !1;
        return !0
    }, p.prototype.onRightClick = function (e) {
    }, p.prototype.doWork = function (e) {
        this.calculateGroundDistance(undefined, e)
    }, w.inheritsFrom(Cesium.Cartographic), Cesium.defineProperties(w.prototype, {
        height: {
            get: function () {
                return this._height
            }, set: function (e) {
                this._height = e, this.onHeightSet != null && this.onHeightSet(this._requestID)
            }
        }
    }), w.prototype.onHeightSet = null, p.prototype.calculateGroundDistance = function (t, n) {
        var r = this;
        e(".containerButton").css("left", "2px"), e(".containerView").css("left", "120px");
        if (m.length < 2) return -1;
        if (t <= 0 || t == undefined) this._totalArealDist < 100 ? t = .5 : this._totalArealDist < 1e3 ? t = 1 : t = this._totalArealDist / 1e3;
        var i = this._groundDistanceRequestID, s = new Array;
        b = [];
        var o = viewer.scene.globe.ellipsoid.cartesianToCartographic(m.get(0)._position);
        s.push(new w(o, i));
        for (var a = 1; a < m.length; a++) {
            var f = m.get(a - 1)._position, l = m.get(a)._position;
            if (f === undefined || l === undefined) return -1;
            var c = Cesium.Cartesian3.distance(f, l);
            b.push(f), b.push(l);
            var h = viewer.scene.globe.ellipsoid.cartesianToCartographic(f),
                p = viewer.scene.globe.ellipsoid.cartesianToCartographic(l);
            if (t > c) {
                s.push(new w(p, i));
                continue
            }
            var d = new Cesium.Cartesian3, v = t / c;
            for (var g = v; g < 1; g += v) Cesium.Cartesian3.lerp(f, l, g, d), s.push(new w(viewer.scene.globe.ellipsoid.cartesianToCartographic(d), i));
            s.push(new w(p, i)), this._samplesPerLineIndex.push(s.length)
        }
        var E = s.length, S = 0, x = 0;
        w.prototype.onHeightSet = e.proxy(function (e) {
            if (e != this._groundDistanceRequestID) return;
            S++;
            var t = Math.ceil(S / E * 100);
            t > x && (this.setProgress(S, E), x = t)
        }, this);
        var T = {};
        T.positions = b, T.clampToGround = !0, T.width = 3, T.material = Cesium.Color.WHITE, T.distanceDisplayCondition = TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayCondition(0, this.distanceCondition), y !== null && viewer.entities.remove(y), y = viewer.entities.add(new Cesium.Entity({polyline: T})), this._currentObject !== undefined && (this._currentObject.entities.groundLine = y);
        var N = Cesium.sampleTerrain(viewer.terrainProvider, r._levelToSample, s);
        Cesium.when(N, e.proxy(function (e) {
            if (i != this._groundDistanceRequestID) return;
            this._groundDistance = 0;
            var t = 0;
            for (var r = 0; r < e.length - 1; r++) {
                e[r].height == undefined && (e[r].height = 0), e[r + 1].height == undefined && (e[r + 1].height = 0);
                var s = u.geoDist(e[r], e[r + 1]);
                this._linesGroundDistances[t] == undefined ? this._linesGroundDistances.push(s) : this._linesGroundDistances[t] += s, r + 1 > this._samplesPerLineIndex[t] && t++
            }
            this._currentObject !== undefined && (this._currentObject.linesGroundDistances = this._linesGroundDistances), this.setProgress(e.length, e.length), n != undefined && n(), this._viewMode && this.ToolContainer.enableButton("2", !1)
        }, this))
    }, p.prototype.onAbort = function (e) {
        d = null, m.removeAll(), v.removeAll(), g.removeAll(), this.reset(), e.abortReason == this.drawingTool.ABORT_REASONS.ESC_KEY && setTimeout(function () {
            TerraExplorer.tools.ToolManager.openTool("DistanceTool")
        }, 0)
    }, p.prototype.createDistanceObject = function (e, n, r) {
        var s = TerraExplorer.internal.Project;
        m !== null && m.removeAll(), v !== null && v.removeAll(), m = new Cesium.BillboardCollection, viewer.scene.primitives.add(m), v = new Cesium.LabelCollection, viewer.scene.primitives.add(v), this._isLowResOriginal === null && (this._isLowResOriginal = viewer.scene.globe._surface._debug.maxDepth < 6), this._bboxObj = Cesium.BoundingRectangle.fromPoints(e), this.distanceCondition = (this._bboxObj.width + this._bboxObj.height) * 2;
        for (var o = 0; o < e.length; o++) {
            var a = m.add({
                position: e[o],
                image: "img/point_white.png",
                eyeOffset: Cesium.DynamicEyeOffset(),
                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, this.distanceCondition)
            });
            if (o > 0) {
                var f = m._billboards[o - 1].position, l = m._billboards[o].position,
                    c = viewer.scene.globe.ellipsoid.cartesianToCartographic(f),
                    h = viewer.scene.globe.ellipsoid.cartesianToCartographic(l), p = u.geoDist(c, h),
                    d = v.add(TerraExplorer.style.analysisLabelOptions(i.formatDistance(p, !0, !0), f, l, this.distanceCondition, {isLowResOriginal: this._isLowResOriginal}));
                d.objNumber = p, d.createLabelText = function () {
                    return TerraExplorer.internal.Units.formatDistance(this.objNumber, !0, !0)
                }
            }
        }
        var b = new Cesium.PrimitiveCollection;
        viewer.scene.primitives.add(b);
        var w = new Cesium.PrimitiveCollection;
        viewer.scene.primitives.add(w);
        for (var o = 0; o < e.length - 1; o++) {
            var a = b.add(new Cesium.Primitive({
                geometryInstances: new Cesium.GeometryInstance({
                    geometry: new Cesium.PolylineGeometry({
                        positions: [e[o], e[o + 1]],
                        ellipsoid: Cesium.Ellipsoid.WGS84,
                        vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT,
                        width: 2,
                        followSurface: !0
                    }),
                    attributes: {
                        color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1, .84, 0, .4)),
                        distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, this.distanceCondition * 20 + 2)
                    }
                }),
                asynchronous: !1,
                allowPicking: !1,
                shadows: Cesium.ShadowMode.DISABLED,
                isAnalysisPrimitive: !0,
                appearance: new Cesium.PolylineColorAppearance({})
            }));
            a.positions = [e[o], e[o + 1]], a.appearance.renderState.depthTest.enabled = !1, a.isAnalysisPrimitive = !0;
            var E = w.add(new Cesium.Primitive({
                geometryInstances: new Cesium.GeometryInstance({
                    geometry: new Cesium.PolylineGeometry({
                        positions: [e[o], e[o + 1]],
                        ellipsoid: Cesium.Ellipsoid.WGS84,
                        vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT,
                        width: 2,
                        followSurface: !0
                    }),
                    attributes: {
                        color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1, .8, 0, 1)),
                        distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, this.distanceCondition * 20 + 2)
                    }
                }),
                asynchronous: !1,
                allowPicking: !1,
                shadows: Cesium.ShadowMode.DISABLED,
                isAnalysisPrimitive: !0,
                appearance: new Cesium.PolylineColorAppearance({translucent: !1})
            }));
            E.appearance.renderState.depthTest.enabled = !0
        }
        E !== undefined && (E.isAnalysisPrimitive = !0), this.showTotalDistanceLabel(e[e.length - 1]);
        var S = Cesium.BoundingSphere.fromPoints(e);
        this._numObj++, m.toSave = !0;
        var x = {
            id: Cesium.createGuid(),
            type: TerraExplorer.internal.Project.ObjectsTypes.DISTANCE,
            bs: S,
            tool: this.getId(),
            isLowResOriginal: this._isLowResOriginal,
            arealDist: this._totalArealDist,
            totalHorizontalDist: this._totalHorizontalDist,
            slope: this._slopFirstToLast,
            elevationDiff: this._elevationDifference,
            linesGroundDistances: this._linesGroundDistances,
            defaultName: t.i18n("DistanceObj_DefaultName"),
            isOnPrimitive: this._isOnPrimitive,
            prims: [b, m, w, v, g],
            entities: [y],
            timestamp: Cesium.defaultValue(r, Date.now())
        };
        x.flyTo = function () {
            viewer.camera.flyToBoundingSphere(x.bs)
        }, x.delete = function () {
            TerraExplorer.internal.Project.deleteObject(x)
        }, Object.defineProperty(x, "show", {
            "default": !0, get: function () {
                return x.prims[0].show
            }, set: function (e) {
                this.prims.forEach(function (t) {
                    t instanceof Cesium.BillboardCollection ? t._billboards.forEach(function (t) {
                        t.show = e
                    }) : t instanceof Cesium.LabelCollection ? t._labels.forEach(function (t) {
                        t.show = e
                    }) : t.show = e
                }), this.entities.groundLine !== undefined && (this.entities.groundLine.show = e)
            }
        }), Object.defineProperty(x, "displayName", {
            "default": !0, get: function () {
                return x.name
            }, set: function (e) {
                x.name = e
            }
        });
        if (n !== undefined && n.indexOf(t.i18n("DistanceObj_DefaultName")) > -1) {
            var T = Number(n.split("#")[1]);
            s._allAvailableObjectsNames[s._objectTypes.DISTANCE] === undefined && (s._allAvailableObjectsNames[s._objectTypes.DISTANCE] = new Array(s._objectsMaxNumber.distance)), s._allAvailableObjectsNames[s._objectTypes.DISTANCE][T] = !0
        }
        return x.name = n ? n : TerraExplorer.internal.Project.getAvailableDefaultName(x), TerraExplorer.internal.Project.addToObjectList(x), x
    }, p.prototype.createObj = function (e) {
        this._totalArealDist = e.arealDist, this._totalHorizontalDist = e.totalHorizontalDist, this._slopFirstToLast = e.slope, this._elevationDifference = e.elevationDiff, this._isLowResOriginal = e.isLowResOriginal, this._isOnPrimitive = e.isOnPrimitive;
        var t = this.createDistanceObject(e.prims, e.name, e.timestamp);
        return E(), t
    }, p.prototype.onFinish = function (t) {
        if (t.length < 2) {
            e("#headerDivContainer #CloseImg").length > 0 && e("#headerDivContainer #CloseImg")[0].click();
            return
        }
        v.remove(v.get(v.length - 1));
        var n = this.createDistanceObject(t);
        TerraExplorer.tools.ToolManager.openTool("DistanceTool", n), e(e(".selectedLine img")[0]).length > 0 && e(".selectedLine img")[0].click(), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("4", !1)
    }, p.prototype.onMouseMove = function (e) {
        this._lastMovedPoint = e;
        if (this._beforeLastUpdatedpoint !== undefined && !Cesium.Cartesian3.equals(e, this._beforeLastUpdatedpoint)) {
            v.remove(v.get(v.length - 1));
            var t = viewer.scene.globe.ellipsoid.cartesianToCartographic(this._beforeLastUpdatedpoint),
                n = viewer.scene.globe.ellipsoid.cartesianToCartographic(e), r = u.geoDist(t, n),
                s = v.add(TerraExplorer.style.analysisLabelOptions(i.formatDistance(r, !0, !0), this._beforeLastUpdatedpoint, e));
            s.objNumber = r, s.createLabelText = function () {
                return TerraExplorer.internal.Units.formatDistance(this.objNumber, !0, !0)
            }, this.updateDistanceText(), m.length > 1 && this.showTotalDistanceLabel(e, r)
        }
    }, p.prototype.workCompleted = function () {
        this.CancelWork == 0 && this.updateDistanceText(), this._groundDistanceRequestID++
    }, p
}), define("tools/TETools/AreaTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "internal/InputMode", "./ProgressTool", "internal/GeometryHelper", "internal/NotificationCenter", "tools/ToolDialog", "tools/ListControl", "internal/Navigate", "./LayersStorage", "turf.min"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p) {
    "use strict";

    function b(e, t, n) {
        this.longitude = e.longitude, this.latitude = e.latitude, this._height = e.height, this._requestID = t, this._vertexIndex = n, this._heightWasSet = !1
    }

    function w() {
        m = null, g = null
    }

    function E(e, t) {
        return new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.PolylineGeometry({
                    positions: e,
                    ellipsoid: Cesium.Ellipsoid.WGS84,
                    vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT,
                    width: 2,
                    followSurface: !1
                }),
                attributes: {
                    color: Cesium.ColorGeometryInstanceAttribute.fromColor(t ? new Cesium.Color(1, .84, 0, .75) : new Cesium.Color(1, .84, 0, .4)),
                    distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, TerraExplorer.tools.ToolManager._tools.AreaTool._perimeter * 30)
                }
            }),
            asynchronous: !1,
            allowPicking: !1,
            shadows: Cesium.ShadowMode.DISABLED,
            isAnalysisPrimitive: !0,
            appearance: new Cesium.PolylineColorAppearance({translucent: !0, renderState: {depthTest: {enabled: t}}})
        })
    }

    function S(e, t) {
        return new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.PolygonGeometry({
                    polygonHierarchy: {
                        positions: e,
                        holes: []
                    },
                    ellipsoid: Cesium.Ellipsoid.WGS84,
                    perPositionHeight: !0,
                    vertexFormat: Cesium.VertexFormat.POSITION_AND_COLOR
                }),
                attributes: {
                    color: Cesium.ColorGeometryInstanceAttribute.fromColor(t ? new Cesium.Color(1, .84, 0, .75) : new Cesium.Color(1, .84, 0, .4)),
                    distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, TerraExplorer.tools.ToolManager._tools.AreaTool._perimeter * 30)
                }
            }),
            asynchronous: !1,
            allowPicking: !1,
            shadows: Cesium.ShadowMode.DISABLED,
            isAnalysisPrimitive: !0,
            appearance: new Cesium.PerInstanceColorAppearance({
                addZBias: !0,
                flat: !0,
                renderState: {
                    depthTest: {enabled: t},
                    lineWidth: Cesium.Math.clamp(2, Cesium.ContextLimits.minimumAliasedLineWidth, Cesium.ContextLimits.maximumAliasedLineWidth)
                }
            })
        })
    }

    var d = function () {
        this._layersStorage = h.DefaultStorage, this._explanationText = t.i18n("analysis_area_explanation_text"), this._explanationTextOnStartOnly = !0, this._eventListener = null, this.selectedPlaneMode = "", this.isPlaneMode = !0, this._surfaceTrianglesIds = [], this._areaPolygon = null, this._areaPolygon2 = null, this._surfaceAreaRequestID = 0, this._isOnPrimitive = !1, this._planeForAreaCalc = null, this._trianglesToDraw = [], this._viewMode = !1, this._levelToSample = Number.MAX_VALUE, this._propertiesToSave = {
            name: !0,
            tool: !0,
            type: !0,
            prims: !0,
            area: !0,
            isOnPrimitive: !0,
            surfaceArea: !0,
            horizontalArea: !0,
            perimeter: !0,
            timestamp: !0
        }, this.getId = function () {
            return "AreaTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Analyze_Area"), "./img/newDesign/analyze_area.png", 17, r.MenuEntryAnalyze(), t.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }, this.open = function (e) {
            e ? (this._viewMode = !0, this._areaPolygon = e.prims[0], m = e.prims[1], g = e.prims[2], this._areaPolygon2 = e.prims[3], this._currentObject = e) : (this._viewMode = !1, this._currentObject = undefined, this.isPlaneMode = !0)
        }
    };
    d.inheritsFrom(o), Cesium.defineProperties(d.prototype, {}), d.prototype.reset = function () {
        this._toolContainerText = "", this._listControl != null && this._listControl.removeAll(), this._planeForAreaCalc = null, this._viewMode || (this._areaPolygon = null, this._areaPolygon2 = null), this._isOnPrimitive = !1, this._levelToSample = Number.MAX_VALUE, this._surfaceArea = 0, this._area = 0, this._horizontalArea = 0, this._perimeter = 0, this._trianglesGeometry = null, this._verticeToIndices = [], this._selfIntersect = !1, this._calculating = !1, this.ToolContainer.enableButton(1, !1), this.ToolContainer.enableButton(2, !1), this.ToolContainer.enableButton(3, !1), this.ToolContainer.enableButton(4, !1)
    }, d.prototype.removeSurfaceTriangles = function () {
        y !== null && y.removeAll(), this._surfaceTrianglesIds = []
    }, d.prototype.onOpenedToolContainer = function () {
        this._explanationTextOnStartOnly = !1, this._currentObject !== undefined && this._currentObject.name !== undefined ? (this._currentObject.isPlaneMode !== undefined && (this._currentObject.isPlaneMode ? this.selectedPlaneMode = t.i18n("area_Tooltip_3D_Plane") : this._currentObject.isPlaneMode || (this.selectedPlaneMode = t.i18n("area_Horizontal_Mode"))), e("#headerDivContainer span:first")[0].innerText = this._currentObject.name + " - " + this.selectedPlaneMode, this.updateAreaText()) : (this._toolContainer._selectedButtons.planeMode ? this.selectedPlaneMode = t.i18n("area_Tooltip_3D_Plane") : this.selectedPlaneMode = t.i18n("area_Horizontal_Mode"), e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Analyze_Area") + " - " + this.selectedPlaneMode))
    }, d.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0
    };
    var v = null, m = null, g = null, y = null;
    return d.prototype.onBeforeOpenToolContainer = function () {
        return s.Mode = s.MEASUREMENT, e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this._viewMode || (this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this.drawingTool = TerraExplorer.internal.DrawingTool, m = new Cesium.BillboardCollection, viewer.scene.primitives.add(m), g = new Cesium.LabelCollection, viewer.scene.primitives.add(g), y = new Cesium.PrimitiveCollection, viewer.scene.primitives.add(y), v = this.drawingTool.drawPolygon({
            AltitudeMethod: this.drawingTool.ALTITUDE_METHODS.RELATIVE_TO_MODEL,
            Altitude: .01,
            onPointUpdate: e.proxy(this.onClickUpdate, this),
            onFinish: e.proxy(this.onFinish, this),
            onAbort: e.proxy(this.onAbort, this),
            onMouseMove: e.proxy(this.onMouseMove, this),
            style: {
                fill: !0,
                material: new Cesium.Color(1, .84, 0, .75),
                outline: !0,
                outlineColor: new Cesium.Color(1, .84, 0, 1),
                outlineWidth: 2
            },
            intersectionStyle: {fill: !1, outline: !0, outlineColor: Cesium.Color.RED, outlineWidth: 2},
            onIntersection: e.proxy(this.onIntersection, this),
            planeMode: !0
        })), this.parent.onBeforeOpenToolContainer.call(this), this.showNormalButtons(), this._viewMode ? (this.updateParameters(), this.updateAreaText(), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("horizontalMode", !1), this.ToolContainer.enableButton("planeMode", !1), this._currentObject !== undefined && (this._currentObject.isOnPrimitive || this._currentObject.isPlaneMode) && this.ToolContainer.enableButton("3", !1), this.ToolContainer.enableButton("4", !1)) : (this.reset(), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText), this._toolContainer.selectButton("planeMode", !0)), a.addObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, d.prototype.onBeforeCloseToolContainer = function (e) {
        return this.parent.onBeforeCloseToolContainer.call(this, e), v !== null && this.drawingTool !== undefined && this.drawingTool.Active && (e == 2 || e == 1 && !this._viewMode) && v.abort(), this._viewMode || this.reset(), s.Mode = s.FREE_FLIGHT, f.IsOpen && f.close(), a.removeObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, d.prototype.getPrimsToSave = function (e) {
        var t = [];
        return e.forEach(function (e) {
            e.toSave && e._billboards.forEach(function (e) {
                t.push(e.position)
            })
        }), t
    }, d.prototype.showNormalButtons = function () {
        this.ToolContainer.removeButtons();
        var e = TerraExplorer.tools.ToolContainer.buttonType;
        this.ToolContainer.addButton(1, "./img/delete.png", undefined, t.i18n("measure_area_tooltip_delete")), this.ToolContainer.addButton(2, "./img/delete_last_point.png", undefined, t.i18n("measure_area_tooltip_delete_last_point")), this.ToolContainer.addButton(undefined, undefined, undefined, undefined, this.ToolContainer.buttonType.SEPARATOR), this.ToolContainer.addButton("horizontalMode", "./img/newDesign/horizontal_area.png", undefined, t.i18n("area_Tooltip_Horizontal"), e.RADIO_BUTTON), this.ToolContainer.addButton("planeMode", "./img/newDesign/3d_palne_area.png", undefined, t.i18n("area_Tooltip_3D_Plane"), e.RADIO_BUTTON, !0), this.ToolContainer.addButton(undefined, undefined, undefined, undefined, this.ToolContainer.buttonType.SEPARATOR), this.ToolContainer.addButton(3, "./img/calc_area.png", undefined, t.i18n("measure_area_tooltip_ground_area")), this.ToolContainer.addButton(4, "./img/newDesign/measurement_v.png", undefined, t.i18n("measure_finish_drawing_tool")), this.ToolContainer.RadioButtons = ["horizontalMode", "planeMode"]
    }, d.prototype.unitsChanged = function (e) {
        this.updateAreaText();
        if (m !== undefined) {
            var t = [];
            m._billboards.forEach(function (e) {
                t.push(e._position)
            }), this.CalculateCenterOfAreaPolygon(t)
        }
    }, d.prototype.onButtonClick = function (e) {
        this.parent.onButtonClick.call(this, e);
        switch (e) {
            case 1:
                this.drawingTool !== undefined && this.drawingTool.Active && this.drawingTool.abortDrawing(), this._viewMode ? TerraExplorer.internal.Project.deleteObject(this._currentObject) : (this.reset(), this.updateAreaText(), this.ToolContainer._toolDelegate !== undefined && this.onBeforeOpenToolContainer());
                break;
            case 2:
                this.drawingTool.cancellationCallback();
                if (m.length > 0) {
                    var n = m.get(m.length - 1);
                    m.remove(n), this.updateParameters(), this.updateAreaText(), this.removeSurfaceTriangles();
                    var r = [];
                    for (var i = 0; i < m._billboards.length; i++) r[i] = m._billboards[i].position;
                    m.length == 0 && (this.ToolContainer.enableButton(1, !1), this.ToolContainer.enableButton(2, !1), this.ToolContainer.enableButton(3, !1), this.ToolContainer.enableButton(4, !1)), m.length < 3 && this._toolContainer.enableButton(4, !1), this.CalculateCenterOfAreaPolygon(r)
                }
                break;
            case 3:
                if (m.length > 2) {
                    if (this._selfIntersect) {
                        alert(t.i18n("measure_area_cannot_calculate_area"));
                        return
                    }
                    this.doWorkAsync()
                }
                break;
            case"horizontalMode":
                this.isPlaneMode = !1, this.setPlaneMode(this.isPlaneMode);
                break;
            case"planeMode":
                this.isPlaneMode = !0, this.setPlaneMode(this.isPlaneMode);
                break;
            case 4:
                if (this._selfIntersect) {
                    alert(t.i18n("measure_area_cannot_calculate_area"));
                    return
                }
                this.drawingTool.finishDrawing()
        }
    }, d.prototype.setPlaneMode = function (n) {
        var r;
        n ? r = "3D Plane Mode" : r = "Horizontal Mode", e("#headerDivContainer span:first")[0].innerText = t.i18n("Menu_Analyze_Area") + " - " + r, this.updateAreaText(), this.drawingTool._planeMode = !this.drawingTool._planeMode
    }, d.prototype.updateAreaText = function () {
        if (this._surfaceArea == 0 && this._area == 0 && this._horizontalArea == 0 && this._perimeter == 0 && this._currentObject !== undefined) this._toolContainerText = ""; else {
            this._currentObject !== undefined && (this._surfaceArea = this._currentObject.surfaceArea, this._area = this._currentObject.area, this._horizontalArea = this._currentObject.horizontalArea, this._perimeter = this._currentObject.perimeter);
            var n = e("<div style='position:relative;overflow:hidden; width:100%; height:100%;'></div>"),
                r = e("<div id='MessageClientId' style='position:relative; margin-left:5px; margin-top:0px; overflow-y:auto; width:100%;'></div>");
            n.append(r), TerraExplorer.tools.ToolContainer.setText(""), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), e("#LowerView").append(n), r.css({height: n.height()}), this._listControl = new l(r), this._listControl.IsAnalyzeToolList = !0;
            var s = t.i18n("measure_area_horizontalArea", {area: i.formatArea(this._horizontalArea)}),
                o = t.i18n("measure_area_area", {area: i.formatArea(this._area)}),
                u = t.i18n("measure_area_perimeter", {perimeter: i.formatDistance(this._perimeter)});
            if (this._surfaceArea > 0) {
                var a = t.i18n("measure_area_ground", {gsurface: i.formatArea(this._surfaceArea)});
                this._listControl.add({text: a, header: !0}), this._listControl.add({text: ""})
            }
            this.isPlaneMode && this._listControl.add({text: o}), this._listControl.add({text: s}), this._listControl.add({text: u})
        }
    }, d.prototype.onClickUpdate = function (e, t, n, r) {
        var i = this;
        r !== undefined && r.isPrimitive && (this._isOnPrimitive = r.isPrimitive);
        if (c.IsMultiGestureNavigation) return;
        if (y !== null && y.length > 0) return;
        var r = {}, s;
        if (this._planeForAreaCalc == null) s = e[t]; else {
            var o = viewer.camera.getPickRay(e[t]), a = Cesium.IntersectionTests.rayPlane(o, this._planeForAreaCalc);
            a == undefined && (Cesium.Cartesian3.negate(o.direction, o.direction), a = Cesium.IntersectionTests.rayPlane(o, this._planeForAreaCalc)), a != undefined && (s = a)
        }
        if (s) {
            var f = TerraExplorer.functions.queryBestLevel(viewer.scene.globe.ellipsoid.cartesianToCartographic(s));
            Cesium.when(f, function (e) {
                i._levelToSample = Math.min(e, i._levelToSample)
            }), m.removeAll();
            for (var l = 0; l < e.length; l++) {
                var h = m.add({position: e[l], image: "img/point_white.png", eyeOffset: Cesium.DynamicEyeOffset()});
                h.position.onTerrain = !Cesium.defined(this._isOnPrimitive)
            }
            m.length == 1 && !h.position.onTerrain && this.ToolContainer.enableButton(3, !1), this.updateParameters(), this.updateAreaText()
        }
        if (m.length < 3) this._planeForAreaCalc = null; else if (m.length == 3) {
            var p = m.get(0).position, d = m.get(1).position, v = m.get(2).position;
            this._planeForAreaCalc = u.getPlaneFromPoints(p, d, v), this.updateParameters(), this.updateAreaText()
        }
        m.length > 2 && this.CalculateCenterOfAreaPolygon(e)
    }, d.prototype.CalculateCenterOfAreaPolygon = function (e) {
        g.removeAll();
        var n = [], r = 0;
        e.forEach(function (e) {
            var t = viewer.scene.globe.ellipsoid.cartesianToCartographic(e);
            n.push([Cesium.Math.toDegrees(t.longitude), Cesium.Math.toDegrees(t.latitude)]), r = Math.max(r, t.height)
        }), n.push(n[0]);
        if (n.length > 3) try {
            var s = p.polygon([n]), o = p.centerOfMass(s), u;
            this.isPlaneMode ? u = t.i18n("measure_area_area", {area: i.formatArea(this._area)}) : u = t.i18n("measure_area_horizontalArea", {area: i.formatArea(this._horizontalArea)});
            var a = Cesium.Cartographic.fromDegrees(o.geometry.coordinates[0], o.geometry.coordinates[1]);
            a.height = r, g.add(TerraExplorer.style.analysisLabelOptions(u, a, null, this._perimeter))
        } catch (f) {
        }
    }, d.prototype.updateParameters = function () {
        var e = [];
        for (var t = 0; t < m.length; t++) e.push(m.get(t).position);
        this._selfIntersect = u.isSelfIntersect(e), m.length > 0 && (this.ToolContainer.enableButton("1", !0), this.ToolContainer.enableButton("2", !0), this._toolContainer.enableButton("horizontalMode", !1), this._toolContainer.enableButton("planeMode", !1)), m.length > 2 && this.ToolContainer.enableButton("4", !0), m.length < 3 && (this._planeForAreaCalc = null, this.ToolContainer.enableButton("4", !1)), this._planeForAreaCalc != null && (this._area = u.area3DPlanarPolygon(e, this._planeForAreaCalc)), this._horizontalArea = u.calcArea2D(e), e = [];
        for (var t = 0; t < m.length; t++) e.push(m.get(t).position);
        this._perimeter = 0;
        for (var t = 0; t < e.length - 1; t++) this._perimeter += u.geoDist3D(e[t], e[t + 1]);
        e.length > 2 && (this._perimeter += u.geoDist3D(e[e.length - 1], e[0])), this._viewMode && this.ToolContainer.enableButton("2", !1)
    }, d.prototype.doWork = function (e) {
        this.calculateSurfaceArea(undefined, e)
    }, b.inheritsFrom(Cesium.Cartographic), Cesium.defineProperties(b.prototype, {
        height: {
            get: function () {
                return this._height
            }, set: function (e) {
                this._height = e, this.onHeightSet != null && (this._heightWasSet = !0, this.onHeightSet(this._requestID, this._vertexIndex))
            }
        }
    }), b.prototype.onHeightSet = null, d.prototype.calculateSurfaceArea = function (t, n) {
        e(".containerButton").css("left", "2px"), e(".containerView").css("left", "120px"), this._surfaceArea = 0, this.updateAreaText(), this._calculating = !0, viewer.scene.preRender.addEventListener(this.onPreFrame, this);
        var r = this._surfaceAreaRequestID, i = [];
        for (var s = 0; s < m.length; s++) i.push(m.get(s).position);
        this._trianglesGeometry = u.getGeometrySubdevision(i);
        var o = [], a = this._trianglesGeometry.geometry.indices,
            f = this._trianglesGeometry.geometry.attributes.position.values;
        this._verticeToIndices = [];
        for (var s = 0; s < a.length; s++) {
            var l = a[s];
            this._verticeToIndices[l] == undefined && (this._verticeToIndices[l] = []), this._verticeToIndices[l].push(s)
        }
        var c = f.length;
        for (var s = 0; s < c; s += 3) {
            var h = f[s + 0], p = f[s + 1], d = f[s + 2], v = new Cesium.Cartesian3(h, p, d),
                g = viewer.scene.globe.ellipsoid.cartesianToCartographic(v);
            o.push(new b(g, r, s / 3))
        }
        var y = o.length, w = {}, E = 0;
        b.prototype.onHeightSet = e.proxy(function (e, t) {
            if (e != this._surfaceAreaRequestID) return;
            w[t] = 1;
            var n = Object.keys(w).length, r = Math.ceil(n / y * 100);
            r > E && (this.setProgress(n, y), E = r), this.prepareTrianglesForDraw(o, t)
        }, this);
        var S = Cesium.sampleTerrain(viewer.terrainProvider, this._levelToSample, o);
        Cesium.when(S, e.proxy(function (t) {
            if (r != this._surfaceAreaRequestID) return;
            var i = this._trianglesGeometry.geometry.indices;
            this._surfaceArea = 0;
            var s = [], o = i.length;
            for (var a = 0; a < o; a++) {
                t[i[a]].height == undefined && (t[i[a]].height = 0);
                var f = viewer.scene.globe.ellipsoid.cartographicToCartesian(t[i[a]]);
                s.push(f), s.length == 3 && (this._surfaceArea += u.TriArea(s[0], s[1], s[2]), s = [])
            }
            this._currentObject !== undefined && (this._currentObject.surfaceArea = this._surfaceArea, this._layersStorage.saveItem(this._currentObject), e(e(".selectedLine img")[0]).length > 0 && e(".selectedLine img")[0].click()), this.setProgress(t.length, t.length), n != undefined && n(), this._viewMode && (this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("4", !1))
        }, this))
    }, d.prototype.onAbort = function (e) {
        v = null, m.removeAll(), g.removeAll(), this.reset(), e && e.abortReason == this.drawingTool.ABORT_REASONS.ESC_KEY && setTimeout(function () {
            TerraExplorer.tools.ToolManager.openTool("AreaTool")
        }, 0)
    }, d.prototype.onFinish = function (t, n, r) {
        if (t.length < 3) {
            e("#headerDivContainer #CloseImg").length > 0 && e("#headerDivContainer #CloseImg")[0].click();
            return
        }
        if (r !== undefined && r.isSelfIntersect) {
            n();
            return
        }
        var i = this.createAreaObject(t);
        TerraExplorer.tools.ToolManager.openTool("AreaTool", i), e(e(".selectedLine img")[0]).length > 0 && e(".selectedLine img")[0].click(), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("4", !1)
    }, d.prototype.createObj = function (e) {
        m = new Cesium.BillboardCollection, viewer.scene.primitives.add(m);
        for (var t = 0; t < e.prims.length; t++) var n = m.add({
            position: e.prims[t],
            image: "img/point_white.png",
            eyeOffset: Cesium.DynamicEyeOffset(),
            translucencyByDistance: new Cesium.NearFarScalar(0, 1, this._perimeter * 10, 0)
        });
        this._area = e.area, this._surfaceArea = e.surfaceArea, this._horizontalArea = e.horizontalArea, this._perimeter = e.perimeter, this._isOnPrimitive = e.isOnPrimitive;
        var r = this.createAreaObject(e.prims, e.name, e.timestamp);
        return w(), r
    }, d.prototype.createAreaObject = function (e, n, r) {
        var i = TerraExplorer.internal.Project, s = new Cesium.PrimitiveCollection;
        viewer.scene.primitives.add(s);
        var o = new Cesium.PrimitiveCollection;
        viewer.scene.primitives.add(o), m != null && (viewer.scene.primitives.remove(m), m = new Cesium.BillboardCollection, viewer.scene.primitives.add(m)), g != null && viewer.scene.primitives.remove(g), g = new Cesium.LabelCollection, viewer.scene.primitives.add(g), this._areaPolygon != null && viewer.scene.primitives.remove(this._areaPolygon), this._areaPolygon2 != null && viewer.scene.primitives.remove(this._areaPolygon2);
        for (var a = 0; a < e.length; a++) m.add({
            position: e[a],
            image: "img/point_white.png",
            eyeOffset: Cesium.DynamicEyeOffset(),
            translucencyByDistance: new Cesium.NearFarScalar(0, 1, this._perimeter * 10, 0)
        });
        e.length > 2 && this.CalculateCenterOfAreaPolygon(e), this._selfIntersect = u.isSelfIntersect(e);
        var f = [];
        f = e.slice(), f.push(f[0]), s.add(E(f, !0)), s.add(S(e, !0));
        var l = o.add(E(f, !1)), c = o.add(S(e, !1));
        l.appearance.translucent = !1, c.appearance.translucent = !1;
        var h = Cesium.BoundingSphere.fromPoints(e);
        m.toSave = !0;
        var p = {
            id: Cesium.createGuid(),
            type: TerraExplorer.internal.Project.ObjectsTypes.AREA,
            bs: h,
            tool: this.getId(),
            surfaceArea: this._surfaceArea,
            area: this._area,
            horizontalArea: this._horizontalArea,
            perimeter: this._perimeter,
            rawString: this.isPlaneMode ? "measure_area_area" : "measure_area_horizontalArea",
            rawNumber: this.isPlaneMode ? this._area : this._horizontalArea,
            createLabelText: function () {
                return t.i18n(this.rawString, {area: TerraExplorer.internal.Units.formatArea(this.rawNumber)})
            },
            defaultName: t.i18n("AreaObj_DefaultName"),
            isPlaneMode: this.isPlaneMode,
            isOnPrimitive: this._isOnPrimitive,
            timestamp: Cesium.defaultValue(r, Date.now()),
            prims: [s, m, g, o]
        };
        p.flyTo = function () {
            viewer.camera.flyToBoundingSphere(p.bs)
        }, p.delete = function () {
            TerraExplorer.internal.Project.deleteObject(p)
        }, Object.defineProperty(p, "show", {
            "default": !0, get: function () {
                return p.prims[0].show
            }, set: function (e) {
                this.prims.forEach(function (t) {
                    t instanceof Cesium.BillboardCollection ? t._billboards.forEach(function (t) {
                        t.show = e
                    }) : t instanceof Cesium.LabelCollection ? t._labels.forEach(function (t) {
                        t.show = e
                    }) : t.show = e
                })
            }
        }), Object.defineProperty(p, "displayName", {
            "default": !0, get: function () {
                return p.name
            }, set: function (e) {
                p.name = e
            }
        });
        if (n !== undefined && n.indexOf(t.i18n("AreaObj_DefaultName")) > -1) {
            var d = Number(n.split("#")[1]);
            i._allAvailableObjectsNames[i._objectTypes.AREA] === undefined && (i._allAvailableObjectsNames[i._objectTypes.AREA] = new Array(i._objectsMaxNumber.area)), i._allAvailableObjectsNames[i._objectTypes.AREA][d] = !0
        }
        return p.name = n ? n : TerraExplorer.internal.Project.getAvailableDefaultName(p), TerraExplorer.internal.Project.addToObjectList(p), p
    }, d.prototype.onIntersection = function (e, t, n) {
        n()
    }, d.prototype.workCompleted = function () {
        this.CancelWork == 0 ? this.updateAreaText() : this.removeSurfaceTriangles(), this._surfaceAreaRequestID++, this._calculating = !1
    }, d.prototype.onPreFrame = function (e, t) {
        this.drawTriangles(), this._calculating == 0 && viewer.scene.preRender.removeEventListener(this.onPreFrame, this)
    }, d.prototype.prepareTrianglesForDraw = function (e, t) {
        var n = this._verticeToIndices[t];
        for (var r = 0; r < n.length; r++) {
            var i = parseInt(n[r] / 3, 10), s = e[this._trianglesGeometry.geometry.indices[i * 3 + 0]],
                o = e[this._trianglesGeometry.geometry.indices[i * 3 + 1]],
                u = e[this._trianglesGeometry.geometry.indices[i * 3 + 2]];
            if (s._heightWasSet && o._heightWasSet && u._heightWasSet) {
                var a = !1;
                s.height == undefined && (s.height = 0, a = !0), o.height == undefined && (o.height = 0, a = !0), u.height == undefined && (u.height = 0, a = !0), this._trianglesToDraw.push({
                    positions: [viewer.scene.globe.ellipsoid.cartographicToCartesian(s), viewer.scene.globe.ellipsoid.cartographicToCartesian(o), viewer.scene.globe.ellipsoid.cartographicToCartesian(u)],
                    missingHightInfo: a
                })
            }
        }
    }, d.prototype.drawTriangles = function () {
        while (this._trianglesToDraw.length > 0) {
            var e = this._trianglesToDraw.pop(), t = Cesium.createGuid();
            if (this._surfaceTrianglesIds.indexOf(t) == -1) {
                this._surfaceTrianglesIds.push(t);
                var n = new Cesium.Primitive({
                    geometryInstances: new Cesium.GeometryInstance({
                        geometry: new Cesium.PolygonOutlineGeometry({
                            polygonHierarchy: new Cesium.PolygonHierarchy(e.positions),
                            perPositionHeight: !0
                        }),
                        id: t,
                        attributes: {
                            color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1, 1, 1, 1)),
                            depthFailColor: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1, 1, 1, .2)),
                            distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, TerraExplorer.tools.ToolManager._tools.AreaTool._perimeter * 30)
                        }
                    }),
                    appearance: new Cesium.PerInstanceColorAppearance({flat: !0, translucent: !1}),
                    depthFailAppearance: new Cesium.PerInstanceColorAppearance({flat: !0, translucent: !0}),
                    isAnalysisPrimitive: !0
                });
                y === null && (y = new Cesium.PrimitiveCollection, viewer.scene.primitives.add(y)), y.add(n)
            }
        }
    }, d
}), function (e) {
    function t(i) {
        var l, h = this, p = i.data || {};
        if (p.elem) h = i.dragTarget = p.elem, i.dragProxy = a.proxy || h, i.cursorOffsetX = p.pageX - p.left, i.cursorOffsetY = p.pageY - p.top, i.offsetX = i.pageX - i.cursorOffsetX, i.offsetY = i.pageY - i.cursorOffsetY; else if (a.dragging || p.which > 0 && i.which != p.which || e(i.target).is(p.not)) return;
        switch (i.type) {
            case"mousedown":
                return e.extend(p, e(h).offset(), {
                    elem: h,
                    target: i.target,
                    pageX: i.pageX,
                    pageY: i.pageY
                }), o.add(document, "mousemove mouseup", t, p), s(h, !1), a.dragging = null, !1;
            case!a.dragging && "mousemove":
                if (r(i.pageX - p.pageX) + r(i.pageY - p.pageY) < p.distance) break;
                i.target = p.target, l = n(i, "dragstart", h), l !== !1 && (a.dragging = h, a.proxy = i.dragProxy = e(l || h)[0]);
            case"mousemove":
                if (a.dragging) {
                    if (l = n(i, "drag", h), u.drop && (u.drop.allowed = l !== !1, u.drop.handler(i)), l !== !1) break;
                    i.type = "mouseup"
                }
                ;
            case"mouseup":
                o.remove(document, "mousemove mouseup", t), a.dragging && (u.drop && u.drop.handler(i), n(i, "dragend", h)), s(h, !0), a.dragging = a.proxy = p.elem = !1
        }
        return !0
    }

    function n(t, n, r) {
        t.type = n;
        var i = e.event.dispatch.call(r, t);
        return i === !1 ? !1 : i || t.result
    }

    function r(e) {
        return Math.pow(e, 2)
    }

    function i() {
        return a.dragging === !1
    }

    function s(e, t) {
        e && (e.unselectable = t ? "off" : "on", e.onselectstart = function () {
            return t
        }, e.style && (e.style.MozUserSelect = t ? "" : "none"))
    }

    e.fn.drag = function (e, t, n) {
        return t && this.bind("dragstart", e), n && this.bind("dragend", n), e ? this.bind("drag", t ? t : e) : this.trigger("drag")
    };
    var o = e.event, u = o.special, a = u.drag = {
        not: ":input", distance: 0, which: 1, dragging: !1, setup: function (n) {
            n = e.extend({
                distance: a.distance,
                which: a.which,
                not: a.not
            }, n || {}), n.distance = r(n.distance), o.add(this, "mousedown", t, n), this.attachEvent && this.attachEvent("ondragstart", i)
        }, teardown: function () {
            o.remove(this, "mousedown", t), this === a.dragging && (a.dragging = a.proxy = !1), s(this, !0), this.detachEvent && this.detachEvent("ondragstart", i)
        }
    };
    u.dragstart = u.dragend = {
        setup: function () {
        }, teardown: function () {
        }
    }
}(jQuery), function (e) {
    function t(t) {
        var n = t || window.event, r = [].slice.call(arguments, 1), i = 0, s = 0, o = 0, t = e.event.fix(n);
        return t.type = "mousewheel", n.wheelDelta && (i = n.wheelDelta / 120), n.detail && (i = -n.detail / 3), o = i, void 0 !== n.axis && n.axis === n.HORIZONTAL_AXIS && (o = 0, s = -1 * i), void 0 !== n.wheelDeltaY && (o = n.wheelDeltaY / 120), void 0 !== n.wheelDeltaX && (s = -1 * n.wheelDeltaX / 120), r.unshift(t, i, s, o), (e.event.dispatch || e.event.handle).apply(this, r)
    }

    var n = ["DOMMouseScroll", "mousewheel"];
    if (e.event.fixHooks) for (var r = n.length; r;) e.event.fixHooks[n[--r]] = e.event.mouseHooks;
    e.event.special.mousewheel = {
        setup: function () {
            if (this.addEventListener) for (var e = n.length; e;) this.addEventListener(n[--e], t, !1); else this.onmousewheel = t
        }, teardown: function () {
            if (this.removeEventListener) for (var e = n.length; e;) this.removeEventListener(n[--e], t, !1); else this.onmousewheel = null
        }
    }, e.fn.extend({
        mousewheel: function (e) {
            return e ? this.bind("mousewheel", e) : this.trigger("mousewheel")
        }, unmousewheel: function (e) {
            return this.unbind("mousewheel", e)
        }
    })
}(jQuery), function (e) {
    function n(t) {
        function n(e, n) {
            var r = t.offset();
            r.left = e.pageX - r.left, r.top = e.pageY - r.top, n ? t.zoomOut({center: r}) : t.zoom({center: r})
        }

        function r(e, t) {
            return e.preventDefault(), n(e, t < 0), !1
        }

        function a(e) {
            if (e.which != 1) return !1;
            var n = t.getPlaceholder().css("cursor");
            n && (i = n), t.getPlaceholder().css("cursor", t.getOptions().pan.cursor), s = e.pageX, o = e.pageY
        }

        function f(e) {
            var n = t.getOptions().pan.frameRate;
            if (u || !n) return;
            u = setTimeout(function () {
                t.pan({left: s - e.pageX, top: o - e.pageY}), s = e.pageX, o = e.pageY, u = null
            }, 1 / n * 1e3)
        }

        function l(e) {
            u && (clearTimeout(u), u = null), t.getPlaceholder().css("cursor", i), t.pan({
                left: s - e.pageX,
                top: o - e.pageY
            })
        }

        function c(e, t) {
            var i = e.getOptions();
            i.zoom.interactive && (t[i.zoom.trigger](n), t.mousewheel(r)), i.pan.interactive && (t.bind("dragstart", {distance: 10}, a), t.bind("drag", f), t.bind("dragend", l))
        }

        function h(e, t) {
            t.unbind(e.getOptions().zoom.trigger, n), t.unbind("mousewheel", r), t.unbind("dragstart", a), t.unbind("drag", f), t.unbind("dragend", l), u && clearTimeout(u)
        }

        var i = "default", s = 0, o = 0, u = null;
        t.zoomOut = function (e) {
            e || (e = {}), e.amount || (e.amount = t.getOptions().zoom.amount), e.amount = 1 / e.amount, t.zoom(e)
        }, t.zoom = function (n) {
            n || (n = {});
            var r = n.center, i = n.amount || t.getOptions().zoom.amount, s = t.width(), o = t.height();
            r || (r = {left: s / 2, top: o / 2});
            var u = r.left / s, a = r.top / o, f = {
                x: {min: r.left - u * s / i, max: r.left + (1 - u) * s / i},
                y: {min: r.top - a * o / i, max: r.top + (1 - a) * o / i}
            };
            e.each(t.getAxes(), function (e, t) {
                var n = t.options, r = f[t.direction].min, s = f[t.direction].max, o = n.zoomRange, u = n.panRange;
                if (o === !1) return;
                r = t.c2p(r), s = t.c2p(s);
                if (r > s) {
                    var a = r;
                    r = s, s = a
                }
                u && (u[0] != null && r < u[0] && (r = u[0]), u[1] != null && s > u[1] && (s = u[1]));
                var l = s - r;
                if (o && (o[0] != null && l < o[0] && i > 1 || o[1] != null && l > o[1] && i < 1)) return;
                n.min = r, n.max = s
            }), t.setupGrid(), t.draw(), n.preventEvent || t.getPlaceholder().trigger("plotzoom", [t, n])
        }, t.pan = function (n) {
            var r = {x: +n.left, y: +n.top};
            isNaN(r.x) && (r.x = 0), isNaN(r.y) && (r.y = 0), e.each(t.getAxes(), function (e, t) {
                var n = t.options, i, s, o = r[t.direction];
                i = t.c2p(t.p2c(t.min) + o), s = t.c2p(t.p2c(t.max) + o);
                var u = n.panRange;
                if (u === !1) return;
                u && (u[0] != null && u[0] > i && (o = u[0] - i, i += o, s += o), u[1] != null && u[1] < s && (o = u[1] - s, i += o, s += o)), n.min = i, n.max = s
            }), t.setupGrid(), t.draw(), n.preventEvent || t.getPlaceholder().trigger("plotpan", [t, n])
        }, t.hooks.bindEvents.push(c), t.hooks.shutdown.push(h)
    }

    var t = {
        xaxis: {zoomRange: null, panRange: null},
        zoom: {interactive: !1, trigger: "dblclick", amount: 1.5},
        pan: {interactive: !1, cursor: "move", frameRate: 20}
    };
    e.plot.plugins.push({init: n, options: t, name: "navigate", version: "1.3"})
}(jQuery), define("flot/jquery.flot.navigate.min", function () {
}), function (e, t) {
    function n(t, n) {
        var i, s, o, u = t.nodeName.toLowerCase();
        return "area" === u ? (i = t.parentNode, s = i.name, t.href && s && "map" === i.nodeName.toLowerCase() ? (o = e("img[usemap=#" + s + "]")[0], !!o && r(o)) : !1) : (/input|select|textarea|button|object/.test(u) ? !t.disabled : "a" === u ? t.href || n : n) && r(t)
    }

    function r(t) {
        return e.expr.filters.visible(t) && !e(t).parents().addBack().filter(function () {
            return "hidden" === e.css(this, "visibility")
        }).length
    }

    var i = 0, s = /^ui-id-\d+$/;
    e.ui = e.ui || {}, e.extend(e.ui, {
        version: "1.10.4",
        keyCode: {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            NUMPAD_ADD: 107,
            NUMPAD_DECIMAL: 110,
            NUMPAD_DIVIDE: 111,
            NUMPAD_ENTER: 108,
            NUMPAD_MULTIPLY: 106,
            NUMPAD_SUBTRACT: 109,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38
        }
    }), e.fn.extend({
        focus: function (t) {
            return function (n, r) {
                return "number" == typeof n ? this.each(function () {
                    var t = this;
                    setTimeout(function () {
                        e(t).focus(), r && r.call(t)
                    }, n)
                }) : t.apply(this, arguments)
            }
        }(e.fn.focus), scrollParent: function () {
            var t;
            return t = e.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? this.parents().filter(function () {
                return /(relative|absolute|fixed)/.test(e.css(this, "position")) && /(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
            }).eq(0) : this.parents().filter(function () {
                return /(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
            }).eq(0), /fixed/.test(this.css("position")) || !t.length ? e(document) : t
        }, zIndex: function (n) {
            if (n !== t) return this.css("zIndex", n);
            if (this.length) for (var r, i, s = e(this[0]); s.length && s[0] !== document;) {
                if (r = s.css("position"), ("absolute" === r || "relative" === r || "fixed" === r) && (i = parseInt(s.css("zIndex"), 10), !isNaN(i) && 0 !== i)) return i;
                s = s.parent()
            }
            return 0
        }, uniqueId: function () {
            return this.each(function () {
                this.id || (this.id = "ui-id-" + ++i)
            })
        }, removeUniqueId: function () {
            return this.each(function () {
                s.test(this.id) && e(this).removeAttr("id")
            })
        }
    }), e.extend(e.expr[":"], {
        data: e.expr.createPseudo ? e.expr.createPseudo(function (t) {
            return function (n) {
                return !!e.data(n, t)
            }
        }) : function (t, n, r) {
            return !!e.data(t, r[3])
        }, focusable: function (t) {
            return n(t, !isNaN(e.attr(t, "tabindex")))
        }, tabbable: function (t) {
            var r = e.attr(t, "tabindex"), i = isNaN(r);
            return (i || r >= 0) && n(t, !i)
        }
    }), e("<a>").outerWidth(1).jquery || e.each(["Width", "Height"], function (n, r) {
        function i(t, n, r, i) {
            return e.each(s, function () {
                n -= parseFloat(e.css(t, "padding" + this)) || 0, r && (n -= parseFloat(e.css(t, "border" + this + "Width")) || 0), i && (n -= parseFloat(e.css(t, "margin" + this)) || 0)
            }), n
        }

        var s = "Width" === r ? ["Left", "Right"] : ["Top", "Bottom"], o = r.toLowerCase(), u = {
            innerWidth: e.fn.innerWidth,
            innerHeight: e.fn.innerHeight,
            outerWidth: e.fn.outerWidth,
            outerHeight: e.fn.outerHeight
        };
        e.fn["inner" + r] = function (n) {
            return n === t ? u["inner" + r].call(this) : this.each(function () {
                e(this).css(o, i(this, n) + "px")
            })
        }, e.fn["outer" + r] = function (t, n) {
            return "number" != typeof t ? u["outer" + r].call(this, t) : this.each(function () {
                e(this).css(o, i(this, t, !0, n) + "px")
            })
        }
    }), e.fn.addBack || (e.fn.addBack = function (e) {
        return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
    }), e("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (e.fn.removeData = function (t) {
        return function (n) {
            return arguments.length ? t.call(this, e.camelCase(n)) : t.call(this)
        }
    }(e.fn.removeData)), e.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()), e.support.selectstart = "onselectstart" in document.createElement("div"), e.fn.extend({
        disableSelection: function () {
            return this.bind((e.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function (e) {
                e.preventDefault()
            })
        }, enableSelection: function () {
            return this.unbind(".ui-disableSelection")
        }
    }), e.extend(e.ui, {
        plugin: {
            add: function (t, n, r) {
                var i, s = e.ui[t].prototype;
                for (i in r) s.plugins[i] = s.plugins[i] || [], s.plugins[i].push([n, r[i]])
            }, call: function (e, t, n) {
                var r, i = e.plugins[t];
                if (i && e.element[0].parentNode && 11 !== e.element[0].parentNode.nodeType) for (r = 0; i.length > r; r++) e.options[i[r][0]] && i[r][1].apply(e.element, n)
            }
        }, hasScroll: function (t, n) {
            if ("hidden" === e(t).css("overflow")) return !1;
            var r = n && "left" === n ? "scrollLeft" : "scrollTop", i = !1;
            return t[r] > 0 ? !0 : (t[r] = 1, i = t[r] > 0, t[r] = 0, i)
        }
    })
}(jQuery), function (e, t) {
    var n = 0, r = Array.prototype.slice, i = e.cleanData;
    e.cleanData = function (t) {
        for (var n, r = 0; null != (n = t[r]); r++) try {
            e(n).triggerHandler("remove")
        } catch (s) {
        }
        i(t)
    }, e.widget = function (n, r, i) {
        var s, o, u, a, f = {}, l = n.split(".")[0];
        n = n.split(".")[1], s = l + "-" + n, i || (i = r, r = e.Widget), e.expr[":"][s.toLowerCase()] = function (t) {
            return !!e.data(t, s)
        }, e[l] = e[l] || {}, o = e[l][n], u = e[l][n] = function (e, n) {
            return this._createWidget ? (arguments.length && this._createWidget(e, n), t) : new u(e, n)
        }, e.extend(u, o, {
            version: i.version,
            _proto: e.extend({}, i),
            _childConstructors: []
        }), a = new r, a.options = e.widget.extend({}, a.options), e.each(i, function (n, i) {
            return e.isFunction(i) ? (f[n] = function () {
                var e = function () {
                    return r.prototype[n].apply(this, arguments)
                }, t = function (e) {
                    return r.prototype[n].apply(this, e)
                };
                return function () {
                    var n, r = this._super, s = this._superApply;
                    return this._super = e, this._superApply = t, n = i.apply(this, arguments), this._super = r, this._superApply = s, n
                }
            }(), t) : (f[n] = i, t)
        }), u.prototype = e.widget.extend(a, {widgetEventPrefix: o ? a.widgetEventPrefix || n : n}, f, {
            constructor: u,
            namespace: l,
            widgetName: n,
            widgetFullName: s
        }), o ? (e.each(o._childConstructors, function (t, n) {
            var r = n.prototype;
            e.widget(r.namespace + "." + r.widgetName, u, n._proto)
        }), delete o._childConstructors) : r._childConstructors.push(u), e.widget.bridge(n, u)
    }, e.widget.extend = function (n) {
        for (var i, o, u = r.call(arguments, 1), a = 0, f = u.length; f > a; a++) for (i in u[a]) o = u[a][i], u[a].hasOwnProperty(i) && o !== t && (n[i] = e.isPlainObject(o) ? e.isPlainObject(n[i]) ? e.widget.extend({}, n[i], o) : e.widget.extend({}, o) : o);
        return n
    }, e.widget.bridge = function (n, i) {
        var o = i.prototype.widgetFullName || n;
        e.fn[n] = function (u) {
            var a = "string" == typeof u, f = r.call(arguments, 1), l = this;
            return u = !a && f.length ? e.widget.extend.apply(null, [u].concat(f)) : u, a ? this.each(function () {
                var r, i = e.data(this, o);
                return i ? e.isFunction(i[u]) && "_" !== u.charAt(0) ? (r = i[u].apply(i, f), r !== i && r !== t ? (l = r && r.jquery ? l.pushStack(r.get()) : r, !1) : t) : e.error("no such method '" + u + "' for " + n + " widget instance") : e.error("cannot call methods on " + n + " prior to initialization; " + "attempted to call method '" + u + "'")
            }) : this.each(function () {
                var t = e.data(this, o);
                t ? t.option(u || {})._init() : e.data(this, o, new i(u, this))
            }), l
        }
    }, e.Widget = function () {
    }, e.Widget._childConstructors = [], e.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: {disabled: !1, create: null},
        _createWidget: function (t, r) {
            r = e(r || this.defaultElement || this)[0], this.element = e(r), this.uuid = n++, this.eventNamespace = "." + this.widgetName + this.uuid, this.options = e.widget.extend({}, this.options, this._getCreateOptions(), t), this.bindings = e(), this.hoverable = e(), this.focusable = e(), r !== this && (e.data(r, this.widgetFullName, this), this._on(!0, this.element, {
                remove: function (e) {
                    e.target === r && this.destroy()
                }
            }), this.document = e(r.style ? r.ownerDocument : r.document || r), this.window = e(this.document[0].defaultView || this.document[0].parentWindow)), this._create(), this._trigger("create", null, this._getCreateEventData()), this._init()
        },
        _getCreateOptions: e.noop,
        _getCreateEventData: e.noop,
        _create: e.noop,
        _init: e.noop,
        destroy: function () {
            this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)), this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled " + "ui-state-disabled"), this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")
        },
        _destroy: e.noop,
        widget: function () {
            return this.element
        },
        option: function (n, r) {
            var i, s, o, u = n;
            if (0 === arguments.length) return e.widget.extend({}, this.options);
            if ("string" == typeof n) if (u = {}, i = n.split("."), n = i.shift(), i.length) {
                for (s = u[n] = e.widget.extend({}, this.options[n]), o = 0; i.length - 1 > o; o++) s[i[o]] = s[i[o]] || {}, s = s[i[o]];
                if (n = i.pop(), 1 === arguments.length) return s[n] === t ? null : s[n];
                s[n] = r
            } else {
                if (1 === arguments.length) return this.options[n] === t ? null : this.options[n];
                u[n] = r
            }
            return this._setOptions(u), this
        },
        _setOptions: function (e) {
            var t;
            for (t in e) this._setOption(t, e[t]);
            return this
        },
        _setOption: function (e, t) {
            return this.options[e] = t, "disabled" === e && (this.widget().toggleClass(this.widgetFullName + "-disabled ui-state-disabled", !!t).attr("aria-disabled", t), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")), this
        },
        enable: function () {
            return this._setOption("disabled", !1)
        },
        disable: function () {
            return this._setOption("disabled", !0)
        },
        _on: function (n, r, i) {
            var s, o = this;
            "boolean" != typeof n && (i = r, r = n, n = !1), i ? (r = s = e(r), this.bindings = this.bindings.add(r)) : (i = r, r = this.element, s = this.widget()), e.each(i, function (i, u) {
                function f() {
                    return n || o.options.disabled !== !0 && !e(this).hasClass("ui-state-disabled") ? ("string" == typeof u ? o[u] : u).apply(o, arguments) : t
                }

                "string" != typeof u && (f.guid = u.guid = u.guid || f.guid || e.guid++);
                var l = i.match(/^(\w+)\s*(.*)$/), c = l[1] + o.eventNamespace, h = l[2];
                h ? s.delegate(h, c, f) : r.bind(c, f)
            })
        },
        _off: function (e, t) {
            t = (t || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, e.unbind(t).undelegate(t)
        },
        _delay: function (e, t) {
            function n() {
                return ("string" == typeof e ? r[e] : e).apply(r, arguments)
            }

            var r = this;
            return setTimeout(n, t || 0)
        },
        _hoverable: function (t) {
            this.hoverable = this.hoverable.add(t), this._on(t, {
                mouseenter: function (t) {
                    e(t.currentTarget).addClass("ui-state-hover")
                }, mouseleave: function (t) {
                    e(t.currentTarget).removeClass("ui-state-hover")
                }
            })
        },
        _focusable: function (t) {
            this.focusable = this.focusable.add(t), this._on(t, {
                focusin: function (t) {
                    e(t.currentTarget).addClass("ui-state-focus")
                }, focusout: function (t) {
                    e(t.currentTarget).removeClass("ui-state-focus")
                }
            })
        },
        _trigger: function (t, n, r) {
            var i, s, o = this.options[t];
            if (r = r || {}, n = e.Event(n), n.type = (t === this.widgetEventPrefix ? t : this.widgetEventPrefix + t).toLowerCase(), n.target = this.element[0], s = n.originalEvent) for (i in s) i in n || (n[i] = s[i]);
            return this.element.trigger(n, r), !(e.isFunction(o) && o.apply(this.element[0], [n].concat(r)) === !1 || n.isDefaultPrevented())
        }
    }, e.each({show: "fadeIn", hide: "fadeOut"}, function (t, n) {
        e.Widget.prototype["_" + t] = function (r, i, s) {
            "string" == typeof i && (i = {effect: i});
            var o, u = i ? i === !0 || "number" == typeof i ? n : i.effect || n : t;
            i = i || {}, "number" == typeof i && (i = {duration: i}), o = !e.isEmptyObject(i), i.complete = s, i.delay && r.delay(i.delay), o && e.effects && e.effects.effect[u] ? r[t](i) : u !== t && r[u] ? r[u](i.duration, i.easing, s) : r.queue(function (n) {
                e(this)[t](), s && s.call(r[0]), n()
            })
        }
    })
}(jQuery), function (e) {
    var t = !1;
    e(document).mouseup(function () {
        t = !1
    }), e.widget("ui.mouse", {
        version: "1.10.4",
        options: {cancel: "input,textarea,button,select,option", distance: 1, delay: 0},
        _mouseInit: function () {
            var t = this;
            this.element.bind("mousedown." + this.widgetName, function (e) {
                return t._mouseDown(e)
            }).bind("click." + this.widgetName, function (n) {
                return !0 === e.data(n.target, t.widgetName + ".preventClickEvent") ? (e.removeData(n.target, t.widgetName + ".preventClickEvent"), n.stopImmediatePropagation(), !1) : undefined
            }), this.started = !1
        },
        _mouseDestroy: function () {
            this.element.unbind("." + this.widgetName), this._mouseMoveDelegate && e(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
        },
        _mouseDown: function (n) {
            if (!t) {
                this._mouseStarted && this._mouseUp(n), this._mouseDownEvent = n;
                var r = this, i = 1 === n.which,
                    s = "string" == typeof this.options.cancel && n.target.nodeName ? e(n.target).closest(this.options.cancel).length : !1;
                return i && !s && this._mouseCapture(n) ? (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function () {
                    r.mouseDelayMet = !0
                }, this.options.delay)), this._mouseDistanceMet(n) && this._mouseDelayMet(n) && (this._mouseStarted = this._mouseStart(n) !== !1, !this._mouseStarted) ? (n.preventDefault(), !0) : (!0 === e.data(n.target, this.widgetName + ".preventClickEvent") && e.removeData(n.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function (e) {
                    return r._mouseMove(e)
                }, this._mouseUpDelegate = function (e) {
                    return r._mouseUp(e)
                }, e(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), n.preventDefault(), t = !0, !0)) : !0
            }
        },
        _mouseMove: function (t) {
            return e.ui.ie && (!document.documentMode || 9 > document.documentMode) && !t.button ? this._mouseUp(t) : this._mouseStarted ? (this._mouseDrag(t), t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1, this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted)
        },
        _mouseUp: function (t) {
            return e(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, t.target === this._mouseDownEvent.target && e.data(t.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(t)), !1
        },
        _mouseDistanceMet: function (e) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - e.pageX), Math.abs(this._mouseDownEvent.pageY - e.pageY)) >= this.options.distance
        },
        _mouseDelayMet: function () {
            return this.mouseDelayMet
        },
        _mouseStart: function () {
        },
        _mouseDrag: function () {
        },
        _mouseStop: function () {
        },
        _mouseCapture: function () {
            return !0
        }
    })
}(jQuery), function (e) {
    function t(e) {
        return parseInt(e, 10) || 0
    }

    function n(e) {
        return !isNaN(parseInt(e, 10))
    }

    e.widget("ui.resizable", e.ui.mouse, {
        version: "1.10.4",
        widgetEventPrefix: "resize",
        options: {
            alsoResize: !1,
            animate: !1,
            animateDuration: "slow",
            animateEasing: "swing",
            aspectRatio: !1,
            autoHide: !1,
            containment: !1,
            ghost: !1,
            grid: !1,
            handles: "e,s,se",
            helper: !1,
            maxHeight: null,
            maxWidth: null,
            minHeight: 10,
            minWidth: 10,
            zIndex: 90,
            resize: null,
            start: null,
            stop: null
        },
        _create: function () {
            var t, n, r, i, s, o = this, u = this.options;
            if (this.element.addClass("ui-resizable"), e.extend(this, {
                _aspectRatio: !!u.aspectRatio,
                aspectRatio: u.aspectRatio,
                originalElement: this.element,
                _proportionallyResizeElements: [],
                _helper: u.helper || u.ghost || u.animate ? u.helper || "ui-resizable-helper" : null
            }), this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i) && (this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
                position: this.element.css("position"),
                width: this.element.outerWidth(),
                height: this.element.outerHeight(),
                top: this.element.css("top"),
                left: this.element.css("left")
            })), this.element = this.element.parent().data("ui-resizable", this.element.data("ui-resizable")), this.elementIsWrapper = !0, this.element.css({
                marginLeft: this.originalElement.css("marginLeft"),
                marginTop: this.originalElement.css("marginTop"),
                marginRight: this.originalElement.css("marginRight"),
                marginBottom: this.originalElement.css("marginBottom")
            }), this.originalElement.css({
                marginLeft: 0,
                marginTop: 0,
                marginRight: 0,
                marginBottom: 0
            }), this.originalResizeStyle = this.originalElement.css("resize"), this.originalElement.css("resize", "none"), this._proportionallyResizeElements.push(this.originalElement.css({
                position: "static",
                zoom: 1,
                display: "block"
            })), this.originalElement.css({margin: this.originalElement.css("margin")}), this._proportionallyResize()), this.handles = u.handles || (e(".ui-resizable-handle", this.element).length ? {
                n: ".ui-resizable-n",
                e: ".ui-resizable-e",
                s: ".ui-resizable-s",
                w: ".ui-resizable-w",
                se: ".ui-resizable-se",
                sw: ".ui-resizable-sw",
                ne: ".ui-resizable-ne",
                nw: ".ui-resizable-nw"
            } : "e,s,se"), this.handles.constructor === String) for ("all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"), t = this.handles.split(","), this.handles = {}, n = 0; t.length > n; n++) r = e.trim(t[n]), s = "ui-resizable-" + r, i = e("<div class='ui-resizable-handle " + s + "'></div>"), i.css({zIndex: u.zIndex}), "se" === r && i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"), this.handles[r] = ".ui-resizable-" + r, this.element.append(i);
            this._renderAxis = function (t) {
                var n, r, i, s;
                t = t || this.element;
                for (n in this.handles) this.handles[n].constructor === String && (this.handles[n] = e(this.handles[n], this.element).show()), this.elementIsWrapper && this.originalElement[0].nodeName.match(/textarea|input|select|button/i) && (r = e(this.handles[n], this.element), s = /sw|ne|nw|se|n|s/.test(n) ? r.outerHeight() : r.outerWidth(), i = ["padding", /ne|nw|n/.test(n) ? "Top" : /se|sw|s/.test(n) ? "Bottom" : /^e$/.test(n) ? "Right" : "Left"].join(""), t.css(i, s), this._proportionallyResize()), e(this.handles[n]).length
            }, this._renderAxis(this.element), this._handles = e(".ui-resizable-handle", this.element).disableSelection(), this._handles.mouseover(function () {
                o.resizing || (this.className && (i = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), o.axis = i && i[1] ? i[1] : "se")
            }), u.autoHide && (this._handles.hide(), e(this.element).addClass("ui-resizable-autohide").mouseenter(function () {
                u.disabled || (e(this).removeClass("ui-resizable-autohide"), o._handles.show())
            }).mouseleave(function () {
                u.disabled || o.resizing || (e(this).addClass("ui-resizable-autohide"), o._handles.hide())
            })), this._mouseInit()
        },
        _destroy: function () {
            this._mouseDestroy();
            var t, n = function (t) {
                e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()
            };
            return this.elementIsWrapper && (n(this.element), t = this.element, this.originalElement.css({
                position: t.css("position"),
                width: t.outerWidth(),
                height: t.outerHeight(),
                top: t.css("top"),
                left: t.css("left")
            }).insertAfter(t), t.remove()), this.originalElement.css("resize", this.originalResizeStyle), n(this.originalElement), this
        },
        _mouseCapture: function (t) {
            var n, r, i = !1;
            for (n in this.handles) r = e(this.handles[n])[0], (r === t.target || e.contains(r, t.target)) && (i = !0);
            return !this.options.disabled && i
        },
        _mouseStart: function (n) {
            var r, i, s, o = this.options, u = this.element.position(), a = this.element;
            return this.resizing = !0, /absolute/.test(a.css("position")) ? a.css({
                position: "absolute",
                top: a.css("top"),
                left: a.css("left")
            }) : a.is(".ui-draggable") && a.css({
                position: "absolute",
                top: u.top,
                left: u.left
            }), this._renderProxy(), r = t(this.helper.css("left")), i = t(this.helper.css("top")), o.containment && (r += e(o.containment).scrollLeft() || 0, i += e(o.containment).scrollTop() || 0), this.offset = this.helper.offset(), this.position = {
                left: r,
                top: i
            }, this.size = this._helper ? {
                width: this.helper.width(),
                height: this.helper.height()
            } : {width: a.width(), height: a.height()}, this.originalSize = this._helper ? {
                width: a.outerWidth(),
                height: a.outerHeight()
            } : {width: a.width(), height: a.height()}, this.originalPosition = {
                left: r,
                top: i
            }, this.sizeDiff = {
                width: a.outerWidth() - a.width(),
                height: a.outerHeight() - a.height()
            }, this.originalMousePosition = {
                left: n.pageX,
                top: n.pageY
            }, this.aspectRatio = "number" == typeof o.aspectRatio ? o.aspectRatio : this.originalSize.width / this.originalSize.height || 1, s = e(".ui-resizable-" + this.axis).css("cursor"), e("body").css("cursor", "auto" === s ? this.axis + "-resize" : s), a.addClass("ui-resizable-resizing"), this._propagate("start", n), !0
        },
        _mouseDrag: function (t) {
            var n, r = this.helper, i = {}, s = this.originalMousePosition, o = this.axis, u = this.position.top,
                a = this.position.left, f = this.size.width, l = this.size.height, c = t.pageX - s.left || 0,
                h = t.pageY - s.top || 0, p = this._change[o];
            return p ? (n = p.apply(this, [t, c, h]), this._updateVirtualBoundaries(t.shiftKey), (this._aspectRatio || t.shiftKey) && (n = this._updateRatio(n, t)), n = this._respectSize(n, t), this._updateCache(n), this._propagate("resize", t), this.position.top !== u && (i.top = this.position.top + "px"), this.position.left !== a && (i.left = this.position.left + "px"), this.size.width !== f && (i.width = this.size.width + "px"), this.size.height !== l && (i.height = this.size.height + "px"), r.css(i), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), e.isEmptyObject(i) || this._trigger("resize", t, this.ui()), !1) : !1
        },
        _mouseStop: function (t) {
            this.resizing = !1;
            var n, r, i, s, o, u, a, f = this.options, l = this;
            return this._helper && (n = this._proportionallyResizeElements, r = n.length && /textarea/i.test(n[0].nodeName), i = r && e.ui.hasScroll(n[0], "left") ? 0 : l.sizeDiff.height, s = r ? 0 : l.sizeDiff.width, o = {
                width: l.helper.width() - s,
                height: l.helper.height() - i
            }, u = parseInt(l.element.css("left"), 10) + (l.position.left - l.originalPosition.left) || null, a = parseInt(l.element.css("top"), 10) + (l.position.top - l.originalPosition.top) || null, f.animate || this.element.css(e.extend(o, {
                top: a,
                left: u
            })), l.helper.height(l.size.height), l.helper.width(l.size.width), this._helper && !f.animate && this._proportionallyResize()), e("body").css("cursor", "auto"), this.element.removeClass("ui-resizable-resizing"), this._propagate("stop", t), this._helper && this.helper.remove(), !1
        },
        _updateVirtualBoundaries: function (e) {
            var t, r, s, o, u, a = this.options;
            u = {
                minWidth: n(a.minWidth) ? a.minWidth : 0,
                maxWidth: n(a.maxWidth) ? a.maxWidth : 1 / 0,
                minHeight: n(a.minHeight) ? a.minHeight : 0,
                maxHeight: n(a.maxHeight) ? a.maxHeight : 1 / 0
            }, (this._aspectRatio || e) && (t = u.minHeight * this.aspectRatio, s = u.minWidth / this.aspectRatio, r = u.maxHeight * this.aspectRatio, o = u.maxWidth / this.aspectRatio, t > u.minWidth && (u.minWidth = t), s > u.minHeight && (u.minHeight = s), u.maxWidth > r && (u.maxWidth = r), u.maxHeight > o && (u.maxHeight = o)), this._vBoundaries = u
        },
        _updateCache: function (e) {
            this.offset = this.helper.offset(), n(e.left) && (this.position.left = e.left), n(e.top) && (this.position.top = e.top), n(e.height) && (this.size.height = e.height), n(e.width) && (this.size.width = e.width)
        },
        _updateRatio: function (e) {
            var t = this.position, r = this.size, s = this.axis;
            return n(e.height) ? e.width = e.height * this.aspectRatio : n(e.width) && (e.height = e.width / this.aspectRatio), "sw" === s && (e.left = t.left + (r.width - e.width), e.top = null), "nw" === s && (e.top = t.top + (r.height - e.height), e.left = t.left + (r.width - e.width)), e
        },
        _respectSize: function (e) {
            var t = this._vBoundaries, r = this.axis, s = n(e.width) && t.maxWidth && t.maxWidth < e.width,
                o = n(e.height) && t.maxHeight && t.maxHeight < e.height,
                u = n(e.width) && t.minWidth && t.minWidth > e.width,
                a = n(e.height) && t.minHeight && t.minHeight > e.height,
                f = this.originalPosition.left + this.originalSize.width, l = this.position.top + this.size.height,
                c = /sw|nw|w/.test(r), h = /nw|ne|n/.test(r);
            return u && (e.width = t.minWidth), a && (e.height = t.minHeight), s && (e.width = t.maxWidth), o && (e.height = t.maxHeight), u && c && (e.left = f - t.minWidth), s && c && (e.left = f - t.maxWidth), a && h && (e.top = l - t.minHeight), o && h && (e.top = l - t.maxHeight), e.width || e.height || e.left || !e.top ? e.width || e.height || e.top || !e.left || (e.left = null) : e.top = null, e
        },
        _proportionallyResize: function () {
            if (this._proportionallyResizeElements.length) {
                var e, t, n, r, i, s = this.helper || this.element;
                for (e = 0; this._proportionallyResizeElements.length > e; e++) {
                    if (i = this._proportionallyResizeElements[e], !this.borderDif) for (this.borderDif = [], n = [i.css("borderTopWidth"), i.css("borderRightWidth"), i.css("borderBottomWidth"), i.css("borderLeftWidth")], r = [i.css("paddingTop"), i.css("paddingRight"), i.css("paddingBottom"), i.css("paddingLeft")], t = 0; n.length > t; t++) this.borderDif[t] = (parseInt(n[t], 10) || 0) + (parseInt(r[t], 10) || 0);
                    i.css({
                        height: s.height() - this.borderDif[0] - this.borderDif[2] || 0,
                        width: s.width() - this.borderDif[1] - this.borderDif[3] || 0
                    })
                }
            }
        },
        _renderProxy: function () {
            var t = this.element, n = this.options;
            this.elementOffset = t.offset(), this._helper ? (this.helper = this.helper || e("<div style='overflow:hidden;'></div>"), this.helper.addClass(this._helper).css({
                width: this.element.outerWidth() - 1,
                height: this.element.outerHeight() - 1,
                position: "absolute",
                left: this.elementOffset.left + "px",
                top: this.elementOffset.top + "px",
                zIndex: ++n.zIndex
            }), this.helper.appendTo("body").disableSelection()) : this.helper = this.element
        },
        _change: {
            e: function (e, t) {
                return {width: this.originalSize.width + t}
            }, w: function (e, t) {
                var n = this.originalSize, r = this.originalPosition;
                return {left: r.left + t, width: n.width - t}
            }, n: function (e, t, n) {
                var r = this.originalSize, i = this.originalPosition;
                return {top: i.top + n, height: r.height - n}
            }, s: function (e, t, n) {
                return {height: this.originalSize.height + n}
            }, se: function (t, n, r) {
                return e.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [t, n, r]))
            }, sw: function (t, n, r) {
                return e.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [t, n, r]))
            }, ne: function (t, n, r) {
                return e.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [t, n, r]))
            }, nw: function (t, n, r) {
                return e.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [t, n, r]))
            }
        },
        _propagate: function (t, n) {
            e.ui.plugin.call(this, t, [n, this.ui()]), "resize" !== t && this._trigger(t, n, this.ui())
        },
        plugins: {},
        ui: function () {
            return {
                originalElement: this.originalElement,
                element: this.element,
                helper: this.helper,
                position: this.position,
                size: this.size,
                originalSize: this.originalSize,
                originalPosition: this.originalPosition
            }
        }
    }), e.ui.plugin.add("resizable", "animate", {
        stop: function (t) {
            var n = e(this).data("ui-resizable"), r = n.options, i = n._proportionallyResizeElements,
                s = i.length && /textarea/i.test(i[0].nodeName),
                o = s && e.ui.hasScroll(i[0], "left") ? 0 : n.sizeDiff.height, u = s ? 0 : n.sizeDiff.width,
                a = {width: n.size.width - u, height: n.size.height - o},
                f = parseInt(n.element.css("left"), 10) + (n.position.left - n.originalPosition.left) || null,
                l = parseInt(n.element.css("top"), 10) + (n.position.top - n.originalPosition.top) || null;
            n.element.animate(e.extend(a, l && f ? {top: l, left: f} : {}), {
                duration: r.animateDuration,
                easing: r.animateEasing,
                step: function () {
                    var r = {
                        width: parseInt(n.element.css("width"), 10),
                        height: parseInt(n.element.css("height"), 10),
                        top: parseInt(n.element.css("top"), 10),
                        left: parseInt(n.element.css("left"), 10)
                    };
                    i && i.length && e(i[0]).css({
                        width: r.width,
                        height: r.height
                    }), n._updateCache(r), n._propagate("resize", t)
                }
            })
        }
    }), e.ui.plugin.add("resizable", "containment", {
        start: function () {
            var n, r, i, s, o, u, a, f = e(this).data("ui-resizable"), l = f.options, c = f.element, h = l.containment,
                p = h instanceof e ? h.get(0) : /parent/.test(h) ? c.parent().get(0) : h;
            p && (f.containerElement = e(p), /document/.test(h) || h === document ? (f.containerOffset = {
                left: 0,
                top: 0
            }, f.containerPosition = {left: 0, top: 0}, f.parentData = {
                element: e(document),
                left: 0,
                top: 0,
                width: e(document).width(),
                height: e(document).height() || document.body.parentNode.scrollHeight
            }) : (n = e(p), r = [], e(["Top", "Right", "Left", "Bottom"]).each(function (e, i) {
                r[e] = t(n.css("padding" + i))
            }), f.containerOffset = n.offset(), f.containerPosition = n.position(), f.containerSize = {
                height: n.innerHeight() - r[3],
                width: n.innerWidth() - r[1]
            }, i = f.containerOffset, s = f.containerSize.height, o = f.containerSize.width, u = e.ui.hasScroll(p, "left") ? p.scrollWidth : o, a = e.ui.hasScroll(p) ? p.scrollHeight : s, f.parentData = {
                element: p,
                left: i.left,
                top: i.top,
                width: u,
                height: a
            }))
        }, resize: function (t) {
            var n, r, i, s, o = e(this).data("ui-resizable"), u = o.options, a = o.containerOffset, f = o.position,
                l = o._aspectRatio || t.shiftKey, c = {top: 0, left: 0}, h = o.containerElement;
            h[0] !== document && /static/.test(h.css("position")) && (c = a), f.left < (o._helper ? a.left : 0) && (o.size.width = o.size.width + (o._helper ? o.position.left - a.left : o.position.left - c.left), l && (o.size.height = o.size.width / o.aspectRatio), o.position.left = u.helper ? a.left : 0), f.top < (o._helper ? a.top : 0) && (o.size.height = o.size.height + (o._helper ? o.position.top - a.top : o.position.top), l && (o.size.width = o.size.height * o.aspectRatio), o.position.top = o._helper ? a.top : 0), o.offset.left = o.parentData.left + o.position.left, o.offset.top = o.parentData.top + o.position.top, n = Math.abs((o._helper ? o.offset.left - c.left : o.offset.left - c.left) + o.sizeDiff.width), r = Math.abs((o._helper ? o.offset.top - c.top : o.offset.top - a.top) + o.sizeDiff.height), i = o.containerElement.get(0) === o.element.parent().get(0), s = /relative|absolute/.test(o.containerElement.css("position")), i && s && (n -= Math.abs(o.parentData.left)), n + o.size.width >= o.parentData.width && (o.size.width = o.parentData.width - n, l && (o.size.height = o.size.width / o.aspectRatio)), r + o.size.height >= o.parentData.height && (o.size.height = o.parentData.height - r, l && (o.size.width = o.size.height * o.aspectRatio))
        }, stop: function () {
            var t = e(this).data("ui-resizable"), n = t.options, r = t.containerOffset, i = t.containerPosition,
                s = t.containerElement, o = e(t.helper), u = o.offset(), a = o.outerWidth() - t.sizeDiff.width,
                f = o.outerHeight() - t.sizeDiff.height;
            t._helper && !n.animate && /relative/.test(s.css("position")) && e(this).css({
                left: u.left - i.left - r.left,
                width: a,
                height: f
            }), t._helper && !n.animate && /static/.test(s.css("position")) && e(this).css({
                left: u.left - i.left - r.left,
                width: a,
                height: f
            })
        }
    }), e.ui.plugin.add("resizable", "alsoResize", {
        start: function () {
            var t = e(this).data("ui-resizable"), n = t.options, r = function (t) {
                e(t).each(function () {
                    var t = e(this);
                    t.data("ui-resizable-alsoresize", {
                        width: parseInt(t.width(), 10),
                        height: parseInt(t.height(), 10),
                        left: parseInt(t.css("left"), 10),
                        top: parseInt(t.css("top"), 10)
                    })
                })
            };
            "object" != typeof n.alsoResize || n.alsoResize.parentNode ? r(n.alsoResize) : n.alsoResize.length ? (n.alsoResize = n.alsoResize[0], r(n.alsoResize)) : e.each(n.alsoResize, function (e) {
                r(e)
            })
        }, resize: function (t, n) {
            var r = e(this).data("ui-resizable"), i = r.options, s = r.originalSize, o = r.originalPosition, u = {
                height: r.size.height - s.height || 0,
                width: r.size.width - s.width || 0,
                top: r.position.top - o.top || 0,
                left: r.position.left - o.left || 0
            }, a = function (t, r) {
                e(t).each(function () {
                    var t = e(this), i = e(this).data("ui-resizable-alsoresize"), s = {},
                        o = r && r.length ? r : t.parents(n.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"];
                    e.each(o, function (e, t) {
                        var n = (i[t] || 0) + (u[t] || 0);
                        n && n >= 0 && (s[t] = n || null)
                    }), t.css(s)
                })
            };
            "object" != typeof i.alsoResize || i.alsoResize.nodeType ? a(i.alsoResize) : e.each(i.alsoResize, function (e, t) {
                a(e, t)
            })
        }, stop: function () {
            e(this).removeData("resizable-alsoresize")
        }
    }), e.ui.plugin.add("resizable", "ghost", {
        start: function () {
            var t = e(this).data("ui-resizable"), n = t.options, r = t.size;
            t.ghost = t.originalElement.clone(), t.ghost.css({
                opacity: .25,
                display: "block",
                position: "relative",
                height: r.height,
                width: r.width,
                margin: 0,
                left: 0,
                top: 0
            }).addClass("ui-resizable-ghost").addClass("string" == typeof n.ghost ? n.ghost : ""), t.ghost.appendTo(t.helper)
        }, resize: function () {
            var t = e(this).data("ui-resizable");
            t.ghost && t.ghost.css({position: "relative", height: t.size.height, width: t.size.width})
        }, stop: function () {
            var t = e(this).data("ui-resizable");
            t.ghost && t.helper && t.helper.get(0).removeChild(t.ghost.get(0))
        }
    }), e.ui.plugin.add("resizable", "grid", {
        resize: function () {
            var t = e(this).data("ui-resizable"), n = t.options, r = t.size, i = t.originalSize, s = t.originalPosition,
                o = t.axis, u = "number" == typeof n.grid ? [n.grid, n.grid] : n.grid, a = u[0] || 1, f = u[1] || 1,
                l = Math.round((r.width - i.width) / a) * a, c = Math.round((r.height - i.height) / f) * f,
                h = i.width + l, p = i.height + c, d = n.maxWidth && h > n.maxWidth, v = n.maxHeight && p > n.maxHeight,
                m = n.minWidth && n.minWidth > h, g = n.minHeight && n.minHeight > p;
            n.grid = u, m && (h += a), g && (p += f), d && (h -= a), v && (p -= f), /^(se|s|e)$/.test(o) ? (t.size.width = h, t.size.height = p) : /^(ne)$/.test(o) ? (t.size.width = h, t.size.height = p, t.position.top = s.top - c) : /^(sw)$/.test(o) ? (t.size.width = h, t.size.height = p, t.position.left = s.left - l) : (p - f > 0 ? (t.size.height = p, t.position.top = s.top - c) : (t.size.height = f, t.position.top = s.top + i.height - f), h - a > 0 ? (t.size.width = h, t.position.left = s.left - l) : (t.size.width = a, t.position.left = s.left + i.width - a))
        }
    })
}(jQuery), define("flot/jquery-ui-1.10.4.custom.min", function () {
}), function (e, t, n) {
    "$:nomunge";

    function p(n) {
        o === !0 && (o = n || 1);
        for (var u = r.length - 1; u >= 0; u--) {
            var c = e(r[u]);
            if (c[0] == t || c.is(":visible")) {
                var h = c.width(), d = c.height(), v = c.data(f);
                v && (h !== v.w || d !== v.h) && (c.trigger(a, [v.w = h, v.h = d]), o = n || !0)
            } else v = c.data(f), v.w = 0, v.h = 0
        }
        s !== null && (o && (n == null || n - o < 1e3) ? s = t.requestAnimationFrame(p) : (s = setTimeout(p, i[l]), o = !1))
    }

    var r = [], i = e.resize = e.extend(e.resize, {}), s, o = !1, u = "setTimeout", a = "resize",
        f = a + "-special-event", l = "pendingDelay", c = "activeDelay", h = "throttleWindow";
    i[l] = 200, i[c] = 20, i[h] = !0, e.event.special[a] = {
        setup: function () {
            if (!i[h] && this[u]) return !1;
            var t = e(this);
            r.push(this), t.data(f, {w: t.width(), h: t.height()}), r.length === 1 && (s = n, p())
        }, teardown: function () {
            if (!i[h] && this[u]) return !1;
            var t = e(this);
            for (var n = r.length - 1; n >= 0; n--) if (r[n] == this) {
                r.splice(n, 1);
                break
            }
            t.removeData(f), r.length || (o ? cancelAnimationFrame(s) : clearTimeout(s), s = null)
        }, add: function (t) {
            function s(t, i, s) {
                var o = e(this), u = o.data(f) || {};
                u.w = i !== n ? i : o.width(), u.h = s !== n ? s : o.height(), r.apply(this, arguments)
            }

            if (!i[h] && this[u]) return !1;
            var r;
            if (e.isFunction(t)) return r = t, s;
            r = t.handler, t.handler = s
        }
    }, t.requestAnimationFrame || (t.requestAnimationFrame = function () {
        return t.webkitRequestAnimationFrame || t.mozRequestAnimationFrame || t.oRequestAnimationFrame || t.msRequestAnimationFrame || function (e, n) {
            return t.setTimeout(function () {
                e((new Date).getTime())
            }, i[c])
        }
    }()), t.cancelAnimationFrame || (t.cancelAnimationFrame = function () {
        return t.webkitCancelRequestAnimationFrame || t.mozCancelRequestAnimationFrame || t.oCancelRequestAnimationFrame || t.msCancelRequestAnimationFrame || clearTimeout
    }())
}(jQuery, this), function (e) {
    function n(e) {
        function t() {
            var t = e.getPlaceholder();
            if (t.width() == 0 || t.height() == 0) return;
            e.resize(), e.setupGrid(), e.draw()
        }

        function n(e, n) {
            e.getPlaceholder().resize(t)
        }

        function r(e, n) {
            e.getPlaceholder().unbind("resize", t)
        }

        e.hooks.bindEvents.push(n), e.hooks.shutdown.push(r)
    }

    var t = {};
    e.plot.plugins.push({init: n, options: t, name: "resize", version: "1.0"})
}(jQuery), define("flot/jquery.flot.resize.min", function () {
}), function (e) {
    function t(e, t, n) {
        var r = {
            square: function (e, t, n, r, i) {
                var s = r * Math.sqrt(Math.PI) / 2;
                e.rect(t - s, n - s, s + s, s + s)
            }, diamond: function (e, t, n, r, i) {
                var s = r * Math.sqrt(Math.PI / 2);
                e.moveTo(t - s, n), e.lineTo(t, n - s), e.lineTo(t + s, n), e.lineTo(t, n + s), e.lineTo(t - s, n)
            }, triangle: function (e, t, n, r, i) {
                var s = r * Math.sqrt(2 * Math.PI / Math.sin(Math.PI / 3)), o = s * Math.sin(Math.PI / 3);
                e.moveTo(t - s / 2, n + o / 2), e.lineTo(t + s / 2, n + o / 2), i || (e.lineTo(t, n - o / 2), e.lineTo(t - s / 2, n + o / 2))
            }, cross: function (e, t, n, r, i) {
                var s = r * Math.sqrt(Math.PI) / 2;
                e.moveTo(t - s, n - s), e.lineTo(t + s, n + s), e.moveTo(t - s, n + s), e.lineTo(t + s, n - s)
            }
        }, i = t.points.symbol;
        r[i] && (t.points.symbol = r[i])
    }

    function n(e) {
        e.hooks.processDatapoints.push(t)
    }

    e.plot.plugins.push({init: n, name: "symbols", version: "1.0"})
}(jQuery), define("flot/jquery.flot.symbol.min", function () {
}), define("tools/TETools/ProfileTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "internal/InputMode", "./ProgressTool", "internal/GeometryHelper", "tools/ToolDialog", "flot/jquery.flot.min", "flot/jquery.flot.navigate.min", "flot/jquery-ui-1.10.4.custom.min", "flot/jquery.flot.resize.min", "flot/jquery.flot.symbol.min", "tools/ListControl", "internal/Navigate", "internal/TEPosition", "internal/NotificationCenter"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g) {
    "use strict";

    function y() {
        this._explanationText = t.i18n("analysis_profile_explanation_text"), this._explanationTextOnStartOnly = !0, this._listControl = null, this._listControlToolContainer = null, this._eventListener = null, this._isOpened = !1, this._collections = new Cesium.PrimitiveCollection, viewer.scene.primitives.add(this._collections), this._distancePoints = new Cesium.BillboardCollection, this._collections.add(this._distancePoints), this._profileLine = null, this._profileLine2 = null, this._levelToSample = Number.MAX_VALUE, this._groundLine = null, this._distanceLabels = new Cesium.BillboardCollection, this._collections.add(this._distanceLabels), this._isCalculatingModelHeights = !1, this._progressPoints = new Cesium.BillboardCollection, this._collections.add(this._progressPoints), this._canCalculate = !1, this.reset(), this.getId = function () {
            return "ProfileTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Analyze_Profile"), "./img/newDesign/analyze_profile.png", 28, r.MenuEntryAnalyze(), t.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }
    }

    function w(e, t) {
        this.longitude = e.longitude, this.latitude = e.latitude, this._height = e.height, this._requestID = t, this._slope = 0
    }

    y.inheritsFrom(o), Cesium.defineProperties(y.prototype, {
        FirstPoint: {
            get: function () {
                return this._distancePoints.length == 0 ? null : this._distancePoints.get(0).position
            }
        }, LastPoint: {
            get: function () {
                return this._distancePoints.length == 0 ? null : this._distancePoints.get(this._distancePoints.length - 1).position
            }
        }, BeforeLastPoint: {
            get: function () {
                return this._distancePoints.length < 2 ? null : this._distancePoints.get(this._distancePoints.length - 2).position
            }
        }, ShowRawProfileGraph: {
            get: function () {
                return this._showRawProfileGraph
            }, set: function (e) {
                this._showRawProfileGraph = !!e
            }
        }
    }), y.prototype.onOpenedToolContainer = function () {
        this.reset(), this._explanationTextOnStartOnly = !1, e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Analyze_Profile"))
    }, y.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0, this._isOpened = !1
    }, y.prototype.onBeforeOpenToolContainer = function () {
        return s.Mode = s.MEASUREMENT, e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.onLeftClick, this), Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.setInputAction(e.proxy(this.onRightClick, this), Cesium.ScreenSpaceEventType.RIGHT_CLICK), this._isOpened = !0, this.parent.onBeforeOpenToolContainer.call(this), this.showNormalButtons(), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText), g.addObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, y.prototype.onBeforeCloseToolContainer = function (e) {
        return this.parent.onBeforeCloseToolContainer.call(this, e), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK), this.reset(), s.Mode = s.FREE_FLIGHT, a.IsOpen && a.close(), g.removeObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, y.prototype.showNormalButtons = function () {
        this.ToolContainer.removeButtons(), this.ToolContainer.addButton(1, "./img/delete.png", undefined, t.i18n("measure_distance_tooltip_delete")), this.ToolContainer.addButton(2, "./img/delete_last_point.png", undefined, t.i18n("measure_distance_tooltip_delete_last_point")), this.ToolContainer.addButton(3, "./img/profile.png", undefined, t.i18n("measure_profile_tooltip_terrain_profile"))
    }, y.prototype.reset = function () {
        this._toolContainerText = "", this.ToolContainer !== null && (this.ToolContainer.enableButton("1", !1), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("3", !1)), this._listControl != null && this._listControl.removeAll(), this._distancePoints.removeAll(), this._profileLine != null && (viewer.scene.primitives.remove(this._profileLine), this._profileLine = null, viewer.scene.primitives.remove(this._profileLine2), this._profileLine2 = null), this._distanceLabels.removeAll(), this._progressPoints.removeAll(), this._levelToSample = Number.MAX_VALUE, viewer.entities.remove(this._groundLine), this._groundLine = null, this._totalArealDist = 0, this._totalHorizontalDist = 0, this._slopFirstToLast = 0, this._elevationDifference = 0, this._groundDistance = 0, this._terrainProfileRequestID = 0, this._samplePoints = [], this._showRawProfileGraph = !1, this._rawSamplePoints = [], this._isCalculatingModelHeights = !1, this._minSlopeIndex = -1, this._maxSlopeIndex = -1, this._minAltitudeIndex = -1, this._maxAltitudeIndex = -1, this._waypointsIndexes = [], this._graph = null, this._canCalculate = !1, e("#Mask3D").remove()
    }, y.prototype.unitsChanged = function (e) {
        this.updateDistanceText()
    }, y.prototype.onButtonClick = function (e) {
        this.parent.onButtonClick.call(this, e);
        switch (e) {
            case 1:
                this.reset(), this.updateDistanceText(), a.IsOpen && a.close();
                break;
            case 2:
                if (this._distancePoints.length > 1) {
                    var t = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.BeforeLastPoint),
                        n = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.LastPoint);
                    this._totalArealDist -= u.geoDist(t, n), this._totalHorizontalDist -= u.geoDist2D(t, n), this._distancePoints.remove(this._distancePoints.get(this._distancePoints.length - 1)), this._distanceLabels.remove(this._distanceLabels.get(this._distanceLabels.length - 1)), this.rebuildProfileLine(!1), this.asyncUpdateElevationAndSlopeDiff()
                } else this.reset(), this.updateDistanceText();
                break;
            case 3:
                if (this._distancePoints.length > 1) {
                    if (this._graph !== null) {
                        this.showProfileDialog();
                        return
                    }
                    this.doWorkAsync(), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("3", !1), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)
                }
        }
    }, y.prototype.updateDistanceText = function () {
        if (this._totalArealDist == 0 && this._totalHorizontalDist == 0 && this._slopFirstToLast == 0 && this._elevationDifference == 0) this._toolContainerText = ""; else {
            var n = e("<div style='position:relative;overflow:hidden; width:100%; height:100%;'></div>"),
                r = e("<div id='MessageClientId' style='position:relative;margin-left:5px; margin-top:0px; overflow-y:auto; width:100%;'></div>");
            e("#LowerView").length > 0 && e("#LowerView").append(n), TerraExplorer.tools.ToolContainer.setText(""), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), r.css({height: n.height()}), this._listControl = new d(r), this._listControl.IsAnalyzeToolList = !0, n.append(r);
            var s = t.i18n("measure_distance_aerial", {adist: i.formatDistance(this._totalArealDist)}),
                o = t.i18n("measure_distance_horizontal", {hdist: i.formatDistance(this._totalHorizontalDist)}),
                u = t.i18n("measure_distance_slope", {slope: this._slopFirstToLast.toFixed(2)}),
                a = t.i18n("measure_distance_elevation", {elevationDiff: i.formatDistance(this._elevationDifference)});
            this._listControl.add({text: s, query: !0}), this._listControl.add({
                text: o,
                query: !0
            }), this._listControl.add({text: a, query: !0}), this._listControl.add({text: u, query: !0})
        }
    }, y.prototype.asyncUpdateElevationAndSlopeDiff = function () {
        var t = this, n = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.FirstPoint),
            r = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.LastPoint);
        n.pointOnModel = this.FirstPoint.pointOnModel, r.pointOnModel = this.LastPoint.pointOnModel;
        var i = TerraExplorer.functions.queryBestLevel(n), s = TerraExplorer.functions.queryBestLevel(r);
        Cesium.when.all([i, s], function (i) {
            var s = Math.min(i[0], i[1]);
            if (!t._isOpened) return;
            var o = Cesium.sampleTerrain(viewer.terrainProvider, s, [n, r]);
            Cesium.when(o, e.proxy(function (e) {
                e[0].pointOnModel == 1 && (e[0] = viewer.scene.globe.ellipsoid.cartesianToCartographic(t.FirstPoint)), e[1].pointOnModel == 1 && (e[1] = viewer.scene.globe.ellipsoid.cartesianToCartographic(t.LastPoint)), t._elevationDifference = e[1].height - e[0].height;
                var i = u.geoDist2D(n, r);
                t._slopFirstToLast = Cesium.Math.toDegrees(Math.atan2(t._elevationDifference, i)), t.updateDistanceText(), t._levelToSample = s, t._canCalculate = !0
            }, this))
        })
    };
    var b = null;
    return y.prototype.onLeftClick = function (e) {
        if (v.IsMultiGestureNavigation) return;
        if (this._isCalculatingModelHeights) return;
        var t = {}, n = viewer.scene.screenToWorld(e.position, t);
        if (n) {
            this._distancePoints.add({
                position: n,
                image: "img/point_white.png",
                eyeOffset: Cesium.DynamicEyeOffset()
            }), this._distancePoints.get(this._distancePoints.length - 1).position.pointOnModel = t.pickPrimitive instanceof Cesium.Model || t.pickPrimitive instanceof Cesium.Cesium3DTileset, this._distancePoints.length > 0 && (this._toolContainer.enableButton("1", !0), this._toolContainer.enableButton("2", !0));
            if (this._distancePoints.length > 1) {
                this._toolContainer.enableButton("3", !0);
                var r = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.BeforeLastPoint),
                    s = viewer.scene.globe.ellipsoid.cartesianToCartographic(this.LastPoint), o = u.geoDist(r, s);
                this._totalArealDist += o, this._totalHorizontalDist += u.geoDist2D(r, s), this.asyncUpdateElevationAndSlopeDiff(), this.rebuildProfileLine(!1), this._distanceLabels.add(TerraExplorer.style.segmentBillboardOptions(i.formatDistance(o, !0, !0), this.BeforeLastPoint, this.LastPoint))
            }
            this.updateDistanceText()
        }
    }, y.prototype.isProfileOnModel = function () {
        var t = !1, n = viewer.scene.globe, r = TerraExplorer.internal.Project.MeshLayers, i = [];
        this._distancePoints._billboards.forEach(function (e) {
            i.push(e.position)
        });
        var s = Cesium.Rectangle.fromCartesianArray(i), o = Cesium.Rectangle.center(s), u = e.grep(r, function (e) {
            return e.show && e.curRect !== undefined && Cesium.Rectangle.intersection(s, e.curRect) !== undefined
        });
        if (u.length > 0) {
            var a = u[0], f = a._selectedTiles;
            e(f).each(function (e, r) {
                var i = r.boundingVolume.rectangle;
                if (i !== undefined) Cesium.Rectangle.intersection(s, i) !== undefined && (t = !0); else {
                    var u = Cesium.BoundingSphere.fromRectangle3D(s);
                    u.center = Cesium.Cartesian3.fromRadians(o.longitude, o.latitude, n.getHeight(o));
                    var a = r.boundingVolume.boundingSphere, f = Cesium.Cartesian3.distance(a.center, u.center);
                    f <= a.radius + u.radius && (t = !0)
                }
            })
        }
        return t
    }, y.prototype.rebuildProfileLine = function (e) {
        if (this._distancePoints.length < 1) return;
        this._distancePoints.length < 2 && this.ToolContainer.enableButton("3", !1), this._profileLine != null && viewer.scene.primitives.remove(this._profileLine), this._profileLine2 != null && viewer.scene.primitives.remove(this._profileLine2);
        var t = [];
        if (this._samplePoints.length == 0 || e == 0) for (var n = 0; n < this._distancePoints.length; n++) t.push(this._distancePoints.get(n).position); else for (var n = 0; n < this._samplePoints.length; n++) {
            var r = this._samplePoints[n].clone();
            r = viewer.scene.globe.ellipsoid.cartographicToCartesian(r), t.push(r)
        }
        this._distancePoints.length >= 2 && (this._profileLine = viewer.scene.primitives.add(new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.PolylineGeometry({
                    positions: t,
                    ellipsoid: Cesium.Ellipsoid.WGS84,
                    vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT,
                    width: 2
                }), attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1, 1, 1, .3))}
            }), asynchronous: !1, allowPicking: !1, appearance: new Cesium.PolylineColorAppearance({})
        })), this._profileLine.appearance.renderState.depthTest.enabled = !1, this._profileLine2 = viewer.scene.primitives.add(new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.PolylineGeometry({
                    positions: t,
                    ellipsoid: Cesium.Ellipsoid.WGS84,
                    vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT,
                    width: 2
                }), attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1, 1, 1, 1))}
            }), asynchronous: !1, allowPicking: !1, appearance: new Cesium.PolylineColorAppearance({})
        })), this._profileLine2.appearance.renderState.depthTest.enabled = !1)
    }, y.prototype.onRightClick = function (e) {
    }, y.prototype.doWork = function (e) {
        var t = Cesium.when.defer(), n = this, r = setInterval(function () {
            n._canCalculate && t.resolve()
        }, 200);
        Cesium.when(t, function () {
            clearInterval(r), n.calculateTerrainProfile(undefined, e)
        })
    }, w.inheritsFrom(Cesium.Cartographic), Cesium.defineProperties(w.prototype, {
        height: {
            get: function () {
                return this._height
            }, set: function (e) {
                this._height = e, this.onHeightSet != null && this.onHeightSet(this)
            }
        }, slope: {
            get: function () {
                return this._slope
            }, set: function (e) {
                this._slope = e
            }
        }
    }), w.prototype.onHeightSet = null, y.prototype.calculateTerrainProfile = function (t, n) {
        e(".containerButton").css("left", "2px"), e(".containerView").css("left", "120px");
        if (this._distancePoints.length < 2) return -1;
        if (t <= 0 || t == undefined) this._totalArealDist < 100 ? t = .5 : this._totalArealDist < 1e3 ? t = 1 : t = this._totalArealDist / 1e3;
        this._samplePoints = [], this._rawSamplePoints = [], this._minSlopeIndex = -1, this._maxSlopeIndex = -1, this._minAltitudeIndex = -1, this._maxAltitudeIndex = -1, this._waypointsIndexes = [];
        var r = this._terrainProfileRequestID, i = [],
            s = viewer.scene.globe.ellipsoid.cartesianToCartographic(this._distancePoints.get(0).position);
        this._samplePoints.push(new w(s, r)), this._waypointsIndexes[0] = !0;
        for (var o = 0; o < this._distancePoints.length - 1; o++) {
            var u = Cesium.Cartesian3.distance(this._distancePoints.get(o).position, this._distancePoints.get(o + 1).position);
            i.push(this._distancePoints.get(o).position), i.push(this._distancePoints.get(o + 1).position);
            var a = viewer.scene.globe.ellipsoid.cartesianToCartographic(this._distancePoints.get(o).position),
                f = viewer.scene.globe.ellipsoid.cartesianToCartographic(this._distancePoints.get(o + 1).position);
            if (t > u) {
                this._samplePoints.push(new w(f, r)), this._waypointsIndexes[this._samplePoints.length - 1] = !0;
                continue
            }
            var l = new Cesium.Cartesian3, c = t / u;
            for (var h = c; h < 1; h += c) Cesium.Cartesian3.lerp(this._distancePoints.get(o).position, this._distancePoints.get(o + 1).position, h, l), this._samplePoints.push(new w(viewer.scene.globe.ellipsoid.cartesianToCartographic(l), r));
            this._samplePoints.push(new w(f, r)), this._waypointsIndexes[this._samplePoints.length - 1] = !0
        }
        var p = this._samplePoints.length, d = 0, v = 0;
        w.prototype.onHeightSet = e.proxy(function (e) {
            if (e._requestID != this._terrainProfileRequestID) return;
            d++;
            var t = Math.ceil(d / p * 100);
            t > v && (this.setProgress(d, p), v = t, this._progressPoints.removeAll(), this._progressPoints.add({
                position: viewer.scene.globe.ellipsoid.cartographicToCartesian(e),
                image: "img/point_progress.png"
            }))
        }, this);
        var m = {};
        m.positions = i, m.clampToGround = !0, m.width = 3, m.material = Cesium.Color.YELLOW;
        var g = this.isProfileOnModel();
        this._groundLine !== null && viewer.entities.remove(this._groundLine), g || (this._groundLine = viewer.entities.add(new Cesium.Entity({polyline: m})));
        var y = {
            position: viewer.camera.position.clone(),
            orientation: {heading: viewer.camera.heading, pitch: viewer.camera.pitch, roll: viewer.camera.roll}
        };
        this._collections.show = !1, viewer.render();
        var b = Cesium.sampleTerrain(viewer.terrainProvider, this._levelToSample, this._samplePoints);
        Cesium.when(b, e.proxy(function (t) {
            if (r != this._terrainProfileRequestID) return;
            if (g) {
                e(viewer.scene.primitives._primitives).each(function (e, t) {
                    t instanceof Cesium.GroundPolylinePrimitive && t.show && (t.showTemp = t.show, t.show = !1)
                });
                var i = e("<img id='Mask3D'style='position:absolute; left:1px; top:1; width:1px; height:1px; z-index:10; box-shadow:0 0 0 99999px rgba(0, 0, 0, .7);'></img>");
                e("#" + window.divId).append(i), this._isCalculatingModelHeights = !0, this.getModelHeights(t, 0, e.proxy(function () {
                    this.onFinishedCalculateTerrainProfile(t, r, y, n)
                }, this))
            } else this.onFinishedCalculateTerrainProfile(t, r, y, n)
        }, this))
    }, y.prototype.getModelHeights = function (e, t, n) {
        if (this._distancePoints.length == 0) return;
        var r = 1;
        do {
            if (t >= e.length) {
                n();
                return
            }
            var i = e[t];
            viewer.camera.setView({
                destination: Cesium.Cartesian3.fromRadians(i.longitude, i.latitude, i._height + 300),
                orientation: {heading: Cesium.Math.toRadians(0), pitch: Cesium.Math.toRadians(-90), roll: 0}
            }), viewer.render();
            var s = i._height, o = viewer.scene.canvas.width / 2, u = viewer.scene.canvas.height / 2,
                a = {pickPrimitive: undefined}, f = viewer.scene.screenToWorld(Cesium.Cartesian2.fromElements(o, u), a);
            f != undefined && (s = viewer.scene.globe.ellipsoid.cartesianToCartographic(f).height);
            if (a.pickPrimitive == undefined) {
                viewer.camera.setView({
                    destination: Cesium.Cartesian3.fromRadians(i.longitude, i.latitude, i._height + 300),
                    orientation: {heading: Cesium.Math.toRadians(0), pitch: Cesium.Math.toRadians(-89), roll: 0}
                }), viewer.render();
                var f = viewer.scene.screenToWorld(Cesium.Cartesian2.fromElements(o, u), a);
                f != undefined && (s = viewer.scene.globe.ellipsoid.cartesianToCartographic(f).height)
            }
            s != i._height && a.pickPrimitive != undefined && (i._height = s);
            var l = parseInt(e.length / 100, 10);
            t % l == 0 && this.setProgress(t, e.length), r--, t++
        } while (r > 0 && this._isCalculatingModelHeights);
        if (this._isCalculatingModelHeights) {
            var c = this;
            setTimeout(function () {
                c.getModelHeights(e, t, n)
            }, 1)
        }
        this._isCalculatingModelHeights || n()
    }, y.prototype.onFinishedCalculateTerrainProfile = function (t, n, r, i) {
        e(viewer.scene.primitives._primitives).each(function (e, t) {
            t instanceof Cesium.GroundPolylinePrimitive && t.showTemp !== undefined && (t.show = t.showTemp, delete t.showTemp)
        }), this.restoreNormalView(r), this._isCalculatingModelHeights = !1;
        if (n != this._terrainProfileRequestID) return;
        if (this._showRawProfileGraph == 1) for (var s = 0; s < t.length; s++) this._rawSamplePoints[s] = t[s].clone();
        this.smoothSamples(t), this._groundDistance = 0;
        for (var s = 0; s < t.length; s++) {
            t[s].height == undefined && (t[s].height = 0);
            if (this._maxAltitudeIndex == -1 || t[s].height > t[this._maxAltitudeIndex].height) this._maxAltitudeIndex = s;
            if (this._minAltitudeIndex == -1 || t[s].height < t[this._minAltitudeIndex].height) this._minAltitudeIndex = s;
            var o = 0;
            if (s > 0) {
                o = this.calcSlope(t[s - 1], t[s]), t[s - 1].slope = o;
                if (this._maxSlopeIndex == -1 || o > t[this._maxSlopeIndex].slope) this._maxSlopeIndex = s - 1;
                if (this._minSlopeIndex == -1 || o < t[this._minSlopeIndex].slope) this._minSlopeIndex = s - 1;
                this._groundDistance += u.geoDist(t[s - 1], t[s])
            }
        }
        this.setProgress(t.length, t.length), i != undefined && i()
    }, y.prototype.restoreNormalView = function (t) {
        this._collections.show = !0, viewer.camera.setView({
            destination: t.position,
            orientation: t.orientation
        }), this.rebuildProfileLine(this._isCalculatingModelHeights), e("#Mask3D").remove()
    }, y.prototype.smoothSamples = function (e) {
        var t = [];
        for (var n = 0; n < e.length; n++) {
            e[n].height == undefined && (e[n].height = 0);
            var r;
            n >= 1 ? r = e[n - 1].height || 0 : r = e[0].height || 0;
            var i;
            n >= 2 ? i = e[n - 2].height || 0 : i = r;
            var s;
            n < e.length - 1 ? s = e[n + 1].height || 0 : s = e[e.length - 1].height || 0;
            var o;
            n < e.length - 2 ? o = e[n + 2].height || 0 : o = s, t[n] = (.5 * i + 1 * r + 2 * e[n].height + 1 * s + .5 * o) / 5
        }
        for (var n = 0; n < e.length; n++) e[n].height = t[n]
    }, y.prototype.calcSlope = function (e, t) {
        var n = u.geoDist2D(e, t), r = 180 / Math.PI * Math.atan2(t.height - e.height, n);
        return r
    }, y.prototype.workCompleted = function () {
        this._isCalculatingModelHeights = !1;
        if (this.CancelWork == 0) {
            var e = t.i18n("measure_distance_ground", {gdist: i.formatDistance(this._groundDistance)}),
                n = this._listControl;
            this._listControl.add = n, this.showProfileDialog()
        }
        this._progressPoints.removeAll(), this._terrainProfileRequestID++
    }, y.prototype.showProfileDialog = function () {
        var n = 500, r = 600, s = r - 250, o = this, f = e("<div class='profileToolDiv toolResponsiveClass'></div>"),
            l = e("<div id='chartdiv'></div>");
        f.append(l);
        var c = e("<div id='tooltip'></div>").css({
            position: "absolute",
            display: "none",
            border: "1px solid rgba(30, 30, 30, 0.7)",
            padding: "5px",
            "background-color": "rgba(90, 90, 90, 0.2)",
            opacity: .8,
            fontSize: "12px"
        });
        f.append(c);
        var h = t.i18n("measure_distance_aerial", {adist: i.formatDistance(this._totalArealDist)}),
            p = t.i18n("measure_distance_elevation", {elevationDiff: i.formatDistance(this._elevationDifference)}),
            g = t.i18n("measure_distance_ground", {gdist: i.formatDistance(this._groundDistance)}),
            y = h + "<br>" + p + "<br>" + g,
            b = e("<p class='TextViewClassP' id='TextView' style='position:relative; top:55%; margin:10px; font-size:10pt; line-height:200%;'>" + y + "</p>");
        f.append(b);
        var w = e("<div class='showCheckboxesDiv' style='position:relative; overflow-y:auto; width:100%; top:56%; height: 156px;'></div>");
        f.append(w), a.close(), a.open(t.i18n("title_activity_terrain_profile"), "./img/dialogs/header_icons/Terrain_Profile.png", f.get(0), undefined, undefined, undefined, !1);
        var E = 1, S = 1, x = [], T = [], N = [], C = [], k = [], L = [], A = [], O = [], M = [],
            _ = this._samplePoints.length;
        for (var D = 0; D < _; D++) T[D] = [D * E * S, this._samplePoints[D].height * S], this._showRawProfileGraph && (N[D] = [D * E * S, this._rawSamplePoints[D].height * S]), this._maxAltitudeIndex == D && (k[D] = [D * E * S, this._samplePoints[D].height * S]), this._minAltitudeIndex == D && (L[D] = [D * E * S, this._samplePoints[D].height * S]), this._maxSlopeIndex == D && (A[D] = [D * E * S, this._samplePoints[D].height * S]), this._minSlopeIndex == D && (O[D] = [D * E * S, this._samplePoints[D].height * S]), this._waypointsIndexes[D] && (C[D] = [D * E * S, this._samplePoints[D].height * S], D != this._samplePoints.length - 1 && M.push({
            xaxis: {
                from: D,
                to: D
            }, yaxis: {from: this._samplePoints[D].height * S, to: 0}, color: "rgba(0, 0, 0, 0.2)"
        }));
        var P = this._samplePoints[this._minAltitudeIndex].height < 0;
        if (P) for (var D = 0; D < M.length; D++) M[D].yaxis.to = this._samplePoints[this._minAltitudeIndex].height;
        x.push({
            data: T,
            lines: {show: !0, fill: P ? 0 : .5, zero: !1},
            color: "#303030"
        }), this._showRawProfileGraph && x.push({
            data: N,
            lines: {show: !0, zero: !1},
            color: "#CAFF51"
        }), x.push({data: k, points: {show: !0, symbol: "square", radius: 4}, color: "#ff00ff"}), x.push({
            data: L,
            points: {show: !0, symbol: "square", radius: 4},
            color: "#ff00ff"
        }), x.push({data: A, points: {show: !0, symbol: "diamond", radius: 4}, color: "#0000ff"}), x.push({
            data: O,
            points: {show: !0, symbol: "diamond", radius: 4},
            color: "#0000ff"
        }), x.push({data: C, points: {show: !0, symbol: "circle", radius: 2}, color: "#000000"});
        var H = this._samplePoints[this._maxAltitudeIndex].height * S,
            B = this._samplePoints[this._minAltitudeIndex].height * S, j = Math.max(1, Math.abs(H - B)), F = j * .2,
            I = B - F / 4, q = H + F;
        this._graph = e.plot("#chartdiv", x, {
            xaxis: {panRange: [0, this._samplePoints.length], show: !0},
            yaxis: {min: I, max: q, zoomRange: [.1, j * F * 2], panRange: [I, q], position: "right"},
            grid: {hoverable: !0, clickable: !0, markings: M},
            zoom: {interactive: !0},
            pan: {interactive: !0}
        });
        var R = typeof InstallTrigger != "undefined";
        e(e(".listControlLineTextHeaderProfile")[0]).css("width", "100%");
        var U = new d(w);
        U.LinePadding = 4, U.add({
            header: !0,
            text: t.i18n("measure_terrain_profile_show_header"),
            greyCheckbox: !0,
            thinHeader: !0,
            paddingLeft: !0
        }), U.add({
            text: t.i18n("measure_terrain_profile_show_slopes"),
            img: "./img/dialogs/profile_minmax_slope.png",
            greyCheckbox: !0,
            thinHeader: !0,
            paddingLeft: !0,
            checkbox: {
                isDialogToolCheckBox: !0, isChecked: !0, onClick: function () {
                    var t = e(this).is(":checked");
                    o.showInfo([3, 4], t)
                }
            }
        }), U.add({
            text: t.i18n("measure_terrain_profile_show_altitude"),
            greyCheckbox: !0,
            thinHeader: !0,
            paddingLeft: !0,
            img: "./img/dialogs/profile_minmax_altitude.png",
            checkbox: {
                isDialogToolCheckBox: !0, isChecked: !0, onClick: function () {
                    var t = e(this).is(":checked");
                    o.showInfo([1, 2], t)
                }
            }
        }), U.add({
            greyCheckbox: !0,
            thinHeader: !0,
            paddingLeft: !0,
            text: t.i18n("measure_terrain_profile_show_waypoints"),
            img: "./img/dialogs/profile_waypoint.png",
            checkbox: {
                isDialogToolCheckBox: !0, isChecked: !0, onClick: function () {
                    var t = e(this).is(":checked");
                    o.showInfo([5], t)
                }
            }
        }), w.css("height", "157px"), e("#chartdiv").bind("plothover", function (t, n, r) {
            r ? o.ToolTip(r) : e("#tooltip").hide()
        }), e("#chartdiv").bind("plotclick", function (e, t, n) {
            if (n) {
                var r = 0;
                n.dataIndex > 0 ? r = u.getHeadingPitchRange(o._samplePoints[n.dataIndex - 1], o._samplePoints[n.dataIndex]).heading : r = u.getHeadingPitchRange(o._samplePoints[n.dataIndex], o._samplePoints[n.dataIndex + 1]).heading;
                var i = [];
                for (var s = 0; s < o._distancePoints.length; s++) i.push(o._distancePoints.get(s).position);
                var a = Cesium.BoundingRectangle.fromPoints(i),
                    f = Math.sqrt(a.width * a.width + a.height * a.height) / 4, l = new m({
                        cartesian: viewer.scene.globe.ellipsoid.cartographicToCartesian(o._samplePoints[n.dataIndex]),
                        headingPitchRange: new Cesium.HeadingPitchRange(r, Cesium.Math.toRadians(-70), f)
                    });
                v.flyToPosition(l)
            }
        }), e(".toolDialog .listControlLineTextNormalSidebar").each(function () {
            e(this).attr("class", "listControlLineTextNormalProfile")
        }), e(".toolDialog .listControlLineSidebar").each(function () {
            e(this).attr("class", "listControlLineProfile")
        }), e(".toolDialog .listControlLineTextHeaderSidebar").each(function () {
            e(this).attr("class", "listControlLineTextHeaderProfile")
        }), TerraExplorer.isTouch() && (e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0), e(".profileToolDiv").width("100%"), e("#chartdiv").width("100%"), e(".profileToolDiv").height("100%"), e("#chartdiv").height("44%"), e(".TextViewClassP").css("top", "45%"), e(".showCheckboxesDiv").css("top", "47%"))
    }, y.prototype.showInfo = function (e, t) {
        var n = this._graph.getData();
        for (var r = 0; r < e.length; r++) n[e[r]].points.show = t;
        this._graph.setData(n), this._graph.draw()
    }, y.prototype.ToolTip = function (n) {
        var r = "", i = n.dataIndex, s = 0;
        i < this._samplePoints.length - 1 && (s = this.calcSlope(this._samplePoints[i], this._samplePoints[i + 1])), r = "X: " + Cesium.Math.toDegrees(this._samplePoints[i].longitude).toFixed(8) + "<br/>Y: " + Cesium.Math.toDegrees(this._samplePoints[i].latitude).toFixed(8) + "<br/>" + t.i18n("measure_terrain_profile_tooltip_height") + ": " + this._samplePoints[i].height.toFixed(2) + "<br/>" + t.i18n("measure_distance_slope", {slope: s.toFixed(2)}), e("#tooltip").html(r).css({
            top: 20,
            left: 20
        }).fadeIn(200), this._progressPoints.removeAll(), this._progressPoints.add({
            position: viewer.scene.globe.ellipsoid.cartographicToCartesian(this._samplePoints[i]),
            image: "img/point_progress.png"
        })
    }, y
}), define("tools/TabControl", ["../jquery", "../TELang"], function (e, t) {
    "use strict";
    var n = function (t) {
        this.TabsDiv = e("<div style='white-space: nowrap;'></div>"), t.append(this.TabsDiv), this._selectedTab = 0
    };
    return Cesium.defineProperties(n.prototype, {
        SelectedTab: {
            get: function () {
                return this._selectedTab
            }, set: function (e) {
                if (e >= this.TabCount) return;
                this.onClick(e)
            }
        }, TabCount: {
            get: function () {
                return this.TabsDiv.find(".tabButton").length
            }
        }, Div: {
            get: function () {
                return this.TabsDiv
            }
        }
    }), n.prototype.add = function (t, n) {
        var r = this.TabCount,
            i = e("<button type='button' class='tabButton' id='TabButton" + r + "' style=''>" + t + "</button>").click(e.proxy(function () {
                this.onClick(r)
            }, this));
        this.TabsDiv.append(i);
        var s = this.TabsDiv.parent().outerWidth() / (r + 1) - 1, o = this.TabsDiv.children();
        for (var u = 0; u < o.length; u++) e(o[u]).css({width: u == o.length - 1 ? s + 1 : s});
        r == 0 && (this.SelectedTab = 0), i.get(0).tabClickHandler = n
    }, n.prototype.onClick = function (t) {
        var n = this.TabsDiv.find(".tabButton");
        for (var r = 0; r < n.length; r++) {
            var i = e(n[r]);
            r == t ? (i.css({"background-color": "rgba(50, 50, 50, 1.0)"}), this._selectedTab = r, i.get(0).tabClickHandler != undefined && i.get(0).tabClickHandler(r)) : i.css("background-color", "")
        }
    }, n
}), define("tools/DisplayGroupItem", ["jquery"], function (e) {
    "use strict";
    var t = function (e, t) {
        this.name = e, this.childItems = [], t != undefined && (this.childItems = t.slice()), this.getItem = function (e) {
            return this.childItems.length == 0 ? null : e < 0 || e >= this.childItems.length ? null : this.childItems[e]
        }
    };
    return t
}), define("tools/DisplayItem", ["jquery"], function (e) {
    "use strict";
    var t = function (e, t, n, r) {
        this.id = "", this.attributedName = r != undefined ? r : "", this.name = e, this.subTitle = "", this.accessoryIcon = n != undefined ? n : "", this.accessoryText = "", this.icon = t != undefined ? t : "", this.tag = 0
    };
    return t
}), define("internal/Presentation", ["jquery", "TELang", "./Navigate", "./NotificationCenter", "tools/ToolDialog"], function (e, t, n, r, i) {
    "use strict";
    var s = function (t) {
        this._id = undefined, this._presentationData = null, this._currentStepIndex = -1, this._status = 1, this._timeout = undefined, this._loop = !0, this.presentationSpeed = undefined, this.playSpeedStep = undefined, this.PresentationSpeed = {
            VERY_SLOW: 5,
            SLOW: 4,
            NORMAL: undefined,
            FAST: 2,
            VERY_FAST: .5
        };
        var n = e.grep(TerraExplorer.internal.Project.Presentations, function (e, n) {
            return e.id == t
        });
        if (n.length == 1) {
            var i = n[0];
            i && (this._id = t, this._presentationData = i, this.presentationSpeed = this.getPlaySpeed(i.playSpeed))
        }
        r.addObserver(this, "onUserStop", "TEN_USER_INITIATE_STOP", null)
    };
    s.PLAYING = 0, s.NOTPLAYING = 1, s.PAUSED = 2, s.WAITINGTIME = 3, s.WAITINGCLICK = 4, s.BEFORE_SWITCHING_TO_ANOTHER_PRESENTATION = 5, s.AFTER_SWITCHING_FROM_ANOTHER_PRESENTATION = 6, Cesium.defineProperties(s.prototype, {
        id: {
            get: function () {
                return this._id
            }
        }, Status: {
            get: function () {
                return this._status
            }
        }, StepIndex: {
            get: function () {
                return this._currentStepIndex
            }
        }, Steps: {
            get: function () {
                return this._presentationData.playlist
            }
        }, Name: {
            get: function () {
                return this._presentationData.name
            }
        }, Loop: {
            get: function () {
                return this._loop
            }, set: function (e) {
                this._loop = e
            }
        }
    }), s.fromId = function (e) {
        return new s(e)
    }, s.prototype.play = function (t, i) {
        t == undefined && (t = this._currentStepIndex), this._currentStepIndex = t;
        if (this._currentStepIndex >= this._presentationData.playlist.length) {
            if (!this._loop) {
                this.stop();
                return
            }
            this._currentStepIndex = 0
        }
        if (this._currentStepIndex < 0) {
            this._currentStepIndex = 0, this.playSpeedStep = undefined, this._status = s.PAUSED, r.postNotification("TEN_PRESENTATION_STATUS_CHANGED", this, this);
            return
        }
        if (this._currentStepIndex === 0 || i) this.playSpeedStep = undefined;
        if (i) for (var o = this._currentStepIndex - 1; o >= 0; o--) {
            var u = this._presentationData.playlist[o];
            if (u.type === "playSpeedStep") {
                this.playSpeedStep = this.getPlaySpeed(u.speed.toLowerCase());
                break
            }
        }
        this._status != s.PLAYING && (this._status = s.PLAYING, r.postNotification("TEN_PRESENTATION_STATUS_CHANGED", this, this)), r.postNotification("TEN_PRESENTATION_STEP", this, this);
        var a = this._presentationData.playlist[this._currentStepIndex];
        if (a.type === "FlyTo") {
            var f = !0;
            if (this._currentStepIndex < this._presentationData.playlist.length - 1) {
                var l = this._presentationData.playlist[this._currentStepIndex + 1];
                f = l.type === "FlyTo" && l.flyToMode === "smooth"
            }
            if (this.presentationSpeed || this.playSpeedStep) {
                var c = Math.ceil(Cesium.Cartesian3.distance(viewer.scene.camera.position, a.tePosition.cartesian) / 1e6) + 2;
                this.presentationSpeed && this.playSpeedStep ? a.duration = c * this.presentationSpeed * this.playSpeedStep : this.presentationSpeed ? a.duration = c * this.presentationSpeed : this.playSpeedStep && (a.duration = c * this.playSpeedStep)
            }
            n.flyToPosition(a.tePosition, {
                complete: e.proxy(function () {
                    this.play(this._currentStepIndex + 1)
                }, this),
                duration: a.duration,
                easingFunction: a.flyToMode === "smooth" && f ? Cesium.EasingFunction.LINEAR_NONE : undefined,
                pausePresentation: !1
            })
        } else a.type === "Wait" ? this._timeout = setTimeout(e.proxy(function () {
            this.play(this._currentStepIndex + 1)
        }, this), a.duration * 1e3) : a.type === "Caption" ? this.play(this._currentStepIndex + 1) : a.type === "message" ? (a.messageType === "html" ? TerraExplorer.tools.ToolManager._tools.MessageLinkTool.showHtmlMessage(a.content) : a.messageType === "text" && TerraExplorer.tools.ToolManager._tools.MessageLinkTool.showTextMessage(a.content), this.play(this._currentStepIndex + 1)) : a.type === "playSpeedStep" && (this.playSpeedStep = this.getPlaySpeed(a.speed.toLowerCase()), this.play(this._currentStepIndex + 1))
    }, s.prototype.next = function () {
        this.clearWait(), n.stop();
        if (this._currentStepIndex == this._presentationData.playlist.length - 1) {
            if (!this._loop) {
                this.stop();
                return
            }
            this._currentStepIndex = 0
        }
        var e = this._presentationData.playlist[this._currentStepIndex];
        e.type == "FlyTo" && n.jumpToPosition(e.tePosition, {pausePresentation: !1}), this._currentStepIndex++, this._currentStepIndex < 0 && (this._currentStepIndex = 0), r.postNotification("TEN_PRESENTATION_STEP", this, this), this._status == s.PLAYING && this.play()
    }, s.prototype.jumpToEndOfPrevStep = function (t) {
        var r = Math.max(0, t - 1), i = e.grep(this._presentationData.playlist, function (e, t) {
            return e.type == "FlyTo" && t <= r
        });
        i.length > 0 && n.jumpToPosition(i[i.length - 1].tePosition, {pausePresentation: !1})
    };
    var o = undefined;
    return s.prototype.previous = function () {
        clearTimeout(o), this.clearWait(), n.stop(), this.jumpToEndOfPrevStep(this._currentStepIndex), this._currentStepIndex = Math.max(0, this._currentStepIndex - 1), r.postNotification("TEN_PRESENTATION_STEP", this, this), this._status == s.PLAYING && (o = setTimeout(e.proxy(this.play, this), 1e3))
    }, s.prototype.stop = function () {
        this.clearWait(), n.stop(), this._currentStepIndex = -1, this._status = s.NOTPLAYING, r.postNotification("TEN_PRESENTATION_STATUS_CHANGED", this, this)
    }, s.prototype.pause = function () {
        this.clearWait(), n.stop(), this._status = s.PAUSED, r.postNotification("TEN_PRESENTATION_STATUS_CHANGED", this, this)
    }, s.prototype.resume = function () {
        if (this._currentStepIndex < 0 || this._currentStepIndex >= this._presentationData.playlist.length) return;
        this.play()
    }, s.prototype.clearWait = function () {
        this._timeout != undefined && (clearTimeout(this._timeout), this._timeout = undefined)
    }, s.prototype.showKeySteps = function () {
        i.close(), TerraExplorer.tools.ToolManager.openTool("PresentationStepsTool", this)
    }, s.prototype.onUserStop = function (e) {
        this.pause()
    }, s.prototype.getPlaySpeed = function (e) {
        if (e) switch (e.toLowerCase()) {
            case"very slow":
                return this.PresentationSpeed.VERY_SLOW;
            case"slow":
                return this.PresentationSpeed.SLOW;
            case"normal":
                return this.PresentationSpeed.NORMAL;
            case"fast":
                return this.PresentationSpeed.FAST;
            case"very fast":
                return this.PresentationSpeed.VERY_FAST
        }
    }, s
}), define("tools/TETools/PlacesTool", ["jquery", "TELang", "../MenuEntry", "tools/ToolDialog", "./FavoritesStorage", "tools/TabControl", "tools/ListControl", "internal/Navigate", "../DisplayGroupItem", "../DisplayItem", "internal/Presentation", "internal/Globals", "../ToolProtocol", "internal/GeometryHelper"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p) {
    "use strict";
    var d = function () {
        this._sideStyle = !0, this._locationText = "", this._locations = new a(t.i18n("places_locations")), this._presentations = new a(t.i18n("places_presentations")), this._favorites = new a(t.i18n("places_favorites")), this._all = new a(t.i18n("all")), this._dataSource = null, this._favoritesStorage = i.DefaultStorage, this._tabControl = null, this._listControl = null, this.ToolManager = null, this.getId = function () {
            return "PlacesTool"
        }, this.getMenuEntry = function () {
            return n.addToSidebar(this, "LocationsandPresentations", undefined, 20, n.MenuEntryNavigation(), t.i18n("NavigationPlaces_Header"), undefined, !0)
        }, this.open = function (n) {
            var i = e("<div id='placesBigDiv'></div>");
            this._sideStyle ? (this._tabControl = new s(i), this._tabControl.add(t.i18n("all"), e.proxy(this.onFilterValueChanged, this))) : (this._tabControl = new s(i), this._tabControl.add(t.i18n("all"), e.proxy(this.onFilterValueChanged, this)), this._tabControl.add(t.i18n("places_favorites"), e.proxy(this.onFilterValueChanged, this)), this._tabControl.add(t.i18n("places_locations"), e.proxy(this.onFilterValueChanged, this)), this._tabControl.add(t.i18n("places_presentations"), e.proxy(this.onFilterValueChanged, this)));
            var u = e("<div id='ListParentID' class='PlacesToolList' style='position:absolute; width:100%;height:60%;z-index:99999'></div>");
            i.append(u), this._listControl = new o(u), e("#sidebarContentDiv").empty(), this._sideStyle ? (u.css("position", "relative"), r.openAsSideToolDialog(t.i18n("Menu_Places"), "./img/dialogs/header_icons/places.png", i.get(0)), u.css({height: i.height() - 0})) : r.open(t.i18n("Menu_Places"), "./img/dialogs/header_icons/places.png", i.get(0)), this.reloadData(), TerraExplorer.tools.SideBar.ChangeStyleForSideTools("div"), TerraExplorer.tools.SideBar.ChangeStyleForSideTools("span"), e(".toolDialog #closeXID").length > 0 && (e(".toolDialog #closeXID").attr("onCloseProcess") || (e(".toolDialog #closeXID").attr("onCloseProcess", "1"), e(".toolDialog #closeXID").click())), e("#TabButton0").click(), e("#TabButton0").remove();
            var a = TerraExplorer.browser.isEdge, f = TerraExplorer.browser.isSafari,
                l = TerraExplorer.browser.isFirefox;
            a && e("#leftButton").css("top", "20px"), l && e("#leftButton").css("top", "18px"), f && e("#leftButton").css("top", "8px"), window.PlacesDiv = i.detach()
        }
    };
    return d.inheritsFrom(h), Cesium.defineProperties(d.prototype, {}), d.prototype.addBlankSpace = function () {
        for (var e = 0; e < 3; e++) this._listControl.add({text: "", locationsSubHeader: !0})
    }, d.prototype.onFilterValueChanged = function (e) {
        this._listControl.removeAll(), e == 0 ? (this._dataSource = this._all, this._dataSource.childItems = this._locations.childItems.concat(this._favorites.childItems, this._presentations.childItems), this.buildList(this._locations), this.buildList(this._favorites), this.buildList(this._presentations), this.addBlankSpace(), this._listControl.add({text: ""}), this._listControl.add({text: ""})) : e == 1 ? (this._dataSource = this._locations, this.buildList(this._locations)) : e == 2 ? (this._dataSource = this._favorites, this.buildList(this._favorites)) : e == 3 && (this._dataSource = this._presentations, this.buildList(this._presentations))
    }, d.prototype.buildList = function (t) {
        if (t.childItems.length == 0) return;
        var n, r, i = 0, s = e.proxy(this.onFlyTo, this);
        t == this._locations ? (n = "", r = "./img/dialogs/header_icons/places.png", i = 2) : t == this._favorites ? (n = "", r = "./img/favorits.png", i = 1) : t == this._presentations && (n = "", r = "./img/placesTool_presentation.png", i = 3, s = e.proxy(this.onPlay, this));
        for (var o = 0; o < t.childItems.length; o++) {
            var u = t.childItems[o];
            this._listControl.add({
                onClick: s,
                img: u.icon,
                paddingLeft: !0,
                text: u.name,
                id: u.id,
                locationsSubHeader: !0,
                buttons: this.getRowButtonsForFilter(i),
                image: u.image
            })
        }
    }, d.prototype.getRowButtonsForFilter = function (t) {
        switch (t) {
            case 1:
                return [{
                    img: "./img/newDesign/places_flyto.png",
                    onClick: e.proxy(this.onFlyTo, this)
                }, {
                    img: "./img/newDesign/places_jumpto.png",
                    onClick: e.proxy(this.onJumpTo, this)
                }, {
                    img: "./img/newDesign/places_rename.png",
                    onClick: e.proxy(this.onEdit, this)
                }, {img: "./img/newDesign/places_delete.png", onClick: e.proxy(this.onDelete, this)}];
            case 3:
                return [{
                    img: "./img/dialogs/actions/play.png",
                    onClick: e.proxy(this.onPlay, this)
                }, {img: "./img/dialogs/actions/list.png", onClick: e.proxy(this.onShowPresentationStep, this)}]
        }
    }, d.prototype.reloadData = function () {
        this._locations.childItems.length = 0;
        for (var e = 0; e < TerraExplorer.internal.Project.Locations.length; e++) {
            var t = TerraExplorer.internal.Project.Locations[e], n = new f(t.name, "./img/dialogs/locations.png");
            n.id = t.id, n.image = t.image, this._locations.childItems.push(n)
        }
        this._favorites.childItems.length = 0;
        var r = this._favoritesStorage.getAll();
        for (var e = 0; e < r.length; e++) {
            var i = r[e], n = new f(i.name, "./img/dialogs/favorit_places.png");
            n.id = i.id, this._favorites.childItems.push(n)
        }
        this._presentations.childItems.length = 0;
        for (var e = 0; e < TerraExplorer.internal.Project.Presentations.length; e++) {
            var s = TerraExplorer.internal.Project.Presentations[e],
                n = new f(s.name, "./img/dialogs/presentation.png");
            n.id = s.id, this._presentations.childItems.push(n)
        }
    }, d.prototype.onAddFavorites = function (e) {
        alert(e)
    }, d.prototype.onFlyTo = function (t) {
        var n, i;
        TerraExplorer.navigate.flyAround.stop(), t.target instanceof HTMLImageElement ? n = e(t.target).parent().prev()[0].innerText.trim() : (n = t.target.textContent, i = e(t.target).data("id"));
        var s = e.grep(this._dataSource.childItems, function (e) {
            var t = e.name.substring(0, 27) == n.substring(0, 27);
            return t && (i == undefined ? !0 : e.id == i)
        })[0], o = this.getItemPosition(s);
        if (o) {
            var u = this, a, f = TerraExplorer.internal.Engine;
            o.headingPitchRange === undefined && (o.headingPitchRange = new Cesium.HeadingPitchRange);
            var l = f.offsetFromHeadingPitchRange(o.headingPitchRange.heading, o.headingPitchRange.pitch, o.headingPitchRange.range).z,
                c = viewer.scene.globe.ellipsoid.cartesianToCartographic(o.Cartesian).height;
            if (Cesium.Cartesian3.distance(viewer.camera.position, o.Cartesian) < 3e4 || c > 6e3 || c + l > 6e3) TerraExplorer.internal.Navigate.flyToPosition(new TerraExplorer.internal.TEPosition(o), {
                levelToSample: a,
                slDuration: !0
            }), r.close(); else {
                var h = o.Cartesian, p = viewer.scene.globe.ellipsoid.cartesianToCartographic(h),
                    d = Cesium.Cartographic.fromRadians(p.longitude, p.latitude, 6e3),
                    v = viewer.scene.globe.ellipsoid.cartographicToCartesian(d),
                    m = TerraExplorer.internal.SearchBox.flyToTempFlyLocation(v, {
                        heading: 0,
                        pitch: Cesium.Math.toRadians(-89)
                    }), g = TerraExplorer.functions.queryBestLevel(d);
                g.then(function (e) {
                    a = e;
                    var t = Cesium.sampleTerrain(viewer.terrainProvider, e, [d]);
                    Cesium.when.all([t, m], function (e) {
                        var t = e[0], n = t[0].height;
                        n === undefined && (n = 0), TerraExplorer.internal.Navigate.flyToPosition(new TerraExplorer.internal.TEPosition(o), {
                            levelToSample: a,
                            slDuration: !1
                        }), r.close()
                    }).otherwise(function (e) {
                        console.log(e)
                    })
                })
            }
        }
        TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
    }, d.prototype.onJumpTo = function (t) {
        var n = this._dataSource.getItem(t.data.index), i = this.getItemPosition(n);
        i && (u.jumpToPosition(i), r.close()), TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
    }, d.prototype.getItemPosition = function (t) {
        var n = null, r = this._favoritesStorage.getItem(t.id);
        if (r != null) n = r.tePosition; else {
            var i = e.grep(TerraExplorer.internal.Project.Locations, function (e) {
                return e.id == t.id
            });
            i.length == 1 && (n = i[0].tePosition)
        }
        return n
    }, d.prototype.onEdit = function (e) {
        var t = this._dataSource.getItem(e.data.index);
        r.close(), this.ToolManager.openTool("EditFavoriteTool", {id: t.id})
    }, d.prototype.onDelete = function (t) {
        var n = this._dataSource.getItem(t.data.index);
        this._favoritesStorage.deleteItem(n.id), this.reloadData(), e("#menuIconMenu_Navigation").length > 0 && e("#menuIconMenu_Navigation").click(), TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
    }, d.prototype.onPlay = function (n) {
        var i = Cesium.defaultValue(n.data.index, n.data), s = this._dataSource.getItem(i),
            o = e("#toolDialogTitleID").text() === t.i18n("title_activity_presentation", {presentationName: s.name});
        r.close(), l.fromId(s.id).play(0), o && this.onShowPresentationStep(n), TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
    }, d.prototype.onShowPresentationStep = function (e) {
        var t = this._dataSource.getItem(e.data.index);
        l.fromId(t.id).showKeySteps()
    }, d
}), define("tools/TETools/LayersTool", ["jquery", "TELang", "../MenuEntry", "tools/ToolDialog", "./LayersStorage", "tools/TabControl", "tools/ListControl", "../DisplayGroupItem", "../DisplayItem", "internal/Globals", "../ToolProtocol", "internal/Settings", "wfs/Layer"], function (e, t, n, r, i, s, o, u, a, f, l, c, h) {
    "use strict";
    var p = 1, d = 2, v = 3, m = 4, g = 5, y = 6, b = 7, w = 8, E = 9, S = 10, x = function () {
        this._objects = null, this._cptLayers = null, this._meshLayers = null, this._elevationLayers = null, this._rasterLayers = null, this._featureLayers = null, this._dataSource = null, this._myLayers = null, this._myLayersDictionary = [], this._showProjectLayersOnly = !0, this._currentButton = 1, this._layersStorage = i.DefaultStorage, this._loadLayersToolResizing = !1, this._alreadyHasLeftButton = !1;
        var a = this;
        this.getId = function () {
            return "LayersTool"
        }, this.getMenuEntry = function () {
            return n.addToSidebar(this, "", undefined, 30, n.MenuEntryLayers(), t.i18n("menuEntry_displayName_Layers"), undefined, !0)
        }, this.open = function () {
            var n = e("<div id='LayersDiv' style='position:absolute; width:100%;height:60%;'></div>");
            this._loadLayersToolResizing = !1, this._tabControl = new s(n), this._tabControl.add(t.i18n("all"), e.proxy(this.onFilterValueChanged, this)), this._tabControl.add(t.i18n("layers_project_layers"), e.proxy(this.onFilterValueChanged, this)), this._tabControl.add(t.i18n("layers_my_layers"), e.proxy(this.onFilterValueChanged, this));
            var i = e("<div id='ListParentID' class='LayersToolClass' style='position:absolute; width:100%;height:100%;'></div>");
            n.append(i), i.css("position", "relative"), this._listControl = new o(i), this._listControl.IsAnalyzeToolList = !1, e("#sidebarContentDiv").empty(), r.openAsSideToolDialog(t.i18n("Menu_Layers"), "./img/dialogs/header_icons/layers.png", n.get(0)), i.css({height: n.height()}), this._dataSource = new u, this._dataSource.childItems = this.getLayersDataItems("all"), e("#TabButton0").click(), e("#TabButton0").parent().remove();
            var a = TerraExplorer.browser.isEdge, f = TerraExplorer.browser.isSafari,
                l = TerraExplorer.browser.isFirefox;
            a && e("#leftButton").css("top", "20px"), l && e("#leftButton").css("top", "18px"), f && e("#leftButton").css("top", "8px"), TerraExplorer.tools.MenuButton.layout.loadLayersButton || e("#LayersDiv").css("top", "44px"), window.LayersDiv = n.detach()
        }
    };
    return x.inheritsFrom(l), Cesium.defineProperties(x.prototype, {
        MyLayers: {
            get: function () {
                return this._myLayersDictionary
            }
        }, TEWTypes: {
            get: function () {
                return this._tewTypes
            }
        }, LoadLayersToolResizing: {
            get: function () {
                return this._loadLayersToolResizing
            }
        }
    }), x.prototype.onFilterValueChanged = function (e) {
        this._listControl.removeAll(), this._showProjectLayersOnly = !1, e == 0 ? (this._currentButton = 1, this.readLayers(), this._dataSource = this._all, this._dataSource.childItems = this._myLayers.childItems.concat(this._featureLayers.childItems, this._rasterLayers.childItems, this._elevationLayers.childItems, this._meshLayers.childItems, this._cptLayers.childItems), this.buildList(this._myLayers), this.buildList(this._featureLayers), this.buildList(this._rasterLayers), this.buildList(this._elevationLayers), this.buildList(this._meshLayers), this.buildList(this._cptLayers), this.addBlankRows()) : e == 1 ? (this._currentButton = 2, this._showProjectLayersOnly = !0, this.readLayers(), this._dataSource.childItems = this._featureLayers.childItems.concat(this._rasterLayers.childItems, this._meshLayers.childItems, this._cptLayers.childItems), this.buildList(this._featureLayers), this.buildList(this._rasterLayers), this.buildList(this._meshLayers), this.buildList(this._cptLayers)) : e == 2 && (this._currentButton = 3, this.readLayers(), this._dataSource = this._myLayers, this.buildList(this._myLayers))
    }, x.prototype.insertMyLayersKey = function (e) {
        var t = this, n = e.guid;
        e.timestamp = Cesium.defaultValue(e.timestamp, Date.now()), this._myLayersDictionary[n] = !0, typeof e.refresh == "function" && e.refresh(), e.myLayer === TerraExplorer.SGWorld.Creator.CreateFor.UI && (e.readyPromise !== undefined ? e.readyPromise.then(function () {
            t._layersStorage.saveItem(e)
        }) : this._layersStorage.saveItem(e))
    }, x.prototype.onEdit = function (t) {
        var n = this._dataSource.getItem(t.data.index), r = this.getLayerFromItem(n),
            i = this.ToolManager._tools.LayerToolbox._layer;
        i != null && i._layerName != r._layerName && e(".toolDialog").remove(), this.ToolManager.openTool("LayerToolbox", {
            layer: r,
            item: n,
            layersTool: this
        }), r.type == "viewshed" && this.ToolManager.openTool("Viewshed", r), TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
    }, x.prototype.onAttributeTable = function (e) {
        var t = this._dataSource.getItem(e.data.index), n = this.getLayerFromItem(t);
        this.ToolManager.openTool("AttributeTableTool", {layer: n, onLoadQuery: null, onLoadFeatures: null})
    }, x.prototype.onDelete = function (t) {
        var n = this._dataSource.getItem(t.data.index),
            r = TerraExplorer.tools.ToolManager._tools.EditLayersTool._currentItem;
        if (r !== null) {
            var i = getLayerFromItem(n);
            i.guid === r.guid && e(".toolDialog #closeXID").length > 0 && e(".toolDialog #closeXID").click()
        }
        this.deleteLayer(n)
    }, x.prototype.deleteLayer = function (t) {
        e(".toolDialog #closeXID").length > 0 && e(".toolDialog #closeXID").click();
        var n = this.getLayerFromItem(t), r = null;
        if (n.type == "mesh" || n.type == "cpt") {
            r = TerraExplorer.internal.Project.MeshLayers;
            for (var i = 0; i < viewer.scene.primitives._primitives.length; i++) {
                var s = viewer.scene.primitives.get(i);
                if (t.id == s.guid) {
                    if (s.rootFloorAdded !== undefined) {
                        var o = TerraExplorer.internal.Project._modelModifyTerrainObjects[s.guid],
                            u = e.grep(viewer.terrainProvider._modifyTerrainObjects, function (e) {
                                return e.id === o
                            });
                        u.length === 1 && (u[0].destroy(), delete TerraExplorer.internal.Project._modelModifyTerrainObjects[s.guid])
                    }
                    viewer.scene.primitives.remove(s)
                }
            }
        } else if (n instanceof Cesium.KmlDataSource) viewer.dataSources.remove(n), r = TerraExplorer.internal.Project.KmlLayers; else if (n.type.substring(0, 4) == "Feat") r = TerraExplorer.internal.Project.FeatureLayers, r = r.sort(function (e, t) {
            return e.indexInProjectTree - t.indexInProjectTree
        }); else if (n.type == "imagery") for (var i = 0; i < viewer.imageryLayers.length; i++) {
            var a = viewer.imageryLayers.get(i);
            a.guid == t.id && viewer.imageryLayers.remove(a)
        } else if (n.type == "elevation") {
            var f = TerraExplorer.internal.Project.ElevationLayers;
            for (var i = 0, l = f.length; i < l; i++) {
                var c = f[i];
                if (c.guid == n.guid) {
                    f.splice(i, 1);
                    break
                }
            }
            viewer.terrainProvider.refreshElevationLayer(c)
        }
        var h = 0, p = 0;
        if (r != null) {
            for (var i = 0; i < r.length; i++) r[i].guid == n.guid && (h = i);
            r.splice(h, 1)
        }
        for (var d = 0; d < this._myLayers.childItems.length; ++d) {
            var v = this._myLayers.childItems[d];
            v.id == t.id && (p = d)
        }
        this._myLayers.childItems.splice(p, 1), n.show = !1, Cesium.defined(this._myLayersDictionary[t.id]) && delete this._myLayersDictionary[t.id], this._layersStorage.deleteItem(t.name), this.readLayers(), TerraExplorer.internal.Project.removelayerFromTEObj(n);
        switch (this._currentButton) {
            case 1:
                e("#TabButton0").click();
                break;
            case 2:
                e("#TabButton1").click();
                break;
            case 3:
                e("#TabButton2").click()
        }
        e("#menuIconMenu_Layers").length > 0 && e("#menuIconMenu_Layers").click()
    }, x.prototype.getLayersDataItems = function () {
        this._objects == null && (this._objects = new u, this._meshLayers = new u(t.i18n("layers_mesh_layers")), this._cptLayers = new u(t.i18n("layers_cpt_layers")), this._rasterLayers = new u(t.i18n("layers_raster_layers")), this._elevationLayers = new u(t.i18n("layers_elevation_layers")), this._featureLayers = new u(t.i18n("layers_feature_layers")), this._myLayers = new u(t.i18n("layers_my_layers")), this._all = new u(t.i18n("all")), this.readLayers()), this._dataSource.childItems = this._objects.childItems.concat(this._meshLayers.childItems, this._cptLayers.childItems, this._rasterLayers.childItems, this._elevationLayers.childItems, this._featureLayers.childItems), this.buildList(this._featureLayers), this.buildList(this._rasterLayers), this.buildList(this._elevationLayers), this.buildList(this._meshLayers), this.buildList(this._cptLayers), this.buildList(this._myLayers)
    }, x.prototype.isMyLayer = function (e) {
        if (e === null) return !1;
        var t = this._myLayersDictionary[e.guid];
        return t != undefined ? !0 : !1
    }, x.prototype.isMyLayerWithUI = function (e) {
        return e.myLayer === TerraExplorer.SGWorld.Creator.CreateFor.UI
    }, x.prototype.readLayers = function () {
        this._myLayers.childItems.length = 0, this._featureLayers.childItems.length = 0;
        var e = TerraExplorer.internal.Project.FeatureLayers;
        e = e.sort(function (e, t) {
            return e.indexInProjectTree - t.indexInProjectTree
        });
        for (var t = 0; t < e.length; t++) {
            var n = e[t];
            if (!this.isMyLayer(n)) {
                var r = "./img/dialogs/Feature_layers_points.png";
                n.Style.polygon ? r = "./img/dialogs/Feature_layers_polygons.png" : n.Style.polyline && (r = "./img/dialogs/Feature_layers_polylines.png")
            } else {
                var r = "./img/dialogs/myLayers_Feature_layers_points.png";
                n.Style.polygon ? r = "./img/dialogs/myLayers_Feature_layers_polygons.png" : n.Style.polyline && (r = "./img/dialogs/myLayers_Feature_layers_polylines.png")
            }
            var i = new a(n.LayerDisplayName, r);
            i.id = n.guid, i.tag = p, i.latLon = n.latLon, this._featureLayers.childItems.push(i), this.isMyLayer(n) && (this.isMyLayerWithUI(n) && this._myLayers.childItems.push(i), this._featureLayers.childItems.pop())
        }
        for (var t = 0; t < TerraExplorer.internal.Project.KmlLayers.length; t++) {
            var n = TerraExplorer.internal.Project.KmlLayers[t];
            if (!this.isMyLayer(n)) var r = "./img/dialogs/Kml_layers.png"; else var r = "./img/dialogs/myLayers_Kml_layers.png";
            var i = new a(n.LayerDisplayName, r);
            i.id = n.guid, i.tag = b, this._featureLayers.childItems.push(i), this.isMyLayer(n) && (this.isMyLayerWithUI(n) && this._myLayers.childItems.push(i), this._featureLayers.childItems.pop())
        }
        this._rasterLayers.childItems.length = 0;
        for (var t = 0; t < viewer.imageryLayers.length; t++) {
            var n = viewer.imageryLayers.get(t);
            if (n.displayName) {
                if (!this.isMyLayer(n)) var r = "./img/dialogs/Imagery_layers.png"; else var r = "./img/dialogs/myLayers_Imagery_layers.png";
                var i = new a(n.displayName, r);
                i.id = n.guid, i.tag = d, i.latLon = n.latLon, this._rasterLayers.childItems.push(i), this.isMyLayer(n) && (this.isMyLayerWithUI(n) && this._myLayers.childItems.push(i), this._rasterLayers.childItems.pop())
            }
        }
        this._elevationLayers.childItems.length = 0;
        var s = TerraExplorer.internal.Project.ElevationLayers;
        if (s != null) {
            var o = s.length;
            for (var t = 0; t < o; t++) {
                var n = s[t];
                if (n.displayName) {
                    if (!this.isMyLayer(n)) var r = "./img/dialogs/Imagery_layers.png"; else var r = "./img/dialogs/myLayers_Imagery_layers.png";
                    var i = new a(n.displayName, r);
                    i.id = n.guid, i.tag = E, i.latLon = n.latLon, this._elevationLayers.childItems.push(i), this.isMyLayer(n) && (this.isMyLayerWithUI(n) && this._myLayers.childItems.push(i), this._elevationLayers.childItems.pop())
                }
            }
        }
        this._meshLayers.childItems.length = 0;
        for (var t = 0; t < TerraExplorer.layers.mesh.items.length; t++) {
            var n = TerraExplorer.layers.mesh.items[t]._object;
            if (n.type === "mesh") if (!this.isMyLayer(n)) var r = "./img/dialogs/3D_layers.png"; else var r = "./img/dialogs/myLayers_3D_layers.png";
            var i = new a(n.displayName, r);
            i.id = n.guid, i.tag = v, this._meshLayers.childItems.push(i), this.isMyLayer(n) && (this.isMyLayerWithUI(n) && this._myLayers.childItems.push(i), this._meshLayers.childItems.pop())
        }
        this._cptLayers.childItems.length = 0;
        for (var t = 0; t < TerraExplorer.layers.pointCloud.items.length; t++) {
            var n = TerraExplorer.layers.pointCloud.items[t]._object;
            if (n.type == "cpt") if (!this.isMyLayer(n)) var r = "./img/dialogs/PointCloud_layers.png"; else var r = "./img/dialogs/myLayers_PointCloud_layers.png";
            var i = new a(n.displayName, r);
            i.id = n.guid, i.tag = v, this._cptLayers.childItems.push(i), this.isMyLayer(n) && (this.isMyLayerWithUI(n) && this._myLayers.childItems.push(i), this._cptLayers.childItems.pop())
        }
    }, x.prototype.buildList = function (e) {
        if (e.childItems.length == 0) return;
        var n, r;
        e == this._featureLayers ? (n = t.i18n("layers_feature_layers"), r = "./img/dialogs/Feature_layers_pointsIcon.png") : e == this._rasterLayers ? (n = t.i18n("layers_raster_layers"), r = "./img/layers.png") : e == this._elevationLayers ? (n = t.i18n("layers_elevation_layers"), r = "./img/layers.png") : e == this._meshLayers ? (n = t.i18n("layers_mesh_layers"), r = "./img/dialogs/3D_layersIcon.png") : e == this._cptLayers ? (n = t.i18n("layers_cpt_layers"), r = "./img/dialogs/PointCloud_layers.png") : e == this._myLayers && (n = t.i18n("layers_my_layers"), r = "./img/favorits.png");
        for (var i = 0; i < e.childItems.length; i++) this.addEntryToListControl(e.childItems[i])
    }, x.prototype.addBlankRows = function () {
        for (var e = 0; e < 4; e++) this._listControl.add({text: ""})
    }, x.prototype.addEntryToListControl = function (t) {
        t == -1 && this._listControl.add({});
        var n = this.getLayerFromItem(t), r = this.isMyLayer(n), s = this;
        t.latLon != undefined && t.latLon == 1 || t.latLon == undefined ? this._listControl.add({
            onClick: function (e) {
                if (e.target.nodeName == "LABEL" || e.target.nodeName == "INPUT") return;
                s.onFlyTo(t)
            },
            img: t.icon,
            paddingLeft: !0,
            isvcheck: !0,
            text: t.name,
            buttons: this.getRowButtonsForEntry(t, r),
            checkbox: {
                isChecked: s.getShowLayer(t), onClick: function () {
                    var r = e(this).is(":checked");
                    s.showLayer(t, r), s.isMyLayer(n) && i.saveItem(n)
                }
            },
            isLayerControl: n != undefined
        }) : this._listControl.add({
            onClick: function () {
            },
            img: t.icon,
            paddingLeft: !0,
            isvcheck: !0,
            text: t.name,
            disabled: !0,
            buttons: this.getRowButtonsForEntry(t, r, !0),
            checkbox: {
                isChecked: !1, onClick: function () {
                }
            },
            isLayerControl: n != undefined
        })
    }, x.prototype.getItemFromLayer = function (t) {
        var n = this, r;
        return e(this._dataSource.childItems).each(function (e, n) {
            return n.id === t.guid ? (r = n, !1) : !0
        }), r
    }, x.prototype.getLayerFromItem = function (t) {
        if (t.tag == p) {
            var n = e.grep(TerraExplorer.internal.Project.FeatureLayers, function (e) {
                return e.guid == t.id
            });
            if (n.length == 1) return n[0]
        } else if (t.tag == d) for (var r = 0; r < viewer.imageryLayers.length; r++) {
            var i = viewer.imageryLayers.get(r);
            if (i.guid == t.id) return i
        } else if (t.tag == E) {
            var s = TerraExplorer.internal.Project.ElevationLayers;
            if (s != null) {
                var o = s.length;
                for (var r = 0; r < o; r++) {
                    var i = s[r];
                    if (i.guid == t.id) return i
                }
            }
        } else if (t.tag == b) {
            var n = e.grep(TerraExplorer.internal.Project.KmlLayers, function (e) {
                return e.guid == t.id
            });
            if (n.length == 1) return n[0]
        } else if (t.tag == v) for (var r = 0; r < viewer.scene.primitives.length; r++) {
            var i = viewer.scene.primitives.get(r);
            if (i.guid == t.id) return i
        } else if (t.tag == S) {
            var u = TerraExplorer.internal.Project, a = u._allAnalysisObjects[u._objectTypes.VIEWSHED];
            for (var r = 0, f = a.length; r < f; r++) {
                var l = a[r]._object;
                if (l.guid == t.id) return l
            }
        } else if (t.tag === y) {
            var c = TerraExplorer.internal.Project._allAnalysisObjects, h;
            Object.values(c).forEach(function (e) {
                e.forEach(function (e) {
                    e._object.id == t.id && (h = e._object)
                })
            });
            if (h !== undefined) return h
        }
        return null
    }, x.prototype.onFlyTo = function (t) {
        var n;
        t.type === undefined ? n = this.getLayerFromItem(t) : n = t, n.BoundingBox != undefined && n.BoundingBox.beenModified != undefined && (n.BoundingBox.east -= 1, n.BoundingBox.north -= 1, delete n.BoundingBox.beenModified);
        if (!t.tag && t.type) switch (t.type) {
            case"FeaturePolygon":
            case"FeatureLine":
            case"FeaturePoint":
                t.tag = p;
                break;
            case"imagery":
                t.tag = d;
                break;
            case"elevation":
                t.tag = E;
                break;
            default:
                TerraExplorer.internal.Project.KmlLayers.indexOf(t) > -1 ? t.tag = b : TerraExplorer.internal.Project.MeshLayers.indexOf(t) > -1 && (t.tag = v)
        }
        var i = TerraExplorer.internal.Navigate.DEFAULT_FLY_TO_DURATION;
        if (n) switch (t.tag) {
            case p:
                viewer.camera.flyTo({duration: i, destination: n.BoundingBox});
                break;
            case b:
                viewer.flyTo(n);
                break;
            case d:
                viewer.camera.flyTo({duration: i, destination: n.imageryProvider.rectangle});
                break;
            case E:
                viewer.camera.flyTo({duration: i, destination: n.rectangle});
                break;
            case v:
                if (n.type === "cpt" || n.properties === undefined) {
                    var s = n.boundingSphere;
                    s === undefined && (s = n._root !== undefined ? n._root.boundingSphere : undefined), s !== undefined && viewer.camera.flyToBoundingSphere(s, {duration: i})
                } else viewer.camera.flyTo({
                    duration: i,
                    destination: new Cesium.Rectangle(n.properties.Longitude.minimum, n.properties.Latitude.minimum, n.properties.Longitude.maximum, n.properties.Latitude.maximum)
                })
        }
        r.close(), TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
    }, x.prototype.getShowLayer = function (e) {
        var t = this.getLayerFromItem(e);
        return t ? e.tag == b ? viewer.dataSources.contains(t) : (t.show == undefined && (t.show = t.visibility), t.show) : !0
    }, x.prototype.showLayer = function (e, t) {
        var n;
        e.type === undefined ? n = this.getLayerFromItem(e) : n = e;
        if (!e.tag && e.type) switch (e.type) {
            case"FeaturePolygon":
            case"FeatureLine":
            case"FeaturePoint":
                e.tag = p;
                break;
            case"imagery":
                e.tag = d;
                break;
            case"elevation":
                e.tag = E;
                break;
            default:
                TerraExplorer.internal.Project.KmlLayers.indexOf(e) > -1 ? e.tag = b : TerraExplorer.internal.Project.MeshLayers.indexOf(e) > -1 && (e.tag = v)
        }
        n && (e.tag == b ? viewer.dataSources.contains(n) && !t ? viewer.dataSources.remove(n) : !viewer.dataSources.contains(this) && t && viewer.dataSources.add(n) : n.show = t, e.tag == E && (!n.show && viewer.terrainProvider._elevationLayersRectangles != undefined && viewer.terrainProvider._elevationLayersRectangles[n.guid] !== undefined && delete viewer.terrainProvider._elevationLayersRectangles[n.guid], viewer.terrainProvider.refreshElevationLayer(n)))
    }, x.prototype.onRefreshLayer = function (e) {
        var t = this.getLayerFromItem(e);
        if (t) switch (e.tag) {
            case p:
                t.refresh(!0);
                break;
            case b:
                t.refresh();
                break;
            case E:
                viewer.terrainProvider.refreshElevationLayer(t)
        }
    }, x.prototype.getRowButtonsForEntry = function (t, n, r) {
        if (r != undefined) return [{img: "./img/dialogs/actions/delete.png", onClick: e.proxy(this.onDelete, this)}];
        var i = [{
            img: "./img/newDesign/places_flyto.png", onClick: e.proxy(function () {
                this.onFlyTo(t)
            }, this)
        }, {img: "./img/dialogs/actions/edit.png", onClick: e.proxy(this.onEdit, this)}];
        return i
    }, x
}), define("tools/TETools/LoadLayersTool", ["jquery", "TELang", "../MenuEntry", "tools/ToolDialog", "./LayersStorage", "tools/TabControl", "tools/ListControl", "../DisplayGroupItem", "../DisplayItem", "internal/Globals", "../ToolProtocol", "internal/Settings"], function (e, t, n, r, i, s, o, u, a, f, l, c) {
    "use strict";
    var h = function () {
        this._tewTypes = ["Mesh", "Feature", "Imagery", "RasterComplex", "PointCloud", "Elevation", "TerraBuilderProject"], this._typesAsString = "", this._externalFilteredTypesAsString, this.getId = function () {
            return "LoadLayersTool"
        }, this.getMenuEntry = function () {
            return n.addToSidebar(this, t.i18n("LayersTool_LoadLayersFromServer"), "./img/newDesign/load_layer.png", 10, n.MenuEntryLayers(), t.i18n("NavigationTools_Header"), !1, !0, undefined, "none")
        }, this.open = function () {
            var t = this;
            this._typesAsString = this._tewTypes[0];
            for (var n = 1; n < this._tewTypes.length; n++) this._typesAsString += "|", this._typesAsString += this._tewTypes[n];
            this._typesAsString = Cesium.defaultValue(this._externalFilteredTypesAsString, this._typesAsString);
            var r = "http://www.skylineglobe.com", i = c.connectionUrl == undefined ? r : c.connectionUrl;
            TerraExplorer.functions.get, i.indexOf("connectSG") != -1 && (i = i.replace("connectSG", ""));
            var s = e("<div id='iframeContainer' class='iframeContainerClass'></div>"), t = this,
                o = e('script[src="Creator.js"]').length;
            e.ajaxSetup({cache: !0});
            if (o == 0) {
                function u(e) {
                    var t = document.createElement("script");
                    t.type = "text/javascript", t.src = e, document.getElementsByTagName("head")[0].appendChild(t)
                }

                u(c.baseConnectionUrl + "/Js/Creator.js"), t.OpenLoadLayers(i, s, t._typesAsString)
            } else this.OpenLoadLayers(i, s, this._typesAsString)
        }
    };
    return Cesium.defineProperties(h.prototype, {
        FilteredTypesString: {
            get: function () {
                return this._externalFilteredTypesAsString
            }, set: function (e) {
                this._externalFilteredTypesAsString = e
            }
        }
    }), h.prototype.OpenLoadLayers = function (n, i, s) {
        var o = 0, u = n + "/te4w", a = n + "/admin/telayers.aspx?type=" + s + escape("&") + "teweb=true",
            f = /iP(ad|hone|od)/i.test(navigator.userAgent);
        i.html('<iframe id="innerObject" class="iframeContainerClassLayersDiv" style="margin-top:40px;" type="text/html" src=' + u + "?url=" + a + "></iframe>"), r.PositionX = 300, r.PositionY = 70, r.open(t.i18n("Menu_Load_Layers"), "./img/dialogs/header_icons/layers.png", i.get(0)), e(".toolDialog").height(e(".toolDialog").height() - 80), e("#DialogSaveButton").parent().height(0), TerraExplorer.isTouch() && (e(window).off("navigate"), e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0), f && (window.orientation == 90 || window.orientation == -90) && (e("#iframeContainer").height("680px"), e(".iframeContainerClassLayersDiv").height("61%"))), r.removeCloseButton(), r.ContainsFrame = !0;
        var l = document.getElementById("innerObject").contentWindow
    }, h.prototype.Test = function () {
        return 1
    }, h.prototype.displayLayersControl = function () {
        this._typesAsString = this._tewTypes[0];
        for (var t = 1; t < this._tewTypes.length; t++) this._typesAsString += "|", this._typesAsString += this._tewTypes[t];
        this._typesAsString = Cesium.defaultValue(this._externalFilteredTypesAsString, this._typesAsString);
        var n = "http://www.skylineglobe.com", r = c.connectionUrl == undefined ? n : c.connectionUrl;
        r.indexOf("connectSG") != -1 && (r = r.replace("connectSG", ""));
        var i = e("<div id='iframeContainer' class='iframeContainerClass'></div>"), s = this,
            o = e('script[src="Creator.js"]').length;
        e.ajaxSetup({cache: !0});
        if (o == 0) {
            function u(e) {
                var t = document.createElement("script");
                t.type = "text/javascript", t.src = e, document.getElementsByTagName("head")[0].appendChild(t)
            }

            var a = c.baseConnectionUrl == undefined ? n : c.baseConnectionUrl;
            u(a + "/Js/Creator.js"), s.OpenLoadLayers(r, i, s._typesAsString)
        } else this.OpenLoadLayers(r, i, this._typesAsString)
    }, h
}), define("internal/ObjectHighlight", ["jquery", "wfs/Layer"], function (e, t) {
    "use strict";

    function r(e) {
        var t = e !== undefined ? e : "*";
        return t
    }

    var n = function (e, t, n) {
        this._object = e, this._subGeometryId = t, this._originalColor = null, this._originalShowBackground = null, this._originalBlendMode = null, this._teHighlightColor = Cesium.defaultValue(n, new Cesium.Color(1, 0, 1, .7)), this._show = !1, this._highlightColorChanged = !1, e._teHighlight === undefined && (e._teHighlight = {});
        var r = t !== undefined ? t : "*";
        e._teHighlight[r] = this;
        var i = this;
        this._highlightFunctions = {
            simpleColorHighlight: function (e) {
                if (typeof i._object.getGeometryInstanceAttributes == "function") {
                    var t = i._object.getGeometryInstanceAttributes(i._subGeometryId);
                    i._originalColor === null && (i._originalColor = t.color), e ? t.color = Cesium.ColorGeometryInstanceAttribute.toValue(i._teHighlightColor) : (t.color = i._originalColor, i._originalColor = null)
                }
            }, billboardHighlight: function (e) {
                i._object instanceof Cesium.Billboard && (i._originalColor === null && (i._originalColor = Cesium.Color.clone(i._object.color)), e ? i._object.color = Cesium.Color.clone(i._teHighlightColor) : (i._object.color = Cesium.Color.clone(i._originalColor), i._originalColor = null))
            }, labelHighlight: function (e) {
                i._object instanceof Cesium.Label && (i._originalColor === null && (i._originalColor = Cesium.Color.clone(i._object.backgroundColor)), i._originalShowBackground === null && (i._originalShowBackground = i._object.showBackground), e ? (i._object.backgroundColor = Cesium.Color.clone(i._teHighlightColor), i._object.showBackground = !0) : (i._object.backgroundColor = Cesium.Color.clone(i._originalColor), i._originalColor = null, i._object.showBackground = i._originalShowBackground, i._originalShowBackground = null))
            }, modelHighlight: function (e) {
                i._object instanceof Cesium.Model && (i._originalColor === null && (i._originalColor = i._object.color), i._originalBlendMode === null && (i._originalBlendMode = i._object.colorBlendMode), e ? (i._object.colorBlendMode = Cesium.ColorBlendMode.HIGHLIGHT, i._object.color = Cesium.Color.clone(i._teHighlightColor)) : (i._object.color = i._originalColor, i._object.colorBlendMode = i._originalBlendMode, i._originalColor = null, i._originalBlendMode = null))
            }, tileFeatureHighlight: function (e) {
                i._object instanceof Cesium.Cesium3DTileFeature && (i._originalColor === null && (i._originalColor = Cesium.Color.clone(i._object.color)), e ? i._object.color = Cesium.Color.clone(i._teHighlightColor) : (i._object.color = Cesium.Color.clone(i._originalColor), i._originalColor = null))
            }, noHighlight: function (e) {
            }, getHighlightFunc: function () {
                return i._subGeometryId instanceof Cesium.Entity || typeof i._object.getGeometryInstanceAttributes != "function" ? i._object instanceof Cesium.Billboard ? this.billboardHighlight : i._object instanceof Cesium.Label ? this.labelHighlight : i._object instanceof Cesium.Model ? this.modelHighlight : i._object instanceof Cesium.Cesium3DTileFeature ? this.tileFeatureHighlight : this.noHighlight : this.simpleColorHighlight
            }
        }
    };
    return Cesium.defineProperties(n.prototype, {
        show: {
            get: function () {
                return this._show
            }, set: function (e) {
                this.highlight(e), this._show = e
            }
        }
    }), n.prototype.highlight = function (e) {
        if (this._show == e && !this._highlightColorChanged) return;
        this._highlightColorChanged = !1;
        try {
            var t = this._highlightFunctions.getHighlightFunc();
            t(e)
        } catch (n) {
        }
    }, n.hasHighlight = function (e) {
        return e != undefined && e._teHighlight !== undefined ? !0 : !1
    }, n.getHighlight = function (e, t, i) {
        if (e == undefined) return;
        if (e._teHighlight !== undefined) {
            var s = e._teHighlight[r(t)];
            if (s) return i && !Cesium.Color.equals(i, s._teHighlightColor) && (s._teHighlightColor = Cesium.Color.clone(i), s._highlightColorChanged = !0), s
        }
        return new n(e, t, i)
    }, n.removeHighlight = function (e, t) {
        if (e == undefined) return;
        if (e._teHighlight !== undefined) {
            var n = e._teHighlight[r(t)];
            n && (n.show = !1, delete e._teHighlight[r(t)])
        }
    }, n.prototype.removeHighlight = function () {
        n.removeHighlight(this._object, this._subGeometryId)
    }, n.addHighlight = function (e, t, r) {
        if (e == undefined) return;
        var i = n.getHighlight(e, t, r);
        return i.show = !0, i
    }, n.prototype.getHighlightColorWithAlpha = function (e) {
        return Cesium.Color.fromAlpha(this._teHighlightColor, e)
    }, n
}), define("tools/TETools/LayerToolbox", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/InputMode", "../ToolDelegate", "internal/GeometryHelper", "tools/ToolDialog", "internal/Navigate", "wfs/Layer", "./LayersStorage", "internal/ObjectHighlight"], function (e, t, n, r, i, s, o, u, a, f, l, c) {
    "use strict";

    function d(t, n, r, i) {
        var s = e.proxy(t.onAttributeTableClosed, t);
        TerraExplorer.tools.ToolManager.openTool("AttributeTableTool", {
            layer: t._layer,
            onLoadQuery: null,
            onLoadFeatures: [n],
            onClose: s,
            onContentChanged: s
        });
        var o = c.addHighlight(r, i);
        t._highlightedObjects.push(o)
    }

    function v(e, t) {
        e._currentHighlightObject !== undefined && e._currentHighlightObject._object !== t && e._highlightedObjects.indexOf(e._currentHighlightObject) < 0 && e._currentHighlightObject.removeHighlight()
    }

    function m(e, t, n) {
        e._currentHighlightObject = c.addHighlight(t, n)
    }

    var h = function () {
        this._explanationText = "", this._explanationTextOnStartOnly = !0, this._eventListener = null, this._layer = undefined, this._LayerItemEntry = undefined, this._layersTool = undefined, this._isSelectionMode = !1, this._mousePosition = undefined, this._prevFrameMousePosition = undefined, this._highlightedObjects = [], this._currentHighlightObject = undefined, this._currentHighlightSubGeometryId = undefined, this.getId = function () {
            return "LayerToolbox"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Layers_Toolbox"), "./img/newDesign/bt_layers.png")
        }
    };
    h.inheritsFrom(s), Cesium.defineProperties(h.prototype, {}), h.prototype.onOpenedToolContainer = function () {
        this._explanationTextOnStartOnly = !1;
        var n = "";
        this._layer && this._layer.displayName && (n = this._layer.displayName), this._toolContainer.IsQuery = !0, e(viewer.container).css({cursor: 'url("./img/pointer.png") 6 5, pointer'}), e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Layers_Toolbox", {LayerName: n}))
    }, h.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0, this._isSelectionMode = !1, viewer.scene.preRender.removeEventListener(this.onPreFrame, this)
    }, h.prototype.onBeforeOpenToolContainer = function () {
        return this.Param == undefined ? !1 : (this._layer = this.Param.layer, this._LayerItemEntry = this.Param.item, this._layersTool = this.Param.layersTool, this._toolContainer.IsQuery = !1, this._isSelectionMode = !1, this._layer !== undefined && this._layer.type == undefined && (this._layer.type = l.getItemType(this._layer)), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.onLeftClick, this), Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.setInputAction(e.proxy(this.onRightClick, this), Cesium.ScreenSpaceEventType.RIGHT_CLICK), this._eventListener.setInputAction(e.proxy(function (e) {
            this._mousePosition = e.endPosition
        }, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE), this.parent.onBeforeOpenToolContainer.call(this), this.showNormalButtons(), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText), !0)
    }, h.prototype.onBeforeCloseToolContainer = function (e) {
        return this.parent.onBeforeCloseToolContainer.call(this, e), this.endSelectMode(), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK), u.IsOpen && u.close(), !0
    };
    var p = {SELECT: 1, ATTRIBUTES_TABLE: 2, LAYER_PROPERTIES: 3, REFRESH: 4, DELETE: 5};
    return h.prototype.showNormalButtons = function () {
        this.ToolContainer.removeButtons();
        if (this._layer instanceof f) this.ToolContainer.addButton(p.SELECT, "./img/select.png", undefined, t.i18n("layer_toolbox_tooltip_select"), this.ToolContainer.buttonType.CHECKBOX_BUTTON), this.ToolContainer.addButton(p.ATTRIBUTES_TABLE, "./img/attributes_table.png", undefined, t.i18n("layer_toolbox_tooltip_attributes_table")), this.ToolContainer.addButton(p.LAYER_PROPERTIES, "./img/layer_properties.png", undefined, t.i18n("layer_toolbox_tooltip_layer_properties")), this.ToolContainer.addButton(p.REFRESH, "./img/refresh.png", undefined, t.i18n("layer_toolbox_tooltip_refresh_layer")), this.ToolContainer.addButton(p.DELETE, "./img/delete.png", undefined, t.i18n("layer_toolbox_tooltip_delete_layer")); else if (this._layer instanceof Cesium.Cesium3DTileset) {
            var e = !1;
            try {
                e = this._layer._root._content._batchTable.featuresLength > 0
            } catch (n) {
                e = !1
            }
            e && this.ToolContainer.addButton(p.SELECT, "./img/select.png", undefined, t.i18n("layer_toolbox_tooltip_select"), this.ToolContainer.buttonType.CHECKBOX_BUTTON), this.ToolContainer.addButton(p.REFRESH, "./img/refresh.png", undefined, t.i18n("layer_toolbox_tooltip_refresh_layer")), this.ToolContainer.addButton(p.DELETE, "./img/delete.png", undefined, t.i18n("layer_toolbox_tooltip_delete_layer"))
        } else this._layer instanceof Cesium.ImageryLayer || this._layer.type == "elevation" ? (this.ToolContainer.addButton(p.REFRESH, "./img/refresh.png", undefined, t.i18n("layer_toolbox_tooltip_refresh_layer")), this.ToolContainer.addButton(p.DELETE, "./img/delete.png", undefined, t.i18n("layer_toolbox_tooltip_delete_layer"))) : this._layer instanceof Cesium.KmlDataSource && (this.ToolContainer.addButton(p.REFRESH, "./img/refresh.png", undefined, t.i18n("layer_toolbox_tooltip_refresh_layer")), this.ToolContainer.addButton(p.DELETE, "./img/delete.png", undefined, t.i18n("layer_toolbox_tooltip_delete_layer")))
    }, h.prototype.onButtonClick = function (t) {
        this.parent.onButtonClick.call(this, t);
        switch (t) {
            case p.SELECT:
                this._isSelectionMode = !this._isSelectionMode, this._isSelectionMode ? viewer.scene.preRender.addEventListener(this.onPreFrame, this) : (viewer.scene.preRender.removeEventListener(this.onPreFrame, this), this.endSelectMode());
                break;
            case p.ATTRIBUTES_TABLE:
                this._layer instanceof f && TerraExplorer.tools.ToolManager.openTool("AttributeTableTool", {
                    layer: this._layer,
                    onLoadQuery: null,
                    onLoadFeatures: null
                });
                break;
            case p.LAYER_PROPERTIES:
                this._layer instanceof f && TerraExplorer.tools.ToolManager.openTool("EditLayersTool", this._layer);
                break;
            case p.REFRESH:
                e(".toolDialog").remove(), this._layer.resetAttributesTable && this._layer.resetAttributesTable();
                if (this._layer instanceof f) this._layer.refresh(!0); else if (this._layer instanceof Cesium.KmlDataSource) this._layer.refresh(); else {
                    var n = this._layer.refresh();
                    this._layersTool === undefined && (this._layersTool = TerraExplorer.tools.ToolManager._tools.LayersTool), this._LayerItemEntry === undefined && (this._LayerItemEntry = this._layersTool.getItemFromLayer(this._layer)), TerraExplorer.tools.ToolManager.openTool("LayerToolbox", {
                        layer: n,
                        item: this._LayerItemEntry,
                        layersTool: this._layersTool
                    })
                }
                break;
            case p.DELETE:
                this._layersTool === undefined && (this._layersTool = TerraExplorer.tools.ToolManager._tools.LayersTool), this._LayerItemEntry === undefined && (this._LayerItemEntry = this._layersTool.getItemFromLayer(this._layer)), this._layersTool.deleteLayer(this._LayerItemEntry), e("#headerDivContainer #CloseImg").click()
        }
    }, h.prototype.openAttributesTableFor3DTileFeature = function (t) {
        if (t instanceof Cesium.Cesium3DTileFeature) {
            var n = this;
            this._layer.geomFields = [], this._layer._operations = {}, this._layer.getRequestMaxFeatures = function () {
                return 0
            }, this._layer.isAttributeField = function (e, t) {
                return !0
            }, this._layer.getFeatures = function (e, t, n) {
                if (n) return n([], !0)
            }, this._layer.removeFakeWFSLayerFields = function () {
                delete n._layer.geomFields, delete n._layer._operations, delete n._layer.getRequestMaxFeatures, delete n._layer.isAttributeField, delete n._layer.getFeatures, delete n._layer.removeFakeWFSLayerFields
            };
            var r = {};
            e.each(t.getPropertyNames(), function (e, i) {
                r[i] = t.getProperty(i), n._layer.geomFields.push({name: i, type: "string"})
            });
            var i = e.extend({boundingSphere: t._content._tile.boundingSphere}, r);
            d(this, i, t)
        }
    }, h.prototype.onLeftClick = function (t) {
        if (a.IsMultiGestureNavigation) return;
        if (this._isSelectionMode) {
            var n = {};
            viewer.scene.screenToWorld(t.position, n);
            if (n.pick instanceof Cesium.Cesium3DTileFeature && n.pickPrimitive === this._layer) this.openAttributesTableFor3DTileFeature(n.pick); else {
                var r = f.blockRequestPrimitiveFromPrimitive(n.pickPrimitive);
                if (r && r.parentLayer === this._layer) {
                    var i = n.id.replace(this._layer._layerName + ".", "");
                    try {
                        if (this._layer instanceof f) {
                            var s = r.parentLayer._featuresMap[n.id].feature.attributes, o = e.extend({
                                fid: i,
                                layerId: this._layer._layerName,
                                originFid: n.id,
                                boundingSphere: this._layer.boundingSphereFromFeature(r.parentLayer._featuresMap[n.id].feature)
                            }, s);
                            d(this, o, n.pickPrimitive, n.id)
                        }
                    } catch (u) {
                    }
                }
            }
        }
    }, h.prototype.onAttributeTableClosed = function () {
        for (var e = 0; e < this._highlightedObjects.length; e++) {
            const t = this._highlightedObjects[e];
            t !== this._currentHighlightObject && t.removeHighlight()
        }
        this._highlightedObjects = []
    }, h.prototype.onRightClick = function (e) {
    }, h.prototype.onPreFrame = function () {
        if (!this._isSelectionMode || !this._mousePosition || this._mousePosition.equals(this._prevFrameMousePosition)) return;
        var e = {};
        viewer.scene.screenToWorld(this._mousePosition, e);
        if (e.pickPrimitive) if (e.pick instanceof Cesium.Cesium3DTileFeature && e.pickPrimitive === this._layer) v(this, e.pick), m(this, e.pick); else {
            var t = f.blockRequestPrimitiveFromPrimitive(e.pickPrimitive);
            t && t.parentLayer === this._layer && (v(this, e.pickPrimitive), m(this, e.pickPrimitive, e.id))
        } else v(this);
        this._mousePosition && (this._prevFrameMousePosition = this._mousePosition.clone())
    }, h.prototype.endSelectMode = function () {
        this._layer.removeFakeWFSLayerFields && this._layer.removeFakeWFSLayerFields(), e.each(this._highlightedObjects, function (e, t) {
            t.removeHighlight()
        }), this._highlightedObjects = [], v(this)
    }, h
}), define("tools/TETools/UndergroundTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "../ToolProtocol"], function (e, t, n, r, i) {
    "use strict";
    var s = function () {
        this.getId = function () {
            return "UndergroundTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Underground"), undefined, 13, r.MenuEntryNavigation(), t.i18n("NavigationModes_Header"), !0)
        }, this.open = function (n) {
            viewer.scene.undergroundMode = !viewer.scene.undergroundMode;
            if (viewer.scene.undergroundMode) {
                TerraExplorer.activeGlobalStates[this.getId()] = !0;
                if (e("#UndergroundIndicator").length == 0) {
                    var r = e("<div id='UndergroundIndicator' style='pointer-events:none; position: absolute; width: 100%; height: 23px; top: 20px; left:0px; display: flex; align-items: center; justify-content: center;'><div id='UndergroundBtn' class='s7' style='pointer-events:all; cursor: pointer; position: relative; opacity:.8; border:1px solid rgba(255,255,255,0.5); padding: 4px;'>" + t.i18n("Underground_tool_UndergroundMode") + "</div></div>");
                    e("#" + window.divId).append(r), e("#UndergroundBtn").click(e.proxy(function () {
                        TerraExplorer.tools.MenuButton.menuEntryClicked(this.getMenuEntry())
                    }, this));
                    if (!viewer.scene.context.depthTexture) {
                        var i = e("<div id='warrningDepthTexture' style='pointer-events:none; position: absolute; width: 100%; height: 23px; top: 80px; left:0px; display: flex; align-items: center; justify-content: center;'><div class='s7' style='pointer-events:all; cursor: pointer; position: relative; opacity:.8; padding: 4px; text-align: center;'>" + t.i18n("Underground_tool_Warrning1") + "<br>" + t.i18n("Underground_tool_Warrning2") + "</div></div>");
                        e("#" + window.divId).append(i)
                    }
                }
            } else TerraExplorer.activeGlobalStates[this.getId()] = !1, e("#UndergroundIndicator").length > 0 && (e("#UndergroundIndicator").remove(), e("#warrningDepthTexture").remove())
        }
    };
    return s.inheritsFrom(i), Cesium.defineProperties(s.prototype, {
        Settings: {
            get: function () {
                return teSettings
            }
        }, IsUnderground: {
            get: function () {
                return viewer.scene.undergroundMode
            }
        }
    }), s
}), define("internal/NavigationControl", ["jquery", "jquery.plugs", "./Navigate", "./GeometryHelper", "./Settings"], function (e, t, n, r, i) {
    "use strict";
    var s = 1, o = function () {
        this._visibility = !1, this._zoomDirection = 0, this._stopZoomRequest = !1, this._prevOnFrameTime = 0, this._Movement = null, this._showCenterSign = !1
    };
    return Cesium.defineProperties(o.prototype, {
        Visibility: {
            get: function () {
                return this._visibility
            }, set: function (t) {
                var n = e(".NavElement");
                if (e("#NavigationDiv").length = !0) t ? n.show() : n.hide();
                this._visibility = t
            }
        }, ShowCenterSign: {
            get: function () {
                return this._showCenterSign
            }, set: function (t) {
                t ? e("#CenterSign").show() : e("#CenterSign").hide(), this._showCenterSign = !!t
            }
        }
    }), o.prototype.init = function () {
        var t = e(".NavElement"), r = TerraExplorer.isMobile() ? 0 : 20,
            s = e("<div class='s9 NavElement' id='NavigationDiv' style='right:" + r + "px;'></div>").disableSelection(),
            o = e("<div id='CompassNorthDiv'class='link NavElement'><img id='CompassNorthImg' class='NavElement' src='img/ZoomControlNorth.png'/></div>").disableSelection(),
            u = e("<div id='CompassDiv'class='link NavElement'><img id='CompassImg' src='img/ZoomControlDirection.png' /></div>").disableSelection(),
            a = e("<div id='ZoomInDiv'class='link NavElement'><img id='ZoomInImg' src='img/ZoomControlPlus.png' /></div>").disableSelection(),
            f = e("<div id='ZoomOutDiv'class='link NavElement'><img id='ZoomOutImg' src='img/ZoomControlMinus.png' /></div>").disableSelection(),
            l = e("<img id='CenterSign' src='img/CenterSign.png' />");
        e("#" + window.divId).append(s), s.append(o), s.append(u), s.append(a), s.append(f), e(".cesium-widget").append(l), e("#CompassNorthImg").attr("draggable", "false").on("dragstart", function (e) {
            e.preventDefault()
        }), e("#CompassImg").attr("draggable", "false").on("dragstart", function (e) {
            e.preventDefault()
        }), e("#ZoomInImg").attr("draggable", "false").on("dragstart", function (e) {
            e.preventDefault()
        }), e("#ZoomOutImg").attr("draggable", "false").on("dragstart", function (e) {
            e.preventDefault()
        }), u.hide(), viewer.scene.preRender.addEventListener(this.onPreFrame, this), e("#CompassDiv").click(e.proxy(n.faceNorth, n)), e("#CompassNorthDiv").click(e.proxy(n.faceNorth, n)), e("#CompassDiv").on("touchstart", e.proxy(n.faceNorth, n)), e("#CompassNorthDiv").on("touchstart", e.proxy(n.faceNorth, n)), e("#ZoomInDiv").on("touchstart", e.proxy(function (e, t) {
            this._zoomDirection = 1, this._stopZoomRequest = !1
        }, this)), e("#ZoomInDiv").on("touchend", e.proxy(function (e, t) {
            this._zoomDirection = 1, this._stopZoomRequest = !0
        }, this)), e("#ZoomOutDiv").on("touchstart", e.proxy(function (e, t) {
            this._zoomDirection = -1, this._stopZoomRequest = !1
        }, this)), e("#ZoomOutDiv").on("touchend", e.proxy(function (e, t) {
            this._zoomDirection = -1, this._stopZoomRequest = !0
        }, this)), e("#ZoomInDiv").mousecapture({
            down: e.proxy(function (e, t) {
                this._zoomDirection = 1, this._stopZoomRequest = !1
            }, this), up: e.proxy(function (e, t) {
                this._stopZoomRequest = !0
            }, this)
        }), e("#ZoomOutDiv").mousecapture({
            down: e.proxy(function (e, t) {
                this._zoomDirection = -1, this._stopZoomRequest = !1
            }, this), up: e.proxy(function (e, t) {
                this._stopZoomRequest = !0
            }, this)
        }), this.Visibility = Cesium.defaultValue(i.navigationControlVisibility, !0), this.ShowCenterSign = Cesium.defaultValue(i.navigationControlCenterSign, !0)
    }, o.prototype.onPreFrame = function (t, r) {
        s = Cesium.JulianDate.secondsDifference(r, this._prevOnFrameTime), this._prevOnFrameTime = r;
        if (viewer.scene.mode == Cesium.SceneMode.MORPHING) return;
        var i = viewer.camera;
        if (this._visibility == 1) {
            var o = Cesium.Math.toDegrees(i.heading);
            o > 359.5 || o < .5 ? (e("#CompassDiv").hide(), e("#CompassNorthDiv").show(), e("#CompassNorthDiv").rotate(-o)) : (e("#CompassNorthDiv").hide(), e("#CompassDiv").show(), e("#CompassDiv").rotate(-o))
        }
        if (this._zoomDirection != 0) {
            var u = Math.max(10, n.HeightAboveGround / 10);
            this._zoomDirection == 1 ? (i.zoomIn(u), n.HeightAboveGround_HitTest < 1 && !viewer.scene.showUndergroundSurface && i.zoomOut(u)) : n.HeightAboveGround_HitTest + u * 1.5 < n.MAX_ALTITUDE && i.zoomOut(u * 1.5), this._stopZoomRequest && (this._zoomDirection = 0)
        }
    }, new o
}), define("internal/StatusBar", ["jquery", "TELang", "internal/Units"], function (e, t, n) {
    "use strict";
    var r = "", i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = function () {
        this._visibility = !1, this._copyright = "", this._displayLocation = !0, this._isBuffering = !1, this._mgrsString = ""
    };
    return Cesium.defineProperties(c.prototype, {
        Visibility: {
            get: function () {
                return this._visibility
            }, set: function (n) {
                if (e("#StatusBarDiv").length == 0 && n == 1) {
                    this._copyright.length == 0 && (this._copyright = t.i18n("StatusBar_Copyright")), r = t.i18n("StatusBar_North"), i = t.i18n("StatusBar_South"), s = t.i18n("StatusBar_East"), o = t.i18n("StatusBar_West"), u = t.i18n("Meter"), a = t.i18n("Km"), f = t.i18n("Feet"), l = t.i18n("Mile");
                    var c = e("<div class='s7' id='StatusBarDiv'>                                            <img id='GradImg' src='img/bottom_black_gradiant.png'/>                                            <div style='padding:4px;'>                                                <span id='CopyrightTxt' class='statusBarCell' style='padding-right: 10px'>" + this._copyright + "</span>                                                <span id='CoordHeight' class='statusBarCell truncate' style='width:90px;'>0</span>                                                <span id='MGRS_Coordinates' class='statusBarCell' style='width:160px;display:none;'></span>                                                <span id='CoordLong' class='statusBarCell truncate' style='width:80px;'>0</span>                                                <span id='CoordLat' class='statusBarCell truncate' style='width:80px;'>0</span>                                                <span id='bufferingId' class='statusBarCell truncate' style='width:40px;'><img id='bufferingImgId' src='./img/buffering_dots_static.png'/></span>                                            </div>                                          </div>");
                    e("#" + window.divId).append(c), e("#StatusBarDiv").on("dragstart", function (e) {
                        e.preventDefault()
                    }), e("#StatusBarDiv").attr("unselectable", "off"), e("#StatusBarDiv").css({"-webkit-user-select": "text"}), this.MGRS_Visibility = !1, viewer.scene.preRender.addEventListener(this.onPreFrame, this), this.DisplayLocation = this._displayLocation, setInterval(e.proxy(function () {
                        var t = this.isBuffering();
                        this._isBuffering != t && (e("#bufferingImgId").prop("src", t ? "./img/buffering_dots.gif" : "./img/buffering_dots_static.png"), this._isBuffering = t)
                    }, this), 500)
                }
                this._visibility = n
            }
        }, Copyright: {
            get: function () {
                return this._copyright
            }, set: function (t) {
                e("#CopyrightTxt").length != 0 && e("#CopyrightTxt").text(t), this._copyright = t
            }
        }, MGRS_Value: {
            get: function () {
                return this._mgrsString
            }, set: function (e) {
                if (typeof e != "string") {
                    console.error("Cannot Set MGRS string to type: " + typeof e);
                    return
                }
                this._mgrsString = e
            }
        }, MGRS_Visibility: {
            get: function () {
                return e("#MGRS_Coordinates").is(":visible")
            }, set: function (t) {
                t ? (e("#MGRS_Coordinates").show(), TerraExplorer.internal.Settings.displayMGRS = !0) : (e("#MGRS_Coordinates").hide(), TerraExplorer.internal.Settings.displayMGRS = !1)
            }
        }, DisplayLocation: {
            get: function () {
                return this._displayLocation
            }, set: function (t) {
                t == 0 ? (e("#CoordLong").hide(), e("#CoordLat").hide(), e("#CoordHeight").hide()) : (e("#CoordLong").show(), e("#CoordLat").show(), e("#CoordHeight").show()), this._displayLocation = t
            }
        }
    }), c.prototype.onPreFrame = function (c, h) {
        var p = viewer.camera.positionCartographic, d = Cesium.Math.toDegrees(p.longitude),
            v = d.toFixed(5) + " " + (d >= 0 ? s : o), m = Cesium.Math.toDegrees(p.latitude),
            g = m.toFixed(5) + " " + (m >= 0 ? r : i), y = p.height;
        e("#CoordLong").text() != v && e("#CoordLong").text(v), e("#CoordLat").text() != g && e("#CoordLat").text(g);
        var b = y.toFixed(2) + " " + u;
        y > 1e4 && (b = (y / 1e3).toFixed(2) + " " + a);
        if (TerraExplorer != undefined && TerraExplorer.internal.Units.AltitudeUnit == TerraExplorer.internal.Units.FEET) {
            var w = TerraExplorer.internal.Units.meterToFeet(y);
            b = w.toFixed(2) + " " + f, w > 1e4 && (b = (w / 5280).toFixed(2) + " " + l)
        }
        e("#CoordHeight").text() != b && e("#CoordHeight").text(b), this.MGRS_Visibility && c.frameState.frameNumber % 2 == 0 && (this._mgrsString = n.LL2MGRS(d, m)), e("#MGRS_Coordinates").text() != this._mgrsString && e("#MGRS_Coordinates").text(t.i18n("StatusBar_MGRS") + ": " + this._mgrsString)
    }, c.prototype.isBuffering = function () {
        var t = !1;
        for (var n = 0; n < viewer.imageryLayers.length; n++) {
            var r = viewer.imageryLayers.get(n).imageryProvider;
            if (r !== undefined && r.pendingRequests || 0) {
                t = !0;
                break
            }
        }
        var i = 0;
        e(TerraExplorer.internal.Project.MeshLayers).each(function (e, t) {
            i += t._statistics.numberOfPendingRequests
        });
        var s = i > 0;
        return t |= s, t
    }, new c
}), define("tools/TETools/SettingsTool", ["jquery", "TELang", "tools/ToolDialog", "internal/Globals", "../MenuEntry", "internal/Units", "internal/NavigationControl", "../ToolContainer", "internal/NotificationCenter", "internal/Settings", "../ToolProtocol", "internal/StatusBar"], function (e, t, n, r, i, s, o, u, a, f, l, c) {
    "use strict";
    var h = function () {
        this._sideStyle = !0;
        var r = this;
        this._connectionState, this._connectionString = "", this.saveObjects = {
            SHOW_AND_SAVE: 0,
            SHOW_W_O_SAVING: 1,
            DO_NOT_SHOW: 2
        }, this.colorSheme = {BRIGHT: 0, COLD: 1, NATURAL: 2, WARM: 3}, this.getId = function () {
            return "SettingsTool"
        }, this.getMenuEntry = function () {
            return i.addToSidebar(this, t.i18n("Menu_Setting"), "./img/newDesign/settings_caption.png", 90)
        }, this.open = function (i) {
            this._connectionState = f.connectionState;
            var u = e("<div class='Settings'></div>"),
                a = e("<div class='SettingsHeader'><span>" + t.i18n("view") + "</span></div>"),
                l = e("<label class='Settingslabel' for='UnitsId' style='width:96%; line-height:36px'><div class='settingDivLabelSelectClass' id='UnitsId'><label class='settingLabelSelectClass'> <select class='settingSelectClass' name='Units'><option name='Units' value='" + s.METERS + "'>" + t.i18n("settings_units") + t.i18n("settings_units_meters") + "</option><option name='Units' value='" + s.FEET + "'>" + t.i18n("settings_units") + t.i18n("settings_units_feet") + "</option></select>"),
                h = e("<label class='Settingslabel toggleSettings' style='display:inline-block; width:80%;'>" + t.i18n("settings_navigation_buttons") + "</label><input type='checkbox' class='css-checkbox' id='NavButtonsId' style='' /><label class='css-label' style='position:relative;right:-5px;top:0px;' for='NavButtonsId'></label><br/>"),
                p = e("<label class='Settingslabel toggleSettings' style='display:inline-block; width:80%;'>" + t.i18n("settings_center_sign") + "</label><input type='checkbox' class='css-checkbox' id='CenterSignId' style='' /><label class='css-label' style='position:relative;right:-5px;top:0px;' for='CenterSignId'></label><br/>"),
                d = e("<label class='Settingslabel toggleSettings' style='display:inline-block; width:80%;'>" + t.i18n("settings_MGRS_Coordinates") + "</label><input type='checkbox' class='css-checkbox' id='MGRS_CoordinatesId' style='' /><label class='css-label' style='position:relative;right:-5px;top:0px;' for='MGRS_CoordinatesId'></label><br/>"),
                v = e("<label class='Settingslabel' for='colorSchemeId' style='width:96%;line-height:36px'><div class='settingDivLabelSelectClass' id='colorSchemeId'><label class='settingLabelSelectClass'> <select class='settingSelectClass settingSelectColorSchemeClass' name='colorScheme'><option name='colorScheme' value='0'>" + t.i18n("settings_color_scheme_header") + t.i18n("settings_Scheme_Color_Bright") + "</option><option name='colorScheme' value='1'>" + t.i18n("settings_color_scheme_header") + t.i18n("settings_Scheme_Color_Cold") + "</option><option name='colorScheme' value='2'>" + t.i18n("settings_color_scheme_header") + t.i18n("settings_Scheme_Color_Natural") + "</option><option name='colorScheme' value='3'>" + t.i18n("settings_color_scheme_header") + t.i18n("settings_Scheme_Color_Warm") + "</option></select>"),
                m = e("<label class='Settingslabel' for='qualityID' style='width:96%;line-height:36px'><div class='settingDivLabelSelectClass' id='qualityID'><label class='settingLabelSelectClass'> <select class='settingSelectClass settingSelectQualityClass' name='qaulityResolution'><option name='qaulityResolution' value='0'>" + t.i18n("settings_quality_resolution_scale_header") + t.i18n("settings_Quality_High") + "</option><option name='qaulityResolution' value='1'>" + t.i18n("settings_quality_resolution_scale_header") + t.i18n("settings_Quality_Medium") + "</option><option name='qaulityResolution' value='2'>" + t.i18n("settings_quality_resolution_scale_header") + t.i18n("settings_Quality_Low") + "</option></select>"),
                g = e("<div class='SettingsHeader'><span>" + t.i18n("settings_Analysis_Header") + "</span></div>"),
                y = e("<label class='Settingslabel' for='contourModeId' style='width:96%;line-height:36px'><div class='settingDivLabelSelectClass' id='contourModeId'><label class='settingLabelSelectClass'> <select class='settingSelectClass settingSelectCountourClass' name='contourMode'><option name='contourMode' value='0'>" + t.i18n("settings_contour_header") + t.i18n("settings_contour_colors") + "</option><option name='contourMode' value='1'>" + t.i18n("settings_contour_header") + t.i18n("settings_contour_colors_lines") + "</option></select>"),
                b = e("<label class='Settingslabel' for='ContourB3dmTextureId' style='width:96%;line-height:36px'><div class='settingDivLabelSelectClass' id='ContourB3dmTextureId'><label class='settingLabelSelectClass'> <select class='settingSelectClass settingSelectCountourClass' name='ContourB3dmTexture'><option name='ContourB3dmTexture' value='0'>" + t.i18n("settings_contour_Static") + "</option><option name='ContourB3dmTexture' value='1'>" + t.i18n("settings_contour_Dynamic") + "</option></select>"),
                w = e("<label class='Settingslabel' style='width:96%;line-height:36px;'><div class='settingDivLabelSelectClass' id='saveObjectsId'><select class='settingSelectClass settingSelectAnalysisObjectsClass' name='saveObjects'><option value='" + this.saveObjects.SHOW_AND_SAVE + "'>" + t.i18n("settings_Objects_show_and_Save") + "</option><option value='" + this.saveObjects.SHOW_W_O_SAVING + "'>" + t.i18n("settings_Objects_show_witout_saving") + "</option><option value='" + this.saveObjects.DO_NOT_SHOW + "'>" + t.i18n("settings_Objects_no_show_save") + "</option></select></div></label>"),
                E = e("<div class='SettingsHeader'><span>" + t.i18n("settings_SGS_Header") + "</span></div>"),
                S = e('<div id="urlDiv"><label class="Settingslabel settingurlDivClass">' + t.i18n("settings_URL") + '</label><label class="Settingslabel settinggURLClass">' + TerraExplorer.internal.Settings.connectionUrl + "</label></div>"),
                x = e("<div  class='Settingslabel' id ='openAnotherProjectId'>" + t.i18n("settings_Open_Another_Project") + "<a href='#' id='btnOpenProject' class='SettingsButton' style='right:-15px;'>" + t.i18n("open") + "</a></div>"),
                T = e("<div class='SettingsHeader'><span>" + t.i18n("settings_general_header") + "</span></div>"),
                N = e("<label class='Settingslabel' for='LongPressId' style='96%'>" + t.i18n("settings_long_press") + "<div class='Settingslabel SettingsRadio' id='LongPressId' style='cursor: pointer;'><label><input type='radio' class='' name='Long' value='Places'>" + t.i18n("Menu_Places") + "</input><img/></label><label><input type='radio' name='Long' value='Layers'>" + t.i18n("Menu_Layers") + "</input><img/></label></div></label><br/>"),
                C = e("<label class='Settingslabel'  style=''>" + t.i18n("settings_online_help") + "</label><a href='#' id='viewTutorialId' class='SettingsButton' style='right:0px;'>" + t.i18n("view") + "</a><br/>"),
                k = e("<label  class='Settingslabel'  style=''>" + t.i18n("settings_License_Agreement") + "</label><a href='#' id='viewLicenseId' class='SettingsButton' style='right:0px;'>" + t.i18n("view") + "</a><br/>"),
                L = TerraExplorer.Version.split(".");
            L = L[0] + "." + L[1] + "." + L[2];
            var A = t.i18n("TerraExplorer") + " " + t.i18n("settings_about_version_abr") + L,
                O = e("<div><label class='Settingslabel'  style=''>" + t.i18n("settings_about") + A + "</label><a href='#' id='viewAboutId' class='SettingsButton' style='right:0px;'>" + t.i18n("view") + "</a></div><br/>"),
                M = e("<div><img src='./img/newDesign/errorIcon.png'><label class='Settingslabel'  style='margin-left:3px;'>" + t.i18n("settings_showErrorsLog") + "</label><a href='#' id='showErrorLogId' class='SettingsButton' style='right:0px;'>" + t.i18n("view") + "</a></div><br/>"),
                _ = e("#connectionStatusID"),
                D = e('<div id="urlDiv"><label class="toolDialogLabelSidebar" style=" width:30%;">' + t.i18n("settings_User") + '</label><input id="userNameID" class="toolDialogInputText" type="text" value ="" style="float:right;width:50%;margin-right:110px;"/>' + "</div>"),
                P = e('<div id="urlDiv"><label class="toolDialogLabelSidebar" style=" width:30%;">' + t.i18n("settings_Pass") + '</label><input id="passwordID" class="toolDialogInputText" type="password" value ="" style="float:right;width:50%;margin-right:110px;"/>' + "</div>");
            u.append(a).append(l).append(h).append(p).append(d).append(v).append(m).append(g).append(y).append(b).append(w).append(E).append(S).append(x).append(T).append(C).append(k).append(O).append(M).append(e('<div style="display:block;width:1px;height:200px;"></div>')), e("#sidebarContentDiv").empty(), this._sideStyle ? n.openAsSideToolDialog(t.i18n("title_activity_settings"), "./img/settings.png", u.get(0)) : n.open(t.i18n("title_activity_settings"), "./img/settings.png", u.get(0), e.proxy(this.onClose, this)), TerraExplorer.browser.isEdge && e(".toggleSettings").width("79%"), e("#viewAboutId").click(e.proxy(this.onAbout, this)), e("#showErrorLogId").click(e.proxy(this.onShowErrorsLog, this)), TerraExplorer.internal.Project.UnsupportedLayers.length === 0 ? M.css("display", "none") : M.css("display", "block"), f.navigationControlCenterSign == undefined && (f.navigationControlCenterSign = !0), f.navigationControlVisibility == undefined && (f.navigationControlVisibility = !0), f.displayMGRS == undefined && (f.displayMGRS = !1), e("#NavButtonsId").prop("checked", f.navigationControlVisibility), e("#NavButtonsId").click(function () {
                o.Visibility = e(this).is(":checked"), f.navigationControlVisibility = o.Visibility, f.saveSettings()
            }), e("#CenterSignId").prop("checked", f.navigationControlCenterSign), e("#CenterSignId").click(function () {
                o.ShowCenterSign = e(this).is(":checked"), f.navigationControlCenterSign = o.ShowCenterSign, f.saveSettings()
            }), e("#MGRS_CoordinatesId").prop("checked", f.displayMGRS), e("#MGRS_CoordinatesId").click(function () {
                c.MGRS_Visibility = e(this).is(":checked"), f.displayMGRS = c.MGRS_Visibility
            }), f.colorSheme == undefined && (f.colorSheme = 3), f.colorSheme === undefined || f.colorSheme !== 0 && f.colorSheme !== 1 && f.colorSheme !== 2 && f.colorSheme !== 3 ? e("#colorSchemeId option")[3].selected = !0 : e("#colorSchemeId option")[f.colorSheme].selected = !0, e("select[name=colorScheme]").change(e.proxy(this.onColorSchemeChange, this)), f.resolutionScale === undefined && (TerraExplorer.isMobile() ? f.resolutionScale = .8 : f.resolutionScale = 1), f.resolutionScale !== undefined && (f.resolutionScale === 1 ? e("#qualityID option")[0].selected = !0 : f.resolutionScale === .8 && (e("#qualityID option")[1].selected = !0), f.resolutionScale === .6 && (e("#qualityID option")[2].selected = !0)), e("select[name=qaulityResolution]").change(e.proxy(this.onResolutionQualityChange, this)), f.altitudeUnit == undefined && (f.altitudeUnit = 0), f.altitudeUnit != undefined && (f.altitudeUnit == 1 || f.altitudeUnit == 0) && (e("#UnitsId option")[f.altitudeUnit].selected = !0), e("select[name=Units]").change(e.proxy(this.onUnitsChange, this)), f.contourMode == undefined && (f.contourMode = 1), f.contourMode != undefined && (f.contourMode == 1 || f.contourMode == 0) && (e("#contourModeId option")[f.contourMode].selected = !0), e("select[name=contourMode]").change(e.proxy(this.onContourModeChange, this)), f.contourB3dmTextureMode == undefined && (f.contourB3dmTextureMode = 0), f.contourB3dmTextureMode != undefined && (f.contourB3dmTextureMode === 0 || f.contourB3dmTextureMode === 1 || f.contourB3dmTextureMode === 2) && (e("#ContourB3dmTextureId option")[f.contourB3dmTextureMode].selected = !0), e("select[name=ContourB3dmTexture]").change(e.proxy(this.contourB3dmTextureModeChange, this)), f.saveObjects == undefined && (f.saveObjects = 0), f.saveObjects != undefined && (f.saveObjects == 0 || f.saveObjects == 1 || f.saveObjects == 2) && (e("#saveObjectsId option")[f.saveObjects].selected = !0), e("select[name=saveObjects]").change(e.proxy(this.onSaveObjectsChange, this)), e("#viewLicenseId").on("click", e.proxy(this.onViewLicenseTutorial, this, 0)), e("#viewTutorialId").on("click", e.proxy(this.onTutorial, this, 1)), e("#connectButton").on("click", function () {
                e("#connectButton").html() == t.i18n("disconnectFromSG") ? r.disconnectFromSG() : r.connectToSG()
            }), e("#btnOpenProject").click(e.proxy(this.onOpenProject, this));
            var H = Cesium.defaultValue(f.longPressToolId, "PlacesTool");
            e("#LongPressId").val(H), this.readFromSettings(), this._sideStyle && (e(".toolDialogLabelSidebar").css({
                "background-color": "#141414",
                color: "#FFFFFF"
            }), e(".selectionBox").css("width", "90%"))
        }
    };
    return h.inheritsFrom(l), Cesium.defineProperties(h.prototype, {
        SettingsToolOpen: {
            get: function () {
            }
        }, Settings: {
            get: function () {
                return teSettings
            }
        }
    }), h.prototype.validateInputFields = function () {
        return e("#userNameID").val() == "" || e("#passwordID").val() == "" || e("urlID").val() == "" ? (TerraExplorer.tools.ToolDialog.showAlertDialog(t.i18n("SettingsTool_EmptyFields")), !1) : !0
    }, h.prototype.onOpenProject = function () {
        TerraExplorer.tools.ToolManager._tools.LoadLayersTool.FilteredTypesString = ["OpenProjectWeb"], TerraExplorer.tools.ToolManager._tools.LoadLayersTool.displayLayersControl(), console.log("Open Project!"), TerraExplorer.tools.ToolManager._tools.LoadLayersTool.FilteredTypesString = undefined
    }, h.prototype.readFromSettings = function () {
        e("#userNameID").val(f.userConnection), e("#passwordID").val(f.passwordConnection), e("#urlID").val(f.connectionUrl)
    }, h.prototype.onUnitsChange = function () {
        e(e("#UnitsId option")[0]).is(":selected") == 1 ? s.AltitudeUnit = 0 : s.AltitudeUnit = 1, a.postNotification("TEN_UNITS_CHANGED", this), f.altitudeUnit = s.AltitudeUnit;
        var t = TerraExplorer.tools.ToolManager._tools.Viewshed;
        t._editingMode && (e("#ContainerRootDiv #CloseImg").length > 0 && e("#ContainerRootDiv #CloseImg").click(), TerraExplorer.tools.ToolManager.openTool("Viewshed", t._currentObject)), this.updateAllPrimsLabels(), f.saveSettings()
    }, h.prototype.onColorSchemeChange = function () {
        e(e("#colorSchemeId option")[0]).is(":selected") == 1 ? (TerraExplorer.settings.sharpness = 1.4, TerraExplorer.settings.saturation = 1.6, TerraExplorer.settings.brightness = 0, TerraExplorer.settings.contrast = .4, f.colorSheme = 0) : e(e("#colorSchemeId option")[1]).is(":selected") == 1 ? (TerraExplorer.settings.sharpness = 1.1, TerraExplorer.settings.saturation = .7, TerraExplorer.settings.brightness = .2, TerraExplorer.settings.contrast = .5, f.colorSheme = 1) : e(e("#colorSchemeId option")[2]).is(":selected") == 1 ? (TerraExplorer.settings.sharpness = 1.3, TerraExplorer.settings.saturation = 1, TerraExplorer.settings.brightness = 0, TerraExplorer.settings.contrast = 0, f.colorSheme = 2) : e(e("#colorSchemeId option")[3]).is(":selected") == 1 && (TerraExplorer.settings.sharpness = 1.3, TerraExplorer.settings.saturation = 1.3, TerraExplorer.settings.brightness = 0, TerraExplorer.settings.contrast = 0, f.colorSheme = 3), f.sharpness = TerraExplorer.settings.sharpness, f.saturation = TerraExplorer.settings.saturation, f.brightness = TerraExplorer.settings.brightness, f.contrast = TerraExplorer.settings.contrast, f.saveSettings()
    }, h.prototype.onResolutionQualityChange = function () {
        e(e("#qualityID option")[0]).is(":selected") == 1 ? (viewer.resolutionScale = 1, f.resolutionScale = 1) : e(e("#qualityID option")[1]).is(":selected") == 1 ? (viewer.resolutionScale = .8, f.resolutionScale = .8) : e(e("#qualityID option")[2]).is(":selected") == 1 && (viewer.resolutionScale = .6, f.resolutionScale = .6), f.saveSettings()
    }, h.prototype.onContourModeChange = function () {
        e(e("#contourModeId option")[0]).is(":selected") == 1 ? (viewer.scene.showContourColors = !0, viewer.scene.showContourLines = !1, f.contourMode = 0) : (viewer.scene.showContourColors = !0, viewer.scene.showContourLines = !0, f.contourMode = 1), f.saveSettings()
    }, h.prototype.contourB3dmTextureModeChange = function () {
        e(e("#ContourB3dmTextureId option")[0]).is(":selected") == 1 ? f.contourB3dmTextureMode = 0 : e(e("#ContourB3dmTextureId option")[1]).is(":selected") == 1 ? f.contourB3dmTextureMode = 1 : f.contourB3dmTextureMode = 2, f.saveSettings()
    }, h.prototype.onSaveObjectsChange = function () {
        var t;
        e(e("#saveObjectsId option")[0]).is(":selected") == 1 ? t = 0 : e(e("#saveObjectsId option")[1]).is(":selected") == 1 ? t = 1 : t = 2, f.saveObjects = t, f.saveSettings()
    }, h.prototype.onClose = function (t) {
        if (t) return;
        f.longPressToolId = e("#LongPressId").find(":checked").val(), f.saveSettings()
    }, h.prototype.onAbout = function () {
        this.ToolManager.openTool("AboutTool")
    }, h.prototype.onShowErrorsLog = function () {
        TerraExplorer.internal.Project.displayDetailedUnsupported()
    }, h.prototype.updateAllPrimsLabels = function () {
        var e = TerraExplorer.internal.Project._allAnalysisObjects;
        Object.values(e).forEach(function (e) {
            e.forEach(function (e) {
                e._object && e._object.prims && e._object.prims.forEach(function (e) {
                    e instanceof Cesium.LabelCollection && e._labels.forEach(function (e) {
                        e.text = e.createLabelText !== undefined ? e.createLabelText() : e.text
                    })
                })
            })
        })
    }, h.prototype.onTutorial = function () {
        if (TerraExplorer.isTouch()) {
            var r = e("<div id='iframeContainer' class='iframeContainerClass'></div>");
            r.html('<iframe id="innerObject" class="iframeContainerClassLayersDiv" style="margin-top:40px;" type="text/html" src=' + window.location.protocol + "//" + window.location.host + "/sg" + TerraExplorer.getCurrentSitePath() + "/terraexplorerweb/docs/TE4WWebHelp/index.htm" + "></iframe>"), n.open(t.i18n("settings_online_help"), "./img/MenuButton.png", r.get(0)), e(window).off("navigate"), e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0), e(".toolDialogLabel").height("100%"), e(".toolDialogLabel").width("100%"), e(".CloseButtonDiv").remove()
        } else window.SGUrl !== undefined ? window.open(window.SGUrl + TerraExplorer.getCurrentSitePath() + "/terraexplorerweb/docs/TE4WWebHelp/index.htm", "_blank") : window.open(window.location.protocol + "//" + window.location.host + "/sg" + TerraExplorer.getCurrentSitePath() + "/terraexplorerweb/docs/TE4WWebHelp/index.htm", "_blank")
    }, h.prototype.onViewLicenseTutorial = function (r) {
        var i = e("<div id='iframeContainer' class='iframeContainerClass'></div>"),
            s = r ? t.i18n("settings_online_help") : t.i18n("settings_TerraExplorer_For_Web_License"),
            o = r ? "./docs/TE4WWebHelp/index.htm" : "./docs/license.html";
        i.html('<iframe id="innerObject" class="iframeContainerClass" style="margin-top:40px;overflow-x: hidden;" type="text/html" src=' + o + "></iframe>"), n.PositionX = 300, n.PositionY = 70, n.open(s, "./img/newDesign/logo_no_alpha.png", i.get(0)), e("iframe").css("border", "none"), e(".toolDialog").height("780").width(), e("#CloseButton").css({
            bottom: "5px",
            border: "#2b2b2b solid 1px"
        }), TerraExplorer.isTouch() && (e(window).off("navigate"), e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0), e(".toolDialogLabel").height("100%"), e(".toolDialogLabel").width("100%"))
    }, h
}), define("internal/SearchBox", ["jquery", "./TEPosition", "jquery.plugs", "TELang"], function ($, TEPosition, jqPlugs, TELang) {
    "use strict";

    function searchRequest() {
        return _searchIndex++, {query: null, data: [], index: _searchIndex, completed: !1}
    }

    function reverseText(e) {
        return e.split("").reverse().join("")
    }

    function isRTL(e) {
        var t = "A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿", n = "֑-߿יִ-﷽ﹰ-ﻼ", r = new RegExp("^[^" + t + "]*[" + n + "]");
        return r.test(e[0])
    }

    function removeUnicodeLeftToRightMark(e) {
        var t = e.split(""), n = t.indexOf("‎");
        while (n >= 0) t.splice(n, 1), n = t.indexOf("‎");
        return t.join("")
    }

    function invertDotsCommas(e) {
        return e = e.replace(/\./g, "~SL~"), e = e.replace(/,/g, "."), e = e.replace(/~SL\~/g, ","), e
    }

    var _searchIndex = 0, currentLabelShown = null, _text_noResultsFound = "No results found",
        _text_connectionError = "Connection error", SearchBox = function () {
            this._visibility = !1, this._searchCopyright = "", this._searchResultsPopup = !1, this._searchTerrainLabel = null, this._searchErrorWasAlreadyShown = !1, this._searchServer = "", this._searchServerTail = "callback=fillAutoComplete<_searchIndex>&q=", this._searchLon = null, this._searchLat = null, this._isCoordSearch = !1, this._MGRS = undefined, this.wasFrenchInverted = !1, this._searchLastRequest = new searchRequest, this.flyTo = window._searchFlyTo = $.proxy(function (e, t, n, r) {
                r != undefined && this._searchLastRequest.completed && (this.saveSearch(this._searchLastRequest.data[r]), this.hideResultsPopup());
                var i = this, s = Cesium.Cartographic.fromDegrees(t, e, 6e3),
                    o = viewer.scene.globe.ellipsoid.cartographicToCartesian(s),
                    u = i.flyToTempFlyLocation(o, {heading: 0, pitch: Cesium.Math.toRadians(-89)}),
                    a = TerraExplorer.functions.queryBestLevel(s);
                a.then(function (r) {
                    var o = Cesium.sampleTerrain(viewer.terrainProvider, r, [s]);
                    Cesium.when.all([o, u], function (r) {
                        var s = r[0];
                        s[0].height == undefined && (s[0].height = 0);
                        var o = n.split("["), u = o[0];
                        i._searchTerrainLabel != null && viewer.entities.remove(i._searchTerrainLabel);
                        var a = $("#search");
                        if (a.length === 1 && a.val() !== "") {
                            i._searchTerrainLabel = viewer.entities.add({
                                position: Cesium.Cartesian3.fromDegrees(t, e, s[0].height + 100),
                                label: {
                                    text: removeUnicodeLeftToRightMark(u),
                                    scale: 1,
                                    eyeOffset: Cesium.DynamicEyeOffset()
                                }
                            }), currentLabelShown = i._searchTerrainLabel;
                            var f = currentLabelShown.label.text;
                            f.setValue(isRTL(f.getValue()) ? reverseText(f.getValue()) : f.getValue())
                        }
                        TerraExplorer.internal.Navigate.flyToPosition(new TEPosition({
                            cartesian: Cesium.Cartesian3.fromDegrees(t, e, s[0].height + 100),
                            headingPitchRange: new Cesium.HeadingPitchRange(0, Cesium.Math.toRadians(-89), 1500)
                        }))
                    })
                })
            }, this)
        };
    return Cesium.defineProperties(SearchBox.prototype, {
        Visibility: {
            get: function () {
                return this._visibility
            }, set: function (e) {
                if ($("#SearchDiv").length == 0 && e == 1) {
                    var t = $("<div class='s9' id='SearchDiv''><div id='serchBoxSubDiv'><input type='text' class='searchBox' id='search'><img id='searchIcon' src='./img/newDesign/search.png'/></div><div id='resultDiv'></div></div>"),
                        n = $("#searchBox");
                    n.length > 0 && $(n).append(t), $("#searchIcon").click($.proxy(this.flyToFirstResult, this)), $(".noselect").each(function () {
                        this.onselectstart = function () {
                            return !1
                        }, this.unselectable = "on"
                    }), $(document).bind("keypress", $.proxy(function (e) {
                        e.keyCode == 13 && $("#search").is(":focus") && $.proxy(this.flyToFirstResult(), this)
                    }, this)), $("#resultDiv").width($("#search").width()), setTimeout(function () {
                        $("#search").focus()
                    }, 100), setInterval($.proxy(this.doSearch, this), 300)
                }
                if ($("#SearchDiv").length = !0) if (e) {
                    var r = $("#locationContainer")[0] != undefined ? $("#locationContainer")[0].dataset.defaultWidth : $("#sideBar")[0].dataset.defaultWidth,
                        i = r * .92;
                    $("#SearchDiv").css({
                        width: i,
                        left: (r - i) / 2 - 1
                    }), $("#search").width(i - $("#searchIcon").outerWidth() - 4), $("#resultDiv").width("240"), $("#SearchDiv").show()
                } else $("#SearchDiv").hide();
                this._visibility = e
            }
        }, SearchServer: {
            get: function () {
                return this._searchServer
            }, set: function (e) {
                this._searchServer = e
            }
        }
    }), SearchBox.prototype.hideResultsPopup = function () {
        $("#resultDiv").html("").hide(), this._searchResultsPopup = !1
    }, SearchBox.prototype.doCatalogSearch = function (e) {
        var t = "http://dev.skyline.co.il/sg/Streamer.ashx?VERSION=1.0.0&Service=CSW&outputFormat=application/xml&Username=&Password=&request=GetRecords&CONSTRAINTLANGUAGE=CatalogQuery&constraint=" + e + "&resultType=result&startPosition=1&MaxRecords=5";
        $.ajax({
            url: t, dataType: "xml", xhrFields: {withCredentials: !0}, success: function (e) {
                console.log(e)
            }, error: function (e) {
                console.log(e)
            }
        })
    }, SearchBox.prototype.fillAutoComplete = function (e, t) {
        function n(e, r) {
            r.wasFrenchInverted = !1, TerraExplorer.browser.isFrenchLanguage && (e = invertDotsCommas(e), r.wasFrenchInverted = !0);
            if (e != undefined && e.indexOf(",") > -1) {
                var i = e.split(",");
                if (i.length == 2) {
                    var s = !isNaN(i[0]) && isFinite(i[0]) && i[0].match(/[0-9]/g) != null ? Number(i[0]) : null,
                        o = !isNaN(i[1]) && isFinite(i[1]) && i[1].match(/[0-9]/g) != null ? Number(i[1]) : null;
                    if (s != null && s >= -180 && s <= 180 && o != null && o >= -90 && o <= 90) {
                        TerraExplorer.internal.SearchBox._isCoordSearch = !0, t.lon = s, t.lat = o, TerraExplorer.internal.SearchBox._MGRS != undefined && (t.mgrs = TerraExplorer.internal.SearchBox._MGRS), TerraExplorer.internal.SearchBox.createResultsPopup(t);
                        return
                    }
                }
            } else if (e != undefined && (e.indexOf("MGRS:") > -1 || e.indexOf("mgrs:") > -1)) {
                e = e.replace(/ /g, ""), e = e.indexOf("MGRS:") > -1 ? e.split("MGRS:")[1] : e.split("mgrs:")[1];
                if (e == "") return;
                try {
                    var u = TerraExplorer.internal.Units.MGRS2LL(e), a = u.longitude + "," + u.latitude;
                    TerraExplorer.internal.SearchBox._MGRS = e, n(a, r)
                } catch (f) {
                    return
                }
            }
        }

        this._isCoordSearch = !1, this._MGRS = undefined, window["fillAutoComplete" + t.index] = undefined;
        if (t.index < this._searchLastRequest.index) return;
        this.hideResultsPopup(), t.completed = !0, t.data = e || [];
        if (t.autoFlyTo) {
            this.flyToFirstEntry(this._searchLastRequest);
            return
        }
        if (t.data.length == 0) {
            this.removeCurrentSearchLabelShown(), n(t.query, this);
            return
        }
        n(t.query, this), this._isCoordSearch || this.createResultsPopup(t)
    }, SearchBox.prototype.removeCurrentSearchLabelShown = function () {
        currentLabelShown != null && viewer.entities.remove(currentLabelShown)
    }, SearchBox.prototype.doSearch = function () {
        var query = $("#search").val();
        if (query != "" && this._searchServer == "") {
            this.showResultsPopup(TELang.i18n("search_service_is_unavailable"), 1);
            return
        }
        if (this._searchServer == "") {
            this.hideResultsPopup();
            return
        }
        if (this._searchServer == "" || this._searchLastRequest.query == query) return;
        !this._searchServer.match(/[?]$/) && !this._searchServer.match(/[?]/) && (this._searchServer += "?"), !this._searchServer.match(/[?]$/) && this._searchServer.match(/[?]/) && !this._searchServer.match(/[&]$/) && (this._searchServer += "&");
        var request = new searchRequest;
        request.query = query, TerraExplorer.browser.isFrenchLanguage && !this.wasFrenchInverted && (query = invertDotsCommas(query)), window["fillAutoComplete" + request.index] = $.proxy(function (e) {
            window["calledFillAutoComplete" + request.index] = !0, this.fillAutoComplete(e, request)
        }, this), this._searchLastRequest = request;
        var that = this, server = this._searchServer + this._searchServerTail;
        $.ajax({
            url: server.replace("<_searchIndex>", request.index) + encodeURIComponent(request.query),
            success: function (data, textStatus, jqXHR) {
                eval(data), that._searchErrorWasAlreadyShown || setTimeout($.proxy(function () {
                    !this._searchErrorWasAlreadyShown && !window["calledFillAutoComplete" + request.index] && (this._searchErrorWasAlreadyShown = !0)
                }, that), 100)
            },
            error: function (e) {
                query.length > 0 ? that.showResultsPopup(TELang.i18n("search_service_error"), 1) : that.hideResultsPopup()
            }
        })
    }, SearchBox.prototype.flyToCoordinates = function (e, t) {
        TerraExplorer.internal.Navigate.flyToPosition(new TerraExplorer.internal.TEPosition({
            cartesian: Cesium.Cartesian3.fromDegrees(e, t, 0),
            headingPitchRange: new Cesium.HeadingPitchRange(0, Cesium.Math.toRadians(-89), 1e3),
            altitudeType: TerraExplorer.internal.TEPosition.ATC_TERRAIN_ABSOLUTE
        }))
    }, SearchBox.prototype.createResultsPopup = function (e) {
        var t = [], n = 0, r = this;
        if (this._isCoordSearch) {
            this._searchLon = e.lon, this._searchLat = e.lat;
            var i;
            e.mgrs != undefined ? i = TELang.i18n("SearchBox_coordinates_MGRS", {
                newLine: "<br/>",
                longitude: e.lon.toFixed(4),
                latitude: e.lat.toFixed(4),
                newLine2: "<br/>",
                MGRS: e.mgrs
            }) : i = TELang.i18n("SearchBox_coordinates", {
                newLine: "<br/>",
                longitude: e.lon.toFixed(4),
                latitude: e.lat.toFixed(4)
            });
            var s = t.push("<span id='coordinatesDivId'  class='searchBoxRes' style='padding:7px;color:White; font-size:13px; font-weight:normal;'>" + i + "</span>");
            n += Math.ceil(i.length / 58);
            var o = new Promise(function (e, i) {
                r.showResultsPopup(t.join("") + r._searchCopyright, n + 1), e()
            });
            o.then(function () {
                $("#coordinatesDivId").unbind("click").click(function (e) {
                    TerraExplorer.internal.SearchBox.flyToCoordinates(r._searchLon, r._searchLat)
                })
            })
        } else $(e.data.slice(0, 8)).each(function (r) {
            var i = this.Name + " [" + this.Description + "]";
            if (e.query) {
                var s = new RegExp(e.query, "ig"), o;
                while (o = s.exec(i)) i = i.substr(0, o.index) + "<b>" + o[0] + "</b>" + i.substring(o.index + o[0].length), s.lastIndex += 7
            }
            var u = t.push("<a href='#' onclick='window[\"_searchFlyTo\"](" + this.Lat + "," + this.Lon + ", this.innerText, " + r + ");return false;' class='searchBoxRes' style='color:White; font-size:13px; font-weight:normal;'>" + i + "</a>");
            n += Math.ceil(i.length / 58)
        });
        t.length == 0 ? this.showResultsPopup(_text_noResultsFound, 1) : this.showResultsPopup(t.join("") + this._searchCopyright, n + 1)
    }, SearchBox.prototype.flyToTempFlyLocation = function (e, t) {
        var n = Cesium.when.defer(), r = performance.now();
        return TerraExplorer.internal.Navigate.flyToPosition(new TEPosition({
            cartesian: e,
            headingPitchRange: t
        }), {
            complete: function () {
                n.resolve()
            }
        }), n
    }, SearchBox.prototype.showResultsPopup = function (e, t) {
        var n = this;
        this.hideResultsPopup();
        var r = "";
        r += e, this._searchResultsPopup = !0, $("#resultDiv").html(r).show()
    }, SearchBox.prototype.flyToFirstEntry = function (e) {
        if (e.data.length == 0) this.createResultsPopup(this._searchLastRequest); else {
            var t = e.data[0];
            this.saveSearch(t), this.flyTo(t.Lat, t.Lon, t.Name + " [" + t.Description + "]"), this.hideResultsPopup()
        }
    }, SearchBox.prototype.dropdownClick = function () {
        if (this._searchResultsPopup) this.hideResultsPopup(); else {
            if ($("#search").val() == "") {
                var e = $.cookie("tew_Search_recentSearches") || "[]";
                lastRequest = new searchRequest, lastRequest.query = "", lastRequest.data = JSON.parse(e)
            }
            this.createResultsPopup(lastRequest)
        }
    }, SearchBox.prototype.saveSearch = function (e) {
        var t = $.cookie("tew_Search_recentSearches") || "[]";
        t = JSON.parse(t);
        var n = [];
        $(t).each(function () {
            (this.Lat != e.Lat || this.Lon != e.Lon) && n.push(this)
        }), n.unshift(e), n = n.slice(0, 8), n = JSON.stringify(n), $.cookie("tew_Search_recentSearches", n, {expires: 1e3})
    }, SearchBox.prototype.flyToFirstResult = function () {
        this._isCoordSearch ? this.flyToCoordinates(this._searchLon, this._searchLat) : (this.doSearch(), this._searchLastRequest.completed || this._searchResultsPopup && $("#search").val() == "" ? this.flyToFirstEntry(this._searchLastRequest) : this._searchLastRequest.autoFlyTo = !0)
    }, SearchBox.prototype.reverseGeocode = function (e, t, n) {
        var r = "latlon=" + t + "," + e, i = this.SearchServer + "callback=reverseGeocodeComplete&" + r,
            s = this.SearchServer;
        window.reverseGeocodeComplete = n;
        if (s === "" || s === undefined) {
            TerraExplorer.tools.ToolManager._tools.QueryTool.searchBoxError();
            return
        }
        $.ajax({
            url: s, error: function (e) {
                TerraExplorer.tools.ToolManager._tools.QueryTool.searchBoxError()
            }
        }), $.ajax({url: i, dataType: "script"})
    }, new SearchBox
}), define("tools/TETools/QueryTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "./FavoritesStorage", "../ToolDelegate", "../ToolContainer", "internal/SearchBox", "internal/Navigate", "internal/NotificationCenter", "internal/GeometryHelper", "internal/InputMode", "tools/ToolDialog", "tools/ListControl", "internal/ObjectHighlight", "turf.min"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m) {
    "use strict";

    function g() {
        this._explanationText = t.i18n("analysis_query_explanation_text"), this._explanationTextOnStartOnly = !0, this._locationText = "", this._queryImage = null, this._queryPosition = null, this._flyAround = null, this._flyAroundParams = {
            pitch: -50,
            distance: 5e3
        }, this._searchResult = null, this._favoriteItemId = "", this._canHover = !1, this._canPick = !1, this.isOpened = !1, this._pointOnModel, this._currentHeight, this._selectedFeatureLayerId = 0, this._isMouseMoving = !1, this._cursorPosition = new Cesium.Cartesian2(0, 0), this._prePosition, this._prePosition = this._cursorPosition, this._isDisplayed = !1, this.getId = function () {
            return "QueryTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Analyze_Query"), "./img/newDesign/analyze_query.png", 10, r.MenuEntryAnalyze(), t.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }, s.DefaultStorage, this._eventListener = null
    }

    function w(e, t, n) {
        var r;
        return e ? (e.favoriteItem ? r = new Cesium.Cartesian3(e.favoriteItem.tePosition.cartesian.x, e.favoriteItem.tePosition.cartesian.y, e.favoriteItem.tePosition.cartesian.z) : (r = t.position, Cesium.defined(r) || e.feature), r) : r
    }

    g.inheritsFrom(o), g.prototype.onMouseOver = function (e) {
        this._canHover && Cesium.defined(e) && (this._cursorPosition = e.endPosition), this._isMouseMoving = !0
    };
    var y = null, b;
    g.prototype.onClosedToolContainer = function () {
        this._queryPosition = null, this._explanationTextOnStartOnly = !0, this._queryImage != null && (viewer.entities.remove(this._queryImage), this._queryImage = null)
    }, g.prototype.onPreFrame = function () {
        if (this._isMouseMoving) {
            var e = viewer.Scene, t, n, r, i = {}, s = viewer.scene.screenToWorld(this._cursorPosition, i);
            if (Cesium.defined(i.pickPrimitive) && Cesium.defined(i.id) && (y == null || i.id == b)) {
                b = i.id;
                var o = Cesium.defined(this._queryImage) && this._queryImage === b;
                o || (t = TerraExplorer.internal.Project, n = t.findObjectFromID(b), r = i.pickPrimitive, y = v.addHighlight(i.pickPrimitive, b))
            } else Cesium.defined(y) && (y.removeHighlight(), y = null);
            this._prePosition = this._cursorPosition
        }
        this._isMouseMoving = !1
    }, g.prototype.Querying = function (n) {
        function s(e) {
            if (e._queryImage != null) return;
            e._queryImage = viewer.entities.add({
                position: e._queryPosition,
                billboard: {
                    image: "./img/query.png",
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    scale: .5,
                    eyeOffset: Cesium.DynamicEyeOffset()
                }
            }), e.animateScale(e._queryImage, 200)
        }

        var r = n;
        this._queryImage != null && (viewer.entities.remove(this._queryImage), this._queryImage = null);
        var o, u = {
            callback: e.proxy(function (e) {
                this._queryPosition = e, s(this), this._queryImage.position = this._queryPosition.clone()
            }, this)
        };
        this._pointOnModel = undefined;
        var f = viewer.scene.screenToWorld(r, u);
        f && (this._queryPosition = f, o = viewer.scene.globe.ellipsoid.cartesianToCartographic(this._queryPosition), u.pickPrimitive != undefined && (this._pointOnModel = o));
        if (this._queryPosition == null) return;
        this._toolContainer.setText("Retrieving Data..."), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove();
        var l = Cesium.Math.toDegrees(o.longitude), c = Cesium.Math.toDegrees(o.latitude);
        a.reverseGeocode(l, c, e.proxy(function (n) {
            this._searchResult = e.extend({}, n[0], {Lat: c, Lon: l});
            if (this._searchResult.Name.length == 0 && this._searchResult.Description.length == 0) {
                p.IsOpen && p.close();
                return
            }
            this._searchResult.Name === "XZ" && (this._searchResult.Name = t.i18n("query_unknown"));
            var r = this, s = Cesium.Cartographic.fromDegrees(r._searchResult.Lon, r._searchResult.Lat),
                o = TerraExplorer.functions.queryBestLevel(s);
            Cesium.when(o, function (n) {
                console.log("best level is: " + n);
                if (r._queryPosition == null) return;
                var o = Cesium.sampleTerrain(viewer.terrainProvider, n, [s]);
                Cesium.when(o, function (n) {
                    r.isReturnedFromServer = !0, r._pointOnModel != undefined && (n[0] = r._pointOnModel);
                    var s = e("<div style='position:absolute;overflow-y:auto; width:100%; height:100%;'></div>"),
                        o = e("<div id='MessageClientId' style='position:static; width:100%;'></div>");
                    e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), s.append(o), TerraExplorer.tools.ToolContainer.setText(""), e("#LowerView").length > 0 && e("#LowerView").append(s), o.css({height: s.height()}), r._listControl = new d(o), r._listControl.IsAnalyzeToolList = !0;
                    var u = r._searchResult.Name, a = u + ", " + r._searchResult.Description;
                    r._listControl.add({
                        text: t.i18n("query_Address") + ":&nbsp&nbsp" + r._searchResult.Name,
                        queryToolContainer: !0
                    }), r._listControl.add({
                        text: "<span style='margin-left:52px;'>" + r._searchResult.Description + "</span>",
                        queryToolContainer: !0
                    }), r._listControl.add({
                        text: t.i18n("longitude") + ":&nbsp&nbsp" + r._searchResult.Lon.toFixed(8),
                        queryToolContainer: !0
                    }), r._listControl.add({
                        text: t.i18n("latitude") + ":&nbsp&nbsp" + r._searchResult.Lat.toFixed(8),
                        queryToolContainer: !0
                    }), TerraExplorer.internal.Settings.displayMGRS && r._listControl.add({
                        text: t.i18n("StatusBar_MGRS") + ":&nbsp&nbsp" + i.LL2MGRS(r._searchResult.Lon, r._searchResult.Lat),
                        queryToolContainer: !0
                    });
                    var f, l;
                    r._currentHeight = n[0].height, r.updateAltitudeText()
                }).otherwise(function (e) {
                    console.log("!!!!!!!!!!!")
                })
            })
        }, this)), s(this)
    }, g.prototype.updateAltitudeText = function () {
        this._currentHeight !== undefined && this._listControl.add({
            text: t.i18n("altitude") + ":&nbsp&nbsp" + i.formatDistance(this._currentHeight) + "(AMSL)",
            queryToolContainer: !0
        })
    }, g.prototype.searchBoxError = function () {
        var n = TerraExplorer.tools.ToolManager._tools.QueryTool;
        n._toolContainer.setText("");
        var r = e("<div style='position:absolute;overflow-y:auto; width:100%; height:100%;'></div>"),
            i = e("<div id='MessageClientId' style='position:static; width:100%;'></div>");
        e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), r.append(i), e("#LowerView").length > 0 && e("#LowerView").append(r), i.css({height: r.height()}), n._listControl = new d(i), n._listControl.IsAnalyzeToolList = !0;
        var s = viewer.scene.globe.ellipsoid, o = viewer.camera.pickEllipsoid(n._prePosition, s),
            u = viewer.scene.globe.ellipsoid.cartesianToCartographic(o);
        n._listControl.add({
            text: t.i18n("longitude") + ":&nbsp&nbsp" + (u.longitude * 180 / Math.PI).toFixed(8),
            queryToolContainer: !0
        }), n._listControl.add({
            text: t.i18n("latitude") + ":&nbsp&nbsp" + (u.latitude * 180 / Math.PI).toFixed(8),
            queryToolContainer: !0
        }), this._listControl.add({
            text: t.i18n("altitude") + ":&nbsp&nbsp" + viewer.scene.globe.getHeight(u).toFixed(8),
            queryToolContainer: !0
        })
    }, g.prototype.geocoderFailure = function () {
        var n = TerraExplorer.tools.ToolManager._tools.QueryTool;
        n._toolContainer.setText("");
        var r = e("<div style='position:absolute;overflow-y:auto; width:100%; height:100%;'></div>"),
            i = e("<div id='MessageClientId' style='position:static; width:100%;'></div>");
        e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), r.append(i), e("#LowerView").length > 0 && e("#LowerView").append(r), i.css({height: r.height()}), n._listControl = new d(i), n._listControl.IsAnalyzeToolList = !0, n._listControl.add({
            text: t.i18n("longitude") + ":&nbsp&nbsp" + t.i18n("Unavailable"),
            queryToolContainer: !0
        }), n._listControl.add({
            text: t.i18n("latitude") + ":&nbsp&nbsp" + t.i18n("Unavailable"),
            queryToolContainer: !0
        }), n._listControl.add({
            text: t.i18n("altitude") + ":&nbsp&nbsp" + t.i18n("Unavailable"),
            queryToolContainer: !0
        })
    }, g.prototype.open = function (e, t) {
        if (this._canPick) {
            p.IsOpen && p.close(), this._favoriteItemId = "", this.removeFavorite();
            if (Cesium.defined(e)) {
                var n = {}, r = viewer.scene.screenToWorld(e, n);
                if (Cesium.defined(n.id)) {
                    if (Cesium.defined(this._queryImage) && this._queryImage === n.id) return;
                    var i = n.id, s = TerraExplorer.internal.Project, o = s.findObjectFromID(i);
                    if (o) {
                        var u = w(o, n.pickPrimitive, m);
                        u && (r = u), o.favoriteItem && (this._favoriteItemId = o.favoriteItem.id)
                    }
                    if (!Cesium.defined(r)) return;
                    this._queryPosition = r;
                    var a = viewer.scene.globe.ellipsoid.cartesianToCartographic(r);
                    this._queryImage != null && (viewer.entities.remove(this._queryImage), this._queryImage = null), t !== undefined && (n.titleName = t), this.DisplayDetailsAndAttributes(o, a, i, n)
                } else Cesium.defined(r) && this.Querying(e)
            }
            if (TerraExplorer.debugFloor !== undefined) {
                var a = viewer.scene.globe.ellipsoid.cartesianToCartographic(this._queryPosition);
                Cesium.sampleRenderedData([a], 10).then(function (e) {
                    console.log(e[0])
                })
            }
        }
    }, g.prototype.animateScale = function (t, n) {
        var r = t.billboard.scale.getValue(), i = r * 2;
        e({scale: r}).animate({scale: i}, {
            duration: n / 2, step: function () {
                t.billboard.scale.setValue(this.scale)
            }, easing: "linear", complete: function () {
                e({scale: i}).animate({scale: r}, {
                    duration: n / 2, step: function () {
                        t.billboard.scale.setValue(this.scale)
                    }, easing: "linear"
                })
            }
        })
    }, g.prototype.DisplayDetailsAndAttributesResults = function (n, r, s, o, u) {
        function c(e) {
            var t = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;
            return e.replace(t, "<a href='$1'>$1</a>")
        }

        if (u.useGeo) {
            if (n.Name.length == 0 && n.Description.length == 0) {
                p.IsOpen && p.close();
                return
            }
            n.Name === "XZ" && (n.Name = t.i18n("query_unknown"))
        }
        var a = s, f = this, l;
        u.useGeo ? l = Cesium.sampleTerrain(viewer.terrainProvider, 15, [Cesium.Cartographic.fromDegrees(n.Lon, n.Lat)]) : l = Cesium.when.defer().resolve(), Cesium.when(l, function (s) {
            u.useGeo && (s[0] = a);
            if (Cesium.defined(u.pickPrimitive.appearance) && u.pickPrimitive.appearance.constructor.name == "EllipsoidSurfaceAppearance") return;
            var l = !1, h = e("<div style='position:absolute;overflow:hidden; width:400px; height:350px;'></div>"),
                v = e("<div id='MessageClientId' style='position:absolute; overflow-y:auto; width:100%;'></div>");
            h.append(v);
            var m = !Cesium.defined(r) || !Cesium.defined(r.favoriteItem);
            m && (p.open(u.titleName !== undefined ? u.titleName : t.i18n("Query_Result"), "./img/dialogs/header_icons/layers.png", h.get(0), null, !1, undefined), p.removeCloseButton()), v.css({height: h.height()}), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), f._listControl = new d(v);
            var g = e("<div style='position:relative;overflow:hidden; width:100%; height:100%;'></div>"),
                y = e("<div id='MessageClientId' style='position:relative; margin-left:5px; margin-top:0px; overflow-y:auto; width:100%;'></div>"),
                b = new d(y);
            b.IsAnalyzeToolList = !0, g.append(y), TerraExplorer.tools.ToolContainer.setText(""), e("#LowerView").length > 0 && e("#LowerView").append(g), y.css({height: g.height()}), f._listControl.add({
                text: t.i18n("settings_general_header"),
                header: !0,
                queryDetailsWindow: !0
            });
            if (r) r.layer != null ? (f._listControl.add({
                text: "<b>" + t.i18n("query_LayerName") + ":</b>&nbsp&nbsp" + r.layer._layerDisplayName,
                query: !0,
                queryDetailsWindow: !0
            }), r.feature != undefined && r.feature != null && f._listControl.add({
                text: "<b>" + t.i18n("query_FeatureName") + ":</b>&nbsp&nbsp" + r.feature.fid,
                query: !0,
                queryDetailsWindow: !0
            })) : f._listControl.add({
                text: "<b>" + t.i18n("query_Name") + ":</b>&nbsp&nbsp" + n.Name,
                query: !0,
                queryDetailsWindow: !0
            }); else {
                var w = o._name ? o._name : o._id;
                f._listControl.add({
                    text: "<b>" + t.i18n(o._name ? "query_Name" : "query_ID") + ":</b>&nbsp&nbsp" + w,
                    query: !0,
                    queryDetailsWindow: !0
                })
            }
            if (Cesium.defined(u.id.polygon) || Cesium.defined(u.id.polyline)) l = !1;
            Cesium.defined(u.pickPrimitive.appearance) && u.pickPrimitive.appearance.constructor.name == "PolylineColorAppearance" && (l = !1);
            if (u.pickPrimitive._type == "Billboard" || u.pickPrimitive._type == "Label" || u.pickPrimitive._type == "Model" || r && r.favoriteItem) l = !0;
            u.useGeo && l && (b.add({
                text: t.i18n("query_Address") + ":&nbsp&nbsp" + n.Name,
                query: !0
            }), b.add({
                text: "<span style='margin-left:52px;'>" + n.Description + "</span>",
                query: !0
            }), b.add({
                text: t.i18n("query_longitude_pivot") + ":&nbsp&nbsp" + n.Lon.toFixed(8),
                query: !0
            }), b.add({
                text: t.i18n("query_latitude_pivot") + ":&nbsp&nbsp" + n.Lat.toFixed(8),
                query: !0
            }), b.add({
                text: t.i18n("query_altitude_pivot") + ":&nbsp&nbsp" + s[0].height.toFixed(3) + t.i18n("meters_short") + " (AMSL)",
                query: !0
            }), TerraExplorer.internal.Settings.displayMGRS && f._listControl.add({
                text: t.i18n("StatusBar_MGRS") + ":&nbsp&nbsp" + i.LL2MGRS(n.Lon, n.Lat),
                query: !0,
                queryDetailsWindow: !0
            }));
            if (f.hasAttributes(r) && r.feature.attributes != undefined) {
                f._listControl.add({text: t.i18n("query_attributes_header"), header: !0, queryDetailsWindow: !0});
                for (var E in r.feature.attributes) {
                    r.feature.attributes[E] == undefined && (r.feature.attributes[E] = "");
                    var S = c(r.feature.attributes[E]);
                    f._listControl.add({text: "<b>" + E + ":</b>&nbsp;&nbsp;" + S, query: !0, queryDetailsWindow: !0})
                }
            }
            e(e(e(".toolDialog .listControl")[0]).children()).each(function (t, n) {
                e(n).width("390")
            }), e(".toolDialog #MessageClientId span").each(function (t, n) {
                e(n).attr("class", e(n).attr("class").replace("Sidebar", "")), e(n).css("padding-left", "10px"), e(n).width("390")
            })
        })
    }, g.prototype.DisplayDetailsAndAttributes = function (t, n, r, i) {
        var s = Cesium.Math.toDegrees(n.longitude), o = Cesium.Math.toDegrees(n.latitude);
        t.feature && t.feature.attributes ? this.DisplayDetailsAndAttributesResults(t.feature.attributes, t, n, r, i) : a.reverseGeocode(s, o, e.proxy(function (u) {
            i.useGeo = !0, this._searchResult = e.extend({}, u[0], {
                Lat: o,
                Lon: s
            }), this.DisplayDetailsAndAttributesResults(this._searchResult, t, n, r, i)
        }, this))
    };
    var E = 0;
    return g.prototype.onLeftClick = function (e) {
        if (f.IsMultiGestureNavigation) return;
        u.IsVisible && this.open(e.position);
        if (!u.IsVisible) return
    }, g.prototype.hasAttributes = function (e) {
        return e == undefined ? !1 : e.layer && e.feature.attributes ? !0 : !1
    }, g.prototype.onOpenedToolContainer = function () {
        this._canPick = !0, this._canHover = !0, this.isOpened = !0, this._toolContainer.IsQuery = !0, TerraExplorer.browser.isIE ? e(viewer.container).css({cursor: "help"}) : e(viewer.container).css({cursor: 'url("./img/queryCursor.png") 7 6, pointer'}), e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Analyze_Query")), TerraExplorer.tools.ToolContainer.enableButton("1", !1), TerraExplorer.tools.ToolContainer.enableButton("3", !1), this._explanationTextOnStartOnly = !1
    }, g.prototype.onBeforeOpenToolContainer = function () {
        return e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), h.Mode = h.MEASUREMENT, this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.onLeftClick, this), Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.setInputAction(e.proxy(this.onMouseOver, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE), viewer.scene.preRender.addEventListener(this.onPreFrame, this), this.parent.onBeforeOpenToolContainer.call(this), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText), this.ToolContainer.addButton(1, "./img/favorits_checkbox.png", undefined, t.i18n("Query_Favorite_ToolTip")), this.ToolContainer.addButton(3, "./img/fly_around.png", undefined, t.i18n("Query_FlyAround_ToolTip")), l.addObserver(this, "favoriteChanged", "TEN_FAVORITE_CHANGED", null), l.addObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, g.prototype.unitsChanged = function (t) {
        if (this._currentHeight !== undefined) {
            var n = e(this._listControl._ListDiv);
            n.length > 0 && n.children().last().remove(), this.updateAltitudeText()
        }
    }, g.prototype.onBeforeCloseToolContainer = function (e) {
        return Cesium.defined(y) && (y.removeHighlight(), y = null), this.parent.onBeforeCloseToolContainer.call(this, e), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), l.removeObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), this._toolContainer.IsQuery = !1, h.Mode = h.FREE_FLIGHT, f.stop(), viewer.entities.remove(this._queryImage), this._queryImage = null, this._canPick = !1, this._canHover = !1, this.isOpened = !1, viewer.scene.preRender.removeEventListener(this.onPreFrame, this), p.IsOpen && p.close(), !0
    }, g.prototype.onButtonClick = function (t) {
        this.parent.onButtonClick.call(this, t);
        switch (t) {
            case 1:
                this.addFavorite();
                break;
            case 2:
                this.removeFavorite();
                break;
            case 3:
                if (f.isFlyAround()) return;
                if (this._queryPosition == null) return;
                viewer.camera.flyToBoundingSphere(new Cesium.BoundingSphere(this._queryPosition, f.HeightAboveGround * 2), {
                    duration: 1,
                    offset: new Cesium.HeadingPitchRange(viewer.camera.heading, Cesium.Math.toRadians(this._flyAroundParams.pitch), f.HeightAboveGround * 2),
                    complete: e.proxy(function () {
                        f.flyAround(this._queryPosition)
                    }, this)
                });
                break;
            case 4:
        }
    }, g.prototype.addFavorite = function () {
        if (this._queryPosition == null) return;
        var t, n = !0;
        this._favoriteItemId === "" ? (t = s.createFavoriteItem(), this._searchResult && this._searchResult.Name != "" ? (t.name = this._searchResult.Name, t.desc = this._searchResult.Description) : t.name = this._locationText, t.tePosition.Cartesian = this._queryPosition.clone(), t.tePosition.HeadingPitchRange = c.getHeadingPitchRange(viewer.camera.position, t.tePosition.Cartesian), s.DefaultStorage.saveItem(t)) : (n = !1, t = s.getFeatureById(this._favoriteItemId)), this._favoriteItemId = t.id, this.ToolContainer.removeButtons(), this.ToolContainer.addButton(2, "./img/favorits.png"), this.ToolContainer.addButton(3, "./img/fly_around.png"), this.ToolContainer.setEnable(!1, !1), this.ToolContainer.ToolManager.openTool("EditFavoriteTool", {
            id: t.id,
            callback: e.proxy(function (e) {
                e && n && this.removeFavorite()
            }, this)
        })
    }, g.prototype.removeFavorite = function () {
        s.DefaultStorage.deleteItem(this._favoriteItemId), this._favoriteItemId = "", this.ToolContainer.removeButtons(), this.ToolContainer.addButton(1, "./img/favorits_checkbox.png"), this.ToolContainer.addButton(3, "./img/fly_around.png"), this._queryImage && (this._queryImage.show = !0)
    }, g.prototype.favoriteChanged = function (e) {
        var t = e;
        this._favoriteItemId == t.id && this._queryImage && (t.showOn3D ? this._queryImage.show = !1 : this._queryImage.show = !0)
    }, g
}), define("tools/TETools/MessageLink", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "./FavoritesStorage", "../ToolDelegate", "../ToolContainer", "internal/SearchBox", "internal/Navigate", "internal/NotificationCenter", "internal/GeometryHelper", "internal/InputMode", "tools/ToolDialog", "tools/ListControl", "internal/ObjectHighlight", "turf.min"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m) {
    "use strict";

    function g() {
        this.getId = function () {
            return "MessageLinkTool"
        }
    }

    function w(e, t, n) {
        var r;
        return e ? (e.favoriteItem ? r = new Cesium.Cartesian3(e.favoriteItem.tePosition.cartesian.x, e.favoriteItem.tePosition.cartesian.y, e.favoriteItem.tePosition.cartesian.z) : (r = t.position, Cesium.defined(r) || e.feature), r) : r
    }

    g.prototype.open = function (n) {
        if (this._canPick) {
            if (Cesium.defined(n) && !TerraExplorer.internal.DrawingTool.Active) {
                var r = {}, i = viewer.scene.screenToWorld(n, r);
                if (Cesium.defined(r.id)) {
                    if (r.id === "undergroundSurface") return;
                    if (!Cesium.defined(i)) return;
                    var s = null;
                    typeof r.id == "string" && (s = r.id.match(/^(.+)\.\d+$/));
                    if (s !== null) {
                        this.$layer = undefined;
                        for (var o = 0; o < TerraExplorer.internal.Project._featureLayers.length; o++) TerraExplorer.internal.Project._featureLayers[o]._layerName === s[1] && (this.$layer = TerraExplorer.internal.Project._featureLayers[o])
                    }
                    if (this.$layer !== undefined && this.$layer.Style !== undefined && this.$layer.Style.messageLink !== undefined) if (!TerraExplorer.tools.ToolManager._tools.QueryTool.isOpened && this.$layer.Style.messageLink.type.toLowerCase() == "attributesstyle") {
                        var u = viewer.scene.globe.ellipsoid.cartesianToCartographic(i),
                            a = TerraExplorer.internal.Project.findObjectFromID(b);
                        r.titleName = t.i18n("message_link_attribute"), TerraExplorer.tools.ToolManager._tools.QueryTool.DisplayDetailsAndAttributes(a, u, b, r)
                    } else this.$layer.Style.messageLink.type.toLowerCase() == "text" ? this.showTextMessage(this.$layer.Style.messageLink.content) : this.$layer.Style.messageLink.type.toLowerCase() == "html" && this.showHtmlMessage(this.$layer.Style.messageLink.content, b, this.$layer.Style.messageLink.width, this.$layer.Style.messageLink.height)
                } else Cesium.defined(i)
            }
        } else this._queryImage = null, this._queryPosition = null, this._canPick = !0, this._canHover = !0, TerraExplorer.isTouch() || viewer.scene.preRender.addEventListener(this.onPreFrame, this), this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.onLeftClick, this), Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.setInputAction(e.proxy(this.onMouseOver, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE)
    }, g.prototype.displayMessage = function (e, n) {
        if (TerraExplorer.tools.ToolManager._tools.QueryTool.isOpened || e.content === "" && e.type !== "attributesStyle") return;
        switch (e.type.toLowerCase()) {
            case"attributesstyle":
                var r = viewer.scene.globe.ellipsoid.cartesianToCartographic(n.worldCoord),
                    i = TerraExplorer.internal.Project.findObjectFromID(n.id);
                n.titleName = t.i18n("message_link_attribute"), TerraExplorer.tools.ToolManager._tools.QueryTool.DisplayDetailsAndAttributes(i, r, n.id, n);
                break;
            case"text":
                var s = e.content.replace(/^"/, "").replace(/"$/, "");
                this.showTextMessage(s);
                break;
            case"html":
                var s = e.content.match(/src="([^"]+)"/i) == null ? 'src="' + e.content + '"' : match[1];
                this.showHtmlMessage(s, b, e.width, e.height)
        }
    }, g.prototype.showTextMessage = function (n) {
        var r = e("<div style='position:absolute;overflow:hidden; width:400px; height:350px;'></div>"),
            i = e("<div id='MessageClientId' style='position:absolute; overflow-y:auto; width:92%; padding: 1rem'></div>");
        i[0].innerText = n, r.append(i), p.open(t.i18n("message_link_title"), "./img/dialogs/header_icons/layers.png", r.get(0), null, !1, !1, !1, !0), TerraExplorer.isTouch() && (e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0))
    }, g.prototype.showHtmlMessage = function (n, r, i, s) {
        var o = n.match(/\[([^\]]+)\]/g), u, a = n;
        o != null && (u = TerraExplorer.internal.Project.findObjectFromID(r));
        if (u !== undefined && u !== null) for (var f = 0; f < o.length; f++) {
            var l = o[f].match(/\[([^)]+)\]/);
            l != null && (a = n.replace(o[f], u.feature.attributes[l[f + 1]]))
        }
        var c = "400", h = "500";
        i !== undefined && (h = i), s !== undefined && (c = s);
        var d = e("<div id='htmlParentDiv' style='position:absolute;overflow:hidden; width:" + h + "px; height:" + c + "px;'></div>"),
            v = e("<iframe id='htmlMessageLinkId' src='" + a.match(/src="([^"]+)"/i)[1] + "' onload='TerraExplorer.tools.ToolManager._tools.MessageLinkTool.onHtmlFrameLoad(this)' style='overflow-y:auto; width:100%; height:100%; resize: none'></iframe>");
        d.append(v), p.open(t.i18n("message_link_title"), "./img/dialogs/header_icons/layers.png", d.get(0), e.proxy(this.onClose, this), !1, undefined, !1, !0), e(".toolDialog").bind("resize", this.resizeHandler), TerraExplorer.isTouch() && (e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0))
    }, g.prototype.resizeHandler = function () {
        e("#htmlParentDiv").width(e(".toolDialog").width()), e("#htmlParentDiv").height(e(".toolDialog").height()), e("#htmlMessageLinkId").width(e(".toolDialog").width()), e("#htmlMessageLinkId").height(e(".toolDialog").height()), TerraExplorer.tools.ToolManager._tools.MessageLinkTool.$layer.Style.messageLink.width = e(".toolDialog").width(), TerraExplorer.tools.ToolManager._tools.MessageLinkTool.$layer.Style.messageLink.height = e(".toolDialog").height()
    }, g.prototype.onClose = function (t) {
        e(".toolDialog").unbind("resize", this.resizeHandler), console.log("finished"), this.$layer = undefined
    }, g.prototype.onHtmlFrameLoad = function (t) {
        e("#htmlMessageLinkId").width(e(".toolDialog").width()), e("#htmlMessageLinkId").height(e(".toolDialog").height())
    }, g.prototype.onMouseOver = function (e) {
        this._canHover && Cesium.defined(e) && !TerraExplorer.internal.DrawingTool.Active && !TerraExplorer.tools.ToolManager._tools.QueryTool.isOpened ? this._cursorPosition = e.endPosition : this._cursorPosition = undefined
    };
    var y = null, b;
    return g.prototype.onLeftClick = function (e) {
        if (f.IsMultiGestureNavigation) return;
        this.open(e.position)
    }, g.prototype.onPreFrame = function () {
        if (viewer.camera.isMoving) return;
        if (this._cursorPosition !== undefined && viewer.scene.frameState.frameNumber % 7 === 0 && !TerraExplorer.internal.DrawingTool.Active) {
            var t = viewer.Scene, n, r, i, s = {}, o = viewer.scene.screenToWorld(this._cursorPosition, s);
            if (Cesium.defined(s.pickPrimitive) && Cesium.defined(s.id) && (y == null || s.id == b)) {
                b = s.id;
                if (b === "undergroundSurface") return;
                var u = Cesium.defined(this._queryImage) && this._queryImage === b;
                u || (n = TerraExplorer.internal.Project, r = n.findObjectFromID(b), i = s.pickPrimitive, y = v.addHighlight(s.pickPrimitive, b), y.show = !1, e(viewer.container).css({cursor: "pointer"}))
            } else Cesium.defined(y) && (y.removeHighlight(), y = null, e(viewer.container).css({cursor: "url(./img/OpenHand.png) 16 16, pointer"}))
        }
    }, g
}), function (e) {
    typeof define == "function" && define.amd ? define("internal/datePicker", ["jquery"], e) : e(jQuery)
}(function (e) {
    function i(e) {
        var t, n;
        while (e.length && e[0] !== document) {
            t = e.css("position");
            if (t === "absolute" || t === "relative" || t === "fixed") {
                n = parseInt(e.css("zIndex"), 10);
                if (!isNaN(n) && n !== 0) return n
            }
            e = e.parent()
        }
        return 0
    }

    function s() {
        this._curInst = null, this._keyEvent = !1, this._disabledInputs = [], this._datepickerShowing = !1, this._inDialog = !1, this._mainDivId = "ui-datepicker-div", this._inlineClass = "ui-datepicker-inline", this._appendClass = "ui-datepicker-append", this._triggerClass = "ui-datepicker-trigger", this._dialogClass = "ui-datepicker-dialog", this._disableClass = "ui-datepicker-disabled", this._unselectableClass = "ui-datepicker-unselectable", this._currentClass = "ui-datepicker-current-day", this._dayOverClass = "ui-datepicker-days-cell-over", this.regional = [], this.regional[""] = {
            closeText: "Done",
            prevText: "Prev",
            nextText: "Next",
            currentText: "Today",
            monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            monthNamesShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
            dayNamesShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
            dayNamesMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
            weekHeader: "Wk",
            dateFormat: "mm/dd/yy",
            firstDay: 0,
            isRTL: !1,
            showMonthAfterYear: !1,
            yearSuffix: ""
        }, this._defaults = {
            showOn: "focus",
            showAnim: "fadeIn",
            showOptions: {},
            defaultDate: null,
            appendText: "",
            buttonText: "...",
            buttonImage: "",
            buttonImageOnly: !1,
            hideIfNoPrevNext: !1,
            navigationAsDateFormat: !1,
            gotoCurrent: !1,
            changeMonth: !1,
            changeYear: !1,
            yearRange: "c-10:c+10",
            showOtherMonths: !1,
            selectOtherMonths: !1,
            showWeek: !1,
            calculateWeek: this.iso8601Week,
            shortYearCutoff: "+10",
            minDate: null,
            maxDate: null,
            duration: "fast",
            beforeShowDay: null,
            beforeShow: null,
            onSelect: null,
            onChangeMonthYear: null,
            onClose: null,
            numberOfMonths: 1,
            showCurrentAtPos: 0,
            stepMonths: 1,
            stepBigMonths: 12,
            altField: "",
            altFormat: "",
            constrainInput: !0,
            showButtonPanel: !1,
            autoSize: !1,
            disabled: !1
        }, e.extend(this._defaults, this.regional[""]), this.regional.en = e.extend(!0, {}, this.regional[""]), this.regional["en-US"] = e.extend(!0, {}, this.regional.en), this.dpDiv = o(e("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))
    }

    function o(t) {
        var n = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
        return t.on("mouseout", n, function () {
            e(this).removeClass("ui-state-hover"), this.className.indexOf("ui-datepicker-prev") !== -1 && e(this).removeClass("ui-datepicker-prev-hover"), this.className.indexOf("ui-datepicker-next") !== -1 && e(this).removeClass("ui-datepicker-next-hover")
        }).on("mouseover", n, u)
    }

    function u() {
        e.datepicker._isDisabledDatepicker(r.inline ? r.dpDiv.parent()[0] : r.input[0]) || (e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"), e(this).addClass("ui-state-hover"), this.className.indexOf("ui-datepicker-prev") !== -1 && e(this).addClass("ui-datepicker-prev-hover"), this.className.indexOf("ui-datepicker-next") !== -1 && e(this).addClass("ui-datepicker-next-hover"))
    }

    function a(t, n) {
        e.extend(t, n);
        for (var r in n) n[r] == null && (t[r] = n[r]);
        return t
    }

    e.ui = e.ui || {};
    var t = e.ui.version = "1.12.0", n = e.ui.keyCode = {
        BACKSPACE: 8,
        COMMA: 188,
        DELETE: 46,
        DOWN: 40,
        END: 35,
        ENTER: 13,
        ESCAPE: 27,
        HOME: 36,
        LEFT: 37,
        PAGE_DOWN: 34,
        PAGE_UP: 33,
        PERIOD: 190,
        RIGHT: 39,
        SPACE: 32,
        TAB: 9,
        UP: 38
    };
    e.extend(e.ui, {datepicker: {version: "1.12.0"}});
    var r;
    e.extend(s.prototype, {
        markerClassName: "hasDatepicker",
        maxRows: 4,
        _widgetDatepicker: function () {
            return this.dpDiv
        },
        setDefaults: function (e) {
            return a(this._defaults, e || {}), this
        },
        _attachDatepicker: function (t, n) {
            var r, i, s;
            r = t.nodeName.toLowerCase(), i = r === "div" || r === "span", t.id || (this.uuid += 1, t.id = "dp" + this.uuid), s = this._newInst(e(t), i), s.settings = e.extend({}, n || {}), r === "input" ? this._connectDatepicker(t, s) : i && this._inlineDatepicker(t, s)
        },
        _newInst: function (t, n) {
            var r = t[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1");
            return {
                id: r,
                input: t,
                selectedDay: 0,
                selectedMonth: 0,
                selectedYear: 0,
                drawMonth: 0,
                drawYear: 0,
                inline: n,
                dpDiv: n ? o(e("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")) : this.dpDiv
            }
        },
        _connectDatepicker: function (t, n) {
            var r = e(t);
            n.append = e([]), n.trigger = e([]);
            if (r.hasClass(this.markerClassName)) return;
            this._attachments(r, n), r.addClass(this.markerClassName).on("keydown", this._doKeyDown).on("keypress", this._doKeyPress).on("keyup", this._doKeyUp), this._autoSize(n), e.data(t, "datepicker", n), n.settings.disabled && this._disableDatepicker(t)
        },
        _attachments: function (t, n) {
            var r, i, s, o = this._get(n, "appendText"), u = this._get(n, "isRTL");
            n.append && n.append.remove(), o && (n.append = e("<span class='" + this._appendClass + "'>" + o + "</span>"), t[u ? "before" : "after"](n.append)), t.off("focus", this._showDatepicker), n.trigger && n.trigger.remove(), r = this._get(n, "showOn"), (r === "focus" || r === "both") && t.on("focus", this._showDatepicker);
            if (r === "button" || r === "both") i = this._get(n, "buttonText"), s = this._get(n, "buttonImage"), n.trigger = e(this._get(n, "buttonImageOnly") ? e("<img/>").addClass(this._triggerClass).attr({
                src: s,
                alt: i,
                title: i
            }) : e("<button type='button'></button>").addClass(this._triggerClass).html(s ? e("<img/>").attr({
                src: s,
                alt: i,
                title: i
            }) : i)), t[u ? "before" : "after"](n.trigger), n.trigger.on("click", function () {
                return e.datepicker._datepickerShowing && e.datepicker._lastInput === t[0] ? e.datepicker._hideDatepicker() : e.datepicker._datepickerShowing && e.datepicker._lastInput !== t[0] ? (e.datepicker._hideDatepicker(), e.datepicker._showDatepicker(t[0])) : e.datepicker._showDatepicker(t[0]), !1
            })
        },
        _autoSize: function (e) {
            if (this._get(e, "autoSize") && !e.inline) {
                var t, n, r, i, s = new Date(2009, 11, 20), o = this._get(e, "dateFormat");
                o.match(/[DM]/) && (t = function (e) {
                    n = 0, r = 0;
                    for (i = 0; i < e.length; i++) e[i].length > n && (n = e[i].length, r = i);
                    return r
                }, s.setMonth(t(this._get(e, o.match(/MM/) ? "monthNames" : "monthNamesShort"))), s.setDate(t(this._get(e, o.match(/DD/) ? "dayNames" : "dayNamesShort")) + 20 - s.getDay())), e.input.attr("size", this._formatDate(e, s).length)
            }
        },
        _inlineDatepicker: function (t, n) {
            var r = e(t);
            if (r.hasClass(this.markerClassName)) return;
            r.addClass(this.markerClassName).append(n.dpDiv), e.data(t, "datepicker", n), this._setDate(n, this._getDefaultDate(n), !0), this._updateDatepicker(n), this._updateAlternate(n), n.settings.disabled && this._disableDatepicker(t), n.dpDiv.css("display", "block")
        },
        _dialogDatepicker: function (t, n, r, i, s) {
            var o, u, f, l, c, h = this._dialogInst;
            return h || (this.uuid += 1, o = "dp" + this.uuid, this._dialogInput = e("<input type='text' id='" + o + "' style='position: absolute; top: -100px; width: 0px;'/>"), this._dialogInput.on("keydown", this._doKeyDown), e("body").append(this._dialogInput), h = this._dialogInst = this._newInst(this._dialogInput, !1), h.settings = {}, e.data(this._dialogInput[0], "datepicker", h)), a(h.settings, i || {}), n = n && n.constructor === Date ? this._formatDate(h, n) : n, this._dialogInput.val(n), this._pos = s ? s.length ? s : [s.pageX, s.pageY] : null, this._pos || (u = document.documentElement.clientWidth, f = document.documentElement.clientHeight, l = document.documentElement.scrollLeft || document.body.scrollLeft, c = document.documentElement.scrollTop || document.body.scrollTop, this._pos = [u / 2 - 100 + l, f / 2 - 150 + c]), this._dialogInput.css("left", this._pos[0] + 20 + "px").css("top", this._pos[1] + "px"), h.settings.onSelect = r, this._inDialog = !0, this.dpDiv.addClass(this._dialogClass), this._showDatepicker(this._dialogInput[0]), e.blockUI && e.blockUI(this.dpDiv), e.data(this._dialogInput[0], "datepicker", h), this
        },
        _destroyDatepicker: function (t) {
            var n, i = e(t), s = e.data(t, "datepicker");
            if (!i.hasClass(this.markerClassName)) return;
            n = t.nodeName.toLowerCase(), e.removeData(t, "datepicker"), n === "input" ? (s.append.remove(), s.trigger.remove(), i.removeClass(this.markerClassName).off("focus", this._showDatepicker).off("keydown", this._doKeyDown).off("keypress", this._doKeyPress).off("keyup", this._doKeyUp)) : (n === "div" || n === "span") && i.removeClass(this.markerClassName).empty(), r === s && (r = null)
        },
        _enableDatepicker: function (t) {
            var n, r, i = e(t), s = e.data(t, "datepicker");
            if (!i.hasClass(this.markerClassName)) return;
            n = t.nodeName.toLowerCase();
            if (n === "input") t.disabled = !1, s.trigger.filter("button").each(function () {
                this.disabled = !1
            }).end().filter("img").css({
                opacity: "1.0",
                cursor: ""
            }); else if (n === "div" || n === "span") r = i.children("." + this._inlineClass), r.children().removeClass("ui-state-disabled"), r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !1);
            this._disabledInputs = e.map(this._disabledInputs, function (e) {
                return e === t ? null : e
            })
        },
        _disableDatepicker: function (t) {
            var n, r, i = e(t), s = e.data(t, "datepicker");
            if (!i.hasClass(this.markerClassName)) return;
            n = t.nodeName.toLowerCase();
            if (n === "input") t.disabled = !0, s.trigger.filter("button").each(function () {
                this.disabled = !0
            }).end().filter("img").css({
                opacity: "0.5",
                cursor: "default"
            }); else if (n === "div" || n === "span") r = i.children("." + this._inlineClass), r.children().addClass("ui-state-disabled"), r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !0);
            this._disabledInputs = e.map(this._disabledInputs, function (e) {
                return e === t ? null : e
            }), this._disabledInputs[this._disabledInputs.length] = t
        },
        _isDisabledDatepicker: function (e) {
            if (!e) return !1;
            for (var t = 0; t < this._disabledInputs.length; t++) if (this._disabledInputs[t] === e) return !0;
            return !1
        },
        _getInst: function (t) {
            try {
                return e.data(t, "datepicker")
            } catch (n) {
                throw"Missing instance data for this datepicker"
            }
        },
        _optionDatepicker: function (t, n, r) {
            var i, s, o, u, f = this._getInst(t);
            if (arguments.length === 2 && typeof n == "string") return n === "defaults" ? e.extend({}, e.datepicker._defaults) : f ? n === "all" ? e.extend({}, f.settings) : this._get(f, n) : null;
            i = n || {}, typeof n == "string" && (i = {}, i[n] = r), f && (this._curInst === f && this._hideDatepicker(), s = this._getDateDatepicker(t, !0), o = this._getMinMaxDate(f, "min"), u = this._getMinMaxDate(f, "max"), a(f.settings, i), o !== null && i.dateFormat !== undefined && i.minDate === undefined && (f.settings.minDate = this._formatDate(f, o)), u !== null && i.dateFormat !== undefined && i.maxDate === undefined && (f.settings.maxDate = this._formatDate(f, u)), "disabled" in i && (i.disabled ? this._disableDatepicker(t) : this._enableDatepicker(t)), this._attachments(e(t), f), this._autoSize(f), this._setDate(f, s), this._updateAlternate(f), this._updateDatepicker(f))
        },
        _changeDatepicker: function (e, t, n) {
            this._optionDatepicker(e, t, n)
        },
        _refreshDatepicker: function (e) {
            var t = this._getInst(e);
            t && this._updateDatepicker(t)
        },
        _setDateDatepicker: function (e, t) {
            var n = this._getInst(e);
            n && (this._setDate(n, t), this._updateDatepicker(n), this._updateAlternate(n))
        },
        _getDateDatepicker: function (e, t) {
            var n = this._getInst(e);
            return n && !n.inline && this._setDateFromField(n, t), n ? this._getDate(n) : null
        },
        _doKeyDown: function (t) {
            var n, r, i, s = e.datepicker._getInst(t.target), o = !0, u = s.dpDiv.is(".ui-datepicker-rtl");
            s._keyEvent = !0;
            if (e.datepicker._datepickerShowing) switch (t.keyCode) {
                case 9:
                    e.datepicker._hideDatepicker(), o = !1;
                    break;
                case 13:
                    return i = e("td." + e.datepicker._dayOverClass + ":not(." + e.datepicker._currentClass + ")", s.dpDiv), i[0] && e.datepicker._selectDay(t.target, s.selectedMonth, s.selectedYear, i[0]), n = e.datepicker._get(s, "onSelect"), n ? (r = e.datepicker._formatDate(s), n.apply(s.input ? s.input[0] : null, [r, s])) : e.datepicker._hideDatepicker(), !1;
                case 27:
                    e.datepicker._hideDatepicker();
                    break;
                case 33:
                    e.datepicker._adjustDate(t.target, t.ctrlKey ? -e.datepicker._get(s, "stepBigMonths") : -e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 34:
                    e.datepicker._adjustDate(t.target, t.ctrlKey ? +e.datepicker._get(s, "stepBigMonths") : +e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 35:
                    (t.ctrlKey || t.metaKey) && e.datepicker._clearDate(t.target), o = t.ctrlKey || t.metaKey;
                    break;
                case 36:
                    (t.ctrlKey || t.metaKey) && e.datepicker._gotoToday(t.target), o = t.ctrlKey || t.metaKey;
                    break;
                case 37:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, u ? 1 : -1, "D"), o = t.ctrlKey || t.metaKey, t.originalEvent.altKey && e.datepicker._adjustDate(t.target, t.ctrlKey ? -e.datepicker._get(s, "stepBigMonths") : -e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 38:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, -7, "D"), o = t.ctrlKey || t.metaKey;
                    break;
                case 39:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, u ? -1 : 1, "D"), o = t.ctrlKey || t.metaKey, t.originalEvent.altKey && e.datepicker._adjustDate(t.target, t.ctrlKey ? +e.datepicker._get(s, "stepBigMonths") : +e.datepicker._get(s, "stepMonths"), "M");
                    break;
                case 40:
                    (t.ctrlKey || t.metaKey) && e.datepicker._adjustDate(t.target, 7, "D"), o = t.ctrlKey || t.metaKey;
                    break;
                default:
                    o = !1
            } else t.keyCode === 36 && t.ctrlKey ? e.datepicker._showDatepicker(this) : o = !1;
            o && (t.preventDefault(), t.stopPropagation())
        },
        _doKeyPress: function (t) {
            var n, r, i = e.datepicker._getInst(t.target);
            if (e.datepicker._get(i, "constrainInput")) return n = e.datepicker._possibleChars(e.datepicker._get(i, "dateFormat")), r = String.fromCharCode(t.charCode == null ? t.keyCode : t.charCode), t.ctrlKey || t.metaKey || r < " " || !n || n.indexOf(r) > -1
        },
        _doKeyUp: function (t) {
            var n, r = e.datepicker._getInst(t.target);
            if (r.input.val() !== r.lastVal) try {
                n = e.datepicker.parseDate(e.datepicker._get(r, "dateFormat"), r.input ? r.input.val() : null, e.datepicker._getFormatConfig(r)), n && (e.datepicker._setDateFromField(r), e.datepicker._updateAlternate(r), e.datepicker._updateDatepicker(r))
            } catch (i) {
            }
            return !0
        },
        _showDatepicker: function (t) {
            t = t.target || t, t.nodeName.toLowerCase() !== "input" && (t = e("input", t.parentNode)[0]);
            if (e.datepicker._isDisabledDatepicker(t) || e.datepicker._lastInput === t) return;
            var n, r, s, o, u, f, l;
            n = e.datepicker._getInst(t), e.datepicker._curInst && e.datepicker._curInst !== n && (e.datepicker._curInst.dpDiv.stop(!0, !0), n && e.datepicker._datepickerShowing && e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])), r = e.datepicker._get(n, "beforeShow"), s = r ? r.apply(t, [t, n]) : {};
            if (s === !1) return;
            a(n.settings, s), n.lastVal = null, e.datepicker._lastInput = t, e.datepicker._setDateFromField(n), e.datepicker._inDialog && (t.value = ""), e.datepicker._pos || (e.datepicker._pos = e.datepicker._findPos(t), e.datepicker._pos[1] += t.offsetHeight), o = !1, e(t).parents().each(function () {
                return o |= e(this).css("position") === "fixed", !o
            }), u = {
                left: e.datepicker._pos[0],
                top: e.datepicker._pos[1]
            }, e.datepicker._pos = null, n.dpDiv.empty(), n.dpDiv.css({
                position: "absolute",
                display: "block",
                top: "-1000px"
            }), e.datepicker._updateDatepicker(n), u = e.datepicker._checkOffset(n, u, o), n.dpDiv.css({
                position: e.datepicker._inDialog && e.blockUI ? "static" : o ? "fixed" : "absolute",
                display: "none",
                left: u.left + "px",
                top: u.top + "px"
            }), n.inline || (f = e.datepicker._get(n, "showAnim"), l = e.datepicker._get(n, "duration"), n.dpDiv.css("z-index", i(e(t)) + 1), e.datepicker._datepickerShowing = !0, e.effects && e.effects.effect[f] ? n.dpDiv.show(f, e.datepicker._get(n, "showOptions"), l) : n.dpDiv[f || "show"](f ? l : null), e.datepicker._shouldFocusInput(n) && n.input.trigger("focus"), e.datepicker._curInst = n)
        },
        _updateDatepicker: function (t) {
            this.maxRows = 4, r = t, t.dpDiv.empty().append(this._generateHTML(t)), this._attachHandlers(t);
            var n, i = this._getNumberOfMonths(t), s = i[1], o = 17, a = t.dpDiv.find("." + this._dayOverClass + " a");
            a.length > 0 && u.apply(a.get(0)), t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""), s > 1 && t.dpDiv.addClass("ui-datepicker-multi-" + s).css("width", o * s + "em"), t.dpDiv[(i[0] !== 1 || i[1] !== 1 ? "add" : "remove") + "Class"]("ui-datepicker-multi"), t.dpDiv[(this._get(t, "isRTL") ? "add" : "remove") + "Class"]("ui-datepicker-rtl"), t === e.datepicker._curInst && e.datepicker._datepickerShowing && e.datepicker._shouldFocusInput(t) && t.input.trigger("focus"), t.yearshtml && (n = t.yearshtml, setTimeout(function () {
                n === t.yearshtml && t.yearshtml && t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml), n = t.yearshtml = null
            }, 0))
        },
        _shouldFocusInput: function (e) {
            return e.input && e.input.is(":visible") && !e.input.is(":disabled") && !e.input.is(":focus")
        },
        _checkOffset: function (t, n, r) {
            var i = t.dpDiv.outerWidth(), s = t.dpDiv.outerHeight(), o = t.input ? t.input.outerWidth() : 0,
                u = t.input ? t.input.outerHeight() : 0,
                a = document.documentElement.clientWidth + (r ? 0 : e(document).scrollLeft()),
                f = document.documentElement.clientHeight + (r ? 0 : e(document).scrollTop());
            return n.left -= this._get(t, "isRTL") ? i - o : 0, n.left -= r && n.left === t.input.offset().left ? e(document).scrollLeft() : 0, n.top -= r && n.top === t.input.offset().top + u ? e(document).scrollTop() : 0, n.left -= Math.min(n.left, n.left + i > a && a > i ? Math.abs(n.left + i - a) : 0), n.top -= Math.min(n.top, n.top + s > f && f > s ? Math.abs(s + u) : 0), n
        },
        _findPos: function (t) {
            var n = TerraExplorer.browser.isIE, r, i = this._getInst(t), s = this._get(i, "isRTL");
            if (!n) while (t && (t.type === "hidden" || t.nodeType !== 1 || e.expr.filters.hidden(t))) t = t[s ? "previousSibling" : "nextSibling"];
            return r = e(t).offset(), n && setTimeout(function () {
                e("#ui-datepicker-div").css("left", e(".toolDialog").css("left")), e("#ui-datepicker-div").css("top", "25%")
            }, 10), [r.left, r.top]
        },
        _hideDatepicker: function (t) {
            var n, r, i, s, o = this._curInst;
            if (!o || t && o !== e.data(t, "datepicker")) return;
            this._datepickerShowing && (n = this._get(o, "showAnim"), r = this._get(o, "duration"), i = function () {
                e.datepicker._tidyDialog(o)
            }, e.effects && (e.effects.effect[n] || e.effects[n]) ? o.dpDiv.hide(n, e.datepicker._get(o, "showOptions"), r, i) : o.dpDiv[n === "slideDown" ? "slideUp" : n === "fadeIn" ? "fadeOut" : "hide"](n ? r : null, i), n || i(), this._datepickerShowing = !1, s = this._get(o, "onClose"), s && s.apply(o.input ? o.input[0] : null, [o.input ? o.input.val() : "", o]), this._lastInput = null, this._inDialog && (this._dialogInput.css({
                position: "absolute",
                left: "0",
                top: "-100px"
            }), e.blockUI && (e.unblockUI(), e("body").append(this.dpDiv))), this._inDialog = !1)
        },
        _tidyDialog: function (e) {
            e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")
        },
        _checkExternalClick: function (t) {
            if (!e.datepicker._curInst) return;
            var n = e(t.target), r = e.datepicker._getInst(n[0]);
            n[0].id !== e.datepicker._mainDivId && n.parents("#" + e.datepicker._mainDivId).length === 0 && !n.hasClass(e.datepicker.markerClassName) && !n.closest("." + e.datepicker._triggerClass).length && e.datepicker._datepickerShowing && (!e.datepicker._inDialog || !e.blockUI) || n.hasClass(e.datepicker.markerClassName) && e.datepicker._curInst !== r
        },
        _adjustDate: function (t, n, r) {
            var i = e(t), s = this._getInst(i[0]);
            if (this._isDisabledDatepicker(i[0])) return;
            this._adjustInstDate(s, n + (r === "M" ? this._get(s, "showCurrentAtPos") : 0), r), this._updateDatepicker(s)
        },
        _gotoToday: function (t) {
            var n, r = e(t), i = this._getInst(r[0]);
            this._get(i, "gotoCurrent") && i.currentDay ? (i.selectedDay = i.currentDay, i.drawMonth = i.selectedMonth = i.currentMonth, i.drawYear = i.selectedYear = i.currentYear) : (n = new Date, i.selectedDay = n.getDate(), i.drawMonth = i.selectedMonth = n.getMonth(), i.drawYear = i.selectedYear = n.getFullYear()), this._notifyChange(i), this._adjustDate(r)
        },
        _selectMonthYear: function (t, n, r) {
            var i = e(t), s = this._getInst(i[0]);
            s["selected" + (r === "M" ? "Month" : "Year")] = s["draw" + (r === "M" ? "Month" : "Year")] = parseInt(n.options[n.selectedIndex].value, 10), this._notifyChange(s), this._adjustDate(i)
        },
        _selectDay: function (t, n, r, i) {
            var s, o = e(t);
            if (e(i).hasClass(this._unselectableClass) || this._isDisabledDatepicker(o[0])) return;
            s = this._getInst(o[0]), s.selectedDay = s.currentDay = e("a", i).html(), s.selectedMonth = s.currentMonth = n, s.selectedYear = s.currentYear = r, this._selectDate(t, this._formatDate(s, s.currentDay, s.currentMonth, s.currentYear))
        },
        _clearDate: function (t) {
            var n = e(t);
            this._selectDate(n, "")
        },
        _selectDate: function (t, n) {
            var r, i = e(t), s = this._getInst(i[0]);
            n = n != null ? n : this._formatDate(s), s.input && s.input.val(n), this._updateAlternate(s), r = this._get(s, "onSelect"), r ? r.apply(s.input ? s.input[0] : null, [n, s]) : s.input && s.input.trigger("change"), s.inline ? this._updateDatepicker(s) : (this._hideDatepicker(), this._lastInput = s.input[0], typeof s.input[0] != "object" && s.input.trigger("focus"), this._lastInput = null)
        },
        _updateAlternate: function (t) {
            var n, r, i, s = this._get(t, "altField");
            s && (n = this._get(t, "altFormat") || this._get(t, "dateFormat"), r = this._getDate(t), i = this.formatDate(n, r, this._getFormatConfig(t)), e(s).val(i))
        },
        noWeekends: function (e) {
            var t = e.getDay();
            return [t > 0 && t < 6, ""]
        },
        iso8601Week: function (e) {
            var t, n = new Date(e.getTime());
            return n.setDate(n.getDate() + 4 - (n.getDay() || 7)), t = n.getTime(), n.setMonth(0), n.setDate(1), Math.floor(Math.round((t - n) / 864e5) / 7) + 1
        },
        parseDate: function (t, n, r) {
            if (t == null || n == null) throw"Invalid arguments";
            n = typeof n == "object" ? n.toString() : n + "";
            if (n === "") return null;
            var i, s, o, u = 0, a = (r ? r.shortYearCutoff : null) || this._defaults.shortYearCutoff,
                f = typeof a != "string" ? a : (new Date).getFullYear() % 100 + parseInt(a, 10),
                l = (r ? r.dayNamesShort : null) || this._defaults.dayNamesShort,
                c = (r ? r.dayNames : null) || this._defaults.dayNames,
                h = (r ? r.monthNamesShort : null) || this._defaults.monthNamesShort,
                p = (r ? r.monthNames : null) || this._defaults.monthNames, d = -1, v = -1, m = -1, g = -1, y = !1, b,
                w = function (e) {
                    var n = i + 1 < t.length && t.charAt(i + 1) === e;
                    return n && i++, n
                }, E = function (e) {
                    var t = w(e), r = e === "@" ? 14 : e === "!" ? 20 : e === "y" && t ? 4 : e === "o" ? 3 : 2,
                        i = e === "y" ? r : 1, s = new RegExp("^\\d{" + i + "," + r + "}"), o = n.substring(u).match(s);
                    if (!o) throw"Missing number at position " + u;
                    return u += o[0].length, parseInt(o[0], 10)
                }, S = function (t, r, i) {
                    var s = -1, o = e.map(w(t) ? i : r, function (e, t) {
                        return [[t, e]]
                    }).sort(function (e, t) {
                        return -(e[1].length - t[1].length)
                    });
                    e.each(o, function (e, t) {
                        var r = t[1];
                        if (n.substr(u, r.length).toLowerCase() === r.toLowerCase()) return s = t[0], u += r.length, !1
                    });
                    if (s !== -1) return s + 1;
                    throw"Unknown name at position " + u
                }, x = function () {
                    if (n.charAt(u) !== t.charAt(i)) throw"Unexpected literal at position " + u;
                    u++
                };
            for (i = 0; i < t.length; i++) if (y) t.charAt(i) === "'" && !w("'") ? y = !1 : x(); else switch (t.charAt(i)) {
                case"d":
                    m = E("d");
                    break;
                case"D":
                    S("D", l, c);
                    break;
                case"o":
                    g = E("o");
                    break;
                case"m":
                    v = E("m");
                    break;
                case"M":
                    v = S("M", h, p);
                    break;
                case"y":
                    d = E("y");
                    break;
                case"@":
                    b = new Date(E("@")), d = b.getFullYear(), v = b.getMonth() + 1, m = b.getDate();
                    break;
                case"!":
                    b = new Date((E("!") - this._ticksTo1970) / 1e4), d = b.getFullYear(), v = b.getMonth() + 1, m = b.getDate();
                    break;
                case"'":
                    w("'") ? x() : y = !0;
                    break;
                default:
                    x()
            }
            if (u < n.length) {
                o = n.substr(u);
                if (!/^\s+/.test(o)) throw"Extra/unparsed characters found in date: " + o
            }
            d === -1 ? d = (new Date).getFullYear() : d < 100 && (d += (new Date).getFullYear() - (new Date).getFullYear() % 100 + (d <= f ? 0 : -100));
            if (g > -1) {
                v = 1, m = g;
                do {
                    s = this._getDaysInMonth(d, v - 1);
                    if (m <= s) break;
                    v++, m -= s
                } while (!0)
            }
            b = this._daylightSavingAdjust(new Date(d, v - 1, m));
            if (b.getFullYear() !== d || b.getMonth() + 1 !== v || b.getDate() !== m) throw"Invalid date";
            return b
        },
        ATOM: "yy-mm-dd",
        COOKIE: "D, dd M yy",
        ISO_8601: "yy-mm-dd",
        RFC_822: "D, d M y",
        RFC_850: "DD, dd-M-y",
        RFC_1036: "D, d M y",
        RFC_1123: "D, d M yy",
        RFC_2822: "D, d M yy",
        RSS: "D, d M y",
        TICKS: "!",
        TIMESTAMP: "@",
        W3C: "yy-mm-dd",
        _ticksTo1970: (718685 + Math.floor(492.5) - Math.floor(19.7) + Math.floor(4.925)) * 24 * 60 * 60 * 1e7,
        formatDate: function (e, t, n) {
            if (!t) return "";
            var r, i = (n ? n.dayNamesShort : null) || this._defaults.dayNamesShort,
                s = (n ? n.dayNames : null) || this._defaults.dayNames,
                o = (n ? n.monthNamesShort : null) || this._defaults.monthNamesShort,
                u = (n ? n.monthNames : null) || this._defaults.monthNames, a = function (t) {
                    var n = r + 1 < e.length && e.charAt(r + 1) === t;
                    return n && r++, n
                }, f = function (e, t, n) {
                    var r = "" + t;
                    if (a(e)) while (r.length < n) r = "0" + r;
                    return r
                }, l = function (e, t, n, r) {
                    return a(e) ? r[t] : n[t]
                }, c = "", h = !1;
            if (t) for (r = 0; r < e.length; r++) if (h) e.charAt(r) === "'" && !a("'") ? h = !1 : c += e.charAt(r); else switch (e.charAt(r)) {
                case"d":
                    c += f("d", t.getDate(), 2);
                    break;
                case"D":
                    c += l("D", t.getDay(), i, s);
                    break;
                case"o":
                    c += f("o", Math.round(((new Date(t.getFullYear(), t.getMonth(), t.getDate())).getTime() - (new Date(t.getFullYear(), 0, 0)).getTime()) / 864e5), 3);
                    break;
                case"m":
                    c += f("m", t.getMonth() + 1, 2);
                    break;
                case"M":
                    c += l("M", t.getMonth(), o, u);
                    break;
                case"y":
                    c += a("y") ? t.getFullYear() : (t.getFullYear() % 100 < 10 ? "0" : "") + t.getFullYear() % 100;
                    break;
                case"@":
                    c += t.getTime();
                    break;
                case"!":
                    c += t.getTime() * 1e4 + this._ticksTo1970;
                    break;
                case"'":
                    a("'") ? c += "'" : h = !0;
                    break;
                default:
                    c += e.charAt(r)
            }
            return c
        },
        _possibleChars: function (e) {
            var t, n = "", r = !1, i = function (n) {
                var r = t + 1 < e.length && e.charAt(t + 1) === n;
                return r && t++, r
            };
            for (t = 0; t < e.length; t++) if (r) e.charAt(t) === "'" && !i("'") ? r = !1 : n += e.charAt(t); else switch (e.charAt(t)) {
                case"d":
                case"m":
                case"y":
                case"@":
                    n += "0123456789";
                    break;
                case"D":
                case"M":
                    return null;
                case"'":
                    i("'") ? n += "'" : r = !0;
                    break;
                default:
                    n += e.charAt(t)
            }
            return n
        },
        _get: function (e, t) {
            return e.settings[t] !== undefined ? e.settings[t] : this._defaults[t]
        },
        _setDateFromField: function (e, t) {
            if (e.input.val() === e.lastVal) return;
            var n = this._get(e, "dateFormat"), r = e.lastVal = e.input ? e.input.val() : null,
                i = this._getDefaultDate(e), s = i, o = this._getFormatConfig(e);
            try {
                s = this.parseDate(n, r, o) || i
            } catch (u) {
                r = t ? "" : r
            }
            e.selectedDay = s.getDate(), e.drawMonth = e.selectedMonth = s.getMonth(), e.drawYear = e.selectedYear = s.getFullYear(), e.currentDay = r ? s.getDate() : 0, e.currentMonth = r ? s.getMonth() : 0, e.currentYear = r ? s.getFullYear() : 0, this._adjustInstDate(e)
        },
        _getDefaultDate: function (e) {
            return this._restrictMinMax(e, this._determineDate(e, this._get(e, "defaultDate"), new Date))
        },
        _determineDate: function (t, n, r) {
            var i = function (e) {
                    var t = new Date;
                    return t.setDate(t.getDate() + e), t
                }, s = function (n) {
                    try {
                        return e.datepicker.parseDate(e.datepicker._get(t, "dateFormat"), n, e.datepicker._getFormatConfig(t))
                    } catch (r) {
                    }
                    var i = (n.toLowerCase().match(/^c/) ? e.datepicker._getDate(t) : null) || new Date,
                        s = i.getFullYear(), o = i.getMonth(), u = i.getDate(), a = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
                        f = a.exec(n);
                    while (f) {
                        switch (f[2] || "d") {
                            case"d":
                            case"D":
                                u += parseInt(f[1], 10);
                                break;
                            case"w":
                            case"W":
                                u += parseInt(f[1], 10) * 7;
                                break;
                            case"m":
                            case"M":
                                o += parseInt(f[1], 10), u = Math.min(u, e.datepicker._getDaysInMonth(s, o));
                                break;
                            case"y":
                            case"Y":
                                s += parseInt(f[1], 10), u = Math.min(u, e.datepicker._getDaysInMonth(s, o))
                        }
                        f = a.exec(n)
                    }
                    return new Date(s, o, u)
                },
                o = n == null || n === "" ? r : typeof n == "string" ? s(n) : typeof n == "number" ? isNaN(n) ? r : i(n) : new Date(n.getTime());
            return o = o && o.toString() === "Invalid Date" ? r : o, o && (o.setHours(0), o.setMinutes(0), o.setSeconds(0), o.setMilliseconds(0)), this._daylightSavingAdjust(o)
        },
        _daylightSavingAdjust: function (e) {
            return e ? (e.setHours(e.getHours() > 12 ? e.getHours() + 2 : 0), e) : null
        },
        _setDate: function (e, t, n) {
            var r = !t, i = e.selectedMonth, s = e.selectedYear,
                o = this._restrictMinMax(e, this._determineDate(e, t, new Date));
            e.selectedDay = e.currentDay = o.getDate(), e.drawMonth = e.selectedMonth = e.currentMonth = o.getMonth(), e.drawYear = e.selectedYear = e.currentYear = o.getFullYear(), (i !== e.selectedMonth || s !== e.selectedYear) && !n && this._notifyChange(e), this._adjustInstDate(e), e.input && e.input.val(r ? "" : this._formatDate(e))
        },
        _getDate: function (e) {
            var t = !e.currentYear || e.input && e.input.val() === "" ? null : this._daylightSavingAdjust(new Date(e.currentYear, e.currentMonth, e.currentDay));
            return t
        },
        _attachHandlers: function (t) {
            var n = this._get(t, "stepMonths"), r = "#" + t.id.replace(/\\\\/g, "\\");
            t.dpDiv.find("[data-handler]").map(function () {
                var t = {
                    prev: function () {
                        e.datepicker._adjustDate(r, -n, "M")
                    }, next: function () {
                        e.datepicker._adjustDate(r, +n, "M")
                    }, hide: function () {
                        e.datepicker._hideDatepicker()
                    }, today: function () {
                        e.datepicker._gotoToday(r)
                    }, selectDay: function () {
                        return e.datepicker._selectDay(r, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this), !1
                    }, selectMonth: function () {
                        return e.datepicker._selectMonthYear(r, this, "M"), !1
                    }, selectYear: function () {
                        return e.datepicker._selectMonthYear(r, this, "Y"), !1
                    }
                };
                e(this).on(this.getAttribute("data-event"), t[this.getAttribute("data-handler")])
            })
        },
        _generateHTML: function (e) {
            var t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b, w, E, S, x, T, N, C, k, L, A, O, M, _, D, P, H,
                B, j, F, I, q = new Date,
                R = this._daylightSavingAdjust(new Date(q.getFullYear(), q.getMonth(), q.getDate())),
                U = this._get(e, "isRTL"), z = this._get(e, "showButtonPanel"), W = this._get(e, "hideIfNoPrevNext"),
                X = this._get(e, "navigationAsDateFormat"), V = this._getNumberOfMonths(e),
                $ = this._get(e, "showCurrentAtPos"), J = this._get(e, "stepMonths"), K = V[0] !== 1 || V[1] !== 1,
                Q = this._daylightSavingAdjust(e.currentDay ? new Date(e.currentYear, e.currentMonth, e.currentDay) : new Date(9999, 9, 9)),
                G = this._getMinMaxDate(e, "min"), Y = this._getMinMaxDate(e, "max"), Z = e.drawMonth - $,
                et = e.drawYear;
            Z < 0 && (Z += 12, et--);
            if (Y) {
                t = this._daylightSavingAdjust(new Date(Y.getFullYear(), Y.getMonth() - V[0] * V[1] + 1, Y.getDate())), t = G && t < G ? G : t;
                while (this._daylightSavingAdjust(new Date(et, Z, 1)) > t) Z--, Z < 0 && (Z = 11, et--)
            }
            e.drawMonth = Z, e.drawYear = et, n = this._get(e, "prevText"), n = X ? this.formatDate(n, this._daylightSavingAdjust(new Date(et, Z - J, 1)), this._getFormatConfig(e)) : n, r = this._canAdjustMonth(e, -1, et, Z) ? "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='" + n + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "e" : "w") + "'>" + n + "</span></a>" : W ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + n + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "e" : "w") + "'>" + n + "</span></a>", i = this._get(e, "nextText"), i = X ? this.formatDate(i, this._daylightSavingAdjust(new Date(et, Z + J, 1)), this._getFormatConfig(e)) : i, s = this._canAdjustMonth(e, 1, et, Z) ? "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "w" : "e") + "'>" + i + "</span></a>" : W ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (U ? "w" : "e") + "'>" + i + "</span></a>", o = this._get(e, "currentText"), u = this._get(e, "gotoCurrent") && e.currentDay ? Q : R, o = X ? this.formatDate(o, u, this._getFormatConfig(e)) : o, a = e.inline ? "" : "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" + this._get(e, "closeText") + "</button>", f = z ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (U ? a : "") + (this._isInRange(e, u) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>" + o + "</button>" : "") + (U ? "" : a) + "</div>" : "", l = parseInt(this._get(e, "firstDay"), 10), l = isNaN(l) ? 0 : l, c = this._get(e, "showWeek"), h = this._get(e, "dayNames"), p = this._get(e, "dayNamesMin"), d = this._get(e, "monthNames"), v = this._get(e, "monthNamesShort"), m = this._get(e, "beforeShowDay"), g = this._get(e, "showOtherMonths"), y = this._get(e, "selectOtherMonths"), b = this._getDefaultDate(e), w = "";
            for (S = 0; S < V[0]; S++) {
                x = "", this.maxRows = 4;
                for (T = 0; T < V[1]; T++) {
                    N = this._daylightSavingAdjust(new Date(et, Z, e.selectedDay)), C = " ui-corner-all", k = "";
                    if (K) {
                        k += "<div class='ui-datepicker-group";
                        if (V[1] > 1) switch (T) {
                            case 0:
                                k += " ui-datepicker-group-first", C = " ui-corner-" + (U ? "right" : "left");
                                break;
                            case V[1] - 1:
                                k += " ui-datepicker-group-last", C = " ui-corner-" + (U ? "left" : "right");
                                break;
                            default:
                                k += " ui-datepicker-group-middle", C = ""
                        }
                        k += "'>"
                    }
                    k += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + C + "'>" + (/all|left/.test(C) && S === 0 ? U ? s : r : "") + (/all|right/.test(C) && S === 0 ? U ? r : s : "") + this._generateMonthYearHeader(e, Z, et, G, Y, S > 0 || T > 0, d, v) + "</div><table class='ui-datepicker-calendar'><thead>" + "<tr>", L = c ? "<th class='ui-datepicker-week-col'>" + this._get(e, "weekHeader") + "</th>" : "";
                    for (E = 0; E < 7; E++) A = (E + l) % 7, L += "<th scope='col'" + ((E + l + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + ">" + "<span title='" + h[A] + "'>" + p[A] + "</span></th>";
                    k += L + "</tr></thead><tbody>", O = this._getDaysInMonth(et, Z), et === e.selectedYear && Z === e.selectedMonth && (e.selectedDay = Math.min(e.selectedDay, O)), M = (this._getFirstDayOfMonth(et, Z) - l + 7) % 7, _ = Math.ceil((M + O) / 7), D = K ? this.maxRows > _ ? this.maxRows : _ : _, this.maxRows = D, P = this._daylightSavingAdjust(new Date(et, Z, 1 - M));
                    for (H = 0; H < D; H++) {
                        k += "<tr>", B = c ? "<td class='ui-datepicker-week-col'>" + this._get(e, "calculateWeek")(P) + "</td>" : "";
                        for (E = 0; E < 7; E++) j = m ? m.apply(e.input ? e.input[0] : null, [P]) : [!0, ""], F = P.getMonth() !== Z, I = F && !y || !j[0] || G && P < G || Y && P > Y, B += "<td class='" + ((E + l + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + (F ? " ui-datepicker-other-month" : "") + (P.getTime() === N.getTime() && Z === e.selectedMonth && e._keyEvent || b.getTime() === P.getTime() && b.getTime() === N.getTime() ? " " + this._dayOverClass : "") + (I ? " " + this._unselectableClass + " ui-state-disabled" : "") + (F && !g ? "" : " " + j[1] + (P.getTime() === Q.getTime() ? " " + this._currentClass : "") + (P.getTime() === R.getTime() ? " ui-datepicker-today" : "")) + "'" + ((!F || g) && j[2] ? " title='" + j[2].replace(/'/g, "&#39;") + "'" : "") + (I ? "" : " data-handler='selectDay' data-event='click' data-month='" + P.getMonth() + "' data-year='" + P.getFullYear() + "'") + ">" + (F && !g ? "&#xa0;" : I ? "<span class='ui-state-default'>" + P.getDate() + "</span>" : "<a class='ui-state-default" + (P.getTime() === R.getTime() ? " ui-state-highlight" : "") + (P.getTime() === Q.getTime() ? " ui-state-active" : "") + (F ? " ui-priority-secondary" : "") + "' href='#'>" + P.getDate() + "</a>") + "</td>", P.setDate(P.getDate() + 1), P = this._daylightSavingAdjust(P);
                        k += B + "</tr>"
                    }
                    Z++, Z > 11 && (Z = 0, et++), k += "</tbody></table>" + (K ? "</div>" + (V[0] > 0 && T === V[1] - 1 ? "<div class='ui-datepicker-row-break'></div>" : "") : ""), x += k
                }
                w += x
            }
            return w += f, e._keyEvent = !1, w
        },
        _generateMonthYearHeader: function (e, t, n, r, i, s, o, u) {
            var a, f, l, c, h, p, d, v, m = this._get(e, "changeMonth"), g = this._get(e, "changeYear"),
                y = this._get(e, "showMonthAfterYear"), b = "<div class='ui-datepicker-title'>", w = "";
            if (s || !m) w += "<span class='ui-datepicker-month'>" + o[t] + "</span>"; else {
                a = r && r.getFullYear() === n, f = i && i.getFullYear() === n, w += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";
                for (l = 0; l < 12; l++) (!a || l >= r.getMonth()) && (!f || l <= i.getMonth()) && (w += "<option value='" + l + "'" + (l === t ? " selected='selected'" : "") + ">" + u[l] + "</option>");
                w += "</select>"
            }
            y || (b += w + (s || !m || !g ? "&#xa0;" : ""));
            if (!e.yearshtml) {
                e.yearshtml = "";
                if (s || !g) b += "<span class='ui-datepicker-year'>" + n + "</span>"; else {
                    c = this._get(e, "yearRange").split(":"), h = (new Date).getFullYear(), p = function (e) {
                        var t = e.match(/c[+\-].*/) ? n + parseInt(e.substring(1), 10) : e.match(/[+\-].*/) ? h + parseInt(e, 10) : parseInt(e, 10);
                        return isNaN(t) ? h : t
                    }, d = p(c[0]), v = Math.max(d, p(c[1] || "")), d = r ? Math.max(d, r.getFullYear()) : d, v = i ? Math.min(v, i.getFullYear()) : v, e.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";
                    for (; d <= v; d++) e.yearshtml += "<option value='" + d + "'" + (d === n ? " selected='selected'" : "") + ">" + d + "</option>";
                    e.yearshtml += "</select>", b += e.yearshtml, e.yearshtml = null
                }
            }
            return b += this._get(e, "yearSuffix"), y && (b += (s || !m || !g ? "&#xa0;" : "") + w), b += "</div>", b
        },
        _adjustInstDate: function (e, t, n) {
            var r = e.selectedYear + (n === "Y" ? t : 0), i = e.selectedMonth + (n === "M" ? t : 0),
                s = Math.min(e.selectedDay, this._getDaysInMonth(r, i)) + (n === "D" ? t : 0),
                o = this._restrictMinMax(e, this._daylightSavingAdjust(new Date(r, i, s)));
            e.selectedDay = o.getDate(), e.drawMonth = e.selectedMonth = o.getMonth(), e.drawYear = e.selectedYear = o.getFullYear(), (n === "M" || n === "Y") && this._notifyChange(e)
        },
        _restrictMinMax: function (e, t) {
            var n = this._getMinMaxDate(e, "min"), r = this._getMinMaxDate(e, "max"), i = n && t < n ? n : t;
            return r && i > r ? r : i
        },
        _notifyChange: function (e) {
            var t = this._get(e, "onChangeMonthYear");
            t && t.apply(e.input ? e.input[0] : null, [e.selectedYear, e.selectedMonth + 1, e])
        },
        _getNumberOfMonths: function (e) {
            var t = this._get(e, "numberOfMonths");
            return t == null ? [1, 1] : typeof t == "number" ? [1, t] : t
        },
        _getMinMaxDate: function (e, t) {
            return this._determineDate(e, this._get(e, t + "Date"), null)
        },
        _getDaysInMonth: function (e, t) {
            return 32 - this._daylightSavingAdjust(new Date(e, t, 32)).getDate()
        },
        _getFirstDayOfMonth: function (e, t) {
            return (new Date(e, t, 1)).getDay()
        },
        _canAdjustMonth: function (e, t, n, r) {
            var i = this._getNumberOfMonths(e),
                s = this._daylightSavingAdjust(new Date(n, r + (t < 0 ? t : i[0] * i[1]), 1));
            return t < 0 && s.setDate(this._getDaysInMonth(s.getFullYear(), s.getMonth())), this._isInRange(e, s)
        },
        _isInRange: function (e, t) {
            var n, r, i = this._getMinMaxDate(e, "min"), s = this._getMinMaxDate(e, "max"), o = null, u = null,
                a = this._get(e, "yearRange");
            return a && (n = a.split(":"), r = (new Date).getFullYear(), o = parseInt(n[0], 10), u = parseInt(n[1], 10), n[0].match(/[+\-].*/) && (o += r), n[1].match(/[+\-].*/) && (u += r)), (!i || t.getTime() >= i.getTime()) && (!s || t.getTime() <= s.getTime()) && (!o || t.getFullYear() >= o) && (!u || t.getFullYear() <= u)
        },
        _getFormatConfig: function (e) {
            var t = this._get(e, "shortYearCutoff");
            return t = typeof t != "string" ? t : (new Date).getFullYear() % 100 + parseInt(t, 10), {
                shortYearCutoff: t,
                dayNamesShort: this._get(e, "dayNamesShort"),
                dayNames: this._get(e, "dayNames"),
                monthNamesShort: this._get(e, "monthNamesShort"),
                monthNames: this._get(e, "monthNames")
            }
        },
        _formatDate: function (e, t, n, r) {
            t || (e.currentDay = e.selectedDay, e.currentMonth = e.selectedMonth, e.currentYear = e.selectedYear);
            var i = t ? typeof t == "object" ? t : this._daylightSavingAdjust(new Date(r, n, t)) : this._daylightSavingAdjust(new Date(e.currentYear, e.currentMonth, e.currentDay));
            return this.formatDate(this._get(e, "dateFormat"), i, this._getFormatConfig(e))
        }
    }), e.fn.datepicker = function (t) {
        if (!this.length) return this;
        e.datepicker.initialized || (e(document).on("mousedown", e.datepicker._checkExternalClick), e.datepicker.initialized = !0), e("#" + e.datepicker._mainDivId).length === 0 && e("body").append(e.datepicker.dpDiv);
        var n = Array.prototype.slice.call(arguments, 1);
        return typeof t != "string" || t !== "isDisabled" && t !== "getDate" && t !== "widget" ? t === "option" && arguments.length === 2 && typeof arguments[1] == "string" ? e.datepicker["_" + t + "Datepicker"].apply(e.datepicker, [this[0]].concat(n)) : this.each(function () {
            typeof t == "string" ? e.datepicker["_" + t + "Datepicker"].apply(e.datepicker, [this].concat(n)) : e.datepicker._attachDatepicker(this, t)
        }) : e.datepicker["_" + t + "Datepicker"].apply(e.datepicker, [this[0]].concat(n))
    }, e.datepicker = new s, e.datepicker.initialized = !1, e.datepicker.uuid = (new Date).getTime(), e.datepicker.version = "1.12.0";
    var f = e.datepicker
}), define("internal/FixedLocalTime", ["jquery", "TELang"], function (e, t) {
    "use strict";
    var n = null, r = function () {
        this._enable = !1, this._fixedHour = 11, this._currentDate, this._fixedMinutes = 0
    };
    return Cesium.defineProperties(r.prototype, {
        Enable: {
            get: function () {
                return this._enable
            }, set: function (e) {
                this._enable = !!e
            }
        }, Hour: {
            get: function () {
                return this._fixedHour
            }, set: function (e) {
                if (e < 0 || e > 95 || isNaN(e)) return;
                this._fixedHour = e
            }
        }, Minute: {
            get: function () {
                return this._fixedMinutes
            }, set: function (e) {
                if (isNaN(e) || e < 0 || e > 60) return;
                this._fixedMinutes = e
            }
        }, CurrentDate: {
            get: function () {
                return this._currentDate
            }, set: function (e) {
                if (!(e instanceof Date)) return;
                this._currentDate = e
            }
        }
    }), r.prototype.init = function () {
        viewer.scene.preRender.addEventListener(this.onPreFrame, this)
    }, r.prototype.onPreFrame = function (e, t) {
        if (!this._enable) return;
        Cesium.defined(this._currentDate) || (this._currentDate = new Date);
        var n = new Date(this._currentDate.getFullYear(), this._currentDate.getMonth(), this._currentDate.getDate(), this._fixedHour, this._fixedMinutes),
            r = Cesium.JulianDate.fromDate(n),
            i = 15 * Cesium.Math.toDegrees(viewer.camera.positionCartographic.longitude) / 3.75,
            s = Cesium.JulianDate.addMinutes(r, -i, Cesium.JulianDate.now());
        Cesium.JulianDate.addMinutes(s, -this._currentDate.getTimezoneOffset(), viewer.clock.currentTime)
    }, n = new r, n
}), define("tools/TETools/ShadowTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "./FavoritesStorage", "../ToolDelegate", "../ToolContainer", "internal/SearchBox", "internal/Navigate", "internal/NotificationCenter", "internal/GeometryHelper", "internal/InputMode", "tools/ToolDialog", "internal/datePicker", "internal/FixedLocalTime"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v) {
    "use strict";

    function m() {
        this._isOpen = !1, this._explanationTextOnStartOnly = !0, this._explanationText = "Click the shadow button to toggle shadow display. Use the slider and calendar to set the date and time.", this._toolContainerText = "", this._currentDate = new Date, this._isCalendarTitlePressed = !1, this._slider = null, this._sliderText = "", this._isSliderClicked = !1, this._isShadowTurnedOn = !1, this._terrainImageryLayer = viewer.scene.imageryLayers._layers[0], this._imageryLayers = viewer.scene.imageryLayers._layers, this.getId = function () {
            return "ShadowTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Shadow"), "./img/newDesign/shadow.png", 1, r.MenuEntryAnalyze(), t.i18n("TerrainAnalysis_Header"), !0)
        }, this.open = function () {
            this.terrainShadowToggle()
        }, this._eventListener = null
    }

    Cesium.defineProperties(m.prototype, {
        IsOpen: {
            get: function () {
                return this._isShadowTurnedOn
            }, set: function (e) {
                this._isOpen = e
            }
        }
    }), m.prototype.onOpenedToolContainer = function () {
        this._explanationTextOnStartOnly = !1, g = new Date(v.CurrentDate), e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Time"))
    };
    var g, y = 0;
    return m.prototype.handleSliderChanged = function (e) {
        g != null && (this._currentDate = new Date(g)), this._isSliderClicked = !0;
        if (e.target.value > 95 || e.target.value < 0) return;
        var t = e.target.value, n = Math.floor(t / 4), r = t % 4 * 15;
        v.Hour = n, v.Minute = r, this.UpdateText(n)
    }, m.prototype.changeBrightnessToAllImageryLayers = function (e) {
        var t = this._imageryLayers.length;
        for (var n = 0; n < t; n++) this._imageryLayers[n].brightness = e;
        viewer.scene.brightnessValue = e
    }, m.prototype.dictateTheBrightnessValue = function (e) {
        if (e < 20 || e > 82) this.changeBrightnessToAllImageryLayers(.2); else if (e >= 20 && e <= 30) {
            var t = Cesium.Math.lerp(0, 10, e - 20) / 100 * .8 + .2;
            this.changeBrightnessToAllImageryLayers(t)
        } else if (e >= 72 && e <= 82) {
            var t = 1 - Cesium.Math.lerp(0, 10, e - 72) / 100 * .8;
            this.changeBrightnessToAllImageryLayers(t)
        } else e < 72 && e > 30 && this.changeBrightnessToAllImageryLayers(1)
    }, m.prototype.handleSliderMoved = function (e) {
        if (this._isSliderClicked) {
            if (e.target.value > 95 || e.target.value < 0) return;
            var t = e.target.value;
            this._isShadowTurnedOn && this.dictateTheBrightnessValue(t);
            var n = this;
            setTimeout(function () {
                var e = Math.floor(t / 4), r = t % 4 * 15;
                v.Hour = e, v.Minute = r, n.UpdateText(e)
            }, 300)
        }
    }, m.prototype.IsShadow = function () {
        return viewer.shadows == Cesium.ShadowMode.ENABLED ? !0 : !1
    }, m.prototype.UpdateText = function (e) {
        var n = e > 11 ? " PM" : " AM", r = this._currentDate.getFullYear(), i = this._currentDate.getMonth() + 1,
            s = this._currentDate.getDate();
        e = e.toString(), s = s.toString(), s.length == 1 && (s = "0" + s), i = i.toString(), i.length == 1 && (i = "0" + i), e = e % 12 == 0 ? 12 : e % 12, this._toolContainerText = t.i18n("Date") + " " + +i + "/" + s + "/" + r, this._toolContainerText += "</br>" + t.i18n("Hour") + " " + e + n, this._toolContainer.setText(this._toolContainerText)
    }, m.prototype.handleSliderUp = function (e) {
        this._isSliderClicked = !1
    }, m.prototype.openDatePicker = function () {
        var n = this;
        if (p.IsOpen) p.close(); else {
            var r = e("<div id='CalendarDivId' style='position:absolute;overflow:hidden; width:307px; height:100px;'></div>"),
                i = e("<div id='datepickerDiv'><input type='text' id='datepicker' size=1 style='border:none;'/></div>");
            r.append(i), p.open(t.i18n("Calendar"), "./img/date.png", r, this.onCloseDialogCalendar, !1, !1, !0), e("link[href='./css/jquery-ui.min.css']").length > 0 && (document.querySelector("link[href='./css/jquery-ui.min.css']").href = "./css/datePicker.css");
            var s = e("#cesiumContainer").width() * .4;
            e(".toolDialog").css({top: "20%", left: s}), e("#datepicker").datepicker({
                inline: !0,
                onSelect: function (e) {
                    n._currentDate = e, v.CurrentDate = new Date(e), viewer.clock.currentTime = new Date(e), g = e, n._toolContainer.setText("Date: " + e), this._isCalendarTitlePressed = !0
                },
                onClose: function () {
                    p.close(), e(".toolDialog #closeXID").click(), this._isCalendarTitlePressed = !0, document.querySelector("link[href='./css/datePicker.css']").href = "./css/jquery-ui.min.css"
                }
            }), e("#datepicker").datepicker("setDate", g), setTimeout(function () {
                e("#datepicker").show().focus().hide()
            }, 10), r.css({top: 20}), e(".toolDialogTitle").on("mousedown", function () {
                return !1
            }), e(".toolDialog").removeClass("ui-resizable"), setTimeout(function () {
                e(".toolDialog").width("276"), e(".toolDialog").height("170"), e(".toolDialogTitle").css("z-index", "1000"), e(".toolDialog #closeXID").css("z-index", "1001")
            }, 50)
        }
    }, m.prototype.onCloseDialogCalendar = function () {
        e("#datepicker").datepicker("hide")
    }, m.prototype.onBeforeOpenToolContainer = function () {
        setTimeout(function () {
            e("link[href='./css/jquery-ui.min.css']").length > 0 && (document.querySelector("link[href='./css/jquery-ui.min.css']").href = "./css/datePicker.css")
        }, 500), h.Mode = h.MEASUREMENT, this.IsOpen = !0, e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this.parent.onBeforeOpenToolContainer.call(this), e("#TextView").length > 0 && e("#TextView").empty(), this._toolContainer.setText(this._toolContainerText), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText);
        var n = TerraExplorer.internal.FixedLocalTime.Hour, r = TerraExplorer.internal.FixedLocalTime.Minute,
            i = TerraExplorer.internal.FixedLocalTime.Hour * 4 + r / 15;
        return this._toolContainer.addSlider(0, 95, 1, i), e("#sliderId").on("touchstart", e.proxy(this.handleSliderChanged, this)), e("#sliderId").on("touchmove", e.proxy(this.handleSliderMoved, this)), e("#sliderId").on("touchend", e.proxy(this.handleSliderUp, this)), e("#sliderId").mousedown(e.proxy(this.handleSliderChanged, this)), e("#sliderId").mousemove(e.proxy(this.handleSliderMoved, this)), e("#sliderId").mouseup(e.proxy(this.handleSliderUp, this)), e("#sliderId").keydown(e.proxy(this.handleSliderChanged, this)), this._toolContainer.addButton("datePicker", "./img/date.png", undefined, t.i18n("Shadow_DateHour_ToolTIp")), this.IsShadow() ? this.enableShadowButton() : this.disableShadowButton(), !0
    }, m.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0
    }, m.prototype.setShadowToggleEffect = function (t) {
        var n = this._toolContainer.getText();
        e("#TextView").empty(), e("#TextView").removeClass("explanation"), e("#TextView").animate({opacity: 0}, function () {
            e(this).text(t).animate({opacity: 1})
        })
    }, m.prototype.enableShadow = function () {
        this._isShadowTurnedOn = !0, viewer.shadows = Cesium.ShadowMode.ENABLED, viewer.terrainShadows = Cesium.ShadowMode.ENABLED, viewer.scene.globe.enableLighting = !0, viewer.scene.brightnessValue = 1, this._toolContainer && (this._toolContainer.updateButton("shadowToggle", "./img/shadowHouse2.png"), this.setShadowToggleEffect(t.i18n("shadow_mode_on")), e("#shadowToggle").addClass("containerToggleButton"))
    }, m.prototype.disableShadow = function () {
        this._isShadowTurnedOn = !1, this.changeBrightnessToAllImageryLayers(1), viewer.shadows = Cesium.ShadowMode.DISABLED, viewer.terrainShadows = Cesium.ShadowMode.DISABLED, viewer.scene.globe.enableLighting = !1, viewer.scene.brightnessValue = undefined, this._toolContainer && (this._toolContainer.updateButton("shadowToggle", "./img/shadowHouse.png"), this.setShadowToggleEffect(t.i18n("shadow_mode_off")), e("#shadowToggle").removeClass("containerToggleButton"))
    }, m.prototype.enableShadowButton = function () {
        this._toolContainer.updateButton("shadowToggle", "./img/shadowHouse2.png"), this.setShadowToggleEffect(t.i18n("shadow_mode_on")), e("#shadowToggle").addClass("containerToggleButton")
    }, m.prototype.disableShadowButton = function () {
        this._toolContainer.updateButton("shadowToggle", "./img/shadowHouse.png"), this.setShadowToggleEffect(t.i18n("shadow_mode_off")), e("#shadowToggle").removeClass("containerToggleButton")
    }, m.prototype.terrainShadowToggle = function () {
        if (viewer.shadows == Cesium.ShadowMode.DISABLED) {
            var t = viewer.scene.primitives._primitives, n = t.length;
            for (var r = 0; r < n; ++r) Cesium.defined(t[r].shadows) && t[r].shadows == Cesium.ShadowMode.DISABLED && t[r].appearance.constructor.name == "PerInstanceColorAppearance" && (t[r].shadows = Cesium.ShadowMode.ENABLED);
            this.enableShadow(), TerraExplorer.activeGlobalStates[this.getId()] = !0;
            var i = TerraExplorer.internal.FixedLocalTime.Hour * 4;
            this.dictateTheBrightnessValue(i)
        } else viewer.shadows == Cesium.ShadowMode.ENABLED && (e("#checkImageSubHeaderShadow").remove(), this.disableShadow(), TerraExplorer.activeGlobalStates[this.getId()] = !1);
        TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
    }, m.prototype.checked = function (e) {
        try {
            this.onButtonClick("shadowToggle")
        } catch (t) {
        }
    }, m.prototype.openConfig = function () {
        setTimeout(function () {
            TerraExplorer.tools.ToolContainer.showWithDelegate(TerraExplorer.tools.ToolManager._tools.ShadowTool, function () {
            })
        }, 100)
    }, m.prototype.onButtonClick = function (t) {
        this.parent.onButtonClick.call(this, t);
        switch (t) {
            case"datePicker":
                e("#TextView").empty(), this.openDatePicker();
                break;
            case"shadowToggle":
                this.terrainShadowToggle()
        }
    }, m.prototype.onBeforeCloseToolContainer = function (t) {
        return this.parent.onBeforeCloseToolContainer.call(this, t), e(".toolDialog #closeXID").length > 0 && e(".toolDialog #closeXID")[0].click(), setTimeout(function () {
            e("link[href='./css/datePicker.css']").length > 0 && (document.querySelector("link[href='./css/datePicker.css']").href = "./css/jquery-ui.min.css")
        }, 500), this.IsOpen = !1, h.Mode = h.FREE_FLIGHT, f.stop(), !0
    }, m
}), define("tools/TETools/TimeTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "./FavoritesStorage", "../ToolDelegate", "../ToolContainer", "internal/SearchBox", "internal/Navigate", "internal/NotificationCenter", "internal/GeometryHelper", "internal/InputMode", "tools/ToolDialog", "internal/datePicker", "internal/FixedLocalTime"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v) {
    "use strict";

    function m() {
        this._isOpen = !1, this._explanationTextOnStartOnly = !0, this._explanationText = t.i18n("anaylsis_time_explanation_text"), this._toolContainerText = "", this._currentDate = new Date, this._isCalendarTitlePressed = !1, this._slider = null, this._sliderText = "", this._isSliderClicked = !1, this._isShadowTurnedOn = !1, this._terrainImageryLayer = viewer.scene.imageryLayers._layers[0], this._imageryLayers = viewer.scene.imageryLayers._layers, this.getId = function () {
            return "TimeTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Time"), "./img/newDesign/bt_time.png", 30, r.MenuEntryAnalyze(), t.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }, this._eventListener = null
    }

    m.inheritsFrom(o), Cesium.defineProperties(m.prototype, {
        IsOpen: {
            get: function () {
                return this._isShadowTurnedOn
            }, set: function (e) {
                this._isOpen = e
            }
        }
    }), m.prototype.onOpenedToolContainer = function () {
        this._explanationTextOnStartOnly = !1, g = new Date(v.CurrentDate), e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Time"))
    };
    var g, y = 0;
    return m.prototype.handleSliderChanged = function (e) {
        g != null && (this._currentDate = new Date(g)), this._isSliderClicked = !0;
        if (e.target.value > 95 || e.target.value < 0) return;
        var t = e.target.value, n = Math.floor(t / 4), r = t % 4 * 15;
        v.Hour = n, v.Minute = r, this.UpdateText(n)
    }, m.prototype.changeBrightnessToAllImageryLayers = function (e) {
        var t = this._imageryLayers.length;
        for (var n = 0; n < t; n++) this._imageryLayers[n].brightness = e;
        viewer.scene.brightnessValue = e
    }, m.prototype.dictateTheBrightnessValue = function (e) {
        if (e < 20 || e > 82) this.changeBrightnessToAllImageryLayers(.2); else if (e >= 20 && e <= 30) {
            var t = Cesium.Math.lerp(0, 10, e - 20) / 100 * .8 + .2;
            this.changeBrightnessToAllImageryLayers(t)
        } else if (e >= 72 && e <= 82) {
            var t = 1 - Cesium.Math.lerp(0, 10, e - 72) / 100 * .8;
            this.changeBrightnessToAllImageryLayers(t)
        } else e < 72 && e > 30 && this.changeBrightnessToAllImageryLayers(1)
    }, m.prototype.handleSliderMoved = function (e) {
        if (this._isSliderClicked) {
            if (e.target.value > 95 || e.target.value < 0) return;
            var t = e.target.value;
            TerraExplorer.tools.ToolManager._tools.ShadowTool._isShadowTurnedOn && this.dictateTheBrightnessValue(t);
            var n = this;
            setTimeout(function () {
                var e = Math.floor(t / 4), r = t % 4 * 15;
                v.Hour = e, v.Minute = r, n.UpdateText(e)
            }, 300)
        }
    }, m.prototype.IsShadow = function () {
        return viewer.shadows == Cesium.ShadowMode.ENABLED ? !0 : !1
    }, m.prototype.UpdateText = function (e) {
        var n = e > 11 ? " PM" : " AM", r = this._currentDate.getFullYear(), i = this._currentDate.getMonth() + 1,
            s = this._currentDate.getDate();
        e = e.toString(), s = s.toString(), s.length == 1 && (s = "0" + s), i = i.toString(), i.length == 1 && (i = "0" + i), e = e % 12 == 0 ? 12 : e % 12, this._toolContainerText = t.i18n("Date") + " " + +i + "/" + s + "/" + r, this._toolContainerText += "</br>" + t.i18n("Hour") + " " + e + n, this._toolContainer.setText(this._toolContainerText)
    }, m.prototype.handleSliderUp = function (e) {
        this._isSliderClicked = !1
    }, m.prototype.openDatePicker = function () {
        var n = this;
        if (p.IsOpen) p.close(); else {
            e("link[href='./css/jquery-ui.min.css']").length > 0 && e("link[href='./css/jquery-ui.min.css']").attr("href", "./css/datePicker.css");
            var r = e("<div id='CalendarDivId' style='position:absolute;overflow:hidden; width:307px; height:100px;'></div>"),
                i = e("<div id='datepickerDiv'><input type='text' id='datepicker' size=1 style='border:none;'/></div>");
            r.append(i), p.open(t.i18n("Calendar"), "./img/date.png", r, this.onCloseDialogCalendar, !1, !1, !0);
            var s = e("#cesiumContainer").width() * .4;
            e(".toolDialog").css({top: "20%", left: s}), e("#datepicker").datepicker({
                inline: !0,
                onSelect: function (e) {
                    n._currentDate = e, v.CurrentDate = new Date(e), viewer.clock.currentTime = new Date(e), g = e, n._toolContainer.setText("Date: " + e), this._isCalendarTitlePressed = !0
                },
                onClose: function () {
                    p.close(), e(".toolDialog #closeXID").click(), this._isCalendarTitlePressed = !0, e("link[href='./css/datePicker.css']").attr("href", "./css/jquery-ui.min.css")
                }
            }), e("#datepicker").datepicker("setDate", g), setTimeout(function () {
                e("#datepicker").show().focus().hide()
            }, 10), r.css({top: 20}), e(".toolDialogTitle").on("mousedown", function () {
                return !1
            }), e(".toolDialog").removeClass("ui-resizable"), setTimeout(function () {
                e(".toolDialog").width("281"), e(".toolDialog").height("312"), e(".toolDialogTitle").css("z-index", "1000"), e(".toolDialog #closeXID").css("z-index", "1001"), TerraExplorer.isTouch() && e(".toolDialog").css("left", "20%"), e(".toolDialog").append(e("#ui-datepicker-div")), e("#ui-datepicker-div").css("display", "block"), e("#ui-datepicker-div").css("left", "0"), e("#ui-datepicker-div").css("top", "40px"), e("#ui-datepicker-div").css("position", "absolute")
            }, 50)
        }
    }, m.prototype.onCloseDialogCalendar = function () {
        e("#datepicker").datepicker("hide")
    }, m.prototype.onBeforeOpenToolContainer = function () {
        h.Mode = h.MEASUREMENT, this.IsOpen = !0, e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this.parent.onBeforeOpenToolContainer.call(this), e("#TextView").length > 0 && e("#TextView").empty(), this._toolContainer.setText(this._toolContainerText), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText);
        var n = TerraExplorer.internal.FixedLocalTime.Hour, r = TerraExplorer.internal.FixedLocalTime.Minute,
            i = TerraExplorer.internal.FixedLocalTime.Hour * 4 + r / 15;
        return this._toolContainer.addSlider(0, 95, 1, i), e("#sliderId").on("touchstart", e.proxy(this.handleSliderChanged, this)), e("#sliderId").on("touchmove", e.proxy(this.handleSliderMoved, this)), e("#sliderId").on("touchend", e.proxy(this.handleSliderUp, this)), e("#sliderId").mousedown(e.proxy(this.handleSliderChanged, this)), e("#sliderId").mousemove(e.proxy(this.handleSliderMoved, this)), e("#sliderId").mouseup(e.proxy(this.handleSliderUp, this)), e("#sliderId").keydown(e.proxy(this.handleSliderChanged, this)), this._toolContainer.addButton("datePicker", "./img/date.png", undefined, t.i18n("Shadow_DateHour_ToolTIp")), !0
    }, m.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0
    }, m.prototype.onButtonClick = function (t) {
        this.parent.onButtonClick.call(this, t);
        switch (t) {
            case"datePicker":
                e("#TextView").empty(), this.openDatePicker()
        }
    }, m.prototype.onBeforeCloseToolContainer = function (t) {
        return this.parent.onBeforeCloseToolContainer.call(this, t), e(".toolDialog #closeXID").length > 0 && e(".toolDialog #closeXID")[0].click(), this.IsOpen = !1, h.Mode = h.FREE_FLIGHT, f.stop(), !0
    }, m
}), define("tools/TETools/EditFavoriteTool", ["jquery", "TELang", "tools/ToolDialog", "internal/Globals", "./FavoritesStorage", "../ToolProtocol"], function (e, t, n, r, i, s) {
    "use strict";
    var o = function () {
        this._favoritesStorage = i.DefaultStorage, this._favoriteItemId = "", this._currentItem = null, this.getId = function () {
            return "EditFavoriteTool"
        }, this.open = function (r) {
            var i = e("<div id='EditFavoriteDiv' style='position:absolute; width:400px; height:260px; padding:10px;'></div>"),
                s = e("<label class='toolDialogLabel' for='NameId' style=''>" + t.i18n("edit_favorite_name") + "<br><input type='text' id='NameId' class='toolDialogInputText link' style='border:none;width:100%;'/></label>"),
                o = e("<label class='toolDialogLabel' style='display:inline-block; width:96%;'>" + t.i18n("edit_favorite_show_in_3d_view") + "</label><input type='checkbox' class='css-checkbox' id='ShowIn3DId' style='' /><label class='css-label-grey' style='right:10%;' for='ShowIn3DId'></label><br>"),
                u = e("<label id='IconLabelId' class='toolDialogLabel' >" + t.i18n("edit_favorite_icon") + "</label><br><Label id='FavoriteIconName' class='toolDialogInputText' style='border:none;'>123</Label></select>"),
                a = e("<label class='toolDialogLabel' for='MessageId' style=''>" + t.i18n("edit_favorite_message") + "<br><textarea type='text' id='MessageId' class='toolDialogInputText input' rows='3'style='width:100%;padding:2px;'/></label>");
            i.append(s).append(e("<div class='toolDialogLineSeperator' style=''></div>")).append(o).append(e("<div class='toolDialogLineSeperator' style=''></div>")).append(u).append(e("<div class='toolDialogLineSeperator' style=''></div>")).append(a), n.PositionX = 200, n.PositionY = 200, n.open(t.i18n("title_activity_favorites"), "./img/favorits.png", i.get(0), e.proxy(this.onClose, this));
            var f = e("#CloseButton")[0];
            f.textContent = t.i18n("OK"), e(f).width("40"), TerraExplorer.isTouch() && (e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0)), this._favoriteItemId = r.id, this._closeCallback = r.callback, this._favoriteItemId == undefined ? (this._currentItem = this._favoritesStorage.createFavoriteItem(), this._currentItem.name = t.i18n("favorites_default_name")) : (this._currentItem = this._favoritesStorage.getItem(this._favoriteItemId), this._currentItem == null), e("#NameId").val(this._currentItem.name), e("#ShowIn3DId").prop("checked", this._currentItem.showOn3D), e("#MessageId").val(this._currentItem.desc);
            var l = this._favoritesStorage, c = l.iconList(), h = 0;
            for (var p = c.length - 1; p >= 0; p--) {
                var d = c[p].replace("./img/", "./img/dialogs/"),
                    v = e("<img class='link' id='" + p + "' selectedIcon='false' src='" + d + "'style='height:16px; width:16px; border:1px solid rgba(236, 236, 236, 1.0); padding:2px; margin:5px 0px 5px 10px; float:right;' />");
                e("#IconLabelId").append(v), v.click(function () {
                    for (var t = c.length - 1; t >= 0; t--) e("#IconLabelId").find("#" + t).css({border: this.id == t ? "1px solid rgba(150, 150, 150, 1.0)" : "1px solid rgba(236, 236, 236, 1.0)"}), e("#IconLabelId").find("#" + t).attr("selectedIcon", this.id == t), e("#FavoriteIconName").text(l.descriptionForIcon(c[this.id]))
                }), this._currentItem.icon == c[p] && (h = p)
            }
            e("#IconLabelId").find("#" + h).click()
        }
    };
    return o.inheritsFrom(s), Cesium.defineProperties(o.prototype, {}), o.prototype.onClose = function (t) {
        if (t) {
            this._closeCallback && this._closeCallback(!0);
            return
        }
        this._currentItem.name = e("#NameId").val(), this._currentItem.showOn3D = e("#ShowIn3DId").is(":checked"), this._currentItem.desc = e("#MessageId").val();
        var n = e("#IconLabelId").find("[selectedIcon='true']").attr("src");
        this._currentItem.icon = n.replace("./img/dialogs/", "./img/"), this._favoritesStorage.saveItem(this._currentItem);
        var r = e("#ListParentID").length > 0;
        if (r) {
            var i = e("#ListParentID")[0].scrollTop;
            e("#menuIconMenu_Navigation").length > 0 && e("#menuIconMenu_Navigation").click(), e(e("#ListParentID")[0]).animate({scrollTop: i}, 1)
        }
        this._closeCallback && this._closeCallback(!1)
    }, o
}), window.jscolor || (window.jscolor = function () {
    var e = {
        register: function () {
            e.attachDOMReadyEvent(e.init), e.attachEvent(document, "mousedown", e.onDocumentMouseDown), e.attachEvent(document, "touchstart", e.onDocumentTouchStart), e.attachEvent(window, "resize", e.onWindowResize)
        },
        init: function () {
            e.jscolor.lookupClass && e.jscolor.installByClassName(e.jscolor.lookupClass)
        },
        tryInstallOnElements: function (t, n) {
            var r = new RegExp("(^|\\s)(" + n + ")(\\s*(\\{[^}]*\\})|\\s|$)", "i");
            for (var i = 0; i < t.length; i += 1) {
                if (t[i].type !== undefined && t[i].type.toLowerCase() == "color" && e.isColorAttrSupported) continue;
                var s;
                if (!t[i].jscolor && t[i].className && (s = t[i].className.match(r))) {
                    var o = t[i], u = null, a = e.getDataAttr(o, "jscolor");
                    a !== null ? u = a : s[4] && (u = s[4]);
                    var f = {};
                    if (u) try {
                        f = (new Function("return (" + u + ")"))()
                    } catch (l) {
                        e.warn("Error parsing jscolor options: " + l + ":\n" + u)
                    }
                    o.jscolor = new e.jscolor(o, f)
                }
            }
        },
        isColorAttrSupported: function () {
            var e = document.createElement("input");
            if (e.setAttribute) {
                e.setAttribute("type", "color");
                if (e.type.toLowerCase() == "color") return !0
            }
            return !1
        }(),
        isCanvasSupported: function () {
            var e = document.createElement("canvas");
            return !!e.getContext && !!e.getContext("2d")
        }(),
        fetchElement: function (e) {
            return typeof e == "string" ? document.getElementById(e) : e
        },
        isElementType: function (e, t) {
            return e.nodeName.toLowerCase() === t.toLowerCase()
        },
        getDataAttr: function (e, t) {
            var n = "data-" + t, r = e.getAttribute(n);
            return r !== null ? r : null
        },
        attachEvent: function (e, t, n) {
            e.addEventListener ? e.addEventListener(t, n, !1) : e.attachEvent && e.attachEvent("on" + t, n)
        },
        detachEvent: function (e, t, n) {
            e.removeEventListener ? e.removeEventListener(t, n, !1) : e.detachEvent && e.detachEvent("on" + t, n)
        },
        _attachedGroupEvents: {},
        attachGroupEvent: function (t, n, r, i) {
            e._attachedGroupEvents.hasOwnProperty(t) || (e._attachedGroupEvents[t] = []), e._attachedGroupEvents[t].push([n, r, i]), e.attachEvent(n, r, i)
        },
        detachGroupEvents: function (t) {
            if (e._attachedGroupEvents.hasOwnProperty(t)) {
                for (var n = 0; n < e._attachedGroupEvents[t].length; n += 1) {
                    var r = e._attachedGroupEvents[t][n];
                    e.detachEvent(r[0], r[1], r[2])
                }
                delete e._attachedGroupEvents[t]
            }
        },
        attachDOMReadyEvent: function (e) {
            var t = !1, n = function () {
                t || (t = !0, e())
            };
            if (document.readyState === "complete") {
                setTimeout(n, 1);
                return
            }
            if (document.addEventListener) document.addEventListener("DOMContentLoaded", n, !1), window.addEventListener("load", n, !1); else if (document.attachEvent) {
                document.attachEvent("onreadystatechange", function () {
                    document.readyState === "complete" && (document.detachEvent("onreadystatechange", arguments.callee), n())
                }), window.attachEvent("onload", n);
                if (document.documentElement.doScroll && window == window.top) {
                    var r = function () {
                        if (!document.body) return;
                        try {
                            document.documentElement.doScroll("left"), n()
                        } catch (e) {
                            setTimeout(r, 1)
                        }
                    };
                    r()
                }
            }
        },
        warn: function (e) {
            window.console && window.console.warn && window.console.warn(e)
        },
        preventDefault: function (e) {
            e.preventDefault && e.preventDefault(), e.returnValue = !1
        },
        captureTarget: function (t) {
            t.setCapture && (e._capturedTarget = t, e._capturedTarget.setCapture())
        },
        releaseTarget: function () {
            e._capturedTarget && (e._capturedTarget.releaseCapture(), e._capturedTarget = null)
        },
        fireEvent: function (e, t) {
            if (!e) return;
            if (document.createEvent) {
                var n = document.createEvent("HTMLEvents");
                n.initEvent(t, !0, !0), e.dispatchEvent(n)
            } else if (document.createEventObject) {
                var n = document.createEventObject();
                e.fireEvent("on" + t, n)
            } else e["on" + t] && e["on" + t]()
        },
        classNameToList: function (e) {
            return e.replace(/^\s+|\s+$/g, "").split(/\s+/)
        },
        hasClass: function (e, t) {
            return t ? -1 != (" " + e.className.replace(/\s+/g, " ") + " ").indexOf(" " + t + " ") : !1
        },
        setClass: function (t, n) {
            var r = e.classNameToList(n);
            for (var i = 0; i < r.length; i += 1) e.hasClass(t, r[i]) || (t.className += (t.className ? " " : "") + r[i])
        },
        unsetClass: function (t, n) {
            var r = e.classNameToList(n);
            for (var i = 0; i < r.length; i += 1) {
                var s = new RegExp("^\\s*" + r[i] + "\\s*|" + "\\s*" + r[i] + "\\s*$|" + "\\s+" + r[i] + "(\\s+)", "g");
                t.className = t.className.replace(s, "$1")
            }
        },
        getStyle: function (e) {
            return window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle
        },
        setStyle: function () {
            var e = document.createElement("div"), t = function (t) {
                for (var n = 0; n < t.length; n += 1) if (t[n] in e.style) return t[n]
            }, n = {
                borderRadius: t(["borderRadius", "MozBorderRadius", "webkitBorderRadius"]),
                boxShadow: t(["boxShadow", "MozBoxShadow", "webkitBoxShadow"])
            };
            return function (e, t, r) {
                switch (t.toLowerCase()) {
                    case"opacity":
                        var i = Math.round(parseFloat(r) * 100);
                        e.style.opacity = r, e.style.filter = "alpha(opacity=" + i + ")";
                        break;
                    default:
                        e.style[n[t]] = r
                }
            }
        }(),
        setBorderRadius: function (t, n) {
            e.setStyle(t, "borderRadius", n || "0")
        },
        setBoxShadow: function (t, n) {
            e.setStyle(t, "boxShadow", n || "none")
        },
        getElementPos: function (t, n) {
            var r = 0, i = 0, s = t.getBoundingClientRect();
            r = s.left, i = s.top;
            if (!n) {
                var o = e.getViewPos();
                r += o[0], i += o[1]
            }
            return [r, i]
        },
        getElementSize: function (e) {
            return [e.offsetWidth, e.offsetHeight]
        },
        getAbsPointerPos: function (e) {
            e || (e = window.event);
            var t = 0, n = 0;
            return typeof e.changedTouches != "undefined" && e.changedTouches.length ? (t = e.changedTouches[0].clientX, n = e.changedTouches[0].clientY) : typeof e.clientX == "number" && (t = e.clientX, n = e.clientY), {
                x: t,
                y: n
            }
        },
        getRelPointerPos: function (e) {
            e || (e = window.event);
            var t = e.target || e.srcElement, n = t.getBoundingClientRect(), r = 0, i = 0, s = 0, o = 0;
            return typeof e.changedTouches != "undefined" && e.changedTouches.length ? (s = e.changedTouches[0].clientX, o = e.changedTouches[0].clientY) : typeof e.clientX == "number" && (s = e.clientX, o = e.clientY), r = s - n.left, i = o - n.top, {
                x: r,
                y: i
            }
        },
        getViewPos: function () {
            var e = document.documentElement;
            return [(window.pageXOffset || e.scrollLeft) - (e.clientLeft || 0), (window.pageYOffset || e.scrollTop) - (e.clientTop || 0)]
        },
        getViewSize: function () {
            var e = document.documentElement;
            return [window.innerWidth || e.clientWidth, window.innerHeight || e.clientHeight]
        },
        redrawPosition: function () {
            if (e.picker && e.picker.owner) {
                var t = e.picker.owner, n, r;
                t.fixed ? (n = e.getElementPos(t.targetElement, !0), r = [0, 0]) : (n = e.getElementPos(t.targetElement), r = e.getViewPos());
                var i = e.getElementSize(t.targetElement), s = e.getViewSize(), o = e.getPickerOuterDims(t), u, a, f;
                switch (t.position.toLowerCase()) {
                    case"left":
                        u = 1, a = 0, f = -1;
                        break;
                    case"right":
                        u = 1, a = 0, f = 1;
                        break;
                    case"top":
                        u = 0, a = 1, f = -1;
                        break;
                    default:
                        u = 0, a = 1, f = 1
                }
                var l = (i[a] + o[a]) / 2;
                if (!t.smartPosition) var c = [n[u], n[a] + i[a] - l + l * f]; else var c = [-r[u] + n[u] + o[u] > s[u] ? -r[u] + n[u] + i[u] / 2 > s[u] / 2 && n[u] + i[u] - o[u] >= 0 ? n[u] + i[u] - o[u] : n[u] : n[u], -r[a] + n[a] + i[a] + o[a] - l + l * f > s[a] ? -r[a] + n[a] + i[a] / 2 > s[a] / 2 && n[a] + i[a] - l - l * f >= 0 ? n[a] + i[a] - l - l * f : n[a] + i[a] - l + l * f : n[a] + i[a] - l + l * f >= 0 ? n[a] + i[a] - l + l * f : n[a] + i[a] - l - l * f];
                var h = c[u], p = c[a], d = t.fixed ? "fixed" : "absolute",
                    v = (c[0] + o[0] > n[0] || c[0] < n[0] + i[0]) && c[1] + o[1] < n[1] + i[1];
                e._drawPosition(t, h, p, d, v)
            }
        },
        _drawPosition: function (t, n, r, i, s) {
            var o = s ? 0 : t.shadowBlur;
            e.picker.wrap.style.position = i, e.picker.wrap.style.left = n + "px", e.picker.wrap.style.top = r + "px", e.setBoxShadow(e.picker.boxS, t.shadow ? new e.BoxShadow(0, o, t.shadowBlur, 0, t.shadowColor) : null)
        },
        getPickerDims: function (t) {
            var n = !!e.getSliderComponent(t),
                r = [2 * t.insetWidth + 2 * t.padding + t.width + (n ? 2 * t.insetWidth + e.getPadToSliderPadding(t) + t.sliderSize : 0), 2 * t.insetWidth + 2 * t.padding + t.height + (t.closable ? 2 * t.insetWidth + t.padding + t.buttonHeight : 0)];
            return r
        },
        getPickerOuterDims: function (t) {
            var n = e.getPickerDims(t);
            return [n[0] + 2 * t.borderWidth, n[1] + 2 * t.borderWidth]
        },
        getPadToSliderPadding: function (e) {
            return Math.max(e.padding, 1.5 * (2 * e.pointerBorderWidth + e.pointerThickness))
        },
        getPadYComponent: function (e) {
            switch (e.mode.charAt(1).toLowerCase()) {
                case"v":
                    return "v"
            }
            return "s"
        },
        getSliderComponent: function (e) {
            if (e.mode.length > 2) switch (e.mode.charAt(2).toLowerCase()) {
                case"s":
                    return "s";
                case"v":
                    return "v"
            }
            return null
        },
        onDocumentMouseDown: function (t) {
            t || (t = window.event);
            var n = t.target || t.srcElement;
            n._jscLinkedInstance ? n._jscLinkedInstance.showOnClick && n._jscLinkedInstance.show() : n._jscControlName ? e.onControlPointerStart(t, n, n._jscControlName, "mouse") : e.picker && e.picker.owner && e.picker.owner.hide()
        },
        onDocumentTouchStart: function (t) {
            t || (t = window.event);
            var n = t.target || t.srcElement;
            n._jscLinkedInstance ? n._jscLinkedInstance.showOnClick && n._jscLinkedInstance.show() : n._jscControlName ? e.onControlPointerStart(t, n, n._jscControlName, "touch") : e.picker && e.picker.owner && e.picker.owner.hide()
        },
        onWindowResize: function (t) {
            e.redrawPosition()
        },
        onParentScroll: function (t) {
            e.picker && e.picker.owner && e.picker.owner.hide()
        },
        _pointerMoveEvent: {mouse: "mousemove", touch: "touchmove"},
        _pointerEndEvent: {mouse: "mouseup", touch: "touchend"},
        _pointerOrigin: null,
        _capturedTarget: null,
        onControlPointerStart: function (t, n, r, i) {
            var s = n._jscInstance;
            e.preventDefault(t), e.captureTarget(n);
            var o = function (s, o) {
                e.attachGroupEvent("drag", s, e._pointerMoveEvent[i], e.onDocumentPointerMove(t, n, r, i, o)), e.attachGroupEvent("drag", s, e._pointerEndEvent[i], e.onDocumentPointerEnd(t, n, r, i))
            };
            o(document, [0, 0]);
            if (window.parent && window.frameElement) {
                var u = window.frameElement.getBoundingClientRect(), a = [-u.left, -u.top];
                o(window.parent.window.document, a)
            }
            var f = e.getAbsPointerPos(t), l = e.getRelPointerPos(t);
            e._pointerOrigin = {x: f.x - l.x, y: f.y - l.y};
            switch (r) {
                case"pad":
                    switch (e.getSliderComponent(s)) {
                        case"s":
                            s.hsv[1] === 0 && s.fromHSV(null, 100, null);
                            break;
                        case"v":
                            s.hsv[2] === 0 && s.fromHSV(null, null, 100)
                    }
                    e.setPad(s, t, 0, 0);
                    break;
                case"sld":
                    e.setSld(s, t, 0)
            }
            e.dispatchFineChange(s)
        },
        onDocumentPointerMove: function (t, n, r, i, s) {
            return function (t) {
                var i = n._jscInstance;
                switch (r) {
                    case"pad":
                        t || (t = window.event), e.setPad(i, t, s[0], s[1]), e.dispatchFineChange(i);
                        break;
                    case"sld":
                        t || (t = window.event), e.setSld(i, t, s[1]), e.dispatchFineChange(i)
                }
            }
        },
        onDocumentPointerEnd: function (t, n, r, i) {
            return function (t) {
                var r = n._jscInstance;
                e.detachGroupEvents("drag"), e.releaseTarget(), e.dispatchChange(r)
            }
        },
        dispatchChange: function (t) {
            t.valueElement && e.isElementType(t.valueElement, "input") && e.fireEvent(t.valueElement, "change")
        },
        dispatchFineChange: function (e) {
            if (e.onFineChange) {
                var t;
                typeof e.onFineChange == "string" ? t = new Function(e.onFineChange) : t = e.onFineChange, t.call(e)
            }
        },
        setPad: function (t, n, r, i) {
            var s = e.getAbsPointerPos(n), o = r + s.x - e._pointerOrigin.x - t.padding - t.insetWidth,
                u = i + s.y - e._pointerOrigin.y - t.padding - t.insetWidth, a = o * (360 / (t.width - 1)),
                f = 100 - u * (100 / (t.height - 1));
            switch (e.getPadYComponent(t)) {
                case"s":
                    t.fromHSV(a, f, null, e.leaveSld);
                    break;
                case"v":
                    t.fromHSV(a, null, f, e.leaveSld)
            }
        },
        setSld: function (t, n, r) {
            var i = e.getAbsPointerPos(n), s = r + i.y - e._pointerOrigin.y - t.padding - t.insetWidth,
                o = 100 - s * (100 / (t.height - 1));
            switch (e.getSliderComponent(t)) {
                case"s":
                    t.fromHSV(null, o, null, e.leavePad);
                    break;
                case"v":
                    t.fromHSV(null, null, o, e.leavePad)
            }
        },
        _vmlNS: "jsc_vml_",
        _vmlCSS: "jsc_vml_css_",
        _vmlReady: !1,
        initVML: function () {
            if (!e._vmlReady) {
                var t = document;
                t.namespaces[e._vmlNS] || t.namespaces.add(e._vmlNS, "urn:schemas-microsoft-com:vml");
                if (!t.styleSheets[e._vmlCSS]) {
                    var n = ["shape", "shapetype", "group", "background", "path", "formulas", "handles", "fill", "stroke", "shadow", "textbox", "textpath", "imagedata", "line", "polyline", "curve", "rect", "roundrect", "oval", "arc", "image"],
                        r = t.createStyleSheet();
                    r.owningElement.id = e._vmlCSS;
                    for (var i = 0; i < n.length; i += 1) r.addRule(e._vmlNS + "\\:" + n[i], "behavior:url(#default#VML);")
                }
                e._vmlReady = !0
            }
        },
        createPalette: function () {
            var t = {elm: null, draw: null};
            if (e.isCanvasSupported) {
                var n = document.createElement("canvas"), r = n.getContext("2d"), i = function (e, t, i) {
                    n.width = e, n.height = t, r.clearRect(0, 0, n.width, n.height);
                    var s = r.createLinearGradient(0, 0, n.width, 0);
                    s.addColorStop(0, "#F00"), s.addColorStop(1 / 6, "#FF0"), s.addColorStop(2 / 6, "#0F0"), s.addColorStop(.5, "#0FF"), s.addColorStop(4 / 6, "#00F"), s.addColorStop(5 / 6, "#F0F"), s.addColorStop(1, "#F00"), r.fillStyle = s, r.fillRect(0, 0, n.width, n.height);
                    var o = r.createLinearGradient(0, 0, 0, n.height);
                    switch (i.toLowerCase()) {
                        case"s":
                            o.addColorStop(0, "rgba(255,255,255,0)"), o.addColorStop(1, "rgba(255,255,255,1)");
                            break;
                        case"v":
                            o.addColorStop(0, "rgba(0,0,0,0)"), o.addColorStop(1, "rgba(0,0,0,1)")
                    }
                    r.fillStyle = o, r.fillRect(0, 0, n.width, n.height)
                };
                t.elm = n, t.draw = i
            } else {
                e.initVML();
                var s = document.createElement("div");
                s.style.position = "relative", s.style.overflow = "hidden";
                var o = document.createElement(e._vmlNS + ":fill");
                o.type = "gradient", o.method = "linear", o.angle = "90", o.colors = "16.67% #F0F, 33.33% #00F, 50% #0FF, 66.67% #0F0, 83.33% #FF0";
                var u = document.createElement(e._vmlNS + ":rect");
                u.style.position = "absolute", u.style.left = "-1px", u.style.top = "-1px", u.stroked = !1, u.appendChild(o), s.appendChild(u);
                var a = document.createElement(e._vmlNS + ":fill");
                a.type = "gradient", a.method = "linear", a.angle = "180", a.opacity = "0";
                var f = document.createElement(e._vmlNS + ":rect");
                f.style.position = "absolute", f.style.left = "-1px", f.style.top = "-1px", f.stroked = !1, f.appendChild(a), s.appendChild(f);
                var i = function (e, t, n) {
                    s.style.width = e + "px", s.style.height = t + "px", u.style.width = f.style.width = e + 1 + "px", u.style.height = f.style.height = t + 1 + "px", o.color = "#F00", o.color2 = "#F00";
                    switch (n.toLowerCase()) {
                        case"s":
                            a.color = a.color2 = "#FFF";
                            break;
                        case"v":
                            a.color = a.color2 = "#000"
                    }
                };
                t.elm = s, t.draw = i
            }
            return t
        },
        createSliderGradient: function () {
            var t = {elm: null, draw: null};
            if (e.isCanvasSupported) {
                var n = document.createElement("canvas"), r = n.getContext("2d"), i = function (e, t, i, s) {
                    n.width = e, n.height = t, r.clearRect(0, 0, n.width, n.height);
                    var o = r.createLinearGradient(0, 0, 0, n.height);
                    o.addColorStop(0, i), o.addColorStop(1, s), r.fillStyle = o, r.fillRect(0, 0, n.width, n.height)
                };
                t.elm = n, t.draw = i
            } else {
                e.initVML();
                var s = document.createElement("div");
                s.style.position = "relative", s.style.overflow = "hidden";
                var o = document.createElement(e._vmlNS + ":fill");
                o.type = "gradient", o.method = "linear", o.angle = "180";
                var u = document.createElement(e._vmlNS + ":rect");
                u.style.position = "absolute", u.style.left = "-1px", u.style.top = "-1px", u.stroked = !1, u.appendChild(o), s.appendChild(u);
                var i = function (e, t, n, r) {
                    s.style.width = e + "px", s.style.height = t + "px", u.style.width = e + 1 + "px", u.style.height = t + 1 + "px", o.color = n, o.color2 = r
                };
                t.elm = s, t.draw = i
            }
            return t
        },
        leaveValue: 1,
        leaveStyle: 2,
        leavePad: 4,
        leaveSld: 8,
        BoxShadow: function () {
            var e = function (e, t, n, r, i, s) {
                this.hShadow = e, this.vShadow = t, this.blur = n, this.spread = r, this.color = i, this.inset = !!s
            };
            return e.prototype.toString = function () {
                var e = [Math.round(this.hShadow) + "px", Math.round(this.vShadow) + "px", Math.round(this.blur) + "px", Math.round(this.spread) + "px", this.color];
                return this.inset && e.push("inset"), e.join(" ")
            }, e
        }(),
        jscolor: function (t, n) {
            function i(e, t, n) {
                e /= 255, t /= 255, n /= 255;
                var r = Math.min(Math.min(e, t), n), i = Math.max(Math.max(e, t), n), s = i - r;
                if (s === 0) return [null, 0, 100 * i];
                var o = e === r ? 3 + (n - t) / s : t === r ? 5 + (e - n) / s : 1 + (t - e) / s;
                return [60 * (o === 6 ? 0 : o), 100 * (s / i), 100 * i]
            }

            function s(e, t, n) {
                var r = 255 * (n / 100);
                if (e === null) return [r, r, r];
                e /= 60, t /= 100;
                var i = Math.floor(e), s = i % 2 ? e - i : 1 - (e - i), o = r * (1 - t), u = r * (1 - t * s);
                switch (i) {
                    case 6:
                    case 0:
                        return [r, u, o];
                    case 1:
                        return [u, r, o];
                    case 2:
                        return [o, r, u];
                    case 3:
                        return [o, u, r];
                    case 4:
                        return [u, o, r];
                    case 5:
                        return [r, o, u]
                }
            }

            function o() {
                e.unsetClass(d.targetElement, d.activeClass), e.picker.wrap.parentNode.removeChild(e.picker.wrap), delete e.picker.owner
            }

            function u() {
                function l() {
                    var e = d.insetColor.split(/\s+/),
                        n = e.length < 2 ? e[0] : e[1] + " " + e[0] + " " + e[0] + " " + e[1];
                    t.btn.style.borderColor = n
                }

                d._processParentElementsInDOM(), e.picker || (e.picker = {
                    owner: null,
                    wrap: document.createElement("div"),
                    box: document.createElement("div"),
                    boxS: document.createElement("div"),
                    boxB: document.createElement("div"),
                    pad: document.createElement("div"),
                    padB: document.createElement("div"),
                    padM: document.createElement("div"),
                    padPal: e.createPalette(),
                    cross: document.createElement("div"),
                    crossBY: document.createElement("div"),
                    crossBX: document.createElement("div"),
                    crossLY: document.createElement("div"),
                    crossLX: document.createElement("div"),
                    sld: document.createElement("div"),
                    sldB: document.createElement("div"),
                    sldM: document.createElement("div"),
                    sldGrad: e.createSliderGradient(),
                    sldPtrS: document.createElement("div"),
                    sldPtrIB: document.createElement("div"),
                    sldPtrMB: document.createElement("div"),
                    sldPtrOB: document.createElement("div"),
                    btn: document.createElement("div"),
                    btnT: document.createElement("span")
                }, e.picker.pad.appendChild(e.picker.padPal.elm), e.picker.padB.appendChild(e.picker.pad), e.picker.cross.appendChild(e.picker.crossBY), e.picker.cross.appendChild(e.picker.crossBX), e.picker.cross.appendChild(e.picker.crossLY), e.picker.cross.appendChild(e.picker.crossLX), e.picker.padB.appendChild(e.picker.cross), e.picker.box.appendChild(e.picker.padB), e.picker.box.appendChild(e.picker.padM), e.picker.sld.appendChild(e.picker.sldGrad.elm), e.picker.sldB.appendChild(e.picker.sld), e.picker.sldB.appendChild(e.picker.sldPtrOB), e.picker.sldPtrOB.appendChild(e.picker.sldPtrMB), e.picker.sldPtrMB.appendChild(e.picker.sldPtrIB), e.picker.sldPtrIB.appendChild(e.picker.sldPtrS), e.picker.box.appendChild(e.picker.sldB), e.picker.box.appendChild(e.picker.sldM), e.picker.btn.appendChild(e.picker.btnT), e.picker.box.appendChild(e.picker.btn), e.picker.boxB.appendChild(e.picker.box), e.picker.wrap.appendChild(e.picker.boxS), e.picker.wrap.appendChild(e.picker.boxB));
                var t = e.picker, n = !!e.getSliderComponent(d), r = e.getPickerDims(d),
                    i = 2 * d.pointerBorderWidth + d.pointerThickness + 2 * d.crossSize, s = e.getPadToSliderPadding(d),
                    o = Math.min(d.borderRadius, Math.round(d.padding * Math.PI)), u = "crosshair";
                t.wrap.style.clear = "both", t.wrap.style.width = r[0] + 2 * d.borderWidth + "px", t.wrap.style.height = r[1] + 2 * d.borderWidth + "px", t.wrap.style.zIndex = d.zIndex, t.box.style.width = r[0] + "px", t.box.style.height = r[1] + "px", t.boxS.style.position = "absolute", t.boxS.style.left = "0", t.boxS.style.top = "0", t.boxS.style.width = "100%", t.boxS.style.height = "100%", e.setBorderRadius(t.boxS, o + "px"), t.boxB.style.position = "relative", t.boxB.style.border = d.borderWidth + "px solid", t.boxB.style.borderColor = d.borderColor, t.boxB.style.background = d.backgroundColor, e.setBorderRadius(t.boxB, o + "px"), t.padM.style.background = t.sldM.style.background = "#FFF", e.setStyle(t.padM, "opacity", "0"), e.setStyle(t.sldM, "opacity", "0"), t.pad.style.position = "relative", t.pad.style.width = d.width + "px", t.pad.style.height = d.height + "px", t.padPal.draw(d.width, d.height, e.getPadYComponent(d)), t.padB.style.position = "absolute", t.padB.style.left = d.padding + "px", t.padB.style.top = d.padding + "px", t.padB.style.border = d.insetWidth + "px solid", t.padB.style.borderColor = d.insetColor, t.padM._jscInstance = d, t.padM._jscControlName = "pad", t.padM.style.position = "absolute", t.padM.style.left = "0", t.padM.style.top = "0", t.padM.style.width = d.padding + 2 * d.insetWidth + d.width + s / 2 + "px", t.padM.style.height = r[1] + "px", t.padM.style.cursor = u, t.cross.style.position = "absolute", t.cross.style.left = t.cross.style.top = "0", t.cross.style.width = t.cross.style.height = i + "px", t.crossBY.style.position = t.crossBX.style.position = "absolute", t.crossBY.style.background = t.crossBX.style.background = d.pointerBorderColor, t.crossBY.style.width = t.crossBX.style.height = 2 * d.pointerBorderWidth + d.pointerThickness + "px", t.crossBY.style.height = t.crossBX.style.width = i + "px", t.crossBY.style.left = t.crossBX.style.top = Math.floor(i / 2) - Math.floor(d.pointerThickness / 2) - d.pointerBorderWidth + "px", t.crossBY.style.top = t.crossBX.style.left = "0", t.crossLY.style.position = t.crossLX.style.position = "absolute", t.crossLY.style.background = t.crossLX.style.background = d.pointerColor, t.crossLY.style.height = t.crossLX.style.width = i - 2 * d.pointerBorderWidth + "px", t.crossLY.style.width = t.crossLX.style.height = d.pointerThickness + "px", t.crossLY.style.left = t.crossLX.style.top = Math.floor(i / 2) - Math.floor(d.pointerThickness / 2) + "px", t.crossLY.style.top = t.crossLX.style.left = d.pointerBorderWidth + "px", t.sld.style.overflow = "hidden", t.sld.style.width = d.sliderSize + "px", t.sld.style.height = d.height + "px", t.sldGrad.draw(d.sliderSize, d.height, "#000", "#000"), t.sldB.style.display = n ? "block" : "none", t.sldB.style.position = "absolute", t.sldB.style.right = d.padding + "px", t.sldB.style.top = d.padding + "px", t.sldB.style.border = d.insetWidth + "px solid", t.sldB.style.borderColor = d.insetColor, t.sldM._jscInstance = d, t.sldM._jscControlName = "sld", t.sldM.style.display = n ? "block" : "none", t.sldM.style.position = "absolute", t.sldM.style.right = "0", t.sldM.style.top = "0", t.sldM.style.width = d.sliderSize + s / 2 + d.padding + 2 * d.insetWidth + "px", t.sldM.style.height = r[1] + "px", t.sldM.style.cursor = "default", t.sldPtrIB.style.border = t.sldPtrOB.style.border = d.pointerBorderWidth + "px solid " + d.pointerBorderColor, t.sldPtrOB.style.position = "absolute", t.sldPtrOB.style.left = -(2 * d.pointerBorderWidth + d.pointerThickness) + "px", t.sldPtrOB.style.top = "0", t.sldPtrMB.style.border = d.pointerThickness + "px solid " + d.pointerColor, t.sldPtrS.style.width = d.sliderSize + "px", t.sldPtrS.style.height = m + "px", t.btn.style.display = d.closable ? "block" : "none", t.btn.style.position = "absolute", t.btn.style.left = d.padding + "px", t.btn.style.bottom = d.padding + "px", t.btn.style.padding = "0 15px", t.btn.style.height = d.buttonHeight + "px", t.btn.style.border = d.insetWidth + "px solid", l(), t.btn.style.color = d.buttonColor, t.btn.style.font = "12px sans-serif", t.btn.style.textAlign = "center";
                try {
                    t.btn.style.cursor = "pointer"
                } catch (c) {
                    t.btn.style.cursor = "hand"
                }
                t.btn.onmousedown = function () {
                    d.hide()
                }, t.btnT.style.lineHeight = d.buttonHeight + "px", t.btnT.innerHTML = "", t.btnT.appendChild(document.createTextNode(d.closeText)), a(), f(), e.picker.owner && e.picker.owner !== d && e.unsetClass(e.picker.owner.targetElement, d.activeClass), e.picker.owner = d, e.isElementType(v, "body") ? e.redrawPosition() : e._drawPosition(d, 0, 0, "relative", !1), t.wrap.parentNode != v && v.appendChild(t.wrap), e.setClass(d.targetElement, d.activeClass)
            }

            function a() {
                switch (e.getPadYComponent(d)) {
                    case"s":
                        var t = 1;
                        break;
                    case"v":
                        var t = 2
                }
                var n = Math.round(d.hsv[0] / 360 * (d.width - 1)),
                    r = Math.round((1 - d.hsv[t] / 100) * (d.height - 1)),
                    i = 2 * d.pointerBorderWidth + d.pointerThickness + 2 * d.crossSize, o = -Math.floor(i / 2);
                e.picker.cross.style.left = n + o + "px", e.picker.cross.style.top = r + o + "px";
                switch (e.getSliderComponent(d)) {
                    case"s":
                        var u = s(d.hsv[0], 100, d.hsv[2]), a = s(d.hsv[0], 0, d.hsv[2]),
                            f = "rgb(" + Math.round(u[0]) + "," + Math.round(u[1]) + "," + Math.round(u[2]) + ")",
                            l = "rgb(" + Math.round(a[0]) + "," + Math.round(a[1]) + "," + Math.round(a[2]) + ")";
                        e.picker.sldGrad.draw(d.sliderSize, d.height, f, l);
                        break;
                    case"v":
                        var c = s(d.hsv[0], d.hsv[1], 100),
                            f = "rgb(" + Math.round(c[0]) + "," + Math.round(c[1]) + "," + Math.round(c[2]) + ")",
                            l = "#000";
                        e.picker.sldGrad.draw(d.sliderSize, d.height, f, l)
                }
            }

            function f() {
                var t = e.getSliderComponent(d);
                if (t) {
                    switch (t) {
                        case"s":
                            var n = 1;
                            break;
                        case"v":
                            var n = 2
                    }
                    var r = Math.round((1 - d.hsv[n] / 100) * (d.height - 1));
                    e.picker.sldPtrOB.style.top = r - (2 * d.pointerBorderWidth + d.pointerThickness) - Math.floor(m / 2) + "px"
                }
            }

            function l() {
                return e.picker && e.picker.owner === d
            }

            function c() {
                d.importColor()
            }

            this.value = null, this.valueElement = t, this.styleElement = t, this.required = !0, this.refine = !0, this.hash = !1, this.uppercase = !0, this.onFineChange = null, this.activeClass = "jscolor-active", this.minS = 0, this.maxS = 100, this.minV = 0, this.maxV = 100, this.hsv = [0, 0, 100], this.rgb = [255, 255, 255], this.width = 181, this.height = 101, this.showOnClick = !0, this.mode = "HSV", this.position = "bottom", this.smartPosition = !0, this.sliderSize = 16, this.crossSize = 8, this.closable = !1, this.closeText = "Close", this.buttonColor = "#000000", this.buttonHeight = 18, this.padding = 12, this.backgroundColor = "#FFFFFF", this.borderWidth = 1, this.borderColor = "#BBBBBB", this.borderRadius = 8, this.insetWidth = 1, this.insetColor = "#BBBBBB", this.shadow = !0, this.shadowBlur = 15, this.shadowColor = "rgba(0,0,0,0.2)", this.pointerColor = "#4C4C4C", this.pointerBorderColor = "#FFFFFF", this.pointerBorderWidth = 1, this.pointerThickness = 2, this.zIndex = 1e3, this.container = null;
            for (var r in n) n.hasOwnProperty(r) && (this[r] = n[r]);
            this.hide = function () {
                l() && o()
            }, this.show = function () {
                u()
            }, this.redraw = function () {
                l() && u()
            }, this.importColor = function () {
                this.valueElement ? e.isElementType(this.valueElement, "input") ? this.refine ? !this.required && /^\s*$/.test(this.valueElement.value) ? (this.valueElement.value = "", this.styleElement && (this.styleElement.style.backgroundImage = this.styleElement._jscOrigStyle.backgroundImage, this.styleElement.style.backgroundColor = this.styleElement._jscOrigStyle.backgroundColor, this.styleElement.style.color = this.styleElement._jscOrigStyle.color), this.exportColor(e.leaveValue | e.leaveStyle)) : this.fromString(this.valueElement.value) || this.exportColor() : this.fromString(this.valueElement.value, e.leaveValue) || (this.styleElement && (this.styleElement.style.backgroundImage = this.styleElement._jscOrigStyle.backgroundImage, this.styleElement.style.backgroundColor = this.styleElement._jscOrigStyle.backgroundColor, this.styleElement.style.color = this.styleElement._jscOrigStyle.color), this.exportColor(e.leaveValue | e.leaveStyle)) : this.exportColor() : this.exportColor()
            }, this.exportColor = function (t) {
                if (!(t & e.leaveValue) && this.valueElement) {
                    var n = this.toString();
                    this.uppercase && (n = n.toUpperCase()), this.hash && (n = "#" + n), e.isElementType(this.valueElement, "input") ? this.valueElement.value = n : this.valueElement.innerHTML = n
                }
                t & e.leaveStyle || this.styleElement && (this.styleElement.style.backgroundImage = "none", this.styleElement.style.backgroundColor = "#" + this.toString(), this.styleElement.style.color = this.isLight() ? "#000" : "#FFF"), !(t & e.leavePad) && l() && a(), !(t & e.leaveSld) && l() && f()
            }, this.fromHSV = function (e, t, n, r) {
                if (e !== null) {
                    if (isNaN(e)) return !1;
                    e = Math.max(0, Math.min(360, e))
                }
                if (t !== null) {
                    if (isNaN(t)) return !1;
                    t = Math.max(0, Math.min(100, this.maxS, t), this.minS)
                }
                if (n !== null) {
                    if (isNaN(n)) return !1;
                    n = Math.max(0, Math.min(100, this.maxV, n), this.minV)
                }
                this.rgb = s(e === null ? this.hsv[0] : this.hsv[0] = e, t === null ? this.hsv[1] : this.hsv[1] = t, n === null ? this.hsv[2] : this.hsv[2] = n), this.exportColor(r)
            }, this.fromRGB = function (e, t, n, r) {
                if (e !== null) {
                    if (isNaN(e)) return !1;
                    e = Math.max(0, Math.min(255, e))
                }
                if (t !== null) {
                    if (isNaN(t)) return !1;
                    t = Math.max(0, Math.min(255, t))
                }
                if (n !== null) {
                    if (isNaN(n)) return !1;
                    n = Math.max(0, Math.min(255, n))
                }
                var o = i(e === null ? this.rgb[0] : e, t === null ? this.rgb[1] : t, n === null ? this.rgb[2] : n);
                o[0] !== null && (this.hsv[0] = Math.max(0, Math.min(360, o[0]))), o[2] !== 0 && (this.hsv[1] = o[1] === null ? null : Math.max(0, this.minS, Math.min(100, this.maxS, o[1]))), this.hsv[2] = o[2] === null ? null : Math.max(0, this.minV, Math.min(100, this.maxV, o[2]));
                var u = s(this.hsv[0], this.hsv[1], this.hsv[2]);
                this.rgb[0] = u[0], this.rgb[1] = u[1], this.rgb[2] = u[2], this.exportColor(r)
            }, this.fromString = function (e, t) {
                var n;
                if (n = e.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i)) return n[1].length === 6 ? this.fromRGB(parseInt(n[1].substr(0, 2), 16), parseInt(n[1].substr(2, 2), 16), parseInt(n[1].substr(4, 2), 16), t) : this.fromRGB(parseInt(n[1].charAt(0) + n[1].charAt(0), 16), parseInt(n[1].charAt(1) + n[1].charAt(1), 16), parseInt(n[1].charAt(2) + n[1].charAt(2), 16), t), !0;
                if (n = e.match(/^\W*rgba?\(([^)]*)\)\W*$/i)) {
                    var r = n[1].split(","), i = /^\s*(\d*)(\.\d+)?\s*$/, s, o, u;
                    if (r.length >= 3 && (s = r[0].match(i)) && (o = r[1].match(i)) && (u = r[2].match(i))) {
                        var a = parseFloat((s[1] || "0") + (s[2] || "")), f = parseFloat((o[1] || "0") + (o[2] || "")),
                            l = parseFloat((u[1] || "0") + (u[2] || ""));
                        return this.fromRGB(a, f, l, t), !0
                    }
                }
                return !1
            }, this.toString = function () {
                return (256 | Math.round(this.rgb[0])).toString(16).substr(1) + (256 | Math.round(this.rgb[1])).toString(16).substr(1) + (256 | Math.round(this.rgb[2])).toString(16).substr(1)
            }, this.toHEXString = function () {
                return "#" + this.toString().toUpperCase()
            }, this.toRGBString = function () {
                return "rgb(" + Math.round(this.rgb[0]) + "," + Math.round(this.rgb[1]) + "," + Math.round(this.rgb[2]) + ")"
            }, this.isLight = function () {
                return .213 * this.rgb[0] + .715 * this.rgb[1] + .072 * this.rgb[2] > 127.5
            }, this._processParentElementsInDOM = function () {
                if (this._linkedElementsProcessed) return;
                this._linkedElementsProcessed = !0;
                var t = this.targetElement;
                do {
                    var n = e.getStyle(t);
                    n && n.position.toLowerCase() === "fixed" && (this.fixed = !0), t !== this.targetElement && (t._jscEventsAttached || (e.attachEvent(t, "scroll", e.onParentScroll), t._jscEventsAttached = !0))
                } while ((t = t.parentNode) && !e.isElementType(t, "body"))
            };
            if (typeof t == "string") {
                var h = t, p = document.getElementById(h);
                p ? this.targetElement = p : e.warn("Could not find target element with ID '" + h + "'")
            } else t ? this.targetElement = t : e.warn("Invalid target element: '" + t + "'");
            if (this.targetElement._jscLinkedInstance) {
                e.warn("Cannot link jscolor twice to the same element. Skipping.");
                return
            }
            this.targetElement._jscLinkedInstance = this, this.valueElement = e.fetchElement(this.valueElement), this.styleElement = e.fetchElement(this.styleElement);
            var d = this,
                v = this.container ? e.fetchElement(this.container) : document.getElementsByTagName("body")[0], m = 3;
            if (e.isElementType(this.targetElement, "button")) if (this.targetElement.onclick) {
                var g = this.targetElement.onclick;
                this.targetElement.onclick = function (e) {
                    return g.call(this, e), !1
                }
            } else this.targetElement.onclick = function () {
                return !1
            };
            if (this.valueElement && e.isElementType(this.valueElement, "input")) {
                var y = function () {
                    d.fromString(d.valueElement.value, e.leaveValue), e.dispatchFineChange(d)
                };
                e.attachEvent(this.valueElement, "keyup", y), e.attachEvent(this.valueElement, "input", y), e.attachEvent(this.valueElement, "blur", c), this.valueElement.setAttribute("autocomplete", "off")
            }
            this.styleElement && (this.styleElement._jscOrigStyle = {
                backgroundImage: this.styleElement.style.backgroundImage,
                backgroundColor: this.styleElement.style.backgroundColor,
                color: this.styleElement.style.color
            }), this.value ? this.fromString(this.value) || this.exportColor() : this.importColor()
        }
    };
    return e.jscolor.lookupClass = "jscolor", e.jscolor.installByClassName = function (t) {
        var n = document.getElementsByTagName("input"), r = document.getElementsByTagName("button");
        e.tryInstallOnElements(n, t), e.tryInstallOnElements(r, t)
    }, e.register(), e.jscolor
}()), define("jscolor", function () {
}), define("wfs/GMLParser", [], function () {
    "use strict";

    function e(e, t, n, r) {
        this._extractAttributes = e, this._featureName = t || "featureMember", this._xy = r, this._gmlns = n || "http://www.opengis.net/gml", this._regExes = {
            trimSpace: /^\s*|\s*$/g,
            removeSpace: /\s*/g,
            splitSpace: /\s+/,
            trimComma: /\s*,\s*/g
        }
    }

    return Object.defineProperties(e.prototype, {
        featureName: {
            get: function () {
                return this._featureName
            }, set: function (e) {
                this._featureName = e
            }
        }, extractAttributes: {
            get: function () {
                return this._extractAttributes
            }, set: function (e) {
                this._extractAttributes = e
            }
        }, xy: {
            get: function () {
                return this._xy
            }
        }
    }), e.prototype.getElementsByTagNameNS = function (e, t, n) {
        var r = [];
        if (e.getElementsByTagNameNS) r = e.getElementsByTagNameNS(t, n); else {
            var i = e.getElementsByTagName("*"), s, o;
            for (var u = 0, a = i.length; u < a; ++u) s = i[u], o = s.prefix ? s.prefix + ":" + n : n, (n == "*" || o == s.nodeName) && (t == "*" || t == s.namespaceURI) && r.push(s)
        }
        return r
    }, e.prototype.read = function (e) {
        var t = this.getElementsByTagNameNS(e.documentElement, this._gmlns, this.featureName), n = [];
        for (var r = 0; r < t.length; r++) {
            var i = this.parseFeature(t[r]);
            i && n.push(i)
        }
        return n
    }, e.prototype.parseFeature = function (e) {
        var t = ["MultiPolygon", "Polygon", "MultiLineString", "LineString", "MultiPoint", "Point", "Envelope"], n, r,
            i, s;
        for (var o = 0; o < t.length; ++o) {
            n = t[o], r = this.getElementsByTagNameNS(e, this._gmlns, n);
            if (r.length > 0) {
                s = this.parseGeometry[n.toLowerCase()], s ? i = s.apply(this, [r[0]]) : console.log("unsupportedGeometryType:" + n);
                break
            }
        }
        var u, a = this.getElementsByTagNameNS(e, this._gmlns, "Box");
        for (o = 0; o < a.length; ++o) {
            var f = a[o], l = this.parseGeometry.box.apply(this, [f]), c = f.parentNode,
                h = c.localName || c.nodeName.split(":").pop();
            h === "boundedBy" ? u = l : i = l.toGeometry()
        }
        var p;
        this.extractAttributes && (p = this.parseAttributes(e));
        var d = {geometryType: n.toLowerCase(), positions: i, attributes: p};
        d.bounds = u;
        var v = e.firstChild, m;
        while (v) {
            if (v.nodeType == 1) {
                m = v.getAttribute("fid") || v.getAttribute("id");
                if (m) break
            }
            v = v.nextSibling
        }
        return d.fid = m, d
    }, e.prototype.parseGeometry = {
        point: function (e) {
            var t, n, r = [], t = this.getElementsByTagNameNS(e, this._gmlns, "pos");
            t.length > 0 && (n = t[0].firstChild.nodeValue, n = n.replace(this._regExes.trimSpace, ""), r = n.split(this._regExes.splitSpace)), r.length == 0 && (t = this.getElementsByTagNameNS(e, this._gmlns, "coordinates"), t.length > 0 && (n = t[0].firstChild.nodeValue, n = n.replace(this._regExes.removeSpace, ""), r = n.split(",")));
            if (r.length == 0) {
                t = this.getElementsByTagNameNS(e, this._gmlns, "coord");
                if (t.length > 0) {
                    var i = this.getElementsByTagNameNS(t[0], this._gmlns, "X"),
                        s = this.getElementsByTagNameNS(t[0], this._gmlns, "Y");
                    i.length > 0 && s.length > 0 && (r = [i[0].firstChild.nodeValue, s[0].firstChild.nodeValue])
                }
            }
            return r.length == 2 && (r[2] = null), this.xy ? [parseFloat(r[0]), parseFloat(r[1]), parseFloat(r[2])] : [parseFloat(r[1]), parseFloat(r[0]), parseFloat(r[2])]
        }, multipoint: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "Point"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.point.apply(this, [t[i]]), r && n.push(r)
            }
            return n
        }, linestring: function (e, t) {
            var n, r, i = [], s = [];
            n = this.getElementsByTagNameNS(e, this._gmlns, "posList");
            if (n.length > 0) {
                r = this.getChildValue(n[0]), r = r.replace(this._regExes.trimSpace, ""), i = r.split(this._regExes.splitSpace);
                var o = parseInt(n[0].getAttribute("dimension")), u, a, f, l;
                for (var c = 0; c < i.length / o; ++c) u = c * o, a = parseFloat(i[u]), f = parseFloat(i[u + 1]), l = o == 2 ? null : parseFloat(i[u + 2]), this.xy ? s.push(a, f, l) : s.push(f, a, l)
            }
            if (i.length == 0) {
                n = this.getElementsByTagNameNS(e, this._gmlns, "coordinates");
                if (n.length > 0) {
                    r = this.getChildValue(n[0]), r = r.replace(this._regExes.trimSpace, ""), r = r.replace(this._regExes.trimComma, ",");
                    var h = r.split(this._regExes.splitSpace);
                    for (var c = 0; c < h.length; ++c) i = h[c].split(","), i.length == 2 && (i[2] = null), this.xy ? s.push(parseFloat(i[0]), parseFloat(i[1]), parseFloat(i[2])) : s.push(parseFloat(i[1]), parseFloat(i[0]), parseFloat(i[2]))
                }
            }
            return s
        }, multilinestring: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "LineString"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.linestring.apply(this, [t[i]]), r && n.push(r)
            }
            return n
        }, polygon: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "LinearRing"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.linestring.apply(this, [t[i], !0]), r && n.push(r)
            }
            return n
        }, multipolygon: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "Polygon"), n = [];
            if (t.length > 0) {
                var r;
                for (var i = 0; i < t.length; ++i) r = this.parseGeometry.polygon.apply(this, [t[i]]), r && n.push(r)
            }
            return n
        }, envelope: function (e) {
            var t = [], n, r, i = this.getElementsByTagNameNS(e, this._gmlns, "lowerCorner");
            if (i.length > 0) {
                var s = [];
                i.length > 0 && (n = i[0].firstChild.nodeValue, n = n.replace(this._regExes.trimSpace, ""), s = n.split(this._regExes.splitSpace)), s.length == 2 && (s[2] = null);
                if (this.xy) var o = new OpenLayers_Geometry_Point(s[0], s[1], s[2]); else var o = new OpenLayers_Geometry_Point(s[1], s[0], s[2])
            }
            var u = this.getElementsByTagNameNS(e, this._gmlns, "upperCorner");
            if (u.length > 0) {
                var s = [];
                u.length > 0 && (n = u[0].firstChild.nodeValue, n = n.replace(this._regExes.trimSpace, ""), s = n.split(this._regExes.splitSpace)), s.length == 2 && (s[2] = null);
                if (this.xy) var a = new OpenLayers_Geometry_Point(s[0], s[1], s[2]); else var a = new OpenLayers_Geometry_Point(s[1], s[0], s[2])
            }
            return o && a && (t.push([o.x, o.y, null]), t.push([a.x, o.y, null]), t.push([a.x, a.y, null]), t.push([o.x, a.y, null]), t.push([o.x, o.y, null]), r = new OpenLayers_Geometry_Polygon([[t]])), r
        }, box: function (e) {
            var t = this.getElementsByTagNameNS(e, this._gmlns, "coordinates"), n, r, i = null, s = null;
            t.length > 0 && (n = t[0].firstChild.nodeValue, r = n.split(" "), r.length == 2 && (i = r[0].split(","), s = r[1].split(",")));
            if (i !== null && s !== null) return [parseFloat(i[0]), parseFloat(i[1]), null, parseFloat(s[0]), parseFloat(s[1]), null]
        }
    }, e.prototype.parseAttributes = function (e) {
        var t = {}, n = e.firstChild, r, i, s, o, u, a, f;
        while (n) {
            if (n.nodeType == 1) {
                r = n.childNodes;
                for (i = 0; i < r.length; ++i) {
                    s = r[i];
                    if (s.nodeType == 1) {
                        o = s.childNodes;
                        if (o.length == 1) {
                            u = o[0];
                            if (u.nodeType == 3 || u.nodeType == 4) a = s.prefix ? s.nodeName.split(":")[1] : s.nodeName, f = u.nodeValue.replace(this._regExes.trimSpace, ""), t[a] = f
                        } else t[s.nodeName.split(":").pop()] = null
                    }
                }
                break
            }
            n = n.nextSibling
        }
        return t
    }, e.prototype.getChildValue = function (e, t) {
        var n = t || "";
        if (e) for (var r = e.firstChild; r; r = r.nextSibling) switch (r.nodeType) {
            case 3:
            case 4:
                n += r.nodeValue
        }
        return n
    }, e
}), define("tools/PropertySheet", ["jquery", "./ToolDialog", "jscolor"], function (e, t, n) {
    "use strict";

    function r() {
        setTimeout(function () {
            e("body").children().last().css("z-index", 1e6)
        }, 50)
    }

    const i = 30;
    var s = function (n) {
        var s = this, o = e("<div id='viewshedPropertiesId'></div>"), u = e('<table class="sheetProperties"></table>'),
            a = [], f = 0;
        e(n.fields).each(function () {
            f++;
            if (this.type === "blank") u.append('<tr><td colspan="3"></td></tr>'); else if (this.type === "separator") u.append('<tr><td colspan="3"><div class="toolDialogLineSeperator" style="width:100%;margin:-4px;"></div></td></tr>'); else if (this.type === "subheader") u.append('<tr><td colspan="3"><b>' + this.label + "</b></td></tr>"); else if (this.type == "textbox") {
                var t = this.readonly ? "readonly" : "", n = this.disabled ? "disabled" : "",
                    r = this.img !== undefined ? '<img src="' + this.img + '"></img>' : "";
                this.img !== undefined ? u.append('<tr id="' + this.id + 'RowId"><td>' + this.label + '</td><td><input style="background-color: white;" id="' + this.id + '" class="toolDialogInputText propSheetTextBox"' + t + " " + n + '></td><td style="position:relative;left:-10px;">' + r + "</td></tr>") : u.append('<tr id="' + this.id + 'RowId"><td>' + this.label + '</td><td><input style="background-color: white;" id="' + this.id + '" class="toolDialogInputText propSheetTextBox"' + t + " " + n + "></td></tr>")
            } else if (this.type == "spinner") {
                var i = e('<tr isSpinner="true" id="' + this.id + 'RowId"><td>' + this.label + '</td><td id="' + this.id + '"></td></tr>');
                u.append(i), i[0].spinnerParams = this.spinnerParams
            } else if (this.type === "colorpicker") u.append('<tr id="' + this.id + 'RowId"><td>' + this.label + '</td><td colspan= "2"><input id="' + this.id + '" class="jscolor"></td></tr>'), a.push(this.id); else if (this.type == "combobox") {
                var s = e('<tr id="' + this.id + 'RowId"><td>' + this.label + '</td><td id="' + this.id + '"></td></tr> '),
                    o = e("<select  class='toolDialogLabelSidebar propSheetSelect' id='" + this.selectId + "'  value=1>"),
                    l = s.find("#" + this.id).append(o);
                e(this.comboItems).each(function () {
                    this.defaultItem !== undefined && this.defaultItem ? l.find("select").append("<option selected value='" + this.value + "'>" + this.key + "</option>") : l.find("select").append("<option value='" + this.value + "'>" + this.key + "</option>")
                }), u.append(s), o.change(this.onChange)
            }
        }), o.append(u), t.open(n.title, n.img, o, n.onCloseDialogUpdate, !1, !1, !0), e(".toolDialog #toolDialogTitleID").addClass("propertySheetToolDialogID"), e(".toolDialog #CloseButton").addClass("proeprtySheetCloseButton"), e(".toolDialog #CloseButton").text(TELang.i18n("OK")), e(".toolDialog").addClass("propertySheetToolDialog"), e(".propertySheetToolDialog").width(320), e(".propertySheetToolDialog").height(Math.max(f * i, 400)), e("#viewshedPropertiesId").height(Math.max(f * i, 400));
        if (TerraExplorer.tools.ToolDialog.PositionX === null && TerraExplorer.tools.ToolDialog.PositionY === null) {
            var l = e("#mainContainer").height() / 2 - e("#viewshedPropertiesId").height() / 2, c = l.toString() + "px";
            e(".toolDialog").css("top", c)
        }
        TerraExplorer.isTouch() && (e(window).off("navigate"), e(".propertySheetToolDialog").height("100%"), e(".propertySheetToolDialog").width("100%"), e(".propertySheetToolDialog").css("top", 0), e(".propertySheetToolDialog").css("left", 0), e(".propertySheetToolDialog").css("z-index", 99999), e("#viewshedPropertiesId").width("106%")), e(a).each(function (t, n) {
            e("#" + n).click(r)
        });
        var s = this;
        u.find('tr[isSpinner="true"]').each(function () {
            this.spinnerParams !== undefined && s.addSpinner(this.spinnerParams.dV, this.spinnerParams.dS, this.spinnerParams.dMin, this.spinnerParams.dMax, this.spinnerParams.divName, this.spinnerParams.params)
        }), jscolor.installByClassName("jscolor")
    };
    return s.prototype.addSpinner = function (t, n, r, i, s, o) {
        var u = this, a = Cesium.defaultValue(t, 0), f = Cesium.defaultValue(n, 1), l = Cesium.defaultValue(r, 0),
            c = Cesium.defaultValue(i, 10);
        if (o != undefined && o.terrainHeight != undefined) var h = o.terrainHeight;
        var p = e('<input id="spinner' + s + '" name="value">'),
            d = e("<div style='margin-left:10px; color:black; border:0px; padding:0px;'><p id='textAfterSpinner" + s + "' style='margin-left:5px;float:left; font-size:10pt; font-family: helvetica;'></p></div> ");
        e("#" + s).append(p);
        var v = h != undefined ? e("#spinner" + s).spinner({numberFormat: "N1"}) : e("#spinner" + s).spinner();
        e("#spinner" + s).parent().after(d), e("#spinner" + s).spinner({min: l, max: c, step: f});
        var m = o !== undefined && o.decimalPoint !== undefined ? o.decimalPoint : 1;
        e("#spinner" + s).val(a.toFixed(m)), o.onCreate && o.onCreate(), e("#spinner" + s).spinner({
            change: function (t, n) {
                o.onChange(t, n), e(".selectedLine").length > 0 && e(".selectedLine img")[0].click()
            }, spin: function (t, n) {
                o.onSpin(t, n), e(".selectedLine").length > 0 && e(".selectedLine img")[0].click()
            }
        }), e("#" + s + " button").button(), e(e(".toolDialog #spinner" + s).parent()).addClass("spinnerClass"), e("#spinner" + s).addClass("spinnerInput"), e("#spinner" + s).keypress(function (t) {
            t.which == 13 && setTimeout(function () {
                e(":focus").blur()
            }, 100)
        })
    }, s
}), define("tools/TETools/EditLayersTool", ["jquery", "TELang", "tools/ToolDialog", "internal/Globals", "./LayersStorage", "../ToolProtocol", "jscolor", "wfs/GMLParser", "tools/PropertySheet"], function (e, t, n, r, i, s, o, u, a) {
    "use strict";

    function p(e, t, n, r, i) {
        var s = (i - e) * (r - n) / (t - e) + n;
        return s
    }

    function d(t, n) {
        var r = m(n.red, n.green, n.blue);
        e("#" + t).val(r), e("#" + t).css("background-color", "#" + r)
    }

    function v(e) {
        return e = parseInt(e, 10), isNaN(e) ? "00" : (e = Math.max(0, Math.min(e, 255)), "0123456789ABCDEF".charAt((e - e % 16) / 16) + "0123456789ABCDEF".charAt(e % 16))
    }

    function m(e, t, n) {
        var r = p(0, 1, 0, 255, e), i = p(0, 1, 0, 255, t), s = p(0, 1, 0, 255, n), o = v(r) + v(i) + v(s);
        return o
    }

    function g(e, t) {
        return e = e.replace("{s}", t == undefined ? "" : t[Math.floor(Math.random() * t.length)]), e
    }

    function y(e) {
        return e === undefined ? e : Cesium.defaultValue(e.defaultValue, e)
    }

    function b() {
        setTimeout(function () {
            e("body").children().last().css("z-index", "100000")
        }, 50)
    }

    const f = {material: Cesium.Color.WHITE, fill: !0, outline: !0, outlineColor: Cesium.Color.WHITE, outlineWidth: 1},
        l = {material: Cesium.Color.WHITE, width: 1}, c = {image: "./img/defaulticon.png"}, h = {
            BLANK: {type: "blank"},
            SEPARATOR: {type: "separator"},
            GENERAL_HEADER: {label: "General", type: "subheader"},
            POSITION_HEADER: {label: "Position", type: "subheader"},
            APPEARANCE_HEADER: {label: "Appearance", type: "subheader"},
            NAME: {label: t.i18n("edit_layer_name"), type: "textbox", id: "NameId"},
            MATERIAL: {type: "colorpicker", label: t.i18n("edit_layer_color"), id: "colorPickerMaterial"},
            OUTLINE_MATERIAL: {
                type: "colorpicker",
                label: t.i18n("edit_layer_outline_color"),
                id: "outlineColorPickerMaterial"
            },
            OPACITY: {type: "textbox", label: t.i18n("edit_layer_Opacity"), id: "FillOpacityId"},
            WIDTH: {type: "textbox", label: t.i18n("edit_layer_lineWidth"), id: "WidthId"},
            ICON_OR_LABEL: {
                type: "combobox",
                label: t.i18n("edit_layer_icon_or_label"),
                id: "iconOrLabelId",
                comboItems: [{value: "Icon", key: t.i18n("Icon")}, {value: "Label", key: t.i18n("Label")}],
                defaultComboItem: ""
            },
            ICON: {type: "textbox", label: t.i18n("edit_layer_Icon"), id: "layerIconName"},
            LABEL_TEXT: {type: "textbox", label: t.i18n("edit_layer_label_text"), id: "layerLabelText"},
            LABEL_CLASSIFICATION_OPTIONS: {
                type: "combobox",
                label: t.i18n("EditLayerTool_Classification_Label"),
                id: "classificationOptions",
                selectId: "classificationOptionsSelectionBox"
            },
            ALTITUDE_METHOD: {
                label: t.i18n("EditLayerTool_AltitudeMethod"),
                type: "combobox",
                id: "altitudeMethodId",
                comboItems: [{value: 0, key: t.i18n("Relative")}, {value: 3, key: t.i18n("Absolute")}, {
                    value: 2,
                    key: t.i18n("OnTerrain")
                }]
            },
            ALTITUDE_METHOD_RELATIVE_TO_B3DM_COMBO_ITEM: {
                value: 4,
                key: t.i18n("EditLayerTool_AltitudeMethod_RelativeTo3DML")
            },
            ALTITUDE_OFFSET: {label: t.i18n("EditLayerTool_AltitudeOffset"), type: "textbox", id: "altitudeOffsetId"},
            CLAMP_TO: {
                label: t.i18n("EditLayerTool_ClampTo"),
                type: "combobox",
                id: "clampToId",
                comboItems: [{value: 1, key: t.i18n("EditLayerTool_ClampToModel")}, {
                    value: 0,
                    key: t.i18n("EditLayerTool_ClampToTerrain")
                }]
            }
        };
    var w = function () {
        this._layersStorage = i.DefaultStorage, this._layerItemId = "", this._currentItem = null, this._editMode = !1, this._currentType = null, this._isLabel = !0, this._gmlParser = new u(!0, null, null, !0), this.getId = function () {
            return "EditLayersTool"
        }, this.open = function (e) {
            this._editMode = !0;
            var n = this.getFeatureType(e), r = this.getIcon(n);
            this._layerItemId = e.guid, this._layerItemId == undefined ? (this._currentItem = this._layersStorage.createLayerItem(), this._currentItem.name = t.i18n("layers_default_name")) : this._currentItem = e, this.displayLayerProperties(e, n)
        }
    };
    return w.inheritsFrom(s), Cesium.defineProperties(w.prototype, {}), w.prototype.resetClassificationSelectionBox = function () {
        var t = e("#classificationOptionsSelectionBox").options;
        t !== undefined && (t[0].selected = !0)
    }, w.prototype.getFeatureType = function (e) {
        var t = e.Style, n = TerraExplorer.FeatureTypes;
        if (Cesium.defined(t.polygon)) return n.POLYGON;
        if (Cesium.defined(t.polyline)) return n.POLYLINE;
        if (Cesium.defined(t.billboard) || Cesium.defined(t.label)) return n.POINT
    }, w.prototype.requestFeaturePointLayerAttributes = function (t, n, r) {
        var i = this, s = document.getElementById("classificationOptions"), o = g(t, n);
        o += TerraExplorer.functions.queryStringExist(o), o += "SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&outputFormat=GML2&typeName=" + r + "&srsName=EPSG:4326", e.ajax({
            url: o,
            success: function (t) {
                var n = i._gmlParser.read(t);
                if (n[0] != undefined) {
                    var r = n[0].attributes, o = 0;
                    e.each(r, function (t, n) {
                        e("#classificationOptionsSelectionBox").append(e("<option/>", {value: t, text: t}));
                        var r = e("#layerLabelText").val().replace("[", "").replace("]", "");
                        r == t && e(s.options[o + 1]).prop("selected", !0), o++
                    })
                }
            },
            error: function (e, t, n) {
                n !== "abort" && console.log("Failed to retrieve data from " + request + " :" + n)
            }
        })
    }, w.prototype.firstStyleLayer = function (n) {
        return this._currentItem = n, this._currentType = n.type, this._editMode = !1, this._defered = Cesium.when.defer(), this.displayLayerProperties(this._currentItem, this._currentType), e(".toolDialog #CloseButton")[0].textContent = t.i18n("Load"), e(e(".toolDialog #CloseButton")[0]).width("50"), this._defered
    }, w.prototype.getIcon = function (e) {
        var t = TerraExplorer.FeatureTypes, n = "./img/dialogs/Feature_layers_points.png";
        if (e == t.POLYGON) n = "./img/dialogs/Feature_layers_polygons.png"; else if (e == t.POLYLINE || e == t.LINE) n = "./img/dialogs/Feature_layers_polylines.png";
        return n
    }, w.prototype.onClose = function (t) {
        TerraExplorer.tools.ToolDialog.SetPosition();
        if (this._editMode) {
            if (!t) {
                var n = this._currentItem.Style;
                Cesium.defined(n.label) ? e("#layerIconName").val() == "" ? (n.label.fillColor = Cesium.Color.fromCssColorString("#" + e("#colorPickerMaterial").val()), n.label.text = e("#layerLabelText").val()) : (delete n.label, n.billboard = {image: e("#layerIconName").val()}) : Cesium.defined(n.billboard) ? e("#layerIconName").val() != "" ? n.billboard.image = e("#layerIconName").val() : (delete n.billboard, n.label = {
                    fillColor: Cesium.Color.fromCssColorString("#" + e("#colorPickerMaterial").val()),
                    text: e("#layerLabelText").val()
                }) : Cesium.defined(n.polyline) ? (n.polyline.material = Cesium.Color.fromCssColorString("#" + e("#colorPickerMaterial").val()), n.polyline.width = -1 * Number(e("#WidthId").val()), n.polyline.widthInMeters = !1) : Cesium.defined(n.polygon) && (n.polygon.material = Cesium.Color.fromCssColorString("#" + e("#colorPickerMaterial").val()), n.polygon.outline = 1, n.polygon.fill = n.polygon.material.alpha = Number(e("#FillOpacityId").val()) >= 0 && Number(e("#FillOpacityId").val()) <= 1 ? Number(e("#FillOpacityId").val()) : 1, n.polygon.outlineColor = Cesium.Color.fromCssColorString("#" + e("#outlineColorPickerMaterial").val()), n.polygon.outlineWidth = Number(e("#WidthId").val())), n.altitudeMethod = Number(e("#altitudeMethodId").find(":selected").val()), n.altitudeOffset = Number(e("#altitudeOffsetId").val()), this._currentItem.refresh();
                var r = this._layersStorage.createLayerItem();
                r.displayName = this._currentItem._layerDisplayName, r.name = this._currentItem._layerName, r.style = this._currentItem.Style, r.level = this._currentItem._level, r.id = this._currentItem._guid, r.url = this._currentItem._url, this._currentItem.myLayer !== undefined && this._layersStorage.saveItem(this._currentItem), e("#menuIconLayersTool").length > 0 && e("#menuIconLayersTool").click()
            }
        } else {
            if (t) {
                this._defered.reject("canceled");
                return
            }
            if (this._currentType == "FeaturePoint") if (e("#layerIconName").val() != "") var i = {
                billboard: {
                    image: e("#layerIconName").val(),
                    text: e("#layerLabelText").val()
                }
            }; else var i = {
                label: {
                    fillColor: Cesium.defaultValue(Cesium.Color.fromCssColorString("#" + e("#colorPickerMaterial").val()), Cesium.Color.Red),
                    text: Cesium.defaultValue(e("#layerLabelText").val(), "label")
                }
            }; else if (this._currentType == "FeatureLine" || this._currentType == "FeaturePolyline") var i = {
                polyline: {
                    material: Cesium.defaultValue(Cesium.Color.fromCssColorString("#" + e("#colorPickerMaterial").val()), Cesium.Color.Red),
                    width: -1 * Cesium.defaultValue(Number(e("#WidthId").val()), 1),
                    widthInMeters: !1
                }
            }; else if (this._currentType == "FeaturePolygon") {
                var i = {
                    polygon: {
                        material: Cesium.defaultValue(Cesium.Color.fromCssColorString("#" + e("#colorPickerMaterial").val()), Cesium.Color.Red),
                        outline: 1,
                        fill: Cesium.defaultValue(Number(e("#FillOpacityId").val()), 1),
                        outlineColor: Cesium.defaultValue(Cesium.Color.fromCssColorString("#" + e("#outlineColorPickerMaterial").val()), Cesium.Color.Red),
                        outlineWidth: Cesium.defaultValue(Number(e("#WidthId").val()), 1)
                    }
                };
                i.polygon.material.alpha = Cesium.defaultValue(Number(e("#FillOpacityId").val()), 1)
            }
            i.altitudeMethod = Number(e("#altitudeMethodId").find(":selected").val()), i.altitudeOffset = Number(e("#altitudeOffsetId").val()), this._currentItem.style = i, setTimeout(function () {
                e("#menuIconLayersTool").length > 0 && e("#menuIconLayersTool").click()
            }, 2e3);
            var s = TerraExplorer.internal.Project.createFeatureLayers(this._currentItem), o = this;
            s[0].then(function (e) {
                o._defered.resolve(e)
            }).otherwise(function (e) {
                o._defered.reject(e)
            })
        }
        this._currentItem = null
    }, w.prototype.rgbToHsv = function (e) {
        var t = e.r / 255, n = e.g / 255, r = e.b / 255, i = Math.max(t, n, r), s = Math.min(t, n, r), o, u, a = i,
            f = i - s;
        u = i === 0 ? 0 : f / i;
        if (i == s) o = 0; else {
            switch (i) {
                case t:
                    o = (n - r) / f + (n < r ? 6 : 0);
                    break;
                case n:
                    o = (r - t) / f + 2;
                    break;
                case r:
                    o = (t - n) / f + 4
            }
            o /= 6
        }
        return {h: o, s: u, v: a}
    }, w.prototype.hsvToRgb = function (e) {
        var t, n, r, i, s, o, u, a, f = e.h, l = e.s, c = e.v;
        i = Math.floor(f * 6), s = f * 6 - i, o = c * (1 - l), u = c * (1 - s * l), a = c * (1 - (1 - s) * l);
        switch (i % 6) {
            case 0:
                t = c, n = a, r = o;
                break;
            case 1:
                t = u, n = c, r = o;
                break;
            case 2:
                t = o, n = c, r = a;
                break;
            case 3:
                t = o, n = u, r = c;
                break;
            case 4:
                t = a, n = o, r = c;
                break;
            case 5:
                t = c, n = o, r = u
        }
        return {r: t * 255, g: n * 255, b: r * 255}
    }, w.prototype.lerpBetweenNumbers = function (e, t, n) {
        return Math.min(e, t) + (Math.max(e, t) - Math.min(e, t)) * n
    }, w.prototype.fillPropertiesForLayer = function (n, r) {
        var i = TerraExplorer.FeatureTypes, s = n.Style;
        if (s === undefined) {
            s = {};
            switch (r) {
                case i.POLYGON:
                    s.polygon = e.extend(!0, {}, f);
                    break;
                case i.POLYLINE:
                case i.LINE:
                    s.polyline = e.extend(!0, {}, l);
                    break;
                case i.POINT:
                    s.billboard = e.extend(!0, {}, c)
            }
        }
        var o = this;
        e("#NameId").val(Cesium.defaultValue(n.LayerDisplayName, n.displayName)), e("#TypeId").val(t.i18n(r));
        var u = e("#altitudeMethodId"), a = e("#altitudeMethodId select"), h = e("#altitudeOffsetId"),
            p = e("#altitudeOffsetIdRowId"), v = e("#clampToIdRowId"), m = e("#clampToIdRowId select"),
            g = e("#clampToId");
        s.altitudeMethod !== undefined && s.altitudeMethod !== null ? a.val(s.altitudeMethod) : (a.val(0), s.altitudeMethod = 0), s.altitudeOffset !== undefined && s.altitudeOffset !== null && s.altitudeOffset.defaultValue === undefined ? h.val(s.altitudeOffset) : h.val(0), a.val() == 0 ? v.addClass("disabled") : a.val() == 3 ? v.addClass("disabled") : p.addClass("disabled"), s.altitudeMethod == 0 || s.altitudeMethod == 4 ? (p.hasClass("disabled") && p.removeClass("disabled"), v.addClass("disabled")) : s.altitudeMethod == 3 ? (p.hasClass("disabled") && p.removeClass("disabled"), v.addClass("disabled")) : v.hasClass("disabled") && v.removeClass("disabled"), u.on("change", function (e) {
            s.altitudeMethod = Number(u.find(":selected").val()), s.altitudeMethod == 0 || s.altitudeMethod == 4 ? (p.hasClass("disabled") && p.removeClass("disabled"), v.addClass("disabled")) : s.altitudeMethod == 3 ? (p.hasClass("disabled") && p.removeClass("disabled"), v.addClass("disabled")) : (v.hasClass("disabled") && v.removeClass("disabled"), p.addClass("disabled"))
        });
        if (r === i.POLYGON) {
            var b = s.polygon;
            d("colorPickerMaterial", y(b.material)), d("outlineColorPickerMaterial", y(b.outlineColor)), e("#WidthId").val(y(b.outlineWidth)), e("#WidthId").on("change", function () {
                isNaN(Number(this.value)) ? this.value = 1 : this.value = Math.max(Math.min(Math.abs(this.value), 5), 1)
            }), b.fromKml === undefined ? e("#FillOpacityId").val(y(b.material).alpha) : e("#FillOpacityId").val(y(b.fill)), b.groundClampingMethod === TerraExplorer.GroundClampingMethod.CLAMPS_TO_MODEL ? m.val(TerraExplorer.GroundClampingMethod.CLAMPS_TO_MODEL) : m.val(TerraExplorer.GroundClampingMethod.CLAMPS_TO_TERRAIN), g.on("change", function () {
                Number(g.find(":selected").val()) === 1 ? b.groundClampingMethod = TerraExplorer.GroundClampingMethod.CLAMPS_TO_MODEL : b.groundClampingMethod = TerraExplorer.GroundClampingMethod.CLAMPS_TO_FLOOR
            })
        } else if (r === i.POLYLINE || r === i.LINE) {
            var w = s.polyline;
            e("#WidthId").on("change", function () {
                isNaN(Number(this.value)) ? this.value = 1 : this.value = Math.max(Math.min(Math.abs(this.value), 5), 1)
            });
            var E = y(w.width);
            w.widthInMeters ? e("#WidthId").val("1") : e("#WidthId").val(Math.max(Math.min(Math.abs(E), 5), 1)), d("colorPickerMaterial", y(w.material)), w.groundClampingMethod === TerraExplorer.GroundClampingMethod.CLAMPS_TO_MODEL ? m.val(TerraExplorer.GroundClampingMethod.CLAMPS_TO_MODEL) : m.val(TerraExplorer.GroundClampingMethod.CLAMPS_TO_TERRAIN), g.on("change", function () {
                Number(g.find(":selected").val()) === 1 ? w.groundClampingMethod = TerraExplorer.GroundClampingMethod.CLAMPS_TO_MODEL : w.groundClampingMethod = TerraExplorer.GroundClampingMethod.CLAMPS_TO_FLOOR
            })
        } else if (r === i.POINT) {
            var S = s.label, x = s.billboard, T = e("#layerIconNameRowId"), N = e("#layerLabelTextRowId"),
                C = e("#colorPickerMaterialRowId"), k = e("#classificationOptionsRowId"), L = e("#iconOrLabelId"),
                A = e("#layerLabelText"), O = e("#layerIconName"), M = e("#classificationOptions");
            if (Cesium.defined(S)) {
                var _ = y(S.text), D = y(S.fillColor);
                L.val(t.i18n("Label")), T.addClass("disabled"), L.val("")
            } else if (Cesium.defined(x)) {
                L.val(t.i18n("Icon"));
                var P = y(x.image);
                N.addClass("disabled"), C.addClass("disabled"), k.addClass("disabled")
            }
            A.val(_), Cesium.defined(D) ? d("colorPickerMaterial", D) : (e("#colorPickerMaterial").val("FFFFFF"), e("#colorPickerMaterial").css("background-color", "#FFFFFF")), O.val(P), L.on("change", function () {
                L.find(":selected").val() == t.i18n("Label") ? (T.addClass("disabled"), O.val(""), A.val("label text"), N.hasClass("disabled") && N.removeClass("disabled"), C.hasClass("disabled") && C.removeClass("disabled"), k.hasClass("disabled") && k.removeClass("disabled")) : (A.val(""), O.val("./img/defaulticon.png"), C.addClass("disabled"), N.addClass("disabled"), k.addClass("disabled"), T.hasClass("disabled") && T.removeClass("disabled")), o.resetClassificationSelectionBox()
            }), M.on("change", function (e) {
                M.val() != t.i18n("edit_layers_label_text") ? A.val("[" + M.val() + "]") : A.val(M.val())
            });
            var H = Cesium.defaultValue(n._url, n.url), B = Cesium.defaultValue(n._subdomains, n.subdomains),
                j = Cesium.defaultValue(n._layerName, n.name);
            this.requestFeaturePointLayerAttributes(H, B, j)
        }
    }, w.prototype.createPropObjForLayer = function (n, r) {
        return {
            title: t.i18n("Edit_Feature_Layer_Style"),
            img: "./img/layers.png",
            id: "editLayerId",
            onCloseDialogUpdate: e.proxy(this.onClose, this),
            fields: this.createPropertiesFields(r)
        }
    }, w.prototype.getLayerTypeField = function (e) {
        return {label: t.i18n("edit_layer_type"), type: "textbox", id: "TypeId", disabled: !0, img: this.getIcon(e)}
    }, w.prototype.getGeneralOptionsFields = function (e) {
        return [h.GENERAL_HEADER, h.SEPARATOR, h.NAME, this.getLayerTypeField(e)]
    }, w.prototype.getAppearanceOptionsFields = function () {
        return [h.APPEARANCE_HEADER, h.SEPARATOR]
    }, w.prototype.getPolylineFields = function () {
        return [h.MATERIAL, h.WIDTH]
    }, w.prototype.getPolygonFields = function () {
        return [h.MATERIAL, h.OPACITY, h.OUTLINE_MATERIAL, h.WIDTH]
    }, w.prototype.getPointFields = function () {
        return [h.ICON_OR_LABEL, h.BLANK, h.MATERIAL, h.LABEL_TEXT, h.LABEL_CLASSIFICATION_OPTIONS, h.SEPARATOR, h.ICON]
    }, w.prototype.getPositionFields = function (t) {
        var n = TerraExplorer.FeatureTypes, r = e.extend(!0, {}, h.ALTITUDE_METHOD);
        if (t === n.POINT) {
            r.comboItems.pop();
            var i = r.comboItems;
            i.push(h.ALTITUDE_METHOD_RELATIVE_TO_B3DM_COMBO_ITEM), r.comboItems = i
        }
        var s = [h.POSITION_HEADER, h.SEPARATOR, r, h.ALTITUDE_OFFSET];
        return t !== TerraExplorer.FeatureTypes.POINT && (s = s.concat([h.SEPARATOR, h.CLAMP_TO, h.BLANK])), s
    }, w.prototype.createPropertiesFields = function (e) {
        var t = TerraExplorer.FeatureTypes, n = this.getGeneralOptionsFields(e).concat(h.BLANK),
            r = this.getAppearanceOptionsFields(), i = this.getPositionFields(e).concat(h.BLANK), s;
        switch (e) {
            case t.POLYGON:
                s = this.getPolygonFields();
                break;
            case t.POLYLINE:
            case t.LINE:
                s = this.getPolylineFields();
                break;
            case t.POINT:
                s = this.getPointFields()
        }
        return n.concat(r).concat(s.concat(h.BLANK)).concat(i)
    }, w.prototype.displayLayerProperties = function (e, t) {
        var n = this.createPropObjForLayer(e, t), r = new TerraExplorer.tools.PropertySheet(n);
        this.fillPropertiesForLayer(e, t)
    }, w
}), define("tools/TETools/AttributeTableTool", ["jquery", "TELang", "tools/ToolDialog", "internal/Globals", "../ToolProtocol", "wfs/GMLParser", "internal/simpleSqlParser", "internal/Navigate", "internal/TEPosition", "internal/Settings"], function (e, t, n, r, i, s, o, u, a, f) {
    "use strict";

    function c() {
        e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0), e("#attrTblLabel").width("100px"), e(".queryFieldDiv").width("15%"), e(".queryFieldDiv").css("margin-right", "15px"), e("#attrTblQueryField").width("100%"), e("#attrTblSearchButton").width("80px"), e("#attrTblConditionsList").css("margin-left", "5px"), e("#attrTblFieldNameList").width("60px"), e("#attrTblValueField").width("135px")
    }

    function h(n) {
        var r = e("<div id='attributeTableDiv' style='position:absolute; width: 100%; height: 90%; top: 40px'></div>"),
            i = e("<div id='topDiv' style='position:relative; min-width: 1000px; width:100%; height: 85px; background-color: black;  color: white;'></div>");
        i.appendTo(r);
        var s = e("<div id='attrTblQueryDiv' style='position:relative; padding-top: 15px; padding-bottom: 10px; width: 100% '></div>");
        s.appendTo(i);
        var o = e("<label id='attrTblLabel' style='width: 150px; display: inline-block; text-align: center; font-size: smaller;' />");
        o.text(t.i18n("AttrTable_search_string") + ":"), o.appendTo(s);
        var u = e("<div class='queryFieldDiv' style='display: inline-block; position:relative;width:450px;margin-right:20px; '></div>"),
            a = e("<input id='attrTblQueryField' type='text' class='jscolor jscolor-active' style='width:450px; ' />");
        a.appendTo(u);
        var f = e('<img id="attrTblClearQuery" src="./img/x.png" title="Clear" width="10" height="10" style="cursor:pointer; position:absolute; top: 5px; right: 0px "/>');
        f.appendTo(u), u.appendTo(s);
        var l = e("<input id='attrTblSearchButton' type='button' class='link' style='width:120px;height:23px;background-color:rgba(221,221,221,1.0); border:0px; color:rgba(50,50,50,1.0);' value='" + t.i18n("AttrTable_Button_search") + "' />");
        l.appendTo(s);
        var c = e("<div id='attrTblQueryBuildDiv' style='position:relative; width: 100%'></div>");
        c.appendTo(i);
        var h = e("<select id='attrTblConditionsList' style='width:55px; margin-right:5px; margin-left: 150px; height: 21px;'><option value='and'>AND</option><option value='or'>OR</option></select>");
        h.appendTo(c);
        var p = e("<select id='attrTblFieldNameList' style='width:110px; margin-right:5px; height: 21px;'></select>");
        p.appendTo(c);
        var d = e("<select id='attrTblOperatorsList' style='width:55px; margin-right:5px; height: 21px;'></select>");
        e("<option value='equal'>&equals;</option>").appendTo(d), e("<option value='notequal'>&#60;&#62;</option>").appendTo(d), e("<option class='numberField' value='greater'>&#62;</option>").appendTo(d), e("<option class='numberField' value='greaterequal'>&#62;&equals;</option>").appendTo(d), e("<option class='numberField' value='less'>&#60;</option>").appendTo(d), e("<option class='numberField' value='lessequal'>&#60;&equals;</option>").appendTo(d), e("<option class='textField' value='like'>Like</option>").appendTo(d), d.appendTo(c);
        var v = e("<input id='attrTblValueField' type='text' style='width:187px; margin-right:5px;' />");
        v.appendTo(c);
        var m = e("<input id='attrTblAddButton' type='button' class='uploadButton ui-button' />");
        m.appendTo(c);
        var g = e("<div id='attrTblResultDetailsDiv' style='position:relative; width:98%; margin: 0 auto; height: 35px; padding-top: 10px;'></div>");
        g.appendTo(r), e('<span style="font-weight: bold; font-size: larger;">Search Results</span>').appendTo(g);
        var y = e('<span id="attrTblTotalFeatureDisplay" style="padding-left: 15px; font-weight: bold; font-size: smaller;"></span>');
        y.appendTo(g);
        var b = e("<img class='link redoUndo' src='img/dialogs/Ribbon_Redo.png' id='DialogRedoButton' title='" + t.i18n("Button_redo") + "' alt='" + t.i18n("Button_redo") + "' style='position:absolute; right:0px; top: 25px; display: none;' disabled='disabled' />");
        b.appendTo(g);
        var w = e("<img class='link redoUndo' src='img/dialogs/Ribbon_Undo.png' id='DialogUndoButton' title='" + t.i18n("Button_undo") + "' alt='" + t.i18n("Button_undo") + "' style='position:absolute; right:30px; top: 25px; display: none;' disabled='disabled' />");
        w.appendTo(g);
        var E = e("<div id='attrTblResultTableDiv' style='position:relative; width:98%; height: calc(100% - 210px); overflow: auto; margin: 0 auto;'></div>");
        E.appendTo(r);
        var S = e("<table id='attrTblResultTable' class='altRows nopostprocessing iw-mTrigger' style='width:100%;  border-collapse: collapse; display: none;' ></table>");
        S.appendTo(E);
        var x = e("<thead class='dataHeader'></thead>");
        x.appendTo(S);
        var T = e("<tr></tr>");
        T.appendTo(x);
        var N = e("<tbody></tbody>");
        N.appendTo(S);
        var C = e('<div id="waitOverlay" class="loaderWait"></div>').hide(),
            k = e('<div id="waitLoader" class="loaderWait" align="center"><br /><span style="margin-top:100px;">' + t.i18n("AttrTable_loading_wait") + "</span><br /><br />" + '<img src="./img/loader.gif" /></div>').hide();
        C.appendTo(r), k.appendTo(r), n._layer.attrTblDialogMemo = {}, n._layer.attrTblDialogMemo.content = r, n._layer.attrTblDialogMemo.layerName = n._layer._layerDisplayName, n._layer.attrTblDialogMemo.dialogWidth = n.dialogWidth, n._layer.attrTblDialogMemo.dialogHeight = n.dialogHeight, n._layer.attrTblDialogMemo.dialogPosition = "absolute", e.GlobalAttrTblDialogPositionX = 350, e.GlobalAttrTblDialogPositionY = 50
    }

    function p(n, r) {
        var i = r.content.find("#attrTblAddButton"), s = r.content.find("#attrTblValueField"),
            u = r.content.find("#attrTblQueryField"), a = r.content.find("#attrTblConditionsList"),
            f = r.content.find("#attrTblFieldNameList"), l = r.content.find("#attrTblOperatorsList"),
            c = r.content.find("#attrTblSearchButton"), h = r.content.find("#attrTblResultTable"),
            p = r.content.find("#attrTblResultTable tbody"), v = r.content.find("#attrTblResultTable thead"),
            m = r.content.find("#attrTblClearQuery");
        f.find("option").remove(), e(n._layer.geomFields).each(function () {
            if (n._layer.isAttributeField(this.name, this.type)) switch (this.type.toLowerCase()) {
                case"string":
                    e("<option typeClass='textField' value='" + this.name + "'>" + this.name + "</option>").appendTo(f);
                    break;
                case"integer":
                case"double":
                    e("<option typeClass='numberField' value='" + this.name + "'>" + this.name + "</option>").appendTo(f)
            }
        }), m.click(function () {
            u.val("")
        }), i.click(function () {
            if (f.val() == "" || s.val() == "") return;
            var e = "";
            u.val().replace(/[ ]/g, "") != "" && (e = " " + a.find(":selected").text() + " "), e += f.val() + " ", e += l.find(":selected").text() + " ";
            var t = f.find(":selected").attr("typeclass") == "textField";
            e += (t ? "'" : "") + s.val() + (t ? "'" : ""), u.val(u.val() + e)
        }), f.change(function () {
            var t = e(this).find(":selected");
            t = e(t[0]);
            var n = t.attr("typeClass") == "textField";
            n ? (e(".textField").show(), e(".numberField").hide()) : (e(".textField").hide(), e(".numberField").show()), e("#attrTblOperatorsList")[0].selectedIndex = 0
        }), c.click(function (i) {
            if (n._layer.lastEditedCell && n._layer.lastEditedCell.td && !confirm(t.i18n("AttrTable_save_changes"))) return;
            if (u.val().replace(/[ ]/g, "") != "") {
                var s = "select * from x where ", a = C(s + u.val(), o, n._layer.getFeatureColumnNames());
                if (!a) {
                    alert(t.i18n("AttrTable_query_illegal"));
                    return
                }
            }
            h.find("tr").remove(), d(n), e(".loaderWait").show(), n.attrTblGetFeatureXhr = {}, n._layer.getFeatures(u.val(), n.attrTblGetFeatureXhr, function (r, i) {
                var s = e(r).sort(function (e, t) {
                    return e.fid - t.fid
                });
                if (i) {
                    i && alert(t.i18n("AttrTable_search_failed")), e(".loaderWait").hide();
                    return
                }
                s.each(function () {
                    g(n, this)
                });
                var o = p.find("tr").length > 0 ? p.find("tr").length + "/" + p.find("tr").length : "0";
                e("#attrTblTotalFeatureDisplay").text(t.i18n("AttrTable_display_results", {itemscount: o.toString()})), h.show(), h.trigger("update"), e(".loaderWait").hide()
            }), r.content.find("#attrTblResultTable").tablesorter(), n._layer.lastEditedCell = null, T(n), n._onContentChanged !== undefined && n._onContentChanged()
        }), p.find("tr").dblclick(function () {
            w(), b(n, this.feature)
        }), n.allowAttributeEditing && n._layer._operations.update && p.find("tr td:gt(0)").click(function () {
            y(n, this)
        })
    }

    function d(t) {
        var n = e("#attrTblResultTable thead"), r = e("<tr></tr>");
        r.appendTo(n);
        var i = e("<th style='border: 1px solid #a8aaac; padding-left: 4px;min-width:75px;max-width:75px;width:75px;'>FID</th>");
        i.appendTo(r), e(t._layer.geomFields).each(function () {
            if (t._layer.isAttributeField(this.name, this.type)) {
                var n = e("<th fieldType='" + this.type.toLowerCase() + "' style='border: 1px solid #a8aaac; min-width:75px;max-width:75px;width:75px; '>" + this.name + "</th>");
                n.appendTo(r)
            }
        })
    }

    function v(n, r) {
        var i = e("#attrTblResultTable"), s = e("#attrTblResultTable tbody");
        i.find("tr").remove(), d(n);
        var o = e(r).sort(function (e, t) {
            return e.fid - t.fid
        });
        o.each(function () {
            g(n, this)
        });
        if (s.find("tr").length >= n._layer.getRequestMaxFeatures()) {
            var u = n._layer.getRequestMaxFeatures();
            e("#attrTblTotalFeatureDisplay").text(t.i18n("AttrTable_display_first_results", {firstItemscount: u.toString()}))
        } else {
            var a = s.find("tr").length > 0 ? s.find("tr").length + "/" + s.find("tr").length : "0";
            e("#attrTblTotalFeatureDisplay").text(t.i18n("AttrTable_display_results", {itemscount: a.toString()}))
        }
        i.show(), i.trigger("update")
    }

    function m(t, n) {
        if (t.allowAttributeEditing && t._layer._operations.update) {
            var r = e(".toolDialog #DialogSaveButton"), i = n.content.find("#DialogUndoButton"),
                s = n.content.find("#DialogRedoButton"), o = n.content.find("#attrTblFieldNameList"),
                u = n.content.find("#attrTblResultTable thead");
            r.show(), i.show(), s.show(), r.click(function () {
                r.attr("disabled", "disabled");
                var n = [], i = u.find("th"), s = N(t);
                e(s).each(function () {
                    var t = e(this), r = this.feature;
                    t.find("td").each(function () {
                        if (this.cellIndex == 0) return !0;
                        var t = this.innerHTML;
                        t == null && (t = e(this).text()), r[i.eq(this.cellIndex).html()] = this.innerHTML
                    }), n.push(r)
                }), e(".loaderWait").show(), t._layer.updateFeatures(n, function (n) {
                    e(".loaderWait").hide(), n ? alert(n) : t._layer.lastEditedCell = null, T(t)
                })
            }), i.click(function () {
                t._layer.lastEditedCell && t._layer.lastEditedCell.previousContent != null && (t._layer.lastEditedCell.td.html(t._layer.lastEditedCell.previousContent), t._layer.lastEditedCell = t._layer.lastEditedCell.previous), T(t)
            }), s.click(function () {
                t._layer.lastEditedCell && t._layer.lastEditedCell.next && (t._layer.lastEditedCell = t._layer.lastEditedCell.next, t._layer.lastEditedCell.td.html(t._layer.lastEditedCell.currrentContent)), T(t)
            }), T(t)
        }
    }

    function g(t, n) {
        var r = e("<tr class='datarow' style='cursor:pointer' originFid='" + n.originFid + "'></tr>"),
            i = e("<td style='border: 1px solid #a8aaac;'>" + n.fid + "</td>"), s = e("#attrTblResultTable tbody");
        t.allowAttributeEditing && t._layer._operations.update && i.click(function () {
            if (this.cellIndex == 0) return;
            var t = e(n), r = e("<input type='text' />");
            r.val(t.html()), t.attr("originContent") || t.attr("originContent", t.html()), t.html(r[0])
        }), i.appendTo(r);
        var o = "";
        e(t._layer.geomFields).each(function () {
            if (t._layer.isAttributeField(this.name, this.type)) {
                var e = n[this.name] == null ? "" : n[this.name];
                o += "<td style='border: 1px solid #a8aaac;'>" + e + "</td>"
            }
        });
        var u = e(o);
        t.allowAttributeEditing && t._layer._operations.update && u.click(function () {
            y(t, this)
        }), u.appendTo(r), r[0].feature = n, r.dblclick(function () {
            w(), b(t, this.feature)
        }), r.appendTo(s)
    }

    function y(t, n) {
        if (n.cellIndex == 0) return;
        var r = e("#attrTblResultTable thead"), i = e(n), s = e("<input style='margin: 0 auto' type='text' />");
        s.val(i.html()), i.attr("originContent") || i.attr("originContent", i.html()), s.attr("lastContent", i.html()), i.off("click"), s.blur(function () {
            if (s.attr("cancelEdit") == "1") i.html(s.attr("lastContent")), s.removeAttr("cancelEdit"); else {
                var e = r.find("th").eq(i.index()).attr("fieldType"), o = s.val();
                E(o, e) ? (o != null && o != "" ? i.html(o) : i.html(S(e)), i.html() != s.attr("lastContent") && x(i, s.attr("lastContent"), t)) : (alert("Value is not valid"), i.html(s.attr("lastContent")))
            }
            i.click(function () {
                y(t, n)
            })
        }), s.keydown(function (e) {
            e.which == 13 && s.blur(), e.which == 27 && (s.attr("cancelEdit", "1"), s.blur())
        }), s.width(i.width() - 10), i.html(s[0]), s.select().focus()
    }

    function b(e, t) {
        function n(e) {
            var t = new a({
                cartesian: e.center,
                headingPitchRange: new Cesium.HeadingPitchRange(0, Cesium.Math.toRadians(-70), e.radius === 0 ? 1e3 : e.radius * 3)
            });
            u.flyToPosition(t)
        }

        t.boundingSphere ? n(t.boundingSphere) : e._layer.boundingSphereFromGML("<wfs:FeatureCollection><gml:featureMember>" + t.node.outerHTML + "</gml:featureMember></wfs:FeatureCollection>", n)
    }

    function E(e, t) {
        return t ? (t = t.toLowerCase(), t == "string" || e == null || e == "" ? !0 : e.match(/^\s*[\-]?(\d+[.])?[0-9]+\s*$/)) : !1
    }

    function S(e) {
        return !e || e == "string" ? "" : 0
    }

    function x(e, t, n) {
        var r = {td: e, currrentContent: e.html(), previousContent: t, previous: n._layer.lastEditedCell, next: null};
        n._layer.lastEditedCell || (n._layer.lastEditedCell = {}), n._layer.lastEditedCell.next = r, r.previous = n._layer.lastEditedCell, n._layer.lastEditedCell = r, T(n)
    }

    function T(t) {
        var n = e("#DialogUndoButton"), r = e("#DialogRedoButton"), i = e("#DialogSaveButton");
        !t._layer.lastEditedCell || !t._layer.lastEditedCell.next ? r.attr("disabled", "disabled") : r.removeAttr("disabled"), !t._layer.lastEditedCell || t._layer.lastEditedCell.previousContent == null ? (n.attr("disabled", "disabled"), i.attr("disabled", "disabled")) : (n.removeAttr("disabled"), i.removeAttr("disabled"))
    }

    function N(e) {
        var t = [], n = e._layer.lastEditedCell;
        while (n && n.td) t.indexOf(n.td.parent()[0]) == -1 && t.push(n.td.parent()[0]), n = n.previous;
        return t
    }

    function C(e, t, n) {
        var r = t.sql2ast(e), i = e.toLowerCase().replace(/[- ()]/g, ""),
            s = t.ast2sql(r).toLowerCase().replace(/[- ()]/g, "");
        if (i != s) return !1;
        var o = r.WHERE != null && k(r.WHERE, n);
        return o
    }

    function k(e, t) {
        if (e.operator && e.left && e.right) return t.indexOf(e.left.toLowerCase()) == -1 && t.indexOf(e.right.toLowerCase()) == -1 ? !1 : !0;
        if (!e.logic) return !1;
        if (e.logic && (e.logic.toLowerCase() == "and" || e.logic.toLowerCase() == "or")) for (var n = 0; n < e.terms.length; n++) {
            var r = k(e.terms[n], t);
            if (!r) return !1
        }
        return !0
    }

    var l = function () {
        this._gmlParser = new s(!0, null, null, !0);
        var r = this;
        r.simpleSqlParser = o, r.attrTblGetFeatureXhr = {}, r.dialogWidth = "74%", r.dialogHeight = 700, r.Settings = f, r.allowAttributeEditing = f.allowAttributeEditing && f.allowAttributeEditing.toString() == "true", this.getId = function () {
            return "AttributeTableTool"
        }, this.open = function (i) {
            r._onContentChanged !== undefined && r._onContentChanged(), r._layer = i.layer, r._onLoadQuery = i.onLoadQuery, r._onLoadFeatures = i.onLoadFeatures, r._onClose = i.onClose, r._onContentChanged = i.onContentChanged, r._layer.attrTblDialogMemo || h(r);
            var s = r._layer.attrTblDialogMemo;
            p(r, s), n.PositionX = e.GlobalAttrTblDialogPositionX, n.PositionY = e.GlobalAttrTblDialogPositionY, n.Position = "absolute", n.open(t.i18n("Attribute_Table_Title"), "./img/dialogs/actions/attribute_table.png", s.content.get(0), e.proxy(this.onClose, this), !0, !1, !1), m(r, s), e("#titleTextID").text(e("#titleTextID").text() + " - " + s.layerName), s.content.find("#attrTblFieldNameList").change(), s.content.find("#attrTblResultTable").tablesorter(), s.width ? e(".toolDialog").width(s.width) : e(".toolDialog").width(s.dialogWidth), s.height ? e(".toolDialog").height(s.height) : e(".toolDialog").height(s.dialogHeight), e(".loaderWait").hide(), r._onLoadQuery != null ? (e("#attrTblQueryField").val(r._onLoadQuery), e("#attrTblSearchButton").click()) : r._onLoadFeatures != null && v(r, r._onLoadFeatures), TerraExplorer.isTouch() && c()
        }
    };
    l.prototype.onClose = function (t) {
        this._layer.attrTblDialogMemo.width = e(".toolDialog").width(), this._layer.attrTblDialogMemo.height = e(".toolDialog").height(), e.GlobalAttrTblDialogPositionX = e(".toolDialog").offset().left, e.GlobalAttrTblDialogPositionY = e(".toolDialog").offset().top, this.attrTblGetFeatureXhr.xhr && this.attrTblGetFeatureXhr.xhr.abort(), this._onClose !== undefined && this._onClose()
    };
    var w = function () {
        if (document.selection && document.selection.empty) document.selection.empty(); else if (window.getSelection) {
            var e = window.getSelection();
            e.removeAllRanges()
        }
    };
    return l
}), define("tools/TETools/PresentationTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "../ToolDelegate", "../ToolContainer", "internal/NotificationCenter", "internal/Presentation"], function (e, t, n, r, i, s, o, u, a) {
    "use strict";

    function f() {
        this._currentPresentation = null, this.getId = function () {
            return "PresentationTool"
        }, u.addObserver(this, "onPresentationStatusChanged", "TEN_PRESENTATION_STATUS_CHANGED", null), u.addObserver(this, "onPresentationStep", "TEN_PRESENTATION_STEP", null)
    }

    return f.inheritsFrom(s), Cesium.defineProperties(f.prototype, {}), f.prototype.onOpenedToolContainer = function () {
        this.setCaption()
    }, f.prototype.onBeforeOpenToolContainer = function () {
        return e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this.ToolContainer.addButton(1, "./img/rewind.png", undefined, t.i18n("PresentationTool_Rewind_ToolTip")), this.ToolContainer.addButton(2, "./img/pause.png", undefined, t.i18n("PresentationTool_PlayPause_ToolTip")), this.ToolContainer.addButton(3, "./img/forward.png", undefined, t.i18n("PresentationTool_Forward_ToolTip")), this.ToolContainer.addButton(4, "./img/list.png", undefined, t.i18n("PresentationTool_ListSteps_ToolTip")), this._toolContainer.setText("<p id=PresentationStepIndex style='font-size:80%;color:gray;'><p><p id=PresentationStepMessageId><p>"), !0
    }, f.prototype.onBeforeCloseToolContainer = function (e) {
        return this.parent.onBeforeCloseToolContainer.call(this, e), this._toolContainer = null, this._currentPresentation.stop(), this._currentPresentation = null, !0
    }, f.prototype.onButtonClick = function (e) {
        this.parent.onButtonClick.call(this, e);
        switch (e) {
            case 1:
                this._currentPresentation.previous();
                break;
            case 2:
                this._currentPresentation.Status == a.PAUSED ? this._currentPresentation.resume() : this._currentPresentation.Status == a.WAITINGCLICK ? this._currentPresentation.continue() : this._currentPresentation.Status == a.PLAYING && this._currentPresentation.pause();
                break;
            case 3:
                this._currentPresentation.next();
                break;
            case 4:
                this._currentPresentation.showKeySteps()
        }
    }, f.prototype.setCaption = function () {
        e(e(".toolHeaderContainer")[0]).text(t.i18n("PresentationTool_PresentationCaption", {presentationName: this.caption}))
    }, f.prototype.onPresentationStatusChanged = function (e) {
        if (this._currentPresentation == null || e != this._currentPresentation) {
            if (e.Status == a.NOTPLAYING) return;
            this.caption = e.Name;
            if (o.showWithDelegate(this) == 0) return
        }
        this._currentPresentation = e;
        if (this._toolContainer) switch (this._currentPresentation.Status) {
            case a.PLAYING:
                this._toolContainer.updateButton(2, "./img/pause.png");
                break;
            case a.BEFORE_SWITCHING_TO_ANOTHER_PRESENTATION:
                break;
            case a.NOTPLAYING:
                this._toolContainer.hideAndClearDelegate();
                break;
            case a.PAUSED:
            case a.WAITINGCLICK:
                this._toolContainer.updateButton(2, "./img/play.png")
        }
    }, f.prototype.onPresentationStep = function (n) {
        if (this._toolContainer != null) {
            if (n.StepIndex < 0 || n.StepIndex >= n.Steps.length) return;
            var r = n.Steps[n.StepIndex];
            switch (r.type) {
                case"Wait":
                    e("#PresentationStepIndex").text(t.i18n("presentation_Wait_Seconds", {numSeconds: r.duration}));
                    break;
                case"FlyTo":
                    var i = Cesium.Cartographic.fromCartesian(r.tePosition.cartesian);
                    e("#PresentationStepIndex").text(t.i18n("presentation_Flyto") + "  " + Cesium.Math.toDegrees(i.latitude).toFixed(5) + ", " + Cesium.Math.toDegrees(i.longitude).toFixed(5));
                    break;
                case"Caption":
                    e("#PresentationStepMessageId").text(r.text);
                    break;
                case"message":
                    break;
                case"playSpeedStep":
                    e("#PresentationStepIndex").text(t.i18n("presentation_Play_Speed") + " " + r.speed)
            }
        }
    }, f
}), define("tools/TETools/PresentationStepsTool", ["jquery", "TELang", "tools/ToolDialog", "tools/ListControl", "internal/Presentation", "internal/NotificationCenter", "internal/Navigate", "internal/Globals", "../ToolProtocol"], function (e, t, n, r, i, s, o, u, a) {
    "use strict";
    var f = function () {
        this._currentPresentation = null, this._listControl = null, this.getId = function () {
            return "PresentationStepsTool"
        }, s.addObserver(this, "onPresentationStatusChanged", "TEN_PRESENTATION_STATUS_CHANGED", null), s.addObserver(this, "onPresentationStep", "TEN_PRESENTATION_STEP", null), this.open = function (i) {
            this._currentPresentation = i;
            var s = TerraExplorer.getCurrentPresentation();
            s !== null && s.Name !== this._currentPresentation.Name && (s.stop(), this._currentPresentation.play());
            var o = e("<div class='PresentationStepsDivClass' style='position:absolute; width:400px; height:220px; '></div>"),
                u = e("<div style='position:absolute; overflow-y:auto; width:100%;'></div>");
            o.append(u), this._listControl = new r(u), n.PositionX = 350, n.PositionY = 100, n.open(t.i18n("title_activity_presentation", {presentationName: this._currentPresentation.Name}), "./img/list.png", o.get(0), e.proxy(this.onClose, this)), u.css({height: o.height()}), this._listControl.LinePadding = 5;
            if (this._currentPresentation) {
                for (var a = 0; a < this._currentPresentation.Steps.length; a++) {
                    var f = (a + 1).toString() + ". ";
                    if (this._currentPresentation.Steps[a].type === "FlyTo") {
                        var l = Cesium.Cartographic.fromCartesian(this._currentPresentation.Steps[a].tePosition.cartesian);
                        f += t.i18n("presentation_Flyto") + " " + Cesium.Math.toDegrees(l.latitude).toFixed(5) + ", " + Cesium.Math.toDegrees(l.longitude).toFixed(5)
                    } else this._currentPresentation.Steps[a].type === "Wait" ? f += t.i18n("presentation_Wait") + " " + this._currentPresentation.Steps[a].duration.toFixed(2) + " " + t.i18n("presentation_seconds") : this._currentPresentation.Steps[a].type === "Caption" ? this._currentPresentation.Steps[a].text.length > 0 ? f += t.i18n("presentation_Caption") + " <span style='color:gray;'>(" + this._currentPresentation.Steps[a].text + ")</span>" : f += t.i18n("presentation_ClearCaption") : this._currentPresentation.Steps[a].type === "message" ? f += t.i18n("presentation_Message") + " " : this._currentPresentation.Steps[a].type === "playSpeedStep" && (f += t.i18n("presentation_Play_Speed") + " " + this._currentPresentation.Steps[a].speed);
                    this._listControl.add({presentation: !0, onClick: e.proxy(this.onStepClicked, this), text: f})
                }
                this.onPresentationStep(this._currentPresentation)
            }
            TerraExplorer.isTouch() && (e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0), e(".PresentationStepsDivClass").width("100%"), e(".PresentationStepsDivClass").height("100%"))
        }
    };
    return f.inheritsFrom(a), Cesium.defineProperties(f.prototype, {}), f.prototype.onStepClicked = function (e) {
        var t = e.data;
        this._currentPresentation.pause(), this._currentPresentation.jumpToEndOfPrevStep(t), this._currentPresentation.play(t, !0)
    }, f.prototype.onClose = function () {
    }, f.prototype.onPresentationStatusChanged = function (e) {
        switch (e.Status) {
            case i.NOTPLAYING:
                n.close()
        }
    }, f.prototype.onPresentationStep = function (e) {
        e.Status != i.NOTPLAYING && this._listControl && (this._listControl.highlightLine(e.StepIndex), this._listControl.ensureLineVisible(e.StepIndex))
    }, f
}), define("internal/ElevationGradientImageryProvider", function () {
}), define("tools/TETools/ContourMapTool", ["jquery", "../MenuEntry", "internal/ElevationGradientImageryProvider", "../ToolDelegate", "TELang"], function (e, t, n, r, i) {
    "use strict";
    var s = i.i18n("Meter"), o = i.i18n("Km"), u = i.i18n("Feet"), a = i.i18n("Mile"), f, l = function () {
        this._isOpened = !1, this._cursorPosition = undefined, this._canHover = !1, this._lastContourLineState = !0, this._lastContourColorState = !0, this._firstTime = !0, this.getId = function () {
            return "ContourMap"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, i.i18n("Menu_Analyze_ContourMap"), "./img/newDesign/analyze_contour_map.png", 2, t.MenuEntryAnalyze(), i.i18n("TerrainAnalysis_Header"), !0)
        }, this.open = function () {
            this._isOpened ? (viewer.scene.showContourColors = !1, viewer.scene.showContourLines = !1, TerraExplorer.activeGlobalStates[this.getId()] = !1) : (viewer.scene.displaySlopeMap && (viewer.scene.displaySlopeMap = !1, TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.Slope.getId()] = !1, TerraExplorer.tools.ToolManager._tools.Slope._isOpened = !1), viewer.scene.showContourColors = Cesium.defaultValue(viewer.scene.showContourColors, !0), TerraExplorer.internal.Settings.contourMode && TerraExplorer.internal.Settings.contourMode === 1 && (viewer.scene.showContourLines = Cesium.defaultValue(viewer.scene.showContourLines, !0)), viewer.scene.showContourColors === !1 && viewer.scene.showContourLines === !1 && (viewer.scene.showContourColors = !0, TerraExplorer.internal.Settings.contourMode && TerraExplorer.internal.Settings.contourMode === 1 && (viewer.scene.showContourLines = !0)), TerraExplorer.activeGlobalStates[this.getId()] = !0), this._isOpened = !this._isOpened, TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
        }
    };
    return Cesium.defineProperties(l.prototype, {
        IsOpen: {
            get: function () {
                return Cesium.defaultValue(TerraExplorer.activeGlobalStates[this.getId()], !1)
            }
        }
    }), l.prototype.onOpenedToolContainer = function () {
        this._canHover = !0;
        var t = this;
        e(e(".toolHeaderContainer")[0]).text(i.i18n("Menu_Analyze_ContourMap")), this._firstTime && (viewer.scene.showContourColors = !0, viewer.scene.showContourLines = !0, this._firstTime = !1), viewer.scene.showContourLines && this._toolContainer.selectButton("contourLines", !0), viewer.scene.showContourColors && this._toolContainer.selectButton("contourColorsFromPallete", !0), e("#contourColorsFromPallete").css("margin-left", "3px")
    }, l.prototype.onBeforeOpenToolContainer = function () {
        return e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this.parent.onBeforeOpenToolContainer.call(this), e("#TextView").length > 0 && e("#TextView").empty(), this._toolContainer.addButton("contourLines", "./img/newDesign/distance_contour_map.png", undefined, i.i18n("Contour_Lines_ToolTip"), this.ToolContainer.buttonType.CHECKBOX_BUTTON), this._toolContainer.addButton("contourColorsFromPallete", "./img/newDesign/distance_colors.png", undefined, i.i18n("Contour_Colors_ToolTip"), this.ToolContainer.buttonType.CHECKBOX_BUTTON), this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.onMouseOver, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE), viewer.scene.preRender.addEventListener(this.onPreFrame, this), !0
    }, l.prototype.onMouseOver = function (e) {
        this._canHover && Cesium.defined(e) && (this._cursorPosition = e.endPosition)
    }, l.prototype.onPreFrame = function () {
        var e = {};
        if (this._toolContainer != null && this._cursorPosition != undefined) {
            var t = viewer.scene.screenToWorld(this._cursorPosition, e), n;
            if (Cesium.defined(t)) {
                n = viewer.scene.globe.ellipsoid.cartesianToCartographic(t);
                var r = n.height, f = r.toFixed(3) + " " + s;
                r > 1e4 && (f = (r / 1e3).toFixed(3) + " " + o), TerraExplorer.internal.Units.AltitudeUnit == TerraExplorer.internal.Units.FEET && (r = TerraExplorer.internal.Units.meterToFeet(r), f = r.toFixed(3) + " " + u, r > 1e4 && (f = (r / 5280).toFixed(3) + " " + a));
                var l = i.i18n("Elevation") + ": " + f + " AGL";
                this._toolContainer.setText(l)
            }
        }
    }, l.prototype.checked = function (t) {
        try {
            var n = e.grep(e(".listControlLineTextSubHeaderSidebar"), function (e) {
                if (e.textContent === i.i18n("Menu_Analyze_Slope")) return e
            });
            viewer.scene.displaySlopeMap && n.length > 0 ? e(e(e(n).parent().parent()[0])[0]).find("#checkboxDiv input")[0].click() : viewer.scene.displaySlopeMap && (viewer.scene.displaySlopeMap = !1), this._firstTime ? (viewer.scene.showContourColors = t, viewer.scene.showContourLines = t, this._firstTime = !1) : (viewer.scene.showContourColors = t & this._lastContourColorState, viewer.scene.showContourLines = t & this._lastContourLineState), viewer.scene.showContourLines && this._toolContainer.selectButton("contourLines", !0), viewer.scene.showContourColors && this._toolContainer.selectButton("contourColorsFromPallete", !0), e("#contourColorsFromPallete").css("margin-left", "3px")
        } catch (r) {
        }
    }, l.prototype.openConfig = function () {
        setTimeout(function () {
            TerraExplorer.tools.ToolContainer.showWithDelegate(TerraExplorer.tools.ToolManager._tools.ContourMap, function () {
            })
        }, 100)
    }, l.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0
    }, l.prototype.onButtonClick = function (t) {
        this.parent.onButtonClick.call(this, t);
        switch (t) {
            case"contourLines":
                this.toggleContourLines();
                break;
            case"contourColorsFromPallete":
                this.toggleContourColors()
        }
        !e(e(".selectedLine #checkboxDiv input[type=checkbox]")[0]).is(":checked") && (viewer.scene.showContourLines || viewer.scene.showContourColors) && e(".selectedLine #checkboxDiv input[type=checkbox]")[0].click()
    }, l.prototype.toggleContourLines = function () {
        viewer.scene.showContourLines = !viewer.scene.showContourLines, this._lastContourLineState = viewer.scene.showContourLines
    }, l.prototype.toggleContourColors = function () {
        viewer.scene.showContourColors = !viewer.scene.showContourColors, this._lastContourColorState = viewer.scene.showContourColors
    }, l
}), define("tools/TETools/TwoDModeTool", ["jquery", "../MenuEntry", "internal/Navigate"], function (e, t, n) {
    "use strict";
    var r = function () {
        this.getId = function () {
            return "TwoDMode"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, "", "./img/newDesign/2d_off.png", 10, t.MenuEntryNavigation(), TELang.i18n("NavigationModes_Header"), undefined, !0, "./img/newDesign/2d_on.png", "none")
        }, this.open = function () {
            TerraExplorer.internal.Navigate.CurrentNavigationMode = 2, TerraExplorer.tools.ToolManager._tools.TwoDNorthMode.close(), viewer.scene.preRender.addEventListener(this.onPreFrame, this)
        }
    };
    return Cesium.defineProperties(r.prototype, {}), r.prototype.onPreFrame = function () {
        viewer.camera.setView({orientation: {heading: viewer.camera.heading, pitch: Cesium.Math.toRadians(-89.9)}})
    }, r.prototype.close = function () {
        viewer.scene.preRender.removeEventListener(this.onPreFrame, this)
    }, r
}), define("tools/TETools/TwoDNorthModeTool", ["jquery", "../MenuEntry", "internal/Navigate"], function (e, t, n) {
    "use strict";
    var r = function () {
        this.getId = function () {
            return "TwoDNorthMode"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, "", "./img/newDesign/2dn_off.png", 11, t.MenuEntryNavigation(), TELang.i18n("NavigationModes_Header"), undefined, !0, "./img/newDesign/2dn_on.png", "none")
        }, this.open = function () {
            e("#checkImageSubHeaderRotate").length > 0 && (n.stop(), e("#checkImageSubHeaderRotate").remove()), TerraExplorer.internal.Navigate.CurrentNavigationMode = 1, TerraExplorer.tools.ToolManager._tools.TwoDMode.close(), viewer.scene.preRender.addEventListener(this.onPreFrame, this), TerraExplorer.internal.Navigate.NorthOnly = !0
        }
    };
    return Cesium.defineProperties(r.prototype, {}), r.prototype.onPreFrame = function () {
        viewer.camera.setView({orientation: {pitch: Cesium.Math.toRadians(-89.9)}})
    }, r.prototype.close = function () {
        viewer.scene.preRender.removeEventListener(this.onPreFrame, this), TerraExplorer.internal.Navigate.NorthOnly = !1
    }, r
}), define("tools/TETools/ThreeDModeTool", ["jquery", "../MenuEntry", "internal/Navigate"], function (e, t, n) {
    "use strict";
    var r = function () {
        this.getId = function () {
            return "ThreeDMode"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, "", "./img/newDesign/3d_off.png", 9, t.MenuEntryNavigation(), TELang.i18n("NavigationModes_Header"), undefined, !0, "./img/newDesign/3d_on.png", "none")
        }, this.open = function () {
            var t = !1;
            e("#checkImageSubHeaderRotate").length > 0 && (n.stop(), t = !0), TerraExplorer.internal.Navigate.CurrentNavigationMode = 3, TerraExplorer.tools.ToolManager._tools.TwoDNorthMode.close(), TerraExplorer.tools.ToolManager._tools.TwoDMode.close(), t && TerraExplorer.tools.ToolManager._tools.Rotate.open()
        }
    };
    return Cesium.defineProperties(r.prototype, {}), r
}), define("tools/TETools/SlopeTool", ["jquery", "../MenuEntry"], function (e, t) {
    "use strict";
    var n = function () {
        this._isOpened = !1, this.getId = function () {
            return "Slope"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, TELang.i18n("Menu_Analyze_Slope"), "./img/newDesign/analyze_slope_map.png", 3, t.MenuEntryAnalyze(), TELang.i18n("TerrainAnalysis_Header"), !0)
        }, this.open = function () {
            this._isOpened = !this._isOpened;
            if (this._isOpened) {
                var t = TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.ContourMap.getId()];
                t && (viewer.scene.showContourColors = !1, viewer.scene.showContourLines = !1, TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.ContourMap.getId()] = !1, TerraExplorer.tools.ToolManager._tools.ContourMap._isOpened = !1), viewer.scene.displaySlopeMap = !0, TerraExplorer.activeGlobalStates[this.getId()] = !0
            } else viewer.scene.displaySlopeMap = !1, TerraExplorer.activeGlobalStates[this.getId()] = !1;
            TerraExplorer.isTouch() && e("#sideBar #closeXID").click()
        }
    };
    return Cesium.defineProperties(n.prototype, {
        IsOpen: {
            get: function () {
                return viewer.scene.displaySlopeMap
            }
        }
    }), n.prototype.checked = function (t) {
        try {
            t && viewer.scene.undergroundMode && TerraExplorer.tools.ToolManager._tools.UndergroundTool.open();
            var n = e.grep(e(".listControlLineTextSubHeaderSidebar"), function (e) {
                if (e.textContent === TELang.i18n("Menu_Analyze_ContourMap")) return e
            }), r = TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.ContourMap.getId()];
            r && n.length > 0 ? e(e(e(n).parent().parent()[0])[0]).find("#checkboxDiv input")[0].click() : r && (viewer.scene.showContourColors && (viewer.scene.showContourColors = !1), viewer.scene.showContourLines && (viewer.scene.showContourLines = !1)), viewer.scene.displaySlopeMap = t
        } catch (i) {
        }
    }, n.prototype.openConfig = function () {
        console.log("openConfig Slope")
    }, n
}), define("tools/TETools/AddViewshedTool", ["jquery", "../MenuEntry", "tools/ListControl", "../DisplayGroupItem", "TELang"], function (e, t, n, r, i) {
    "use strict";
    var s = function () {
        this.getId = function () {
            return "AddViewshed"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, i.i18n("analysis_add_viewshed"), "./img/newDesign/analyze_viewshed.png", 25, t.MenuEntryAnalyze(), i.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }, this.open = function () {
            var t = this;
            e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click(), e("#ContainerRootDiv #CloseImg").length > 0 && e("#ContainerRootDiv #CloseImg").click(), TerraExplorer.tools.ToolManager.openTool("Viewshed")
        }
    };
    return s
}), function (e) {
    "function" == typeof define && define.amd ? define("internal/spinner", ["jquery"], e) : e(jQuery)
}(function (e) {
    function t(e) {
        return function () {
            var t = this.element.val();
            e.apply(this, arguments), this._refresh(), t !== this.element.val() && this._trigger("change")
        }
    }

    e.ui = e.ui || {}, e.ui.version = "1.12.1";
    var n = 0, r = Array.prototype.slice;
    e.cleanData = function (t) {
        return function (n) {
            var r, i, s;
            for (s = 0; null != (i = n[s]); s++) try {
                r = e._data(i, "events"), r && r.remove && e(i).triggerHandler("remove")
            } catch (o) {
            }
            t(n)
        }
    }(e.cleanData), e.widget = function (t, n, r) {
        var i, s, o, u = {}, a = t.split(".")[0];
        t = t.split(".")[1];
        var f = a + "-" + t;
        return r || (r = n, n = e.Widget), e.isArray(r) && (r = e.extend.apply(null, [{}].concat(r))), e.expr[":"][f.toLowerCase()] = function (t) {
            return !!e.data(t, f)
        }, e[a] = e[a] || {}, i = e[a][t], s = e[a][t] = function (e, t) {
            return this._createWidget ? (arguments.length && this._createWidget(e, t), void 0) : new s(e, t)
        }, e.extend(s, i, {
            version: r.version,
            _proto: e.extend({}, r),
            _childConstructors: []
        }), o = new n, o.options = e.widget.extend({}, o.options), e.each(r, function (t, r) {
            return e.isFunction(r) ? (u[t] = function () {
                function e() {
                    return n.prototype[t].apply(this, arguments)
                }

                function i(e) {
                    return n.prototype[t].apply(this, e)
                }

                return function () {
                    var t, n = this._super, s = this._superApply;
                    return this._super = e, this._superApply = i, t = r.apply(this, arguments), this._super = n, this._superApply = s, t
                }
            }(), void 0) : (u[t] = r, void 0)
        }), s.prototype = e.widget.extend(o, {widgetEventPrefix: i ? o.widgetEventPrefix || t : t}, u, {
            constructor: s,
            namespace: a,
            widgetName: t,
            widgetFullName: f
        }), i ? (e.each(i._childConstructors, function (t, n) {
            var r = n.prototype;
            e.widget(r.namespace + "." + r.widgetName, s, n._proto)
        }), delete i._childConstructors) : n._childConstructors.push(s), e.widget.bridge(t, s), s
    }, e.widget.extend = function (t) {
        for (var n, i, o = r.call(arguments, 1), u = 0, a = o.length; a > u; u++) for (n in o[u]) i = o[u][n], o[u].hasOwnProperty(n) && void 0 !== i && (t[n] = e.isPlainObject(i) ? e.isPlainObject(t[n]) ? e.widget.extend({}, t[n], i) : e.widget.extend({}, i) : i);
        return t
    }, e.widget.bridge = function (t, n) {
        var i = n.prototype.widgetFullName || t;
        e.fn[t] = function (o) {
            var u = "string" == typeof o, a = r.call(arguments, 1), f = this;
            return u ? this.length || "instance" !== o ? this.each(function () {
                var n, r = e.data(this, i);
                return "instance" === o ? (f = r, !1) : r ? e.isFunction(r[o]) && "_" !== o.charAt(0) ? (n = r[o].apply(r, a), n !== r && void 0 !== n ? (f = n && n.jquery ? f.pushStack(n.get()) : n, !1) : void 0) : e.error("no such method '" + o + "' for " + t + " widget instance") : e.error("cannot call methods on " + t + " prior to initialization; " + "attempted to call method '" + o + "'")
            }) : f = void 0 : (a.length && (o = e.widget.extend.apply(null, [o].concat(a))), this.each(function () {
                var t = e.data(this, i);
                t ? (t.option(o || {}), t._init && t._init()) : e.data(this, i, new n(o, this))
            })), f
        }
    }, e.Widget = function () {
    }, e.Widget._childConstructors = [], e.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: {classes: {}, disabled: !1, create: null},
        _createWidget: function (t, r) {
            r = e(r || this.defaultElement || this)[0], this.element = e(r), this.uuid = n++, this.eventNamespace = "." + this.widgetName + this.uuid, this.bindings = e(), this.hoverable = e(), this.focusable = e(), this.classesElementLookup = {}, r !== this && (e.data(r, this.widgetFullName, this), this._on(!0, this.element, {
                remove: function (e) {
                    e.target === r && this.destroy()
                }
            }), this.document = e(r.style ? r.ownerDocument : r.document || r), this.window = e(this.document[0].defaultView || this.document[0].parentWindow)), this.options = e.widget.extend({}, this.options, this._getCreateOptions(), t), this._create(), this.options.disabled && this._setOptionDisabled(this.options.disabled), this._trigger("create", null, this._getCreateEventData()), this._init()
        },
        _getCreateOptions: function () {
            return {}
        },
        _getCreateEventData: e.noop,
        _create: e.noop,
        _init: e.noop,
        destroy: function () {
            var t = this;
            this._destroy(), e.each(this.classesElementLookup, function (e, n) {
                t._removeClass(n, e)
            }), this.element.off(this.eventNamespace).removeData(this.widgetFullName), this.widget().off(this.eventNamespace).removeAttr("aria-disabled"), this.bindings.off(this.eventNamespace)
        },
        _destroy: e.noop,
        widget: function () {
            return this.element
        },
        option: function (t, n) {
            var r, i, s, o = t;
            if (0 === arguments.length) return e.widget.extend({}, this.options);
            if ("string" == typeof t) if (o = {}, r = t.split("."), t = r.shift(), r.length) {
                for (i = o[t] = e.widget.extend({}, this.options[t]), s = 0; r.length - 1 > s; s++) i[r[s]] = i[r[s]] || {}, i = i[r[s]];
                if (t = r.pop(), 1 === arguments.length) return void 0 === i[t] ? null : i[t];
                i[t] = n
            } else {
                if (1 === arguments.length) return void 0 === this.options[t] ? null : this.options[t];
                o[t] = n
            }
            return this._setOptions(o), this
        },
        _setOptions: function (e) {
            var t;
            for (t in e) this._setOption(t, e[t]);
            return this
        },
        _setOption: function (e, t) {
            return "classes" === e && this._setOptionClasses(t), this.options[e] = t, "disabled" === e && this._setOptionDisabled(t), this
        },
        _setOptionClasses: function (t) {
            var n, r, i;
            for (n in t) i = this.classesElementLookup[n], t[n] !== this.options.classes[n] && i && i.length && (r = e(i.get()), this._removeClass(i, n), r.addClass(this._classes({
                element: r,
                keys: n,
                classes: t,
                add: !0
            })))
        },
        _setOptionDisabled: function (e) {
            this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null, !!e), e && (this._removeClass(this.hoverable, null, "ui-state-hover"), this._removeClass(this.focusable, null, "ui-state-focus"))
        },
        enable: function () {
            return this._setOptions({disabled: !1})
        },
        disable: function () {
            return this._setOptions({disabled: !0})
        },
        _classes: function (t) {
            function n(n, o) {
                var u, a;
                for (a = 0; n.length > a; a++) u = i.classesElementLookup[n[a]] || e(), u = t.add ? e(e.unique(u.get().concat(t.element.get()))) : e(u.not(t.element).get()), i.classesElementLookup[n[a]] = u, r.push(n[a]), o && t.classes[n[a]] && r.push(t.classes[n[a]])
            }

            var r = [], i = this;
            return t = e.extend({
                element: this.element,
                classes: this.options.classes || {}
            }, t), this._on(t.element, {remove: "_untrackClassesElement"}), t.keys && n(t.keys.match(/\S+/g) || [], !0), t.extra && n(t.extra.match(/\S+/g) || []), r.join(" ")
        },
        _untrackClassesElement: function (t) {
            var n = this;
            e.each(n.classesElementLookup, function (r, i) {
                -1 !== e.inArray(t.target, i) && (n.classesElementLookup[r] = e(i.not(t.target).get()))
            })
        },
        _removeClass: function (e, t, n) {
            return this._toggleClass(e, t, n, !1)
        },
        _addClass: function (e, t, n) {
            return this._toggleClass(e, t, n, !0)
        },
        _toggleClass: function (e, t, n, r) {
            r = "boolean" == typeof r ? r : n;
            var i = "string" == typeof e || null === e,
                s = {extra: i ? t : n, keys: i ? e : t, element: i ? this.element : e, add: r};
            return s.element.toggleClass(this._classes(s), r), this
        },
        _on: function (t, n, r) {
            var i, s = this;
            "boolean" != typeof t && (r = n, n = t, t = !1), r ? (n = i = e(n), this.bindings = this.bindings.add(n)) : (r = n, n = this.element, i = this.widget()), e.each(r, function (r, u) {
                function a() {
                    return t || s.options.disabled !== !0 && !e(this).hasClass("ui-state-disabled") ? ("string" == typeof u ? s[u] : u).apply(s, arguments) : void 0
                }

                "string" != typeof u && (a.guid = u.guid = u.guid || a.guid || e.guid++);
                var f = r.match(/^([\w:-]*)\s*(.*)$/), l = f[1] + s.eventNamespace, c = f[2];
                c ? i.on(l, c, a) : n.on(l, a)
            })
        },
        _off: function (t, n) {
            n = (n || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, t.off(n).off(n), this.bindings = e(this.bindings.not(t).get()), this.focusable = e(this.focusable.not(t).get()), this.hoverable = e(this.hoverable.not(t).get())
        },
        _delay: function (e, t) {
            function n() {
                return ("string" == typeof e ? r[e] : e).apply(r, arguments)
            }

            var r = this;
            return setTimeout(n, t || 0)
        },
        _hoverable: function (t) {
            this.hoverable = this.hoverable.add(t), this._on(t, {
                mouseenter: function (t) {
                    this._addClass(e(t.currentTarget), null, "ui-state-hover")
                }, mouseleave: function (t) {
                    this._removeClass(e(t.currentTarget), null, "ui-state-hover")
                }
            })
        },
        _focusable: function (t) {
            this.focusable = this.focusable.add(t), this._on(t, {
                focusin: function (t) {
                    this._addClass(e(t.currentTarget), null, "ui-state-focus")
                }, focusout: function (t) {
                    this._removeClass(e(t.currentTarget), null, "ui-state-focus")
                }
            })
        },
        _trigger: function (t, n, r) {
            var i, s, o = this.options[t];
            if (r = r || {}, n = e.Event(n), n.type = (t === this.widgetEventPrefix ? t : this.widgetEventPrefix + t).toLowerCase(), n.target = this.element[0], s = n.originalEvent) for (i in s) i in n || (n[i] = s[i]);
            return this.element.trigger(n, r), !(e.isFunction(o) && o.apply(this.element[0], [n].concat(r)) === !1 || n.isDefaultPrevented())
        }
    }, e.each({show: "fadeIn", hide: "fadeOut"}, function (t, n) {
        e.Widget.prototype["_" + t] = function (r, i, s) {
            "string" == typeof i && (i = {effect: i});
            var o, u = i ? i === !0 || "number" == typeof i ? n : i.effect || n : t;
            i = i || {}, "number" == typeof i && (i = {duration: i}), o = !e.isEmptyObject(i), i.complete = s, i.delay && r.delay(i.delay), o && e.effects && e.effects.effect[u] ? r[t](i) : u !== t && r[u] ? r[u](i.duration, i.easing, s) : r.queue(function (n) {
                e(this)[t](), s && s.call(r[0]), n()
            })
        }
    }), e.widget, e.fn.form = function () {
        return "string" == typeof this[0].form ? this.closest("form") : e(this[0].form)
    }, e.ui.formResetMixin = {
        _formResetHandler: function () {
            var t = e(this);
            setTimeout(function () {
                var n = t.data("ui-form-reset-instances");
                e.each(n, function () {
                    this.refresh()
                })
            })
        }, _bindFormResetHandler: function () {
            if (this.form = this.element.form(), this.form.length) {
                var e = this.form.data("ui-form-reset-instances") || [];
                e.length || this.form.on("reset.ui-form-reset", this._formResetHandler), e.push(this), this.form.data("ui-form-reset-instances", e)
            }
        }, _unbindFormResetHandler: function () {
            if (this.form.length) {
                var t = this.form.data("ui-form-reset-instances");
                t.splice(e.inArray(this, t), 1), t.length ? this.form.data("ui-form-reset-instances", t) : this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")
            }
        }
    }, e.ui.keyCode = {
        BACKSPACE: 8,
        COMMA: 188,
        DELETE: 46,
        DOWN: 40,
        END: 35,
        ENTER: 13,
        ESCAPE: 27,
        HOME: 36,
        LEFT: 37,
        PAGE_DOWN: 34,
        PAGE_UP: 33,
        PERIOD: 190,
        RIGHT: 39,
        SPACE: 32,
        TAB: 9,
        UP: 38
    }, e.ui.escapeSelector = function () {
        var e = /([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;
        return function (t) {
            return t.replace(e, "\\$1")
        }
    }(), e.fn.labels = function () {
        var t, n, r, i, s;
        return this[0].labels && this[0].labels.length ? this.pushStack(this[0].labels) : (i = this.eq(0).parents("label"), r = this.attr("id"), r && (t = this.eq(0).parents().last(), s = t.add(t.length ? t.siblings() : this.siblings()), n = "label[for='" + e.ui.escapeSelector(r) + "']", i = i.add(s.find(n).addBack(n))), this.pushStack(i))
    };
    var i = /ui-corner-([a-z]){2,6}/g;
    e.widget("ui.controlgroup", {
        version: "1.12.1",
        defaultElement: "<div>",
        options: {
            direction: "horizontal",
            disabled: null,
            onlyVisible: !0,
            items: {
                button: "input[type=button], input[type=submit], input[type=reset], button, a",
                controlgroupLabel: ".ui-controlgroup-label",
                checkboxradio: "input[type='checkbox'], input[type='radio']",
                selectmenu: "select",
                spinner: ".ui-spinner-input"
            }
        },
        _create: function () {
            this._enhance()
        },
        _enhance: function () {
            this.element.attr("role", "toolbar"), this.refresh()
        },
        _destroy: function () {
            this._callChildMethod("destroy"), this.childWidgets.removeData("ui-controlgroup-data"), this.element.removeAttr("role"), this.options.items.controlgroupLabel && this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()
        },
        _initWidgets: function () {
            var t = this, n = [];
            e.each(this.options.items, function (r, i) {
                var s, o = {};
                return i ? "controlgroupLabel" === r ? (s = t.element.find(i), s.each(function () {
                    var t = e(this);
                    t.children(".ui-controlgroup-label-contents").length || t.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")
                }), t._addClass(s, null, "ui-widget ui-widget-content ui-state-default"), n = n.concat(s.get()), void 0) : (e.fn[r] && (o = t["_" + r + "Options"] ? t["_" + r + "Options"]("middle") : {classes: {}}, t.element.find(i).each(function () {
                    var i = e(this), s = i[r]("instance"), u = e.widget.extend({}, o);
                    if ("button" !== r || !i.parent(".ui-spinner").length) {
                        s || (s = i[r]()[r]("instance")), s && (u.classes = t._resolveClassesValues(u.classes, s)), i[r](u);
                        var f = i[r]("widget");
                        e.data(f[0], "ui-controlgroup-data", s ? s : i[r]("instance")), n.push(f[0])
                    }
                })), void 0) : void 0
            }), this.childWidgets = e(e.unique(n)), this._addClass(this.childWidgets, "ui-controlgroup-item")
        },
        _callChildMethod: function (t) {
            this.childWidgets.each(function () {
                var n = e(this), r = n.data("ui-controlgroup-data");
                r && r[t] && r[t]()
            })
        },
        _updateCornerClass: function (e, t) {
            var n = "ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",
                r = this._buildSimpleOptions(t, "label").classes.label;
            this._removeClass(e, null, n), this._addClass(e, null, r)
        },
        _buildSimpleOptions: function (e, t) {
            var n = "vertical" === this.options.direction, r = {classes: {}};
            return r.classes[t] = {
                middle: "",
                first: "ui-corner-" + (n ? "top" : "left"),
                last: "ui-corner-" + (n ? "bottom" : "right"),
                only: "ui-corner-all"
            }[e], r
        },
        _spinnerOptions: function (e) {
            var t = this._buildSimpleOptions(e, "ui-spinner");
            return t.classes["ui-spinner-up"] = "", t.classes["ui-spinner-down"] = "", t
        },
        _buttonOptions: function (e) {
            return this._buildSimpleOptions(e, "ui-button")
        },
        _checkboxradioOptions: function (e) {
            return this._buildSimpleOptions(e, "ui-checkboxradio-label")
        },
        _selectmenuOptions: function (e) {
            var t = "vertical" === this.options.direction;
            return {
                width: t ? "auto" : !1,
                classes: {
                    middle: {"ui-selectmenu-button-open": "", "ui-selectmenu-button-closed": ""},
                    first: {
                        "ui-selectmenu-button-open": "ui-corner-" + (t ? "top" : "tl"),
                        "ui-selectmenu-button-closed": "ui-corner-" + (t ? "top" : "left")
                    },
                    last: {
                        "ui-selectmenu-button-open": t ? "" : "ui-corner-tr",
                        "ui-selectmenu-button-closed": "ui-corner-" + (t ? "bottom" : "right")
                    },
                    only: {"ui-selectmenu-button-open": "ui-corner-top", "ui-selectmenu-button-closed": "ui-corner-all"}
                }[e]
            }
        },
        _resolveClassesValues: function (t, n) {
            var r = {};
            return e.each(t, function (o) {
                var u = n.options.classes[o] || "";
                u = e.trim(u.replace(i, "")), r[o] = (u + " " + t[o]).replace(/\s+/g, " ")
            }), r
        },
        _setOption: function (e, t) {
            return "direction" === e && this._removeClass("ui-controlgroup-" + this.options.direction), this._super(e, t), "disabled" === e ? (this._callChildMethod(t ? "disable" : "enable"), void 0) : (this.refresh(), void 0)
        },
        refresh: function () {
            var t, n = this;
            this._addClass("ui-controlgroup ui-controlgroup-" + this.options.direction), "horizontal" === this.options.direction && this._addClass(null, "ui-helper-clearfix"), this._initWidgets(), t = this.childWidgets, this.options.onlyVisible && (t = t.filter(":visible")), t.length && (e.each(["first", "last"], function (e, r) {
                var i = t[r]().data("ui-controlgroup-data");
                if (i && n["_" + i.widgetName + "Options"]) {
                    var s = n["_" + i.widgetName + "Options"](1 === t.length ? "only" : r);
                    s.classes = n._resolveClassesValues(s.classes, i), i.element[i.widgetName](s)
                } else n._updateCornerClass(t[r](), r)
            }), this._callChildMethod("refresh"))
        }
    }), e.widget("ui.checkboxradio", [e.ui.formResetMixin, {
        version: "1.12.1",
        options: {
            disabled: null,
            label: null,
            icon: !0,
            classes: {"ui-checkboxradio-label": "ui-corner-all", "ui-checkboxradio-icon": "ui-corner-all"}
        },
        _getCreateOptions: function () {
            var t, n, r = this, i = this._super() || {};
            return this._readType(), n = this.element.labels(), this.label = e(n[n.length - 1]), this.label.length || e.error("No label found for checkboxradio widget"), this.originalLabel = "", this.label.contents().not(this.element[0]).each(function () {
                r.originalLabel += 3 === this.nodeType ? e(this).text() : this.outerHTML
            }), this.originalLabel && (i.label = this.originalLabel), t = this.element[0].disabled, null != t && (i.disabled = t), i
        },
        _create: function () {
            var e = this.element[0].checked;
            this._bindFormResetHandler(), null == this.options.disabled && (this.options.disabled = this.element[0].disabled), this._setOption("disabled", this.options.disabled), this._addClass("ui-checkboxradio", "ui-helper-hidden-accessible"), this._addClass(this.label, "ui-checkboxradio-label", "ui-button ui-widget"), "radio" === this.type && this._addClass(this.label, "ui-checkboxradio-radio-label"), this.options.label && this.options.label !== this.originalLabel ? this._updateLabel() : this.originalLabel && (this.options.label = this.originalLabel), this._enhance(), e && (this._addClass(this.label, "ui-checkboxradio-checked", "ui-state-active"), this.icon && this._addClass(this.icon, null, "ui-state-hover")), this._on({
                change: "_toggleClasses",
                focus: function () {
                    this._addClass(this.label, null, "ui-state-focus ui-visual-focus")
                },
                blur: function () {
                    this._removeClass(this.label, null, "ui-state-focus ui-visual-focus")
                }
            })
        },
        _readType: function () {
            var t = this.element[0].nodeName.toLowerCase();
            this.type = this.element[0].type, "input" === t && /radio|checkbox/.test(this.type) || e.error("Can't create checkboxradio on element.nodeName=" + t + " and element.type=" + this.type)
        },
        _enhance: function () {
            this._updateIcon(this.element[0].checked)
        },
        widget: function () {
            return this.label
        },
        _getRadioGroup: function () {
            var t, n = this.element[0].name, r = "input[name='" + e.ui.escapeSelector(n) + "']";
            return n ? (t = this.form.length ? e(this.form[0].elements).filter(r) : e(r).filter(function () {
                return 0 === e(this).form().length
            }), t.not(this.element)) : e([])
        },
        _toggleClasses: function () {
            var t = this.element[0].checked;
            this._toggleClass(this.label, "ui-checkboxradio-checked", "ui-state-active", t), this.options.icon && "checkbox" === this.type && this._toggleClass(this.icon, null, "ui-icon-check ui-state-checked", t)._toggleClass(this.icon, null, "ui-icon-blank", !t), "radio" === this.type && this._getRadioGroup().each(function () {
                var t = e(this).checkboxradio("instance");
                t && t._removeClass(t.label, "ui-checkboxradio-checked", "ui-state-active")
            })
        },
        _destroy: function () {
            this._unbindFormResetHandler(), this.icon && (this.icon.remove(), this.iconSpace.remove())
        },
        _setOption: function (e, t) {
            return "label" !== e || t ? (this._super(e, t), "disabled" === e ? (this._toggleClass(this.label, null, "ui-state-disabled", t), this.element[0].disabled = t, void 0) : (this.refresh(), void 0)) : void 0
        },
        _updateIcon: function (t) {
            var n = "ui-icon ui-icon-background ";
            this.options.icon ? (this.icon || (this.icon = e("<span>"), this.iconSpace = e("<span> </span>"), this._addClass(this.iconSpace, "ui-checkboxradio-icon-space")), "checkbox" === this.type ? (n += t ? "ui-icon-check ui-state-checked" : "ui-icon-blank", this._removeClass(this.icon, null, t ? "ui-icon-blank" : "ui-icon-check")) : n += "ui-icon-blank", this._addClass(this.icon, "ui-checkboxradio-icon", n), t || this._removeClass(this.icon, null, "ui-icon-check ui-state-checked"), this.icon.prependTo(this.label).after(this.iconSpace)) : void 0 !== this.icon && (this.icon.remove(), this.iconSpace.remove(), delete this.icon)
        },
        _updateLabel: function () {
            var e = this.label.contents().not(this.element[0]);
            this.icon && (e = e.not(this.icon[0])), this.iconSpace && (e = e.not(this.iconSpace[0])), e.remove(), this.label.append(this.options.label)
        },
        refresh: function () {
            var e = this.element[0].checked, t = this.element[0].disabled;
            this._updateIcon(e), this._toggleClass(this.label, "ui-checkboxradio-checked", "ui-state-active", e), null !== this.options.label && this._updateLabel(), t !== this.options.disabled && this._setOptions({disabled: t})
        }
    }]), e.ui.checkboxradio, e.widget("ui.button", {
        version: "1.12.1",
        defaultElement: "<button>",
        options: {
            classes: {"ui-button": "ui-corner-all"},
            disabled: null,
            icon: null,
            iconPosition: "beginning",
            label: null,
            showLabel: !0
        },
        _getCreateOptions: function () {
            var e, t = this._super() || {};
            return this.isInput = this.element.is("input"), e = this.element[0].disabled, null != e && (t.disabled = e), this.originalLabel = this.isInput ? this.element.val() : this.element.html(), this.originalLabel && (t.label = this.originalLabel), t
        },
        _create: function () {
            !this.option.showLabel & !this.options.icon && (this.options.showLabel = !0), null == this.options.disabled && (this.options.disabled = this.element[0].disabled || !1), this.hasTitle = !!this.element.attr("title"), this.options.label && this.options.label !== this.originalLabel && (this.isInput ? this.element.val(this.options.label) : this.element.html(this.options.label)), this._addClass("ui-button", "ui-widget"), this._setOption("disabled", this.options.disabled), this._enhance(), this.element.is("a") && this._on({
                keyup: function (t) {
                    t.keyCode === e.ui.keyCode.SPACE && (t.preventDefault(), this.element[0].click ? this.element[0].click() : this.element.trigger("click"))
                }
            })
        },
        _enhance: function () {
            this.element.is("button") || this.element.attr("role", "button"), this.options.icon && (this._updateIcon("icon", this.options.icon), this._updateTooltip())
        },
        _updateTooltip: function () {
            this.title = this.element.attr("title"), this.options.showLabel || this.title || this.element.attr("title", this.options.label)
        },
        _updateIcon: function (t, n) {
            var r = "iconPosition" !== t, i = r ? this.options.iconPosition : n, s = "top" === i || "bottom" === i;
            this.icon ? r && this._removeClass(this.icon, null, this.options.icon) : (this.icon = e("<span>"), this._addClass(this.icon, "ui-button-icon", "ui-icon"), this.options.showLabel || this._addClass("ui-button-icon-only")), r && this._addClass(this.icon, null, n), this._attachIcon(i), s ? (this._addClass(this.icon, null, "ui-widget-icon-block"), this.iconSpace && this.iconSpace.remove()) : (this.iconSpace || (this.iconSpace = e("<span> </span>"), this._addClass(this.iconSpace, "ui-button-icon-space")), this._removeClass(this.icon, null, "ui-wiget-icon-block"), this._attachIconSpace(i))
        },
        _destroy: function () {
            this.element.removeAttr("role"), this.icon && this.icon.remove(), this.iconSpace && this.iconSpace.remove(), this.hasTitle || this.element.removeAttr("title")
        },
        _attachIconSpace: function (e) {
            this.icon[/^(?:end|bottom)/.test(e) ? "before" : "after"](this.iconSpace)
        },
        _attachIcon: function (e) {
            this.element[/^(?:end|bottom)/.test(e) ? "append" : "prepend"](this.icon)
        },
        _setOptions: function (e) {
            var t = void 0 === e.showLabel ? this.options.showLabel : e.showLabel,
                n = void 0 === e.icon ? this.options.icon : e.icon;
            t || n || (e.showLabel = !0), this._super(e)
        },
        _setOption: function (e, t) {
            "icon" === e && (t ? this._updateIcon(e, t) : this.icon && (this.icon.remove(), this.iconSpace && this.iconSpace.remove())), "iconPosition" === e && this._updateIcon(e, t), "showLabel" === e && (this._toggleClass("ui-button-icon-only", null, !t), this._updateTooltip()), "label" === e && (this.isInput ? this.element.val(t) : (this.element.html(t), this.icon && (this._attachIcon(this.options.iconPosition), this._attachIconSpace(this.options.iconPosition)))), this._super(e, t), "disabled" === e && (this._toggleClass(null, "ui-state-disabled", t), this.element[0].disabled = t, t && this.element.blur())
        },
        refresh: function () {
            var e = this.element.is("input, button") ? this.element[0].disabled : this.element.hasClass("ui-button-disabled");
            e !== this.options.disabled && this._setOptions({disabled: e}), this._updateTooltip()
        }
    }), e.uiBackCompat !== !1 && (e.widget("ui.button", e.ui.button, {
        options: {
            text: !0,
            icons: {primary: null, secondary: null}
        }, _create: function () {
            this.options.showLabel && !this.options.text && (this.options.showLabel = this.options.text), !this.options.showLabel && this.options.text && (this.options.text = this.options.showLabel), this.options.icon || !this.options.icons.primary && !this.options.icons.secondary ? this.options.icon && (this.options.icons.primary = this.options.icon) : this.options.icons.primary ? this.options.icon = this.options.icons.primary : (this.options.icon = this.options.icons.secondary, this.options.iconPosition = "end"), this._super()
        }, _setOption: function (e, t) {
            return "text" === e ? (this._super("showLabel", t), void 0) : ("showLabel" === e && (this.options.text = t), "icon" === e && (this.options.icons.primary = t), "icons" === e && (t.primary ? (this._super("icon", t.primary), this._super("iconPosition", "beginning")) : t.secondary && (this._super("icon", t.secondary), this._super("iconPosition", "end"))), this._superApply(arguments), void 0)
        }
    }), e.fn.button = function (t) {
        return function () {
            return !this.length || this.length && "INPUT" !== this[0].tagName || this.length && "INPUT" === this[0].tagName && "checkbox" !== this.attr("type") && "radio" !== this.attr("type") ? t.apply(this, arguments) : (e.ui.checkboxradio || e.error("Checkboxradio widget missing"), 0 === arguments.length ? this.checkboxradio({icon: !1}) : this.checkboxradio.apply(this, arguments))
        }
    }(e.fn.button), e.fn.buttonset = function () {
        return e.ui.controlgroup || e.error("Controlgroup widget missing"), "option" === arguments[0] && "items" === arguments[1] && arguments[2] ? this.controlgroup.apply(this, [arguments[0], "items.button", arguments[2]]) : "option" === arguments[0] && "items" === arguments[1] ? this.controlgroup.apply(this, [arguments[0], "items.button"]) : ("object" == typeof arguments[0] && arguments[0].items && (arguments[0].items = {button: arguments[0].items}), this.controlgroup.apply(this, arguments))
    }), e.ui.button, e.ui.safeActiveElement = function (e) {
        var t;
        try {
            t = e.activeElement
        } catch (n) {
            t = e.body
        }
        return t || (t = e.body), t.nodeName || (t = e.body), t
    }, e.widget("ui.spinner", {
        version: "1.12.1",
        defaultElement: "<input>",
        widgetEventPrefix: "spin",
        options: {
            classes: {
                "ui-spinner": "ui-corner-all",
                "ui-spinner-down": "ui-corner-br",
                "ui-spinner-up": "ui-corner-tr"
            },
            culture: null,
            icons: {down: "ui-icon-triangle-1-s", up: "ui-icon-triangle-1-n"},
            incremental: !0,
            max: null,
            min: null,
            numberFormat: null,
            page: 10,
            step: 1,
            change: null,
            spin: null,
            start: null,
            stop: null
        },
        _create: function () {
            this._setOption("max", this.options.max), this._setOption("min", this.options.min), this._setOption("step", this.options.step), "" !== this.value() && this._value(this.element.val(), !0), this._draw(), this._on(this._events), this._refresh(), this._on(this.window, {
                beforeunload: function () {
                    this.element.removeAttr("autocomplete")
                }
            })
        },
        _getCreateOptions: function () {
            var t = this._super(), n = this.element;
            return e.each(["min", "max", "step"], function (e, r) {
                var i = n.attr(r);
                null != i && i.length && (t[r] = i)
            }), t
        },
        _events: {
            keydown: function (e) {
                this._start(e) && this._keydown(e) && e.preventDefault()
            }, keyup: "_stop", focus: function () {
                this.previous = this.element.val()
            }, blur: function (e) {
                return this.cancelBlur ? (delete this.cancelBlur, void 0) : (this._stop(), this._refresh(), this.previous !== this.element.val() && this._trigger("change", e), void 0)
            }, mousewheel: function (e, t) {
                if (t) {
                    if (!this.spinning && !this._start(e)) return !1;
                    this._spin((t > 0 ? 1 : -1) * this.options.step, e), clearTimeout(this.mousewheelTimer), this.mousewheelTimer = this._delay(function () {
                        this.spinning && this._stop(e)
                    }, 100), e.preventDefault()
                }
            }, "mousedown .ui-spinner-button": function (t) {
                function n() {
                    var t = this.element[0] === e.ui.safeActiveElement(this.document[0]);
                    t || (this.element.trigger("focus"), this.previous = r, this._delay(function () {
                        this.previous = r
                    }))
                }

                var r;
                r = this.element[0] === e.ui.safeActiveElement(this.document[0]) ? this.previous : this.element.val(), t.preventDefault(), n.call(this), this.cancelBlur = !0, this._delay(function () {
                    delete this.cancelBlur, n.call(this)
                }), this._start(t) !== !1 && this._repeat(null, e(t.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, t)
            }, "mouseup .ui-spinner-button": "_stop", "mouseenter .ui-spinner-button": function (t) {
                return e(t.currentTarget).hasClass("ui-state-active") ? this._start(t) === !1 ? !1 : (this._repeat(null, e(t.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, t), void 0) : void 0
            }, "mouseleave .ui-spinner-button": "_stop"
        },
        _enhance: function () {
            this.uiSpinner = this.element.attr("autocomplete", "off").wrap("<span>").parent().append("<a></a><a></a>")
        },
        _draw: function () {
            this._enhance(), this._addClass(this.uiSpinner, "ui-spinner", "ui-widget ui-widget-content"), this._addClass("ui-spinner-input"), this.element.attr("role", "spinbutton"), this.buttons = this.uiSpinner.children("a").attr("tabIndex", -1).attr("aria-hidden", !0).button({classes: {"ui-button": ""}}), this._removeClass(this.buttons, "ui-corner-all"), this._addClass(this.buttons.first(), "ui-spinner-button ui-spinner-up"), this._addClass(this.buttons.last(), "ui-spinner-button ui-spinner-down"), this.buttons.first().button({
                icon: this.options.icons.up,
                showLabel: !1
            }), this.buttons.last().button({
                icon: this.options.icons.down,
                showLabel: !1
            }), this.buttons.height() > Math.ceil(.5 * this.uiSpinner.height()) && this.uiSpinner.height() > 0 && this.uiSpinner.height(this.uiSpinner.height())
        },
        _keydown: function (t) {
            var n = this.options, r = e.ui.keyCode;
            switch (t.keyCode) {
                case r.UP:
                    return this._repeat(null, 1, t), !0;
                case r.DOWN:
                    return this._repeat(null, -1, t), !0;
                case r.PAGE_UP:
                    return this._repeat(null, n.page, t), !0;
                case r.PAGE_DOWN:
                    return this._repeat(null, -n.page, t), !0
            }
            return !1
        },
        _start: function (e) {
            return this.spinning || this._trigger("start", e) !== !1 ? (this.counter || (this.counter = 1), this.spinning = !0, !0) : !1
        },
        _repeat: function (e, t, n) {
            e = e || 500, clearTimeout(this.timer), this.timer = this._delay(function () {
                this._repeat(40, t, n)
            }, e), this._spin(t * this.options.step, n)
        },
        _spin: function (e, t) {
            var n = this.value() || 0;
            this.counter || (this.counter = 1), n = this._adjustValue(n + e * this._increment(this.counter)), this.spinning && this._trigger("spin", t, {value: n}) === !1 || (this._value(n), this.counter++)
        },
        _increment: function (t) {
            var n = this.options.incremental;
            return n ? e.isFunction(n) ? n(t) : Math.floor(t * t * t / 5e4 - t * t / 500 + 17 * t / 200 + 1) : 1
        },
        _precision: function () {
            var e = this._precisionOf(this.options.step);
            return null !== this.options.min && (e = Math.max(e, this._precisionOf(this.options.min))), e
        },
        _precisionOf: function (e) {
            var t = "" + e, n = t.indexOf(".");
            return -1 === n ? 0 : t.length - n - 1
        },
        _adjustValue: function (e) {
            var t, n, r = this.options;
            return t = null !== r.min ? r.min : 0, n = e - t, n = Math.round(n / r.step) * r.step, e = t + n, e = parseFloat(e.toFixed(this._precision())), null !== r.max && e > r.max ? r.max : null !== r.min && r.min > e ? r.min : e
        },
        _stop: function (e) {
            this.spinning && (clearTimeout(this.timer), clearTimeout(this.mousewheelTimer), this.counter = 0, this.spinning = !1, this._trigger("stop", e))
        },
        _setOption: function (e, t) {
            var n, r, i;
            return "culture" === e || "numberFormat" === e ? (n = this._parse(this.element.val()), this.options[e] = t, this.element.val(this._format(n)), void 0) : (("max" === e || "min" === e || "step" === e) && "string" == typeof t && (t = this._parse(t)), "icons" === e && (r = this.buttons.first().find(".ui-icon"), this._removeClass(r, null, this.options.icons.up), this._addClass(r, null, t.up), i = this.buttons.last().find(".ui-icon"), this._removeClass(i, null, this.options.icons.down), this._addClass(i, null, t.down)), this._super(e, t), void 0)
        },
        _setOptionDisabled: function (e) {
            this._super(e), this._toggleClass(this.uiSpinner, null, "ui-state-disabled", !!e), this.element.prop("disabled", !!e), this.buttons.button(e ? "disable" : "enable")
        },
        _setOptions: t(function (e) {
            this._super(e)
        }),
        _parse: function (e) {
            return "string" == typeof e && "" !== e && (e = window.Globalize && this.options.numberFormat ? Globalize.parseFloat(e, 10, this.options.culture) : +e), "" === e || isNaN(e) ? null : e
        },
        _format: function (e) {
            return "" === e ? "" : window.Globalize && this.options.numberFormat ? Globalize.format(e, this.options.numberFormat, this.options.culture) : e
        },
        _refresh: function () {
            this.element.attr({
                "aria-valuemin": this.options.min,
                "aria-valuemax": this.options.max,
                "aria-valuenow": this._parse(this.element.val())
            })
        },
        isValid: function () {
            var e = this.value();
            return null === e ? !1 : e === this._adjustValue(e)
        },
        _value: function (e, t) {
            var n;
            "" !== e && (n = this._parse(e), null !== n && (t || (n = this._adjustValue(n)), e = this._format(n))), this.element.val(e), this._refresh()
        },
        _destroy: function () {
            this.element.prop("disabled", !1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"), this.uiSpinner.replaceWith(this.element)
        },
        stepUp: t(function (e) {
            this._stepUp(e)
        }),
        _stepUp: function (e) {
            this._start() && (this._spin((e || 1) * this.options.step), this._stop())
        },
        stepDown: t(function (e) {
            this._stepDown(e)
        }),
        _stepDown: function (e) {
            this._start() && (this._spin((e || 1) * -this.options.step), this._stop())
        },
        pageUp: t(function (e) {
            this._stepUp((e || 1) * this.options.page)
        }),
        pageDown: t(function (e) {
            this._stepDown((e || 1) * this.options.page)
        }),
        value: function (e) {
            return arguments.length ? (t(this._value).call(this, e), void 0) : this._parse(this.element.val())
        },
        widget: function () {
            return this.uiSpinner
        }
    }), e.uiBackCompat !== !1 && e.widget("ui.spinner", e.ui.spinner, {
        _enhance: function () {
            this.uiSpinner = this.element.attr("autocomplete", "off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())
        }, _uiSpinnerHtml: function () {
            return "<span>"
        }, _buttonHtml: function () {
            return "<a></a><a></a>"
        }
    }), e.ui.spinner
}), define("tools/TETools/ViewshedTool", ["jquery", "../MenuEntry", "../ToolDelegate", "./LayersStorage", "internal/spinner", "tools/ListControl", "tools/ToolDialog", "tools/TETools/ProgressTool", "TELang", "internal/InputMode", "../PropertySheet"], function (e, t, n, r, i, s, o, u, a, f, l) {
    "use strict";

    function k(e) {
        return TerraExplorer.internal.Units.AltitudeUnit == TerraExplorer.internal.Units.FEET ? (e = TerraExplorer.internal.Units.meterToFeet(e), TerraExplorer.tools.ToolManager._tools.Viewshed._txtUnit = a.i18n("feet_short")) : TerraExplorer.tools.ToolManager._tools.Viewshed._txtUnit = a.i18n("meters_short"), e
    }

    function L(t, n, r, i) {
        var s = TerraExplorer.tools.ToolManager._tools.Viewshed, o = s._currentObject, u = n.min, a = n.max;
        if (o.viewshedMap === undefined) return e("#" + t + " input").val(""), undefined;
        var f = !1, l = !1;
        return u !== undefined && (f = r < u), a !== undefined && (l = r > a), f || l ? (e("#" + t + " input").val(i), i) : r
    }

    function j(t, n) {
        if (n == undefined || t == undefined) throw{type: "TE_EXCEPTION", format: "Missing argument"};
        if (t.length == undefined) throw{type: "TE_EXCEPTION", format: "First argument should be of type array"};
        if (!n.bestTexture && !n.bestSixTextures) throw{
            type: "TE_EXCEPTION",
            format: "Viewshed does not contain best data to perform a query."
        };
        var r = TerraExplorer.internal.Project;
        if (n.guid != undefined && e.grep(r._allAnalysisObjects[r._objectTypes.VIEWSHED], function (e) {
            return e._object.guid == n.guid
        }).length != 1) throw{type: "TE_EXCEPTION", format: "Viewshed does not exist in current Project"};
        e(t).each(function (e, t) {
            if (!t instanceof Cesium.Cartesian3) {
                if (!(t instanceof Cesium.Cartographic)) throw{
                    type: "TE_EXCEPTION",
                    format: "Position type should be either Cartesian or Cartographic."
                };
                t = new Cesium.Cartesian3.fromRadians(t.longitude, t.latitude, t.height)
            }
        })
    }

    function F(t) {
        if (t instanceof Cesium.Entity) return t;
        var n = viewer.scene.frameState.commandList, r = e.grep(n, function (e) {
            return e._owner != undefined && e._owner.ID != undefined
        }), i = e.grep(n, function (e) {
            return e._owner != undefined && e._owner.content != undefined
        }), s = e.grep(n, function (e) {
            return e._owner != undefined && e._owner.primitive != undefined && e._owner.primitive.id != undefined
        }), o = e.grep(r, function (e) {
            return e._owner.ID === t
        }), u = e.grep(i, function (e) {
            return e._owner.content._url === t
        }), a = e.grep(s, function (e) {
            return e._owner.primitive.id._id === t
        }), f = {};
        if (o.length > 0) return f.prim = o[0], f;
        if (u.length > 0) return f.b3dm = u[0], f;
        if (a.length > 0) return f.model = a[0], f;
        throw{type: "TE_EXCEPTION", format: "Could not find an object with the given Id in the viewshed range"}
    }

    function I(e, t, n) {
        return 1 / Math.tan(e) * n / Math.sqrt(t * t - n * n)
    }

    function q(e, t) {
        var n = t.viewshedPrimitive._camera, r = n.viewMatrix, i = t.viewshedMap._lightCamera.frustum.projectionMatrix,
            s = new Cesium.Cartesian4, o = Cesium.Cartesian4.fromElements(e.x, e.y, e.z, 1, s),
            u = Cesium.Matrix4.multiplyByVector(r, o, s), a = Cesium.Matrix4.multiplyByVector(i, u, s),
            f = Cesium.Cartesian3.divideByScalar(a, a.w, N), l = f.x * .5 + .5, c = f.y * .5 + .5;
        return new Cesium.Cartesian2(l, c)
    }

    function R(t) {
        var n = F(t),
            r = n.b3dm != undefined ? n.b3dm._owner.content._model.boundingSphere : n.prim != undefined ? n.prim._owner.boundingSphere : undefined;
        if (r == undefined) {
            var i = e.grep(viewer.scene.frameState.commandList, function (e) {
                return e._owner != undefined && e._owner.primitive != undefined && e._owner.primitive.id != undefined && e._owner.primitive.id._id === t
            });
            if (i.length === 1) r = i[0]._boundingVolume; else if (i.length > 1) {
                var s = [];
                i.forEach(function (e) {
                    s.push(e._boundingVolume)
                }), r = Cesium.BoundingSphere.fromBoundingSpheres(s)
            }
        }
        return r
    }

    function U(t, n, r) {
        var i = [], s = [];
        try {
            return e(t).each(function (e, t) {
                i.push(X(t, n))
            }), e(i).each(function (e, t) {
                var n;
                r == "visibility" ? n = t.isVisible : r == "distance" && (n = t.distance);
                if (n === undefined && t === -1) throw{
                    type: "TE_EXCEPTION",
                    format: "Position is outside the viewshed range"
                };
                if (n === undefined && t === undefined) throw{
                    type: "TE_EXCEPTION",
                    format: "Could not read from viewshed"
                };
                s.push(n)
            }), s
        } catch (o) {
            throw{type: "TE_EXCEPTION", format: o}
        }
    }

    function z(e, t, n, r) {
        var i = new Cesium.Cartesian4, s = Cesium.Cartesian4.clone(Cesium.Cartesian4.UNIT_W, new Cesium.Cartesian4);
        s.x = e * 2 - 1, s.y = t * 2 - 1, s.z = n * 2 - 1, s.w = 1, i = Cesium.Matrix4.multiplyByVector(r.inverseViewProjMatrix, s, i);
        var o = 1 / i.w;
        Cesium.Cartesian3.multiplyByScalar(i, o, i);
        var u = Cesium.Cartesian3.fromCartesian4(i, new Cesium.Cartesian3),
            a = Cesium.Cartesian3.subtract(r.position, u, new Cesium.Cartesian3), f = Cesium.Cartesian3.magnitude(a);
        return f
    }

    function W(e, t) {
        var n = new Cesium.Cartesian4(1, 1 / 255, 1 / 65025, 1 / 16581375), r = t, i = new Cesium.Cartesian4;
        i.x = e[r++], i.y = e[r++], i.z = e[r++], i.w = e[r], Cesium.Cartesian4.divideByScalar(i, 255, i);
        var s = Cesium.Cartesian4.dot(i, n);
        return isNaN(s) ? -1 : s
    }

    function X(e, t) {
        function P(e) {
            var t = v.createFramebuffer();
            v.bindFramebuffer(v.FRAMEBUFFER, t), v.framebufferTexture2D(v.FRAMEBUFFER, v.DEPTH_STENCIL_ATTACHMENT, v.TEXTURE_2D, e, 0);
            var n = v.checkFramebufferStatus(v.FRAMEBUFFER) == v.FRAMEBUFFER_COMPLETE;
            return v.bindFramebuffer(v.FRAMEBUFFER, null), n
        }

        function H(e, t) {
        }

        var n = t.viewshedMap._lightCamera, r = t.direction == undefined ? !1 : !0, i = new Cesium.Cartesian4,
            s = new Cesium.Cartesian4(1, 1 / 255, 1 / 65025, 1 / 16581375),
            o = new Cesium.Matrix4(.5, 0, 0, .5, 0, .5, 0, .5, 0, 0, .5, .5, 0, 0, 0, 1), u = new Cesium.Cartesian4,
            a = new Cesium.Cartesian3, f = new Cesium.Matrix4;
        if (r) {
            var l = t.viewshedMap.shadowMapCullingVolume, c = new Cesium.BoundingSphere(e, 1e-5);
            if (l.computeVisibility(c) === Cesium.Intersect.OUTSIDE) return -1;
            var h = Cesium.Cartesian3.subtract(t.position, e, a), p = Cesium.Cartesian3.magnitude(h), d = 0;
            p >= 2 && p < 1e3 ? d = 0 : p >= 1e3 && p < 1e4 ? d = 1 : p >= 1e4 && (d = 2);
            var v = viewer.scene.context._gl;
            if (P(t.viewshedMap._shadowMapTexture._texture)) {
                var m = t.bestPackedTexWidth, g = t.bestPackedTexHeight,
                    y = Cesium.Matrix4.multiplyByVector(n.viewMatrix, Cesium.Cartesian4.fromElements(e.x, e.y, e.z, 1, u), u),
                    b = Cesium.Matrix4.multiplyByVector(t.viewshedMap._lightCamera.frustum.projectionMatrix, y, u),
                    w = Cesium.Cartesian3.divideByScalar(b, b.w, a), E = Math.floor((w.x * .5 + .5) * m),
                    S = Math.floor((w.y * .5 + .5) * g);
                viewer.scene.viewshedQueryResultsX = E / m, viewer.scene.viewshedQueryResultsY = S / g;
                var x = 4 * m, T = E * 4 + S * x, N = new Cesium.Cartesian4;
                N.x = t.bestPackedDepth[d][T++], N.y = t.bestPackedDepth[d][T++], N.z = t.bestPackedDepth[d][T++], N.w = t.bestPackedDepth[d][T], Cesium.Cartesian4.divideByScalar(N, 255, N);
                var C = Cesium.Cartesian4.dot(N, s), k = new Cesium.Cartesian4,
                    L = Cesium.Cartesian4.clone(Cesium.Cartesian4.UNIT_W, new Cesium.Cartesian4);
                L.x = viewer.scene.viewshedQueryResultsX * 2 - 1, L.y = viewer.scene.viewshedQueryResultsY * 2 - 1, L.z = C * 2 - 1, L.w = 1, k = Cesium.Matrix4.multiplyByVector(t.inverseViewProjMatrix, L, k);
                var A = 1 / k.w;
                Cesium.Cartesian3.multiplyByScalar(k, A, k);
                var O = Cesium.Cartesian3.fromCartesian4(k, new Cesium.Cartesian3);
                h = Cesium.Cartesian3.subtract(t.position, O, a);
                var M = Cesium.Cartesian3.magnitude(h), _ = .5, D = {isVisible: !(M + _ < p), distance: M};
                return D
            }
            return undefined
        }
    }

    var c = a.i18n("Meter"), h = a.i18n("Km"), p = a.i18n("Feet"), d = a.i18n("Mile");
    const v = 53 * Cesium.Math.RADIANS_PER_DEGREE, m = 53 * Cesium.Math.RADIANS_PER_DEGREE, g = 6371010;
    var y = {ABOVE_SEA_LEVEL: 0, ABOVE_GROUND_LEVEL: 1, ABOVE_MODEL: 2}, b = {
            0: a.i18n("viewshed_altitude_method_sea"),
            1: a.i18n("viewshed_altitude_method_ground"),
            2: a.i18n("viewshed_altitude_method_model")
        }, w = undefined, E = function () {
            this._startPositionCartesian = null, this._startPositionCartographic = null, this._currentPosition = null, this._prevRadius = null, this._currentRadius = null, this._currentFovHorizontal = null, this._currentFovVertical = null, this._viewshedDirection = null, this._scratchCartesian3 = new Cesium.Cartesian3, this._texture = null, this._canEnlarge = !1, this._viewshedPrimitive = null, this._eventListener = null, this._viewshedMap = undefined, this._firstTime = !0, this._editingMode = !1, this._isSliderClicked = !1, this._currentObject = undefined, this._setNewPosition = !1, this._setNewPositionCanDrag = !1, this._setNewName = !1, this._listControl = undefined, this._addingViewshedMode = !1, this._initialCameraParams = {}, this._isCancelledTerrain = !1, this._isCancelledPrimitives = !1, this._isSpherical = !1, this._occluder = undefined, this._horizonCullingDistanceFromPoint = undefined, this._mousePositionX = undefined, this._mousePositionY = undefined, this._zAxisNewPosition = undefined, this._startingRepoZHeight = undefined, this._viewshedCartoPos = undefined, this._propertiesChanged = !1, this._calculations = [], this._exposures = [], this._calculating = !1, this._calculatingExposure = !1, this.viewshedCalculateNormals = !0, this._txtUnit = a.i18n("meters_short"), this._isOpened = !1, this._positionIndicationForMobile = null, this.isLoadingScreenOn = !1, this._primitiveColor = Cesium.Color.WHITE, this._predefinedPrimitiveColors = {
                BEYOND_THE_HORIZON: Cesium.Color.WHITE,
                DEFAULT: Cesium.Color.WHITE
            }, this._layersStorage = r.DefaultStorage, this.getId = function () {
                return "Viewshed"
            }, this.getMenuEntry = function () {
                return t.addToSidebar(this, a.i18n("Menu_Analyze_Viewshed"), "./img/newDesign/analyze_viewshed.png", 19, t.MenuEntryAnalyze(), a.i18n("TerrainAnalysis_Header"))
            }, this.open = function (t) {
                TerraExplorer.isTouch() && TerraExplorer.tools.SideBar.IsShown && e("#sideBar #closeXID").click(), this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
                var n = TerraExplorer.internal.Project;
                n._allAvailableObjectsNames[n._objectTypes.VIEWSHED] === undefined && (n._allAvailableObjectsNames[n._objectTypes.VIEWSHED] = new Array(TerraExplorer.maxNumViewshed));
                if (t == undefined || t.viewshedMap == undefined) {
                    this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), this._addingViewshedMode = !0, this._editingMode = !1, e(".viewshedButton").css("opacity", "0.3"), e(".viewshedButton").attr("disabled", !0);
                    if (t != undefined && t.viewshedObjOptions != undefined) var r = e.extend({}, t.viewshedObjOptions);
                    this._currentObject = {
                        viewshedPrimitive: this._viewshedPrimitive,
                        viewshedMap: this._viewshedMap,
                        viewshedObjOptions: r
                    }, this._isSpherical = !1, this._setNewPosition = !1, this._eventListener.setInputAction(e.proxy(this.setViewshedPosition, this), Cesium.ScreenSpaceEventType.LEFT_CLICK), viewer.scene.preRender.addEventListener(this.onPreFrame, this)
                } else this._editingMode = !0, this._addingViewshedMode = !1, this._viewshedMap = t.viewshedMap, this._viewshedPrimitive = t.viewshedPrimitive, this._currentObject = t;
                TerraExplorer.tools.ToolContainer.showWithDelegate(this, function () {
                })
            }
        }, S = new Cesium.Cartesian3, x = new Cesium.Matrix4, T = new Cesium.Cartesian4, N = new Cesium.Cartesian3,
        C = this;
    E.inheritsFrom(n), E.inheritsFrom(u), Cesium.defineProperties(E.prototype, {}), E.prototype.CreateViewshed = function (t, n, r, i) {
        viewer.scene.viewsheds == undefined && (viewer.scene.viewsheds = []);
        var s = viewer.scene.viewsheds.length;
        if (s >= TerraExplorer.maxNumViewshed) return -1;
        var o = {};
        o.position = Cesium.defaultValue(t, new Cesium.Cartesian3.fromDegrees(0, 0)), o.distance = Cesium.defaultValue(n, 100), o.direction = r, o.viewshedObjOptions = Cesium.defaultValue(i, {}), o.guid = Cesium.defaultValue(o.viewshedObjOptions.originalGuid, Cesium.createGuid()), o.viewshedObjOptions.originalDirection = Cesium.defaultValue(o.viewshedObjOptions.originalDirection, r), o.type = "viewshed", o.tool = this.getId(), o.viewshedObjOptions.displayName != undefined && (o._displayName = o.viewshedObjOptions.displayName, o.displayName = o.viewshedObjOptions.displayName);
        var u = TerraExplorer.internal.Project;
        if (o.viewshedObjOptions._displayName !== undefined && o.viewshedObjOptions.fromStorage && o.viewshedObjOptions._displayName.indexOf(a.i18n("viewshed_display_newViewshedName")) > -1) {
            var f = Number(o.viewshedObjOptions._displayName.split("#")[1]);
            u._allAvailableObjectsNames[u._objectTypes.VIEWSHED] === undefined && (u._allAvailableObjectsNames[u._objectTypes.VIEWSHED] = new Array(TerraExplorer.maxNumViewshed)), u._allAvailableObjectsNames[u._objectTypes.VIEWSHED][f] = !0
        }
        o.viewshedObjOptions.isSpherical == undefined && (o.viewshedObjOptions.isSpherical = r == undefined ? !0 : !1);
        var l = !o.viewshedObjOptions.isSpherical, c = o.viewshedObjOptions.isHelper != undefined ? !0 : undefined,
            h = undefined;
        o.viewshedObjOptions.camera != undefined ? h = o.viewshedObjOptions.camera : (h = new Cesium.Camera(viewer.scene), h.position = t, h.direction = Cesium.defaultValue(r, Cesium.Cartesian3.negate(Cesium.Cartesian3.UNIT_Z, new Cesium.Cartesian3)), l && (h.frustum.near = 1, h.frustum.far = n, h.frustum.fov = Cesium.defaultValue(o.viewshedObjOptions.hFOV, 53 * Math.PI / 180), h.frustum._fovy = Cesium.defaultValue(o.viewshedObjOptions.vFOV, 53 * Math.PI / 180), h.frustum.aspectRatio = Cesium.defaultValue(o.viewshedObjOptions.aspectRatio, 1), h.frustum._offCenterFrustum.left = -1 * Math.tan(h.frustum.fov / 2), h.frustum._offCenterFrustum.right = Math.tan(h.frustum.fov / 2), h.frustum._offCenterFrustum.top = Math.tan(h.frustum._fovy / 2), h.frustum._offCenterFrustum.bottom = -1 * Math.tan(h.frustum._fovy / 2), Cesium.Cartesian3.clone(viewer.scene.globe.ellipsoid.geodeticSurfaceNormal(h.position, S), h.up), h.frustum.isViewshed = !0));
        var p = {context: viewer.scene.context, lightCamera: h, enabled: !0, fromLightSource: !0};
        l ? (p.isSpotLight = !0, p.isPointLight = !1, p.softShadows = !0, o.bestTexture = o.viewshedObjOptions.bestTexture != undefined ? o.viewshedObjOptions.bestTexture : undefined) : (p.isPointLight = !0, p.isSpotLight = undefined, p.pointLightRadius = n, o.bestSixTextures = []), o.viewshedObjOptions.resolution = Cesium.defaultValue(i.resolution, 2048), o.viewshedMap = new Cesium.ShadowMap(p), o.viewshedMap.guid = o.guid, o.viewshedMap._distance = p.isSpotLight ? p.lightCamera.frustum.far : 1, o.viewshedMap.show = !0, o.viewshedMap.isPreviewMode = !0, o.viewshedMap.horizonCullingDistanceFromViewshed = Cesium.defaultValue(o.viewshedObjOptions.horizonCullingDistanceFromViewshed, g), i.isVOT && (o.viewshedMap.isVOT = !0, o.viewshedMap.videoTexture = TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool._videoTextures[o._displayName]), Object.defineProperty(o, "show", {
            "default": !0,
            get: function () {
                return this.viewshedMap.show
            },
            set: function (e) {
                this.viewshedMap.show = e, this.viewshedPrimitive.isVOT && this.isProjectorShown ? this.viewshedPrimitive.show = e : this.viewshedPrimitive.isVOT || (this.viewshedPrimitive.show = e), this.viewshedMap.isVOT && (TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool._primsVid[this.displayName].show = e, e ? TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool._allVideos[this.displayName].play() : TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool._allVideos[this.displayName].pause())
            }
        }), Object.defineProperty(o, "displayName", {
            "default": !0, get: function () {
                return this._displayName
            }, set: function (e) {
                this._displayName = e, this.viewshedObjOptions._displayName = e, this.viewshedObjOptions.displayName = e
            }
        });
        if (c == undefined) {
            l ? (o.viewshedPrimitive = viewer.scene.primitives.add(new Cesium.DebugCameraPrimitive({
                camera: h,
                color: Cesium.Color.WHITE
            })), o.viewshedPrimitive._numFrustrums = 0, o.viewshedPrimitive._outlineOnlyFrustum = !0, o.viewshedPrimitive.isViewshed = !0, o.viewshedPrimitive.isVOT = !!i.isVOT, o.viewshedPrimitive.videoID = o.viewshedObjOptions.originalGuid, o.viewshedPrimitive.update = this.updateViewshedPrimitive) : o.viewshedPrimitive = this.createViewshedSpherePrimitive(o.position, o.viewshedMap._pointLightRadius);

            function d(t) {
                var n;
                return e(t._exposures).each(function (e, r) {
                    if (r.vs._object.position.equalsEpsilon(viewer.camera.position, Cesium.Cartesian3.ZERO, Cesium.Math.EPSILON4)) return n = r, t._exposures.splice(e, 1), !1
                }), n === undefined && t._exposures.length > 0 && (n = t._exposures.shift()), n
            }

            E.prototype.tryGetExposures = function () {
                if (this._exposures.length > 0 && !this._calculatingExposure) {
                    var e = d(this);
                    e ? (TerraExplorer.__showViewshedDebugMessages && console.log("start getObjectExposure.. "), e.vs._object._exposurePromise = e.promise, this._calculatingExposure = !0, this.getObjectExposure(e.id, e.vs._object)) : TerraExplorer.__showViewshedDebugMessages && console.log("check error..could not find exposureObject")
                } else TerraExplorer.__showViewshedDebugMessages && console.log("No more exposures..try calculating "), this.tryCalculating()
            }, o.getObjectExposure = function (e) {
                var t = Cesium.when.defer();
                try {
                    var n = TerraExplorer.tools.ToolManager._tools.Viewshed;
                    n._exposures.push({vs: this, promise: t, id: e}), n.tryGetExposures()
                } catch (r) {
                    t.reject()
                }
                return t.promise
            }, E.prototype.tryCalculating = function () {
                var e = this;
                this._calculations.length > 0 && !this._calculating && !this._calculatingExposure ? (this._calculating = !0, this._currentVSCalculated = this._calculations.shift(), TerraExplorer.__showViewshedDebugMessages && console.log("start calculating.. " + this._currentVSCalculated._object._displayName), this.getBestData(this._currentVSCalculated._object)) : this._calculations.length === 0 && !this._calculating && !this._calculatingExposure && (TerraExplorer.__showViewshedDebugMessages && console.log("finish calculations chain.. "), viewer.camera.setView({
                    destination: e._initialCameraParams.pos,
                    orientation: {direction: e._initialCameraParams.dir, up: e._initialCameraParams.up}
                }), e.removeLoadingScreen())
            }, o.calculate = function () {
                var e = Cesium.when.defer();
                try {
                    this._object.promise = e;
                    var t = TerraExplorer.tools.ToolManager._tools.Viewshed;
                    t._calculations.push(this), t.tryCalculating()
                } catch (n) {
                    e.reject()
                }
                return e.promise
            }, o.queryPointVisibility = function (e) {
                return TerraExplorer.tools.ToolManager._tools.Viewshed.QueryPointVisibility(e, this._object)
            }, o.queryVisibilityDistance = function (e) {
                return TerraExplorer.tools.ToolManager._tools.Viewshed.QueryVisibilityDistance(e, this._object)
            }, o.getObjectPosition = function (e) {
                return TerraExplorer.tools.ToolManager._tools.Viewshed.getObjectPosition(e, this._object)
            }, o.destroy = function () {
                TerraExplorer.tools.ToolManager._tools.Viewshed.deleteViewshed(this)
            }, viewer.scene.viewsheds.push(o.viewshedMap), o.viewshedMap.show = Cesium.defaultValue(i.show, !0), o.viewshedPrimitive.show = Cesium.defaultValue(i.show, !0), o.defaultName = a.i18n("viewshed_display_newViewshedName"), i.isVOT || TerraExplorer.internal.Project.addToObjectList(o)
        }
        return o.delete = o.viewshedObjOptions.delete = function () {
            TerraExplorer.tools.ToolManager._tools.Viewshed.deleteViewshed()
        }, o.timestamp = o.viewshedObjOptions.timestamp = Cesium.defaultValue(o.viewshedObjOptions.timestamp, Date.now()), o
    }, E.prototype.onBeforeOpenToolContainer = function () {
        e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this.displayViewshedInfo(), e("link[href='./css/jquery-ui.min.css']").length > 0 && (document.querySelector("link[href='./css/jquery-ui.min.css']").href = "./css/spinner.css");
        var t = TerraExplorer.tools.ToolContainer.buttonType;
        return this._toolContainer.addButton("deleteViewshed", "./img/delete.png", undefined, a.i18n("Viewshed_Tooltip_Delete"), t.BUTTON, !0), this._toolContainer.addButton("displayProperties", "./img/newDesign/vs_layer_properties.png", undefined, a.i18n("Viewshed_Tooltip_Properties"), t.CHECKBOX_BUTTON), this._toolContainer.addButton("setNewPosition", "./img/newDesign/vs_reposition.png", undefined, a.i18n("Viewshed_Tooltip_Move_Horizontal"), t.RADIO_BUTTON), this._toolContainer.addButton("setRelativeToTerrainHeight", "./img/newDesign/vs_vert_reposition.png", undefined, a.i18n("Viewshed_Tooltip_Move_Vertical"), t.RADIO_BUTTON, !0), this._toolContainer.addButton("getBestData", "./img/newDesign/viewshed_calculate_enable.png", undefined, a.i18n("Viewshed_Tooltip_Calculate"), t.BUTTON), this._toolContainer.RadioButtons = ["displayProperties", "setRelativeToTerrainHeight", "setNewPosition"], !0
    }, E.prototype.getBestData = function (t) {
        if (viewer.scene._view.pickDepths.length === 0) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(a.i18n("warning_depth_buffer_picking_not_supported"));
            return
        }
        e(".toolDialog").length > 0 && e(".toolDialog").remove();
        var n = Cesium.defaultValue(t, this._currentObject);
        if (n.bestTexture != undefined) {
            console.log("This viewshed object has already have its best data.");
            return
        }
        n != undefined && this.takeBestViewshedFB(n)
    }, E.prototype.CreateAHelperViewshed = function () {
        var e = Cesium.Cartesian3.fromDegrees(287.6926645742842 / Math.PI, -263.503978212553 / Math.PI),
            t = new Cesium.Cartesian3(-0.6006022029736453, .7935322072787785, .09789601521243713), n = 2,
            r = this.CreateViewshed(e, n, t, {isHelper: !0});
        viewer.scene.helperVS = r.viewshedMap
    }, E.prototype.setDescriptionText = function () {
        e("#TextView").text(a.i18n("Viewshed_Description_Text")), e("#TextView").css("color", "grey"), e("#TextView").css("margin-left", "15px"), e("#TextView").css("margin-top", "10px")
    }, E.prototype.onOpenedToolContainer = function () {
        var t = e("#setSpherical").length > 0 ? 340 : 293, n = t - 14;
        e("#ContainerRootDiv").width(t), e("#headerDivContainer").width(n);
        var r = e(".containerButton");
        for (var i = 0; i < r.length; i++) {
            var s = (i * 3).toString() + "px";
            e(r[i]).css("margin-left", s)
        }
        e(e(".toolHeaderContainer")[0]).text(a.i18n("analysis_add_viewshed")), this._firstTime && (this._firstTime = !1);
        var o = !0, u = !1;
        this._isOpened = !0, e("#getBestData")[0].src = this._currentObject.viewshedMap == undefined ? "./img/newDesign/viewshed_calculate_enable.png" : this._currentObject.viewshedMap.isPreviewMode ? "./img/newDesign/viewshed_calculate_enable.png" : "./img/newDesign/viewshed_calculate_disable.png", this._toolContainer.enableButton("deleteViewshed", o && this._editingMode), this._toolContainer.enableButton("setNewPosition", o && this._editingMode), this._toolContainer.enableButton("setRelativeToTerrainHeight", o && this._editingMode), this._toolContainer.enableButton("getBestData", o && this._editingMode), this._editingMode && (this._viewshedMap = undefined, this._viewshedPrimitive = undefined)
    }, E.prototype.getCurrentHorizontalFOV = function () {
        return this._currentObject.viewshedMap._lightCamera.frustum.fov
    }, E.prototype.getCurrentVerticalFOV = function () {
        return this._currentObject.viewshedMap._lightCamera.frustum.fovy
    }, E.prototype.checkAndInitValues = function () {
        this._currentObject != undefined && (this._currentObject.viewshedObjOptions == undefined ? (this._currentObject.viewshedObjOptions = {}, this._currentObject.viewshedObjOptions.height == undefined && (this._currentObject.viewshedObjOptions.height = 0), this._currentObject.viewshedObjOptions.hFOV == undefined && (this._currentObject.viewshedObjOptions.hFOV = v), this._currentObject.viewshedObjOptions.vFOV == undefined && (this._currentObject.viewshedObjOptions.vFOV = m)) : this._currentObject.viewshedObjOptions.height == undefined && (this._currentObject.viewshedObjOptions.height = 0, this._currentObject.viewshedObjOptions.altitudeMethod = y.ABOVE_MODEL))
    }, E.prototype.displayViewshedInfo = function () {
        if (this._currentObject !== undefined) {
            var t = e("<div style='position:relative;overflow:hidden; width:100%; height:100%;'></div>"),
                n = e("<div id='MessageClientId' style='position:relative; margin-left:15px; margin-top:10px; overflow-y:auto; width:100%;'></div>");
            t.append(n), TerraExplorer.tools.ToolContainer.setText(""), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), e("#LowerView").append(t), n.css({height: t.height()}), this._listControl = new s(n), this._listControl.IsAnalyzeToolList = !0, this._listControl.add({text: a.i18n("viewshed_display_Name") + ": &nbsp;" + this._currentObject._displayName}), this.checkAndInitValues(), this._listControl.add({text: a.i18n("viewshed_display_hFov") + ": &nbsp;" + (this._currentObject.viewshedObjOptions.hFOV * 180 / Math.PI).toFixed(1) + String.fromCharCode(176)}), this._listControl.add({text: a.i18n("viewshed_display_vFov") + ": &nbsp;" + (this._currentObject.viewshedObjOptions.vFOV * 180 / Math.PI).toFixed(1) + String.fromCharCode(176)});
            var r = Cesium.defaultValue(b[this._currentObject.viewshedObjOptions.altitudeMethod], b[y.ABOVE_MODEL]), i;
            if (this._currentObject.position != undefined) if (this._setNewPositionCanDrag) i = this._currentObject.viewshedObjOptions.heightToDisplay; else {
                var o = new Cesium.Cartographic.fromCartesian(this._currentObject.position);
                i = this.getCalculatedDisplayHeight(o.height)
            } else i = 0;
            i = k(i), this._listControl.add({text: a.i18n("viewshed_display_Altitude") + ": &nbsp;" + Cesium.defaultValue(i.toFixed(1), 0) + this._txtUnit + "&nbsp;" + r}), this._currentObject.viewshedObjOptions.heightToDisplay = i;
            var u = this._currentObject.bestTexture == undefined ? a.i18n("viewshed_display_Mode_Preview") : a.i18n("viewshed_display_Mode_Calculated"),
                f = u === a.i18n("viewshed_display_Mode_Preview") && this._currentObject.viewshedMap !== undefined ? u + " &nbsp;" + a.i18n("Viewshed_Calculate_href", {
                    aTag: "<a href=# style='text-decoration:none;color:rgba(13,194,223,1.0);' onclick='TerraExplorer.tools.ToolManager._tools.Viewshed.getBestData();'>",
                    closedATag: "</a>"
                }) : u;
            this._listControl.add({text: a.i18n("viewshed_display_Mode") + ": &nbsp;" + f})
        } else this.setDescriptionText(), e("#TextView").length > 0 && e("#TextView").css("display", "block")
    }, E.prototype.deleteViewshed = function (t, n) {
        var r = TerraExplorer.internal.Project;
        if (t != undefined) {
            var i = t.viewshedPrimitive || t._viewshedPrimitive;
            i != undefined && viewer.scene.primitives.remove(i), t.viewshedMap != undefined && (viewer.scene.shadowMap.enabled = !1);
            var s, o = r._allAnalysisObjects[t.type];
            for (var u = 0, f = o.length; u < f; u++) {
                var l = o[u]._object;
                if (l.guid == t.guid) {
                    s = l.guid, o.splice(u, 1);
                    break
                }
            }
            var c = viewer.scene.viewsheds;
            for (var u = 0, f = c.length; u < f; u++) if (c[u].guid == s) {
                c.splice(u, 1);
                break
            }
            t.viewshedObjOptions !== undefined && t.viewshedObjOptions._displayName.indexOf(a.i18n("viewshed_display_newViewshedName")) > -1 && (r._allAvailableObjectsNames[t.type][Number(t.viewshedObjOptions._displayName.split("#")[1])] = undefined), this._layersStorage.deleteItem(s, !0)
        } else {
            if (this._currentObject != undefined) {
                viewer.scene.primitives.remove(this._currentObject.viewshedPrimitive);
                var c = viewer.scene.viewsheds;
                for (var u = 0, f = c.length; u < f; u++) if (c[u].guid == this._currentObject.viewshedMap.guid) {
                    c.splice(u, 1);
                    break
                }
                var h = r._allAnalysisObjects[r._objectTypes.VIEWSHED], p;
                if (!this._editingMode) p = h.pop(); else for (var u = 0, f = h.length; u < f; u++) {
                    var c = h[u];
                    if (c._object.guid == this._currentObject.viewshedMap.guid) {
                        p = c, h.splice(u, 1);
                        break
                    }
                }
                TerraExplorer.internal.Settings.saveObjects != 2 && this._layersStorage.deleteItem(p._object.guid, !0)
            } else this._viewshedPrimitive != undefined && (viewer.scene.primitives.remove(this._viewshedPrimitive), this._viewshedPrimitive = undefined);
            this._currentObject !== undefined && this._currentObject.viewshedObjOptions._displayName !== undefined && this._currentObject.viewshedObjOptions._displayName.indexOf(a.i18n("viewshed_display_newViewshedName")) > -1 && (r._allAvailableObjectsNames[r._objectTypes.VIEWSHED][Number(this._currentObject.viewshedObjOptions._displayName.split("#")[1])] = undefined), this._canEnlarge = !1, this.removeMobileIndication(), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), TerraExplorer.tools.ToolContainer.setText("")
        }
        this._currentObject != undefined && (this._currentObject.isDeleted = !0), n || (e("#menuIconAnalyzeTool").length > 0, e("#menuIconAnalyzeTool").click(), e("#ContainerRootDiv #CloseImg").length > 0 && e("#ContainerRootDiv #CloseImg").click())
    }, E.prototype.removeMobileIndication = function () {
        this._positionIndicationForMobile !== null && (viewer.entities.remove(this._positionIndicationForMobile), this._positionIndicationForMobile = null)
    }, E.prototype.setNewPosition = function (t) {
        this.unlockFBO(), this._setNewPosition = !0, this._zAxisNewPosition = t;
        var n = this, r = Cesium.Cartographic.fromCartesian(this._currentObject.position),
            i = Cesium.sampleRenderedTerrain(viewer.terrainProvider, [r]);
        Cesium.when(i, function (e) {
            n._currentObject.viewshedObjOptions.terrainHeightAtPos = e[0].height, n._currentObject.viewshedObjOptions.altitudeMethod == y.ABOVE_GROUND_LEVEL ? n._currentObject.startingAltitudeAboveGround = Cesium.Cartographic.fromCartesian(n._currentObject.position).height - n._currentObject.viewshedObjOptions.terrainHeightAtPos : n._currentObject.viewshedObjOptions.altitudeMethod == y.ABOVE_MODEL && (n._currentObject.startingAltitudeAboveModel = n._currentObject.viewshedObjOptions.heightToDisplay)
        }), viewer.scene.preRender.addEventListener(this.onPreFrame, this), this._eventListener.setInputAction(e.proxy(this.setViewshedPosition, this), Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.setInputAction(e.proxy(this.onMouseMove, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE), t != undefined ? this._toolContainer.selectButton("setRelativeToTerrainHeight", !0) : this._toolContainer.selectButton("setNewPosition", !0), e(".toolDialog").length > 0 && e(".toolDialog").remove()
    }, E.prototype.updateDistance = function (e) {
        this.unlockFBO(), TerraExplorer.internal.Settings.altitudeUnit === 1 && (e = TerraExplorer.internal.Units.feetToMeter(e));
        var t = this._currentObject.distance, n = L("distanceTd", {min: 2}, e, t);
        n !== undefined && n !== t && (this._currentObject.viewshedMap._lightCamera.frustum.far = e, this._currentObject.viewshedObjOptions.distance = e, this._currentObject.distance = e, this.toPreviewMode(this._currentObject))
    }, E.prototype.updatePosition = function (e, t) {
        this.unlockFBO(), this._viewshedCartoPos == undefined && (this._viewshedCartoPos = new Cesium.Cartographic.fromCartesian(this._currentObject.position)), e = e * Math.PI / 180;
        if (t == "X") var n = new Cesium.Cartesian3.fromRadians(e, this._viewshedCartoPos.latitude, this._viewshedCartoPos.height); else if (t == "Y") var n = new Cesium.Cartesian3.fromRadians(this._viewshedCartoPos.longitude, e, this._viewshedCartoPos.height);
        this.adjustDirections(), this._currentObject.viewshedPrimitive._camera.position = n, this._viewshedCartoPos = new Cesium.Cartographic.fromCartesian(n), this._currentObject.position = n, this.toPreviewMode(this._currentObject)
    }, E.prototype.updateFOV = function (t, n) {
        this.unlockFBO();
        var r = n * Math.PI / 180, i = n;
        if (t == 1) {
            var s = this._currentObject.viewshedObjOptions.hFOV,
                o = L("hFovTd", {min: 1, max: 120}, n, s * 180 / Math.PI);
            o !== undefined && (o = o * Math.PI / 180);
            if (this._currentObject.viewshedMap != undefined && o !== undefined && o !== s) {
                this._currentObject.viewshedMap._lightCamera.frustum.fov = r;
                var u = this._currentObject.viewshedMap._lightCamera.frustum.fovy;
                this._currentObject.viewshedMap._lightCamera.frustum.aspectRatio = Math.tan(r / 2) / Math.tan(u / 2), this._currentObject.viewshedPrimitive._camera.frustum._offCenterFrustum.left = -Math.tan(r / 2), this._currentObject.viewshedPrimitive._camera.frustum._offCenterFrustum.right = Math.tan(r / 2), this._currentFovHorizontal = r, this._currentObject.viewshedObjOptions.hFOV = r, e("#hFovTd").length > 0 && e("#hFovTd input").val(r * 180 / Math.PI)
            } else o !== undefined && o === s ? e("#hFovTd").length > 0 && e("#hFovTd input").val(o * 180 / Math.PI) : e("#hFovTd input").val(n)
        }
        if (t == 2) {
            var s = this._currentObject.viewshedObjOptions.vFOV,
                o = L("vFovTd", {min: 1, max: 64}, r * 180 / Math.PI, s * 180 / Math.PI);
            o !== undefined && (o = o * Math.PI / 180);
            if (this._currentObject.viewshedMap != undefined && o !== undefined && o !== s) {
                this._currentObject.viewshedMap._lightCamera.frustum._fovy = r;
                var a = this._currentObject.viewshedMap._lightCamera.frustum.fov;
                this._currentObject.viewshedMap._lightCamera.frustum.aspectRatio = Math.tan(a / 2) / Math.tan(r / 2), this._currentObject.viewshedPrimitive._camera.frustum._offCenterFrustum.top = Math.tan(r / 2), this._currentObject.viewshedPrimitive._camera.frustum._offCenterFrustum.bottom = -Math.tan(r / 2), this._currentFovVertical = r, this._currentObject.viewshedObjOptions.vFOV = r, e("#vFovTd input").length > 0 && e("#vFovTd input").val(r * 180 / Math.PI)
            } else o !== undefined && o === s ? e("#vFovTd input").length > 0 && e("#vFovTd input").val(o * 180 / Math.PI) : e("#vFovTd input").val(n)
        }
        this.toPreviewMode(this._currentObject), this._currentObject.viewshedMap !== undefined ? this._currentObject.viewshedMap._lightCamera.frustum.far += 1e-4 : t === 1 ? this._currentFovHorizontal = r : t === 2 && (this._currentFovVertical = r)
    }, E.prototype.toPreviewMode = function (t) {
        t.viewshedMap != undefined && !t.viewshedMap.isPreviewMode && (e("#getBestData")[0].src = "./img/newDesign/viewshed_calculate_enable.png"), this.unlockFBO(), t.viewshedMap != undefined && (t.viewshedMap.dirtyFOV = !0, t.viewshedMap.isPreviewMode = !0), t.bestTexture = undefined, this.displayViewshedInfo()
    }, E.prototype.updateHeight = function (e, t) {
        this.unlockFBO(), TerraExplorer.internal.Settings.altitudeUnit === 1 && this._txtUnit !== a.i18n("meters_short") && (e = TerraExplorer.internal.Units.feetToMeter(e));
        if (this._currentObject.viewshedMap == undefined) {
            this._currentObject.viewshedObjOptions.height = isNaN(e) ? undefined : e;
            return
        }
        var n = Cesium.Cartesian3.clone(this._currentObject.viewshedMap._lightCamera.position),
            r = new Cesium.Cartographic.fromCartesian(n), i = r.height;
        this._currentObject.viewshedObjOptions = Cesium.defaultValue(this._currentObject.viewshedObjOptions, {});
        if (this._currentObject.viewshedObjOptions.altitudeMethod != undefined) switch (this._currentObject.viewshedObjOptions.altitudeMethod) {
            case 0:
                this._currentObject.viewshedObjOptions.height = r.height, this._currentObject.viewshedMap._lightCamera.position = new Cesium.Cartesian3.fromRadians(r.longitude, r.latitude, e);
                break;
            case 1:
                this._currentObject.viewshedObjOptions.height = r.height - this._currentObject.viewshedObjOptions.terrainHeightAtPos, this._currentObject.viewshedMap._lightCamera.position = new Cesium.Cartesian3.fromRadians(r.longitude, r.latitude, e + t);
                break;
            case 2:
                this._currentObject.viewshedObjOptions.height = r.height - this._currentObject.viewshedObjOptions.pickHeight, this._currentObject.viewshedMap._lightCamera.position = new Cesium.Cartesian3.fromRadians(r.longitude, r.latitude, e + this._currentObject.viewshedObjOptions.pickHeight)
        } else this._currentObject.viewshedObjOptions.height = 0;
        this._currentObject.position = this._currentObject.viewshedMap._lightCamera.position.clone(), this._layersStorage.saveItem(this._currentObject), this.toPreviewMode(this._currentObject)
    }, E.prototype.getCalculatedDisplayHeight = function (e) {
        var t = e;
        if (this._currentObject.viewshedObjOptions.altitudeMethod != undefined) switch (this._currentObject.viewshedObjOptions.altitudeMethod) {
            case 0:
                t = t;
                break;
            case 1:
                t -= this._currentObject.viewshedObjOptions.terrainHeightAtPos;
                break;
            case 2:
                t -= this._currentObject.viewshedObjOptions.pickHeight
        } else t -= this._currentObject.viewshedObjOptions.terrainHeightAtPos;
        return isNaN(t) && (t = Cesium.defaultValue(this._currentObject.viewshedObjOptions.height, 0)), t
    }, E.prototype.displayViewshedProperties = function () {
        e("link[href='./css/datePicker.css']").length > 0 && (document.querySelector("link[href='./css/datePicker.css']").href = "./css/jquery-ui.min.css"), this._toolContainer.selectButton("displayProperties", !0), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), viewer.scene.preRender.removeEventListener(this.onPreFrame, this);
        if (this._currentObject != undefined) {
            if (this._currentObject.viewshedMap != undefined && this._currentObject.viewshedMap._lightCamera.position.x != null) var t = Cesium.Cartesian3.clone(this._currentObject.viewshedMap._lightCamera.position),
                n = new Cesium.Cartographic.fromCartesian(t), r = n.height,
                i = Cesium.sampleRenderedTerrain(viewer.terrainProvider, [n]); else var i = new Promise(function (e, t) {
                e([{height: 0}])
            });
            var s = this;
            Cesium.when(i, function (t) {
                var n = t[0].height;
                s._currentObject.viewshedObjOptions.terrainHeightAtPos = n, s._currentObject.viewshedObjOptions.distance = k(s._currentObject.viewshedObjOptions.distance), r = s.getCalculatedDisplayHeight(r), r = k(r), s._currentObject.type === undefined && (s._currentObject.type = TerraExplorer.internal.Project._objectTypes.VIEWSHED), s._currentObject.defaultName === undefined && (s._currentObject.defaultName = a.i18n("viewshed_display_newViewshedName")), s._currentObject.viewshedMap != undefined ? s._currentObject.viewshedObjOptions.distance = s._currentObject.viewshedMap._lightCamera.frustum.far : s._currentObject.viewshedObjOptions.distance = 1, s._currentObject.viewshedObjOptions.distance = k(s._currentObject.viewshedObjOptions.distance);
                var i = new l(s.CreatePropObj(n, r));
                e("#newNameId").val(Cesium.defaultValue(s._currentObject._displayName, TerraExplorer.internal.Project.getAvailableDefaultName(s._currentObject, s._currentObject.viewshedMap === undefined)));
                if (TerraExplorer.tools.ToolManager._tools.Viewshed._currentObject.position != undefined) {
                    e("#altitudeMethodTd select").attr("disabled", !1);
                    var o = new Cesium.Cartographic.fromCartesian(s._currentObject.position);
                    i.addSpinner(o.longitude * 180 / Math.PI, 1e-5, -180, 180, "xTd", {
                        decimalPoint: 6,
                        onCreate: function () {
                            e("#xTd").val() == 1 && (e("#xTd").val(""), this._currentObject.viewshedObjOptions.distance = undefined)
                        },
                        onChange: function () {
                            s.updatePosition(Number(e("#xTd input")[0].value), "X"), s._propertiesChanged = !0
                        },
                        onSpin: function () {
                            s.updatePosition(Number(e("#xTd input")[0].value), "X"), s._propertiesChanged = !0
                        }
                    }), i.addSpinner(o.latitude * 180 / Math.PI, 1e-5, -90, 90, "yTd", {
                        decimalPoint: 6,
                        onCreate: function () {
                            e("#yTd").val() == 1 && (e("#yTd").val(""), this._currentObject.viewshedObjOptions.distance = undefined)
                        },
                        onChange: function () {
                            s.updatePosition(Number(e("#yTd input")[0].value), "Y"), s._propertiesChanged = !0
                        },
                        onSpin: function () {
                            s.updatePosition(Number(e("#yTd input")[0].value), "Y"), s._propertiesChanged = !0
                        }
                    })
                } else e("#altitudeMethodTd select").attr("disabled", !0)
            })
        }
    }, E.prototype.CreatePropObj = function (t, n) {
        var r = this, i = {
            title: a.i18n("viewshed_display_properties"),
            img: "./img/newDesign/analyze_viewshed.png",
            onCloseDialogUpdate: r.onCloseDialogUpdate,
            fields: [{
                label: a.i18n("viewshed_display_Name"),
                type: "textbox",
                id: "newNameId"
            }, {
                label: a.i18n("viewshed_display_hFov"),
                type: "spinner",
                id: "hFovTd",
                spinnerParams: {
                    dV: r._currentObject.viewshedObjOptions.hFOV * 180 / Math.PI,
                    dS: 1,
                    dMin: 1,
                    dMax: 120,
                    divName: "hFovTd",
                    params: {
                        onCreate: function () {
                            e("#spinnerhFovTd").val() == 1 && e("#spinnerhFovTd").val("")
                        }, onChange: function () {
                            isNaN(Number(e("#spinnerhFovTd")[0].value)) || r.updateFOV(1, Number(e("#spinnerhFovTd")[0].value)), r._propertiesChanged = !0
                        }, onSpin: function () {
                            isNaN(Number(e("#spinnerhFovTd")[0].value)) || r.updateFOV(1, Number(e("#spinnerhFovTd")[0].value)), r._propertiesChanged = !0
                        }
                    }
                }
            }, {
                label: a.i18n("viewshed_display_vFov"),
                type: "spinner",
                id: "vFovTd",
                spinnerParams: {
                    dV: r._currentObject.viewshedObjOptions.vFOV * 180 / Math.PI,
                    dS: 1,
                    dMin: 1,
                    dMax: 64,
                    divName: "vFovTd",
                    params: {
                        onCreate: function () {
                            e("#spinnervFovTd").val() == 1 && e("#spinnervFovTd").val("")
                        }, onChange: function () {
                            isNaN(Number(e("#spinnervFovTd")[0].value)) || r.updateFOV(2, Number(e("#spinnervFovTd")[0].value)), r._propertiesChanged = !0
                        }, onSpin: function () {
                            isNaN(Number(e("#spinnervFovTd")[0].value)) || r.updateFOV(2, Number(e("#spinnervFovTd")[0].value)), r._propertiesChanged = !0
                        }
                    }
                }
            }, {
                label: a.i18n("viewshed_display_distance") + "(" + r._txtUnit + ")",
                type: "spinner",
                id: "distanceTd",
                spinnerParams: {
                    dV: r._currentObject.viewshedObjOptions.distance,
                    dS: 1,
                    dMin: 2,
                    dMax: 5e6,
                    divName: "distanceTd",
                    params: {
                        onCreate: function () {
                            e("#spinnerdistanceTd").val() == 1 && (e("#spinnerdistanceTd").val(""), TerraExplorer.tools.ToolManager._tools.Viewshed._currentObject.viewshedObjOptions.distance = undefined)
                        }, onChange: function () {
                            isNaN(Number(e("#spinnerdistanceTd")[0].value)) || r.updateDistance(Number(e("#spinnerdistanceTd")[0].value)), r._propertiesChanged = !0
                        }, onSpin: function () {
                            isNaN(Number(e("#spinnerdistanceTd")[0].value)) || r.updateDistance(Number(e("#spinnerdistanceTd")[0].value)), r._propertiesChanged = !0
                        }
                    }
                }
            }, {
                label: a.i18n("viewshed_display_X"), type: "spinner", id: "xTd", params: {
                    onCreate: function () {
                        e("#xTd").val() == 1 && e("#xTd").val("")
                    }, onChange: function () {
                        isNaN(Number(e("#xTd")[0].value)) || r.updatePosition(Number(e("#xTd")[0].value), "X"), r._propertiesChanged = !0
                    }, onSpin: function () {
                        isNaN(Number(e("#xTd")[0].value)) || r.updatePosition(Number(e("#xTd")[0].value), "X"), r._propertiesChanged = !0
                    }
                }
            }, {
                label: a.i18n("viewshed_display_Y"), type: "spinner", id: "yTd", params: {
                    onCreate: function () {
                        e("#yTd").val() == 1 && e("#yTd").val("")
                    }, onChange: function () {
                        isNaN(Number(e("#yTd")[0].value)) || r.updatePosition(Number(e("#yTd")[0].value), "Y"), r._propertiesChanged = !0
                    }, onSpin: function () {
                        isNaN(Number(e("#yTd")[0].value)) || r.updatePosition(Number(e("#yTd")[0].value), "Y"), r._propertiesChanged = !0
                    }
                }
            }, {
                label: a.i18n("viewshed_display_Altitude") + "(" + r._txtUnit + ")",
                type: "spinner",
                id: "altitudeTd",
                spinnerParams: {
                    dV: n,
                    dS: 1,
                    dMin: 0,
                    dMax: 5e6,
                    divName: "altitudeTd",
                    params: {
                        terrainHeight: t, onCreate: function () {
                            Cesium.defaultValue(n, 0) == 1 && e("#altitudeTd input").val("")
                        }, onChange: function () {
                            isNaN(Number(e("#altitudeTd input")[0].value)) || r.updateHeight(Number(e("#altitudeTd input")[0].value), t), r._propertiesChanged = !0
                        }, onSpin: function () {
                            isNaN(Number(e("#altitudeTd input")[0].value)) || r.updateHeight(Number(e("#altitudeTd input")[0].value), t), r._propertiesChanged = !0
                        }
                    }
                }
            }, {
                label: a.i18n("viewshed_display_AltitudeMethod"),
                type: "combobox",
                id: "altitudeMethodTd",
                selectId: "altitudeMethodSelectionBox",
                onChange: r.onChangeAltitudeMethodSelectionBox,
                comboItems: [{
                    value: y.ABOVE_SEA_LEVEL,
                    key: b[y.ABOVE_SEA_LEVEL],
                    defaultItem: r._currentObject.viewshedObjOptions.altitudeMethod === 0
                }, {
                    value: y.ABOVE_GROUND_LEVEL,
                    key: b[y.ABOVE_GROUND_LEVEL],
                    defaultItem: r._currentObject.viewshedObjOptions.altitudeMethod === 1
                }, {
                    value: y.ABOVE_MODEL,
                    key: b[y.ABOVE_MODEL],
                    defaultItem: r._currentObject.viewshedObjOptions.altitudeMethod === 2
                }],
                defaultComboItem: ""
            }]
        };
        return i
    }, E.prototype.onChangeAltitudeMethodSelectionBox = function () {
        var t = TerraExplorer.tools.ToolManager._tools.Viewshed,
            n = e("#altitudeMethodSelectionBox").find(":selected").index();
        t._currentObject.viewshedObjOptions.altitudeMethod = n;
        var r = new Cesium.Cartographic.fromCartesian(t._currentObject.position),
            i = t.getCalculatedDisplayHeight(r.height);
        e("#spinneraltitudeTd").val(i.toFixed(1)), t._propertiesChanged = !0, t.displayViewshedInfo()
    }, E.prototype.resetObjProperties = function () {
        this._currentFovHorizontal = undefined, this._currentFovVertical = undefined, this._currentObject.viewshedObjOptions.distance = undefined
    }, E.prototype.unlockFBO = function () {
        this._currentObject != undefined && this._currentObject.viewshedMap != undefined && (this._currentObject.viewshedMap.freezeFBO = !1)
    }, E.prototype.onCloseDialogUpdate = function (t) {
        TerraExplorer.tools.ToolDialog.SetPosition();
        var n = TerraExplorer.tools.ToolManager._tools.Viewshed;
        if (!t) {
            var r = e("#newNameId").val();
            n._currentObject._displayName = r, n._currentObject.viewshedObjOptions._displayName = r, n._propertiesChanged || n.resetObjProperties(), e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click(), e(".listControlLineTextNormalSidebar").each(function (t, n) {
                n.textContent == r && e(n).click()
            }), TerraExplorer.tools.ToolManager.openTool("Viewshed", n._currentObject), e(e(".selectedLine img")[0]).length > 0 && e(".selectedLine img")[0].click()
        }
        n._prevHFov = undefined, n._prevVFov = undefined, n._viewshedCartoPos = undefined
    }, E.prototype.onBeforeCloseToolContainer = function (e) {
        this._toolContainer._selectedButtons = {}
    }, E.prototype.onClosedToolContainer = function () {
        o.IsOpen && o.close(), e(".viewshedButton").length > 0 && (e(".viewshedButton").css("opacity", "1"), e(".viewshedButton").attr("disabled", !1)), e("#TextView").length > 0 && e("#TextView").css("display", "block"), this._canEnlarge && (viewer.scene.primitives._primitives.pop(), viewer.scene.viewsheds.pop(), this._canEnlarge = !1, this.resetAllVariables()), this._isOpened = !1, this._editingMode = !1, this._eventListener !== null && (this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)), viewer.scene.preRender.removeEventListener(this.onPreFrame, this), this._setNewPosition = !1, f.Mode == f.CLIENT && (f.Mode = f.FREE_FLIGHT), e("link[href='./css/spinner.css']").length > 0 && (document.querySelector("link[href='./css/spinner.css']").href = "./css/jquery-ui.min.css");
        if (this._currentObject !== undefined && this._currentObject.viewshedMap != undefined && !this._currentObject.isDeleted) {
            if (this._currentObject.displayName !== undefined && this._currentObject.displayName.startsWith(a.i18n("viewshed_display_newViewshedName"))) {
                var t = this._currentObject.displayName.split(a.i18n("viewshed_display_newViewshedName"))[1];
                t < TerraExplorer.internal.Project._allAvailableObjectsNames[this._currentObject.type].length && t >= 0 && (TerraExplorer.internal.Project._allAvailableObjectsNames[this._currentObject.type][t] = !0)
            }
            TerraExplorer.internal.Settings.saveObjects == 0 && this._layersStorage.saveItem(this._currentObject)
        }
        this._addingViewshedMode = !1, this._propertiesChanged = !1
    }, E.prototype.onButtonClick = function (e) {
        this.parent.onButtonClick.call(this, e), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);
        switch (e) {
            case"deleteViewshed":
                this._currentObject != undefined && this.deleteViewshed();
                break;
            case"displayProperties":
                this.displayViewshedProperties();
                break;
            case"setNewPosition":
                this.setNewPosition();
                break;
            case"setRelativeToTerrainHeight":
                this.setNewPosition(!0);
                break;
            case"getBestData":
                this.getBestData()
        }
    }, E.prototype.resetAllVariables = function () {
        this._startPositionCartesian = null, this._startPositionCartographic = null, this._currentPosition = null, this._currentRadius = null, this._currentFovHorizontal = null, this._currentFovVertical = null, this._setNewPosition = !1, this._currentObject = undefined, this._viewshedMap = undefined, this._canEnlarge = !1, this._zAxisNewPosition = undefined, this.removeMobileIndication(), this._positionIndicationForMobile = null
    }, E.prototype.setViewshedPosition = function (t) {
        var n = this;
        e("#TextView").length > 0 && e("#TextView").css("display", "none");
        if (!this._setNewPosition) if (this._canEnlarge && this._viewshedPrimitive != undefined) {
            this._canEnlarge = !1, this.removeMobileIndication(), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
            if (this._viewshedMap != undefined && this._viewshedPrimitive != undefined) {
                var r = this._viewshedPrimitive._camera;
                viewer.scene.primitives._primitives.pop(), viewer.scene.viewsheds.pop(), this._currentObject.viewshedObjOptions.initialHeading = r.heading, this._currentObject.viewshedObjOptions.initialPitch = r.pitch, this._currentObject.viewshedObjOptions.initialRoll = r.roll, this._currentObject.viewshedObjOptions.altitudeMethod = Cesium.defaultValue(this._currentObject.viewshedObjOptions.altitudeMethod, 2);
                var i = {
                        displayName: this._currentObject.viewshedObjOptions._displayName,
                        hFOV: r.frustum.fov,
                        vFOV: r.frustum.fovy,
                        aspectRatio: r.frustum.aspectRatio,
                        height: this._currentObject.viewshedObjOptions.height,
                        distance: this._currentObject.viewshedObjOptions.distance,
                        xPos: this._currentObject.viewshedObjOptions.xPos,
                        yPos: this._currentObject.viewshedObjOptions.yPos,
                        altitudeMethod: this._currentObject.viewshedObjOptions.altitudeMethod,
                        pickHeight: this._currentObject.viewshedObjOptions.pickHeight,
                        horizonCullingDistanceFromViewshed: this._horizonCullingDistanceFromPoint,
                        initialHeading: this._currentObject.viewshedObjOptions.initialHeading,
                        initialPitch: this._currentObject.viewshedObjOptions.initialPitch,
                        initialRoll: this._currentObject.viewshedObjOptions.initialRoll
                    },
                    s = this.CreateViewshed(r.position, Cesium.defaultValue(this._currentObject.viewshedObjOptions.distance, this._currentRadius), r.direction, i);
                this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);
                if (s == -1) {
                    e("#headerDivContainer #CloseImg").length > 0 && e("#headerDivContainer #CloseImg")[0].click(), this.resetAllVariables(), TerraExplorer.tools.ToolDialog.showAlertDialog(a.i18n("MAX_NUM_VIEWSHEDS_EXCEEDED", {maxNumViewsheds: TerraExplorer.maxNumViewshed}));
                    return
                }
                s.viewshedPrimitive.update = this.updateViewshedPrimitive, this.resetAllVariables(), this._currentObject = s, this._toolContainer !== null && (this._toolContainer.enableButton("deleteViewshed", !0), this._toolContainer.enableButton("setRelativeToTerrainHeight", !0)), e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click(), e("#ContainerRootDiv #CloseImg").length > 0 && e("#ContainerRootDiv #CloseImg").click();
                var o = e(".listControlLineTextNormalSidebar").length - 5;
                e(e(".listControlLineTextNormalSidebar")[o]).click(), s._displayName = s.displayName = this._currentObject.viewshedObjOptions._displayName, setTimeout(function () {
                    TerraExplorer.tools.ToolManager.openTool("Viewshed", s)
                }, 500), TerraExplorer.tools.ToolManager.openTool("Viewshed", this._currentObject);
                var u = viewer.scene.primitives._primitives, f = e.grep(u, function (e) {
                    return e.isViewshed === !0
                });
                e(".viewshedButton").length > 0 && (e(".viewshedButton").css("opacity", "1"), e(".viewshedButton").attr("disabled", !1));
                var l = TerraExplorer.internal.Project;
                if (!(f.length > l._allAnalysisObjects[l._objectTypes.VIEWSHED].length)) {
                    this._canEnlarge = !1, this.removeMobileIndication();
                    return
                }
                var c = [];
                u.forEach(function (e, t) {
                    e.isViewshed && c.push(t)
                });
                if (c.length > 1) {
                    var h = c[c.length - 2], p = viewer.scene.primitives._primitives[h];
                    viewer.scene.primitives.remove(p)
                }
            }
        } else if (Cesium.defined(t) && this._currentObject !== undefined && this._secondTouchPoint === undefined) {
            var d = viewer.scene.screenToWorld(t.position);
            if (d != undefined) {
                var v = 1.5, m = 0;
                this._startPositionCartographic = viewer.scene.globe.ellipsoid.cartesianToCartographic(d), this._currentObject.viewshedObjOptions.pickHeight = this._startPositionCartographic.height, this._currentObject.viewshedObjOptions.height != undefined && (m = this._currentObject.viewshedObjOptions.height);
                var y = new Cesium.Cartesian3.fromRadians(this._startPositionCartographic.longitude, this._startPositionCartographic.latitude, this._startPositionCartographic.height + v + m);
                this._startPositionCartesian = y;
                var b = this._startPositionCartesian, w = new Cesium.BoundingSphere(new Cesium.Cartesian3(0, 0, 0), g);
                this._occluder = new Cesium.Occluder(w, b), this._canEnlarge = !0;
                if (TerraExplorer.isMobile() || TerraExplorer.isTouch()) this._positionIndicationForMobile = viewer.entities.add(new Cesium.Entity({
                    position: d,
                    point: {
                        color: Cesium.Color.RED,
                        pixelSize: 3,
                        outlineColor: Cesium.Color.BLUE,
                        outlineWidth: 2,
                        show: !0,
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
                    }
                })), this._secondTouchPoint = !0;
                !TerraExplorer.isMobile() && !TerraExplorer.isTouch() && this._eventListener.setInputAction(e.proxy(this.onMouseMove, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE)
            }
        } else if ((TerraExplorer.isMobile() || TerraExplorer.isTouch()) && this._canEnlarge && this._secondTouchPoint) if (Cesium.defined(t)) {
            var i = {}, d = viewer.scene.screenToWorld(t.position, i);
            if (d != undefined) {
                if (i.pickPrimitive != undefined && i.pickPrimitive._camera != undefined) return;
                var E = {};
                if (!this._setNewPosition) {
                    if (this._startPositionCartesian == null) return;
                    Cesium.Cartesian3.subtract(d, this._startPositionCartesian, E);
                    if (!(!isNaN(E.x) && !isNaN(E.y) && !isNaN(E.z))) return;
                    this._viewshedDirection = Cesium.Cartesian3.normalize(E, this._scratchCartesian3), this._currentRadius = Cesium.Cartesian3.magnitude(E);
                    var S = new Promise(function (e, t) {
                        function r() {
                            n === 0 ? (viewer.scene.preRender.removeEventListener(r), e()) : n--
                        }

                        var n = 3;
                        viewer.scene.preRender.addEventListener(r)
                    });
                    Cesium.when(S, function () {
                        n._secondTouchPoint = undefined, n.setViewshedPosition(t)
                    })
                }
            }
        } else this._secondTouchPoint = undefined, this.removeMobileIndication()
    };
    var A = !1, O = undefined;
    E.prototype.displayLoadingScreen = function (t) {
        TerraExplorer.__showViewshedDebugMessages && console.log("DisplayLoadingScreen..shot is taken is" + A);
        if (A) t !== undefined && this.getBestFB(t); else {
            this.isLoadingScreenOn = !0;
            var n = 1, r = this;
            viewer.camera.cancelFlight(), e("#sideBar").css("pointer-events", "none"), e("canvas").css({
                "pointer-events": "none",
                filter: "brightness(50%)"
            });
            var i = function () {
                var e = viewer.scene.canvas;
                viewer.resolutionScale = n, viewer.scene.preRender.removeEventListener(i), setTimeout(function () {
                    viewer.scene.postRender.addEventListener(s)
                }, 100)
            }, s = function () {
                viewer.scene.postRender.removeEventListener(s);
                var n = viewer.scene.canvas;
                HTMLCanvasElement.prototype.toBlob || Object.defineProperty(HTMLCanvasElement.prototype, "toBlob", {
                    value: function (e, t, n) {
                        var r = this;
                        setTimeout(function () {
                            var i = atob(r.toDataURL(t, n).split(",")[1]), s = i.length, o = new Uint8Array(s);
                            for (var u = 0; u < s; u++) o[u] = i.charCodeAt(u);
                            e(new Blob([o], {type: t || "image/png"}))
                        })
                    }
                }), n.toBlob(function (n) {
                    if (!r.isLoadingScreenOn) return;
                    if (!A) {
                        O = URL.createObjectURL(n), A = !0;
                        var i = e('<div id="screenShotDiv" style="pointer-events: none;position:absolute; top: 0%; left: 0%; width: ' + viewer.canvas.width + "px; height: " + viewer.canvas.height + 'px;"><img id="screenShotImage"  style="filter: brightness(50%);width:100%;height:100%;" src="' + O + '"></img></div>');
                        e(".cesium-viewer").append(i), e("#sideBar").css("pointer-events", "none"), e("canvas").css({
                            "pointer-events": "none",
                            filter: "brightness(50%)"
                        }), e("canvas").on("resize", function () {
                            var t = e("#screenShotDiv");
                            t.length > 0 && (t.width(viewer.canvas.width), t.height(viewer.canvas.height))
                        }), viewer.resolutionScale = 1, t !== undefined && setTimeout(function () {
                            r.getBestFB(t)
                        }, 1e3)
                    }
                })
            };
            viewer.scene.preRender.addEventListener(i)
        }
    }, E.prototype.cancelViewshed = function () {
        this._isCancelledTerrain = !0, this._isCancelledPrimitives = !0
    };
    var M = !1;
    E.prototype.getBestFB = function (t) {
        var n = this, r = viewer.camera.position.clone(), i = viewer.camera.direction.clone(),
            s = viewer.camera.up.clone();
        this._initialCameraParams.pos = r, this._initialCameraParams.dir = i, this._initialCameraParams.up = s, TerraExplorer.doNotRequestImagery = !0;
        var o = t.viewshedMap._lightCamera.heading, u = t.viewshedMap._lightCamera.pitch, f = .1,
            l = t.viewshedMap._lightCamera;
        TerraExplorer.__showViewshedDebugMessages && console.log("jump to location.. "), TerraExplorer.disable_enforceZeroRoll = !0, viewer.camera.setView({
            destination: l.position,
            orientation: {direction: l.direction, up: l.up}
        });
        var c = new Promise(function (e, n) {
            var r = setInterval(function () {
                var n = viewer.camera.position.clone();
                t.viewshedPrimitive._camera.position.equals(n) ? (clearInterval(r), e(1)) : viewer.camera.setView({
                    destination: l.position,
                    orientation: {direction: l.direction, up: l.up}
                })
            }, 1e3)
        });
        c.then(function () {
            return (new Promise(function (e, n) {
                function i() {
                    window.frameNumber--;
                    if (window.frameNumber > 0) return;
                    viewer.scene.postRender.removeEventListener(i), e(1)
                }

                var r = Cesium.defaultValue(t.viewshedObjOptions.resolution, 2048);
                t.originalCanvasWidth = viewer.canvas.width, t.originalCanvasHeight = viewer.canvas.height, viewer.canvas.width = r, viewer.canvas.height = r, viewer.forceResize(), t.originalNear = t.viewshedMap._lightCamera.frustum.near, t.viewshedMap._lightCamera.frustum.near = Math.max(.2, t.viewshedMap._lightCamera.frustum.far / 1e4), t.theCameraFrustum = viewer.camera.frustum, viewer.camera.frustum = t.viewshedMap._lightCamera.frustum, window.frameNumber = 10, viewer.scene.postRender.addEventListener(i)
            })).then(function (r) {
                var i = a.i18n("viewshed_retrieving_data"),
                    s = e('<div style="position:absolute;z-index:10005;top:1%;left:2%;"><table style="border-collapse: collapse!important;"><tr style="padding:0;"><td></td><td style="padding:0; width:300px" ><img id="cancellationButton" style="cursor:pointer;margin-top:0px; vertical-align:middle" width=32 height=32 src="./img/stop_calc.png"></img><span id="cancellationSpan" style="font-family:helvetica;pointer-events:auto;cursor:pointer;color:white;margin-left:15px;">' + a.i18n("viewshed_process_cancel") + '</span><img id="progressAnim" src="./img/progress.gif" style="margin-top:0px; vertical-align:middle"></img><span id="progressTxt" style="color:white; font-family: helvetica;">0%</span></td><td></td></tr></table></div>'),
                    o = e('<div style="position:absolute;z-index:10005;top:1%;left:2%;"><span id="progressText" style="color:white; font-family: helvetica;">' + i + "</span></div>");
                e("#UpperView").empty(), e("#LowerView").empty(), e("#UpperView").append(s), e("#LowerView").append(o);
                var u = 0, f = 0, l = 0, c = Cesium.defaultValue(t.viewshedObjOptions.resolution, 2048);
                n._isCancelledPrimitives = !1, n._isCancelledTerrain = !1, e("#cancellationSpan").click(function () {
                    n.cancelViewshed()
                }), e("#cancellationButton").click(function () {
                    n.cancelViewshed()
                }), e("#headerDivContainer #CloseImg").click(function () {
                    n.cancelViewshed()
                }), TerraExplorer.__showViewshedDebugMessages && console.log("waiting for terrain and/or 3d meshes.. "), n._promiseTerrain = new Promise(function (e, t) {
                    var r = new Cesium.EventHelper;
                    r.add(viewer.scene.globe.tileLoadProgressEvent, function (t) {
                        if (!t) {
                            r.removeAll(), TerraExplorer.__showViewshedDebugMessages && console.log("finished loading terrain.. ");

                            function i() {
                                window.frameNumberTerrain2 + 2 < viewer.scene.frameState.frameNumber && viewer.scene.postRender.removeEventListener(i)
                            }

                            window.frameNumberTerrain2 = viewer.scene.frameState.frameNumber, viewer.scene.postRender.addEventListener(i)
                        } else {
                            n._isCancelledTerrain && (n._isCancelledTerrain = !1, e(0));
                            var s = viewer.scene.globe._surface._lastTileLoadQueueLength;
                            w != undefined && s < w && (!M && s >= 90 && (M = !0), M && s < 100 && (f = Math.max(100 - s, 100 - w))), w = s
                        }
                    });
                    var i = 10, s = function () {
                        var t = viewer.scene.globe._surface._lastTileLoadQueueLength;
                        t === 0 ? i-- : i = 10, i === 0 && viewer.scene.postRender.removeEventListener(s), e(1)
                    };
                    viewer.scene.postRender.addEventListener(s)
                });
                var h, p, d = [],
                    v = viewer.camera.frustum.computeCullingVolume(viewer.camera.position, viewer.camera.direction, viewer.camera.up);
                e(TerraExplorer.internal.Project.MeshLayers).each(function (e, t) {
                    t.ready && v.computeVisibility(t.boundingSphere) != Cesium.Intersect.OUTSIDE && d.push(t)
                });
                var m = d.length;
                n._promiseTileset = new Promise(function (t, r) {
                    var i = 1e3;
                    e(d).each(function (e, t) {
                        t.prevSkipLODValue = t.skipLevelOfDetail, t.skipLevelOfDetail = !0, t.loadProgress.addEventListener(function (e, t) {
                            if (e === 0 && t === 0) {
                                m--;
                                return
                            }
                            var n = Math.max(Math.min(10, Math.min(i, e)), 0);
                            u = 100 - n * 10, i = e
                        })
                    }), h = setInterval(function () {
                        n._isCancelledPrimitives && (n._isCancelledPrimitives = !1, t(0));
                        if (m == 0 || d[0].tilesLoaded) TerraExplorer.__showViewshedDebugMessages && console.log("finished loading 3d Tiles.. "), t(1)
                    }, 500)
                });
                var g = e("#progressTxt").css("display");
                e("#progressTxt").css("display", "none"), p = setInterval(function () {
                    l = Math.max(Math.max(f, u), l), l > 0 && (e("#progressText").text(a.i18n("viewshed_process_loading")), e("#progressTxt").css("display", g)), TerraExplorer.tools.ToolManager._tools.Viewshed.setProgress(l, 100)
                }, 100), Cesium.when.all([n._promiseTerrain, n._promiseTileset], function (r) {
                    if (r[0] && r[1]) {
                        TerraExplorer.__showViewshedDebugMessages && console.log("get best data.. "), t.viewshedMap.freezeFBO = !0, w = undefined;
                        if (t.viewshedMap._isSpotLight) {
                            t.bestTexture = t.viewshedMap._shadowMapTexture, t.bestPackedDepth = [];
                            var i = viewer.scene._view.pickDepths[0]._framebuffer,
                                s = viewer.scene.context.readPixels({x: 0, y: 0, width: c, height: c, framebuffer: i});
                            t.bestPackedDepth.push(s), viewer.scene._view.pickDepths[1] !== undefined && (i = viewer.scene._view.pickDepths[1]._framebuffer, s = viewer.scene.context.readPixels({
                                x: 0,
                                y: 0,
                                width: c,
                                height: c,
                                framebuffer: i
                            }), t.bestPackedDepth.push(s)), viewer.scene._view.pickDepths[2] !== undefined && (i = viewer.scene._view.pickDepths[2]._framebuffer, s = viewer.scene.context.readPixels({
                                x: 0,
                                y: 0,
                                width: c,
                                height: c,
                                framebuffer: i
                            }), t.bestPackedDepth.push(s)), t.bestPackedTexWidth = c, t.bestPackedTexHeight = c, t.inverseViewProjMatrix = Cesium.Matrix4.clone(viewer.scene.context.uniformState.inverseViewProjection), t.viewshedMap.isPreviewMode = !1, t.viewshedPrimitive.isViewshed = !0
                        }
                        t.viewshedObjOptions.freezeFBO = !0, TerraExplorer.internal.Settings.saveObjects == 0 && n._layersStorage.saveItem(t)
                    } else if (!r[0] || !r[1]) TerraExplorer.__showViewshedDebugMessages && console.log("cancelled.. "), n._calculations = [], n._exposures = [], TerraExplorer.doNotRequestImagery = undefined;
                    M = !1, clearInterval(h), clearInterval(p), viewer.canvas.width = t.originalCanvasWidth, viewer.canvas.height = t.originalCanvasHeight, viewer.forceResize(), t.viewshedMap._lightCamera.frustum.near = t.originalNear, viewer.camera.frustum = t.theCameraFrustum, TerraExplorer.doNotRequestImagery = undefined, setTimeout(function () {
                        d.forEach(function (e) {
                            e.skipLevelOfDetail = e.prevSkipLODValue
                        }), TerraExplorer.disable_enforceZeroRoll = undefined, viewer.camera.setView({
                            destination: n._initialCameraParams.pos,
                            orientation: {direction: n._initialCameraParams.dir, up: n._initialCameraParams.up}
                        }), e("#UpperView").empty(), e("#LowerView").empty(), n.onClosedToolContainer(), TerraExplorer.tools.ToolManager.openTool("Viewshed", n._currentObject), t.viewshedMap.show = !1, t.fromAPI === undefined || t.fromAPI && t.promise === undefined ? (TerraExplorer.__showViewshedDebugMessages && console.log("return to original location.. "), viewer.camera.setView({
                            destination: n._initialCameraParams.pos,
                            orientation: {direction: n._initialCameraParams.dir, up: n._initialCameraParams.up}
                        }), n.removeLoadingScreen()) : e("#headerDivContainer #CloseImg").length > 0 && e("#headerDivContainer #CloseImg")[0].click(), setTimeout(function () {
                            t.viewshedMap.show = !0, n.unlockFBO()
                        }, 200), r[0] && r[1] && n._calculating && (TerraExplorer.__showViewshedDebugMessages && console.log("resolve and try calculating.. - for chain viewshed calculations only"), n._calculating = !1, t.promise !== undefined && t.promise.resolve(n._currentVSCalculated), n.tryCalculating())
                    }, 1200)
                })
            })
        })
    }, E.prototype.removeLoadingScreen = function () {
        e("#screenShotDiv").remove(), e("#sideBar").css("pointer-events", "auto"), e("canvas").css({
            "pointer-events": "auto",
            filter: "brightness(100%)"
        }), A = !1, this.isLoadingScreenOn = !1
    }, E.prototype.takeBestViewshedFB = function (e) {
        this.displayLoadingScreen(e)
    }, E.prototype.getHorizonDistance = function (e) {
        return Math.sqrt(Math.pow(g + e, 2) - Math.pow(g, 2))
    }, E.prototype.onMouseMove = function (t) {
        if (Cesium.defined(t)) {
            var n = {}, r = viewer.scene.screenToWorld(t.endPosition, n);
            if (r != undefined) {
                if (n.pickPrimitive != undefined && n.pickPrimitive._camera != undefined) return;
                var i = {};
                if (!this._setNewPosition) {
                    if (this._startPositionCartesian == null) return;
                    Cesium.Cartesian3.subtract(r, this._startPositionCartesian, i);
                    if (!(!isNaN(i.x) && !isNaN(i.y) && !isNaN(i.z))) return;
                    this._viewshedDirection = Cesium.Cartesian3.normalize(i, this._scratchCartesian3), this._currentRadius = Cesium.Cartesian3.magnitude(i)
                } else if (!this._setNewPositionCanDrag) {
                    var s = r,
                        o = Cesium.Matrix4.multiplyByVector(viewer.camera._viewMatrix, Cesium.Cartesian4.fromElements(s.x, s.y, s.z, 1, T), T),
                        u = Cesium.Matrix4.multiplyByVector(viewer.camera.frustum.projectionMatrix, o, T),
                        a = Cesium.Cartesian3.divideByScalar(u, u.w, N),
                        f = Math.floor((a.x * .5 + .5) * viewer.canvas.width),
                        l = Math.floor((a.y * .5 + .5) * viewer.canvas.height);
                    this._mousePositionX = f, this._mousePositionY = l
                } else {
                    var c = undefined, h = viewer.scene.globe.ellipsoid.cartesianToCartographic(r);
                    this._currentObject.viewshedObjOptions.pickHeight = h.height, this._currentObject.viewshedObjOptions.terrainHeight = viewer.scene.globe.getHeight(h);
                    if (this._zAxisNewPosition) {
                        var p = t.endPosition.y - this._startingRepoZ.y,
                            d = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(this._currentObject.position, viewer.camera.position, this._scratchCartesian3), this._scratchCartesian3),
                            v = p / viewer.canvas.height, m = -1 * d * v;
                        this._viewshedCartoPos == undefined && (this._viewshedCartoPos = new Cesium.Cartographic.fromCartesian(this._currentObject.position)), c = new Cesium.Cartesian3.fromRadians(this._viewshedCartoPos.longitude, this._viewshedCartoPos.latitude, this._viewshedCartoPos.height + m)
                    } else this._currentObject.viewshedObjOptions.altitudeMethod == y.ABOVE_SEA_LEVEL ? c = new Cesium.Cartesian3.fromRadians(h.longitude, h.latitude, this._startingRepoZHeight) : c = r;
                    this._newPosition = c
                }
            } else this._mousePositionX = undefined, this._mousePositionY = undefined, e("canvas").css("cursor", "default")
        }
    }, E.prototype.createViewshedMap = function () {
        viewer.scene.viewsheds == undefined && viewer.scene.viewsheds;
        if (this._viewshedPrimitive._camera == undefined) return;
        this._canEnlarge && (this._viewshedMap == undefined ? (this._viewshedMap = new Cesium.ShadowMap({
            context: viewer.scene.context,
            lightCamera: this._viewshedPrimitive._camera,
            enabled: 1,
            isSpotLight: !0,
            fromLightSource: !0,
            isPointLight: !1,
            softShadows: !0
        }), this._viewshedMap.show = !0, this._viewshedMap.isPreviewMode = !0, this._viewshedMap.guid = "SamplerViewshed", this._viewshedMap != undefined && viewer.scene.viewsheds.push(this._viewshedMap)) : (this._viewshedMap._lightCamera.direction = this._viewshedPrimitive._camera.direction, this._viewshedMap._lightCamera.frustum.far = Cesium.defaultValue(this._currentObject.viewshedObjOptions.distance, this._currentRadius)))
    }, E.prototype.createViewshedCameraPrimitive = function (e) {
        this._viewshedPrimitive != null && viewer.scene.primitives.remove(this._viewshedPrimitive);
        var t = new Cesium.Camera(viewer.scene);
        return e != undefined ? t.position = e : t.position = this._startPositionCartesian, this._viewshedDirection != undefined && !isNaN(this._viewshedDirection.x) && !isNaN(this._viewshedDirection.y) && (t.direction = this._viewshedDirection.clone(), t.up = viewer.scene.globe.ellipsoid.geodeticSurfaceNormal(t.position, S)), t.frustum.isViewshed = !0, t.frustum.fov = Cesium.defaultValue(this._currentFovHorizontal, v), t.frustum._fovy = Cesium.defaultValue(this._currentFovVertical, m), t.frustum.aspectRatio = Math.tan(t.frustum.fov / 2) / Math.tan(t.frustum._fovy / 2), t.frustum.near = 1, this._currentRadius <= 1 ? !1 : (t.frustum.far = Cesium.defaultValue(this._currentObject.viewshedObjOptions.distance, this._currentRadius), this._viewshedPrimitive = viewer.scene.primitives.add(new Cesium.DebugCameraPrimitive({
            camera: t,
            color: this._primitiveColor
        })), this._viewshedPrimitive._numFrustrums = 0, this._viewshedPrimitive._outlineOnlyFrustum = !0, this._viewshedPrimitive.update = this.updateViewshedPrimitive, this._viewshedPrimitive)
    };
    var _ = new Array(4);
    _[0] = new Cesium.Cartesian4(-1, -1, 1, 1), _[1] = new Cesium.Cartesian4(1, -1, 1, 1), _[2] = new Cesium.Cartesian4(1, 1, 1, 1), _[3] = new Cesium.Cartesian4(-1, 1, 1, 1);
    var D = new Array(4);
    for (var P = 0; P < 4; ++P) D[P] = new Cesium.Cartesian4;
    var H = new Cesium.Color, B = [1, 1e5];
    E.prototype.updateViewshedPrimitive = function (e) {
        if (!this.show) return;
        this._updateOnChange && (this._outlinePrimitive = this._outlinePrimitive && this._outlinePrimitive.destroy());
        if (!Cesium.defined(this._outlinePrimitive)) {
            var t = this._camera, n = t.frustum, r = [], i = e.frustumSplits, s = i.length - 1;
            s = this._numFrustrums, s <= 0 && (i = B, i[0] = this._camera.frustum.near, i[1] = this._camera.frustum.far, s = 1);
            var o = this._camera.viewMatrix, u, a;
            if (Cesium.defined(t.frustum.fovy)) {
                var f = this._camera.frustum.projectionMatrix, l = Cesium.Matrix4.multiply(f, o, x);
                a = Cesium.Matrix4.inverse(l, x)
            } else u = Cesium.Matrix4.inverseTransformation(o, x);
            var c = new Float64Array(12 * (s + 1) + 3), h;
            for (h = 0; h < s + 1; ++h) for (var p = 0; p < 4; ++p) {
                var d = Cesium.Cartesian4.clone(_[p], D[p]);
                if (!Cesium.defined(a)) {
                    Cesium.defined(n._offCenterFrustum) && (n = n._offCenterFrustum);
                    var v, m;
                    h === s ? (v = i[h - 1], m = i[h]) : (v = i[h], m = i[h + 1]), d.x = (d.x * (n.right - n.left) + n.left + n.right) * .5, d.y = (d.y * (n.top - n.bottom) + n.bottom + n.top) * .5, d.z = (d.z * (v - m) - v - m) * .5, d.w = 1, Cesium.Matrix4.multiplyByVector(u, d, d)
                } else {
                    d = Cesium.Matrix4.multiplyByVector(a, d, d);
                    var g = 1 / d.w;
                    Cesium.Cartesian3.multiplyByScalar(d, g, d), Cesium.Cartesian3.subtract(d, this._camera.positionWC, d), Cesium.Cartesian3.normalize(d, d);
                    var y = Cesium.Cartesian3.dot(this._camera.directionWC, d);
                    Cesium.Cartesian3.multiplyByScalar(d, i[h] / y, d), Cesium.Cartesian3.add(d, this._camera.positionWC, d)
                }
                h > 0 && r.push(d), c[12 * h + p * 3] = d.x, c[12 * h + p * 3 + 1] = d.y, c[12 * h + p * 3 + 2] = d.z
            }
            c[12 * s + 12] = this._camera.positionWC.x, c[12 * s + 12 + 1] = this._camera.positionWC.y, c[12 * s + 12 + 2] = this._camera.positionWC.z;
            var b = new Cesium.BoundingSphere.fromVertices(c), w = new Cesium.GeometryAttributes;
            w.position = new Cesium.GeometryAttribute({
                componentDatatype: Cesium.ComponentDatatype.DOUBLE,
                componentsPerAttribute: 3,
                values: c
            });
            var E, S, T = new Uint16Array(8 * (2 * s + 1 + 1));
            for (h = 0; h < s + 1; ++h) E = h * 8, S = h * 4, T[E] = S, T[E + 1] = S + 1, T[E + 2] = S + 1, T[E + 3] = S + 2, T[E + 4] = S + 2, T[E + 5] = S + 3, T[E + 6] = S + 3, T[E + 7] = S;
            for (h = 0; h < s; ++h) E = (s + 1 + h) * 8, S = h * 4, T[E] = S, T[E + 1] = S + 4, T[E + 2] = S + 1, T[E + 3] = S + 5, T[E + 4] = S + 2, T[E + 5] = S + 6, T[E + 6] = S + 3, T[E + 7] = S + 7;
            E += 8, T[E] = S + 8, T[E + 1] = S + 1, T[E + 2] = S + 8, T[E + 3] = S + 2, T[E + 4] = S + 8, T[E + 5] = S + 3, T[E + 6] = S + 8, T[E + 7] = S + 4, this._outlinePrimitive = new Cesium.Primitive({
                geometryInstances: new Cesium.GeometryInstance({
                    geometry: {
                        attributes: w,
                        indices: T,
                        primitiveType: Cesium.PrimitiveType.LINES,
                        boundingSphere: b
                    },
                    attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(this._color)},
                    id: this.id,
                    pickPrimitive: this
                }), appearance: new Cesium.PerInstanceColorAppearance({translucent: !1, flat: !0}), asynchronous: !1
            });
            if (this.isVOT) {
                var N = TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool;
                N._primsVid[this.videoID] === undefined && this.videoID !== undefined && (N._primsVid[this.videoID] = viewer.entities.add(new Cesium.Entity({
                    polygon: {
                        hierarchy: r,
                        material: Cesium.Color.WHITE,
                        perPositionHeight: !0,
                        shadows: Cesium.ShadowMode.RECEIVE_ONLY
                    }
                })))
            }
        }
        this.doNotShow !== undefined && (this.show = !1, this.doNotShow = undefined), this._outlinePrimitive.isViewshedPart = !0, this._outlinePrimitive.update(e)
    }, E.prototype.createViewshedSpherePrimitive = function (e, t) {
        try {
            var n = e != undefined ? e : this._startPositionCartesian, r = t != undefined ? t : this._currentRadius;
            if (r <= 1) return !1;
            this._viewshedPrimitive != null && viewer.scene.primitives.remove(this._viewshedPrimitive);
            var i = Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(n), new Cesium.Cartesian3(0, 0, 0), x),
                s = new Cesium.GeometryInstance({
                    geometry: new Cesium.SphereOutlineGeometry({
                        radius: r,
                        stackPartitions: 8,
                        slicePartitions: 12
                    }),
                    modelMatrix: i,
                    attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(1, 1, 1, .5))}
                });
            this._viewshedPrimitive = viewer.scene.primitives.add(new Cesium.Primitive({
                geometryInstances: s,
                appearance: new Cesium.PerInstanceColorAppearance({flat: !0, renderState: {lineWidth: 1}}),
                asynchronous: !1
            }));
            var o = new Cesium.Camera(viewer.scene);
            o.position = n, o.direction = Cesium.Cartesian3.negate(Cesium.Cartesian3.UNIT_Z, this._scratchCartesian3), this._viewshedPrimitive._camera = o
        } catch (u) {
            return !1
        }
        return this._viewshedPrimitive
    }, E.prototype.showDebugViewshed = function () {
        var e = TerraExplorer.internal.Project;
        if (viewer.scene.viewsheds[0] != undefined && e._allAnalysisObjects[e._objectTypes.VIEWSHED][0] != undefined && e._allAnalysisObjects[e._objectTypes.VIEWSHED][0].bestTexture != undefined) {
            var t = "uniform sampler2D shadowMap_texture; \nuniform float viewshedQueryResultsXStart; \nuniform float viewshedQueryResultsXEnd; \nuniform float viewshedQueryResultsYStart; \nuniform float viewshedQueryResultsYEnd; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n    if (v_textureCoordinates.x < viewshedQueryResultsXEnd && v_textureCoordinates.x >= viewshedQueryResultsXStart && v_textureCoordinates.y < viewshedQueryResultsYEnd && v_textureCoordinates.y >= viewshedQueryResultsYStart){gl_FragColor = vec4(1.0,0.0,0.0,1.0);} else{ \n     gl_FragColor = vec4(vec3(fract(shadow*32.)), 1.0); }\n}\n";
            viewer.scene.debugViewshedCommand = viewer.scene.context.createViewportQuadCommand(t, {
                uniformMap: {
                    shadowMap_texture: function () {
                        return viewer.scene.viewsheds[0] != undefined ? viewer.scene.viewsheds[0]._shadowMapTexture : viewer.scene.slopeColorsTexture
                    }, viewshedQueryResultsXStart: function () {
                        return viewer.scene.viewshedQueryResultsXStart != undefined ? viewer.scene.viewshedQueryResultsXStart : 2
                    }, viewshedQueryResultsXEnd: function () {
                        return viewer.scene.viewshedQueryResultsXEnd != undefined ? viewer.scene.viewshedQueryResultsXEnd : 2
                    }, viewshedQueryResultsYStart: function () {
                        return viewer.scene.viewshedQueryResultsYStart != undefined ? viewer.scene.viewshedQueryResultsYStart : 2
                    }, viewshedQueryResultsYEnd: function () {
                        return viewer.scene.viewshedQueryResultsYEnd != undefined ? viewer.scene.viewshedQueryResultsYEnd : 2
                    }
                }, owner: viewer.scene.viewsheds[0]
            }), viewer.scene.debugViewshedCommand.pass = Cesium.Pass.OVERLAY;
            var n = viewer.canvas.width, r = viewer.canvas.height, i = new Cesium.BoundingRectangle;
            i.x = Math.floor(n * .7), i.y = Math.floor(r * .1);
            var s = Math.max(n, r);
            i.width = Math.floor(s * .2), i.height = Math.floor(s * .2), viewer.scene.debugViewshedCommand.renderState = Cesium.RenderState.fromCache({viewport: Cesium.BoundingRectangle.clone(i)})
        }
    }, E.prototype.checkIfMouseOnPosition = function () {
        var t = TerraExplorer.isMobile() ? 120 : 40,
            n = Math.sqrt(Math.pow(this._mousePositionX - this._currentObject.posX, 2) + Math.pow(this._mousePositionY - this._currentObject.posY, 2));
        n <= t ? (this._zAxisNewPosition != undefined ? e("canvas").css("cursor", "n-resize") : e("canvas").css("cursor", "all-scroll"), this._eventListener.setInputAction(e.proxy(this.startDrag, this), Cesium.ScreenSpaceEventType.LEFT_DOWN), this._eventListener.setInputAction(e.proxy(this.stopDrag, this), Cesium.ScreenSpaceEventType.LEFT_UP)) : (e("canvas").css("cursor", "default"), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP))
    }, E.prototype.startDrag = function (e) {
        this._startingRepoZ = new Cesium.Cartesian2(e.position.x, e.position.y), this._startingRepoZHeight = (new Cesium.Cartographic.fromCartesian(this._currentObject.position)).height, this._setNewPositionCanDrag = !0, f.Mode = f.CLIENT
    }, E.prototype.stopDrag = function (t) {
        this._setNewPositionCanDrag = !1, this._setNewPosition = !1, f.Mode = f.FREE_FLIGHT, this._newPosition = undefined, this._startingRepoZ = undefined, this._viewshedCartoPos = undefined, this._startingRepoZHeight = undefined, this._currentObject.startingAltitudeAboveGround = undefined, this._currentObject.startingAltitudeAboveModel = undefined, this._currentObject.position = this._currentObject.viewshedMap._lightCamera.position, this.toPreviewMode(this._currentObject), this._layersStorage.saveItem(this._currentObject), this._zAxisNewPosition != undefined ? e("#setRelativeToTerrainHeight").length > 0 && e("#setRelativeToTerrainHeight").click() : e("#setNewPosition").length > 0 && e("#setNewPosition").click(), e("#headerDivContainer #CloseImg")[0].click(), TerraExplorer.tools.ToolManager.openTool("Viewshed", this._currentObject), this._zAxisNewPosition != undefined ? e("#setRelativeToTerrainHeight").length > 0 && e("#setRelativeToTerrainHeight").click() : e("#setNewPosition").length > 0 && e("#setNewPosition").click()
    }, E.prototype.adjustDirections = function () {
        var e = this._currentObject.position, t = this._currentObject.viewshedPrimitive._camera.heading,
            n = this._currentObject.viewshedPrimitive._camera.pitch,
            r = this._currentObject.viewshedPrimitive._camera.roll, i = new Cesium.HeadingPitchRoll(t, n, r);
        this._currentObject.viewshedPrimitive.modelMatrix = Cesium.Transforms.headingPitchRollToFixedFrame(e, i)
    }, E.prototype.getPosXAndY = function () {
        var e = this._currentObject.position,
            t = Cesium.Matrix4.multiplyByVector(viewer.camera._viewMatrix, Cesium.Cartesian4.fromElements(e.x, e.y, e.z, 1, T), T),
            n = Cesium.Matrix4.multiplyByVector(viewer.camera.frustum.projectionMatrix, t, T),
            r = Cesium.Cartesian3.divideByScalar(n, n.w, N), i = Math.floor((r.x * .5 + .5) * viewer.canvas.width),
            s = Math.floor((r.y * .5 + .5) * viewer.canvas.height);
        this._currentObject.posX = i, this._currentObject.posY = s
    }, E.prototype.onPreFrame = function (t) {
        this._currentObject !== undefined && this._currentObject.isDeleted && (viewer.scene.preRender.removeEventListener(this.onPreFrame, this), this._currentObject = undefined);
        var n, r;
        if (this._currentObject != undefined && this._currentObject.viewshedPrimitive != undefined && this._currentObject.viewshedMap != undefined) {
            n = Cesium.Cartographic.fromCartesian(this._currentObject.viewshedPrimitive._camera.position);
            var i = this.getHorizonDistance(n.height);
            this._currentObject.viewshedMap.horizonCullingDistanceFromViewshed = i, r = viewer.scene.globe.getHeight(n);
            var s = undefined;
            if (!TerraExplorer.isMobile()) {
                var o = e.grep(TerraExplorer.internal.Project.MeshLayers, function (e) {
                    return e.ready && e.show && e.rootFloorAdded
                });
                o.length > 0 && o.forEach(function (e) {
                    var t = e.rootFloorRectangle;
                    Cesium.Rectangle.contains(t, n) && (s = e)
                })
            }
            if (s !== undefined) {
                var u = s.getHRMTFP(s, n, !0);
                if (u !== undefined) {
                    var a = u.content._model.floor.getHeight(n.longitude, n.latitude);
                    this._currentObject.viewshedMap.isBelowGround = n.height < a + .5
                } else this._currentObject.viewshedMap.isBelowGround = n.height < r + .5
            } else this._currentObject.viewshedMap.isBelowGround = n.height < r + .5
        }
        this._currentObject != undefined && this._currentObject.viewshedMap != undefined, this._newPosition != undefined && this.toPreviewMode(this._currentObject);
        if (this._canEnlarge && this._currentRadius != null && this._prevRadius != this._currentRadius) {
            this._prevRadius = this._currentRadius;
            var f = this._isSpherical ? this.createViewshedSpherePrimitive() : this.createViewshedCameraPrimitive();
            f && this.createViewshedMap()
        } else if (this._currentObject != undefined && this._setNewPosition && this._mousePositionX != undefined && this._mousePositionY != undefined) {
            this.getPosXAndY();
            if (this._currentObject.viewshedObjOptions.isSpherical) this._currentObject.viewshedMap._lightCamera.position = this._newPosition, this._currentObject.viewshedPrimitive = this.createViewshedSpherePrimitive(this._newPosition, this._currentObject.distance); else {
                this.checkIfMouseOnPosition();
                if (this._newPosition != undefined) {
                    if (this._currentObject.viewshedObjOptions.altitudeMethod == y.ABOVE_GROUND_LEVEL && this._zAxisNewPosition == undefined) {
                        var l = Cesium.Cartographic.fromCartesian(this._newPosition.clone()),
                            c = Cesium.Cartesian3.fromRadians(l.longitude, l.latitude, viewer.scene.globe.getHeight(l) + this._currentObject.startingAltitudeAboveGround);
                        this._currentObject.viewshedPrimitive._camera.position = c
                    } else if (this._currentObject.viewshedObjOptions.altitudeMethod == y.ABOVE_MODEL && this._zAxisNewPosition == undefined) {
                        var l = Cesium.Cartographic.fromCartesian(this._newPosition.clone()),
                            c = Cesium.Cartesian3.fromRadians(l.longitude, l.latitude, l.height + this._currentObject.startingAltitudeAboveModel);
                        this._currentObject.viewshedPrimitive._camera.position = c
                    } else this._currentObject.viewshedPrimitive._camera.position = this._newPosition;
                    this.adjustDirections()
                }
            }
        }
    };
    var S = new Cesium.Cartesian3;
    return E.prototype.getObjectPosition = function (e, t) {
        if (e == undefined || t == undefined) throw{type: "TE_EXCEPTION", format: "Missing argument."};
        if (t.bestTexture == undefined) throw{
            type: "TE_EXCEPTION",
            format: "viewshed does not contain calculated data."
        };
        var n = R(e), r = n.center, i = q(r, t), s = n.radius,
            o = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(r, t.position, new Cesium.Cartesian3)), u = 0,
            a = new Cesium.Ray;
        a.origin = r, a.direction = t.viewshedPrimitive._camera.right;
        var f = Cesium.IntersectionTests.raySphere(a, n), l = Cesium.Ray.getPoint(a, f.stop);
        u = Math.max(Math.abs(q(l, t).x - i.x), u);
        var c = new Cesium.Ray;
        c.origin = r, c.direction = Cesium.Cartesian3.negate(a.direction, new Cesium.Cartesian3);
        var f = Cesium.IntersectionTests.raySphere(c, n), l = Cesium.Ray.getPoint(c, f.stop);
        u = Math.max(Math.abs(i.x - q(l, t).x), u);
        var h = new Cesium.Ray;
        h.origin = r, h.direction = t.viewshedPrimitive._camera.up;
        var f = Cesium.IntersectionTests.raySphere(h, n), l = Cesium.Ray.getPoint(h, f.stop);
        u = Math.max(Math.abs(q(l, t).y - i.y), u);
        var p = new Cesium.Ray;
        p.origin = r, p.direction = Cesium.Cartesian3.negate(h.direction, new Cesium.Cartesian3);
        var f = Cesium.IntersectionTests.raySphere(p, n), l = Cesium.Ray.getPoint(p, f.stop);
        return u = Math.max(Math.abs(i.y - q(l, t).y), u), new Cesium.BoundingRectangle(i.x - u, i.y - u, 2 * u, 2 * u)
    }, E.prototype.isObjectHeightRelative = function (e) {
        var t = F(e);
        if (t.model !== undefined && t.model._owner.id !== undefined && t.model._owner.id.model !== undefined && t.model._owner.id.model.heightReference !== undefined) {
            var n = t.model._owner.id.model.heightReference._value;
            return n === undefined || n !== Cesium.HeightReference.CLAMP_TO_GROUND && n !== Cesium.HeightReference.RELATIVE_TO_GROUND ? !1 : !0
        }
        return !1
    }, E.prototype.getObjectExposure = function (e, t) {
        function r(e, t) {
            TerraExplorer.__showViewshedDebugMessages && console.log("return to normal and trygetexposures... "), t.originalCanvasWidth !== undefined && (viewer.canvas.width = t.originalCanvasWidth), t.originalCanvasHeight !== undefined && (viewer.canvas.height = t.originalCanvasHeight), viewer.forceResize(), t.viewshedMap._lightCamera.frustum.near = t.originalNear, t.theCameraFrustum !== undefined && (viewer.camera.frustum = t.theCameraFrustum), viewer.scene.commandToDraw = undefined, viewer.scene.disableOtherCommands = undefined, TerraExplorer.disable_enforceZeroRoll = undefined, viewer.camera.setView({
                destination: e._initialCameraParams.pos,
                orientation: {direction: e._initialCameraParams.dir, up: e._initialCameraParams.up}
            }), t.show = !0, e._calculatingExposure = !1
        }

        var n = this;
        return this._initialCameraParams.pos = viewer.camera.position.clone(), this._initialCameraParams.dir = viewer.camera.direction.clone(), this._initialCameraParams.up = viewer.camera.up.clone(), (new Promise(function (i, s) {
            if (e == undefined || t == undefined) throw{message: "Missing argument.", code: 1};
            if (t.bestTexture == undefined) throw{message: "viewshed does not contain calculated data.", code: 2};
            var o = t.viewshedMap.shadowMapCullingVolume, u = R(e);
            if (o.computeVisibility(u) === Cesium.Intersect.OUTSIDE) throw{
                message: "Object is out of viewshed range",
                code: 3
            };
            var a = n.isObjectHeightRelative(e),
                f = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(t.position, u.center, new Cesium.Cartesian3)),
                l = 0;
            f >= 2 && f < 1e3 ? l = 0 : f >= 1e3 && f < 1e4 ? l = 1 : f >= 1e4 && (l = 2), n.displayLoadingScreen(), TerraExplorer.__showViewshedDebugMessages && console.log("jump to viewshed - getObjectExposure.. "), TerraExplorer.disable_enforceZeroRoll = !0;
            var c = t.viewshedPrimitive._camera;
            viewer.camera.setView({destination: c.position, orientation: {direction: c.direction, up: c.up}});
            var h = 0;
            viewer.scene.disableOtherCommands = !0, viewer.scene.commandToDraw = e;
            var p = Cesium.defaultValue(t.viewshedObjOptions.resolution, 2048), d = viewer.canvas.width;
            t.originalCanvasWidth = d;
            var v = viewer.canvas.height;
            t.originalCanvasHeight = v, viewer.canvas.width = p, viewer.canvas.height = p, viewer.forceResize(), t.originalNear = t.viewshedMap._lightCamera.frustum.near, t.viewshedMap._lightCamera.frustum.near = Math.max(.2, t.viewshedMap._lightCamera.frustum.far / 1e4), t.theCameraFrustum = viewer.camera.frustum.clone(), viewer.camera.frustum = t.viewshedMap._lightCamera.frustum, t.show = !1;
            var m = function () {
                window.frameNumber--;
                if (window.frameNumber > 0) return;
                viewer.scene.postRender.removeEventListener(m);
                try {
                    var i = viewer.scene._view.pickDepths[l]._framebuffer,
                        s = viewer.scene.context.readPixels({x: 0, y: 0, width: p, height: p, framebuffer: i}), o = 0,
                        u = 0, a = 0, f = 0,
                        c = TerraExplorer.tools.ToolManager._tools.Viewshed.getObjectPosition(e, t);
                    if (c == undefined) throw{message: "bbox is undefined", code: 6};
                    var d = Math.floor(c.x * t.bestPackedTexWidth),
                        v = Math.floor((c.x + c.width) * t.bestPackedTexWidth),
                        g = Math.floor(c.y * t.bestPackedTexHeight),
                        y = Math.floor((c.y + c.height) * t.bestPackedTexHeight), b = 4 * t.bestPackedTexWidth,
                        w = d * 4 + g * b, E = v * 4 + y * b;
                    for (var S = w; S < E; S += 4) {
                        a++;
                        var x = W(s, S);
                        if (x <= 0) {
                            x < 0 && f++;
                            continue
                        }
                        var T = W(t.bestPackedDepth[l], S);
                        if (T <= 0) continue;
                        var N = z(c.x, c.y, T, t), C = z(c.x, c.y, x, t);
                        o++;
                        if (l === 0 && C - N > .01 || l > 0 && x - T > 0) h = Math.max(x - T, h), u++
                    }
                    if (o <= 0) throw{message: "Object is out of viewshed range", code: 3};
                    var k = (a - f) / a * 100, L = (o - u) / o * 100;
                    r(n, t), TerraExplorer.__showDebugExposureResults ? t._exposurePromise.resolve({
                        exposure: L,
                        insideViewshedRangePercentage: k
                    }) : t._exposurePromise.resolve(L), n.tryGetExposures()
                } catch (A) {
                    r(n, t), t._exposurePromise.reject({message: A.message, code: A.code}), n.tryGetExposures()
                }
            };
            window.frameNumber = 2;
            if (a) {
                var g = Cesium.when.defer(), y = 10, b = function () {
                    var e = viewer.scene.globe._surface._lastTileLoadQueueLength;
                    e === 0 ? y-- : y = 10, y === 0 && (console.log("Terrain is fully Loaded"), viewer.scene.postRender.removeEventListener(b)), g.resolve(1)
                };
                viewer.scene.postRender.addEventListener(b), g.then(function () {
                    viewer.scene.postRender.addEventListener(m)
                }).otherwise(function (e) {
                    console.log(e), r(n, t)
                })
            } else viewer.scene.postRender.addEventListener(m)
        })).catch(function (e) {
            r(n, t), t._exposurePromise.reject({message: e.message, code: e.code}), n.tryGetExposures()
        })
    }, E.prototype.QueryPointVisibility = function (e, t) {
        return j(e, t), U(e, t, "visibility")
    }, E.prototype.QueryVisibilityDistance = function (e, t) {
        return j(e, t), U(e, t, "distance")
    }, E
}), define("tools/TETools/AboutTool", ["jquery", "TELang", "tools/ToolDialog", "internal/Globals", "../MenuEntry", "../ToolProtocol"], function (e, t, n, r, i, s) {
    "use strict";
    var o = function () {
        this.getId = function () {
            return "AboutTool"
        }, this.open = function (r) {
            var i = e("<div class='toolDialogLabel' style='position:absolute; width:435px; height:232px; padding:10px;'></div>"),
                s = e("<br><img src='./img/newDesign/logo.png' style='width:70%; display:block; margin:auto;'>"),
                o = TerraExplorer.Version.split(".");
            o = t.i18n("about_version") + " " + o[0] + "." + o[1] + "." + o[2] + " (" + o[3] + ")";
            var u = e("<div style='text-align: center;'><span style='margin:0 auto;'>" + o + "</span></div>"),
                a = e("<br><br><span class='mail'style='font-size: 12px;'>" + t.i18n("about_patents") + "<br>" + t.i18n("about_skyline_logo") + "<br>" + t.i18n("about_copyright") + "<br><br>" + t.i18n("about_general_info") + " <a href='mailto:" + t.i18n("about_general_info_email") + "'>" + t.i18n("about_general_info_email") + "</a><br><br>" + t.i18n("about_technical_support") + " <a href='mailto:" + t.i18n("about_technical_support_email") + "'>" + t.i18n("about_technical_support_email") + "</a></span>");
            i.append(s).append(u).append(a), n.PositionX = 350, n.PositionY = 100, n.open(t.i18n("title_settings_about"), "./img/MenuButton.png", i.get(0), e.proxy(this.onClose, this)), TerraExplorer.isTouch() && (e(window).off("navigate"), e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0), e(".toolDialogLabel").height("100%"), e(".toolDialogLabel").width("100%"))
        }
    };
    return o.inheritsFrom(s), Cesium.defineProperties(o.prototype, {}), o.prototype.onClose = function (e) {
    }, o
}), define("tools/TETools/RotateTool", ["jquery", "../MenuEntry", "internal/Navigate"], function (e, t, n) {
    "use strict";
    var r = function () {
        this._isOpened = !1, this._isRotating = !1, this._flyAroundParams = {
            pitch: -50,
            distance: 0
        }, this.getId = function () {
            return "Rotate"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, TELang.i18n("Menu_Navigate_Rotate"), "./img/newDesign/rotate.png", 10, t.MenuEntryNavigation(), TELang.i18n("NavigationTools_Header"), !1, !0, undefined, "none")
        }, this.open = function () {
            TerraExplorer.isTouch() && e("#sideBar #closeXID").click();
            if (!this._isOpened) {
                if (TerraExplorer.internal.Navigate.CurrentNavigationMode == 1) {
                    var t = e.grep(e(".listControlLineTextSubHeaderSidebar"), function (e) {
                        return e.textContent == "2D"
                    });
                    e(t).click()
                }
                var r = new Cesium.Cartesian2(viewer.canvas.width / 2, viewer.canvas.height / 2),
                    i = viewer.scene.screenToWorld(r);
                if (i == undefined || i == null) {
                    e("#checkImageSubHeader").length > 0 && e("#checkImageSubHeader").remove();
                    return
                }
                var s = new Cesium.Cartographic.fromCartesian(i), o = viewer.camera.position, u = {};
                Cesium.Cartesian3.subtract(o, i, u);
                var a = Cesium.Cartesian3.magnitude(u);
                viewer.camera.flyToBoundingSphere(new Cesium.BoundingSphere(i, s.height), {
                    duration: .1,
                    offset: new Cesium.HeadingPitchRange(viewer.camera.heading, Cesium.Math.toRadians(this._flyAroundParams.pitch), a),
                    complete: e.proxy(function () {
                        n.flyAround(i)
                    }, this)
                }), this._isRotating = !0, TerraExplorer.activeGlobalStates[this.getId()] = !0
            } else n.stop(), this._isRotating = !1, TerraExplorer.activeGlobalStates[this.getId()] = !1;
            this._isOpened = !this._isOpened
        }
    };
    return Cesium.defineProperties(r.prototype, {
        IsRotating: {
            get: function () {
                return this._isRotating
            }
        }
    }), r.prototype.close = function () {
        this._isOpened && (e("#checkImageSubHeaderRotate").length > 0 && e("#checkImageSubHeaderRotate").remove(), n.stop(), this._isRotating = !1, this._isOpened = !1)
    }, r
}), define("tools/TETools/AddFavoriteTool", ["jquery", "../MenuEntry", "./FavoritesStorage", "internal/GeometryHelper", "internal/Navigate"], function (e, t, n, r, i) {
    "use strict";
    var s = function () {
        this._favoritesStorage = n.DefaultStorage, this._isOpened = !1, this.getId = function () {
            return "AddFavorite"
        }, this.getMenuEntry = function () {
            return t.addToSidebar(this, TELang.i18n("PlacesTool_AddFavorites"), "./img/newDesign/tools_add_favorits.png", 30, t.MenuEntryNavigation(), TELang.i18n("NavigationTools_Header"), !1, !0, undefined, "none")
        }, this.open = function () {
            var t = this, n = this.PickAFavoritePosition();
            t.isCancel = !1;
            var i = this._favoritesStorage.createFavoriteItem();
            n && n != null && (i.tePosition.Cartesian = n.clone(), i.tePosition.HeadingPitchRange = r.getHeadingPitchRange(viewer.camera.position, i.tePosition.Cartesian)), i.name != undefined && i.name == "" && (i.name = TELang.i18n("my_favorite_location")), this._favoritesStorage.DefaultStorage.saveItem(i), this.ToolManager.openTool("EditFavoriteTool", {
                id: i.id,
                callback: e.proxy(function (e) {
                    t.isCancel = e, setTimeout(function () {
                        t.isCancel && t._favoritesStorage.DefaultStorage.deleteItem(i.id)
                    }, 200)
                }, this)
            })
        }
    };
    return s.prototype.PickAFavoritePosition = function () {
        var e = undefined;
        for (var t = 1; t <= 3; t++) {
            var n = new Cesium.Cartesian2(viewer.canvas.width / 2, viewer.canvas.height - viewer.canvas.height / Math.pow(2, t));
            e = viewer.scene.screenToWorld(n);
            if (e != undefined) break;
            continue
        }
        if (e == undefined) {
            var r = viewer.camera.position, i = viewer.camera.direction, s = new Cesium.Ray(r, i);
            e = Cesium.Ray.getPoint(s, viewer.camera.positionCartographic.height / 3)
        }
        return e
    }, Cesium.defineProperties(s.prototype, {
        IsRotating: {
            get: function () {
                return this._isRotating
            }
        }
    }), s
}), define("internal/ObliqueViewer", ["jquery"], function (e) {
    "use strict";
    var t = function (t, n, r, i) {
        function a(n) {
            function i() {
                var e = r.transformedPoint(0, 0), t = r.transformedPoint(n.width, n.height);
                r.clearRect(e.x, e.y, t.x - e.x, t.y - e.y), r.save(), r.setTransform(1, 0, 0, 1, 0, 0), r.clearRect(0, 0, n.width, n.height), r.restore(), r.drawImage(s, 0, 0)
            }

            n.width = e(t).width(), n.height = e(t).height();
            var r = n.getContext("2d");
            f(r), i();
            var a = 0, l = 0, c, h;
            n.addEventListener("mousedown", function (e) {
                document.body.style.mozUserSelect = document.body.style.webkitUserSelect = document.body.style.userSelect = "none", a = e.offsetX || e.pageX - n.offsetLeft, l = e.offsetY || e.pageY - n.offsetTop, c = r.transformedPoint(a, l), h = !1
            }, !1), n.addEventListener("mousemove", function (e) {
                a = e.offsetX || e.pageX - n.offsetLeft, l = e.offsetY || e.pageY - n.offsetTop, h = !0;
                if (c) {
                    var t = r.transformedPoint(a, l);
                    r.translate(t.x - c.x, t.y - c.y), i()
                }
            }, !1), n.addEventListener("mouseup", function (e) {
                c = null, h || d(e.shiftKey ? -1 : 1)
            }, !1), n.addEventListener("dblclick", function (e) {
                v()
            }, !1);
            var p = 1.05, d = function (e) {
                var t = r.transformedPoint(a, l);
                r.translate(t.x, t.y);
                var n = Math.pow(p, e);
                r.scale(n, n), r.translate(-t.x, -t.y), i()
            }, v = function () {
                var e = 1;
                o / u > n.width / n.height ? e = n.width / o : e = n.height / u, a = 0, l = 0, r.setTransform(1, 0, 0, 1, 0, 0);
                var t = r.transformedPoint(a, l);
                r.translate(t.x, t.y), r.scale(e, e), r.translate(-t.x, -t.y), i()
            }, m = function (e) {
                var t = e.wheelDelta ? e.wheelDelta / 40 : e.detail ? -e.detail : 0;
                return t && d(t), e.preventDefault() && !1
            };
            n.addEventListener("DOMMouseScroll", m, !1), n.addEventListener("mousewheel", m, !1), v()
        }

        function f(e) {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "svg"), n = t.createSVGMatrix();
            e.getTransform = function () {
                return n
            };
            var r = [], i = e.save;
            e.save = function () {
                return r.push(n.translate(0, 0)), i.call(e)
            };
            var s = e.restore;
            e.restore = function () {
                return n = r.pop(), s.call(e)
            };
            var o = e.scale;
            e.scale = function (t, r) {
                return n = n.scaleNonUniform(t, r), o.call(e, t, r)
            };
            var u = e.rotate;
            e.rotate = function (t) {
                return n = n.rotate(t * 180 / Math.PI), u.call(e, t)
            };
            var a = e.translate;
            e.translate = function (t, r) {
                return n = n.translate(t, r), a.call(e, t, r)
            };
            var f = e.transform;
            e.transform = function (r, i, s, o, u, a) {
                var l = t.createSVGMatrix();
                return l.a = r, l.b = i, l.c = s, l.d = o, l.e = u, l.f = a, n = n.multiply(l), f.call(e, r, i, s, o, u, a)
            };
            var l = e.setTransform;
            e.setTransform = function (t, r, i, s, o, u) {
                return n.a = t, n.b = r, n.c = i, n.d = s, n.e = o, n.f = u, l.call(e, t, r, i, s, o, u)
            };
            var c = t.createSVGPoint();
            e.transformedPoint = function (e, t) {
                return c.x = e, c.y = t, c.matrixTransform(n.inverse())
            }
        }

        var s = new Image;
        s.src = n;
        var o, u;
        s.onload = function () {
            o = this.width, u = this.height;
            var n = e(t);
            r && (o / u > n.width() / n.height() ? n.height(parseInt(u / o * n.width() + .5)) : n.width(parseInt(o / u * n.height() + .5)));
            var s = e("<canvas id='obliqueCanvas' style='cursor: crosshair;' />");
            n.append(s), a(s[0]), i && i()
        }
    };
    return t
}), function (e) {
    e.version = {versionStr: "2.3.1", major: parseInt("2", 10), minor: parseInt("3", 10), revision: parseInt("1", 10)};
    var t = {
        "[object Boolean]": "boolean",
        "[object Number]": "number",
        "[object String]": "string",
        "[object Function]": "function",
        "[object Array]": "array",
        "[object Date]": "date",
        "[object RegExp]": "regexp",
        "[object Object]": "object"
    }, n = Object.prototype.toString, r = Object.prototype.hasOwnProperty;
    e.isFunction = function (t) {
        return e.type(t) === "function"
    }, e.isArray = Array.isArray || function (t) {
        return e.type(t) === "array"
    }, e.isWindow = function (e) {
        return e && typeof e == "object" && "setInterval" in e
    }, e.type = function (e) {
        return e === null || e === undefined ? String(e) : t[n.call(e)] || "object"
    }, e.isPlainObject = function (t) {
        if (!t || OpenSeadragon.type(t) !== "object" || t.nodeType || e.isWindow(t)) return !1;
        if (t.constructor && !r.call(t, "constructor") && !r.call(t.constructor.prototype, "isPrototypeOf")) return !1;
        var n;
        for (var i in t) n = i;
        return n === undefined || r.call(t, n)
    }, e.isEmptyObject = function (e) {
        for (var t in e) return !1;
        return !0
    }, e.freezeObject = function (t) {
        return Object.freeze ? e.freezeObject = Object.freeze : e.freezeObject = function (e) {
            return e
        }, e.freezeObject(t)
    }, e.supportsCanvas = function () {
        var t = document.createElement("canvas");
        return !!e.isFunction(t.getContext) && !!t.getContext("2d")
    }(), e.isCanvasTainted = function (e) {
        var t = !1;
        try {
            e.getContext("2d").getImageData(0, 0, 1, 1)
        } catch (n) {
            t = !0
        }
        return t
    }, e.pixelDensityRatio = function () {
        if (e.supportsCanvas) {
            var t = document.createElement("canvas").getContext("2d"), n = window.devicePixelRatio || 1,
                r = t.webkitBackingStorePixelRatio || t.mozBackingStorePixelRatio || t.msBackingStorePixelRatio || t.oBackingStorePixelRatio || t.backingStorePixelRatio || 1;
            return Math.max(n, 1) / r
        }
        return 1
    }()
}(OpenSeadragon), function ($) {
    function getOffsetParent(e, t) {
        return t && e != document.body ? document.body : e.offsetParent
    }

    $.extend = function () {
        var e, t, n, r, i, s, o = arguments[0] || {}, u = arguments.length, a = !1, f = 1;
        typeof o == "boolean" && (a = o, o = arguments[1] || {}, f = 2), typeof o != "object" && !OpenSeadragon.isFunction(o) && (o = {}), u === f && (o = this, --f);
        for (; f < u; f++) {
            e = arguments[f];
            if (e !== null || e !== undefined) for (t in e) {
                n = o[t], r = e[t];
                if (o === r) continue;
                a && r && (OpenSeadragon.isPlainObject(r) || (i = OpenSeadragon.isArray(r))) ? (i ? (i = !1, s = n && OpenSeadragon.isArray(n) ? n : []) : s = n && OpenSeadragon.isPlainObject(n) ? n : {}, o[t] = OpenSeadragon.extend(a, s, r)) : r !== undefined && (o[t] = r)
            }
        }
        return o
    };
    var isIOSDevice = function () {
        if (typeof navigator != "object") return !1;
        var e = navigator.userAgent;
        return typeof e != "string" ? !1 : e.indexOf("iPhone") !== -1 || e.indexOf("iPad") !== -1 || e.indexOf("iPod") !== -1
    };
    $.extend($, {
        DEFAULT_SETTINGS: {
            xmlPath: null,
            tileSources: null,
            tileHost: null,
            initialPage: 0,
            crossOriginPolicy: !1,
            ajaxWithCredentials: !1,
            loadTilesWithAjax: !1,
            ajaxHeaders: {},
            panHorizontal: !0,
            panVertical: !0,
            constrainDuringPan: !1,
            wrapHorizontal: !1,
            wrapVertical: !1,
            visibilityRatio: .5,
            minPixelRatio: .5,
            defaultZoomLevel: 0,
            minZoomLevel: null,
            maxZoomLevel: null,
            homeFillsViewer: !1,
            clickTimeThreshold: 300,
            clickDistThreshold: 5,
            dblClickTimeThreshold: 300,
            dblClickDistThreshold: 20,
            springStiffness: 6.5,
            animationTime: 1.2,
            gestureSettingsMouse: {
                scrollToZoom: !0,
                clickToZoom: !0,
                dblClickToZoom: !1,
                pinchToZoom: !1,
                flickEnabled: !1,
                flickMinSpeed: 120,
                flickMomentum: .25,
                pinchRotate: !1
            },
            gestureSettingsTouch: {
                scrollToZoom: !1,
                clickToZoom: !1,
                dblClickToZoom: !0,
                pinchToZoom: !0,
                flickEnabled: !0,
                flickMinSpeed: 120,
                flickMomentum: .25,
                pinchRotate: !1
            },
            gestureSettingsPen: {
                scrollToZoom: !1,
                clickToZoom: !0,
                dblClickToZoom: !1,
                pinchToZoom: !1,
                flickEnabled: !1,
                flickMinSpeed: 120,
                flickMomentum: .25,
                pinchRotate: !1
            },
            gestureSettingsUnknown: {
                scrollToZoom: !1,
                clickToZoom: !1,
                dblClickToZoom: !0,
                pinchToZoom: !0,
                flickEnabled: !0,
                flickMinSpeed: 120,
                flickMomentum: .25,
                pinchRotate: !1
            },
            zoomPerClick: 2,
            zoomPerScroll: 1.2,
            zoomPerSecond: 1,
            blendTime: 0,
            alwaysBlend: !1,
            autoHideControls: !0,
            immediateRender: !1,
            minZoomImageRatio: .9,
            maxZoomPixelRatio: 1.1,
            smoothTileEdgesMinZoom: 1.1,
            iOSDevice: isIOSDevice(),
            pixelsPerWheelLine: 40,
            autoResize: !0,
            preserveImageSizeOnResize: !1,
            minScrollDeltaTime: 50,
            showSequenceControl: !0,
            sequenceControlAnchor: null,
            preserveViewport: !1,
            preserveOverlays: !1,
            navPrevNextWrap: !1,
            showNavigationControl: !0,
            navigationControlAnchor: null,
            showZoomControl: !0,
            showHomeControl: !0,
            showFullPageControl: !0,
            showRotationControl: !1,
            controlsFadeDelay: 2e3,
            controlsFadeLength: 1500,
            mouseNavEnabled: !0,
            showNavigator: !1,
            navigatorId: null,
            navigatorPosition: null,
            navigatorSizeRatio: .2,
            navigatorMaintainSizeRatio: !1,
            navigatorTop: null,
            navigatorLeft: null,
            navigatorHeight: null,
            navigatorWidth: null,
            navigatorAutoResize: !0,
            navigatorAutoFade: !0,
            navigatorRotate: !0,
            degrees: 0,
            opacity: 1,
            preload: !1,
            compositeOperation: null,
            placeholderFillStyle: null,
            showReferenceStrip: !1,
            referenceStripScroll: "horizontal",
            referenceStripElement: null,
            referenceStripHeight: null,
            referenceStripWidth: null,
            referenceStripPosition: "BOTTOM_LEFT",
            referenceStripSizeRatio: .2,
            collectionRows: 3,
            collectionColumns: 0,
            collectionLayout: "horizontal",
            collectionMode: !1,
            collectionTileSize: 800,
            collectionTileMargin: 80,
            imageLoaderLimit: 0,
            maxImageCacheCount: 200,
            timeout: 3e4,
            useCanvas: !0,
            prefixUrl: "/images/",
            navImages: {
                zoomIn: {
                    REST: "zoomin_rest.png",
                    GROUP: "zoomin_grouphover.png",
                    HOVER: "zoomin_hover.png",
                    DOWN: "zoomin_pressed.png"
                },
                zoomOut: {
                    REST: "zoomout_rest.png",
                    GROUP: "zoomout_grouphover.png",
                    HOVER: "zoomout_hover.png",
                    DOWN: "zoomout_pressed.png"
                },
                home: {
                    REST: "home_rest.png",
                    GROUP: "home_grouphover.png",
                    HOVER: "home_hover.png",
                    DOWN: "home_pressed.png"
                },
                fullpage: {
                    REST: "fullpage_rest.png",
                    GROUP: "fullpage_grouphover.png",
                    HOVER: "fullpage_hover.png",
                    DOWN: "fullpage_pressed.png"
                },
                rotateleft: {
                    REST: "rotateleft_rest.png",
                    GROUP: "rotateleft_grouphover.png",
                    HOVER: "rotateleft_hover.png",
                    DOWN: "rotateleft_pressed.png"
                },
                rotateright: {
                    REST: "rotateright_rest.png",
                    GROUP: "rotateright_grouphover.png",
                    HOVER: "rotateright_hover.png",
                    DOWN: "rotateright_pressed.png"
                },
                previous: {
                    REST: "previous_rest.png",
                    GROUP: "previous_grouphover.png",
                    HOVER: "previous_hover.png",
                    DOWN: "previous_pressed.png"
                },
                next: {
                    REST: "next_rest.png",
                    GROUP: "next_grouphover.png",
                    HOVER: "next_hover.png",
                    DOWN: "next_pressed.png"
                }
            },
            debugMode: !1,
            debugGridColor: ["#437AB2", "#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]
        }, SIGNAL: "----seadragon----", delegate: function (e, t) {
            return function () {
                var n = arguments;
                return n === undefined && (n = []), t.apply(e, n)
            }
        }, BROWSERS: {UNKNOWN: 0, IE: 1, FIREFOX: 2, SAFARI: 3, CHROME: 4, OPERA: 5}, getElement: function (e) {
            return typeof e == "string" && (e = document.getElementById(e)), e
        }, getElementPosition: function (e) {
            var t = new $.Point, n, r;
            e = $.getElement(e), n = $.getElementStyle(e).position == "fixed", r = getOffsetParent(e, n);
            while (r) t.x += e.offsetLeft, t.y += e.offsetTop, n && (t = t.plus($.getPageScroll())), e = r, n = $.getElementStyle(e).position == "fixed", r = getOffsetParent(e, n);
            return t
        }, getElementOffset: function (e) {
            e = $.getElement(e);
            var t = e && e.ownerDocument, n, r, i = {top: 0, left: 0};
            return t ? (n = t.documentElement, typeof e.getBoundingClientRect != typeof undefined && (i = e.getBoundingClientRect()), r = t == t.window ? t : t.nodeType === 9 ? t.defaultView || t.parentWindow : !1, new $.Point(i.left + (r.pageXOffset || n.scrollLeft) - (n.clientLeft || 0), i.top + (r.pageYOffset || n.scrollTop) - (n.clientTop || 0))) : new $.Point
        }, getElementSize: function (e) {
            return e = $.getElement(e), new $.Point(e.clientWidth, e.clientHeight)
        }, getElementStyle: document.documentElement.currentStyle ? function (e) {
            return e = $.getElement(e), e.currentStyle
        } : function (e) {
            return e = $.getElement(e), window.getComputedStyle(e, "")
        }, getCssPropertyWithVendorPrefix: function (e) {
            var t = {};
            return $.getCssPropertyWithVendorPrefix = function (e) {
                if (t[e] !== undefined) return t[e];
                var n = document.createElement("div").style, r = null;
                if (n[e] !== undefined) r = e; else {
                    var i = ["Webkit", "Moz", "MS", "O", "webkit", "moz", "ms", "o"], s = $.capitalizeFirstLetter(e);
                    for (var o = 0; o < i.length; o++) {
                        var u = i[o] + s;
                        if (n[u] !== undefined) {
                            r = u;
                            break
                        }
                    }
                }
                return t[e] = r, r
            }, $.getCssPropertyWithVendorPrefix(e)
        }, capitalizeFirstLetter: function (e) {
            return e.charAt(0).toUpperCase() + e.slice(1)
        }, positiveModulo: function (e, t) {
            var n = e % t;
            return n < 0 && (n += t), n
        }, pointInElement: function (e, t) {
            e = $.getElement(e);
            var n = $.getElementOffset(e), r = $.getElementSize(e);
            return t.x >= n.x && t.x < n.x + r.x && t.y < n.y + r.y && t.y >= n.y
        }, getEvent: function (e) {
            return e ? $.getEvent = function (e) {
                return e
            } : $.getEvent = function () {
                return window.event
            }, $.getEvent(e)
        }, getMousePosition: function (e) {
            if (typeof e.pageX == "number") $.getMousePosition = function (e) {
                var t = new $.Point;
                return e = $.getEvent(e), t.x = e.pageX, t.y = e.pageY, t
            }; else {
                if (typeof e.clientX != "number") throw new Error("Unknown event mouse position, no known technique.");
                $.getMousePosition = function (e) {
                    var t = new $.Point;
                    return e = $.getEvent(e), t.x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft, t.y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop, t
                }
            }
            return $.getMousePosition(e)
        }, getPageScroll: function () {
            var e = document.documentElement || {}, t = document.body || {};
            if (typeof window.pageXOffset == "number") $.getPageScroll = function () {
                return new $.Point(window.pageXOffset, window.pageYOffset)
            }; else if (t.scrollLeft || t.scrollTop) $.getPageScroll = function () {
                return new $.Point(document.body.scrollLeft, document.body.scrollTop)
            }; else {
                if (!e.scrollLeft && !e.scrollTop) return new $.Point(0, 0);
                $.getPageScroll = function () {
                    return new $.Point(document.documentElement.scrollLeft, document.documentElement.scrollTop)
                }
            }
            return $.getPageScroll()
        }, setPageScroll: function (e) {
            if (typeof window.scrollTo != "undefined") $.setPageScroll = function (e) {
                window.scrollTo(e.x, e.y)
            }; else {
                var t = $.getPageScroll();
                if (t.x === e.x && t.y === e.y) return;
                document.body.scrollLeft = e.x, document.body.scrollTop = e.y;
                var n = $.getPageScroll();
                if (n.x !== t.x && n.y !== t.y) {
                    $.setPageScroll = function (e) {
                        document.body.scrollLeft = e.x, document.body.scrollTop = e.y
                    };
                    return
                }
                document.documentElement.scrollLeft = e.x, document.documentElement.scrollTop = e.y, n = $.getPageScroll();
                if (n.x !== t.x && n.y !== t.y) {
                    $.setPageScroll = function (e) {
                        document.documentElement.scrollLeft = e.x, document.documentElement.scrollTop = e.y
                    };
                    return
                }
                $.setPageScroll = function (e) {
                }
            }
            return $.setPageScroll(e)
        }, getWindowSize: function () {
            var e = document.documentElement || {}, t = document.body || {};
            if (typeof window.innerWidth == "number") $.getWindowSize = function () {
                return new $.Point(window.innerWidth, window.innerHeight)
            }; else if (e.clientWidth || e.clientHeight) $.getWindowSize = function () {
                return new $.Point(document.documentElement.clientWidth, document.documentElement.clientHeight)
            }; else {
                if (!t.clientWidth && !t.clientHeight) throw new Error("Unknown window size, no known technique.");
                $.getWindowSize = function () {
                    return new $.Point(document.body.clientWidth, document.body.clientHeight)
                }
            }
            return $.getWindowSize()
        }, makeCenteredNode: function (e) {
            e = $.getElement(e);
            var t = [$.makeNeutralElement("div"), $.makeNeutralElement("div"), $.makeNeutralElement("div")];
            return $.extend(t[0].style, {
                display: "table",
                height: "100%",
                width: "100%"
            }), $.extend(t[1].style, {display: "table-row"}), $.extend(t[2].style, {
                display: "table-cell",
                verticalAlign: "middle",
                textAlign: "center"
            }), t[0].appendChild(t[1]), t[1].appendChild(t[2]), t[2].appendChild(e), t[0]
        }, makeNeutralElement: function (e) {
            var t = document.createElement(e), n = t.style;
            return n.background = "transparent none", n.border = "none", n.margin = "0px", n.padding = "0px", n.position = "static", t
        }, now: function () {
            return Date.now ? $.now = Date.now : $.now = function () {
                return (new Date).getTime()
            }, $.now()
        }, makeTransparentImage: function (e) {
            return $.makeTransparentImage = function (e) {
                var t = $.makeNeutralElement("img");
                return t.src = e, t
            }, $.Browser.vendor == $.BROWSERS.IE && $.Browser.version < 7 && ($.makeTransparentImage = function (e) {
                var t = $.makeNeutralElement("img"), n = null;
                return n = $.makeNeutralElement("span"), n.style.display = "inline-block", t.onload = function () {
                    n.style.width = n.style.width || t.width + "px", n.style.height = n.style.height || t.height + "px", t.onload = null, t = null
                }, t.src = e, n.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='" + e + "', sizingMethod='scale')", n
            }), $.makeTransparentImage(e)
        }, setElementOpacity: function (e, t, n) {
            var r, i;
            e = $.getElement(e), n && !$.Browser.alpha && (t = Math.round(t)), $.Browser.opacity ? e.style.opacity = t < 1 ? t : "" : t < 1 ? (r = Math.round(100 * t), i = "alpha(opacity=" + r + ")", e.style.filter = i) : e.style.filter = ""
        }, setElementTouchActionNone: function (e) {
            e = $.getElement(e), typeof e.style.touchAction != "undefined" ? e.style.touchAction = "none" : typeof e.style.msTouchAction != "undefined" && (e.style.msTouchAction = "none")
        }, addClass: function (e, t) {
            e = $.getElement(e), e.className ? (" " + e.className + " ").indexOf(" " + t + " ") === -1 && (e.className += " " + t) : e.className = t
        }, indexOf: function (e, t, n) {
            return Array.prototype.indexOf ? this.indexOf = function (e, t, n) {
                return e.indexOf(t, n)
            } : this.indexOf = function (e, t, n) {
                var r, i = n ? n : 0, s;
                if (!e) throw new TypeError;
                s = e.length;
                if (s === 0 || i >= s) return -1;
                i < 0 && (i = s - Math.abs(i));
                for (r = i; r < s; r++) if (e[r] === t) return r;
                return -1
            }, this.indexOf(e, t, n)
        }, removeClass: function (e, t) {
            var n, r = [], i;
            e = $.getElement(e), n = e.className.split(/\s+/);
            for (i = 0; i < n.length; i++) n[i] && n[i] !== t && r.push(n[i]);
            e.className = r.join(" ")
        }, addEvent: function () {
            if (window.addEventListener) return function (e, t, n, r) {
                e = $.getElement(e), e.addEventListener(t, n, r)
            };
            if (window.attachEvent) return function (e, t, n, r) {
                e = $.getElement(e), e.attachEvent("on" + t, n)
            };
            throw new Error("No known event model.")
        }(), removeEvent: function () {
            if (window.removeEventListener) return function (e, t, n, r) {
                e = $.getElement(e), e.removeEventListener(t, n, r)
            };
            if (window.detachEvent) return function (e, t, n, r) {
                e = $.getElement(e), e.detachEvent("on" + t, n)
            };
            throw new Error("No known event model.")
        }(), cancelEvent: function (e) {
            e = $.getEvent(e), e.preventDefault ? $.cancelEvent = function (e) {
                e.preventDefault()
            } : $.cancelEvent = function (e) {
                e = $.getEvent(e), e.cancel = !0, e.returnValue = !1
            }, $.cancelEvent(e)
        }, stopEvent: function (e) {
            e = $.getEvent(e), e.stopPropagation ? $.stopEvent = function (e) {
                e.stopPropagation()
            } : $.stopEvent = function (e) {
                e = $.getEvent(e), e.cancelBubble = !0
            }, $.stopEvent(e)
        }, createCallback: function (e, t) {
            var n = [], r;
            for (r = 2; r < arguments.length; r++) n.push(arguments[r]);
            return function () {
                var r = n.concat([]), i;
                for (i = 0; i < arguments.length; i++) r.push(arguments[i]);
                return t.apply(e, r)
            }
        }, getUrlParameter: function (e) {
            var t = URLPARAMS[e];
            return t ? t : null
        }, getUrlProtocol: function (e) {
            var t = e.match(/^([a-z]+:)\/\//i);
            return t === null ? window.location.protocol : t[1].toLowerCase()
        }, createAjaxRequest: function (e) {
            var t;
            try {
                t = !!(new ActiveXObject("Microsoft.XMLHTTP"))
            } catch (n) {
                t = !1
            }
            if (t) window.XMLHttpRequest ? $.createAjaxRequest = function (e) {
                return e ? new ActiveXObject("Microsoft.XMLHTTP") : new XMLHttpRequest
            } : $.createAjaxRequest = function () {
                return new ActiveXObject("Microsoft.XMLHTTP")
            }; else {
                if (!window.XMLHttpRequest) throw new Error("Browser doesn't support XMLHttpRequest.");
                $.createAjaxRequest = function () {
                    return new XMLHttpRequest
                }
            }
            return $.createAjaxRequest(e)
        }, makeAjaxRequest: function (e, t, n) {
            var r, i, s;
            $.isPlainObject(e) && (t = e.success, n = e.error, r = e.withCredentials, i = e.headers, s = e.responseType || null, e = e.url);
            var o = $.getUrlProtocol(e), u = $.createAjaxRequest(o === "file:");
            if (!$.isFunction(t)) throw new Error("makeAjaxRequest requires a success callback");
            u.onreadystatechange = function () {
                u.readyState == 4 && (u.onreadystatechange = function () {
                }, u.status >= 200 && u.status < 300 || u.status === 0 && o !== "http:" && o !== "https:" ? t(u) : ($.console.log("AJAX request returned %d: %s", u.status, e), $.isFunction(n) && n(u)))
            };
            try {
                u.open("GET", e, !0), s && (u.responseType = s);
                if (i) for (var a in i) i.hasOwnProperty(a) && i[a] && u.setRequestHeader(a, i[a]);
                r && (u.withCredentials = !0), u.send(null)
            } catch (f) {
                var l = f.message, c = $.Browser.vendor == $.BROWSERS.IE && $.Browser.version < 10;
                c && typeof f.number != "undefined" && f.number == -2147024891 && (l += "\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"), $.console.log("%s while making AJAX request: %s", f.name, l), u.onreadystatechange = function () {
                };
                if (window.XDomainRequest) {
                    var h = new XDomainRequest;
                    if (h) {
                        h.onload = function (e) {
                            $.isFunction(t) && t({responseText: h.responseText, status: 200, statusText: "OK"})
                        }, h.onerror = function (e) {
                            $.isFunction(n) && n({
                                responseText: h.responseText,
                                status: 444,
                                statusText: "An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."
                            })
                        };
                        try {
                            h.open("GET", e), h.send()
                        } catch (p) {
                            $.isFunction(n) && n(u, f)
                        }
                    }
                } else $.isFunction(n) && n(u, f)
            }
            return u
        }, jsonp: function (e) {
            var t, n = e.url, r = document.head || document.getElementsByTagName("head")[0] || document.documentElement,
                i = e.callbackName || "openseadragon" + $.now(), s = window[i], o = "$1" + i + "$2",
                u = e.param || "callback", a = e.callback;
            n = n.replace(/(\=)\?(&|$)|\?\?/i, o), n += (/\?/.test(n) ? "&" : "?") + u + "=" + i, window[i] = function (e) {
                if (!s) try {
                    delete window[i]
                } catch (t) {
                } else window[i] = s;
                a && $.isFunction(a) && a(e)
            }, t = document.createElement("script");
            if (undefined !== e.async || !1 !== e.async) t.async = "async";
            e.scriptCharset && (t.charset = e.scriptCharset), t.src = n, t.onload = t.onreadystatechange = function (e, n) {
                if (n || !t.readyState || /loaded|complete/.test(t.readyState)) t.onload = t.onreadystatechange = null, r && t.parentNode && r.removeChild(t), t = undefined
            }, r.insertBefore(t, r.firstChild)
        }, createFromDZI: function () {
            throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."
        }, parseXml: function (e) {
            if (window.DOMParser) $.parseXml = function (e) {
                var t = null, n;
                return n = new DOMParser, t = n.parseFromString(e, "text/xml"), t
            }; else {
                if (!window.ActiveXObject) throw new Error("Browser doesn't support XML DOM.");
                $.parseXml = function (e) {
                    var t = null;
                    return t = new ActiveXObject("Microsoft.XMLDOM"), t.async = !1, t.loadXML(e), t
                }
            }
            return $.parseXml(e)
        }, parseJSON: function (string) {
            return window.JSON && window.JSON.parse ? $.parseJSON = window.JSON.parse : $.parseJSON = function (string) {
                return eval("(" + string + ")")
            }, $.parseJSON(string)
        }, imageFormatSupported: function (e) {
            return e = e ? e : "", !!FILEFORMATS[e.toLowerCase()]
        }
    }), $.Browser = {vendor: $.BROWSERS.UNKNOWN, version: 0, alpha: !0};
    var FILEFORMATS = {bmp: !1, jpeg: !0, jpg: !0, png: !0, tif: !1, wdp: !1}, URLPARAMS = {};
    (function () {
        var e = navigator.appVersion, t = navigator.userAgent, n;
        switch (navigator.appName) {
            case"Microsoft Internet Explorer":
                !!window.attachEvent && !!window.ActiveXObject && ($.Browser.vendor = $.BROWSERS.IE, $.Browser.version = parseFloat(t.substring(t.indexOf("MSIE") + 5, t.indexOf(";", t.indexOf("MSIE")))));
                break;
            case"Netscape":
                window.addEventListener && (t.indexOf("Firefox") >= 0 ? ($.Browser.vendor = $.BROWSERS.FIREFOX, $.Browser.version = parseFloat(t.substring(t.indexOf("Firefox") + 8))) : t.indexOf("Safari") >= 0 ? ($.Browser.vendor = t.indexOf("Chrome") >= 0 ? $.BROWSERS.CHROME : $.BROWSERS.SAFARI, $.Browser.version = parseFloat(t.substring(t.substring(0, t.indexOf("Safari")).lastIndexOf("/") + 1, t.indexOf("Safari")))) : (n = new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"), n.exec(t) !== null && ($.Browser.vendor = $.BROWSERS.IE, $.Browser.version = parseFloat(RegExp.$1))));
                break;
            case"Opera":
                $.Browser.vendor = $.BROWSERS.OPERA, $.Browser.version = parseFloat(e)
        }
        var r = window.location.search.substring(1), i = r.split("&"), s, o, u;
        for (u = 0; u < i.length; u++) s = i[u], o = s.indexOf("="), o > 0 && (URLPARAMS[s.substring(0, o)] = decodeURIComponent(s.substring(o + 1)));
        $.Browser.alpha = !($.Browser.vendor == $.BROWSERS.IE && $.Browser.version < 9 || $.Browser.vendor == $.BROWSERS.CHROME && $.Browser.version < 2), $.Browser.opacity = !($.Browser.vendor == $.BROWSERS.IE && $.Browser.version < 9)
    })();
    var nullfunction = function (e) {
    };
    $.console = window.console || {
        log: nullfunction,
        debug: nullfunction,
        info: nullfunction,
        warn: nullfunction,
        error: nullfunction,
        assert: nullfunction
    }, function (e) {
        var t = e.requestAnimationFrame || e.mozRequestAnimationFrame || e.webkitRequestAnimationFrame || e.msRequestAnimationFrame,
            n = e.cancelAnimationFrame || e.mozCancelAnimationFrame || e.webkitCancelAnimationFrame || e.msCancelAnimationFrame;
        if (t && n) $.requestAnimationFrame = function () {
            return t.apply(e, arguments)
        }, $.cancelAnimationFrame = function () {
            return n.apply(e, arguments)
        }; else {
            var r = [], i = [], s = 0, o;
            $.requestAnimationFrame = function (e) {
                return r.push([++s, e]), o || (o = setInterval(function () {
                    if (r.length) {
                        var e = $.now(), t = i;
                        i = r, r = t;
                        while (i.length) i.shift()[1](e)
                    } else clearInterval(o), o = undefined
                }, 20)), s
            }, $.cancelAnimationFrame = function (e) {
                var t, n;
                for (t = 0, n = r.length; t < n; t += 1) if (r[t][0] === e) {
                    r.splice(t, 1);
                    return
                }
                for (t = 0, n = i.length; t < n; t += 1) if (i[t][0] === e) {
                    i.splice(t, 1);
                    return
                }
            }
        }
    }(window)
}(OpenSeadragon), function (e, t) {
    typeof define == "function" && define.amd ? define("openseadragon/openseadragon", [], t) : typeof module == "object" && module.exports ? module.exports = t() : e.OpenSeadragon = t()
}(this, function () {
    return OpenSeadragon
}), function (e) {
    var t = {
        supportsFullScreen: !1, isFullScreen: function () {
            return !1
        }, getFullScreenElement: function () {
            return null
        }, requestFullScreen: function () {
        }, exitFullScreen: function () {
        }, cancelFullScreen: function () {
        }, fullScreenEventName: "", fullScreenErrorEventName: ""
    };
    document.exitFullscreen ? (t.supportsFullScreen = !0, t.getFullScreenElement = function () {
        return document.fullscreenElement
    }, t.requestFullScreen = function (e) {
        return e.requestFullscreen()
    }, t.exitFullScreen = function () {
        document.exitFullscreen()
    }, t.fullScreenEventName = "fullscreenchange", t.fullScreenErrorEventName = "fullscreenerror") : document.msExitFullscreen ? (t.supportsFullScreen = !0, t.getFullScreenElement = function () {
        return document.msFullscreenElement
    }, t.requestFullScreen = function (e) {
        return e.msRequestFullscreen()
    }, t.exitFullScreen = function () {
        document.msExitFullscreen()
    }, t.fullScreenEventName = "MSFullscreenChange", t.fullScreenErrorEventName = "MSFullscreenError") : document.webkitExitFullscreen ? (t.supportsFullScreen = !0, t.getFullScreenElement = function () {
        return document.webkitFullscreenElement
    }, t.requestFullScreen = function (e) {
        return e.webkitRequestFullscreen()
    }, t.exitFullScreen = function () {
        document.webkitExitFullscreen()
    }, t.fullScreenEventName = "webkitfullscreenchange", t.fullScreenErrorEventName = "webkitfullscreenerror") : document.webkitCancelFullScreen ? (t.supportsFullScreen = !0, t.getFullScreenElement = function () {
        return document.webkitCurrentFullScreenElement
    }, t.requestFullScreen = function (e) {
        return e.webkitRequestFullScreen()
    }, t.exitFullScreen = function () {
        document.webkitCancelFullScreen()
    }, t.fullScreenEventName = "webkitfullscreenchange", t.fullScreenErrorEventName = "webkitfullscreenerror") : document.mozCancelFullScreen && (t.supportsFullScreen = !0, t.getFullScreenElement = function () {
        return document.mozFullScreenElement
    }, t.requestFullScreen = function (e) {
        return e.mozRequestFullScreen()
    }, t.exitFullScreen = function () {
        document.mozCancelFullScreen()
    }, t.fullScreenEventName = "mozfullscreenchange", t.fullScreenErrorEventName = "mozfullscreenerror"), t.isFullScreen = function () {
        return t.getFullScreenElement() !== null
    }, t.cancelFullScreen = function () {
        e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."), t.exitFullScreen()
    }, e.extend(e, t)
}(OpenSeadragon), function (e) {
    e.EventSource = function () {
        this.events = {}
    }, e.EventSource.prototype = {
        addOnceHandler: function (e, t, n, r) {
            var i = this;
            r = r || 1;
            var s = 0, o = function (n) {
                s++, s === r && i.removeHandler(e, o), t(n)
            };
            this.addHandler(e, o, n)
        }, addHandler: function (t, n, r) {
            var i = this.events[t];
            i || (this.events[t] = i = []), n && e.isFunction(n) && (i[i.length] = {handler: n, userData: r || null})
        }, removeHandler: function (t, n) {
            var r = this.events[t], i = [], s;
            if (!r) return;
            if (e.isArray(r)) {
                for (s = 0; s < r.length; s++) r[s].handler !== n && i.push(r[s]);
                this.events[t] = i
            }
        }, removeAllHandlers: function (e) {
            if (e) this.events[e] = []; else for (var t in this.events) this.events[t] = []
        }, getHandler: function (e) {
            var t = this.events[e];
            return !t || !t.length ? null : (t = t.length === 1 ? [t[0]] : Array.apply(null, t), function (e, n) {
                var r, i = t.length;
                for (r = 0; r < i; r++) t[r] && (n.eventSource = e, n.userData = t[r].userData, t[r].handler(n))
            })
        }, raiseEvent: function (e, t) {
            var n = this.getHandler(e);
            n && (t || (t = {}), n(this, t))
        }
    }
}(OpenSeadragon),function (e) {
    function r(t) {
        var r = n[t.hash], i, s = r.activePointersLists.length;
        for (i = 0; i < s; i++) r.activePointersLists[i].captureCount > 0 && (e.removeEvent(e.MouseTracker.captureElement, "mousemove", r.mousemovecaptured, !0), e.removeEvent(e.MouseTracker.captureElement, "mouseup", r.mouseupcaptured, !0), e.removeEvent(e.MouseTracker.captureElement, e.MouseTracker.unprefixedPointerEvents ? "pointermove" : "MSPointerMove", r.pointermovecaptured, !0), e.removeEvent(e.MouseTracker.captureElement, e.MouseTracker.unprefixedPointerEvents ? "pointerup" : "MSPointerUp", r.pointerupcaptured, !0), e.removeEvent(e.MouseTracker.captureElement, "touchmove", r.touchmovecaptured, !0), e.removeEvent(e.MouseTracker.captureElement, "touchend", r.touchendcaptured, !0), r.activePointersLists[i].captureCount = 0);
        for (i = 0; i < s; i++) r.activePointersLists.pop()
    }

    function i(t) {
        var i = n[t.hash], s, o;
        if (!i.tracking) {
            for (o = 0; o < e.MouseTracker.subscribeEvents.length; o++) s = e.MouseTracker.subscribeEvents[o], e.addEvent(t.element, s, i[s], !1);
            r(t), i.tracking = !0
        }
    }

    function s(t) {
        var i = n[t.hash], s, o;
        if (i.tracking) {
            for (o = 0; o < e.MouseTracker.subscribeEvents.length; o++) s = e.MouseTracker.subscribeEvents[o], e.removeEvent(t.element, s, i[s], !1);
            r(t), i.tracking = !1
        }
    }

    function o(t, r) {
        var i = n[t.hash];
        if (r === "pointerevent") return {
            upName: e.MouseTracker.unprefixedPointerEvents ? "pointerup" : "MSPointerUp",
            upHandler: i.pointerupcaptured,
            moveName: e.MouseTracker.unprefixedPointerEvents ? "pointermove" : "MSPointerMove",
            moveHandler: i.pointermovecaptured
        };
        if (r === "mouse") return {
            upName: "mouseup",
            upHandler: i.mouseupcaptured,
            moveName: "mousemove",
            moveHandler: i.mousemovecaptured
        };
        if (r === "touch") return {
            upName: "touchend",
            upHandler: i.touchendcaptured,
            moveName: "touchmove",
            moveHandler: i.touchmovecaptured
        };
        throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")
    }

    function u(t, n, r) {
        var i = t.getActivePointersListByType(n), s;
        i.captureCount += r || 1, i.captureCount === 1 && (e.Browser.vendor === e.BROWSERS.IE && e.Browser.version < 9 ? t.element.setCapture(!0) : (s = o(t, e.MouseTracker.havePointerEvents ? "pointerevent" : n), vt && mt(window.top) && e.addEvent(window.top, s.upName, s.upHandler, !0), e.addEvent(e.MouseTracker.captureElement, s.upName, s.upHandler, !0), e.addEvent(e.MouseTracker.captureElement, s.moveName, s.moveHandler, !0)))
    }

    function a(t, n, r) {
        var i = t.getActivePointersListByType(n), s;
        i.captureCount -= r || 1, i.captureCount === 0 && (e.Browser.vendor === e.BROWSERS.IE && e.Browser.version < 9 ? t.element.releaseCapture() : (s = o(t, e.MouseTracker.havePointerEvents ? "pointerevent" : n), vt && mt(window.top) && e.removeEvent(window.top, s.upName, s.upHandler, !0), e.removeEvent(e.MouseTracker.captureElement, s.moveName, s.moveHandler, !0), e.removeEvent(e.MouseTracker.captureElement, s.upName, s.upHandler, !0)))
    }

    function f(t) {
        var n;
        if (e.MouseTracker.unprefixedPointerEvents) n = t.pointerType; else switch (t.pointerType) {
            case 2:
                n = "touch";
                break;
            case 3:
                n = "pen";
                break;
            case 4:
                n = "mouse";
                break;
            default:
                n = ""
        }
        return n
    }

    function l(t) {
        return e.getMousePosition(t)
    }

    function c(e, t) {
        return h(l(e), t)
    }

    function h(t, n) {
        var r = e.getElementOffset(n);
        return t.minus(r)
    }

    function p(t, n) {
        return new e.Point((t.x + n.x) / 2, (t.y + n.y) / 2)
    }

    function d(t, n) {
        t.clickHandler && e.cancelEvent(n)
    }

    function v(t, n) {
        t.dblClickHandler && e.cancelEvent(n)
    }

    function m(t, n) {
        var r;
        t.keyDownHandler && (n = e.getEvent(n), r = t.keyDownHandler({
            eventSource: t,
            keyCode: n.keyCode ? n.keyCode : n.charCode,
            ctrl: n.ctrlKey,
            shift: n.shiftKey,
            alt: n.altKey,
            meta: n.metaKey,
            originalEvent: n,
            preventDefaultAction: !1,
            userData: t.userData
        }), r || e.cancelEvent(n))
    }

    function g(t, n) {
        var r;
        t.keyUpHandler && (n = e.getEvent(n), r = t.keyUpHandler({
            eventSource: t,
            keyCode: n.keyCode ? n.keyCode : n.charCode,
            ctrl: n.ctrlKey,
            shift: n.shiftKey,
            alt: n.altKey,
            meta: n.metaKey,
            originalEvent: n,
            preventDefaultAction: !1,
            userData: t.userData
        }), r || e.cancelEvent(n))
    }

    function y(t, n) {
        var r;
        t.keyHandler && (n = e.getEvent(n), r = t.keyHandler({
            eventSource: t,
            keyCode: n.keyCode ? n.keyCode : n.charCode,
            ctrl: n.ctrlKey,
            shift: n.shiftKey,
            alt: n.altKey,
            meta: n.metaKey,
            originalEvent: n,
            preventDefaultAction: !1,
            userData: t.userData
        }), r || e.cancelEvent(n))
    }

    function b(t, n) {
        var r;
        t.focusHandler && (n = e.getEvent(n), r = t.focusHandler({
            eventSource: t,
            originalEvent: n,
            preventDefaultAction: !1,
            userData: t.userData
        }), r === !1 && e.cancelEvent(n))
    }

    function w(t, n) {
        var r;
        t.blurHandler && (n = e.getEvent(n), r = t.blurHandler({
            eventSource: t,
            originalEvent: n,
            preventDefaultAction: !1,
            userData: t.userData
        }), r === !1 && e.cancelEvent(n))
    }

    function E(e, t) {
        x(e, t, t)
    }

    function S(t, n) {
        n = e.getEvent(n);
        var r = {
            target: n.target || n.srcElement,
            type: "wheel",
            shiftKey: n.shiftKey || !1,
            clientX: n.clientX,
            clientY: n.clientY,
            pageX: n.pageX ? n.pageX : n.clientX,
            pageY: n.pageY ? n.pageY : n.clientY,
            deltaMode: n.type == "MozMousePixelScroll" ? 0 : 1,
            deltaX: 0,
            deltaZ: 0
        };
        e.MouseTracker.wheelEventName == "mousewheel" ? r.deltaY = -n.wheelDelta / e.DEFAULT_SETTINGS.pixelsPerWheelLine : r.deltaY = n.detail, x(t, r, n)
    }

    function x(t, n, r) {
        var i = 0, s;
        i = n.deltaY < 0 ? 1 : -1, t.scrollHandler && (s = t.scrollHandler({
            eventSource: t,
            pointerType: "mouse",
            position: c(n, t.element),
            scroll: i,
            shift: n.shiftKey,
            isTouchEvent: !1,
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), s === !1 && e.cancelEvent(r))
    }

    function T(e, t) {
        if (e === t) return !1;
        while (t && t !== e) t = t.parentNode;
        return t === e
    }

    function N(t, n) {
        n = e.getEvent(n), k(t, n)
    }

    function C(t, n) {
        n = e.getEvent(n);
        if (n.currentTarget === n.relatedTarget || T(n.currentTarget, n.relatedTarget)) return;
        k(t, n)
    }

    function k(t, n) {
        var r = {
            id: e.MouseTracker.mousePointerId,
            type: "mouse",
            isPrimary: !0,
            currentPos: l(n),
            currentTime: e.now()
        };
        at(t, n, [r])
    }

    function L(t, n) {
        n = e.getEvent(n), O(t, n)
    }

    function A(t, n) {
        n = e.getEvent(n);
        if (n.currentTarget === n.relatedTarget || T(n.currentTarget, n.relatedTarget)) return;
        O(t, n)
    }

    function O(t, n) {
        var r = {
            id: e.MouseTracker.mousePointerId,
            type: "mouse",
            isPrimary: !0,
            currentPos: l(n),
            currentTime: e.now()
        };
        ft(t, n, [r])
    }

    function M(t) {
        return e.Browser.vendor === e.BROWSERS.IE && e.Browser.version < 9 ? t === 1 ? 0 : t === 2 ? 2 : t === 4 ? 1 : -1 : t
    }

    function _(t, n) {
        var r;
        n = e.getEvent(n), r = {
            id: e.MouseTracker.mousePointerId,
            type: "mouse",
            isPrimary: !0,
            currentPos: l(n),
            currentTime: e.now()
        }, lt(t, n, [r], M(n.button)) && (e.stopEvent(n), u(t, "mouse")), (t.clickHandler || t.dblClickHandler || t.pressHandler || t.dragHandler || t.dragEndHandler) && e.cancelEvent(n)
    }

    function D(e, t) {
        H(e, t)
    }

    function P(t, n) {
        H(t, n), e.stopEvent(n)
    }

    function H(t, n) {
        var r;
        n = e.getEvent(n), r = {
            id: e.MouseTracker.mousePointerId,
            type: "mouse",
            isPrimary: !0,
            currentPos: l(n),
            currentTime: e.now()
        }, ct(t, n, [r], M(n.button)) && a(t, "mouse")
    }

    function B(e, t) {
        F(e, t)
    }

    function j(t, n) {
        F(t, n), e.stopEvent(n)
    }

    function F(t, n) {
        var r;
        n = e.getEvent(n), r = {
            id: e.MouseTracker.mousePointerId,
            type: "mouse",
            isPrimary: !0,
            currentPos: l(n),
            currentTime: e.now()
        }, ht(t, n, [r])
    }

    function I(e, t, n) {
        var r, i = n.getLength(), s = [];
        if (n.type === "touch" || n.contacts > 0) {
            for (r = 0; r < i; r++) s.push(n.getByIndex(r));
            s.length > 0 && (ct(e, t, s, 0), n.captureCount = 1, a(e, n.type), ft(e, t, s))
        }
    }

    function q(n, r) {
        var i, s, o, a = r.changedTouches.length, f = [], c, h = n.getActivePointersListByType("touch");
        i = e.now(), h.getLength() > r.touches.length - a && (e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."), I(n, r, h));
        for (s = 0; s < a; s++) f.push({
            id: r.changedTouches[s].identifier,
            type: "touch",
            currentPos: l(r.changedTouches[s]),
            currentTime: i
        });
        at(n, r, f);
        for (s = 0; s < t.length; s++) if (t[s] !== n && t[s].isTracking() && T(t[s].element, n.element)) {
            c = [];
            for (o = 0; o < a; o++) c.push({
                id: r.changedTouches[o].identifier,
                type: "touch",
                currentPos: l(r.changedTouches[o]),
                currentTime: i
            });
            at(t[s], r, c)
        }
        lt(n, r, f, 0) && (e.stopEvent(r), u(n, "touch", a)), e.cancelEvent(r)
    }

    function R(e, t) {
        z(e, t)
    }

    function U(t, n) {
        z(t, n), e.stopEvent(n)
    }

    function z(n, r) {
        var i, s, o, u = r.changedTouches.length, f = [], c;
        i = e.now();
        for (s = 0; s < u; s++) f.push({
            id: r.changedTouches[s].identifier,
            type: "touch",
            currentPos: l(r.changedTouches[s]),
            currentTime: i
        });
        ct(n, r, f, 0) && a(n, "touch", u), ft(n, r, f);
        for (s = 0; s < t.length; s++) if (t[s] !== n && t[s].isTracking() && T(t[s].element, n.element)) {
            c = [];
            for (o = 0; o < u; o++) c.push({
                id: r.changedTouches[o].identifier,
                type: "touch",
                currentPos: l(r.changedTouches[o]),
                currentTime: i
            });
            ft(t[s], r, c)
        }
        e.cancelEvent(r)
    }

    function W(e, t) {
        V(e, t)
    }

    function X(t, n) {
        V(t, n), e.stopEvent(n)
    }

    function V(t, n) {
        var r, i = n.changedTouches.length, s = [];
        for (r = 0; r < i; r++) s.push({
            id: n.changedTouches[r].identifier,
            type: "touch",
            currentPos: l(n.changedTouches[r]),
            currentTime: e.now()
        });
        ht(t, n, s), e.cancelEvent(n)
    }

    function $(e, t) {
        var n = e.getActivePointersListByType("touch");
        I(e, t, n)
    }

    function J(e, t) {
        return t.stopPropagation(), t.preventDefault(), !1
    }

    function K(e, t) {
        return t.stopPropagation(), t.preventDefault(), !1
    }

    function Q(t, n) {
        var r;
        if (n.currentTarget === n.relatedTarget || T(n.currentTarget, n.relatedTarget)) return;
        r = {id: n.pointerId, type: f(n), isPrimary: n.isPrimary, currentPos: l(n), currentTime: e.now()}, at(t, n, [r])
    }

    function G(t, n) {
        var r;
        if (n.currentTarget === n.relatedTarget || T(n.currentTarget, n.relatedTarget)) return;
        r = {id: n.pointerId, type: f(n), isPrimary: n.isPrimary, currentPos: l(n), currentTime: e.now()}, ft(t, n, [r])
    }

    function Y(t, n) {
        var r;
        r = {
            id: n.pointerId,
            type: f(n),
            isPrimary: n.isPrimary,
            currentPos: l(n),
            currentTime: e.now()
        }, lt(t, n, [r], n.button) && (e.stopEvent(n), u(t, r.type)), (t.clickHandler || t.dblClickHandler || t.pressHandler || t.dragHandler || t.dragEndHandler || t.pinchHandler) && e.cancelEvent(n)
    }

    function Z(e, t) {
        tt(e, t)
    }

    function et(t, n) {
        var r = t.getActivePointersListByType(f(n));
        r.getById(n.pointerId) && tt(t, n), e.stopEvent(n)
    }

    function tt(t, n) {
        var r;
        r = {
            id: n.pointerId,
            type: f(n),
            isPrimary: n.isPrimary,
            currentPos: l(n),
            currentTime: e.now()
        }, ct(t, n, [r], n.button) && a(t, r.type)
    }

    function nt(e, t) {
        it(e, t)
    }

    function rt(t, n) {
        var r = t.getActivePointersListByType(f(n));
        r.getById(n.pointerId) && it(t, n), e.stopEvent(n)
    }

    function it(t, n) {
        var r;
        r = {id: n.pointerId, type: f(n), isPrimary: n.isPrimary, currentPos: l(n), currentTime: e.now()}, ht(t, n, [r])
    }

    function st(e, t) {
        var n;
        n = {id: t.pointerId, type: f(t)}, pt(e, t, [n])
    }

    function ot(e, t) {
        return t.hasOwnProperty("isPrimary") || (e.getLength() === 0 ? t.isPrimary = !0 : t.isPrimary = !1), t.speed = 0, t.direction = 0, t.contactPos = t.currentPos, t.contactTime = t.currentTime, t.lastPos = t.currentPos, t.lastTime = t.currentTime, e.add(t)
    }

    function ut(e, t) {
        var n, r;
        return e.getById(t.id) ? (n = e.removeById(t.id), t.hasOwnProperty("isPrimary") || (r = e.getPrimary(), r || (r = e.getByIndex(0), r && (r.isPrimary = !0)))) : n = e.getLength(), n
    }

    function at(t, n, r) {
        var i = t.getActivePointersListByType(r[0].type), s, o = r.length, u, a, f;
        for (s = 0; s < o; s++) u = r[s], a = i.getById(u.id), a ? (a.insideElement = !0, a.lastPos = a.currentPos, a.lastTime = a.currentTime, a.currentPos = u.currentPos, a.currentTime = u.currentTime, u = a) : (u.captured = !1, u.insideElementPressed = !1, u.insideElement = !0, ot(i, u)), t.enterHandler && (f = t.enterHandler({
            eventSource: t,
            pointerType: u.type,
            position: h(u.currentPos, t.element),
            buttons: i.buttons,
            pointers: t.getActivePointerCount(),
            insideElementPressed: u.insideElementPressed,
            buttonDownAny: i.buttons !== 0,
            isTouchEvent: u.type === "touch",
            originalEvent: n,
            preventDefaultAction: !1,
            userData: t.userData
        }), f === !1 && e.cancelEvent(n))
    }

    function ft(t, n, r) {
        var i = t.getActivePointersListByType(r[0].type), s, o = r.length, u, a, f;
        for (s = 0; s < o; s++) u = r[s], a = i.getById(u.id), a && (a.captured ? (a.insideElement = !1, a.lastPos = a.currentPos, a.lastTime = a.currentTime, a.currentPos = u.currentPos, a.currentTime = u.currentTime) : ut(i, a), u = a), t.exitHandler && (f = t.exitHandler({
            eventSource: t,
            pointerType: u.type,
            position: h(u.currentPos, t.element),
            buttons: i.buttons,
            pointers: t.getActivePointerCount(),
            insideElementPressed: a ? a.insideElementPressed : !1,
            buttonDownAny: i.buttons !== 0,
            isTouchEvent: u.type === "touch",
            originalEvent: n,
            preventDefaultAction: !1,
            userData: t.userData
        }), f === !1 && e.cancelEvent(n))
    }

    function lt(t, r, i, s) {
        var o = n[t.hash], u, a = t.getActivePointersListByType(i[0].type), f, l = i.length, c, d;
        typeof r.buttons != "undefined" ? a.buttons = r.buttons : e.Browser.vendor === e.BROWSERS.IE && e.Browser.version < 9 ? s === 0 ? a.buttons += 1 : s === 1 ? a.buttons += 4 : s === 2 ? a.buttons += 2 : s === 3 ? a.buttons += 8 : s === 4 ? a.buttons += 16 : s === 5 && (a.buttons += 32) : s === 0 ? a.buttons |= 1 : s === 1 ? a.buttons |= 4 : s === 2 ? a.buttons |= 2 : s === 3 ? a.buttons |= 8 : s === 4 ? a.buttons |= 16 : s === 5 && (a.buttons |= 32);
        var v = t.getActivePointersListsExceptType(i[0].type);
        for (f = 0; f < v.length; f++) I(t, r, v[f]);
        if (s !== 0) return t.nonPrimaryPressHandler && (u = t.nonPrimaryPressHandler({
            eventSource: t,
            pointerType: i[0].type,
            position: h(i[0].currentPos, t.element),
            button: s,
            buttons: a.buttons,
            isTouchEvent: i[0].type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), u === !1 && e.cancelEvent(r)), !1;
        for (f = 0; f < l; f++) c = i[f], d = a.getById(c.id), d ? (d.captured = !0, d.insideElementPressed = !0, d.insideElement = !0, d.contactPos = c.currentPos, d.contactTime = c.currentTime, d.lastPos = d.currentPos, d.lastTime = d.currentTime, d.currentPos = c.currentPos, d.currentTime = c.currentTime, c = d) : (c.captured = !0, c.insideElementPressed = !0, c.insideElement = !0, ot(a, c)), a.addContact(), (t.dragHandler || t.dragEndHandler || t.pinchHandler) && e.MouseTracker.gesturePointVelocityTracker.addPoint(t, c), a.contacts === 1 ? t.pressHandler && (u = t.pressHandler({
            eventSource: t,
            pointerType: c.type,
            position: h(c.contactPos, t.element),
            buttons: a.buttons,
            isTouchEvent: c.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), u === !1 && e.cancelEvent(r)) : a.contacts === 2 && t.pinchHandler && c.type === "touch" && (o.pinchGPoints = a.asArray(), o.lastPinchDist = o.currentPinchDist = o.pinchGPoints[0].currentPos.distanceTo(o.pinchGPoints[1].currentPos), o.lastPinchCenter = o.currentPinchCenter = p(o.pinchGPoints[0].currentPos, o.pinchGPoints[1].currentPos));
        return !0
    }

    function ct(t, r, i, s) {
        var o = n[t.hash], u = t.getActivePointersListByType(i[0].type), a, f, l, c, d = i.length, v, m, g = !1, y = !1,
            b;
        typeof r.buttons != "undefined" ? u.buttons = r.buttons : e.Browser.vendor === e.BROWSERS.IE && e.Browser.version < 9 ? s === 0 ? u.buttons -= 1 : s === 1 ? u.buttons -= 4 : s === 2 ? u.buttons -= 2 : s === 3 ? u.buttons -= 8 : s === 4 ? u.buttons -= 16 : s === 5 && (u.buttons -= 32) : s === 0 ? u.buttons ^= -2 : s === 1 ? u.buttons ^= -5 : s === 2 ? u.buttons ^= -3 : s === 3 ? u.buttons ^= -9 : s === 4 ? u.buttons ^= -17 : s === 5 && (u.buttons ^= -33);
        if (s !== 0) {
            t.nonPrimaryReleaseHandler && (a = t.nonPrimaryReleaseHandler({
                eventSource: t,
                pointerType: i[0].type,
                position: h(i[0].currentPos, t.element),
                button: s,
                buttons: u.buttons,
                isTouchEvent: i[0].type === "touch",
                originalEvent: r,
                preventDefaultAction: !1,
                userData: t.userData
            }), a === !1 && e.cancelEvent(r));
            var w = t.getActivePointersListByType("mouse");
            return I(t, r, w), !1
        }
        for (c = 0; c < d; c++) v = i[c], m = u.getById(v.id), m && (m.captured && (m.captured = !1, g = !0, y = !0), m.lastPos = m.currentPos, m.lastTime = m.currentTime, m.currentPos = v.currentPos, m.currentTime = v.currentTime, m.insideElement || ut(u, m), f = m.currentPos, l = m.currentTime, y ? (u.removeContact(), (t.dragHandler || t.dragEndHandler || t.pinchHandler) && e.MouseTracker.gesturePointVelocityTracker.removePoint(t, m), u.contacts === 0 ? (t.releaseHandler && (a = t.releaseHandler({
            eventSource: t,
            pointerType: m.type,
            position: h(f, t.element),
            buttons: u.buttons,
            insideElementPressed: m.insideElementPressed,
            insideElementReleased: m.insideElement,
            isTouchEvent: m.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), a === !1 && e.cancelEvent(r)), t.dragEndHandler && !m.currentPos.equals(m.contactPos) && (a = t.dragEndHandler({
            eventSource: t,
            pointerType: m.type,
            position: h(m.currentPos, t.element),
            speed: m.speed,
            direction: m.direction,
            shift: r.shiftKey,
            isTouchEvent: m.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), a === !1 && e.cancelEvent(r)), (t.clickHandler || t.dblClickHandler) && m.insideElement && (b = l - m.contactTime <= t.clickTimeThreshold && m.contactPos.distanceTo(f) <= t.clickDistThreshold, t.clickHandler && (a = t.clickHandler({
            eventSource: t,
            pointerType: m.type,
            position: h(m.currentPos, t.element),
            quick: b,
            shift: r.shiftKey,
            isTouchEvent: m.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), a === !1 && e.cancelEvent(r)), t.dblClickHandler && b && (u.clicks++, u.clicks === 1 ? (o.lastClickPos = f, o.dblClickTimeOut = setTimeout(function () {
            u.clicks = 0
        }, t.dblClickTimeThreshold)) : u.clicks === 2 && (clearTimeout(o.dblClickTimeOut), u.clicks = 0, o.lastClickPos.distanceTo(f) <= t.dblClickDistThreshold && (a = t.dblClickHandler({
            eventSource: t,
            pointerType: m.type,
            position: h(m.currentPos, t.element),
            shift: r.shiftKey,
            isTouchEvent: m.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), a === !1 && e.cancelEvent(r)), o.lastClickPos = null)))) : u.contacts === 2 && t.pinchHandler && m.type === "touch" && (o.pinchGPoints = u.asArray(), o.lastPinchDist = o.currentPinchDist = o.pinchGPoints[0].currentPos.distanceTo(o.pinchGPoints[1].currentPos), o.lastPinchCenter = o.currentPinchCenter = p(o.pinchGPoints[0].currentPos, o.pinchGPoints[1].currentPos))) : t.releaseHandler && (a = t.releaseHandler({
            eventSource: t,
            pointerType: m.type,
            position: h(f, t.element),
            buttons: u.buttons,
            insideElementPressed: m.insideElementPressed,
            insideElementReleased: m.insideElement,
            isTouchEvent: m.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), a === !1 && e.cancelEvent(r)));
        return g
    }

    function ht(t, r, i) {
        var s = n[t.hash], o = t.getActivePointersListByType(i[0].type), u, a = i.length, f, l, c, d, v;
        typeof r.buttons != "undefined" && (o.buttons = r.buttons);
        for (u = 0; u < a; u++) f = i[u], l = o.getById(f.id), l ? (f.hasOwnProperty("isPrimary") && (l.isPrimary = f.isPrimary), l.lastPos = l.currentPos, l.lastTime = l.currentTime, l.currentPos = f.currentPos, l.currentTime = f.currentTime) : (f.captured = !1, f.insideElementPressed = !1, f.insideElement = !0, ot(o, f));
        t.stopHandler && i[0].type === "mouse" && (clearTimeout(t.stopTimeOut), t.stopTimeOut = setTimeout(function () {
            dt(t, r, i[0].type)
        }, t.stopDelay)), o.contacts === 0 ? t.moveHandler && (v = t.moveHandler({
            eventSource: t,
            pointerType: i[0].type,
            position: h(i[0].currentPos, t.element),
            buttons: o.buttons,
            isTouchEvent: i[0].type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), v === !1 && e.cancelEvent(r)) : o.contacts === 1 ? (t.moveHandler && (l = o.asArray()[0], v = t.moveHandler({
            eventSource: t,
            pointerType: l.type,
            position: h(l.currentPos, t.element),
            buttons: o.buttons,
            isTouchEvent: l.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), v === !1 && e.cancelEvent(r)), t.dragHandler && (l = o.asArray()[0], d = l.currentPos.minus(l.lastPos), v = t.dragHandler({
            eventSource: t,
            pointerType: l.type,
            position: h(l.currentPos, t.element),
            buttons: o.buttons,
            delta: d,
            speed: l.speed,
            direction: l.direction,
            shift: r.shiftKey,
            isTouchEvent: l.type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), v === !1 && e.cancelEvent(r))) : o.contacts === 2 && (t.moveHandler && (c = o.asArray(), v = t.moveHandler({
            eventSource: t,
            pointerType: c[0].type,
            position: h(p(c[0].currentPos, c[1].currentPos), t.element),
            buttons: o.buttons,
            isTouchEvent: c[0].type === "touch",
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), v === !1 && e.cancelEvent(r)), t.pinchHandler && i[0].type === "touch" && (d = s.pinchGPoints[0].currentPos.distanceTo(s.pinchGPoints[1].currentPos), d != s.currentPinchDist && (s.lastPinchDist = s.currentPinchDist, s.currentPinchDist = d, s.lastPinchCenter = s.currentPinchCenter, s.currentPinchCenter = p(s.pinchGPoints[0].currentPos, s.pinchGPoints[1].currentPos), v = t.pinchHandler({
            eventSource: t,
            pointerType: "touch",
            gesturePoints: s.pinchGPoints,
            lastCenter: h(s.lastPinchCenter, t.element),
            center: h(s.currentPinchCenter, t.element),
            lastDistance: s.lastPinchDist,
            distance: s.currentPinchDist,
            shift: r.shiftKey,
            originalEvent: r,
            preventDefaultAction: !1,
            userData: t.userData
        }), v === !1 && e.cancelEvent(r))))
    }

    function pt(e, t, n) {
        ct(e, t, n, 0), ft(e, t, n)
    }

    function dt(e, t, n) {
        e.stopHandler && e.stopHandler({
            eventSource: e,
            pointerType: n,
            position: c(t, e.element),
            buttons: e.getActivePointersListByType(n).buttons,
            isTouchEvent: n === "touch",
            originalEvent: t,
            preventDefaultAction: !1,
            userData: e.userData
        })
    }

    function mt(e) {
        try {
            return e.addEventListener && e.removeEventListener
        } catch (t) {
            return !1
        }
    }

    var t = [], n = {};
    e.MouseTracker = function (r) {
        t.push(this);
        var i = arguments;
        e.isPlainObject(r) || (r = {
            element: i[0],
            clickTimeThreshold: i[1],
            clickDistThreshold: i[2]
        }), this.hash = Math.random(), this.element = e.getElement(r.element), this.clickTimeThreshold = r.clickTimeThreshold || e.DEFAULT_SETTINGS.clickTimeThreshold, this.clickDistThreshold = r.clickDistThreshold || e.DEFAULT_SETTINGS.clickDistThreshold, this.dblClickTimeThreshold = r.dblClickTimeThreshold || e.DEFAULT_SETTINGS.dblClickTimeThreshold, this.dblClickDistThreshold = r.dblClickDistThreshold || e.DEFAULT_SETTINGS.dblClickDistThreshold, this.userData = r.userData || null, this.stopDelay = r.stopDelay || 50, this.enterHandler = r.enterHandler || null, this.exitHandler = r.exitHandler || null, this.pressHandler = r.pressHandler || null, this.nonPrimaryPressHandler = r.nonPrimaryPressHandler || null, this.releaseHandler = r.releaseHandler || null, this.nonPrimaryReleaseHandler = r.nonPrimaryReleaseHandler || null, this.moveHandler = r.moveHandler || null, this.scrollHandler = r.scrollHandler || null, this.clickHandler = r.clickHandler || null, this.dblClickHandler = r.dblClickHandler || null, this.dragHandler = r.dragHandler || null, this.dragEndHandler = r.dragEndHandler || null, this.pinchHandler = r.pinchHandler || null, this.stopHandler = r.stopHandler || null, this.keyDownHandler = r.keyDownHandler || null, this.keyUpHandler = r.keyUpHandler || null, this.keyHandler = r.keyHandler || null, this.focusHandler = r.focusHandler || null, this.blurHandler = r.blurHandler || null;
        var s = this;
        n[this.hash] = {
            click: function (e) {
                d(s, e)
            },
            dblclick: function (e) {
                v(s, e)
            },
            keydown: function (e) {
                m(s, e)
            },
            keyup: function (e) {
                g(s, e)
            },
            keypress: function (e) {
                y(s, e)
            },
            focus: function (e) {
                b(s, e)
            },
            blur: function (e) {
                w(s, e)
            },
            wheel: function (e) {
                E(s, e)
            },
            mousewheel: function (e) {
                S(s, e)
            },
            DOMMouseScroll: function (e) {
                S(s, e)
            },
            MozMousePixelScroll: function (e) {
                S(s, e)
            },
            mouseenter: function (e) {
                N(s, e)
            },
            mouseleave: function (e) {
                L(s, e)
            },
            mouseover: function (e) {
                C(s, e)
            },
            mouseout: function (e) {
                A(s, e)
            },
            mousedown: function (e) {
                _(s, e)
            },
            mouseup: function (e) {
                D(s, e)
            },
            mouseupcaptured: function (e) {
                P(s, e)
            },
            mousemove: function (e) {
                B(s, e)
            },
            mousemovecaptured: function (e) {
                j(s, e)
            },
            touchstart: function (e) {
                q(s, e)
            },
            touchend: function (e) {
                R(s, e)
            },
            touchendcaptured: function (e) {
                U(s, e)
            },
            touchmove: function (e) {
                W(s, e)
            },
            touchmovecaptured: function (e) {
                X(s, e)
            },
            touchcancel: function (e) {
                $(s, e)
            },
            gesturestart: function (e) {
                J(s, e)
            },
            gesturechange: function (e) {
                K(s, e)
            },
            pointerover: function (e) {
                Q(s, e)
            },
            MSPointerOver: function (e) {
                Q(s, e)
            },
            pointerout: function (e) {
                G(s, e)
            },
            MSPointerOut: function (e) {
                G(s, e)
            },
            pointerdown: function (e) {
                Y(s, e)
            },
            MSPointerDown: function (e) {
                Y(s, e)
            },
            pointerup: function (e) {
                Z(s, e)
            },
            MSPointerUp: function (e) {
                Z(s, e)
            },
            pointermove: function (e) {
                nt(s, e)
            },
            MSPointerMove: function (e) {
                nt(s, e)
            },
            pointercancel: function (e) {
                st(s, e)
            },
            MSPointerCancel: function (e) {
                st(s, e)
            },
            pointerupcaptured: function (e) {
                et(s, e)
            },
            pointermovecaptured: function (e) {
                rt(s, e)
            },
            tracking: !1,
            activePointersLists: [],
            lastClickPos: null,
            dblClickTimeOut: null,
            pinchGPoints: [],
            lastPinchDist: 0,
            currentPinchDist: 0,
            lastPinchCenter: null,
            currentPinchCenter: null
        }, r.startDisabled || this.setTracking(!0)
    }, e.MouseTracker.prototype = {
        destroy: function () {
            var e;
            s(this), this.element = null;
            for (e = 0; e < t.length; e++) if (t[e] === this) {
                t.splice(e, 1);
                break
            }
            n[this.hash] = null, delete n[this.hash]
        }, isTracking: function () {
            return n[this.hash].tracking
        }, setTracking: function (e) {
            return e ? i(this) : s(this), this
        }, getActivePointersListsExceptType: function (e) {
            var t = n[this.hash], r = [];
            for (var i = 0; i < t.activePointersLists.length; ++i) t.activePointersLists[i].type !== e && r.push(t.activePointersLists[i]);
            return r
        }, getActivePointersListByType: function (t) {
            var r = n[this.hash], i, s = r.activePointersLists.length, o;
            for (i = 0; i < s; i++) if (r.activePointersLists[i].type === t) return r.activePointersLists[i];
            return o = new e.MouseTracker.GesturePointList(t), r.activePointersLists.push(o), o
        }, getActivePointerCount: function () {
            var e = n[this.hash], t, r = e.activePointersLists.length, i = 0;
            for (t = 0; t < r; t++) i += e.activePointersLists[t].getLength();
            return i
        }, enterHandler: function () {
        }, exitHandler: function () {
        }, pressHandler: function () {
        }, nonPrimaryPressHandler: function () {
        }, releaseHandler: function () {
        }, nonPrimaryReleaseHandler: function () {
        }, moveHandler: function () {
        }, scrollHandler: function () {
        }, clickHandler: function () {
        }, dblClickHandler: function () {
        }, dragHandler: function () {
        }, dragEndHandler: function () {
        }, pinchHandler: function () {
        }, stopHandler: function () {
        }, keyDownHandler: function () {
        }, keyUpHandler: function () {
        }, keyHandler: function () {
        }, focusHandler: function () {
        }, blurHandler: function () {
        }
    }, e.MouseTracker.resetAllMouseTrackers = function () {
        for (var e = 0; e < t.length; e++) t[e].isTracking() && (t[e].setTracking(!1), t[e].setTracking(!0))
    }, e.MouseTracker.gesturePointVelocityTracker = function () {
        var t = [], n = 0, r = 0, i = function (e, t) {
            return e.hash.toString() + t.type + t.id.toString()
        }, s = function () {
            var n, i = t.length, s, o, u = e.now(), a, f, l;
            a = u - r, r = u;
            for (n = 0; n < i; n++) s = t[n], o = s.gPoint, o.direction = Math.atan2(o.currentPos.y - s.lastPos.y, o.currentPos.x - s.lastPos.x), f = s.lastPos.distanceTo(o.currentPos), s.lastPos = o.currentPos, l = 1e3 * f / (a + 1), o.speed = .75 * l + .25 * o.speed
        }, o = function (o, u) {
            var a = i(o, u);
            t.push({
                guid: a,
                gPoint: u,
                lastPos: u.currentPos
            }), t.length === 1 && (r = e.now(), n = window.setInterval(s, 50))
        }, u = function (e, r) {
            var s = i(e, r), o, u = t.length;
            for (o = 0; o < u; o++) if (t[o].guid === s) {
                t.splice(o, 1), u--, u === 0 && window.clearInterval(n);
                break
            }
        };
        return {addPoint: o, removePoint: u}
    }(), e.MouseTracker.captureElement = document, e.MouseTracker.wheelEventName = e.Browser.vendor == e.BROWSERS.IE && e.Browser.version > 8 || "onwheel" in document.createElement("div") ? "wheel" : document.onmousewheel !== undefined ? "mousewheel" : "DOMMouseScroll", e.MouseTracker.supportsMouseCapture = function () {
        var t = document.createElement("div");
        return e.isFunction(t.setCapture) && e.isFunction(t.releaseCapture)
    }(), e.MouseTracker.subscribeEvents = ["click", "dblclick", "keydown", "keyup", "keypress", "focus", "blur", e.MouseTracker.wheelEventName], e.MouseTracker.wheelEventName == "DOMMouseScroll" && e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"), window.PointerEvent && (window.navigator.pointerEnabled || e.Browser.vendor !== e.BROWSERS.IE) ? (e.MouseTracker.havePointerEvents = !0, e.MouseTracker.subscribeEvents.push("pointerover", "pointerout", "pointerdown", "pointerup", "pointermove", "pointercancel"), e.MouseTracker.unprefixedPointerEvents = !0, navigator.maxTouchPoints ? e.MouseTracker.maxTouchPoints = navigator.maxTouchPoints : e.MouseTracker.maxTouchPoints = 0, e.MouseTracker.haveMouseEnter = !1) : window.MSPointerEvent && window.navigator.msPointerEnabled ? (e.MouseTracker.havePointerEvents = !0, e.MouseTracker.subscribeEvents.push("MSPointerOver", "MSPointerOut", "MSPointerDown", "MSPointerUp", "MSPointerMove", "MSPointerCancel"), e.MouseTracker.unprefixedPointerEvents = !1, navigator.msMaxTouchPoints ? e.MouseTracker.maxTouchPoints = navigator.msMaxTouchPoints : e.MouseTracker.maxTouchPoints = 0, e.MouseTracker.haveMouseEnter = !1) : (e.MouseTracker.havePointerEvents = !1, e.Browser.vendor === e.BROWSERS.IE && e.Browser.version < 9 ? (e.MouseTracker.subscribeEvents.push("mouseenter", "mouseleave"), e.MouseTracker.haveMouseEnter = !0) : (e.MouseTracker.subscribeEvents.push("mouseover", "mouseout"), e.MouseTracker.haveMouseEnter = !1), e.MouseTracker.subscribeEvents.push("mousedown", "mouseup", "mousemove"), "ontouchstart" in window && e.MouseTracker.subscribeEvents.push("touchstart", "touchend", "touchmove", "touchcancel"), "ongesturestart" in window && e.MouseTracker.subscribeEvents.push("gesturestart", "gesturechange"), e.MouseTracker.mousePointerId = "legacy-mouse", e.MouseTracker.maxTouchPoints = 10), e.MouseTracker.GesturePointList = function (e) {
        this._gPoints = [], this.type = e, this.buttons = 0, this.contacts = 0, this.clicks = 0, this.captureCount = 0
    }, e.MouseTracker.GesturePointList.prototype = {
        getLength: function () {
            return this._gPoints.length
        }, asArray: function () {
            return this._gPoints
        }, add: function (e) {
            return this._gPoints.push(e)
        }, removeById: function (e) {
            var t, n = this._gPoints.length;
            for (t = 0; t < n; t++) if (this._gPoints[t].id === e) {
                this._gPoints.splice(t, 1);
                break
            }
            return this._gPoints.length
        }, getByIndex: function (e) {
            return e < this._gPoints.length ? this._gPoints[e] : null
        }, getById: function (e) {
            var t, n = this._gPoints.length;
            for (t = 0; t < n; t++) if (this._gPoints[t].id === e) return this._gPoints[t];
            return null
        }, getPrimary: function (e) {
            var t, n = this._gPoints.length;
            for (t = 0; t < n; t++) if (this._gPoints[t].isPrimary) return this._gPoints[t];
            return null
        }, addContact: function () {
            ++this.contacts, this.contacts > 1 && (this.type === "mouse" || this.type === "pen") && (this.contacts = 1)
        }, removeContact: function () {
            --this.contacts, this.contacts < 0 && (this.contacts = 0)
        }
    };
    var vt = function () {
        try {
            return window.self !== window.top
        } catch (e) {
            return !0
        }
    }()
}(OpenSeadragon),function (e) {
    e.ControlAnchor = {
        NONE: 0,
        TOP_LEFT: 1,
        TOP_RIGHT: 2,
        BOTTOM_RIGHT: 3,
        BOTTOM_LEFT: 4,
        ABSOLUTE: 5
    }, e.Control = function (t, n, r) {
        var i = t.parentNode;
        typeof n == "number" && (e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"), n = {anchor: n}), n.attachToViewer = typeof n.attachToViewer == "undefined" ? !0 : n.attachToViewer, this.autoFade = typeof n.autoFade == "undefined" ? !0 : n.autoFade, this.element = t, this.anchor = n.anchor, this.container = r, this.anchor == e.ControlAnchor.ABSOLUTE ? (this.wrapper = e.makeNeutralElement("div"), this.wrapper.style.position = "absolute", this.wrapper.style.top = typeof n.top == "number" ? n.top + "px" : n.top, this.wrapper.style.left = typeof n.left == "number" ? n.left + "px" : n.left, this.wrapper.style.height = typeof n.height == "number" ? n.height + "px" : n.height, this.wrapper.style.width = typeof n.width == "number" ? n.width + "px" : n.width, this.wrapper.style.margin = "0px", this.wrapper.style.padding = "0px", this.element.style.position = "relative", this.element.style.top = "0px", this.element.style.left = "0px", this.element.style.height = "100%", this.element.style.width = "100%") : (this.wrapper = e.makeNeutralElement("div"), this.wrapper.style.display = "inline-block", this.anchor == e.ControlAnchor.NONE && (this.wrapper.style.width = this.wrapper.style.height = "100%")), this.wrapper.appendChild(this.element), n.attachToViewer ? this.anchor == e.ControlAnchor.TOP_RIGHT || this.anchor == e.ControlAnchor.BOTTOM_RIGHT ? this.container.insertBefore(this.wrapper, this.container.firstChild) : this.container.appendChild(this.wrapper) : i.appendChild(this.wrapper)
    }, e.Control.prototype = {
        destroy: function () {
            this.wrapper.removeChild(this.element), this.container.removeChild(this.wrapper)
        }, isVisible: function () {
            return this.wrapper.style.display != "none"
        }, setVisible: function (t) {
            this.wrapper.style.display = t ? this.anchor == e.ControlAnchor.ABSOLUTE ? "block" : "inline-block" : "none"
        }, setOpacity: function (t) {
            this.element[e.SIGNAL] && e.Browser.vendor == e.BROWSERS.IE ? e.setElementOpacity(this.element, t, !0) : e.setElementOpacity(this.wrapper, t, !0)
        }
    }
}(OpenSeadragon),function (e) {
    function t(e, t) {
        var n = e.controls, r;
        for (r = n.length - 1; r >= 0; r--) if (n[r].element == t) return r;
        return -1
    }

    e.ControlDock = function (t) {
        var n = ["topleft", "topright", "bottomright", "bottomleft"], r, i;
        e.extend(!0, this, {
            id: "controldock-" + e.now() + "-" + Math.floor(Math.random() * 1e6),
            container: e.makeNeutralElement("div"),
            controls: []
        }, t), this.container.onsubmit = function () {
            return !1
        }, this.element && (this.element = e.getElement(this.element), this.element.appendChild(this.container), this.element.style.position = "relative", this.container.style.width = "100%", this.container.style.height = "100%");
        for (i = 0; i < n.length; i++) r = n[i], this.controls[r] = e.makeNeutralElement("div"), this.controls[r].style.position = "absolute", r.match("left") && (this.controls[r].style.left = "0px"), r.match("right") && (this.controls[r].style.right = "0px"), r.match("top") && (this.controls[r].style.top = "0px"), r.match("bottom") && (this.controls[r].style.bottom = "0px");
        this.container.appendChild(this.controls.topleft), this.container.appendChild(this.controls.topright), this.container.appendChild(this.controls.bottomright), this.container.appendChild(this.controls.bottomleft)
    }, e.ControlDock.prototype = {
        addControl: function (n, r) {
            n = e.getElement(n);
            var i = null;
            if (t(this, n) >= 0) return;
            switch (r.anchor) {
                case e.ControlAnchor.TOP_RIGHT:
                    i = this.controls.topright, n.style.position = "relative", n.style.paddingRight = "0px", n.style.paddingTop = "0px";
                    break;
                case e.ControlAnchor.BOTTOM_RIGHT:
                    i = this.controls.bottomright, n.style.position = "relative", n.style.paddingRight = "0px", n.style.paddingBottom = "0px";
                    break;
                case e.ControlAnchor.BOTTOM_LEFT:
                    i = this.controls.bottomleft, n.style.position = "relative", n.style.paddingLeft = "0px", n.style.paddingBottom = "0px";
                    break;
                case e.ControlAnchor.TOP_LEFT:
                    i = this.controls.topleft, n.style.position = "relative", n.style.paddingLeft = "0px", n.style.paddingTop = "0px";
                    break;
                case e.ControlAnchor.ABSOLUTE:
                    i = this.container, n.style.margin = "0px", n.style.padding = "0px";
                    break;
                default:
                case e.ControlAnchor.NONE:
                    i = this.container, n.style.margin = "0px", n.style.padding = "0px"
            }
            this.controls.push(new e.Control(n, r, i)), n.style.display = "inline-block"
        }, removeControl: function (n) {
            n = e.getElement(n);
            var r = t(this, n);
            return r >= 0 && (this.controls[r].destroy(), this.controls.splice(r, 1)), this
        }, clearControls: function () {
            while (this.controls.length > 0) this.controls.pop().destroy();
            return this
        }, areControlsEnabled: function () {
            var e;
            for (e = this.controls.length - 1; e >= 0; e--) if (this.controls[e].isVisible()) return !0;
            return !1
        }, setControlsEnabled: function (e) {
            var t;
            for (t = this.controls.length - 1; t >= 0; t--) this.controls[t].setVisible(e);
            return this
        }
    }
}(OpenSeadragon),function (e) {
    e.Placement = e.freezeObject({
        CENTER: 0,
        TOP_LEFT: 1,
        TOP: 2,
        TOP_RIGHT: 3,
        RIGHT: 4,
        BOTTOM_RIGHT: 5,
        BOTTOM: 6,
        BOTTOM_LEFT: 7,
        LEFT: 8,
        properties: {
            0: {
                isLeft: !1,
                isHorizontallyCentered: !0,
                isRight: !1,
                isTop: !1,
                isVerticallyCentered: !0,
                isBottom: !1
            },
            1: {isLeft: !0, isHorizontallyCentered: !1, isRight: !1, isTop: !0, isVerticallyCentered: !1, isBottom: !1},
            2: {isLeft: !1, isHorizontallyCentered: !0, isRight: !1, isTop: !0, isVerticallyCentered: !1, isBottom: !1},
            3: {isLeft: !1, isHorizontallyCentered: !1, isRight: !0, isTop: !0, isVerticallyCentered: !1, isBottom: !1},
            4: {isLeft: !1, isHorizontallyCentered: !1, isRight: !0, isTop: !1, isVerticallyCentered: !0, isBottom: !1},
            5: {isLeft: !1, isHorizontallyCentered: !1, isRight: !0, isTop: !1, isVerticallyCentered: !1, isBottom: !0},
            6: {isLeft: !1, isHorizontallyCentered: !0, isRight: !1, isTop: !1, isVerticallyCentered: !1, isBottom: !0},
            7: {isLeft: !0, isHorizontallyCentered: !1, isRight: !1, isTop: !1, isVerticallyCentered: !1, isBottom: !0},
            8: {isLeft: !0, isHorizontallyCentered: !1, isRight: !1, isTop: !1, isVerticallyCentered: !0, isBottom: !1}
        }
    })
}(OpenSeadragon),function (e) {
    function r(t) {
        return t = e.getElement(t), new e.Point(t.clientWidth === 0 ? 1 : t.clientWidth, t.clientHeight === 0 ? 1 : t.clientHeight)
    }

    function i(t, n, r, i, s) {
        function f(e, t) {
            e.ready ? i(e) : (e.addHandler("ready", function () {
                i(e)
            }), e.addHandler("open-failed", function (e) {
                s({message: e.message, source: t})
            }))
        }

        var o = t;
        if (e.type(n) == "string") if (n.match(/^\s*<.*>\s*$/)) n = e.parseXml(n); else if (n.match(/^\s*[\{\[].*[\}\]]\s*$/)) try {
            var u = e.parseJSON(n);
            n = u
        } catch (a) {
        }
        setTimeout(function () {
            if (e.type(n) == "string") n = new e.TileSource({
                url: n,
                crossOriginPolicy: r.crossOriginPolicy !== undefined ? r.crossOriginPolicy : t.crossOriginPolicy,
                ajaxWithCredentials: t.ajaxWithCredentials,
                ajaxHeaders: t.ajaxHeaders,
                useCanvas: t.useCanvas,
                success: function (e) {
                    i(e.tileSource)
                }
            }), n.addHandler("open-failed", function (e) {
                s(e)
            }); else if (e.isPlainObject(n) || n.nodeType) {
                n.crossOriginPolicy === undefined && (r.crossOriginPolicy !== undefined || t.crossOriginPolicy !== undefined) && (n.crossOriginPolicy = r.crossOriginPolicy !== undefined ? r.crossOriginPolicy : t.crossOriginPolicy), n.ajaxWithCredentials === undefined && (n.ajaxWithCredentials = t.ajaxWithCredentials), n.useCanvas === undefined && (n.useCanvas = t.useCanvas);
                if (e.isFunction(n.getTileUrl)) {
                    var u = new e.TileSource(n);
                    u.getTileUrl = n.getTileUrl, i(u)
                } else {
                    var a = e.TileSource.determineType(o, n);
                    if (!a) {
                        s({message: "Unable to load TileSource", source: n});
                        return
                    }
                    var l = a.prototype.configure.apply(o, [n]);
                    f(new a(l), n)
                }
            } else f(n, n)
        })
    }

    function s(t, n) {
        if (n instanceof e.Overlay) return n;
        var r = null;
        if (n.element) r = e.getElement(n.element); else {
            var i = n.id ? n.id : "openseadragon-overlay-" + Math.floor(Math.random() * 1e7);
            r = e.getElement(n.id), r || (r = document.createElement("a"), r.href = "#/overlay/" + i), r.id = i, e.addClass(r, n.className ? n.className : "openseadragon-overlay")
        }
        var s = n.location, o = n.width, u = n.height;
        if (!s) {
            var a = n.x, f = n.y;
            if (n.px !== undefined) {
                var l = t.viewport.imageToViewportRectangle(new e.Rect(n.px, n.py, o || 0, u || 0));
                a = l.x, f = l.y, o = o !== undefined ? l.width : undefined, u = u !== undefined ? l.height : undefined
            }
            s = new e.Point(a, f)
        }
        var c = n.placement;
        return c && e.type(c) === "string" && (c = e.Placement[n.placement.toUpperCase()]), new e.Overlay({
            element: r,
            location: s,
            placement: c,
            onDraw: n.onDraw,
            checkResize: n.checkResize,
            width: o,
            height: u,
            rotationMode: n.rotationMode
        })
    }

    function o(e, t) {
        var n;
        for (n = e.length - 1; n >= 0; n--) if (e[n].element === t) return n;
        return -1
    }

    function u(t, n) {
        return e.requestAnimationFrame(function () {
            n(t)
        })
    }

    function a(t) {
        e.requestAnimationFrame(function () {
            l(t)
        })
    }

    function f(t) {
        if (!t.autoHideControls) return;
        t.controlsShouldFade = !0, t.controlsFadeBeginTime = e.now() + t.controlsFadeDelay, window.setTimeout(function () {
            a(t)
        }, t.controlsFadeDelay)
    }

    function l(t) {
        var n, r, i, s;
        if (t.controlsShouldFade) {
            n = e.now(), r = n - t.controlsFadeBeginTime, i = 1 - r / t.controlsFadeLength, i = Math.min(1, i), i = Math.max(0, i);
            for (s = t.controls.length - 1; s >= 0; s--) t.controls[s].autoFade && t.controls[s].setOpacity(i);
            i > 0 && a(t)
        }
    }

    function c(e) {
        var t;
        e.controlsShouldFade = !1;
        for (t = e.controls.length - 1; t >= 0; t--) e.controls[t].setOpacity(1)
    }

    function h() {
        c(this)
    }

    function p() {
        f(this)
    }

    function d(t) {
        if (!(!t.preventDefaultAction && !t.ctrl && !t.alt && !t.meta)) return !0;
        switch (t.keyCode) {
            case 38:
                return t.shift ? this.viewport.zoomBy(1.1) : this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0, -40))), this.viewport.applyConstraints(), !1;
            case 40:
                return t.shift ? this.viewport.zoomBy(.9) : this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0, 40))), this.viewport.applyConstraints(), !1;
            case 37:
                return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40, 0))), this.viewport.applyConstraints(), !1;
            case 39:
                return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40, 0))), this.viewport.applyConstraints(), !1;
            default:
                return !0
        }
    }

    function v(t) {
        if (!(!t.preventDefaultAction && !t.ctrl && !t.alt && !t.meta)) return !0;
        switch (t.keyCode) {
            case 43:
            case 61:
                return this.viewport.zoomBy(1.1), this.viewport.applyConstraints(), !1;
            case 45:
                return this.viewport.zoomBy(.9), this.viewport.applyConstraints(), !1;
            case 48:
                return this.viewport.goHome(), this.viewport.applyConstraints(), !1;
            case 119:
            case 87:
                return t.shift ? this.viewport.zoomBy(1.1) : this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0, -40))), this.viewport.applyConstraints(), !1;
            case 115:
            case 83:
                return t.shift ? this.viewport.zoomBy(.9) : this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0, 40))), this.viewport.applyConstraints(), !1;
            case 97:
                return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40, 0))), this.viewport.applyConstraints(), !1;
            case 100:
                return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40, 0))), this.viewport.applyConstraints(), !1;
            default:
                return !0
        }
    }

    function m(e) {
        var t, n = document.activeElement == this.canvas;
        n || this.canvas.focus();
        var r = {
            tracker: e.eventSource,
            position: e.position,
            quick: e.quick,
            shift: e.shift,
            originalEvent: e.originalEvent,
            preventDefaultAction: e.preventDefaultAction
        };
        this.raiseEvent("canvas-click", r), !r.preventDefaultAction && this.viewport && e.quick && (t = this.gestureSettingsByDeviceType(e.pointerType), t.clickToZoom && (this.viewport.zoomBy(e.shift ? 1 / this.zoomPerClick : this.zoomPerClick, this.viewport.pointFromPixel(e.position, !0)), this.viewport.applyConstraints()))
    }

    function g(e) {
        var t;
        !e.preventDefaultAction && this.viewport && (t = this.gestureSettingsByDeviceType(e.pointerType), t.dblClickToZoom && (this.viewport.zoomBy(e.shift ? 1 / this.zoomPerClick : this.zoomPerClick, this.viewport.pointFromPixel(e.position, !0)), this.viewport.applyConstraints())), this.raiseEvent("canvas-double-click", {
            tracker: e.eventSource,
            position: e.position,
            shift: e.shift,
            originalEvent: e.originalEvent
        })
    }

    function y(e) {
        var t, n = {
            tracker: e.eventSource,
            position: e.position,
            delta: e.delta,
            speed: e.speed,
            direction: e.direction,
            shift: e.shift,
            originalEvent: e.originalEvent,
            preventDefaultAction: e.preventDefaultAction
        };
        this.raiseEvent("canvas-drag", n);
        if (!n.preventDefaultAction && this.viewport) {
            t = this.gestureSettingsByDeviceType(e.pointerType), this.panHorizontal || (e.delta.x = 0), this.panVertical || (e.delta.y = 0);
            if (this.constrainDuringPan) {
                var r = this.viewport.deltaPointsFromPixels(e.delta.negate());
                this.viewport.centerSpringX.target.value += r.x, this.viewport.centerSpringY.target.value += r.y;
                var i = this.viewport.getBounds(), s = this.viewport.getConstrainedBounds();
                this.viewport.centerSpringX.target.value -= r.x, this.viewport.centerSpringY.target.value -= r.y, i.x != s.x && (e.delta.x = 0), i.y != s.y && (e.delta.y = 0)
            }
            this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()), t.flickEnabled && !this.constrainDuringPan)
        }
    }

    function b(t) {
        if (!t.preventDefaultAction && this.viewport) {
            var n = this.gestureSettingsByDeviceType(t.pointerType);
            if (n.flickEnabled && t.speed >= n.flickMinSpeed) {
                var r = 0;
                this.panHorizontal && (r = n.flickMomentum * t.speed * Math.cos(t.direction));
                var i = 0;
                this.panVertical && (i = n.flickMomentum * t.speed * Math.sin(t.direction));
                var s = this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),
                    o = this.viewport.pointFromPixel(new e.Point(s.x - r, s.y - i));
                this.viewport.panTo(o, !1)
            }
            this.viewport.applyConstraints()
        }
        this.raiseEvent("canvas-drag-end", {
            tracker: t.eventSource,
            position: t.position,
            speed: t.speed,
            direction: t.direction,
            shift: t.shift,
            originalEvent: t.originalEvent
        })
    }

    function w(e) {
        this.raiseEvent("canvas-enter", {
            tracker: e.eventSource,
            pointerType: e.pointerType,
            position: e.position,
            buttons: e.buttons,
            pointers: e.pointers,
            insideElementPressed: e.insideElementPressed,
            buttonDownAny: e.buttonDownAny,
            originalEvent: e.originalEvent
        })
    }

    function E(t) {
        window.location != window.parent.location && e.MouseTracker.resetAllMouseTrackers(), this.raiseEvent("canvas-exit", {
            tracker: t.eventSource,
            pointerType: t.pointerType,
            position: t.position,
            buttons: t.buttons,
            pointers: t.pointers,
            insideElementPressed: t.insideElementPressed,
            buttonDownAny: t.buttonDownAny,
            originalEvent: t.originalEvent
        })
    }

    function S(e) {
        this.raiseEvent("canvas-press", {
            tracker: e.eventSource,
            pointerType: e.pointerType,
            position: e.position,
            insideElementPressed: e.insideElementPressed,
            insideElementReleased: e.insideElementReleased,
            originalEvent: e.originalEvent
        })
    }

    function x(e) {
        this.raiseEvent("canvas-release", {
            tracker: e.eventSource,
            pointerType: e.pointerType,
            position: e.position,
            insideElementPressed: e.insideElementPressed,
            insideElementReleased: e.insideElementReleased,
            originalEvent: e.originalEvent
        })
    }

    function T(e) {
        this.raiseEvent("canvas-nonprimary-press", {
            tracker: e.eventSource,
            position: e.position,
            pointerType: e.pointerType,
            button: e.button,
            buttons: e.buttons,
            originalEvent: e.originalEvent
        })
    }

    function N(e) {
        this.raiseEvent("canvas-nonprimary-release", {
            tracker: e.eventSource,
            position: e.position,
            pointerType: e.pointerType,
            button: e.button,
            buttons: e.buttons,
            originalEvent: e.originalEvent
        })
    }

    function C(e) {
        var t, n, r, i;
        if (!e.preventDefaultAction && this.viewport) {
            t = this.gestureSettingsByDeviceType(e.pointerType), t.pinchToZoom && (n = this.viewport.pointFromPixel(e.center, !0), r = this.viewport.pointFromPixel(e.lastCenter, !0), i = r.minus(n), this.panHorizontal || (i.x = 0), this.panVertical || (i.y = 0), this.viewport.zoomBy(e.distance / e.lastDistance, n, !0), this.viewport.panBy(i, !0), this.viewport.applyConstraints());
            if (t.pinchRotate) {
                var s = Math.atan2(e.gesturePoints[0].currentPos.y - e.gesturePoints[1].currentPos.y, e.gesturePoints[0].currentPos.x - e.gesturePoints[1].currentPos.x),
                    o = Math.atan2(e.gesturePoints[0].lastPos.y - e.gesturePoints[1].lastPos.y, e.gesturePoints[0].lastPos.x - e.gesturePoints[1].lastPos.x);
                this.viewport.setRotation(this.viewport.getRotation() + (s - o) * (180 / Math.PI))
            }
        }
        return this.raiseEvent("canvas-pinch", {
            tracker: e.eventSource,
            gesturePoints: e.gesturePoints,
            lastCenter: e.lastCenter,
            center: e.center,
            lastDistance: e.lastDistance,
            distance: e.distance,
            shift: e.shift,
            originalEvent: e.originalEvent
        }), !1
    }

    function k(t) {
        var n, r, i, s;
        i = e.now(), s = i - this._lastScrollTime;
        if (s > this.minScrollDeltaTime) {
            this._lastScrollTime = i, !t.preventDefaultAction && this.viewport && (n = this.gestureSettingsByDeviceType(t.pointerType), n.scrollToZoom && (r = Math.pow(this.zoomPerScroll, t.scroll), this.viewport.zoomBy(r, this.viewport.pointFromPixel(t.position, !0)), this.viewport.applyConstraints())), this.raiseEvent("canvas-scroll", {
                tracker: t.eventSource,
                position: t.position,
                scroll: t.scroll,
                shift: t.shift,
                originalEvent: t.originalEvent
            });
            if (n && n.scrollToZoom) return !1
        } else {
            n = this.gestureSettingsByDeviceType(t.pointerType);
            if (n && n.scrollToZoom) return !1
        }
    }

    function L(e) {
        t[this.hash].mouseInside = !0, c(this), this.raiseEvent("container-enter", {
            tracker: e.eventSource,
            position: e.position,
            buttons: e.buttons,
            pointers: e.pointers,
            insideElementPressed: e.insideElementPressed,
            buttonDownAny: e.buttonDownAny,
            originalEvent: e.originalEvent
        })
    }

    function A(e) {
        e.pointers < 1 && (t[this.hash].mouseInside = !1, t[this.hash].animating || f(this)), this.raiseEvent("container-exit", {
            tracker: e.eventSource,
            position: e.position,
            buttons: e.buttons,
            pointers: e.pointers,
            insideElementPressed: e.insideElementPressed,
            buttonDownAny: e.buttonDownAny,
            originalEvent: e.originalEvent
        })
    }

    function O(e) {
        M(e), e.isOpen() ? e._updateRequestId = u(e, O) : e._updateRequestId = !1
    }

    function M(e) {
        if (e._opening) return;
        if (e.autoResize) {
            var n = r(e.container), i = t[e.hash].prevContainerSize;
            if (!n.equals(i)) {
                var s = e.viewport;
                if (e.preserveImageSizeOnResize) {
                    var o = i.x / n.x, u = s.getZoom() * o, a = s.getCenter();
                    s.resize(n, !1), s.zoomTo(u, null, !0), s.panTo(a, !0)
                } else {
                    var l = s.getBounds();
                    s.resize(n, !0), s.fitBoundsWithConstraints(l, !0)
                }
                t[e.hash].prevContainerSize = n, t[e.hash].forceRedraw = !0
            }
        }
        var h = e.viewport.update(), p = e.world.update() || h;
        h && e.raiseEvent("viewport-change"), e.referenceStrip && (p = e.referenceStrip.update(e.viewport) || p), !t[e.hash].animating && p && (e.raiseEvent("animation-start"), c(e));
        if (p || t[e.hash].forceRedraw || e.world.needsDraw()) _(e), e._drawOverlays(), e.navigator && e.navigator.update(e.viewport), t[e.hash].forceRedraw = !1, p && e.raiseEvent("animation");
        t[e.hash].animating && !p && (e.raiseEvent("animation-finish"), t[e.hash].mouseInside || f(e)), t[e.hash].animating = p
    }

    function _(e) {
        e.imageLoader.clear(), e.drawer.clear(), e.world.draw(), e.raiseEvent("update-viewport", {})
    }

    function D(e, t) {
        return e ? e + t : t
    }

    function P() {
        t[this.hash].lastZoomTime = e.now(), t[this.hash].zoomFactor = this.zoomPerSecond, t[this.hash].zooming = !0, j(this)
    }

    function H() {
        t[this.hash].lastZoomTime = e.now(), t[this.hash].zoomFactor = 1 / this.zoomPerSecond, t[this.hash].zooming = !0, j(this)
    }

    function B() {
        t[this.hash].zooming = !1
    }

    function j(t) {
        e.requestAnimationFrame(e.delegate(t, F))
    }

    function F() {
        var n, r, i;
        t[this.hash].zooming && this.viewport && (n = e.now(), r = n - t[this.hash].lastZoomTime, i = Math.pow(t[this.hash].zoomFactor, r / 1e3), this.viewport.zoomBy(i), this.viewport.applyConstraints(), t[this.hash].lastZoomTime = n, j(this))
    }

    function I() {
        this.viewport && (t[this.hash].zooming = !1, this.viewport.zoomBy(this.zoomPerClick / 1), this.viewport.applyConstraints())
    }

    function q() {
        this.viewport && (t[this.hash].zooming = !1, this.viewport.zoomBy(1 / this.zoomPerClick), this.viewport.applyConstraints())
    }

    function R() {
        this.buttons.emulateEnter(), this.buttons.emulateExit()
    }

    function U() {
        this.viewport && this.viewport.goHome()
    }

    function z() {
        this.isFullPage() && !e.isFullScreen() ? this.setFullPage(!1) : this.setFullScreen(!this.isFullPage()), this.buttons && this.buttons.emulateExit(), this.fullPageButton.element.focus(), this.viewport && this.viewport.applyConstraints()
    }

    function W() {
        if (this.viewport) {
            var e = this.viewport.getRotation();
            e === 0 ? e = 270 : e -= 90, this.viewport.setRotation(e)
        }
    }

    function X() {
        if (this.viewport) {
            var e = this.viewport.getRotation();
            e === 270 ? e = 0 : e += 90, this.viewport.setRotation(e)
        }
    }

    function V() {
        var e = this._sequenceIndex - 1;
        this.navPrevNextWrap && e < 0 && (e += this.tileSources.length), this.goToPage(e)
    }

    function $() {
        var e = this._sequenceIndex + 1;
        this.navPrevNextWrap && e >= this.tileSources.length && (e = 0), this.goToPage(e)
    }

    var t = {}, n = 1;
    e.Viewer = function (i) {
        var s = arguments, o = this, a;
        e.isPlainObject(i) || (i = {
            id: s[0],
            xmlPath: s.length > 1 ? s[1] : undefined,
            prefixUrl: s.length > 2 ? s[2] : undefined,
            controls: s.length > 3 ? s[3] : undefined,
            overlays: s.length > 4 ? s[4] : undefined
        }), i.config && (e.extend(!0, i, i.config), delete i.config), e.extend(!0, this, {
            id: i.id,
            hash: i.hash || n++,
            initialPage: 0,
            element: null,
            container: null,
            canvas: null,
            overlays: [],
            overlaysContainer: null,
            previousBody: [],
            customControls: [],
            source: null,
            drawer: null,
            world: null,
            viewport: null,
            navigator: null,
            collectionViewport: null,
            collectionDrawer: null,
            navImages: null,
            buttons: null,
            profiler: null
        }, e.DEFAULT_SETTINGS, i);
        if (typeof this.hash == "undefined") throw new Error("A hash must be defined, either by specifying options.id or options.hash.");
        typeof t[this.hash] != "undefined" && e.console.warn("Hash " + this.hash + " has already been used."), t[this.hash] = {
            fsBoundsDelta: new e.Point(1, 1),
            prevContainerSize: null,
            animating: !1,
            forceRedraw: !1,
            mouseInside: !1,
            group: null,
            zooming: !1,
            zoomFactor: null,
            lastZoomTime: null,
            fullPage: !1,
            onfullscreenchange: null
        }, this._sequenceIndex = 0, this._firstOpen = !0, this._updateRequestId = null, this._loadQueue = [], this.currentOverlays = [], this._lastScrollTime = e.now(), e.EventSource.call(this), this.addHandler("open-failed", function (t) {
            var n = e.getString("Errors.OpenFailed", t.eventSource, t.message);
            o._showMessage(n)
        }), e.ControlDock.call(this, i), this.xmlPath && (this.tileSources = [this.xmlPath]), this.element = this.element || document.getElementById(this.id), this.canvas = e.makeNeutralElement("div"), this.canvas.className = "openseadragon-canvas", function (e) {
            e.width = "100%", e.height = "100%", e.overflow = "hidden", e.position = "absolute", e.top = "0px", e.left = "0px"
        }(this.canvas.style), e.setElementTouchActionNone(this.canvas), i.tabIndex !== "" && (this.canvas.tabIndex = i.tabIndex === undefined ? 0 : i.tabIndex), this.container.className = "openseadragon-container", function (e) {
            e.width = "100%", e.height = "100%", e.position = "relative", e.overflow = "hidden", e.left = "0px", e.top = "0px", e.textAlign = "left"
        }(this.container.style), this.container.insertBefore(this.canvas, this.container.firstChild), this.element.appendChild(this.container), this.bodyWidth = document.body.style.width, this.bodyHeight = document.body.style.height, this.bodyOverflow = document.body.style.overflow, this.docOverflow = document.documentElement.style.overflow, this.innerTracker = new e.MouseTracker({
            element: this.canvas,
            startDisabled: !this.mouseNavEnabled,
            clickTimeThreshold: this.clickTimeThreshold,
            clickDistThreshold: this.clickDistThreshold,
            dblClickTimeThreshold: this.dblClickTimeThreshold,
            dblClickDistThreshold: this.dblClickDistThreshold,
            keyDownHandler: e.delegate(this, d),
            keyHandler: e.delegate(this, v),
            clickHandler: e.delegate(this, m),
            dblClickHandler: e.delegate(this, g),
            dragHandler: e.delegate(this, y),
            dragEndHandler: e.delegate(this, b),
            enterHandler: e.delegate(this, w),
            exitHandler: e.delegate(this, E),
            pressHandler: e.delegate(this, S),
            releaseHandler: e.delegate(this, x),
            nonPrimaryPressHandler: e.delegate(this, T),
            nonPrimaryReleaseHandler: e.delegate(this, N),
            scrollHandler: e.delegate(this, k),
            pinchHandler: e.delegate(this, C)
        }), this.outerTracker = new e.MouseTracker({
            element: this.container,
            startDisabled: !this.mouseNavEnabled,
            clickTimeThreshold: this.clickTimeThreshold,
            clickDistThreshold: this.clickDistThreshold,
            dblClickTimeThreshold: this.dblClickTimeThreshold,
            dblClickDistThreshold: this.dblClickDistThreshold,
            enterHandler: e.delegate(this, L),
            exitHandler: e.delegate(this, A)
        }), this.toolbar && (this.toolbar = new e.ControlDock({element: this.toolbar})), this.bindStandardControls(), t[this.hash].prevContainerSize = r(this.container), this.world = new e.World({viewer: this}), this.world.addHandler("add-item", function (e) {
            o.source = o.world.getItemAt(0).source, t[o.hash].forceRedraw = !0, o._updateRequestId || (o._updateRequestId = u(o, O))
        }), this.world.addHandler("remove-item", function (e) {
            o.world.getItemCount() ? o.source = o.world.getItemAt(0).source : o.source = null, t[o.hash].forceRedraw = !0
        }), this.world.addHandler("metrics-change", function (e) {
            o.viewport && o.viewport._setContentBounds(o.world.getHomeBounds(), o.world.getContentFactor())
        }), this.world.addHandler("item-index-change", function (e) {
            o.source = o.world.getItemAt(0).source
        }), this.viewport = new e.Viewport({
            containerSize: t[this.hash].prevContainerSize,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime,
            minZoomImageRatio: this.minZoomImageRatio,
            maxZoomPixelRatio: this.maxZoomPixelRatio,
            visibilityRatio: this.visibilityRatio,
            wrapHorizontal: this.wrapHorizontal,
            wrapVertical: this.wrapVertical,
            defaultZoomLevel: this.defaultZoomLevel,
            minZoomLevel: this.minZoomLevel,
            maxZoomLevel: this.maxZoomLevel,
            viewer: this,
            degrees: this.degrees,
            navigatorRotate: this.navigatorRotate,
            homeFillsViewer: this.homeFillsViewer,
            margins: this.viewportMargins
        }), this.viewport._setContentBounds(this.world.getHomeBounds(), this.world.getContentFactor()), this.imageLoader = new e.ImageLoader({
            jobLimit: this.imageLoaderLimit,
            timeout: i.timeout
        }), this.tileCache = new e.TileCache({maxImageCacheCount: this.maxImageCacheCount}), this.drawer = new e.Drawer({
            viewer: this,
            viewport: this.viewport,
            element: this.canvas,
            debugGridColor: this.debugGridColor
        }), this.overlaysContainer = e.makeNeutralElement("div"), this.canvas.appendChild(this.overlaysContainer), this.drawer.canRotate() || (this.rotateLeft && (a = this.buttons.buttons.indexOf(this.rotateLeft), this.buttons.buttons.splice(a, 1), this.buttons.element.removeChild(this.rotateLeft.element)), this.rotateRight && (a = this.buttons.buttons.indexOf(this.rotateRight), this.buttons.buttons.splice(a, 1), this.buttons.element.removeChild(this.rotateRight.element))), this.showNavigator && (this.navigator = new e.Navigator({
            id: this.navigatorId,
            position: this.navigatorPosition,
            sizeRatio: this.navigatorSizeRatio,
            maintainSizeRatio: this.navigatorMaintainSizeRatio,
            top: this.navigatorTop,
            left: this.navigatorLeft,
            width: this.navigatorWidth,
            height: this.navigatorHeight,
            autoResize: this.navigatorAutoResize,
            autoFade: this.navigatorAutoFade,
            prefixUrl: this.prefixUrl,
            viewer: this,
            navigatorRotate: this.navigatorRotate,
            crossOriginPolicy: this.crossOriginPolicy
        })), this.sequenceMode && this.bindSequenceControls(), this.tileSources && this.open(this.tileSources);
        for (a = 0; a < this.customControls.length; a++) this.addControl(this.customControls[a].id, {anchor: this.customControls[a].anchor});
        e.requestAnimationFrame(function () {
            f(o)
        })
    }, e.extend(e.Viewer.prototype, e.EventSource.prototype, e.ControlDock.prototype, {
        isOpen: function () {
            return !!this.world.getItemCount()
        }, openDzi: function (t) {
            return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."), this.open(t)
        }, openTileSource: function (t) {
            return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."), this.open(t)
        }, open: function (t, n) {
            var r = this;
            this.close();
            if (!t) return;
            if (this.sequenceMode && e.isArray(t)) {
                this.referenceStrip && (this.referenceStrip.destroy(), this.referenceStrip = null), typeof n != "undefined" && !isNaN(n) && (this.initialPage = n), this.tileSources = t, this._sequenceIndex = Math.max(0, Math.min(this.tileSources.length - 1, this.initialPage)), this.tileSources.length && (this.open(this.tileSources[this._sequenceIndex]), this.showReferenceStrip && this.addReferenceStrip()), this._updateSequenceButtons(this._sequenceIndex);
                return
            }
            e.isArray(t) || (t = [t]);
            if (!t.length) return;
            this._opening = !0;
            var i = t.length, o = 0, u = 0, a, f = function () {
                if (o + u === i) if (o) {
                    if (r._firstOpen || !r.preserveViewport) r.viewport.goHome(!0), r.viewport.update();
                    r._firstOpen = !1;
                    var e = t[0];
                    e.tileSource && (e = e.tileSource);
                    if (r.overlays && !r.preserveOverlays) for (var n = 0; n < r.overlays.length; n++) r.currentOverlays[n] = s(r, r.overlays[n]);
                    r._drawOverlays(), r._opening = !1, r.raiseEvent("open", {source: e})
                } else r._opening = !1, r.raiseEvent("open-failed", a)
            }, l = function (t) {
                if (!e.isPlainObject(t) || !t.tileSource) t = {tileSource: t};
                t.index !== undefined && (e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"), delete t.index), t.collectionImmediately === undefined && (t.collectionImmediately = !0);
                var n = t.success;
                t.success = function (e) {
                    o++;
                    if (t.tileSource.overlays) for (var i = 0; i < t.tileSource.overlays.length; i++) r.addOverlay(t.tileSource.overlays[i]);
                    n && n(e), f()
                };
                var i = t.error;
                t.error = function (e) {
                    u++, a || (a = e), i && i(e), f()
                }, r.addTiledImage(t)
            };
            for (var c = 0; c < t.length; c++) l(t[c]);
            return this
        }, close: function () {
            return t[this.hash] ? (this._opening = !1, this.navigator && this.navigator.close(), this.preserveOverlays || (this.clearOverlays(), this.overlaysContainer.innerHTML = ""), t[this.hash].animating = !1, this.world.removeAll(), this.imageLoader.clear(), this.raiseEvent("close"), this) : this
        }, destroy: function () {
            if (!t[this.hash]) return;
            this.close(), this.clearOverlays(), this.overlaysContainer.innerHTML = "", this.referenceStrip && (this.referenceStrip.destroy(), this.referenceStrip = null), this._updateRequestId !== null && (e.cancelAnimationFrame(this._updateRequestId), this._updateRequestId = null), this.drawer && this.drawer.destroy(), this.removeAllHandlers();
            if (this.element) while (this.element.firstChild) this.element.removeChild(this.element.firstChild);
            this.innerTracker && this.innerTracker.destroy(), this.outerTracker && this.outerTracker.destroy(), t[this.hash] = null, delete t[this.hash], this.canvas = null, this.container = null, this.element = null
        }, isMouseNavEnabled: function () {
            return this.innerTracker.isTracking()
        }, setMouseNavEnabled: function (e) {
            return this.innerTracker.setTracking(e), this.outerTracker.setTracking(e), this.raiseEvent("mouse-enabled", {enabled: e}), this
        }, areControlsEnabled: function () {
            var e = this.controls.length, t;
            for (t = 0; t < this.controls.length; t++) e = e && this.controls[t].isVisibile();
            return e
        }, setControlsEnabled: function (e) {
            return e ? c(this) : f(this), this.raiseEvent("controls-enabled", {enabled: e}), this
        }, setDebugMode: function (e) {
            for (var t = 0; t < this.world.getItemCount(); t++) this.world.getItemAt(t).debugMode = e;
            this.debugMode = e, this.forceRedraw()
        }, isFullPage: function () {
            return t[this.hash].fullPage
        }, setFullPage: function (n) {
            var r = document.body, i = r.style, s = document.documentElement.style, o = this, u, a;
            if (n == this.isFullPage()) return this;
            var f = {fullPage: n, preventDefaultAction: !1};
            this.raiseEvent("pre-full-page", f);
            if (f.preventDefaultAction) return this;
            if (n) {
                this.elementSize = e.getElementSize(this.element), this.pageScroll = e.getPageScroll(), this.elementMargin = this.element.style.margin, this.element.style.margin = "0", this.elementPadding = this.element.style.padding, this.element.style.padding = "0", this.bodyMargin = i.margin, this.docMargin = s.margin, i.margin = "0", s.margin = "0", this.bodyPadding = i.padding, this.docPadding = s.padding, i.padding = "0", s.padding = "0", this.bodyWidth = i.width, this.docWidth = s.width, i.width = "100%", s.width = "100%", this.bodyHeight = i.height, this.docHeight = s.height, i.height = "100%", s.height = "100%", this.previousBody = [], t[this.hash].prevElementParent = this.element.parentNode, t[this.hash].prevNextSibling = this.element.nextSibling, t[this.hash].prevElementWidth = this.element.style.width, t[this.hash].prevElementHeight = this.element.style.height, u = r.childNodes.length;
                for (a = 0; a < u; a++) this.previousBody.push(r.childNodes[0]), r.removeChild(r.childNodes[0]);
                this.toolbar && this.toolbar.element && (this.toolbar.parentNode = this.toolbar.element.parentNode, this.toolbar.nextSibling = this.toolbar.element.nextSibling, r.appendChild(this.toolbar.element), e.addClass(this.toolbar.element, "fullpage")), e.addClass(this.element, "fullpage"), r.appendChild(this.element), this.element.style.height = e.getWindowSize().y + "px", this.element.style.width = e.getWindowSize().x + "px", this.toolbar && this.toolbar.element && (this.element.style.height = e.getElementSize(this.element).y - e.getElementSize(this.toolbar.element).y + "px"), t[this.hash].fullPage = !0, e.delegate(this, L)({})
            } else {
                this.element.style.margin = this.elementMargin, this.element.style.padding = this.elementPadding, i.margin = this.bodyMargin, s.margin = this.docMargin, i.padding = this.bodyPadding, s.padding = this.docPadding, i.width = this.bodyWidth, s.width = this.docWidth, i.height = this.bodyHeight, s.height = this.docHeight, r.removeChild(this.element), u = this.previousBody.length;
                for (a = 0; a < u; a++) r.appendChild(this.previousBody.shift());
                e.removeClass(this.element, "fullpage"), t[this.hash].prevElementParent.insertBefore(this.element, t[this.hash].prevNextSibling), this.toolbar && this.toolbar.element && (r.removeChild(this.toolbar.element), e.removeClass(this.toolbar.element, "fullpage"), this.toolbar.parentNode.insertBefore(this.toolbar.element, this.toolbar.nextSibling), delete this.toolbar.parentNode, delete this.toolbar.nextSibling), this.element.style.width = t[this.hash].prevElementWidth, this.element.style.height = t[this.hash].prevElementHeight;
                var l = 0, c = function () {
                    e.setPageScroll(o.pageScroll);
                    var t = e.getPageScroll();
                    l++, l < 10 && (t.x !== o.pageScroll.x || t.y !== o.pageScroll.y) && e.requestAnimationFrame(c)
                };
                e.requestAnimationFrame(c), t[this.hash].fullPage = !1, e.delegate(this, A)({})
            }
            return this.navigator && this.viewport && this.navigator.update(this.viewport), this.raiseEvent("full-page", {fullPage: n}), this
        }, setFullScreen: function (t) {
            var n = this;
            if (!e.supportsFullScreen) return this.setFullPage(t);
            if (e.isFullScreen() === t) return this;
            var r = {fullScreen: t, preventDefaultAction: !1};
            this.raiseEvent("pre-full-screen", r);
            if (r.preventDefaultAction) return this;
            if (t) {
                this.setFullPage(!0);
                if (!this.isFullPage()) return this;
                this.fullPageStyleWidth = this.element.style.width, this.fullPageStyleHeight = this.element.style.height, this.element.style.width = "100%", this.element.style.height = "100%";
                var i = function () {
                    var t = e.isFullScreen();
                    t || (e.removeEvent(document, e.fullScreenEventName, i), e.removeEvent(document, e.fullScreenErrorEventName, i), n.setFullPage(!1), n.isFullPage() && (n.element.style.width = n.fullPageStyleWidth, n.element.style.height = n.fullPageStyleHeight)), n.navigator && n.viewport && n.navigator.update(n.viewport), n.raiseEvent("full-screen", {fullScreen: t})
                };
                e.addEvent(document, e.fullScreenEventName, i), e.addEvent(document, e.fullScreenErrorEventName, i), e.requestFullScreen(document.body)
            } else e.exitFullScreen();
            return this
        }, isVisible: function () {
            return this.container.style.visibility != "hidden"
        }, setVisible: function (e) {
            return this.container.style.visibility = e ? "" : "hidden", this.raiseEvent("visible", {visible: e}), this
        }, addTiledImage: function (t) {
            function s(e) {
                for (var i = 0; i < n._loadQueue.length; i++) if (n._loadQueue[i] === r) {
                    n._loadQueue.splice(i, 1);
                    break
                }
                n._loadQueue.length === 0 && o(r), n.raiseEvent("add-item-failed", e), t.error && t.error(e)
            }

            function o(e) {
                n.collectionMode && (n.world.arrange({
                    immediately: e.options.collectionImmediately,
                    rows: n.collectionRows,
                    columns: n.collectionColumns,
                    layout: n.collectionLayout,
                    tileSize: n.collectionTileSize,
                    tileMargin: n.collectionTileMargin
                }), n.world.setAutoRefigureSizes(!0))
            }

            function u() {
                var t, r, i;
                while (n._loadQueue.length) {
                    t = n._loadQueue[0];
                    if (!t.tileSource) break;
                    n._loadQueue.splice(0, 1);
                    if (t.options.replace) {
                        var s = n.world.getIndexOfItem(t.options.replaceItem);
                        s != -1 && (t.options.index = s), n.world.removeItem(t.options.replaceItem)
                    }
                    r = new e.TiledImage({
                        viewer: n,
                        source: t.tileSource,
                        viewport: n.viewport,
                        drawer: n.drawer,
                        tileCache: n.tileCache,
                        imageLoader: n.imageLoader,
                        x: t.options.x,
                        y: t.options.y,
                        width: t.options.width,
                        height: t.options.height,
                        fitBounds: t.options.fitBounds,
                        fitBoundsPlacement: t.options.fitBoundsPlacement,
                        clip: t.options.clip,
                        placeholderFillStyle: t.options.placeholderFillStyle,
                        opacity: t.options.opacity,
                        preload: t.options.preload,
                        degrees: t.options.degrees,
                        compositeOperation: t.options.compositeOperation,
                        springStiffness: n.springStiffness,
                        animationTime: n.animationTime,
                        minZoomImageRatio: n.minZoomImageRatio,
                        wrapHorizontal: n.wrapHorizontal,
                        wrapVertical: n.wrapVertical,
                        immediateRender: n.immediateRender,
                        blendTime: n.blendTime,
                        alwaysBlend: n.alwaysBlend,
                        minPixelRatio: n.minPixelRatio,
                        smoothTileEdgesMinZoom: n.smoothTileEdgesMinZoom,
                        iOSDevice: n.iOSDevice,
                        crossOriginPolicy: t.options.crossOriginPolicy,
                        ajaxWithCredentials: t.options.ajaxWithCredentials,
                        loadTilesWithAjax: t.options.loadTilesWithAjax,
                        ajaxHeaders: t.options.ajaxHeaders,
                        debugMode: n.debugMode
                    }), n.collectionMode && n.world.setAutoRefigureSizes(!1), n.world.addItem(r, {index: t.options.index}), n._loadQueue.length === 0 && o(t), n.world.getItemCount() === 1 && !n.preserveViewport && n.viewport.goHome(!0), n.navigator && (i = e.extend({}, t.options, {
                        replace: !1,
                        originalTiledImage: r,
                        tileSource: t.tileSource
                    }), n.navigator.addTiledImage(i)), t.options.success && t.options.success({item: r})
                }
            }

            e.console.assert(t, "[Viewer.addTiledImage] options is required"), e.console.assert(t.tileSource, "[Viewer.addTiledImage] options.tileSource is required"), e.console.assert(!t.replace || t.index > -1 && t.index < this.world.getItemCount(), "[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");
            var n = this;
            t.replace && (t.replaceItem = n.world.getItemAt(t.index)), this._hideMessage(), t.placeholderFillStyle === undefined && (t.placeholderFillStyle = this.placeholderFillStyle), t.opacity === undefined && (t.opacity = this.opacity), t.preload === undefined && (t.preload = this.preload), t.compositeOperation === undefined && (t.compositeOperation = this.compositeOperation), t.crossOriginPolicy === undefined && (t.crossOriginPolicy = t.tileSource.crossOriginPolicy !== undefined ? t.tileSource.crossOriginPolicy : this.crossOriginPolicy), t.ajaxWithCredentials === undefined && (t.ajaxWithCredentials = this.ajaxWithCredentials), t.loadTilesWithAjax === undefined && (t.loadTilesWithAjax = this.loadTilesWithAjax), t.ajaxHeaders === undefined || t.ajaxHeaders === null ? t.ajaxHeaders = this.ajaxHeaders : e.isPlainObject(t.ajaxHeaders) && e.isPlainObject(this.ajaxHeaders) && (t.ajaxHeaders = e.extend({}, this.ajaxHeaders, t.ajaxHeaders));
            var r = {options: t};
            if (e.isArray(t.tileSource)) {
                setTimeout(function () {
                    s({
                        message: "[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",
                        source: t.tileSource,
                        options: t
                    })
                });
                return
            }
            this._loadQueue.push(r), i(this, t.tileSource, t, function (e) {
                r.tileSource = e, u()
            }, function (e) {
                e.options = t, s(e), u()
            })
        }, addSimpleImage: function (t) {
            e.console.assert(t, "[Viewer.addSimpleImage] options is required"), e.console.assert(t.url, "[Viewer.addSimpleImage] options.url is required");
            var n = e.extend({}, t, {tileSource: {type: "image", url: t.url}});
            delete n.url, this.addTiledImage(n)
        }, addLayer: function (t) {
            var n = this;
            e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");
            var r = e.extend({}, t, {
                success: function (e) {
                    n.raiseEvent("add-layer", {options: t, drawer: e.item})
                }, error: function (e) {
                    n.raiseEvent("add-layer-failed", e)
                }
            });
            return this.addTiledImage(r), this
        }, getLayerAtLevel: function (t) {
            return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."), this.world.getItemAt(t)
        }, getLevelOfLayer: function (t) {
            return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."), this.world.getIndexOfItem(t)
        }, getLayersCount: function () {
            return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."), this.world.getItemCount()
        }, setLayerLevel: function (t, n) {
            return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."), this.world.setItemIndex(t, n)
        }, removeLayer: function (t) {
            return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."), this.world.removeItem(t)
        }, forceRedraw: function () {
            return t[this.hash].forceRedraw = !0, this
        }, bindSequenceControls: function () {
            var t = e.delegate(this, h), n = e.delegate(this, p), r = e.delegate(this, $), i = e.delegate(this, V),
                s = this.navImages, o = !0;
            if (this.showSequenceControl) {
                if (this.previousButton || this.nextButton) o = !1;
                this.previousButton = new e.Button({
                    element: this.previousButton ? e.getElement(this.previousButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.PreviousPage"),
                    srcRest: D(this.prefixUrl, s.previous.REST),
                    srcGroup: D(this.prefixUrl, s.previous.GROUP),
                    srcHover: D(this.prefixUrl, s.previous.HOVER),
                    srcDown: D(this.prefixUrl, s.previous.DOWN),
                    onRelease: i,
                    onFocus: t,
                    onBlur: n
                }), this.nextButton = new e.Button({
                    element: this.nextButton ? e.getElement(this.nextButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.NextPage"),
                    srcRest: D(this.prefixUrl, s.next.REST),
                    srcGroup: D(this.prefixUrl, s.next.GROUP),
                    srcHover: D(this.prefixUrl, s.next.HOVER),
                    srcDown: D(this.prefixUrl, s.next.DOWN),
                    onRelease: r,
                    onFocus: t,
                    onBlur: n
                }), this.navPrevNextWrap || this.previousButton.disable(), (!this.tileSources || !this.tileSources.length) && this.nextButton.disable(), o && (this.paging = new e.ButtonGroup({
                    buttons: [this.previousButton, this.nextButton],
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold
                }), this.pagingControl = this.paging.element, this.toolbar ? this.toolbar.addControl(this.pagingControl, {anchor: e.ControlAnchor.BOTTOM_RIGHT}) : this.addControl(this.pagingControl, {anchor: this.sequenceControlAnchor || e.ControlAnchor.TOP_LEFT}))
            }
            return this
        }, bindStandardControls: function () {
            var t = e.delegate(this, P), n = e.delegate(this, B), r = e.delegate(this, I), i = e.delegate(this, H),
                s = e.delegate(this, q), o = e.delegate(this, U), u = e.delegate(this, z), a = e.delegate(this, W),
                f = e.delegate(this, X), l = e.delegate(this, h), c = e.delegate(this, p), d = this.navImages, v = [],
                m = !0;
            if (this.showNavigationControl) {
                if (this.zoomInButton || this.zoomOutButton || this.homeButton || this.fullPageButton || this.rotateLeftButton || this.rotateRightButton) m = !1;
                this.showZoomControl && (v.push(this.zoomInButton = new e.Button({
                    element: this.zoomInButton ? e.getElement(this.zoomInButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.ZoomIn"),
                    srcRest: D(this.prefixUrl, d.zoomIn.REST),
                    srcGroup: D(this.prefixUrl, d.zoomIn.GROUP),
                    srcHover: D(this.prefixUrl, d.zoomIn.HOVER),
                    srcDown: D(this.prefixUrl, d.zoomIn.DOWN),
                    onPress: t,
                    onRelease: n,
                    onClick: r,
                    onEnter: t,
                    onExit: n,
                    onFocus: l,
                    onBlur: c
                })), v.push(this.zoomOutButton = new e.Button({
                    element: this.zoomOutButton ? e.getElement(this.zoomOutButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.ZoomOut"),
                    srcRest: D(this.prefixUrl, d.zoomOut.REST),
                    srcGroup: D(this.prefixUrl, d.zoomOut.GROUP),
                    srcHover: D(this.prefixUrl, d.zoomOut.HOVER),
                    srcDown: D(this.prefixUrl, d.zoomOut.DOWN),
                    onPress: i,
                    onRelease: n,
                    onClick: s,
                    onEnter: i,
                    onExit: n,
                    onFocus: l,
                    onBlur: c
                }))), this.showHomeControl && v.push(this.homeButton = new e.Button({
                    element: this.homeButton ? e.getElement(this.homeButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.Home"),
                    srcRest: D(this.prefixUrl, d.home.REST),
                    srcGroup: D(this.prefixUrl, d.home.GROUP),
                    srcHover: D(this.prefixUrl, d.home.HOVER),
                    srcDown: D(this.prefixUrl, d.home.DOWN),
                    onRelease: o,
                    onFocus: l,
                    onBlur: c
                })), this.showFullPageControl && v.push(this.fullPageButton = new e.Button({
                    element: this.fullPageButton ? e.getElement(this.fullPageButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.FullPage"),
                    srcRest: D(this.prefixUrl, d.fullpage.REST),
                    srcGroup: D(this.prefixUrl, d.fullpage.GROUP),
                    srcHover: D(this.prefixUrl, d.fullpage.HOVER),
                    srcDown: D(this.prefixUrl, d.fullpage.DOWN),
                    onRelease: u,
                    onFocus: l,
                    onBlur: c
                })), this.showRotationControl && (v.push(this.rotateLeftButton = new e.Button({
                    element: this.rotateLeftButton ? e.getElement(this.rotateLeftButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.RotateLeft"),
                    srcRest: D(this.prefixUrl, d.rotateleft.REST),
                    srcGroup: D(this.prefixUrl, d.rotateleft.GROUP),
                    srcHover: D(this.prefixUrl, d.rotateleft.HOVER),
                    srcDown: D(this.prefixUrl, d.rotateleft.DOWN),
                    onRelease: a,
                    onFocus: l,
                    onBlur: c
                })), v.push(this.rotateRightButton = new e.Button({
                    element: this.rotateRightButton ? e.getElement(this.rotateRightButton) : null,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold,
                    tooltip: e.getString("Tooltips.RotateRight"),
                    srcRest: D(this.prefixUrl, d.rotateright.REST),
                    srcGroup: D(this.prefixUrl, d.rotateright.GROUP),
                    srcHover: D(this.prefixUrl, d.rotateright.HOVER),
                    srcDown: D(this.prefixUrl, d.rotateright.DOWN),
                    onRelease: f,
                    onFocus: l,
                    onBlur: c
                }))), m && (this.buttons = new e.ButtonGroup({
                    buttons: v,
                    clickTimeThreshold: this.clickTimeThreshold,
                    clickDistThreshold: this.clickDistThreshold
                }), this.navControl = this.buttons.element, this.addHandler("open", e.delegate(this, R)), this.toolbar ? this.toolbar.addControl(this.navControl, {anchor: this.navigationControlAnchor || e.ControlAnchor.TOP_LEFT}) : this.addControl(this.navControl, {anchor: this.navigationControlAnchor || e.ControlAnchor.TOP_LEFT}))
            }
            return this
        }, currentPage: function () {
            return this._sequenceIndex
        }, goToPage: function (e) {
            return this.tileSources && e >= 0 && e < this.tileSources.length && (this.raiseEvent("page", {page: e}), this._sequenceIndex = e, this._updateSequenceButtons(e), this.open(this.tileSources[e]), this.referenceStrip && this.referenceStrip.setFocus(e)), this
        }, addOverlay: function (t, n, r, i) {
            var u;
            e.isPlainObject(t) ? u = t : u = {
                element: t,
                location: n,
                placement: r,
                onDraw: i
            }, t = e.getElement(u.element);
            if (o(this.currentOverlays, t) >= 0) return this;
            var a = s(this, u);
            return this.currentOverlays.push(a), a.drawHTML(this.overlaysContainer, this.viewport), this.raiseEvent("add-overlay", {
                element: t,
                location: u.location,
                placement: u.placement
            }), this
        }, updateOverlay: function (n, r, i) {
            var s;
            return n = e.getElement(n), s = o(this.currentOverlays, n), s >= 0 && (this.currentOverlays[s].update(r, i), t[this.hash].forceRedraw = !0, this.raiseEvent("update-overlay", {
                element: n,
                location: r,
                placement: i
            })), this
        }, removeOverlay: function (n) {
            var r;
            return n = e.getElement(n), r = o(this.currentOverlays, n), r >= 0 && (this.currentOverlays[r].destroy(), this.currentOverlays.splice(r, 1), t[this.hash].forceRedraw = !0, this.raiseEvent("remove-overlay", {element: n})), this
        }, clearOverlays: function () {
            while (this.currentOverlays.length > 0) this.currentOverlays.pop().destroy();
            return t[this.hash].forceRedraw = !0, this.raiseEvent("clear-overlay", {}), this
        }, getOverlayById: function (t) {
            var n;
            return t = e.getElement(t), n = o(this.currentOverlays, t), n >= 0 ? this.currentOverlays[n] : null
        }, _updateSequenceButtons: function (e) {
            this.nextButton && (!this.tileSources || this.tileSources.length - 1 === e ? this.navPrevNextWrap || this.nextButton.disable() : this.nextButton.enable()), this.previousButton && (e > 0 ? this.previousButton.enable() : this.navPrevNextWrap || this.previousButton.disable())
        }, _showMessage: function (t) {
            this._hideMessage();
            var n = e.makeNeutralElement("div");
            n.appendChild(document.createTextNode(t)), this.messageDiv = e.makeCenteredNode(n), e.addClass(this.messageDiv, "openseadragon-message"), this.container.appendChild(this.messageDiv)
        }, _hideMessage: function () {
            var e = this.messageDiv;
            e && (e.parentNode.removeChild(e), delete this.messageDiv)
        }, gestureSettingsByDeviceType: function (e) {
            switch (e) {
                case"mouse":
                    return this.gestureSettingsMouse;
                case"touch":
                    return this.gestureSettingsTouch;
                case"pen":
                    return this.gestureSettingsPen;
                default:
                    return this.gestureSettingsUnknown
            }
        }, _drawOverlays: function () {
            var e, t = this.currentOverlays.length;
            for (e = 0; e < t; e++) this.currentOverlays[e].drawHTML(this.overlaysContainer, this.viewport)
        }, _cancelPendingImages: function () {
            this._loadQueue = []
        }, removeReferenceStrip: function () {
            this.showReferenceStrip = !1, this.referenceStrip && (this.referenceStrip.destroy(), this.referenceStrip = null)
        }, addReferenceStrip: function () {
            this.showReferenceStrip = !0;
            if (this.sequenceMode) {
                if (this.referenceStrip) return;
                this.tileSources.length && this.tileSources.length > 1 && (this.referenceStrip = new e.ReferenceStrip({
                    id: this.referenceStripElement,
                    position: this.referenceStripPosition,
                    sizeRatio: this.referenceStripSizeRatio,
                    scroll: this.referenceStripScroll,
                    height: this.referenceStripHeight,
                    width: this.referenceStripWidth,
                    tileSources: this.tileSources,
                    prefixUrl: this.prefixUrl,
                    viewer: this
                }), this.referenceStrip.setFocus(this._sequenceIndex))
            } else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')
        }
    })
}(OpenSeadragon),function (e) {
    function t(e) {
        e.quick && this.viewer.viewport && (this.viewer.viewport.panTo(this.viewport.pointFromPixel(e.position)), this.viewer.viewport.applyConstraints())
    }

    function n(e) {
        this.viewer.viewport && (this.panHorizontal || (e.delta.x = 0), this.panVertical || (e.delta.y = 0), this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)), this.viewer.constrainDuringPan && this.viewer.viewport.applyConstraints())
    }

    function r(e) {
        e.insideElementPressed && this.viewer.viewport && this.viewer.viewport.applyConstraints()
    }

    function i(e) {
        return this.viewer.raiseEvent("navigator-scroll", {
            tracker: e.eventSource,
            position: e.position,
            scroll: e.scroll,
            shift: e.shift,
            originalEvent: e.originalEvent
        }), !1
    }

    function s(e, t) {
        e.style.webkitTransform = "rotate(" + t + "deg)", e.style.mozTransform = "rotate(" + t + "deg)", e.style.msTransform = "rotate(" + t + "deg)", e.style.oTransform = "rotate(" + t + "deg)", e.style.transform = "rotate(" + t + "deg)"
    }

    e.Navigator = function (o) {
        function c(e) {
            s(a.displayRegionContainer, e), s(a.displayRegion, -e), a.viewport.setRotation(e)
        }

        var u = o.viewer, a = this, f, l;
        o.id ? (this.element = document.getElementById(o.id), o.controlOptions = {
            anchor: e.ControlAnchor.NONE,
            attachToViewer: !1,
            autoFade: !1
        }) : (o.id = "navigator-" + e.now(), this.element = e.makeNeutralElement("div"), o.controlOptions = {
            anchor: e.ControlAnchor.TOP_RIGHT,
            attachToViewer: !0,
            autoFade: o.autoFade
        }, o.position && ("BOTTOM_RIGHT" == o.position ? o.controlOptions.anchor = e.ControlAnchor.BOTTOM_RIGHT : "BOTTOM_LEFT" == o.position ? o.controlOptions.anchor = e.ControlAnchor.BOTTOM_LEFT : "TOP_RIGHT" == o.position ? o.controlOptions.anchor = e.ControlAnchor.TOP_RIGHT : "TOP_LEFT" == o.position ? o.controlOptions.anchor = e.ControlAnchor.TOP_LEFT : "ABSOLUTE" == o.position && (o.controlOptions.anchor = e.ControlAnchor.ABSOLUTE, o.controlOptions.top = o.top, o.controlOptions.left = o.left, o.controlOptions.height = o.height, o.controlOptions.width = o.width))), this.element.id = o.id, this.element.className += " navigator", o = e.extend(!0, {sizeRatio: e.DEFAULT_SETTINGS.navigatorSizeRatio}, o, {
            element: this.element,
            tabIndex: -1,
            showNavigator: !1,
            mouseNavEnabled: !1,
            showNavigationControl: !1,
            showSequenceControl: !1,
            immediateRender: !0,
            blendTime: 0,
            animationTime: 0,
            autoResize: o.autoResize,
            minZoomImageRatio: 1
        }), o.minPixelRatio = this.minPixelRatio = u.minPixelRatio, e.setElementTouchActionNone(this.element), this.borderWidth = 2, this.fudge = new e.Point(1, 1), this.totalBorderWidths = (new e.Point(this.borderWidth * 2, this.borderWidth * 2)).minus(this.fudge), o.controlOptions.anchor != e.ControlAnchor.NONE && function (e, t) {
            e.margin = "0px", e.border = t + "px solid #555", e.padding = "0px", e.background = "#000", e.opacity = .8, e.overflow = "hidden"
        }(this.element.style, this.borderWidth), this.displayRegion = e.makeNeutralElement("div"), this.displayRegion.id = this.element.id + "-displayregion", this.displayRegion.className = "displayregion", function (e, t) {
            e.position = "relative", e.top = "0px", e.left = "0px", e.fontSize = "0px", e.overflow = "hidden", e.border = t + "px solid #900", e.margin = "0px", e.padding = "0px", e.background = "transparent", e["float"] = "left", e.cssFloat = "left", e.styleFloat = "left", e.zIndex = 999999999, e.cursor = "default"
        }(this.displayRegion.style, this.borderWidth), this.displayRegionContainer = e.makeNeutralElement("div"), this.displayRegionContainer.id = this.element.id + "-displayregioncontainer", this.displayRegionContainer.className = "displayregioncontainer", this.displayRegionContainer.style.width = "100%", this.displayRegionContainer.style.height = "100%", u.addControl(this.element, o.controlOptions), this._resizeWithViewer = o.controlOptions.anchor != e.ControlAnchor.ABSOLUTE && o.controlOptions.anchor != e.ControlAnchor.NONE, this._resizeWithViewer && (o.width && o.height ? (this.element.style.height = typeof o.height == "number" ? o.height + "px" : o.height, this.element.style.width = typeof o.width == "number" ? o.width + "px" : o.width) : (f = e.getElementSize(u.element), this.element.style.height = Math.round(f.y * o.sizeRatio) + "px", this.element.style.width = Math.round(f.x * o.sizeRatio) + "px", this.oldViewerSize = f), l = e.getElementSize(this.element), this.elementArea = l.x * l.y), this.oldContainerSize = new e.Point(0, 0), e.Viewer.apply(this, [o]), this.displayRegionContainer.appendChild(this.displayRegion), this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);
        if (o.navigatorRotate) {
            var h = o.viewer.viewport ? o.viewer.viewport.getRotation() : o.viewer.degrees || 0;
            c(h), o.viewer.addHandler("rotate", function (e) {
                c(e.degrees)
            })
        }
        this.innerTracker.destroy(), this.innerTracker = new e.MouseTracker({
            element: this.element,
            dragHandler: e.delegate(this, n),
            clickHandler: e.delegate(this, t),
            releaseHandler: e.delegate(this, r),
            scrollHandler: e.delegate(this, i)
        }), this.addHandler("reset-size", function () {
            a.viewport && a.viewport.goHome(!0)
        }), u.world.addHandler("item-index-change", function (e) {
            window.setTimeout(function () {
                var t = a.world.getItemAt(e.previousIndex);
                a.world.setItemIndex(t, e.newIndex)
            }, 1)
        }), u.world.addHandler("remove-item", function (e) {
            var t = e.item, n = a._getMatchingItem(t);
            n && a.world.removeItem(n)
        }), this.update(u.viewport)
    }, e.extend(e.Navigator.prototype, e.EventSource.prototype, e.Viewer.prototype, {
        updateSize: function () {
            if (this.viewport) {
                var t = new e.Point(this.container.clientWidth === 0 ? 1 : this.container.clientWidth, this.container.clientHeight === 0 ? 1 : this.container.clientHeight);
                t.equals(this.oldContainerSize) || (this.viewport.resize(t, !0), this.viewport.goHome(!0), this.oldContainerSize = t, this.drawer.clear(), this.world.draw())
            }
        }, update: function (t) {
            var n, r, i, s, o, u;
            n = e.getElementSize(this.viewer.element), this._resizeWithViewer && n.x && n.y && !n.equals(this.oldViewerSize) && (this.oldViewerSize = n, this.maintainSizeRatio || !this.elementArea ? (r = n.x * this.sizeRatio, i = n.y * this.sizeRatio) : (r = Math.sqrt(this.elementArea * (n.x / n.y)), i = this.elementArea / r), this.element.style.width = Math.round(r) + "px", this.element.style.height = Math.round(i) + "px", this.elementArea || (this.elementArea = r * i), this.updateSize());
            if (t && this.viewport) {
                s = t.getBoundsNoRotate(!0), o = this.viewport.pixelFromPointNoRotate(s.getTopLeft(), !1), u = this.viewport.pixelFromPointNoRotate(s.getBottomRight(), !1).minus(this.totalBorderWidths);
                var a = this.displayRegion.style;
                a.display = this.world.getItemCount() ? "block" : "none", a.top = Math.round(o.y) + "px", a.left = Math.round(o.x) + "px";
                var f = Math.abs(o.x - u.x), l = Math.abs(o.y - u.y);
                a.width = Math.round(Math.max(f, 0)) + "px", a.height = Math.round(Math.max(l, 0)) + "px"
            }
        }, addTiledImage: function (t) {
            var n = this, r = t.originalTiledImage;
            delete t.original;
            var i = e.extend({}, t, {
                success: function (e) {
                    function i() {
                        n._matchBounds(t, r)
                    }

                    function s() {
                        n._matchOpacity(t, r)
                    }

                    function o() {
                        n._matchCompositeOperation(t, r)
                    }

                    var t = e.item;
                    t._originalForNavigator = r, n._matchBounds(t, r, !0), r.addHandler("bounds-change", i), r.addHandler("clip-change", i), r.addHandler("opacity-change", s), r.addHandler("composite-operation-change", o)
                }
            });
            return e.Viewer.prototype.addTiledImage.apply(this, [i])
        }, _getMatchingItem: function (e) {
            var t = this.world.getItemCount(), n;
            for (var r = 0; r < t; r++) {
                n = this.world.getItemAt(r);
                if (n._originalForNavigator === e) return n
            }
            return null
        }, _matchBounds: function (e, t, n) {
            var r = t.getBoundsNoRotate();
            e.setPosition(r.getTopLeft(), n), e.setWidth(r.width, n), e.setRotation(t.getRotation(), n), e.setClip(t.getClip())
        }, _matchOpacity: function (e, t) {
            e.setOpacity(t.opacity)
        }, _matchCompositeOperation: function (e, t) {
            e.setCompositeOperation(t.compositeOperation)
        }
    })
}(OpenSeadragon),function (e) {
    var t = {
        Errors: {
            Dzc: "Sorry, we don't support Deep Zoom Collections!",
            Dzi: "Hmm, this doesn't appear to be a valid Deep Zoom Image.",
            Xml: "Hmm, this doesn't appear to be a valid Deep Zoom Image.",
            ImageFormat: "Sorry, we don't support {0}-based Deep Zoom Images.",
            Security: "It looks like a security restriction stopped us from loading this Deep Zoom Image.",
            Status: "This space unintentionally left blank ({0} {1}).",
            OpenFailed: "Unable to open {0}: {1}"
        },
        Tooltips: {
            FullPage: "Toggle full page",
            Home: "Go home",
            ZoomIn: "Zoom in",
            ZoomOut: "Zoom out",
            NextPage: "Next page",
            PreviousPage: "Previous page",
            RotateLeft: "Rotate left",
            RotateRight: "Rotate right"
        }
    };
    e.extend(e, {
        getString: function (n) {
            var r = n.split("."), i = null, s = arguments, o = t, u;
            for (u = 0; u < r.length - 1; u++) o = o[r[u]] || {};
            return i = o[r[u]], typeof i != "string" && (e.console.log("Untranslated source string:", n), i = ""), i.replace(/\{\d+\}/g, function (e) {
                var t = parseInt(e.match(/\d+/), 10) + 1;
                return t < s.length ? s[t] : ""
            })
        }, setString: function (e, n) {
            var r = e.split("."), i = t, s;
            for (s = 0; s < r.length - 1; s++) i[r[s]] || (i[r[s]] = {}), i = i[r[s]];
            i[r[s]] = n
        }
    })
}(OpenSeadragon),function (e) {
    e.Point = function (e, t) {
        this.x = typeof e == "number" ? e : 0, this.y = typeof t == "number" ? t : 0
    }, e.Point.prototype = {
        clone: function () {
            return new e.Point(this.x, this.y)
        }, plus: function (t) {
            return new e.Point(this.x + t.x, this.y + t.y)
        }, minus: function (t) {
            return new e.Point(this.x - t.x, this.y - t.y)
        }, times: function (t) {
            return new e.Point(this.x * t, this.y * t)
        }, divide: function (t) {
            return new e.Point(this.x / t, this.y / t)
        }, negate: function () {
            return new e.Point(-this.x, -this.y)
        }, distanceTo: function (e) {
            return Math.sqrt(Math.pow(this.x - e.x, 2) + Math.pow(this.y - e.y, 2))
        }, squaredDistanceTo: function (e) {
            return Math.pow(this.x - e.x, 2) + Math.pow(this.y - e.y, 2)
        }, apply: function (t) {
            return new e.Point(t(this.x), t(this.y))
        }, equals: function (t) {
            return t instanceof e.Point && this.x === t.x && this.y === t.y
        }, rotate: function (t, n) {
            n = n || new e.Point(0, 0);
            var r, i;
            if (t % 90 === 0) {
                var s = e.positiveModulo(t, 360);
                switch (s) {
                    case 0:
                        r = 1, i = 0;
                        break;
                    case 90:
                        r = 0, i = 1;
                        break;
                    case 180:
                        r = -1, i = 0;
                        break;
                    case 270:
                        r = 0, i = -1
                }
            } else {
                var o = t * Math.PI / 180;
                r = Math.cos(o), i = Math.sin(o)
            }
            var u = r * (this.x - n.x) - i * (this.y - n.y) + n.x, a = i * (this.x - n.x) + r * (this.y - n.y) + n.y;
            return new e.Point(u, a)
        }, toString: function () {
            return "(" + Math.round(this.x * 100) / 100 + "," + Math.round(this.y * 100) / 100 + ")"
        }
    }
}(OpenSeadragon),function (e) {
    function t(t) {
        var n = t.responseText, r = t.status, i, s;
        if (!t) throw new Error(e.getString("Errors.Security"));
        if (t.status !== 200 && t.status !== 0) throw r = t.status, i = r == 404 ? "Not Found" : t.statusText, new Error(e.getString("Errors.Status", r, i));
        if (n.match(/\s*<.*/)) try {
            s = t.responseXML && t.responseXML.documentElement ? t.responseXML : e.parseXml(n)
        } catch (o) {
            s = t.responseText
        } else if (n.match(/\s*[\{\[].*/)) try {
            s = e.parseJSON(n)
        } catch (o) {
            s = n
        } else s = n;
        return s
    }

    e.TileSource = function (t, n, r, i, s, o) {
        var u = this, a = arguments, f, l;
        e.isPlainObject(t) ? f = t : f = {
            width: a[0],
            height: a[1],
            tileSize: a[2],
            tileOverlap: a[3],
            minLevel: a[4],
            maxLevel: a[5]
        }, e.EventSource.call(this), e.extend(!0, this, f);
        if (!this.success) for (l = 0; l < arguments.length; l++) if (e.isFunction(arguments[l])) {
            this.success = arguments[l];
            break
        }
        this.success && this.addHandler("ready", function (e) {
            u.success(e)
        }), "string" == e.type(arguments[0]) && (this.url = arguments[0]), this.url ? (this.aspectRatio = 1, this.dimensions = new e.Point(10, 10), this._tileWidth = 0, this._tileHeight = 0, this.tileOverlap = 0, this.minLevel = 0, this.maxLevel = 0, this.ready = !1, this.getImageInfo(this.url)) : (this.ready = !0, this.aspectRatio = f.width && f.height ? f.width / f.height : 1, this.dimensions = new e.Point(f.width, f.height), this.tileSize ? (this._tileWidth = this._tileHeight = this.tileSize, delete this.tileSize) : (this.tileWidth ? (this._tileWidth = this.tileWidth, delete this.tileWidth) : this._tileWidth = 0, this.tileHeight ? (this._tileHeight = this.tileHeight, delete this.tileHeight) : this._tileHeight = 0), this.tileOverlap = f.tileOverlap ? f.tileOverlap : 0, this.minLevel = f.minLevel ? f.minLevel : 0, this.maxLevel = undefined !== f.maxLevel && null !== f.maxLevel ? f.maxLevel : f.width && f.height ? Math.ceil(Math.log(Math.max(f.width, f.height)) / Math.log(2)) : 0, this.success && e.isFunction(this.success) && this.success(this))
    }, e.TileSource.prototype = {
        getTileSize: function (t) {
            return e.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"), this._tileWidth
        }, getTileWidth: function (e) {
            return this._tileWidth ? this._tileWidth : this.getTileSize(e)
        }, getTileHeight: function (e) {
            return this._tileHeight ? this._tileHeight : this.getTileSize(e)
        }, getLevelScale: function (e) {
            var t = {}, n;
            for (n = 0; n <= this.maxLevel; n++) t[n] = 1 / Math.pow(2, this.maxLevel - n);
            return this.getLevelScale = function (e) {
                return t[e]
            }, this.getLevelScale(e)
        }, getNumTiles: function (t) {
            var n = this.getLevelScale(t), r = Math.ceil(n * this.dimensions.x / this.getTileWidth(t)),
                i = Math.ceil(n * this.dimensions.y / this.getTileHeight(t));
            return new e.Point(r, i)
        }, getPixelRatio: function (t) {
            var n = this.dimensions.times(this.getLevelScale(t)), r = 1 / n.x, i = 1 / n.y;
            return new e.Point(r, i)
        }, getClosestLevel: function () {
            var e, t;
            for (e = this.minLevel + 1; e <= this.maxLevel; e++) {
                t = this.getNumTiles(e);
                if (t.x > 1 || t.y > 1) break
            }
            return e - 1
        }, getTileAtPoint: function (t, n) {
            var r = n.x >= 0 && n.x <= 1 && n.y >= 0 && n.y <= 1 / this.aspectRatio;
            e.console.assert(r, "[TileSource.getTileAtPoint] must be called with a valid point.");
            var i = this.dimensions.x * this.getLevelScale(t), s = n.x * i, o = n.y * i,
                u = Math.floor(s / this.getTileWidth(t)), a = Math.floor(o / this.getTileHeight(t));
            n.x >= 1 && (u = this.getNumTiles(t).x - 1);
            var f = 1e-16;
            return n.y >= 1 / this.aspectRatio - f && (a = this.getNumTiles(t).y - 1), new e.Point(u, a)
        }, getTileBounds: function (t, n, r) {
            var i = this.dimensions.times(this.getLevelScale(t)), s = this.getTileWidth(t), o = this.getTileHeight(t),
                u = n === 0 ? 0 : s * n - this.tileOverlap, a = r === 0 ? 0 : o * r - this.tileOverlap,
                f = s + (n === 0 ? 1 : 2) * this.tileOverlap, l = o + (r === 0 ? 1 : 2) * this.tileOverlap, c = 1 / i.x;
            return f = Math.min(f, i.x - u), l = Math.min(l, i.y - a), new e.Rect(u * c, a * c, f * c, l * c)
        }, getImageInfo: function (n) {
            var r = this, i, s, o, u, a, f, l;
            n && (a = n.split("/"), f = a[a.length - 1], l = f.lastIndexOf("."), l > -1 && (a[a.length - 1] = f.slice(0, l))), s = function (t) {
                typeof t == "string" && (t = e.parseXml(t));
                var i = e.TileSource.determineType(r, t, n);
                if (!i) {
                    r.raiseEvent("open-failed", {message: "Unable to load TileSource", source: n});
                    return
                }
                u = i.prototype.configure.apply(r, [t, n]), u.ajaxWithCredentials === undefined && (u.ajaxWithCredentials = r.ajaxWithCredentials), o = new i(u), r.ready = !0, r.raiseEvent("ready", {tileSource: o})
            }, n.match(/\.js$/) ? (i = n.split("/").pop().replace(".js", ""), e.jsonp({
                url: n,
                async: !1,
                callbackName: i,
                callback: s
            })) : e.makeAjaxRequest({
                url: n,
                withCredentials: this.ajaxWithCredentials,
                headers: this.ajaxHeaders,
                success: function (e) {
                    var n = t(e);
                    s(n)
                },
                error: function (e, t) {
                    var i;
                    try {
                        i = "HTTP " + e.status + " attempting to load TileSource"
                    } catch (s) {
                        var o;
                        typeof t == "undefined" || !t.toString ? o = "Unknown error" : o = t.toString(), i = o + " attempting to load TileSource"
                    }
                    r.raiseEvent("open-failed", {message: i, source: n})
                }
            })
        }, supports: function (e, t) {
            return !1
        }, configure: function (e, t) {
            throw new Error("Method not implemented.")
        }, getTileUrl: function (e, t, n) {
            throw new Error("Method not implemented.")
        }, getTileAjaxHeaders: function (e, t, n) {
            return {}
        }, tileExists: function (e, t, n) {
            var r = this.getNumTiles(e);
            return e >= this.minLevel && e <= this.maxLevel && t >= 0 && n >= 0 && t < r.x && n < r.y
        }
    }, e.extend(!0, e.TileSource.prototype, e.EventSource.prototype), e.TileSource.determineType = function (t, n, r) {
        var i;
        for (i in OpenSeadragon) if (i.match(/.+TileSource$/) && e.isFunction(OpenSeadragon[i]) && e.isFunction(OpenSeadragon[i].prototype.supports) && OpenSeadragon[i].prototype.supports.call(t, n, r)) return OpenSeadragon[i];
        e.console.error("No TileSource was able to open %s %s", r, n)
    }
}(OpenSeadragon),function (e) {
    function t(t, r) {
        if (!r || !r.documentElement) throw new Error(e.getString("Errors.Xml"));
        var i = r.documentElement, s = i.localName || i.tagName, o = r.documentElement.namespaceURI, u = null, a = [],
            f, l, c, h, p;
        if (s == "Image") try {
            h = i.getElementsByTagName("Size")[0], h === undefined && (h = i.getElementsByTagNameNS(o, "Size")[0]), u = {
                Image: {
                    xmlns: "http://schemas.microsoft.com/deepzoom/2008",
                    Url: i.getAttribute("Url"),
                    Format: i.getAttribute("Format"),
                    DisplayRect: null,
                    Overlap: parseInt(i.getAttribute("Overlap"), 10),
                    TileSize: parseInt(i.getAttribute("TileSize"), 10),
                    Size: {Height: parseInt(h.getAttribute("Height"), 10), Width: parseInt(h.getAttribute("Width"), 10)}
                }
            };
            if (!e.imageFormatSupported(u.Image.Format)) throw new Error(e.getString("Errors.ImageFormat", u.Image.Format.toUpperCase()));
            f = i.getElementsByTagName("DisplayRect"), f === undefined && (f = i.getElementsByTagNameNS(o, "DisplayRect")[0]);
            for (p = 0; p < f.length; p++) l = f[p], c = l.getElementsByTagName("Rect")[0], c === undefined && (c = l.getElementsByTagNameNS(o, "Rect")[0]), a.push({
                Rect: {
                    X: parseInt(c.getAttribute("X"), 10),
                    Y: parseInt(c.getAttribute("Y"), 10),
                    Width: parseInt(c.getAttribute("Width"), 10),
                    Height: parseInt(c.getAttribute("Height"), 10),
                    MinLevel: parseInt(l.getAttribute("MinLevel"), 10),
                    MaxLevel: parseInt(l.getAttribute("MaxLevel"), 10)
                }
            });
            return a.length && (u.Image.DisplayRect = a), n(t, u)
        } catch (d) {
            throw d instanceof Error ? d : new Error(e.getString("Errors.Dzi"))
        } else {
            if (s == "Collection") throw new Error(e.getString("Errors.Dzc"));
            if (s == "Error") {
                var v = i.getElementsByTagName("Message")[0], m = v.firstChild.nodeValue;
                throw new Error(m)
            }
        }
        throw new Error(e.getString("Errors.Dzi"))
    }

    function n(t, n) {
        var r = n.Image, i = r.Url, s = r.Format, o = r.Size, u = r.DisplayRect || [], a = parseInt(o.Width, 10),
            f = parseInt(o.Height, 10), l = parseInt(r.TileSize, 10), c = parseInt(r.Overlap, 10), h = [], p, d;
        for (d = 0; d < u.length; d++) p = u[d].Rect, h.push(new e.DisplayRect(parseInt(p.X, 10), parseInt(p.Y, 10), parseInt(p.Width, 10), parseInt(p.Height, 10), parseInt(p.MinLevel, 10), parseInt(p.MaxLevel, 10)));
        return e.extend(!0, {
            width: a,
            height: f,
            tileSize: l,
            tileOverlap: c,
            minLevel: null,
            maxLevel: null,
            tilesUrl: i,
            fileFormat: s,
            displayRects: h
        }, n)
    }

    e.DziTileSource = function (t, n, r, i, s, o, u, a, f) {
        var l, c, h, p;
        e.isPlainObject(t) ? p = t : p = {
            width: arguments[0],
            height: arguments[1],
            tileSize: arguments[2],
            tileOverlap: arguments[3],
            tilesUrl: arguments[4],
            fileFormat: arguments[5],
            displayRects: arguments[6],
            minLevel: arguments[7],
            maxLevel: arguments[8]
        }, this._levelRects = {}, this.tilesUrl = p.tilesUrl, this.fileFormat = p.fileFormat, this.displayRects = p.displayRects;
        if (this.displayRects) for (l = this.displayRects.length - 1; l >= 0; l--) {
            c = this.displayRects[l];
            for (h = c.minLevel; h <= c.maxLevel; h++) this._levelRects[h] || (this._levelRects[h] = []), this._levelRects[h].push(c)
        }
        e.TileSource.apply(this, [p])
    }, e.extend(e.DziTileSource.prototype, e.TileSource.prototype, {
        supports: function (e, t) {
            var n;
            return e.Image ? n = e.Image.xmlns : e.documentElement && ("Image" == e.documentElement.localName || "Image" == e.documentElement.tagName) && (n = e.documentElement.namespaceURI), n = (n || "").toLowerCase(), n.indexOf("schemas.microsoft.com/deepzoom/2008") !== -1 || n.indexOf("schemas.microsoft.com/deepzoom/2009") !== -1
        }, configure: function (r, i) {
            var s;
            return e.isPlainObject(r) ? s = n(this, r) : s = t(this, r), i && !s.tilesUrl && (s.tilesUrl = i.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/, "$1_files/"), i.search(/\.(dzi|xml|js)\?/) != -1 ? s.queryParams = i.match(/\?.*/) : s.queryParams = ""), s
        }, getTileUrl: function (e, t, n) {
            return [this.tilesUrl, e, "/", t, "_", n, ".", this.fileFormat, this.queryParams].join("")
        }, tileExists: function (e, t, n) {
            var r = this._levelRects[e], i, s, o, u, a, f, l;
            if (!r || !r.length) return !0;
            for (l = r.length - 1; l >= 0; l--) {
                i = r[l];
                if (e < i.minLevel || e > i.maxLevel) continue;
                s = this.getLevelScale(e), o = i.x * s, u = i.y * s, a = o + i.width * s, f = u + i.height * s, o = Math.floor(o / this._tileWidth), u = Math.floor(u / this._tileWidth), a = Math.ceil(a / this._tileWidth), f = Math.ceil(f / this._tileWidth);
                if (o <= t && t < a && u <= n && n < f) return !0
            }
            return !1
        }
    })
}(OpenSeadragon),function (e) {
    function t(e) {
        var t = ["http://library.stanford.edu/iiif/image-api/compliance.html#level0", "http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0", "http://iiif.io/api/image/2/level0.json"],
            n = t.indexOf(e[0]) != -1;
        return !n || e.indexOf("sizeByW") != -1
    }

    function n(e) {
        var t = [];
        for (var n = 0; n < e.sizes.length; n++) t.push({
            url: e["@id"] + "/full/" + e.sizes[n].width + ",/0/default.jpg",
            width: e.sizes[n].width,
            height: e.sizes[n].height
        });
        return t.sort(function (e, t) {
            return e.width - t.width
        })
    }

    function r(t) {
        if (!t || !t.documentElement) throw new Error(e.getString("Errors.Xml"));
        var n = t.documentElement, r = n.tagName, s = null;
        if (r == "info") try {
            return s = {}, i(n, s), s
        } catch (o) {
            throw o instanceof Error ? o : new Error(e.getString("Errors.IIIF"))
        }
        throw new Error(e.getString("Errors.IIIF"))
    }

    function i(t, n, r) {
        var s, o;
        if (t.nodeType == 3 && r) o = t.nodeValue.trim(), o.match(/^\d*$/) && (o = Number(o)), n[r] ? (e.isArray(n[r]) || (n[r] = [n[r]]), n[r].push(o)) : n[r] = o; else if (t.nodeType == 1) for (s = 0; s < t.childNodes.length; s++) i(t.childNodes[s], n, t.nodeName)
    }

    e.IIIFTileSource = function (r) {
        e.extend(!0, this, r);
        if (!(this.height && this.width && this["@id"])) throw new Error("IIIF required parameters not provided.");
        r.tileSizePerScaleFactor = {};
        if (this.tile_width && this.tile_height) r.tileWidth = this.tile_width, r.tileHeight = this.tile_height; else if (this.tile_width) r.tileSize = this.tile_width; else if (this.tile_height) r.tileSize = this.tile_height; else if (this.tiles) if (this.tiles.length == 1) r.tileWidth = this.tiles[0].width, r.tileHeight = this.tiles[0].height || this.tiles[0].width, this.scale_factors = this.tiles[0].scaleFactors; else {
            this.scale_factors = [];
            for (var i = 0; i < this.tiles.length; i++) for (var s = 0; s < this.tiles[i].scaleFactors.length; s++) {
                var o = this.tiles[i].scaleFactors[s];
                this.scale_factors.push(o), r.tileSizePerScaleFactor[o] = {
                    width: this.tiles[i].width,
                    height: this.tiles[i].height || this.tiles[i].width
                }
            }
        } else if (t(r.profile)) {
            var u = Math.min(this.height, this.width), a = [256, 512, 1024], f = [];
            for (var l = 0; l < a.length; l++) a[l] <= u && f.push(a[l]);
            f.length > 0 ? r.tileSize = Math.max.apply(null, f) : r.tileSize = u
        } else this.sizes && this.sizes.length > 0 ? (this.emulateLegacyImagePyramid = !0, r.levels = n(this), e.extend(!0, r, {
            width: r.levels[r.levels.length - 1].width,
            height: r.levels[r.levels.length - 1].height,
            tileSize: Math.max(r.height, r.width),
            tileOverlap: 0,
            minLevel: 0,
            maxLevel: r.levels.length - 1
        }), this.levels = r.levels) : e.console.error("Nothing in the info.json to construct image pyramids from");
        !r.maxLevel && !this.emulateLegacyImagePyramid && (this.scale_factors ? r.maxLevel = Math.floor(Math.pow(Math.max.apply(null, this.scale_factors), .5)) : r.maxLevel = Number(Math.ceil(Math.log(Math.max(this.width, this.height), 2)))), e.TileSource.apply(this, [r])
    }, e.extend(e.IIIFTileSource.prototype, e.TileSource.prototype, {
        supports: function (e, t) {
            return e.protocol && e.protocol == "http://iiif.io/api/image" ? !0 : !e["@context"] || e["@context"] != "http://library.stanford.edu/iiif/image-api/1.1/context.json" && e["@context"] != "http://iiif.io/api/image/1/context.json" ? e.profile && e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html") === 0 ? !0 : e.identifier && e.width && e.height ? !0 : e.documentElement && "info" == e.documentElement.tagName && "http://library.stanford.edu/iiif/image-api/ns/" == e.documentElement.namespaceURI ? !0 : !1 : !0
        }, configure: function (t, n) {
            if (!e.isPlainObject(t)) {
                var i = r(t);
                return i["@context"] = "http://iiif.io/api/image/1.0/context.json", i["@id"] = n.replace("/info.xml", ""), i
            }
            return t["@context"] ? t : (t["@context"] = "http://iiif.io/api/image/1.0/context.json", t["@id"] = n.replace("/info.json", ""), t)
        }, getTileWidth: function (t) {
            if (this.emulateLegacyImagePyramid) return e.TileSource.prototype.getTileWidth.call(this, t);
            var n = Math.pow(2, this.maxLevel - t);
            return this.tileSizePerScaleFactor && this.tileSizePerScaleFactor[n] ? this.tileSizePerScaleFactor[n].width : this._tileWidth
        }, getTileHeight: function (t) {
            if (this.emulateLegacyImagePyramid) return e.TileSource.prototype.getTileHeight.call(this, t);
            var n = Math.pow(2, this.maxLevel - t);
            return this.tileSizePerScaleFactor && this.tileSizePerScaleFactor[n] ? this.tileSizePerScaleFactor[n].height : this._tileHeight
        }, getLevelScale: function (t) {
            if (this.emulateLegacyImagePyramid) {
                var n = NaN;
                return this.levels.length > 0 && t >= this.minLevel && t <= this.maxLevel && (n = this.levels[t].width / this.levels[this.maxLevel].width), n
            }
            return e.TileSource.prototype.getLevelScale.call(this, t)
        }, getNumTiles: function (t) {
            if (this.emulateLegacyImagePyramid) {
                var n = this.getLevelScale(t);
                return n ? new e.Point(1, 1) : new e.Point(0, 0)
            }
            return e.TileSource.prototype.getNumTiles.call(this, t)
        }, getTileAtPoint: function (t, n) {
            return this.emulateLegacyImagePyramid ? new e.Point(0, 0) : e.TileSource.prototype.getTileAtPoint.call(this, t, n)
        }, getTileUrl: function (e, t, n) {
            if (this.emulateLegacyImagePyramid) {
                var r = null;
                return this.levels.length > 0 && e >= this.minLevel && e <= this.maxLevel && (r = this.levels[e].url), r
            }
            var i = "0", s = Math.pow(.5, this.maxLevel - e), o = Math.ceil(this.width * s),
                u = Math.ceil(this.height * s), a, f, l, c, h, p, d, v, m, g, y, b;
            return a = this.getTileWidth(e), f = this.getTileHeight(e), l = Math.ceil(a / s), c = Math.ceil(f / s), this["@context"].indexOf("/1.0/context.json") > -1 || this["@context"].indexOf("/1.1/context.json") > -1 || this["@context"].indexOf("/1/context.json") > -1 ? y = "native.jpg" : y = "default.jpg", o < a && u < f ? (g = o + ",", h = "full") : (p = t * l, d = n * c, v = Math.min(l, this.width - p), m = Math.min(c, this.height - d), g = Math.ceil(v * s) + ",", h = [p, d, v, m].join(",")), b = [this["@id"], h, g, i, y].join("/"), b
        }
    })
}(OpenSeadragon),function (e) {
    e.OsmTileSource = function (t, n, r, i, s) {
        var o;
        e.isPlainObject(t) ? o = t : o = {
            width: arguments[0],
            height: arguments[1],
            tileSize: arguments[2],
            tileOverlap: arguments[3],
            tilesUrl: arguments[4]
        };
        if (!o.width || !o.height) o.width = 65572864, o.height = 65572864;
        o.tileSize || (o.tileSize = 256, o.tileOverlap = 0), o.tilesUrl || (o.tilesUrl = "http://tile.openstreetmap.org/"), o.minLevel = 8, e.TileSource.apply(this, [o])
    }, e.extend(e.OsmTileSource.prototype, e.TileSource.prototype, {
        supports: function (e, t) {
            return e.type && "openstreetmaps" == e.type
        }, configure: function (e, t) {
            return e
        }, getTileUrl: function (e, t, n) {
            return this.tilesUrl + (e - 8) + "/" + t + "/" + n + ".png"
        }
    })
}(OpenSeadragon),function (e) {
    e.TmsTileSource = function (t, n, r, i, s) {
        var o;
        e.isPlainObject(t) ? o = t : o = {
            width: arguments[0],
            height: arguments[1],
            tileSize: arguments[2],
            tileOverlap: arguments[3],
            tilesUrl: arguments[4]
        };
        var u = Math.ceil(o.width / 256) * 256, a = Math.ceil(o.height / 256) * 256, f;
        u > a ? f = u / 256 : f = a / 256, o.maxLevel = Math.ceil(Math.log(f) / Math.log(2)) - 1, o.tileSize = 256, o.width = u, o.height = a, e.TileSource.apply(this, [o])
    }, e.extend(e.TmsTileSource.prototype, e.TileSource.prototype, {
        supports: function (e, t) {
            return e.type && "tiledmapservice" == e.type
        }, configure: function (e, t) {
            return e
        }, getTileUrl: function (e, t, n) {
            var r = this.getNumTiles(e).y - 1;
            return this.tilesUrl + e + "/" + t + "/" + (r - n) + ".png"
        }
    })
}(OpenSeadragon),function (e) {
    e.ZoomifyTileSource = function (e) {
        e.tileSize = 256;
        var t = {x: e.width, y: e.height};
        e.imageSizes = [{x: e.width, y: e.height}], e.gridSize = [this._getGridSize(e.width, e.height, e.tileSize)];
        while (parseInt(t.x, 10) > e.tileSize || parseInt(t.y, 10) > e.tileSize) t.x = Math.floor(t.x / 2), t.y = Math.floor(t.y / 2), e.imageSizes.push({
            x: t.x,
            y: t.y
        }), e.gridSize.push(this._getGridSize(t.x, t.y, e.tileSize));
        e.imageSizes.reverse(), e.gridSize.reverse(), e.minLevel = 0, e.maxLevel = e.gridSize.length - 1, OpenSeadragon.TileSource.apply(this, [e])
    }, e.extend(e.ZoomifyTileSource.prototype, e.TileSource.prototype, {
        _getGridSize: function (e, t, n) {
            return {x: Math.ceil(e / n), y: Math.ceil(t / n)}
        }, _calculateAbsoluteTileNumber: function (e, t, n) {
            var r = 0, i = {};
            for (var s = 0; s < e; s++) i = this.gridSize[s], r += i.x * i.y;
            return i = this.gridSize[e], r += i.x * n + t, r
        }, supports: function (e, t) {
            return e.type && "zoomifytileservice" == e.type
        }, configure: function (e, t) {
            return e
        }, getTileUrl: function (e, t, n) {
            var r = 0, i = this._calculateAbsoluteTileNumber(e, t, n);
            return r = Math.floor(i / 256), this.tilesUrl + "TileGroup" + r + "/" + e + "-" + t + "-" + n + ".jpg"
        }
    })
}(OpenSeadragon),function (e) {
    function t(t) {
        var n = [], r, i;
        for (i = 0; i < t.length; i++) r = t[i], r.height && r.width && r.url ? n.push({
            url: r.url,
            width: Number(r.width),
            height: Number(r.height)
        }) : e.console.error("Unsupported image format: %s", r.url ? r.url : "<no URL>");
        return n.sort(function (e, t) {
            return e.height - t.height
        })
    }

    function n(t, n) {
        if (!n || !n.documentElement) throw new Error(e.getString("Errors.Xml"));
        var i = n.documentElement, s = i.tagName, o = null, u = [], a, f;
        if (s == "image") try {
            o = {type: i.getAttribute("type"), levels: []}, u = i.getElementsByTagName("level");
            for (f = 0; f < u.length; f++) a = u[f], o.levels.push({
                url: a.getAttribute("url"),
                width: parseInt(a.getAttribute("width"), 10),
                height: parseInt(a.getAttribute("height"), 10)
            });
            return r(t, o)
        } catch (l) {
            throw l instanceof Error ? l : new Error("Unknown error parsing Legacy Image Pyramid XML.")
        } else {
            if (s == "collection") throw new Error("Legacy Image Pyramid Collections not yet supported.");
            if (s == "error") throw new Error("Error: " + n)
        }
        throw new Error("Unknown element " + s)
    }

    function r(e, t) {
        return t.levels
    }

    e.LegacyTileSource = function (n) {
        var r, i, s;
        e.isArray(n) && (r = {
            type: "legacy-image-pyramid",
            levels: n
        }), r.levels = t(r.levels), r.levels.length > 0 ? (i = r.levels[r.levels.length - 1].width, s = r.levels[r.levels.length - 1].height) : (i = 0, s = 0, e.console.error("No supported image formats found")), e.extend(!0, r, {
            width: i,
            height: s,
            tileSize: Math.max(s, i),
            tileOverlap: 0,
            minLevel: 0,
            maxLevel: r.levels.length > 0 ? r.levels.length - 1 : 0
        }), e.TileSource.apply(this, [r]), this.levels = r.levels
    }, e.extend(e.LegacyTileSource.prototype, e.TileSource.prototype, {
        supports: function (e, t) {
            return e.type && "legacy-image-pyramid" == e.type || e.documentElement && "legacy-image-pyramid" == e.documentElement.getAttribute("type")
        }, configure: function (t, i) {
            var s;
            return e.isPlainObject(t) ? s = r(this, t) : s = n(this, t), s
        }, getLevelScale: function (e) {
            var t = NaN;
            return this.levels.length > 0 && e >= this.minLevel && e <= this.maxLevel && (t = this.levels[e].width / this.levels[this.maxLevel].width), t
        }, getNumTiles: function (t) {
            var n = this.getLevelScale(t);
            return n ? new e.Point(1, 1) : new e.Point(0, 0)
        }, getTileUrl: function (e, t, n) {
            var r = null;
            return this.levels.length > 0 && e >= this.minLevel && e <= this.maxLevel && (r = this.levels[e].url), r
        }
    })
}(OpenSeadragon),function (e) {
    e.ImageTileSource = function (t) {
        t = e.extend({
            buildPyramid: !0,
            crossOriginPolicy: !1,
            ajaxWithCredentials: !1,
            useCanvas: !0
        }, t), e.TileSource.apply(this, [t])
    }, e.extend(e.ImageTileSource.prototype, e.TileSource.prototype, {
        supports: function (e, t) {
            return e.type && e.type === "image"
        }, configure: function (e, t) {
            return e
        }, getImageInfo: function (t) {
            var n = this._image = new Image, r = this;
            this.crossOriginPolicy && (n.crossOrigin = this.crossOriginPolicy), this.ajaxWithCredentials && (n.useCredentials = this.ajaxWithCredentials), e.addEvent(n, "load", function () {
                r.width = Object.prototype.hasOwnProperty.call(n, "naturalWidth") ? n.naturalWidth : n.width, r.height = Object.prototype.hasOwnProperty.call(n, "naturalHeight") ? n.naturalHeight : n.height, r.aspectRatio = r.width / r.height, r.dimensions = new e.Point(r.width, r.height), r._tileWidth = r.width, r._tileHeight = r.height, r.tileOverlap = 0, r.minLevel = 0, r.levels = r._buildLevels(), r.maxLevel = r.levels.length - 1, r.ready = !0, r.raiseEvent("ready", {tileSource: r})
            }), e.addEvent(n, "error", function () {
                r.raiseEvent("open-failed", {message: "Error loading image at " + t, source: t})
            }), n.src = t
        }, getLevelScale: function (e) {
            var t = NaN;
            return e >= this.minLevel && e <= this.maxLevel && (t = this.levels[e].width / this.levels[this.maxLevel].width), t
        }, getNumTiles: function (t) {
            var n = this.getLevelScale(t);
            return n ? new e.Point(1, 1) : new e.Point(0, 0)
        }, getTileUrl: function (e, t, n) {
            var r = null;
            return e >= this.minLevel && e <= this.maxLevel && (r = this.levels[e].url), r
        }, getContext2D: function (e, t, n) {
            var r = null;
            return e >= this.minLevel && e <= this.maxLevel && (r = this.levels[e].context2D), r
        }, _buildLevels: function () {
            var t = [{
                url: this._image.src,
                width: Object.prototype.hasOwnProperty.call(this._image, "naturalWidth") ? this._image.naturalWidth : this._image.width,
                height: Object.prototype.hasOwnProperty.call(this._image, "naturalHeight") ? this._image.naturalHeight : this._image.height
            }];
            if (!this.buildPyramid || !e.supportsCanvas || !this.useCanvas) return delete this._image, t;
            var n = Object.prototype.hasOwnProperty.call(this._image, "naturalWidth") ? this._image.naturalWidth : this._image.width,
                r = Object.prototype.hasOwnProperty.call(this._image, "naturalHeight") ? this._image.naturalHeight : this._image.height,
                i = document.createElement("canvas"), s = i.getContext("2d");
            i.width = n, i.height = r, s.drawImage(this._image, 0, 0, n, r), t[0].context2D = s, delete this._image;
            if (e.isCanvasTainted(i)) return t;
            while (n >= 2 && r >= 2) {
                n = Math.floor(n / 2), r = Math.floor(r / 2);
                var o = document.createElement("canvas"), u = o.getContext("2d");
                o.width = n, o.height = r, u.drawImage(i, 0, 0, n, r), t.splice(0, 0, {
                    context2D: u,
                    width: n,
                    height: r
                }), i = o, s = u
            }
            return t
        }
    })
}(OpenSeadragon),function (e) {
    e.TileSourceCollection = function (t, n, r, i) {
        e.console.error("TileSourceCollection is deprecated; use World instead")
    }
}(OpenSeadragon),function (e) {
    function t(t) {
        e.requestAnimationFrame(function () {
            n(t)
        })
    }

    function n(n) {
        var r, i, s;
        n.shouldFade && (r = e.now(), i = r - n.fadeBeginTime, s = 1 - i / n.fadeLength, s = Math.min(1, s), s = Math.max(0, s), n.imgGroup && e.setElementOpacity(n.imgGroup, s, !0), s > 0 && t(n))
    }

    function r(n) {
        n.shouldFade = !0, n.fadeBeginTime = e.now() + n.fadeDelay, window.setTimeout(function () {
            t(n)
        }, n.fadeDelay)
    }

    function i(t) {
        t.shouldFade = !1, t.imgGroup && e.setElementOpacity(t.imgGroup, 1, !0)
    }

    function s(t, n) {
        if (t.element.disabled) return;
        n >= e.ButtonState.GROUP && t.currentState == e.ButtonState.REST && (i(t), t.currentState = e.ButtonState.GROUP), n >= e.ButtonState.HOVER && t.currentState == e.ButtonState.GROUP && (t.imgHover && (t.imgHover.style.visibility = ""), t.currentState = e.ButtonState.HOVER), n >= e.ButtonState.DOWN && t.currentState == e.ButtonState.HOVER && (t.imgDown && (t.imgDown.style.visibility = ""), t.currentState = e.ButtonState.DOWN)
    }

    function o(t, n) {
        if (t.element.disabled) return;
        n <= e.ButtonState.HOVER && t.currentState == e.ButtonState.DOWN && (t.imgDown && (t.imgDown.style.visibility = "hidden"), t.currentState = e.ButtonState.HOVER), n <= e.ButtonState.GROUP && t.currentState == e.ButtonState.HOVER && (t.imgHover && (t.imgHover.style.visibility = "hidden"), t.currentState = e.ButtonState.GROUP), n <= e.ButtonState.REST && t.currentState == e.ButtonState.GROUP && (r(t), t.currentState = e.ButtonState.REST)
    }

    e.ButtonState = {REST: 0, GROUP: 1, HOVER: 2, DOWN: 3}, e.Button = function (t) {
        var n = this;
        e.EventSource.call(this), e.extend(!0, this, {
            tooltip: null,
            srcRest: null,
            srcGroup: null,
            srcHover: null,
            srcDown: null,
            clickTimeThreshold: e.DEFAULT_SETTINGS.clickTimeThreshold,
            clickDistThreshold: e.DEFAULT_SETTINGS.clickDistThreshold,
            fadeDelay: 0,
            fadeLength: 2e3,
            onPress: null,
            onRelease: null,
            onClick: null,
            onEnter: null,
            onExit: null,
            onFocus: null,
            onBlur: null
        }, t), this.element = t.element || e.makeNeutralElement("div"), t.element || (this.imgRest = e.makeTransparentImage(this.srcRest), this.imgGroup = e.makeTransparentImage(this.srcGroup), this.imgHover = e.makeTransparentImage(this.srcHover), this.imgDown = e.makeTransparentImage(this.srcDown), this.imgRest.alt = this.imgGroup.alt = this.imgHover.alt = this.imgDown.alt = this.tooltip, this.element.style.position = "relative", e.setElementTouchActionNone(this.element), this.imgGroup.style.position = this.imgHover.style.position = this.imgDown.style.position = "absolute", this.imgGroup.style.top = this.imgHover.style.top = this.imgDown.style.top = "0px", this.imgGroup.style.left = this.imgHover.style.left = this.imgDown.style.left = "0px", this.imgHover.style.visibility = this.imgDown.style.visibility = "hidden", e.Browser.vendor == e.BROWSERS.FIREFOX && e.Browser.version < 3 && (this.imgGroup.style.top = this.imgHover.style.top = this.imgDown.style.top = ""), this.element.appendChild(this.imgRest), this.element.appendChild(this.imgGroup), this.element.appendChild(this.imgHover), this.element.appendChild(this.imgDown)), this.addHandler("press", this.onPress), this.addHandler("release", this.onRelease), this.addHandler("click", this.onClick), this.addHandler("enter", this.onEnter), this.addHandler("exit", this.onExit), this.addHandler("focus", this.onFocus), this.addHandler("blur", this.onBlur), this.currentState = e.ButtonState.GROUP, this.fadeBeginTime = null, this.shouldFade = !1, this.element.style.display = "inline-block", this.element.style.position = "relative", this.element.title = this.tooltip, this.tracker = new e.MouseTracker({
            element: this.element,
            clickTimeThreshold: this.clickTimeThreshold,
            clickDistThreshold: this.clickDistThreshold,
            enterHandler: function (t) {
                t.insideElementPressed ? (s(n, e.ButtonState.DOWN), n.raiseEvent("enter", {originalEvent: t.originalEvent})) : t.buttonDownAny || s(n, e.ButtonState.HOVER)
            },
            focusHandler: function (e) {
                this.enterHandler(e), n.raiseEvent("focus", {originalEvent: e.originalEvent})
            },
            exitHandler: function (t) {
                o(n, e.ButtonState.GROUP), t.insideElementPressed && n.raiseEvent("exit", {originalEvent: t.originalEvent})
            },
            blurHandler: function (e) {
                this.exitHandler(e), n.raiseEvent("blur", {originalEvent: e.originalEvent})
            },
            pressHandler: function (t) {
                s(n, e.ButtonState.DOWN), n.raiseEvent("press", {originalEvent: t.originalEvent})
            },
            releaseHandler: function (t) {
                t.insideElementPressed && t.insideElementReleased ? (o(n, e.ButtonState.HOVER), n.raiseEvent("release", {originalEvent: t.originalEvent})) : t.insideElementPressed ? o(n, e.ButtonState.GROUP) : s(n, e.ButtonState.HOVER)
            },
            clickHandler: function (e) {
                e.quick && n.raiseEvent("click", {originalEvent: e.originalEvent})
            },
            keyHandler: function (e) {
                return 13 === e.keyCode ? (n.raiseEvent("click", {originalEvent: e.originalEvent}), n.raiseEvent("release", {originalEvent: e.originalEvent}), !1) : !0
            }
        }), o(this, e.ButtonState.REST)
    }, e.extend(e.Button.prototype, e.EventSource.prototype, {
        notifyGroupEnter: function () {
            s(this, e.ButtonState.GROUP)
        }, notifyGroupExit: function () {
            o(this, e.ButtonState.REST)
        }, disable: function () {
            this.notifyGroupExit(), this.element.disabled = !0, e.setElementOpacity(this.element, .2, !0)
        }, enable: function () {
            this.element.disabled = !1, e.setElementOpacity(this.element, 1, !0), this.notifyGroupEnter()
        }
    })
}(OpenSeadragon),function (e) {
    e.ButtonGroup = function (t) {
        e.extend(!0, this, {
            buttons: [],
            clickTimeThreshold: e.DEFAULT_SETTINGS.clickTimeThreshold,
            clickDistThreshold: e.DEFAULT_SETTINGS.clickDistThreshold,
            labelText: ""
        }, t);
        var n = this.buttons.concat([]), r = this, i;
        this.element = t.element || e.makeNeutralElement("div");
        if (!t.group) {
            this.label = e.makeNeutralElement("label"), this.element.style.display = "inline-block", this.element.appendChild(this.label);
            for (i = 0; i < n.length; i++) this.element.appendChild(n[i].element)
        }
        e.setElementTouchActionNone(this.element), this.tracker = new e.MouseTracker({
            element: this.element,
            clickTimeThreshold: this.clickTimeThreshold,
            clickDistThreshold: this.clickDistThreshold,
            enterHandler: function (e) {
                var t;
                for (t = 0; t < r.buttons.length; t++) r.buttons[t].notifyGroupEnter()
            },
            exitHandler: function (e) {
                var t;
                if (!e.insideElementPressed) for (t = 0; t < r.buttons.length; t++) r.buttons[t].notifyGroupExit()
            }
        })
    }, e.ButtonGroup.prototype = {
        emulateEnter: function () {
            this.tracker.enterHandler({eventSource: this.tracker})
        }, emulateExit: function () {
            this.tracker.exitHandler({eventSource: this.tracker})
        }
    }
}(OpenSeadragon),function (e) {
    e.Rect = function (t, n, r, i, s) {
        this.x = typeof t == "number" ? t : 0, this.y = typeof n == "number" ? n : 0, this.width = typeof r == "number" ? r : 0, this.height = typeof i == "number" ? i : 0, this.degrees = typeof s == "number" ? s : 0, this.degrees = e.positiveModulo(this.degrees, 360);
        var o, u;
        this.degrees >= 270 ? (o = this.getTopRight(), this.x = o.x, this.y = o.y, u = this.height, this.height = this.width, this.width = u, this.degrees -= 270) : this.degrees >= 180 ? (o = this.getBottomRight(), this.x = o.x, this.y = o.y, this.degrees -= 180) : this.degrees >= 90 && (o = this.getBottomLeft(), this.x = o.x, this.y = o.y, u = this.height, this.height = this.width, this.width = u, this.degrees -= 90)
    }, e.Rect.fromSummits = function (t, n, r) {
        var i = t.distanceTo(n), s = t.distanceTo(r), o = n.minus(t), u = Math.atan(o.y / o.x);
        return o.x < 0 ? u += Math.PI : o.y < 0 && (u += 2 * Math.PI), new e.Rect(t.x, t.y, i, s, u / Math.PI * 180)
    }, e.Rect.prototype = {
        clone: function () {
            return new e.Rect(this.x, this.y, this.width, this.height, this.degrees)
        }, getAspectRatio: function () {
            return this.width / this.height
        }, getTopLeft: function () {
            return new e.Point(this.x, this.y)
        }, getBottomRight: function () {
            return (new e.Point(this.x + this.width, this.y + this.height)).rotate(this.degrees, this.getTopLeft())
        }, getTopRight: function () {
            return (new e.Point(this.x + this.width, this.y)).rotate(this.degrees, this.getTopLeft())
        }, getBottomLeft: function () {
            return (new e.Point(this.x, this.y + this.height)).rotate(this.degrees, this.getTopLeft())
        }, getCenter: function () {
            return (new e.Point(this.x + this.width / 2, this.y + this.height / 2)).rotate(this.degrees, this.getTopLeft())
        }, getSize: function () {
            return new e.Point(this.width, this.height)
        }, equals: function (t) {
            return t instanceof e.Rect && this.x === t.x && this.y === t.y && this.width === t.width && this.height === t.height && this.degrees === t.degrees
        }, times: function (t) {
            return new e.Rect(this.x * t, this.y * t, this.width * t, this.height * t, this.degrees)
        }, translate: function (t) {
            return new e.Rect(this.x + t.x, this.y + t.y, this.width, this.height, this.degrees)
        }, union: function (t) {
            var n = this.getBoundingBox(), r = t.getBoundingBox(), i = Math.min(n.x, r.x), s = Math.min(n.y, r.y),
                o = Math.max(n.x + n.width, r.x + r.width), u = Math.max(n.y + n.height, r.y + r.height);
            return new e.Rect(i, s, o - i, u - s)
        }, intersection: function (t) {
            function b(t, r, i, s) {
                var o = r.minus(t), u = s.minus(i), a = -u.x * o.y + o.x * u.y;
                if (a === 0) return null;
                var f = (o.x * (t.y - i.y) - o.y * (t.x - i.x)) / a, l = (u.x * (t.y - i.y) - u.y * (t.x - i.x)) / a;
                return -n <= f && f <= 1 - n && -n <= l && l <= 1 - n ? new e.Point(t.x + l * o.x, t.y + l * o.y) : null
            }

            var n = 1e-10, r = [], i = this.getTopLeft();
            t.containsPoint(i, n) && r.push(i);
            var s = this.getTopRight();
            t.containsPoint(s, n) && r.push(s);
            var o = this.getBottomLeft();
            t.containsPoint(o, n) && r.push(o);
            var u = this.getBottomRight();
            t.containsPoint(u, n) && r.push(u);
            var a = t.getTopLeft();
            this.containsPoint(a, n) && r.push(a);
            var f = t.getTopRight();
            this.containsPoint(f, n) && r.push(f);
            var l = t.getBottomLeft();
            this.containsPoint(l, n) && r.push(l);
            var c = t.getBottomRight();
            this.containsPoint(c, n) && r.push(c);
            var h = this._getSegments(), p = t._getSegments();
            for (var d = 0; d < h.length; d++) {
                var v = h[d];
                for (var m = 0; m < p.length; m++) {
                    var g = p[m], y = b(v[0], v[1], g[0], g[1]);
                    y && r.push(y)
                }
            }
            if (r.length === 0) return null;
            var w = r[0].x, E = r[0].x, S = r[0].y, x = r[0].y;
            for (var T = 1; T < r.length; T++) {
                var N = r[T];
                N.x < w && (w = N.x), N.x > E && (E = N.x), N.y < S && (S = N.y), N.y > x && (x = N.y)
            }
            return new e.Rect(w, S, E - w, x - S)
        }, _getSegments: function () {
            var e = this.getTopLeft(), t = this.getTopRight(), n = this.getBottomLeft(), r = this.getBottomRight();
            return [[e, t], [t, r], [r, n], [n, e]]
        }, rotate: function (t, n) {
            t = e.positiveModulo(t, 360);
            if (t === 0) return this.clone();
            n = n || this.getCenter();
            var r = this.getTopLeft().rotate(t, n), i = this.getTopRight().rotate(t, n), s = i.minus(r);
            s = s.apply(function (e) {
                var t = 1e-15;
                return Math.abs(e) < t ? 0 : e
            });
            var o = Math.atan(s.y / s.x);
            return s.x < 0 ? o += Math.PI : s.y < 0 && (o += 2 * Math.PI), new e.Rect(r.x, r.y, this.width, this.height, o / Math.PI * 180)
        }, getBoundingBox: function () {
            if (this.degrees === 0) return this.clone();
            var t = this.getTopLeft(), n = this.getTopRight(), r = this.getBottomLeft(), i = this.getBottomRight(),
                s = Math.min(t.x, n.x, r.x, i.x), o = Math.max(t.x, n.x, r.x, i.x), u = Math.min(t.y, n.y, r.y, i.y),
                a = Math.max(t.y, n.y, r.y, i.y);
            return new e.Rect(s, u, o - s, a - u)
        }, getIntegerBoundingBox: function () {
            var t = this.getBoundingBox(), n = Math.floor(t.x), r = Math.floor(t.y), i = Math.ceil(t.width + t.x - n),
                s = Math.ceil(t.height + t.y - r);
            return new e.Rect(n, r, i, s)
        }, containsPoint: function (e, t) {
            t = t || 0;
            var n = this.getTopLeft(), r = this.getTopRight(), i = this.getBottomLeft(), s = r.minus(n), o = i.minus(n);
            return (e.x - n.x) * s.x + (e.y - n.y) * s.y >= -t && (e.x - r.x) * s.x + (e.y - r.y) * s.y <= t && (e.x - n.x) * o.x + (e.y - n.y) * o.y >= -t && (e.x - i.x) * o.x + (e.y - i.y) * o.y <= t
        }, toString: function () {
            return "[" + Math.round(this.x * 100) / 100 + ", " + Math.round(this.y * 100) / 100 + ", " + Math.round(this.width * 100) / 100 + "x" + Math.round(this.height * 100) / 100 + ", " + Math.round(this.degrees * 100) / 100 + "deg" + "]"
        }
    }
}(OpenSeadragon),function (e) {
    function n(t) {
        var n = Number(this.element.style.marginLeft.replace("px", "")),
            r = Number(this.element.style.marginTop.replace("px", "")),
            s = Number(this.element.style.width.replace("px", "")),
            o = Number(this.element.style.height.replace("px", "")), u = e.getElementSize(this.viewer.canvas);
        return this.dragging = !0, this.element && ("horizontal" == this.scroll ? -t.delta.x > 0 ? n > -(s - u.x) && (this.element.style.marginLeft = n + t.delta.x * 2 + "px", i(this, u.x, n + t.delta.x * 2)) : -t.delta.x < 0 && n < 0 && (this.element.style.marginLeft = n + t.delta.x * 2 + "px", i(this, u.x, n + t.delta.x * 2)) : -t.delta.y > 0 ? r > -(o - u.y) && (this.element.style.marginTop = r + t.delta.y * 2 + "px", i(this, u.y, r + t.delta.y * 2)) : -t.delta.y < 0 && r < 0 && (this.element.style.marginTop = r + t.delta.y * 2 + "px", i(this, u.y, r + t.delta.y * 2))), !1
    }

    function r(t) {
        var n = Number(this.element.style.marginLeft.replace("px", "")),
            r = Number(this.element.style.marginTop.replace("px", "")),
            s = Number(this.element.style.width.replace("px", "")),
            o = Number(this.element.style.height.replace("px", "")), u = e.getElementSize(this.viewer.canvas);
        return this.element && ("horizontal" == this.scroll ? t.scroll > 0 ? n > -(s - u.x) && (this.element.style.marginLeft = n - t.scroll * 60 + "px", i(this, u.x, n - t.scroll * 60)) : t.scroll < 0 && n < 0 && (this.element.style.marginLeft = n - t.scroll * 60 + "px", i(this, u.x, n - t.scroll * 60)) : t.scroll < 0 ? r > u.y - o && (this.element.style.marginTop = r + t.scroll * 60 + "px", i(this, u.y, r + t.scroll * 60)) : t.scroll > 0 && r < 0 && (this.element.style.marginTop = r + t.scroll * 60 + "px", i(this, u.y, r + t.scroll * 60))), !1
    }

    function i(t, n, r) {
        var i, s, o, u, a, f, l;
        "horizontal" == t.scroll ? i = t.panelWidth : i = t.panelHeight, s = Math.ceil(n / i) + 5, o = Math.ceil((Math.abs(r) + n) / i) + 1, s = o - s, s = s < 0 ? 0 : s;
        for (f = s; f < o && f < t.panels.length; f++) {
            l = t.panels[f];
            if (!l.activePanel) {
                var c, h = t.viewer.tileSources[f];
                h.referenceStripThumbnailUrl ? c = {
                    type: "image",
                    url: h.referenceStripThumbnailUrl
                } : c = h, u = new e.Viewer({
                    id: l.id,
                    tileSources: [c],
                    element: l,
                    navigatorSizeRatio: t.sizeRatio,
                    showNavigator: !1,
                    mouseNavEnabled: !1,
                    showNavigationControl: !1,
                    showSequenceControl: !1,
                    immediateRender: !0,
                    blendTime: 0,
                    animationTime: 0
                }), u.displayRegion = e.makeNeutralElement("div"), u.displayRegion.id = l.id + "-displayregion", u.displayRegion.className = "displayregion", a = u.displayRegion.style, a.position = "relative", a.top = "0px", a.left = "0px", a.fontSize = "0px", a.overflow = "hidden", a.float = "left", a.cssFloat = "left", a.styleFloat = "left", a.zIndex = 999999999, a.cursor = "default", a.width = t.panelWidth - 4 + "px", a.height = t.panelHeight - 4 + "px", u.displayRegion.innerTracker = new e.MouseTracker({
                    element: u.displayRegion,
                    startDisabled: !0
                }), l.getElementsByTagName("div")[0].appendChild(u.displayRegion), t.miniViewers[l.id] = u, l.activePanel = !0
            }
        }
    }

    function s(e) {
        var t = e.eventSource.element;
        return "horizontal" == this.scroll ? t.style.marginBottom = "0px" : t.style.marginLeft = "0px", !1
    }

    function o(t) {
        var n = t.eventSource.element;
        return "horizontal" == this.scroll ? n.style.marginBottom = "-" + e.getElementSize(n).y / 2 + "px" : n.style.marginLeft = "-" + e.getElementSize(n).x / 2 + "px", !1
    }

    function u(e) {
        if (!(!e.preventDefaultAction && !e.ctrl && !e.alt && !e.meta)) return !0;
        switch (e.keyCode) {
            case 38:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: 1, shift: null}), !1;
            case 40:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: -1, shift: null}), !1;
            case 37:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: -1, shift: null}), !1;
            case 39:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: 1, shift: null}), !1;
            default:
                return !0
        }
    }

    function a(e) {
        if (!(!e.preventDefaultAction && !e.ctrl && !e.alt && !e.meta)) return !0;
        switch (e.keyCode) {
            case 61:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: 1, shift: null}), !1;
            case 45:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: -1, shift: null}), !1;
            case 48:
            case 119:
            case 87:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: 1, shift: null}), !1;
            case 115:
            case 83:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: -1, shift: null}), !1;
            case 97:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: -1, shift: null}), !1;
            case 100:
                return r.call(this, {eventSource: this.tracker, position: null, scroll: 1, shift: null}), !1;
            default:
                return !0
        }
    }

    var t = {};
    e.ReferenceStrip = function (f) {
        var l = this, c = f.viewer, h = e.getElementSize(c.element), p, d, v;
        f.id || (f.id = "referencestrip-" + e.now(), this.element = e.makeNeutralElement("div"), this.element.id = f.id, this.element.className = "referencestrip"), f = e.extend(!0, {
            sizeRatio: e.DEFAULT_SETTINGS.referenceStripSizeRatio,
            position: e.DEFAULT_SETTINGS.referenceStripPosition,
            scroll: e.DEFAULT_SETTINGS.referenceStripScroll,
            clickTimeThreshold: e.DEFAULT_SETTINGS.clickTimeThreshold
        }, f, {
            element: this.element,
            showNavigator: !1,
            mouseNavEnabled: !1,
            showNavigationControl: !1,
            showSequenceControl: !1
        }), e.extend(this, f), t[this.id] = {animating: !1}, this.minPixelRatio = this.viewer.minPixelRatio, d = this.element.style, d.marginTop = "0px", d.marginRight = "0px", d.marginBottom = "0px", d.marginLeft = "0px", d.left = "0px", d.bottom = "0px", d.border = "0px", d.background = "#000", d.position = "relative", e.setElementTouchActionNone(this.element), e.setElementOpacity(this.element, .8), this.viewer = c, this.innerTracker = new e.MouseTracker({
            element: this.element,
            dragHandler: e.delegate(this, n),
            scrollHandler: e.delegate(this, r),
            enterHandler: e.delegate(this, s),
            exitHandler: e.delegate(this, o),
            keyDownHandler: e.delegate(this, u),
            keyHandler: e.delegate(this, a)
        }), f.width && f.height ? (this.element.style.width = f.width + "px", this.element.style.height = f.height + "px", c.addControl(this.element, {anchor: e.ControlAnchor.BOTTOM_LEFT})) : "horizontal" == f.scroll ? (this.element.style.width = h.x * f.sizeRatio * c.tileSources.length + 12 * c.tileSources.length + "px", this.element.style.height = h.y * f.sizeRatio + "px", c.addControl(this.element, {anchor: e.ControlAnchor.BOTTOM_LEFT})) : (this.element.style.height = h.y * f.sizeRatio * c.tileSources.length + 12 * c.tileSources.length + "px", this.element.style.width = h.x * f.sizeRatio + "px", c.addControl(this.element, {anchor: e.ControlAnchor.TOP_LEFT})), this.panelWidth = h.x * this.sizeRatio + 8, this.panelHeight = h.y * this.sizeRatio + 8, this.panels = [], this.miniViewers = {};
        for (v = 0; v < c.tileSources.length; v++) p = e.makeNeutralElement("div"), p.id = this.element.id + "-" + v, p.style.width = l.panelWidth + "px", p.style.height = l.panelHeight + "px", p.style.display = "inline", p.style.float = "left", p.style.cssFloat = "left", p.style.styleFloat = "left", p.style.padding = "2px", e.setElementTouchActionNone(p), p.innerTracker = new e.MouseTracker({
            element: p,
            clickTimeThreshold: this.clickTimeThreshold,
            clickDistThreshold: this.clickDistThreshold,
            pressHandler: function (t) {
                t.eventSource.dragging = e.now()
            },
            releaseHandler: function (t) {
                var n = t.eventSource, r = n.element.id, i = Number(r.split("-")[2]), s = e.now();
                t.insideElementPressed && t.insideElementReleased && n.dragging && s - n.dragging < n.clickTimeThreshold && (n.dragging = null, c.goToPage(i))
            }
        }), this.element.appendChild(p), p.activePanel = !1, this.panels.push(p);
        i(this, this.scroll == "vertical" ? h.y : h.x, 0), this.setFocus(0)
    }, e.extend(e.ReferenceStrip.prototype, e.EventSource.prototype, e.Viewer.prototype, {
        setFocus: function (t) {
            var n = e.getElement(this.element.id + "-" + t), r = e.getElementSize(this.viewer.canvas),
                o = Number(this.element.style.width.replace("px", "")),
                u = Number(this.element.style.height.replace("px", "")),
                a = -Number(this.element.style.marginLeft.replace("px", "")),
                f = -Number(this.element.style.marginTop.replace("px", "")), l;
            this.currentSelected !== n && (this.currentSelected && (this.currentSelected.style.background = "#000"), this.currentSelected = n, this.currentSelected.style.background = "#999", "horizontal" == this.scroll ? (l = Number(t) * (this.panelWidth + 3), l > a + r.x - this.panelWidth ? (l = Math.min(l, o - r.x), this.element.style.marginLeft = -l + "px", i(this, r.x, -l)) : l < a && (l = Math.max(0, l - r.x / 2), this.element.style.marginLeft = -l + "px", i(this, r.x, -l))) : (l = Number(t) * (this.panelHeight + 3), l > f + r.y - this.panelHeight ? (l = Math.min(l, u - r.y), this.element.style.marginTop = -l + "px", i(this, r.y, -l)) : l < f && (l = Math.max(0, l - r.y / 2), this.element.style.marginTop = -l + "px", i(this, r.y, -l))), this.currentPage = t, s.call(this, {eventSource: this.innerTracker}))
        }, update: function () {
            return t[this.id].animating ? (e.console.log("image reference strip update"), !0) : !1
        }, destroy: function () {
            if (this.miniViewers) for (var e in this.miniViewers) this.miniViewers[e].destroy();
            this.element && this.element.parentNode.removeChild(this.element)
        }
    })
}(OpenSeadragon),function (e) {
    e.DisplayRect = function (t, n, r, i, s, o) {
        e.Rect.apply(this, [t, n, r, i]), this.minLevel = s, this.maxLevel = o
    }, e.extend(e.DisplayRect.prototype, e.Rect.prototype)
}(OpenSeadragon),function (e) {
    function t(e, t) {
        return (1 - Math.exp(e * -t)) / (1 - Math.exp(-e))
    }

    e.Spring = function (t) {
        var n = arguments;
        typeof t != "object" && (t = {
            initial: n.length && typeof n[0] == "number" ? n[0] : undefined,
            springStiffness: n.length > 1 ? n[1].springStiffness : 5,
            animationTime: n.length > 1 ? n[1].animationTime : 1.5
        }), e.console.assert(typeof t.springStiffness == "number" && t.springStiffness !== 0, "[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"), e.console.assert(typeof t.animationTime == "number" && t.animationTime >= 0, "[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"), t.exponential && (this._exponential = !0, delete t.exponential), e.extend(!0, this, t), this.current = {
            value: typeof this.initial == "number" ? this.initial : this._exponential ? 0 : 1,
            time: e.now()
        }, e.console.assert(!this._exponential || this.current.value !== 0, "[OpenSeadragon.Spring] value must be non-zero for exponential springs"), this.start = {
            value: this.current.value,
            time: this.current.time
        }, this.target = {
            value: this.current.value,
            time: this.current.time
        }, this._exponential && (this.start._logValue = Math.log(this.start.value), this.target._logValue = Math.log(this.target.value), this.current._logValue = Math.log(this.current.value))
    }, e.Spring.prototype = {
        resetTo: function (t) {
            e.console.assert(!this._exponential || t !== 0, "[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"), this.start.value = this.target.value = this.current.value = t, this.start.time = this.target.time = this.current.time = e.now(), this._exponential && (this.start._logValue = Math.log(this.start.value), this.target._logValue = Math.log(this.target.value), this.current._logValue = Math.log(this.current.value))
        }, springTo: function (t) {
            e.console.assert(!this._exponential || t !== 0, "[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"), this.start.value = this.current.value, this.start.time = this.current.time, this.target.value = t, this.target.time = this.start.time + 1e3 * this.animationTime, this._exponential && (this.start._logValue = Math.log(this.start.value), this.target._logValue = Math.log(this.target.value))
        }, shiftBy: function (t) {
            this.start.value += t, this.target.value += t, this._exponential && (e.console.assert(this.target.value !== 0 && this.start.value !== 0, "[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"), this.start._logValue = Math.log(this.start.value), this.target._logValue = Math.log(this.target.value))
        }, setExponential: function (t) {
            this._exponential = t, this._exponential && (e.console.assert(this.current.value !== 0 && this.target.value !== 0 && this.start.value !== 0, "[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"), this.start._logValue = Math.log(this.start.value), this.target._logValue = Math.log(this.target.value), this.current._logValue = Math.log(this.current.value))
        }, update: function () {
            this.current.time = e.now();
            var n, r;
            this._exponential ? (n = this.start._logValue, r = this.target._logValue) : (n = this.start.value, r = this.target.value);
            var i = this.current.time >= this.target.time ? r : n + (r - n) * t(this.springStiffness, (this.current.time - this.start.time) / (this.target.time - this.start.time)),
                s = this.current.value;
            return this._exponential ? this.current.value = Math.exp(i) : this.current.value = i, s != this.current.value
        }, isAtTargetValue: function () {
            return this.current.value === this.target.value
        }
    }
}(OpenSeadragon),function (e) {
    function t(t) {
        e.extend(!0, this, {timeout: e.DEFAULT_SETTINGS.timeout, jobId: null}, t), this.image = null
    }

    function n(e, t, n) {
        var r;
        e.jobsInProgress--, (!e.jobLimit || e.jobsInProgress < e.jobLimit) && e.jobQueue.length > 0 && (r = e.jobQueue.shift(), r.start(), e.jobsInProgress++), n(t.image, t.errorMsg, t.request)
    }

    t.prototype = {
        errorMsg: null, start: function () {
            var t = this, n = this.abort;
            this.image = new Image, this.image.onload = function () {
                t.finish(!0)
            }, this.image.onabort = this.image.onerror = function () {
                t.errorMsg = "Image load aborted", t.finish(!1)
            }, this.jobId = window.setTimeout(function () {
                t.errorMsg = "Image load exceeded timeout", t.finish(!1)
            }, this.timeout), this.loadWithAjax ? (this.request = e.makeAjaxRequest({
                url: this.src,
                withCredentials: this.ajaxWithCredentials,
                headers: this.ajaxHeaders,
                responseType: "arraybuffer",
                success: function (e) {
                    var n;
                    try {
                        n = new window.Blob([e.response])
                    } catch (r) {
                        var i = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;
                        if (r.name === "TypeError" && i) {
                            var s = new i;
                            s.append(e.response), n = s.getBlob()
                        }
                    }
                    n.size === 0 && (t.errorMsg = "Empty image response.", t.finish(!1));
                    var o = (window.URL || window.webkitURL).createObjectURL(n);
                    t.image.src = o
                },
                error: function (e) {
                    t.errorMsg = "Image load aborted - XHR error", t.finish(!1)
                }
            }), this.abort = function () {
                t.request.abort(), typeof n == "function" && n()
            }) : (this.crossOriginPolicy !== !1 && (this.image.crossOrigin = this.crossOriginPolicy), this.image.src = this.src)
        }, finish: function (e) {
            this.image.onload = this.image.onerror = this.image.onabort = null, e || (this.image = null), this.jobId && window.clearTimeout(this.jobId), this.callback(this)
        }
    }, e.ImageLoader = function (t) {
        e.extend(!0, this, {
            jobLimit: e.DEFAULT_SETTINGS.imageLoaderLimit,
            timeout: e.DEFAULT_SETTINGS.timeout,
            jobQueue: [],
            jobsInProgress: 0
        }, t)
    }, e.ImageLoader.prototype = {
        addJob: function (e) {
            var r = this, i = function (t) {
                n(r, t, e.callback)
            }, s = {
                src: e.src,
                loadWithAjax: e.loadWithAjax,
                ajaxHeaders: e.loadWithAjax ? e.ajaxHeaders : null,
                crossOriginPolicy: e.crossOriginPolicy,
                ajaxWithCredentials: e.ajaxWithCredentials,
                callback: i,
                abort: e.abort,
                timeout: this.timeout
            }, o = new t(s);
            !this.jobLimit || this.jobsInProgress < this.jobLimit ? (o.start(), this.jobsInProgress++) : this.jobQueue.push(o)
        }, clear: function () {
            for (var e = 0; e < this.jobQueue.length; e++) {
                var t = this.jobQueue[e];
                typeof t.abort == "function" && t.abort()
            }
            this.jobQueue = []
        }
    }
}(OpenSeadragon),function (e) {
    e.Tile = function (e, t, n, r, i, s, o, u, a) {
        this.level = e, this.x = t, this.y = n, this.bounds = r, this.exists = i, this.url = s, this.context2D = o, this.loadWithAjax = u, this.ajaxHeaders = a, this.ajaxHeaders ? this.cacheKey = this.url + "+" + JSON.stringify(this.ajaxHeaders) : this.cacheKey = this.url, this.loaded = !1, this.loading = !1, this.element = null, this.imgElement = null, this.image = null, this.style = null, this.position = null, this.size = null, this.blendStart = null, this.opacity = null, this.squaredDistance = null, this.visibility = null, this.beingDrawn = !1, this.lastTouchTime = 0, this.isRightMost = !1, this.isBottomMost = !1
    }, e.Tile.prototype = {
        toString: function () {
            return this.level + "/" + this.x + "_" + this.y
        }, _hasTransparencyChannel: function () {
            return !!this.context2D || this.url.match(".png")
        }, drawHTML: function (t) {
            if (!this.cacheImageRecord) {
                e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached", this.toString());
                return
            }
            if (!this.loaded) {
                e.console.warn("Attempting to draw tile %s when it's not yet loaded.", this.toString());
                return
            }
            this.element || (this.element = e.makeNeutralElement("div"), this.imgElement = this.cacheImageRecord.getImage().cloneNode(), this.imgElement.style.msInterpolationMode = "nearest-neighbor", this.imgElement.style.width = "100%", this.imgElement.style.height = "100%", this.style = this.element.style, this.style.position = "absolute"), this.element.parentNode != t && t.appendChild(this.element), this.imgElement.parentNode != this.element && this.element.appendChild(this.imgElement), this.style.top = this.position.y + "px", this.style.left = this.position.x + "px", this.style.height = this.size.y + "px", this.style.width = this.size.x + "px", e.setElementOpacity(this.element, this.opacity)
        }, drawCanvas: function (t, n, r, i) {
            var s = this.position.times(e.pixelDensityRatio), o = this.size.times(e.pixelDensityRatio), u;
            if (!this.context2D && !this.cacheImageRecord) {
                e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached", this.toString());
                return
            }
            u = this.context2D || this.cacheImageRecord.getRenderedContext();
            if (!this.loaded || !u) {
                e.console.warn("Attempting to draw tile %s when it's not yet loaded.", this.toString());
                return
            }
            t.save(), t.globalAlpha = this.opacity, typeof r == "number" && r !== 1 && (s = s.times(r), o = o.times(r)), i instanceof e.Point && (s = s.plus(i)), t.globalAlpha === 1 && this._hasTransparencyChannel() && t.clearRect(s.x + 1, s.y + 1, o.x - 2, o.y - 2), n({
                context: t,
                tile: this,
                rendered: u
            }), t.drawImage(u.canvas, 0, 0, u.canvas.width, u.canvas.height, s.x, s.y, o.x, o.y), t.restore()
        }, getScaleForEdgeSmoothing: function () {
            var t;
            if (this.cacheImageRecord) t = this.cacheImageRecord.getRenderedContext(); else {
                if (!this.context2D) return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached", this.toString()), 1;
                t = this.context2D
            }
            return t.canvas.width / (this.size.x * e.pixelDensityRatio)
        }, getTranslationForEdgeSmoothing: function (t, n, r) {
            var i = Math.max(1, Math.ceil((r.x - n.x) / 2)), s = Math.max(1, Math.ceil((r.y - n.y) / 2));
            return (new e.Point(i, s)).minus(this.position.times(e.pixelDensityRatio).times(t || 1).apply(function (e) {
                return e % 1
            }))
        }, unload: function () {
            this.imgElement && this.imgElement.parentNode && this.imgElement.parentNode.removeChild(this.imgElement), this.element && this.element.parentNode && this.element.parentNode.removeChild(this.element), this.element = null, this.imgElement = null, this.loaded = !1, this.loading = !1
        }
    }
}(OpenSeadragon),function (e) {
    e.OverlayPlacement = e.Placement, e.OverlayRotationMode = e.freezeObject({
        NO_ROTATION: 1,
        EXACT: 2,
        BOUNDING_BOX: 3
    }), e.Overlay = function (t, n, r) {
        var i;
        e.isPlainObject(t) ? i = t : i = {
            element: t,
            location: n,
            placement: r
        }, this.element = i.element, this.style = i.element.style, this._init(i)
    }, e.Overlay.prototype = {
        _init: function (t) {
            this.location = t.location, this.placement = t.placement === undefined ? e.Placement.TOP_LEFT : t.placement, this.onDraw = t.onDraw, this.checkResize = t.checkResize === undefined ? !0 : t.checkResize, this.width = t.width === undefined ? null : t.width, this.height = t.height === undefined ? null : t.height, this.rotationMode = t.rotationMode || e.OverlayRotationMode.EXACT, this.location instanceof e.Rect && (this.width = this.location.width, this.height = this.location.height, this.location = this.location.getTopLeft(), this.placement = e.Placement.TOP_LEFT), this.scales = this.width !== null && this.height !== null, this.bounds = new e.Rect(this.location.x, this.location.y, this.width, this.height), this.position = this.location
        }, adjust: function (t, n) {
            var r = e.Placement.properties[this.placement];
            if (!r) return;
            r.isHorizontallyCentered ? t.x -= n.x / 2 : r.isRight && (t.x -= n.x), r.isVerticallyCentered ? t.y -= n.y / 2 : r.isBottom && (t.y -= n.y)
        }, destroy: function () {
            var t = this.element, n = this.style;
            t.parentNode && (t.parentNode.removeChild(t), t.prevElementParent && (n.display = "none", document.body.appendChild(t))), this.onDraw = null, n.top = "", n.left = "", n.position = "", this.width !== null && (n.width = ""), this.height !== null && (n.height = "");
            var r = e.getCssPropertyWithVendorPrefix("transformOrigin"),
                i = e.getCssPropertyWithVendorPrefix("transform");
            r && i && (n[r] = "", n[i] = "")
        }, drawHTML: function (t, n) {
            var r = this.element;
            r.parentNode !== t && (r.prevElementParent = r.parentNode, r.prevNextSibling = r.nextSibling, t.appendChild(r), this.style.position = "absolute", this.size = e.getElementSize(r));
            var i = this._getOverlayPositionAndSize(n), s = i.position, o = this.size = i.size, u = i.rotate;
            if (this.onDraw) this.onDraw(s, o, this.element); else {
                var a = this.style;
                a.left = s.x + "px", a.top = s.y + "px", this.width !== null && (a.width = o.x + "px"), this.height !== null && (a.height = o.y + "px");
                var f = e.getCssPropertyWithVendorPrefix("transformOrigin"),
                    l = e.getCssPropertyWithVendorPrefix("transform");
                f && l && (u ? (a[f] = this._getTransformOrigin(), a[l] = "rotate(" + u + "deg)") : (a[f] = "", a[l] = "")), a.display !== "none" && (a.display = "block")
            }
        }, _getOverlayPositionAndSize: function (t) {
            var n = t.pixelFromPoint(this.location, !0), r = this._getSizeInPixels(t);
            this.adjust(n, r);
            var i = 0;
            if (t.degrees && this.rotationMode !== e.OverlayRotationMode.NO_ROTATION) if (this.rotationMode === e.OverlayRotationMode.BOUNDING_BOX && this.width !== null && this.height !== null) {
                var s = new e.Rect(n.x, n.y, r.x, r.y), o = this._getBoundingBox(s, t.degrees);
                n = o.getTopLeft(), r = o.getSize()
            } else i = t.degrees;
            return {position: n, size: r, rotate: i}
        }, _getSizeInPixels: function (t) {
            var n = this.size.x, r = this.size.y;
            if (this.width !== null || this.height !== null) {
                var i = t.deltaPixelsFromPointsNoRotate(new e.Point(this.width || 0, this.height || 0), !0);
                this.width !== null && (n = i.x), this.height !== null && (r = i.y)
            }
            if (this.checkResize && (this.width === null || this.height === null)) {
                var s = this.size = e.getElementSize(this.element);
                this.width === null && (n = s.x), this.height === null && (r = s.y)
            }
            return new e.Point(n, r)
        }, _getBoundingBox: function (e, t) {
            var n = this._getPlacementPoint(e);
            return e.rotate(t, n).getBoundingBox()
        }, _getPlacementPoint: function (t) {
            var n = new e.Point(t.x, t.y), r = e.Placement.properties[this.placement];
            return r && (r.isHorizontallyCentered ? n.x += t.width / 2 : r.isRight && (n.x += t.width), r.isVerticallyCentered ? n.y += t.height / 2 : r.isBottom && (n.y += t.height)), n
        }, _getTransformOrigin: function () {
            var t = "", n = e.Placement.properties[this.placement];
            return n ? (n.isLeft ? t = "left" : n.isRight && (t = "right"), n.isTop ? t += " top" : n.isBottom && (t += " bottom"), t) : t
        }, update: function (t, n) {
            var r = e.isPlainObject(t) ? t : {location: t, placement: n};
            this._init({
                location: r.location || this.location,
                placement: r.placement !== undefined ? r.placement : this.placement,
                onDraw: r.onDraw || this.onDraw,
                checkResize: r.checkResize || this.checkResize,
                width: r.width !== undefined ? r.width : this.width,
                height: r.height !== undefined ? r.height : this.height,
                rotationMode: r.rotationMode || this.rotationMode
            })
        }, getBounds: function (t) {
            e.console.assert(t, "A viewport must now be passed to Overlay.getBounds.");
            var n = this.width, r = this.height;
            if (n === null || r === null) {
                var i = t.deltaPointsFromPixelsNoRotate(this.size, !0);
                n === null && (n = i.x), r === null && (r = i.y)
            }
            var s = this.location.clone();
            return this.adjust(s, new e.Point(n, r)), this._adjustBoundsForRotation(t, new e.Rect(s.x, s.y, n, r))
        }, _adjustBoundsForRotation: function (t, n) {
            if (!t || t.degrees === 0 || this.rotationMode === e.OverlayRotationMode.EXACT) return n;
            if (this.rotationMode === e.OverlayRotationMode.BOUNDING_BOX) {
                if (this.width === null || this.height === null) return n;
                var r = this._getOverlayPositionAndSize(t);
                return t.viewerElementToViewportRectangle(new e.Rect(r.position.x, r.position.y, r.size.x, r.size.y))
            }
            return n.rotate(-t.degrees, this._getPlacementPoint(n))
        }
    }
}(OpenSeadragon),function (e) {
    e.Drawer = function (t) {
        e.console.assert(t.viewer, "[Drawer] options.viewer is required");
        var n = arguments;
        e.isPlainObject(t) || (t = {
            source: n[0],
            viewport: n[1],
            element: n[2]
        }), e.console.assert(t.viewport, "[Drawer] options.viewport is required"), e.console.assert(t.element, "[Drawer] options.element is required"), t.source && e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"), this.viewer = t.viewer, this.viewport = t.viewport, this.debugGridColor = typeof t.debugGridColor == "string" ? [t.debugGridColor] : t.debugGridColor || e.DEFAULT_SETTINGS.debugGridColor, t.opacity && e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"), this.useCanvas = e.supportsCanvas && (this.viewer ? this.viewer.useCanvas : !0), this.container = e.getElement(t.element), this.canvas = e.makeNeutralElement(this.useCanvas ? "canvas" : "div"), this.context = this.useCanvas ? this.canvas.getContext("2d") : null, this.sketchCanvas = null, this.sketchContext = null, this.element = this.container, this.container.dir = "ltr";
        if (this.useCanvas) {
            var r = this._calculateCanvasSize();
            this.canvas.width = r.x, this.canvas.height = r.y
        }
        this.canvas.style.width = "100%", this.canvas.style.height = "100%", this.canvas.style.position = "absolute", e.setElementOpacity(this.canvas, this.opacity, !0), this.container.style.textAlign = "left", this.container.appendChild(this.canvas)
    }, e.Drawer.prototype = {
        addOverlay: function (t, n, r, i) {
            return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."), this.viewer.addOverlay(t, n, r, i), this
        }, updateOverlay: function (t, n, r) {
            return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."), this.viewer.updateOverlay(t, n, r), this
        }, removeOverlay: function (t) {
            return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."), this.viewer.removeOverlay(t), this
        }, clearOverlays: function () {
            return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."), this.viewer.clearOverlays(), this
        }, setOpacity: function (t) {
            e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");
            var n = this.viewer.world;
            for (var r = 0; r < n.getItemCount(); r++) n.getItemAt(r).setOpacity(t);
            return this
        }, getOpacity: function () {
            e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");
            var t = this.viewer.world, n = 0;
            for (var r = 0; r < t.getItemCount(); r++) {
                var i = t.getItemAt(r).getOpacity();
                i > n && (n = i)
            }
            return n
        }, needsUpdate: function () {
            return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."), this.viewer.world.needsDraw()
        }, numTilesLoaded: function () {
            return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."), this.viewer.tileCache.numTilesLoaded()
        }, reset: function () {
            return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."), this.viewer.world.resetItems(), this
        }, update: function () {
            return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."), this.clear(), this.viewer.world.draw(), this
        }, canRotate: function () {
            return this.useCanvas
        }, destroy: function () {
            this.canvas.width = 1, this.canvas.height = 1, this.sketchCanvas = null, this.sketchContext = null
        }, clear: function () {
            this.canvas.innerHTML = "";
            if (this.useCanvas) {
                var e = this._calculateCanvasSize();
                if (this.canvas.width != e.x || this.canvas.height != e.y) {
                    this.canvas.width = e.x, this.canvas.height = e.y;
                    if (this.sketchCanvas !== null) {
                        var t = this._calculateSketchCanvasSize();
                        this.sketchCanvas.width = t.x, this.sketchCanvas.height = t.y
                    }
                }
                this._clear()
            }
        }, _clear: function (e, t) {
            if (!this.useCanvas) return;
            var n = this._getContext(e);
            if (t) n.clearRect(t.x, t.y, t.width, t.height); else {
                var r = n.canvas;
                n.clearRect(0, 0, r.width, r.height)
            }
        }, viewportToDrawerRectangle: function (t) {
            var n = this.viewport.pixelFromPointNoRotate(t.getTopLeft(), !0),
                r = this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(), !0);
            return new e.Rect(n.x * e.pixelDensityRatio, n.y * e.pixelDensityRatio, r.x * e.pixelDensityRatio, r.y * e.pixelDensityRatio)
        }, drawTile: function (t, n, r, i, s) {
            e.console.assert(t, "[Drawer.drawTile] tile is required"), e.console.assert(n, "[Drawer.drawTile] drawingHandler is required");
            if (this.useCanvas) {
                var o = this._getContext(r);
                i = i || 1, t.drawCanvas(o, n, i, s)
            } else t.drawHTML(this.canvas)
        }, _getContext: function (e) {
            var t = this.context;
            if (e) {
                if (this.sketchCanvas === null) {
                    this.sketchCanvas = document.createElement("canvas");
                    var n = this._calculateSketchCanvasSize();
                    this.sketchCanvas.width = n.x, this.sketchCanvas.height = n.y, this.sketchContext = this.sketchCanvas.getContext("2d");
                    if (this.viewport.getRotation() === 0) {
                        var r = this;
                        this.viewer.addHandler("rotate", function i() {
                            if (r.viewport.getRotation() === 0) return;
                            r.viewer.removeHandler("rotate", i);
                            var e = r._calculateSketchCanvasSize();
                            r.sketchCanvas.width = e.x, r.sketchCanvas.height = e.y
                        })
                    }
                }
                t = this.sketchContext
            }
            return t
        }, saveContext: function (e) {
            if (!this.useCanvas) return;
            this._getContext(e).save()
        }, restoreContext: function (e) {
            if (!this.useCanvas) return;
            this._getContext(e).restore()
        }, setClip: function (e, t) {
            if (!this.useCanvas) return;
            var n = this._getContext(t);
            n.beginPath(), n.rect(e.x, e.y, e.width, e.height), n.clip()
        }, drawRectangle: function (e, t, n) {
            if (!this.useCanvas) return;
            var r = this._getContext(n);
            r.save(), r.fillStyle = t, r.fillRect(e.x, e.y, e.width, e.height), r.restore()
        }, blendSketch: function (t, n, r, i) {
            var s = t;
            e.isPlainObject(s) || (s = {opacity: t, scale: n, translate: r, compositeOperation: i});
            if (!this.useCanvas || !this.sketchCanvas) return;
            t = s.opacity, i = s.compositeOperation;
            var o = s.bounds;
            this.context.save(), this.context.globalAlpha = t, i && (this.context.globalCompositeOperation = i);
            if (o) o.x < 0 && (o.width += o.x, o.x = 0), o.x + o.width > this.canvas.width && (o.width = this.canvas.width - o.x), o.y < 0 && (o.height += o.y, o.y = 0), o.y + o.height > this.canvas.height && (o.height = this.canvas.height - o.y), this.context.drawImage(this.sketchCanvas, o.x, o.y, o.width, o.height, o.x, o.y, o.width, o.height); else {
                n = s.scale || 1, r = s.translate;
                var u = r instanceof e.Point ? r : new e.Point(0, 0), a = 0, f = 0;
                if (r) {
                    var l = this.sketchCanvas.width - this.canvas.width,
                        c = this.sketchCanvas.height - this.canvas.height;
                    a = Math.round(l / 2), f = Math.round(c / 2)
                }
                this.context.drawImage(this.sketchCanvas, u.x - a * n, u.y - f * n, (this.canvas.width + 2 * a) * n, (this.canvas.height + 2 * f) * n, -a, -f, this.canvas.width + 2 * a, this.canvas.height + 2 * f)
            }
            this.context.restore()
        }, drawDebugInfo: function (t, n, r, i) {
            if (!this.useCanvas) return;
            var s = this.viewer.world.getIndexOfItem(i) % this.debugGridColor.length, o = this.context;
            o.save(), o.lineWidth = 2 * e.pixelDensityRatio, o.font = "small-caps bold " + 13 * e.pixelDensityRatio + "px arial", o.strokeStyle = this.debugGridColor[s], o.fillStyle = this.debugGridColor[s], this.viewport.degrees !== 0 && this._offsetForRotation({degrees: this.viewport.degrees}), i.getRotation(!0) % 360 !== 0 && this._offsetForRotation({
                degrees: i.getRotation(!0),
                point: i.viewport.pixelFromPointNoRotate(i._getRotationPoint(!0), !0)
            }), o.strokeRect(t.position.x * e.pixelDensityRatio, t.position.y * e.pixelDensityRatio, t.size.x * e.pixelDensityRatio, t.size.y * e.pixelDensityRatio);
            var u = (t.position.x + t.size.x / 2) * e.pixelDensityRatio,
                a = (t.position.y + t.size.y / 2) * e.pixelDensityRatio;
            o.translate(u, a), o.rotate(Math.PI / 180 * -this.viewport.degrees), o.translate(-u, -a), t.x === 0 && t.y === 0 && (o.fillText("Zoom: " + this.viewport.getZoom(), t.position.x * e.pixelDensityRatio, (t.position.y - 30) * e.pixelDensityRatio), o.fillText("Pan: " + this.viewport.getBounds().toString(), t.position.x * e.pixelDensityRatio, (t.position.y - 20) * e.pixelDensityRatio)), o.fillText("Level: " + t.level, (t.position.x + 10) * e.pixelDensityRatio, (t.position.y + 20) * e.pixelDensityRatio), o.fillText("Column: " + t.x, (t.position.x + 10) * e.pixelDensityRatio, (t.position.y + 30) * e.pixelDensityRatio), o.fillText("Row: " + t.y, (t.position.x + 10) * e.pixelDensityRatio, (t.position.y + 40) * e.pixelDensityRatio), o.fillText("Order: " + r + " of " + n, (t.position.x + 10) * e.pixelDensityRatio, (t.position.y + 50) * e.pixelDensityRatio), o.fillText("Size: " + t.size.toString(), (t.position.x + 10) * e.pixelDensityRatio, (t.position.y + 60) * e.pixelDensityRatio), o.fillText("Position: " + t.position.toString(), (t.position.x + 10) * e.pixelDensityRatio, (t.position.y + 70) * e.pixelDensityRatio), this.viewport.degrees !== 0 && this._restoreRotationChanges(), i.getRotation(!0) % 360 !== 0 && this._restoreRotationChanges(), o.restore()
        }, debugRect: function (t) {
            if (this.useCanvas) {
                var n = this.context;
                n.save(), n.lineWidth = 2 * e.pixelDensityRatio, n.strokeStyle = this.debugGridColor[0], n.fillStyle = this.debugGridColor[0], n.strokeRect(t.x * e.pixelDensityRatio, t.y * e.pixelDensityRatio, t.width * e.pixelDensityRatio, t.height * e.pixelDensityRatio), n.restore()
            }
        }, getCanvasSize: function (t) {
            var n = this._getContext(t).canvas;
            return new e.Point(n.width, n.height)
        }, getCanvasCenter: function () {
            return new e.Point(this.canvas.width / 2, this.canvas.height / 2)
        }, _offsetForRotation: function (t) {
            var n = t.point ? t.point.times(e.pixelDensityRatio) : this.getCanvasCenter(),
                r = this._getContext(t.useSketch);
            r.save(), r.translate(n.x, n.y), r.rotate(Math.PI / 180 * t.degrees), r.translate(-n.x, -n.y)
        }, _restoreRotationChanges: function (e) {
            var t = this._getContext(e);
            t.restore()
        }, _calculateCanvasSize: function () {
            var t = e.pixelDensityRatio, n = this.viewport.getContainerSize();
            return {x: n.x * t, y: n.y * t}
        }, _calculateSketchCanvasSize: function () {
            var e = this._calculateCanvasSize();
            if (this.viewport.getRotation() === 0) return e;
            var t = Math.ceil(Math.sqrt(e.x * e.x + e.y * e.y));
            return {x: t, y: t}
        }
    }
}(OpenSeadragon),function (e) {
    e.Viewport = function (t) {
        var n = arguments;
        n.length && n[0] instanceof e.Point && (t = {
            containerSize: n[0],
            contentSize: n[1],
            config: n[2]
        }), t.config && (e.extend(!0, t, t.config), delete t.config), this._margins = e.extend({
            left: 0,
            top: 0,
            right: 0,
            bottom: 0
        }, t.margins || {}), delete t.margins, e.extend(!0, this, {
            containerSize: null,
            contentSize: null,
            zoomPoint: null,
            viewer: null,
            springStiffness: e.DEFAULT_SETTINGS.springStiffness,
            animationTime: e.DEFAULT_SETTINGS.animationTime,
            minZoomImageRatio: e.DEFAULT_SETTINGS.minZoomImageRatio,
            maxZoomPixelRatio: e.DEFAULT_SETTINGS.maxZoomPixelRatio,
            visibilityRatio: e.DEFAULT_SETTINGS.visibilityRatio,
            wrapHorizontal: e.DEFAULT_SETTINGS.wrapHorizontal,
            wrapVertical: e.DEFAULT_SETTINGS.wrapVertical,
            defaultZoomLevel: e.DEFAULT_SETTINGS.defaultZoomLevel,
            minZoomLevel: e.DEFAULT_SETTINGS.minZoomLevel,
            maxZoomLevel: e.DEFAULT_SETTINGS.maxZoomLevel,
            degrees: e.DEFAULT_SETTINGS.degrees,
            homeFillsViewer: e.DEFAULT_SETTINGS.homeFillsViewer
        }, t), this._updateContainerInnerSize(), this.centerSpringX = new e.Spring({
            initial: 0,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime
        }), this.centerSpringY = new e.Spring({
            initial: 0,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime
        }), this.zoomSpring = new e.Spring({
            exponential: !0,
            initial: 1,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime
        }), this._oldCenterX = this.centerSpringX.current.value, this._oldCenterY = this.centerSpringY.current.value, this._oldZoom = this.zoomSpring.current.value, this._setContentBounds(new e.Rect(0, 0, 1, 1), 1), this.goHome(!0), this.update()
    }, e.Viewport.prototype = {
        resetContentSize: function (t) {
            return e.console.assert(t, "[Viewport.resetContentSize] contentSize is required"), e.console.assert(t instanceof e.Point, "[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"), e.console.assert(t.x > 0, "[Viewport.resetContentSize] contentSize.x must be greater than 0"), e.console.assert(t.y > 0, "[Viewport.resetContentSize] contentSize.y must be greater than 0"), this._setContentBounds(new e.Rect(0, 0, 1, t.y / t.x), t.x), this
        }, setHomeBounds: function (t, n) {
            e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."), this._setContentBounds(t, n)
        }, _setContentBounds: function (t, n) {
            e.console.assert(t, "[Viewport._setContentBounds] bounds is required"), e.console.assert(t instanceof e.Rect, "[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"), e.console.assert(t.width > 0, "[Viewport._setContentBounds] bounds.width must be greater than 0"), e.console.assert(t.height > 0, "[Viewport._setContentBounds] bounds.height must be greater than 0"), this._contentBoundsNoRotate = t.clone(), this._contentSizeNoRotate = this._contentBoundsNoRotate.getSize().times(n), this._contentBounds = t.rotate(this.degrees).getBoundingBox(), this._contentSize = this._contentBounds.getSize().times(n), this._contentAspectRatio = this._contentSize.x / this._contentSize.y, this.viewer && this.viewer.raiseEvent("reset-size", {
                contentSize: this._contentSizeNoRotate.clone(),
                contentFactor: n,
                homeBounds: this._contentBoundsNoRotate.clone(),
                contentBounds: this._contentBounds.clone()
            })
        }, getHomeZoom: function () {
            if (this.defaultZoomLevel) return this.defaultZoomLevel;
            var e = this._contentAspectRatio / this.getAspectRatio(), t;
            return this.homeFillsViewer ? t = e >= 1 ? e : 1 : t = e >= 1 ? 1 : e, t / this._contentBounds.width
        }, getHomeBounds: function () {
            return this.getHomeBoundsNoRotate().rotate(-this.getRotation())
        }, getHomeBoundsNoRotate: function () {
            var t = this._contentBounds.getCenter(), n = 1 / this.getHomeZoom(), r = n / this.getAspectRatio();
            return new e.Rect(t.x - n / 2, t.y - r / 2, n, r)
        }, goHome: function (e) {
            return this.viewer && this.viewer.raiseEvent("home", {immediately: e}), this.fitBounds(this.getHomeBounds(), e)
        }, getMinZoom: function () {
            var e = this.getHomeZoom(), t = this.minZoomLevel ? this.minZoomLevel : this.minZoomImageRatio * e;
            return t
        }, getMaxZoom: function () {
            var e = this.maxZoomLevel;
            return e || (e = this._contentSize.x * this.maxZoomPixelRatio / this._containerInnerSize.x, e /= this._contentBounds.width), Math.max(e, this.getHomeZoom())
        }, getAspectRatio: function () {
            return this._containerInnerSize.x / this._containerInnerSize.y
        }, getContainerSize: function () {
            return new e.Point(this.containerSize.x, this.containerSize.y)
        }, getMargins: function () {
            return e.extend({}, this._margins)
        }, setMargins: function (t) {
            e.console.assert(e.type(t) === "object", "[Viewport.setMargins] margins must be an object"), this._margins = e.extend({
                left: 0,
                top: 0,
                right: 0,
                bottom: 0
            }, t), this._updateContainerInnerSize(), this.viewer && this.viewer.forceRedraw()
        }, getBounds: function (e) {
            return this.getBoundsNoRotate(e).rotate(-this.getRotation())
        }, getBoundsNoRotate: function (t) {
            var n = this.getCenter(t), r = 1 / this.getZoom(t), i = r / this.getAspectRatio();
            return new e.Rect(n.x - r / 2, n.y - i / 2, r, i)
        }, getBoundsWithMargins: function (e) {
            return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(), this.getCenter(e))
        }, getBoundsNoRotateWithMargins: function (e) {
            var t = this.getBoundsNoRotate(e), n = this._containerInnerSize.x * this.getZoom(e);
            return t.x -= this._margins.left / n, t.y -= this._margins.top / n, t.width += (this._margins.left + this._margins.right) / n, t.height += (this._margins.top + this._margins.bottom) / n, t
        }, getCenter: function (t) {
            var n = new e.Point(this.centerSpringX.current.value, this.centerSpringY.current.value),
                r = new e.Point(this.centerSpringX.target.value, this.centerSpringY.target.value), i, s, o, u, a, f, l,
                c;
            return t ? n : this.zoomPoint ? (i = this.pixelFromPoint(this.zoomPoint, !0), s = this.getZoom(), o = 1 / s, u = o / this.getAspectRatio(), a = new e.Rect(n.x - o / 2, n.y - u / 2, o, u), f = this._pixelFromPoint(this.zoomPoint, a), l = f.minus(i), c = l.divide(this._containerInnerSize.x * s), r.plus(c)) : r
        }, getZoom: function (e) {
            return e ? this.zoomSpring.current.value : this.zoomSpring.target.value
        }, _applyZoomConstraints: function (e) {
            return Math.max(Math.min(e, this.getMaxZoom()), this.getMinZoom())
        }, _applyBoundaryConstraints: function (t) {
            var n = new e.Rect(t.x, t.y, t.width, t.height);
            if (!this.wrapHorizontal) {
                var r = this.visibilityRatio * n.width, i = n.x + n.width,
                    s = this._contentBoundsNoRotate.x + this._contentBoundsNoRotate.width,
                    o = this._contentBoundsNoRotate.x - i + r, u = s - n.x - r;
                r > this._contentBoundsNoRotate.width ? n.x += (o + u) / 2 : u < 0 ? n.x += u : o > 0 && (n.x += o)
            }
            if (!this.wrapVertical) {
                var a = this.visibilityRatio * n.height, f = n.y + n.height,
                    l = this._contentBoundsNoRotate.y + this._contentBoundsNoRotate.height,
                    c = this._contentBoundsNoRotate.y - f + a, h = l - n.y - a;
                a > this._contentBoundsNoRotate.height ? n.y += (c + h) / 2 : h < 0 ? n.y += h : c > 0 && (n.y += c)
            }
            return n
        }, _raiseConstraintsEvent: function (e) {
            this.viewer && this.viewer.raiseEvent("constrain", {immediately: e})
        }, applyConstraints: function (e) {
            var t = this.getZoom(), n = this._applyZoomConstraints(t);
            t !== n && this.zoomTo(n, this.zoomPoint, e);
            var r = this.getBoundsNoRotate(), i = this._applyBoundaryConstraints(r);
            return this._raiseConstraintsEvent(e), (r.x !== i.x || r.y !== i.y || e) && this.fitBounds(i.rotate(-this.getRotation()), e), this
        }, ensureVisible: function (e) {
            return this.applyConstraints(e)
        }, _fitBounds: function (t, n) {
            n = n || {};
            var r = n.immediately || !1, i = n.constraints || !1, s = this.getAspectRatio(), o = t.getCenter(),
                u = (new e.Rect(t.x, t.y, t.width, t.height, t.degrees + this.getRotation())).getBoundingBox();
            u.getAspectRatio() >= s ? u.height = u.width / s : u.width = u.height * s, u.x = o.x - u.width / 2, u.y = o.y - u.height / 2;
            var a = 1 / u.width;
            if (i) {
                var f = u.getAspectRatio(), l = this._applyZoomConstraints(a);
                a !== l && (a = l, u.width = 1 / a, u.x = o.x - u.width / 2, u.height = u.width / f, u.y = o.y - u.height / 2), u = this._applyBoundaryConstraints(u), o = u.getCenter(), this._raiseConstraintsEvent(r)
            }
            if (r) return this.panTo(o, !0), this.zoomTo(a, null, !0);
            this.panTo(this.getCenter(!0), !0), this.zoomTo(this.getZoom(!0), null, !0);
            var c = this.getBounds(), h = this.getZoom();
            if (h === 0 || Math.abs(a / h - 1) < 1e-8) return this.zoomTo(a, !0), this.panTo(o, r);
            u = u.rotate(-this.getRotation());
            var p = u.getTopLeft().times(a).minus(c.getTopLeft().times(h)).divide(a - h);
            return this.zoomTo(a, p, r)
        }, fitBounds: function (e, t) {
            return this._fitBounds(e, {immediately: t, constraints: !1})
        }, fitBoundsWithConstraints: function (e, t) {
            return this._fitBounds(e, {immediately: t, constraints: !0})
        }, fitVertically: function (t) {
            var n = new e.Rect(this._contentBounds.x + this._contentBounds.width / 2, this._contentBounds.y, 0, this._contentBounds.height);
            return this.fitBounds(n, t)
        }, fitHorizontally: function (t) {
            var n = new e.Rect(this._contentBounds.x, this._contentBounds.y + this._contentBounds.height / 2, this._contentBounds.width, 0);
            return this.fitBounds(n, t)
        }, getConstrainedBounds: function (e) {
            var t, n;
            return t = this.getBounds(e), n = this._applyBoundaryConstraints(t), n
        }, panBy: function (t, n) {
            var r = new e.Point(this.centerSpringX.target.value, this.centerSpringY.target.value);
            return this.panTo(r.plus(t), n)
        }, panTo: function (e, t) {
            return t ? (this.centerSpringX.resetTo(e.x), this.centerSpringY.resetTo(e.y)) : (this.centerSpringX.springTo(e.x), this.centerSpringY.springTo(e.y)), this.viewer && this.viewer.raiseEvent("pan", {
                center: e,
                immediately: t
            }), this
        }, zoomBy: function (e, t, n) {
            return this.zoomTo(this.zoomSpring.target.value * e, t, n)
        }, zoomTo: function (t, n, r) {
            var i = this;
            return this.zoomPoint = n instanceof e.Point && !isNaN(n.x) && !isNaN(n.y) ? n : null, r ? this._adjustCenterSpringsForZoomPoint(function () {
                i.zoomSpring.resetTo(t)
            }) : this.zoomSpring.springTo(t), this.viewer && this.viewer.raiseEvent("zoom", {
                zoom: t,
                refPoint: n,
                immediately: r
            }), this
        }, setRotation: function (t) {
            return !this.viewer || !this.viewer.drawer.canRotate() ? this : (this.degrees = e.positiveModulo(t, 360), this._setContentBounds(this.viewer.world.getHomeBounds(), this.viewer.world.getContentFactor()), this.viewer.forceRedraw(), this.viewer.raiseEvent("rotate", {degrees: t}), this)
        }, getRotation: function () {
            return this.degrees
        }, resize: function (e, t) {
            var n = this.getBoundsNoRotate(), r = n, i;
            return this.containerSize.x = e.x, this.containerSize.y = e.y, this._updateContainerInnerSize(), t && (i = e.x / this.containerSize.x, r.width = n.width * i, r.height = r.width / this.getAspectRatio()), this.viewer && this.viewer.raiseEvent("resize", {
                newContainerSize: e,
                maintain: t
            }), this.fitBounds(r, !0)
        }, _updateContainerInnerSize: function () {
            this._containerInnerSize = new e.Point(Math.max(1, this.containerSize.x - (this._margins.left + this._margins.right)), Math.max(1, this.containerSize.y - (this._margins.top + this._margins.bottom)))
        }, update: function () {
            var e = this;
            this._adjustCenterSpringsForZoomPoint(function () {
                e.zoomSpring.update()
            }), this.centerSpringX.update(), this.centerSpringY.update();
            var t = this.centerSpringX.current.value !== this._oldCenterX || this.centerSpringY.current.value !== this._oldCenterY || this.zoomSpring.current.value !== this._oldZoom;
            return this._oldCenterX = this.centerSpringX.current.value, this._oldCenterY = this.centerSpringY.current.value, this._oldZoom = this.zoomSpring.current.value, t
        }, _adjustCenterSpringsForZoomPoint: function (e) {
            if (this.zoomPoint) {
                var t = this.pixelFromPoint(this.zoomPoint, !0);
                e();
                var n = this.pixelFromPoint(this.zoomPoint, !0), r = n.minus(t), i = this.deltaPointsFromPixels(r, !0);
                this.centerSpringX.shiftBy(i.x), this.centerSpringY.shiftBy(i.y), this.zoomSpring.isAtTargetValue() && (this.zoomPoint = null)
            } else e()
        }, deltaPixelsFromPointsNoRotate: function (e, t) {
            return e.times(this._containerInnerSize.x * this.getZoom(t))
        }, deltaPixelsFromPoints: function (e, t) {
            return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()), t)
        }, deltaPointsFromPixelsNoRotate: function (e, t) {
            return e.divide(this._containerInnerSize.x * this.getZoom(t))
        }, deltaPointsFromPixels: function (e, t) {
            return this.deltaPointsFromPixelsNoRotate(e, t).rotate(-this.getRotation())
        }, pixelFromPointNoRotate: function (e, t) {
            return this._pixelFromPointNoRotate(e, this.getBoundsNoRotate(t))
        }, pixelFromPoint: function (e, t) {
            return this._pixelFromPoint(e, this.getBoundsNoRotate(t))
        }, _pixelFromPointNoRotate: function (t, n) {
            return t.minus(n.getTopLeft()).times(this._containerInnerSize.x / n.width).plus(new e.Point(this._margins.left, this._margins.top))
        }, _pixelFromPoint: function (e, t) {
            return this._pixelFromPointNoRotate(e.rotate(this.getRotation(), this.getCenter(!0)), t)
        }, pointFromPixelNoRotate: function (t, n) {
            var r = this.getBoundsNoRotate(n);
            return t.minus(new e.Point(this._margins.left, this._margins.top)).divide(this._containerInnerSize.x / r.width).plus(r.getTopLeft())
        }, pointFromPixel: function (e, t) {
            return this.pointFromPixelNoRotate(e, t).rotate(-this.getRotation(), this.getCenter(!0))
        }, _viewportToImageDelta: function (t, n) {
            var r = this._contentBoundsNoRotate.width;
            return new e.Point(t * this._contentSizeNoRotate.x / r, n * this._contentSizeNoRotate.x / r)
        }, viewportToImageCoordinates: function (t, n) {
            if (t instanceof e.Point) return this.viewportToImageCoordinates(t.x, t.y);
            if (this.viewer) {
                var r = this.viewer.world.getItemCount();
                if (r > 1) e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead."); else if (r === 1) {
                    var i = this.viewer.world.getItemAt(0);
                    return i.viewportToImageCoordinates(t, n, !0)
                }
            }
            return this._viewportToImageDelta(t - this._contentBoundsNoRotate.x, n - this._contentBoundsNoRotate.y)
        }, _imageToViewportDelta: function (t, n) {
            var r = this._contentBoundsNoRotate.width;
            return new e.Point(t / this._contentSizeNoRotate.x * r, n / this._contentSizeNoRotate.x * r)
        }, imageToViewportCoordinates: function (t, n) {
            if (t instanceof e.Point) return this.imageToViewportCoordinates(t.x, t.y);
            if (this.viewer) {
                var r = this.viewer.world.getItemCount();
                if (r > 1) e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead."); else if (r === 1) {
                    var i = this.viewer.world.getItemAt(0);
                    return i.imageToViewportCoordinates(t, n, !0)
                }
            }
            var s = this._imageToViewportDelta(t, n);
            return s.x += this._contentBoundsNoRotate.x, s.y += this._contentBoundsNoRotate.y, s
        }, imageToViewportRectangle: function (t, n, r, i) {
            var s = t;
            s instanceof e.Rect || (s = new e.Rect(t, n, r, i));
            if (this.viewer) {
                var o = this.viewer.world.getItemCount();
                if (o > 1) e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead."); else if (o === 1) {
                    var u = this.viewer.world.getItemAt(0);
                    return u.imageToViewportRectangle(t, n, r, i, !0)
                }
            }
            var a = this.imageToViewportCoordinates(s.x, s.y), f = this._imageToViewportDelta(s.width, s.height);
            return new e.Rect(a.x, a.y, f.x, f.y, s.degrees)
        }, viewportToImageRectangle: function (t, n, r, i) {
            var s = t;
            s instanceof e.Rect || (s = new e.Rect(t, n, r, i));
            if (this.viewer) {
                var o = this.viewer.world.getItemCount();
                if (o > 1) e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead."); else if (o === 1) {
                    var u = this.viewer.world.getItemAt(0);
                    return u.viewportToImageRectangle(t, n, r, i, !0)
                }
            }
            var a = this.viewportToImageCoordinates(s.x, s.y), f = this._viewportToImageDelta(s.width, s.height);
            return new e.Rect(a.x, a.y, f.x, f.y, s.degrees)
        }, viewerElementToImageCoordinates: function (e) {
            var t = this.pointFromPixel(e, !0);
            return this.viewportToImageCoordinates(t)
        }, imageToViewerElementCoordinates: function (e) {
            var t = this.imageToViewportCoordinates(e);
            return this.pixelFromPoint(t, !0)
        }, windowToImageCoordinates: function (t) {
            e.console.assert(this.viewer, "[Viewport.windowToImageCoordinates] the viewport must have a viewer.");
            var n = t.minus(e.getElementPosition(this.viewer.element));
            return this.viewerElementToImageCoordinates(n)
        }, imageToWindowCoordinates: function (t) {
            e.console.assert(this.viewer, "[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");
            var n = this.imageToViewerElementCoordinates(t);
            return n.plus(e.getElementPosition(this.viewer.element))
        }, viewerElementToViewportCoordinates: function (e) {
            return this.pointFromPixel(e, !0)
        }, viewportToViewerElementCoordinates: function (e) {
            return this.pixelFromPoint(e, !0)
        }, viewerElementToViewportRectangle: function (t) {
            return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(), !0), this.pointFromPixel(t.getTopRight(), !0), this.pointFromPixel(t.getBottomLeft(), !0))
        }, viewportToViewerElementRectangle: function (t) {
            return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(), !0), this.pixelFromPoint(t.getTopRight(), !0), this.pixelFromPoint(t.getBottomLeft(), !0))
        }, windowToViewportCoordinates: function (t) {
            e.console.assert(this.viewer, "[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");
            var n = t.minus(e.getElementPosition(this.viewer.element));
            return this.viewerElementToViewportCoordinates(n)
        }, viewportToWindowCoordinates: function (t) {
            e.console.assert(this.viewer, "[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");
            var n = this.viewportToViewerElementCoordinates(t);
            return n.plus(e.getElementPosition(this.viewer.element))
        }, viewportToImageZoom: function (t) {
            if (this.viewer) {
                var n = this.viewer.world.getItemCount();
                if (n > 1) e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image."); else if (n === 1) {
                    var r = this.viewer.world.getItemAt(0);
                    return r.viewportToImageZoom(t)
                }
            }
            var i = this._contentSizeNoRotate.x, s = this._containerInnerSize.x, o = this._contentBoundsNoRotate.width,
                u = s / i * o;
            return t * u
        }, imageToViewportZoom: function (t) {
            if (this.viewer) {
                var n = this.viewer.world.getItemCount();
                if (n > 1) e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image."); else if (n === 1) {
                    var r = this.viewer.world.getItemAt(0);
                    return r.imageToViewportZoom(t)
                }
            }
            var i = this._contentSizeNoRotate.x, s = this._containerInnerSize.x, o = this._contentBoundsNoRotate.width,
                u = i / s / o;
            return t * u
        }
    }
}(OpenSeadragon),function (e) {
    function t(e, t, r, i, s, o, u, a, f) {
        var l = u.getBoundingBox().getTopLeft(), c = u.getBoundingBox().getBottomRight();
        e.viewer && e.viewer.raiseEvent("update-level", {
            tiledImage: e,
            havedrawn: t,
            level: i,
            opacity: s,
            visibility: o,
            drawArea: u,
            topleft: l,
            bottomright: c,
            currenttime: a,
            best: f
        }), h(e.coverage, i), h(e.loadingCoverage, i);
        var p = e._getCornerTiles(i, l, c), d = p.topLeft, v = p.bottomRight, m = e.source.getNumTiles(i),
            g = e.viewport.pixelFromPoint(e.viewport.getCenter());
        for (var y = d.x; y <= v.x; y++) for (var b = d.y; b <= v.y; b++) {
            if (!e.wrapHorizontal && !e.wrapVertical) {
                var w = e.source.getTileBounds(i, y, b);
                if (u.intersection(w) === null) continue
            }
            f = n(e, r, t, y, b, i, s, o, g, m, a, f)
        }
        return f
    }

    function n(e, t, n, i, s, f, h, d, v, m, g, y) {
        var b = r(i, s, f, e, e.source, e.tilesMatrix, g, m, e._worldWidthCurrent, e._worldHeightCurrent), w = n;
        e.viewer && e.viewer.raiseEvent("update-tile", {tiledImage: e, tile: b}), c(e.coverage, f, i, s, !1);
        var E = b.loaded || b.loading || l(e.loadingCoverage, f, i, s);
        c(e.loadingCoverage, f, i, s, E);
        if (!b.exists) return y;
        t && !w && (l(e.coverage, f, i, s) ? c(e.coverage, f, i, s, !0) : w = !0);
        if (!w) return y;
        u(b, e.source.tileOverlap, e.viewport, v, d, e);
        if (!b.loaded) if (b.context2D) o(e, b); else {
            var S = e._tileCache.getImageRecord(b.cacheKey);
            if (S) {
                var x = S.getImage();
                o(e, b, x)
            }
        }
        if (b.loaded) {
            var T = a(e, b, i, s, f, h, g);
            T && (e._needsDraw = !0)
        } else b.loading ? e._tilesLoading++ : E || (y = p(y, b));
        return y
    }

    function r(t, n, r, i, s, o, u, a, f, l) {
        var c, h, p, d, v, m, g, y;
        return o[r] || (o[r] = {}), o[r][t] || (o[r][t] = {}), o[r][t][n] || (c = (a.x + t % a.x) % a.x, h = (a.y + n % a.y) % a.y, p = s.getTileBounds(r, c, h), d = s.tileExists(r, c, h), v = s.getTileUrl(r, c, h), i.loadTilesWithAjax ? (m = s.getTileAjaxHeaders(r, c, h), e.isPlainObject(i.ajaxHeaders) && (m = e.extend({}, i.ajaxHeaders, m))) : m = null, g = s.getContext2D ? s.getContext2D(r, c, h) : undefined, p.x += (t - c) / a.x, p.y += l / f * ((n - h) / a.y), y = new e.Tile(r, t, n, p, d, v, g, i.loadTilesWithAjax, m), c === a.x - 1 && (y.isRightMost = !0), h === a.y - 1 && (y.isBottomMost = !0), o[r][t][n] = y), y = o[r][t][n], y.lastTouchTime = u, y
    }

    function i(e, t, n) {
        t.loading = !0, e._imageLoader.addJob({
            src: t.url,
            loadWithAjax: t.loadWithAjax,
            ajaxHeaders: t.ajaxHeaders,
            crossOriginPolicy: e.crossOriginPolicy,
            ajaxWithCredentials: e.ajaxWithCredentials,
            callback: function (r, i, o) {
                s(e, t, n, r, i, o)
            },
            abort: function () {
                t.loading = !1
            }
        })
    }

    function s(t, n, r, i, s, u) {
        if (!i) {
            e.console.log("Tile %s failed to load: %s - error: %s", n, n.url, s), t.viewer.raiseEvent("tile-load-failed", {
                tile: n,
                tiledImage: t,
                time: r,
                message: s,
                tileRequest: u
            }), n.loading = !1, n.exists = !1;
            return
        }
        if (r < t.lastResetTime) {
            e.console.log("Ignoring tile %s loaded before reset: %s", n, n.url), n.loading = !1;
            return
        }
        var a = function () {
            var e = t.source.getClosestLevel();
            o(t, n, i, e, u)
        };
        t._midDraw ? window.setTimeout(a, 1) : a()
    }

    function o(e, t, n, r, i) {
        function o() {
            return s++, u
        }

        function u() {
            s--, s === 0 && (t.loading = !1, t.loaded = !0, t.context2D || e._tileCache.cacheTile({
                image: n,
                tile: t,
                cutoff: r,
                tiledImage: e
            }), e._needsDraw = !0)
        }

        var s = 0;
        e.viewer.raiseEvent("tile-loaded", {
            tile: t,
            tiledImage: e,
            tileRequest: i,
            image: n,
            getCompletionCallback: o
        }), o()()
    }

    function u(t, n, r, i, s, o) {
        var u = t.bounds.getTopLeft();
        u.x *= o._scaleSpring.current.value, u.y *= o._scaleSpring.current.value, u.x += o._xSpring.current.value, u.y += o._ySpring.current.value;
        var a = t.bounds.getSize();
        a.x *= o._scaleSpring.current.value, a.y *= o._scaleSpring.current.value;
        var f = r.pixelFromPointNoRotate(u, !0), l = r.pixelFromPointNoRotate(u, !1),
            c = r.deltaPixelsFromPointsNoRotate(a, !0), h = r.deltaPixelsFromPointsNoRotate(a, !1),
            p = l.plus(h.divide(2)), d = i.squaredDistanceTo(p);
        n || (c = c.plus(new e.Point(1, 1))), t.isRightMost && o.wrapHorizontal && (c.x += .75), t.isBottomMost && o.wrapVertical && (c.y += .75), t.position = f, t.size = c, t.squaredDistance = d, t.visibility = s
    }

    function a(e, t, n, r, i, s, o) {
        var u = 1e3 * e.blendTime, a, f;
        t.blendStart || (t.blendStart = o), a = o - t.blendStart, f = u ? Math.min(1, a / u) : 1, e.alwaysBlend && (f *= s), t.opacity = f, e.lastDrawn.push(t);
        if (f == 1) c(e.coverage, i, n, r, !0), e._hasOpaqueTile = !0; else if (a < u) return !0;
        return !1
    }

    function f(e, t, n, r) {
        var i, s, o, u;
        if (!e[t]) return !1;
        if (n === undefined || r === undefined) {
            i = e[t];
            for (o in i) if (i.hasOwnProperty(o)) {
                s = i[o];
                for (u in s) if (s.hasOwnProperty(u) && !s[u]) return !1
            }
            return !0
        }
        return e[t][n] === undefined || e[t][n][r] === undefined || e[t][n][r] === !0
    }

    function l(e, t, n, r) {
        return n === undefined || r === undefined ? f(e, t + 1) : f(e, t + 1, 2 * n, 2 * r) && f(e, t + 1, 2 * n, 2 * r + 1) && f(e, t + 1, 2 * n + 1, 2 * r) && f(e, t + 1, 2 * n + 1, 2 * r + 1)
    }

    function c(t, n, r, i, s) {
        if (!t[n]) {
            e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s", n);
            return
        }
        t[n][r] || (t[n][r] = {}), t[n][r][i] = s
    }

    function h(e, t) {
        e[t] = {}
    }

    function p(e, t) {
        return e ? t.visibility > e.visibility ? t : t.visibility == e.visibility && t.squaredDistance < e.squaredDistance ? t : e : t
    }

    function d(t, n) {
        if (t.opacity === 0 || n.length === 0 && !t.placeholderFillStyle) return;
        var r = n[0], i;
        r && (i = t.opacity < 1 || t.compositeOperation && t.compositeOperation !== "source-over" || !t._isBottomItem() && r._hasTransparencyChannel());
        var s, o, u = t.viewport.getZoom(!0), a = t.viewportToImageZoom(u);
        n.length > 1 && a > t.smoothTileEdgesMinZoom && !t.iOSDevice && t.getRotation(!0) % 360 === 0 && e.supportsCanvas && (i = !0, s = r.getScaleForEdgeSmoothing(), o = r.getTranslationForEdgeSmoothing(s, t._drawer.getCanvasSize(!1), t._drawer.getCanvasSize(!0)));
        var f;
        i && (s || (f = t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox().times(e.pixelDensityRatio)), t._drawer._clear(!0, f)), s || (t.viewport.degrees !== 0 && t._drawer._offsetForRotation({
            degrees: t.viewport.degrees,
            useSketch: i
        }), t.getRotation(!0) % 360 !== 0 && t._drawer._offsetForRotation({
            degrees: t.getRotation(!0),
            point: t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0), !0),
            useSketch: i
        }));
        var l = !1;
        if (t._clip) {
            t._drawer.saveContext(i);
            var c = t.imageToViewportRectangle(t._clip, !0);
            c = c.rotate(-t.getRotation(!0), t._getRotationPoint(!0));
            var h = t._drawer.viewportToDrawerRectangle(c);
            s && (h = h.times(s)), o && (h = h.translate(o)), t._drawer.setClip(h, i), l = !0
        }
        if (t.placeholderFillStyle && t._hasOpaqueTile === !1) {
            var p = t._drawer.viewportToDrawerRectangle(t.getBounds(!0));
            s && (p = p.times(s)), o && (p = p.translate(o));
            var d = null;
            typeof t.placeholderFillStyle == "function" ? d = t.placeholderFillStyle(t, t._drawer.context) : d = t.placeholderFillStyle, t._drawer.drawRectangle(p, d, i)
        }
        for (var m = n.length - 1; m >= 0; m--) r = n[m], t._drawer.drawTile(r, t._drawingHandler, i, s, o), r.beingDrawn = !0, t.viewer && t.viewer.raiseEvent("tile-drawn", {
            tiledImage: t,
            tile: r
        });
        l && t._drawer.restoreContext(i), s || (t.getRotation(!0) % 360 !== 0 && t._drawer._restoreRotationChanges(i), t.viewport.degrees !== 0 && t._drawer._restoreRotationChanges(i)), i && (s && (t.viewport.degrees !== 0 && t._drawer._offsetForRotation({
            degrees: t.viewport.degrees,
            useSketch: !1
        }), t.getRotation(!0) % 360 !== 0 && t._drawer._offsetForRotation({
            degrees: t.getRotation(!0),
            point: t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0), !0),
            useSketch: !1
        })), t._drawer.blendSketch({
            opacity: t.opacity,
            scale: s,
            translate: o,
            compositeOperation: t.compositeOperation,
            bounds: f
        }), s && (t.getRotation(!0) % 360 !== 0 && t._drawer._restoreRotationChanges(!1), t.viewport.degrees !== 0 && t._drawer._restoreRotationChanges(!1))), v(t, n)
    }

    function v(t, n) {
        if (t.debugMode) for (var r = n.length - 1; r >= 0; r--) {
            var i = n[r];
            try {
                t._drawer.drawDebugInfo(i, n.length, r, t)
            } catch (s) {
                e.console.error(s)
            }
        }
    }

    e.TiledImage = function (t) {
        var n = this;
        e.console.assert(t.tileCache, "[TiledImage] options.tileCache is required"), e.console.assert(t.drawer, "[TiledImage] options.drawer is required"), e.console.assert(t.viewer, "[TiledImage] options.viewer is required"), e.console.assert(t.imageLoader, "[TiledImage] options.imageLoader is required"), e.console.assert(t.source, "[TiledImage] options.source is required"), e.console.assert(!t.clip || t.clip instanceof e.Rect, "[TiledImage] options.clip must be an OpenSeadragon.Rect if present"), e.EventSource.call(this), this._tileCache = t.tileCache, delete t.tileCache, this._drawer = t.drawer, delete t.drawer, this._imageLoader = t.imageLoader, delete t.imageLoader, t.clip instanceof e.Rect && (this._clip = t.clip.clone()), delete t.clip;
        var r = t.x || 0;
        delete t.x;
        var i = t.y || 0;
        delete t.y, this.normHeight = t.source.dimensions.y / t.source.dimensions.x, this.contentAspectX = t.source.dimensions.x / t.source.dimensions.y;
        var s = 1;
        t.width ? (s = t.width, delete t.width, t.height && (e.console.error("specifying both width and height to a tiledImage is not supported"), delete t.height)) : t.height && (s = t.height / this.normHeight, delete t.height);
        var o = t.fitBounds;
        delete t.fitBounds;
        var u = t.fitBoundsPlacement || OpenSeadragon.Placement.CENTER;
        delete t.fitBoundsPlacement;
        var a = t.degrees || 0;
        delete t.degrees, e.extend(!0, this, {
            viewer: null,
            tilesMatrix: {},
            coverage: {},
            loadingCoverage: {},
            lastDrawn: [],
            lastResetTime: 0,
            _midDraw: !1,
            _needsDraw: !0,
            _hasOpaqueTile: !1,
            _tilesLoading: 0,
            springStiffness: e.DEFAULT_SETTINGS.springStiffness,
            animationTime: e.DEFAULT_SETTINGS.animationTime,
            minZoomImageRatio: e.DEFAULT_SETTINGS.minZoomImageRatio,
            wrapHorizontal: e.DEFAULT_SETTINGS.wrapHorizontal,
            wrapVertical: e.DEFAULT_SETTINGS.wrapVertical,
            immediateRender: e.DEFAULT_SETTINGS.immediateRender,
            blendTime: e.DEFAULT_SETTINGS.blendTime,
            alwaysBlend: e.DEFAULT_SETTINGS.alwaysBlend,
            minPixelRatio: e.DEFAULT_SETTINGS.minPixelRatio,
            smoothTileEdgesMinZoom: e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,
            iOSDevice: e.DEFAULT_SETTINGS.iOSDevice,
            debugMode: e.DEFAULT_SETTINGS.debugMode,
            crossOriginPolicy: e.DEFAULT_SETTINGS.crossOriginPolicy,
            ajaxWithCredentials: e.DEFAULT_SETTINGS.ajaxWithCredentials,
            placeholderFillStyle: e.DEFAULT_SETTINGS.placeholderFillStyle,
            opacity: e.DEFAULT_SETTINGS.opacity,
            preload: e.DEFAULT_SETTINGS.preload,
            compositeOperation: e.DEFAULT_SETTINGS.compositeOperation
        }, t), this._preload = this.preload, delete this.preload, this._fullyLoaded = !1, this._xSpring = new e.Spring({
            initial: r,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime
        }), this._ySpring = new e.Spring({
            initial: i,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime
        }), this._scaleSpring = new e.Spring({
            initial: s,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime
        }), this._degreesSpring = new e.Spring({
            initial: a,
            springStiffness: this.springStiffness,
            animationTime: this.animationTime
        }), this._updateForScale(), o && this.fitBounds(o, u, !0), this._drawingHandler = function (t) {
            n.viewer.raiseEvent("tile-drawing", e.extend({tiledImage: n}, t))
        }
    }, e.extend(e.TiledImage.prototype, e.EventSource.prototype, {
        needsDraw: function () {
            return this._needsDraw
        }, getFullyLoaded: function () {
            return this._fullyLoaded
        }, _setFullyLoaded: function (e) {
            if (e === this._fullyLoaded) return;
            this._fullyLoaded = e, this.raiseEvent("fully-loaded-change", {fullyLoaded: this._fullyLoaded})
        }, reset: function () {
            this._tileCache.clearTilesFor(this), this.lastResetTime = e.now(), this._needsDraw = !0
        }, update: function () {
            var e = this._xSpring.update(), t = this._ySpring.update(), n = this._scaleSpring.update(),
                r = this._degreesSpring.update();
            return e || t || n || r ? (this._updateForScale(), this._needsDraw = !0, !0) : !1
        }, draw: function () {
            if (this.opacity !== 0 || this._preload) this._midDraw = !0, this._updateViewport(), this._midDraw = !1
        }, destroy: function () {
            this.reset()
        }, getBounds: function (e) {
            return this.getBoundsNoRotate(e).rotate(this.getRotation(e), this._getRotationPoint(e))
        }, getBoundsNoRotate: function (t) {
            return t ? new e.Rect(this._xSpring.current.value, this._ySpring.current.value, this._worldWidthCurrent, this._worldHeightCurrent) : new e.Rect(this._xSpring.target.value, this._ySpring.target.value, this._worldWidthTarget, this._worldHeightTarget)
        }, getWorldBounds: function () {
            return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"), this.getBounds()
        }, getClippedBounds: function (t) {
            var n = this.getBoundsNoRotate(t);
            if (this._clip) {
                var r = t ? this._worldWidthCurrent : this._worldWidthTarget, i = r / this.source.dimensions.x,
                    s = this._clip.times(i);
                n = new e.Rect(n.x + s.x, n.y + s.y, s.width, s.height)
            }
            return n.rotate(this.getRotation(t), this._getRotationPoint(t))
        }, getContentSize: function () {
            return new e.Point(this.source.dimensions.x, this.source.dimensions.y)
        }, _viewportToImageDelta: function (t, n, r) {
            var i = r ? this._scaleSpring.current.value : this._scaleSpring.target.value;
            return new e.Point(t * (this.source.dimensions.x / i), n * (this.source.dimensions.y * this.contentAspectX / i))
        }, viewportToImageCoordinates: function (t, n, r) {
            var i;
            return t instanceof e.Point ? (r = n, i = t) : i = new e.Point(t, n), i = i.rotate(-this.getRotation(r), this._getRotationPoint(r)), r ? this._viewportToImageDelta(i.x - this._xSpring.current.value, i.y - this._ySpring.current.value) : this._viewportToImageDelta(i.x - this._xSpring.target.value, i.y - this._ySpring.target.value)
        }, _imageToViewportDelta: function (t, n, r) {
            var i = r ? this._scaleSpring.current.value : this._scaleSpring.target.value;
            return new e.Point(t / this.source.dimensions.x * i, n / this.source.dimensions.y / this.contentAspectX * i)
        }, imageToViewportCoordinates: function (t, n, r) {
            t instanceof e.Point && (r = n, n = t.y, t = t.x);
            var i = this._imageToViewportDelta(t, n);
            return r ? (i.x += this._xSpring.current.value, i.y += this._ySpring.current.value) : (i.x += this._xSpring.target.value, i.y += this._ySpring.target.value), i.rotate(this.getRotation(r), this._getRotationPoint(r))
        }, imageToViewportRectangle: function (t, n, r, i, s) {
            var o = t;
            o instanceof e.Rect ? s = n : o = new e.Rect(t, n, r, i);
            var u = this.imageToViewportCoordinates(o.getTopLeft(), s),
                a = this._imageToViewportDelta(o.width, o.height, s);
            return new e.Rect(u.x, u.y, a.x, a.y, o.degrees + this.getRotation(s))
        }, viewportToImageRectangle: function (t, n, r, i, s) {
            var o = t;
            t instanceof e.Rect ? s = n : o = new e.Rect(t, n, r, i);
            var u = this.viewportToImageCoordinates(o.getTopLeft(), s),
                a = this._viewportToImageDelta(o.width, o.height, s);
            return new e.Rect(u.x, u.y, a.x, a.y, o.degrees - this.getRotation(s))
        }, viewerElementToImageCoordinates: function (e) {
            var t = this.viewport.pointFromPixel(e, !0);
            return this.viewportToImageCoordinates(t)
        }, imageToViewerElementCoordinates: function (e) {
            var t = this.imageToViewportCoordinates(e);
            return this.viewport.pixelFromPoint(t, !0)
        }, windowToImageCoordinates: function (e) {
            var t = e.minus(OpenSeadragon.getElementPosition(this.viewer.element));
            return this.viewerElementToImageCoordinates(t)
        }, imageToWindowCoordinates: function (e) {
            var t = this.imageToViewerElementCoordinates(e);
            return t.plus(OpenSeadragon.getElementPosition(this.viewer.element))
        }, _viewportToTiledImageRectangle: function (t) {
            var n = this._scaleSpring.current.value;
            return t = t.rotate(-this.getRotation(!0), this._getRotationPoint(!0)), new e.Rect((t.x - this._xSpring.current.value) / n, (t.y - this._ySpring.current.value) / n, t.width / n, t.height / n, t.degrees)
        }, viewportToImageZoom: function (e) {
            var t = this._scaleSpring.current.value * this.viewport._containerInnerSize.x / this.source.dimensions.x;
            return t * e
        }, imageToViewportZoom: function (e) {
            var t = this._scaleSpring.current.value * this.viewport._containerInnerSize.x / this.source.dimensions.x;
            return e / t
        }, setPosition: function (e, t) {
            var n = this._xSpring.target.value === e.x && this._ySpring.target.value === e.y;
            if (t) {
                if (n && this._xSpring.current.value === e.x && this._ySpring.current.value === e.y) return;
                this._xSpring.resetTo(e.x), this._ySpring.resetTo(e.y), this._needsDraw = !0
            } else {
                if (n) return;
                this._xSpring.springTo(e.x), this._ySpring.springTo(e.y), this._needsDraw = !0
            }
            n || this._raiseBoundsChange()
        }, setWidth: function (e, t) {
            this._setScale(e, t)
        }, setHeight: function (e, t) {
            this._setScale(e / this.normHeight, t)
        }, fitBounds: function (t, n, r) {
            n = n || e.Placement.CENTER;
            var i = e.Placement.properties[n], s = this.contentAspectX, o = 0, u = 0, a = 1, f = 1;
            this._clip && (s = this._clip.getAspectRatio(), a = this._clip.width / this.source.dimensions.x, f = this._clip.height / this.source.dimensions.y, t.getAspectRatio() > s ? (o = this._clip.x / this._clip.height * t.height, u = this._clip.y / this._clip.height * t.height) : (o = this._clip.x / this._clip.width * t.width, u = this._clip.y / this._clip.width * t.width));
            if (t.getAspectRatio() > s) {
                var l = t.height / f, c = 0;
                i.isHorizontallyCentered ? c = (t.width - t.height * s) / 2 : i.isRight && (c = t.width - t.height * s), this.setPosition(new e.Point(t.x - o + c, t.y - u), r), this.setHeight(l, r)
            } else {
                var h = t.width / a, p = 0;
                i.isVerticallyCentered ? p = (t.height - t.width / s) / 2 : i.isBottom && (p = t.height - t.width / s), this.setPosition(new e.Point(t.x - o, t.y - u + p), r), this.setWidth(h, r)
            }
        }, getClip: function () {
            return this._clip ? this._clip.clone() : null
        }, setClip: function (t) {
            e.console.assert(!t || t instanceof e.Rect, "[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"), t instanceof e.Rect ? this._clip = t.clone() : this._clip = null, this._needsDraw = !0, this.raiseEvent("clip-change")
        }, getOpacity: function () {
            return this.opacity
        }, setOpacity: function (e) {
            if (e === this.opacity) return;
            this.opacity = e, this._needsDraw = !0, this.raiseEvent("opacity-change", {opacity: this.opacity})
        }, getPreload: function () {
            return this._preload
        }, setPreload: function (e) {
            this._preload = !!e, this._needsDraw = !0
        }, getRotation: function (e) {
            return e ? this._degreesSpring.current.value : this._degreesSpring.target.value
        }, setRotation: function (e, t) {
            if (this._degreesSpring.target.value === e && this._degreesSpring.isAtTargetValue()) return;
            t ? this._degreesSpring.resetTo(e) : this._degreesSpring.springTo(e), this._needsDraw = !0, this._raiseBoundsChange()
        }, _getRotationPoint: function (e) {
            return this.getBoundsNoRotate(e).getCenter()
        }, getCompositeOperation: function () {
            return this.compositeOperation
        }, setCompositeOperation: function (e) {
            if (e === this.compositeOperation) return;
            this.compositeOperation = e, this._needsDraw = !0, this.raiseEvent("composite-operation-change", {compositeOperation: this.compositeOperation})
        }, _setScale: function (e, t) {
            var n = this._scaleSpring.target.value === e;
            if (t) {
                if (n && this._scaleSpring.current.value === e) return;
                this._scaleSpring.resetTo(e), this._updateForScale(), this._needsDraw = !0
            } else {
                if (n) return;
                this._scaleSpring.springTo(e), this._updateForScale(), this._needsDraw = !0
            }
            n || this._raiseBoundsChange()
        }, _updateForScale: function () {
            this._worldWidthTarget = this._scaleSpring.target.value, this._worldHeightTarget = this.normHeight * this._scaleSpring.target.value, this._worldWidthCurrent = this._scaleSpring.current.value, this._worldHeightCurrent = this.normHeight * this._scaleSpring.current.value
        }, _raiseBoundsChange: function () {
            this.raiseEvent("bounds-change")
        }, _isBottomItem: function () {
            return this.viewer.world.getItemAt(0) === this
        }, _getLevelsInterval: function () {
            var e = Math.max(this.source.minLevel, Math.floor(Math.log(this.minZoomImageRatio) / Math.log(2))),
                t = this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0), !0).x * this._scaleSpring.current.value,
                n = Math.min(Math.abs(this.source.maxLevel), Math.abs(Math.floor(Math.log(t / this.minPixelRatio) / Math.log(2))));
            return e = Math.min(e, n), {lowestLevel: e, highestLevel: n}
        }, _updateViewport: function () {
            this._needsDraw = !1, this._tilesLoading = 0, this.loadingCoverage = {};
            while (this.lastDrawn.length > 0) {
                var n = this.lastDrawn.pop();
                n.beingDrawn = !1
            }
            var r = this.viewport, s = this._viewportToTiledImageRectangle(r.getBoundsWithMargins(!0));
            if (!this.wrapHorizontal && !this.wrapVertical) {
                var o = this._viewportToTiledImageRectangle(this.getClippedBounds(!0));
                s = s.intersection(o);
                if (s === null) return
            }
            var u = this._getLevelsInterval(), a = u.lowestLevel, l = u.highestLevel, c = null, h = !1, p = e.now();
            for (var v = l; v >= a; v--) {
                var m = !1,
                    g = r.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(v), !0).x * this._scaleSpring.current.value;
                if (v === a || !h && g >= this.minPixelRatio) m = !0, h = !0; else if (!h) continue;
                var y = r.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(v), !1).x * this._scaleSpring.current.value,
                    b = r.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(), 0)), !1).x * this._scaleSpring.current.value,
                    w = this.immediateRender ? 1 : b, E = Math.min(1, (g - .5) / .5), S = w / Math.abs(w - y);
                c = t(this, h, m, v, E, S, s, p, c);
                if (f(this.coverage, v)) break
            }
            d(this, this.lastDrawn), c && !c.context2D ? (i(this, c, p), this._needsDraw = !0, this._setFullyLoaded(!1)) : this._setFullyLoaded(this._tilesLoading === 0)
        }, _getCornerTiles: function (t, n, r) {
            var i, s;
            this.wrapHorizontal ? (i = e.positiveModulo(n.x, 1), s = e.positiveModulo(r.x, 1)) : (i = Math.max(0, n.x), s = Math.min(1, r.x));
            var o, u, a = 1 / this.source.aspectRatio;
            this.wrapVertical ? (o = e.positiveModulo(n.y, a), u = e.positiveModulo(r.y, a)) : (o = Math.max(0, n.y), u = Math.min(a, r.y));
            var f = this.source.getTileAtPoint(t, new e.Point(i, o)),
                l = this.source.getTileAtPoint(t, new e.Point(s, u)), c = this.source.getNumTiles(t);
            return this.wrapHorizontal && (f.x += c.x * Math.floor(n.x), l.x += c.x * Math.floor(r.x)), this.wrapVertical && (f.y += c.y * Math.floor(n.y / a), l.y += c.y * Math.floor(r.y / a)), {
                topLeft: f,
                bottomRight: l
            }
        }
    })
}(OpenSeadragon),function (e) {
    var t = function (t) {
        e.console.assert(t, "[TileCache.cacheTile] options is required"), e.console.assert(t.tile, "[TileCache.cacheTile] options.tile is required"), e.console.assert(t.tiledImage, "[TileCache.cacheTile] options.tiledImage is required"), this.tile = t.tile, this.tiledImage = t.tiledImage
    }, n = function (t) {
        e.console.assert(t, "[ImageRecord] options is required"), e.console.assert(t.image, "[ImageRecord] options.image is required"), this._image = t.image, this._tiles = []
    };
    n.prototype = {
        destroy: function () {
            this._image = null, this._renderedContext = null, this._tiles = null
        }, getImage: function () {
            return this._image
        }, getRenderedContext: function () {
            if (!this._renderedContext) {
                var e = document.createElement("canvas");
                e.width = this._image.width, e.height = this._image.height, this._renderedContext = e.getContext("2d"), this._renderedContext.drawImage(this._image, 0, 0), this._image = null
            }
            return this._renderedContext
        }, setRenderedContext: function (t) {
            e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."), this._renderedContext = t
        }, addTile: function (t) {
            e.console.assert(t, "[ImageRecord.addTile] tile is required"), this._tiles.push(t)
        }, removeTile: function (t) {
            for (var n = 0; n < this._tiles.length; n++) if (this._tiles[n] === t) {
                this._tiles.splice(n, 1);
                return
            }
            e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile", t)
        }, getTileCount: function () {
            return this._tiles.length
        }
    }, e.TileCache = function (t) {
        t = t || {}, this._maxImageCacheCount = t.maxImageCacheCount || e.DEFAULT_SETTINGS.maxImageCacheCount, this._tilesLoaded = [], this._imagesLoaded = [], this._imagesLoadedCount = 0
    }, e.TileCache.prototype = {
        numTilesLoaded: function () {
            return this._tilesLoaded.length
        }, cacheTile: function (r) {
            e.console.assert(r, "[TileCache.cacheTile] options is required"), e.console.assert(r.tile, "[TileCache.cacheTile] options.tile is required"), e.console.assert(r.tile.cacheKey, "[TileCache.cacheTile] options.tile.cacheKey is required"), e.console.assert(r.tiledImage, "[TileCache.cacheTile] options.tiledImage is required");
            var i = r.cutoff || 0, s = this._tilesLoaded.length, o = this._imagesLoaded[r.tile.cacheKey];
            o || (e.console.assert(r.image, "[TileCache.cacheTile] options.image is required to create an ImageRecord"), o = this._imagesLoaded[r.tile.cacheKey] = new n({image: r.image}), this._imagesLoadedCount++), o.addTile(r.tile), r.tile.cacheImageRecord = o;
            if (this._imagesLoadedCount > this._maxImageCacheCount) {
                var u = null, a = -1, f = null, l, c, h, p, d, v;
                for (var m = this._tilesLoaded.length - 1; m >= 0; m--) {
                    v = this._tilesLoaded[m], l = v.tile;
                    if (l.level <= i || l.beingDrawn) continue;
                    if (!u) {
                        u = l, a = m, f = v;
                        continue
                    }
                    p = l.lastTouchTime, c = u.lastTouchTime, d = l.level, h = u.level;
                    if (p < c || p == c && d > h) u = l, a = m, f = v
                }
                u && a >= 0 && (this._unloadTile(f), s = a)
            }
            this._tilesLoaded[s] = new t({tile: r.tile, tiledImage: r.tiledImage})
        }, clearTilesFor: function (t) {
            e.console.assert(t, "[TileCache.clearTilesFor] tiledImage is required");
            var n;
            for (var r = 0; r < this._tilesLoaded.length; ++r) n = this._tilesLoaded[r], n.tiledImage === t && (this._unloadTile(n), this._tilesLoaded.splice(r, 1), r--)
        }, getImageRecord: function (t) {
            return e.console.assert(t, "[TileCache.getImageRecord] cacheKey is required"), this._imagesLoaded[t]
        }, _unloadTile: function (t) {
            e.console.assert(t, "[TileCache._unloadTile] tileRecord is required");
            var n = t.tile, r = t.tiledImage;
            n.unload(), n.cacheImageRecord = null;
            var i = this._imagesLoaded[n.cacheKey];
            i.removeTile(n), i.getTileCount() || (i.destroy(), delete this._imagesLoaded[n.cacheKey], this._imagesLoadedCount--), r.viewer.raiseEvent("tile-unloaded", {
                tile: n,
                tiledImage: r
            })
        }
    }
}(OpenSeadragon),function (e) {
    e.World = function (t) {
        var n = this;
        e.console.assert(t.viewer, "[World] options.viewer is required"), e.EventSource.call(this), this.viewer = t.viewer, this._items = [], this._needsDraw = !1, this._autoRefigureSizes = !0, this._needsSizesFigured = !1, this._delegatedFigureSizes = function (e) {
            n._autoRefigureSizes ? n._figureSizes() : n._needsSizesFigured = !0
        }, this._figureSizes()
    }, e.extend(e.World.prototype, e.EventSource.prototype, {
        addItem: function (t, n) {
            e.console.assert(t, "[World.addItem] item is required"), e.console.assert(t instanceof e.TiledImage, "[World.addItem] only TiledImages supported at this time"), n = n || {};
            if (n.index !== undefined) {
                var r = Math.max(0, Math.min(this._items.length, n.index));
                this._items.splice(r, 0, t)
            } else this._items.push(t);
            this._autoRefigureSizes ? this._figureSizes() : this._needsSizesFigured = !0, this._needsDraw = !0, t.addHandler("bounds-change", this._delegatedFigureSizes), t.addHandler("clip-change", this._delegatedFigureSizes), this.raiseEvent("add-item", {item: t})
        }, getItemAt: function (t) {
            return e.console.assert(t !== undefined, "[World.getItemAt] index is required"), this._items[t]
        }, getIndexOfItem: function (t) {
            return e.console.assert(t, "[World.getIndexOfItem] item is required"), e.indexOf(this._items, t)
        }, getItemCount: function () {
            return this._items.length
        }, setItemIndex: function (t, n) {
            e.console.assert(t, "[World.setItemIndex] item is required"), e.console.assert(n !== undefined, "[World.setItemIndex] index is required");
            var r = this.getIndexOfItem(t);
            if (n >= this._items.length) throw new Error("Index bigger than number of layers.");
            if (n === r || r === -1) return;
            this._items.splice(r, 1), this._items.splice(n, 0, t), this._needsDraw = !0, this.raiseEvent("item-index-change", {
                item: t,
                previousIndex: r,
                newIndex: n
            })
        }, removeItem: function (t) {
            e.console.assert(t, "[World.removeItem] item is required");
            var n = e.indexOf(this._items, t);
            if (n === -1) return;
            t.removeHandler("bounds-change", this._delegatedFigureSizes), t.removeHandler("clip-change", this._delegatedFigureSizes), t.destroy(), this._items.splice(n, 1), this._figureSizes(), this._needsDraw = !0, this._raiseRemoveItem(t)
        }, removeAll: function () {
            this.viewer._cancelPendingImages();
            var e, t;
            for (t = 0; t < this._items.length; t++) e = this._items[t], e.removeHandler("bounds-change", this._delegatedFigureSizes), e.removeHandler("clip-change", this._delegatedFigureSizes), e.destroy();
            var n = this._items;
            this._items = [], this._figureSizes(), this._needsDraw = !0;
            for (t = 0; t < n.length; t++) e = n[t], this._raiseRemoveItem(e)
        }, resetItems: function () {
            for (var e = 0; e < this._items.length; e++) this._items[e].reset()
        }, update: function () {
            var e = !1;
            for (var t = 0; t < this._items.length; t++) e = this._items[t].update() || e;
            return e
        }, draw: function () {
            for (var e = 0; e < this._items.length; e++) this._items[e].draw();
            this._needsDraw = !1
        }, needsDraw: function () {
            for (var e = 0; e < this._items.length; e++) if (this._items[e].needsDraw()) return !0;
            return this._needsDraw
        }, getHomeBounds: function () {
            return this._homeBounds.clone()
        }, getContentFactor: function () {
            return this._contentFactor
        }, setAutoRefigureSizes: function (e) {
            this._autoRefigureSizes = e, e & this._needsSizesFigured && (this._figureSizes(), this._needsSizesFigured = !1)
        }, arrange: function (t) {
            t = t || {};
            var n = t.immediately || !1, r = t.layout || e.DEFAULT_SETTINGS.collectionLayout,
                i = t.rows || e.DEFAULT_SETTINGS.collectionRows, s = t.columns || e.DEFAULT_SETTINGS.collectionColumns,
                o = t.tileSize || e.DEFAULT_SETTINGS.collectionTileSize,
                u = t.tileMargin || e.DEFAULT_SETTINGS.collectionTileMargin, a = o + u, f;
            !t.rows && s ? f = s : f = Math.ceil(this._items.length / i);
            var l = 0, c = 0, h, p, d, v, m;
            this.setAutoRefigureSizes(!1);
            for (var g = 0; g < this._items.length; g++) g && g % f === 0 && (r === "horizontal" ? (c += a, l = 0) : (l += a, c = 0)), h = this._items[g], p = h.getBounds(), p.width > p.height ? d = o : d = o * (p.width / p.height), v = d * (p.height / p.width), m = new e.Point(l + (o - d) / 2, c + (o - v) / 2), h.setPosition(m, n), h.setWidth(d, n), r === "horizontal" ? l += a : c += a;
            this.setAutoRefigureSizes(!0)
        }, _figureSizes: function () {
            var t = this._homeBounds ? this._homeBounds.clone() : null,
                n = this._contentSize ? this._contentSize.clone() : null, r = this._contentFactor || 0;
            if (!this._items.length) this._homeBounds = new e.Rect(0, 0, 1, 1), this._contentSize = new e.Point(1, 1), this._contentFactor = 1; else {
                var i = this._items[0], s = i.getBounds();
                this._contentFactor = i.getContentSize().x / s.width;
                var o = i.getClippedBounds().getBoundingBox(), u = o.x, a = o.y, f = o.x + o.width, l = o.y + o.height;
                for (var c = 1; c < this._items.length; c++) i = this._items[c], s = i.getBounds(), this._contentFactor = Math.max(this._contentFactor, i.getContentSize().x / s.width), o = i.getClippedBounds().getBoundingBox(), u = Math.min(u, o.x), a = Math.min(a, o.y), f = Math.max(f, o.x + o.width), l = Math.max(l, o.y + o.height);
                this._homeBounds = new e.Rect(u, a, f - u, l - a), this._contentSize = new e.Point(this._homeBounds.width * this._contentFactor, this._homeBounds.height * this._contentFactor)
            }
            (this._contentFactor !== r || !this._homeBounds.equals(t) || !this._contentSize.equals(n)) && this.raiseEvent("metrics-change", {})
        }, _raiseRemoveItem: function (e) {
            this.raiseEvent("remove-item", {item: e})
        }
    })
}(OpenSeadragon),define("tools/TETools/ObliqueViewerTool", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "../ToolDelegate", "../ToolContainer", "internal/Navigate", "internal/InputMode", "tools/ToolDialog", "WorkerPool", "internal/ObliqueViewer", "turf.min", "openseadragon/openseadragon"], function (e, t, n, r, i, s, o, u, a, f, l, c, h) {
    "use strict";

    function b() {
        this._explanationText = t.i18n("analysis_oblique_explanation_text"), this._explanationTextOnStartOnly = !0, this._cartographicTerrainPosition, this._featuresContainingPoint = [], this._highlightFootprint = null, this._selectedFootprint = null, this._queryFootprintsOutlines = [], this._selectedFootprintIndex = undefined, this._outlineBBOX = undefined, this._obliqueDiv = undefined, this._domain = "https://www.skylineglobe.com", this._imagesPath = "cyintdata/images", this._footprintBackwardLayerName = "1640747", this._footprintForwardLayerName = "1640746", this._queryRadius = 300, this.getId = function () {
            return "ObliqueViewerTool"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Analyze_Oblique_Viewer"), "./img/newDesign/analyze_oblique.png", 10, r.MenuEntryAnalyze(), t.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }, this._eventListener = null
    }

    function w(e, t) {
        var n = [], r = t.positions[0], i = r.length;
        for (var s = 0; s < i; s++) {
            var o = r[s];
            for (var u = 0; u < o.length; u += 3) n.push([o[u + 0], o[u + 1]])
        }
        var r = e.polygon([n], {name: t.fid});
        return r
    }

    function E(e) {
        if (e._queryImage != null) return;
        e._queryImage = viewer.entities.add({
            position: e._queryPosition,
            billboard: {
                image: "./img/query.png",
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                scale: .5,
                eyeOffset: Cesium.DynamicEyeOffset()
            }
        }), e.animateScale(e._queryImage, 200)
    }

    function S(e, t) {
        return viewer.entities.add({
            name: "highlightFootprint",
            polygon: {
                hierarchy: Cesium.Cartesian3.fromDegreesArray(e),
                material: Cesium.Color.fromCssColorString(t).withAlpha(.3),
                outline: !0,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 5
            }
        })
    }

    function x(e, t, n, r) {
        var i = e.concat(e.slice(0, 2));
        return viewer.entities.add({
            name: "highlightFootprintOutline",
            corridor: {
                positions: Cesium.Cartesian3.fromDegreesArray(i),
                width: n == undefined ? 3 : n,
                material: Cesium.Color.fromCssColorString(t).withAlpha(r == undefined ? .1 : r)
            }
        })
    }

    var p = "#4DC1C1", d = "#004975", v = "#2B2B2B", m = "#FFFFFF", g = "#FFFF00",
        y = new f({workerPath: "./js/wfs/featurefetcherworker.js"});
    return b.inheritsFrom(i), b.prototype.onMouseOver = function (e) {
        this._canHover && Cesium.defined(e) && (this._cursorPosition = e.endPosition), this._isMouseMoving = !0
    }, b.prototype.onClosedToolContainer = function () {
        this._queryPosition = null, this._explanationTextOnStartOnly = !0, this._queryImage != null && (viewer.entities.remove(this._queryImage), this._queryImage = null), this._selectedFootprint != null && (viewer.entities.remove(this._selectedFootprint), this._selectedFootprint = null)
    }, b.prototype.onPreFrame = function () {
        if (this._isMouseMoving) {
            var e = {};
            viewer.scene.screenToWorld(this._cursorPosition, e), this._prePosition = this._cursorPosition
        }
        this._isMouseMoving = !1
    }, b.prototype.Querying = function (e) {
    }, b.prototype.open = function (e) {
    }, b.prototype.getBBOX = function (t) {
        var n = Cesium.when.defer(),
            r = this._domain + "/SG/streamer.ashx" + "?SERVICE=WFS" + "&VERSION=1.0.0" + "&REQUEST=GetCapabilities" + "&outputFormat=GML2" + "&typeName=" + t,
            i = this;
        return e.ajax({
            dataType: "xml",
            url: encodeURI(r),
            cache: !1,
            xhrFields: {withCredentials: !1},
            success: function (e) {
                TerraExplorer.getXmlTag(e, "FeatureType", "wfs").each(function (e, r) {
                    if (TerraExplorer.getXmlTag(r, "Name", "wfs").text().endsWith(t)) {
                        var i = TerraExplorer.getXmlTag(r, "LatLongBoundingBox", "wfs");
                        if (i.length !== 1) {
                            n.reject("No BBOX");
                            return
                        }
                        var s = Cesium.Rectangle.fromDegrees(parseFloat(i[0].attributes.minx.value), parseFloat(i[0].attributes.miny.value), parseFloat(i[0].attributes.maxx.value), parseFloat(i[0].attributes.maxy.value));
                        n.resolve(s)
                    }
                })
            },
            error: function (e, t, i) {
                i !== "abort" && console.log("Failed to retrieve data from " + r + " :" + i), n.reject(i)
            },
            complete: function () {
            }
        }), n.promise
    }, b.prototype.getFootprintsContainingPoint = function (t, n) {
        var r = Cesium.when.defer(), i = this._queryRadius, s = new Cesium.Cartesian3(n.x - i, n.y - i, n.z - i),
            o = new Cesium.Cartesian3(n.x + i, n.y + i, n.z + i), u = Cesium.Rectangle.fromCartesianArray([s, o]),
            a = Cesium.Math.toDegrees(u.west) + "," + Cesium.Math.toDegrees(u.south) + "," + Cesium.Math.toDegrees(u.east) + "," + Cesium.Math.toDegrees(u.north),
            f = this._domain + "/SG/streamer.ashx" + "?SERVICE=WFS" + "&VERSION=1.0.0" + "&REQUEST=GetFeature" + "&outputFormat=GML2" + "&typeName=" + t + "&srsName=EPSG:4326" + "&BBOX=" + a,
            l = this;
        return e.ajax({
            dataType: "text",
            url: encodeURI(f),
            cache: !1,
            xhrFields: {withCredentials: !1},
            success: function (e) {
                y.queueWorkItem({id: "dummyId", text: e, geometryFieldName: "Geom"}).then(function (e) {
                    r.resolve(e)
                })
            },
            error: function (e, t, n) {
                n !== "abort" && console.log("Failed to retrieve data from " + f + " :" + n), r.reject(n)
            },
            complete: function () {
            }
        }), r.promise
    }, b.prototype.onLeftClick = function (t) {
        if (o.IsMultiGestureNavigation) return;
        this._queryFootprintsOutlines.forEach(function (e) {
            viewer.entities.remove(e)
        }), this.destroyObliques(), e("#thumbnailsDiv").remove();
        var n = {
                callback: e.proxy(function (e) {
                    this._queryPosition = e, E(this), this._queryImage.position = this._queryPosition.clone()
                }, this)
            }, r = viewer.scene.screenToWorld(t.position, n), i = Cesium.Cartographic.fromCartesian(r),
            s = this.getFootprintsContainingPoint(this._footprintBackwardLayerName, r),
            u = this.getFootprintsContainingPoint(this._footprintForwardLayerName, r), a = this;
        Cesium.when.all([u, s]).then(function (t) {
            var n = a.filterContainingFeatures(i, t[0].features, "forward"),
                r = a.filterContainingFeatures(i, t[1].features, "backward");
            a._featuresContainingPoint = n.concat(r), a._featuresContainingPoint.length > 0 ? (a.createThumbnails(), e("#thumbnailsDiv0").click()) : a.showNotFoundMessage()
        })
    }, b.prototype.filterContainingFeatures = function (e, t, n) {
        if (!t) return;
        var r = this, i = c.point([Cesium.Math.toDegrees(e.longitude), Cesium.Math.toDegrees(e.latitude)]), s = [];
        return t.forEach(function (e) {
            if (e.geometryType === "multipolygon") {
                var t = w(c, e);
                c.booleanContains(t, i) && (e._footprintType = n, s.push(e))
            }
        }), s
    }, b.prototype.createThumbnails = function () {
        var t = "<div id='thumbnailsDiv' style='margin: auto; padding: 5px;'></div>";
        e("#LowerView").append(t), e("#LowerView").css({overflow: "auto", height: "90%"});
        var n = 0, r = this;
        this._featuresContainingPoint.forEach(function (t) {
            var i = t._footprintType === "backward" ? g : m, s = r.degreesArrayPolygonFromFeature(t);
            r._queryFootprintsOutlines.push(x(s, i));
            var o = e("<div id='thumbnailsDiv" + n + "' style='float:left; margin-right: 5px; margin-bottom: 5px; width:34px; height:34px; display:table; border: 1px solid " + i + "; background-color:" + v + "'><div style='display: table-cell;vertical-align: middle;text-align:center;color:" + i + ";'>" + (n + 1) + "</div></div>");
            o.mouseenter(function () {
                var e = o[0].id.replace("thumbnailsDiv", "");
                o.css("background-color", p), r.showFootprint(e)
            }), o.mouseleave(function () {
                var e = o[0].id.replace("thumbnailsDiv", ""), t = r._selectedFootprintIndex == e ? d : v;
                o.css("background-color", t), r.hideFootprint(e)
            }), o.click(function () {
                e("#obliqueDiv" + r._selectedFootprintIndex).hide(), r._selectedFootprintIndex != undefined && e("#thumbnailsDiv" + r._selectedFootprintIndex).css("background-color", v), r._selectedFootprintIndex = o[0].id.replace("thumbnailsDiv", ""), o.css("background-color", d), r._selectedFootprint != null && viewer.entities.remove(r._selectedFootprint);
                var t = r.degreesArrayPolygonFromFeature(r._featuresContainingPoint[r._selectedFootprintIndex]);
                r._selectedFootprint = S(t, d), r.createObliqueViewers_openseadragon()
            }), e("#thumbnailsDiv").append(o), n++
        })
    }, b.prototype.showNotFoundMessage = function () {
        var n = "<div id='thumbnailsDiv' style='margin: auto; padding: 5px; color:white;'>" + t.i18n("analysis_oblique_no_footprints_found") + "</div>";
        e("#LowerView").append(n), e("#LowerView").css({overflow: "auto", height: "90%"})
    }, b.prototype.destroyObliques = function () {
        this._obliqueDiv && (this._obliqueDiv.remove(), this._obliqueDiv = undefined)
    }, b.prototype.createObliqueViewers_openseadragon = function () {
        this.destroyObliques();
        var t = this._featuresContainingPoint[this._selectedFootprintIndex], n = t._footprintType === "backward",
            r = t.attributes.NAME.replace(/\.[^/.]+$/, "") + ".dzi";
        this._imagesPath.endsWith("/") || (this._imagesPath += "/");
        var i = this._domain + "/" + this._imagesPath + t._footprintType + "/" + r, s = n ? g : m, o = 600, u = 400,
            a = e("#sideBar").width() + 10;
        e("body").append("<div id='obliqueDiv' style='position:absolute; z-index:1010; width:" + o + "px; height:" + u + "px; left:" + a + "px; top:10px; border: 1px solid " + s + "; background-color:black;'></div > "), e("body").append("<div id='ObliqueViewerClose'><img id='ObliqueViewerCloseImg' src='img/oblique/button_closegrouphover.png'></div>"), e("#ObliqueViewerClose").click(e.proxy(this.destroyObliques, this)).hover(function () {
            e("#ObliqueViewerCloseImg").attr("src", function (e, t) {
                return t.replace("button_closegrouphover.png", "button_closehover.png")
            })
        }, function () {
            e("#ObliqueViewerCloseImg").attr("src", function (e, t) {
                return t.replace("button_closehover.png", "button_closegrouphover.png")
            })
        });
        var f = h({id: "obliqueDiv", prefixUrl: "img/oblique/", tileSources: i});
        f.addControl("ObliqueViewerClose", {anchor: h.ControlAnchor.TOP_RIGHT}), this._obliqueDiv = e("#obliqueDiv")
    }, b.prototype.animateScale = function (t, n) {
        var r = t.billboard.scale.getValue(), i = r * 2;
        e({scale: r}).animate({scale: i}, {
            duration: n / 2, step: function () {
                t.billboard.scale.setValue(this.scale)
            }, easing: "linear", complete: function () {
                e({scale: i}).animate({scale: r}, {
                    duration: n / 2, step: function () {
                        t.billboard.scale.setValue(this.scale)
                    }, easing: "linear"
                })
            }
        })
    }, b.prototype.degreesArrayPolygonFromFeature = function (e) {
        var t = w(c, e);
        t.geometry.coordinates[0].pop();
        var n = [].concat.apply([], t.geometry.coordinates[0]);
        return n
    }, b.prototype.showFootprint = function (e) {
        var t = this, n = this.degreesArrayPolygonFromFeature(this._featuresContainingPoint[e]);
        t._highlightFootprint !== null && viewer.entities.remove(t._highlightFootprint), this._highlightFootprint = S(n, p)
    }, b.prototype.hideFootprint = function (e) {
        this._highlightFootprint !== null && viewer.entities.remove(this._highlightFootprint), this._highlightFootprint = null
    }, b.prototype.onOpenedToolContainer = function () {
        this._canPick = !0, this._canHover = !0, this._toolContainer.IsQuery = !0, e(viewer.container).css({cursor: 'url("./img/queryCursor.png") 7 6, pointer'}), e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Analyze_Oblique_Viewer")), this._explanationTextOnStartOnly = !1;
        var n = this.getBBOX(this._footprintForwardLayerName), r = this.getBBOX(this._footprintBackwardLayerName),
            i = this;
        Cesium.when.all([n, r]).then(function (e) {
            var t = new Cesium.Rectangle(Math.min(e[0].west, e[1].west), Math.min(e[0].south, e[1].south), Math.max(e[0].east, e[1].east), Math.max(e[0].north, e[1].north)),
                n = Cesium.Math.toDegrees(t.west), r = Cesium.Math.toDegrees(t.east),
                s = Cesium.Math.toDegrees(t.south), o = Cesium.Math.toDegrees(t.north);
            i._outlineBBOX = x([n, s, r, s, r, o, n, o, n, s], "#FFFFFF", 30, .4)
        })
    }, b.prototype.onBeforeOpenToolContainer = function () {
        return e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), u.Mode = u.MEASUREMENT, this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.onLeftClick, this), Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.setInputAction(e.proxy(this.onMouseOver, this), Cesium.ScreenSpaceEventType.MOUSE_MOVE), viewer.scene.preRender.addEventListener(this.onPreFrame, this), this.parent.onBeforeOpenToolContainer.call(this), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText), e("#UpperView").height(1), !0
    }, b.prototype.onBeforeCloseToolContainer = function (t) {
        return this.parent.onBeforeCloseToolContainer.call(this, t), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this._eventListener.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), this._toolContainer.IsQuery = !1, u.Mode = u.FREE_FLIGHT, o.stop(), viewer.entities.remove(this._outlineBBOX), viewer.entities.remove(this._selectedFootprint), viewer.entities.remove(this._queryImage), this._queryFootprintsOutlines.forEach(function (e) {
            viewer.entities.remove(e)
        }), this.destroyObliques(), e("#thumbnailsDiv").remove(), this._queryImage = null, this._selectedFootprint = null, this._canPick = !1, this._canHover = !1, a.IsOpen && a.close(), !0
    }, b.prototype.onButtonClick = function (e) {
        this.parent.onButtonClick.call(this, e);
        switch (e) {
            case 1:
                break;
            case 2:
                break;
            case 3:
                break;
            case 4:
        }
    }, b
}),define("tools/TETools/ModifyTerrainTool", ["jquery", "TELang"], function (e, t) {
    "use strict";

    function n() {
        this.getId = function () {
            return "ModifyTerrainTool"
        }, this.MODIFY_TERRAIN_TYPES = {REPLACE: 0, OFFSET: 1, CROP_ABOVE: 2, CROP_BELOW: 3}
    }

    return Cesium.defineProperties(n.prototype, {}), n.prototype.isPointInsidePolygon = function (e, t, n) {
        var r = document.createElement("canvas");
        r.width = 32, r.height = 32;
        var i = r.getContext("2d"), s = convertToXYVertices([n], t), o = convertToXYVertices(e, t);
        i.beginPath(), i.moveTo(o[0][0], o[0][1]);
        for (var u = 0; u < o.length; u++) i.lineTo(o[u][0], o[u][1]);
        return i.strokeStyle = "blue", i.stroke(), i.isPointInPath(s[0][0], s[0][1])
    }, n.prototype.createFloorMaskBuffer = function (e, t, n) {
        var r = 32, i = e.west * 180 / Math.PI, s = e.south * 180 / Math.PI, o = e.east * 180 / Math.PI,
            u = e.north * 180 / Math.PI, a = new Cesium.Rectangle(i, s, o, u),
            f = TerraExplorer.internal.Engine.convertToXYVertices(t, a, r, r),
            l = TerraExplorer.internal.Engine.drawPolygonOnCanvas(f, "#FF0000", r, r),
            c = this.getMaskArrayFromCanvasPolygon(l, r, n);
        return c
    }, n.prototype.getMaskArrayFromCanvasPolygon = function (e, t, n) {
        var r = new Int16Array(t * t);
        if (e !== undefined) {
            var i = e.getContext("2d"), s = i.getImageData(0, 0, t, t).data, o;
            n instanceof Cesium.HeightmapTerrainData ? o = !0 : o = !1;
            for (var u = 0; u < t; u++) for (var a = 0; a < t; a++) {
                var f = u * t + a, l = (t - 1 - u) * t + a;
                r[l] = s[f * 4] !== 0 ? o ? n._buffer[f] : n : 1
            }
        }
        return r.canvasPolygon = e, r
    }, n.prototype.fillArrayFromVerticesAndHeight = function (e, t, n) {
        var r = 32, i = t.west * Cesium.Math.DEGREES_PER_RADIAN, s = t.east * Cesium.Math.DEGREES_PER_RADIAN,
            o = t.south * Cesium.Math.DEGREES_PER_RADIAN, u = t.north * Cesium.Math.DEGREES_PER_RADIAN,
            a = new Cesium.Rectangle(i, o, s, u), f = TerraExplorer.internal.Engine.convertToXYVertices(e, a, r, r),
            l = TerraExplorer.internal.Engine.drawPolygonOnCanvas(f, "#FF0000", r, r);
        return this.getMaskArrayFromCanvasPolygon(l, r, n)
    }, n.prototype.ShowHideModifyTerrainObj = function (e) {
        viewer.terrainProvider._modifyTerrainObjects
    }, n.prototype.isChildOfModifyTerrain = function (e, t, n, r, i, s) {
        if (n <= s) return !1;
        var o = n - s, u = Math.floor(e / Math.pow(2, o)), a = Math.floor(t / Math.pow(2, o));
        return Math.abs(u - r) <= 1 && Math.abs(a - i) <= 1 ? !0 : !1
    }, n.prototype.createHeightMapFloor = function (e) {
        var t = e._structure, n = t.stride, r = t.elementMultiplier, i = t.heightOffset, s = t.heightScale,
            o = t.elementsPerHeight, u = e._buffer, a = e._width, f = e._height, l = a / 2, c = f / 2,
            h = new Int16Array(l * c);
        for (var p = 0; p < f; p++) for (var d = 0; d < a; d++) {
            var v = p * a + d, m = v * n;
            h[v] = (u[m] + u[m + 1] * r) * s + i
        }
        var g = {buffer: h, width: l, height: c, childTileMask: e.childTileMask};
        return new Cesium.HeightmapTerrainData(g)
    }, n.prototype.getIntersectingTiles = function (e) {
        var t = viewer.terrainProvider.findDirectParent(e), n = t.level + 1, r = {};
        r.nw = Cesium.Rectangle.northwest(e), r.ne = Cesium.Rectangle.northeast(e), r.sw = Cesium.Rectangle.southwest(e), r.se = Cesium.Rectangle.southeast(e);
        var i = {}, s = Number.MAX_VALUE, o = 0, u = Number.MAX_VALUE, a = 0, f = viewer.terrainProvider.tilingScheme;
        Object.entries(r).forEach(function (e) {
            var t = f.positionToTileXY(e[1], n);
            s = Math.min(t.x, s), u = Math.min(t.y, u), o = Math.max(t.x, o), a = Math.max(t.y, a)
        });
        for (var l = s; l <= o; l++) for (var c = u; c <= a; c++) {
            var h = l.toString() + c.toString() + n.toString();
            i[h] === undefined && (i[h] = f.tileXYToRectangle(l, c, n))
        }
        return i
    }, n.prototype.modifyTerrain = function (n, r, i, s) {
        var o = Cesium.when.defer();
        if (r === undefined || i === undefined) throw{type: "TE_EXCEPTION", format: "Missing argument"};
        if (r.length === undefined || r.length === 0) throw{
            type: "TE_EXCEPTION",
            format: "Vertices -  must be a non zero length array"
        };
        var u, a, f, l, c;
        s = e.extend({}, s), a = Cesium.defaultValue(s.mtType, this.MODIFY_TERRAIN_TYPES.OFFSET), f = Cesium.defaultValue(s.fromKML, undefined), l = Cesium.defaultValue(s.priority, 1), c = Date.now();
        var h = Cesium.createGuid(), p = !1;
        if (i.length === undefined || i.length === 0) if (!isNaN(Number(i))) {
            var d = r.length;
            u = new Array(d), u.fill(i)
        } else {
            if (!(i instanceof Cesium.HeightmapTerrainData)) throw{
                type: "TE_EXCEPTION",
                format: "Vertices -  must be a non zero length array"
            };
            p = !0, u = this.createHeightMapFloor(i)
        } else u = i[0];
        var v = Cesium.Rectangle.fromCartesianArray(r);
        if (Object.values !== undefined && typeof Object.values == "function") var m = Object.values(Cesium.Color),
            g = Math.floor(Math.random() * m.length);
        var y = viewer.terrainProvider.findDirectParent(v);
        TerraExplorer.internal.Engine.findFullyContainingParentRectangle(v, y, h);
        var b = TerraExplorer.internal.Engine._fullyContainingParents[h], w = Cesium.Rectangle.center(v),
            E = y.level + 1, S = Cesium.BoundingSphere.fromPoints(r),
            w = viewer.scene.globe.ellipsoid.cartesianToCartographic(S.center), x = viewer.scene.globe.getHeight(w),
            T = Cesium.Cartesian3.fromRadians(w.longitude, w.latitude, x);
        S.center = T, viewer.terrainProvider._modifyTerrainObjects === undefined && (viewer.terrainProvider._modifyTerrainObjects = []);
        var N = {
            id: h,
            isModifyTerrainObj: !0,
            show: !0,
            visibility: !0,
            rectangle: v,
            parent: y,
            fullyContainingParent: b,
            level: E,
            mtType: a,
            vertices: r,
            heights: u,
            fromKML: f,
            priority: l,
            timeStamp: c,
            defaultName: t.i18n("modifyTerrain_DefaultName"),
            type: "modifyTerrain",
            tool: this.getId(),
            bs: S,
            baseBs: S,
            highBs: S,
            meshObject: s.meshObject,
            isModifyB3dmObject: s.isModifyB3dmObject
        };
        Cesium.defineProperties(N, {
            Show: {
                get: function () {
                    return N.show
                }, set: function (e) {
                    function t(e) {
                        return (e.data === undefined || e.data && e.data.terrainData === undefined) && e.level > 5
                    }

                    N.show = N.visibility = e;
                    if (t(this.fullyContainingParent)) {
                        var n = this.fullyContainingParent;
                        while (t(n)) n = n.parent;
                        n.data !== undefined && n.data.terrainData !== undefined ? n.freeResources() : viewer.scene.globe._surface._tilesToRender.forEach(function (e) {
                            if (Cesium.Rectangle.intersection(N.rectangle, e.rectangle) !== undefined) {
                                while (e.level > N.level - 2) e = e.parent;
                                e.freeResources()
                            }
                        })
                    } else this.fullyContainingParent.parent.freeResources()
                }
            }
        });
        if (name !== undefined && name.indexOf(t.i18n("modifyTerrain_DefaultName")) > -1) {
            var C = Number(name.split("#")[1]);
            project._allAvailableObjectsNames[project._objectTypes.MODIFY_TERRAIN] === undefined && (project._allAvailableObjectsNames[project._objectTypes.MODIFY_TERRAIN] = new Array(project._objectsMaxNumber.modifyTerrain)), project._allAvailableObjectsNames[project._objectTypes.MODIFY_TERRAIN][C] = !0
        }
        return N.displayName = N.name = n ? n : TerraExplorer.internal.Project.getAvailableDefaultName(N), N.destroy = function () {
            var e = this.id, t;
            this.Show = !1, viewer.terrainProvider._modifyTerrainObjects.forEach(function (n, r) {
                n.id === e && (t = r)
            }), t !== undefined && (viewer.terrainProvider._modifyTerrainObjects.splice(t, 1), this.fullyContainingParent.parent.freeResources()), t = undefined, TerraExplorer.internal.Project._modifyTerrainObjects.forEach(function (n, r) {
                n._object.id === e && (t = r)
            }), t !== undefined && TerraExplorer.internal.Project._modifyTerrainObjects.splice(t, 1)
        }, N.delete = N.destroy, N.flyTo = function () {
            viewer.camera.flyToBoundingSphere(this.bs)
        }, s.thB3dm === undefined && viewer.terrainProvider._modifyTerrainObjects.push(N), y._parent._parent.freeResources(), s.doNotShowInObjectList === undefined && TerraExplorer.internal.Project.addToObjectList(N, !0), o.resolve(N), o
    }, n
}),define("tools/TETools/HoleOnTerrainTool", ["jquery", "TELang"], function (e, t) {
    "use strict";

    function n() {
        this.getId = function () {
            return "HoleOnTerrainTool"
        }
    }

    return Cesium.defineProperties(n.prototype, {}), n.prototype.createHoleOnTerrain = function (e) {
        var t = [];
        if (e === undefined) throw{type: "TE_EXCEPTION", format: "Missing argument"};
        if (e.length === undefined) throw{type: "TE_EXCEPTION", format: "Polygon must be of type Array"};
        if (e.length < 3) throw{type: "TE_EXCEPTION", format: "Polygon must have at least 3 vertices"};
        if (e[0] instanceof Cesium.Cartesian3 || e[0] instanceof Cesium.Cartographic) {
            e.forEach(function (n) {
                var r;
                e[0] instanceof Cesium.Cartographic ? r = viewer.scene.globe.ellipsoid.cartographicToCartesian(n) : r = n, t.push(r)
            });
            var n = new Cesium.PolygonGeometry({polygonHierarchy: new Cesium.PolygonHierarchy(t)});
            return viewer.scene.primitives.add(new TerraExplorer.HolePrimitive({
                geometryInstances: new Cesium.GeometryInstance({
                    geometry: n,
                    id: "holePrimitive"
                }), appearance: new Cesium.PerInstanceColorAppearance({flat: !0}), minHeight: -3e3, maxHeight: 1e4
            }))
        }
        throw{type: "TE_EXCEPTION", format: "Polygon vertices types must be either Cartographic or Cartesian3"}
    }, n
}),define("tools/TETools/VideoOnTerrainTool", ["jquery", "TELang", "./LayersStorage"], function (e, t, n) {
    "use strict";

    function r() {
        this.getId = function () {
            return "VideoOnTerrainTool"
        }, this._videoTypes = ["video/webm", "video/mp4", "video/quicktime"], this._allVideos = {}, this._videoTextures = {}, this._primsVid = {}, this._totalVideos = 0, this._stopUpdatingTextures = !1
    }

    function i(t, n, r) {
        if (r.readyState >= 2) {
            if (viewer.scene.videoTex === undefined) {
                viewer.scene.videoTex = new Cesium.Texture({context: viewer.scene.context, source: r});
                var i = e.grep(TerraExplorer.internal.Project._videoOnTerrainObjects, function (e) {
                    return e.displayName === r.description
                });
                i.length === 1 && setTimeout(function () {
                    i[0]._object.viewshedMap._lightCamera.frustum.far += 5
                }, 500)
            }
            viewer.scene.videoTex.copyFrom(r)
        }
    }

    return Cesium.defineProperties(r.prototype, {}), r.prototype.createVideoOnTerrain = function (n, r, i, s, o, u) {
        var a = this, f = Cesium.when.defer();
        if (this._allVideos[n] !== undefined) throw{
            type: "TE_EXCEPTION",
            format: "Video description must be a unique name"
        };
        if (i < 1 || i > 59) throw{type: "TE_EXCEPTION", format: "Video FOV must be between 1 and 60"};
        TerraExplorer.internal.Project._videoOnTerrainObjects[0] !== undefined && this.deleteVideoOnTerrain(TerraExplorer.internal.Project._videoOnTerrainObjects[0], !0);
        var l = e('<video id="' + n + '" style="display:none;" autoplay="" autoload="true" loop="" crossorigin="" preload = "auto" controls=""></video>'),
            c;
        this._videoTypes.forEach(function (t) {
            var n = r.split("."), i = "video/" + n[n.length - 1];
            t === i && (c = e('<source src="' + r + '" type="' + t + '">'), l.append(c))
        });
        if (c === undefined) {
            TerraExplorer.internal.Project.addToUnsupportedLayers({
                name: n,
                reason: t.i18n("Video_Type_Not_Supported")
            }), f.reject();
            return
        }
        var h = l.get(0);
        return u = e.extend(!0, {}, u), h.loop = Cesium.defaultValue(u.loop, !0), e("body").append(h), e(h).on("loadeddata", function (r) {
            h.description = n, a._allVideos[n] = h;
            var l = e("#menuIconAnalyzeTool")[0];
            a._videoTextures[n] = new Cesium.Texture({
                context: viewer.scene.context,
                source: l
            }), a._totalVideos || viewer.scene.preRender.addEventListener(e.proxy(a.updateVideos, a)), a._totalVideos++, u.isVOT = !0, u.showProjector = Cesium.defaultValue(u.showProjector, !0), u.originalGuid = n, Cesium.when(TerraExplorer.SGWorld.Analysis.CreateViewshedObject(n, s, i, i, o, u), function (e) {
                var r = TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool;
                u.showProjector ? u.showProjector && (e._object.isProjectorShown = !0) : (e._object.viewshedPrimitive.doNotShow = !0, e._object.isProjectorShown = !1), e.Play = function () {
                    r._allVideos[this._object._displayName].play()
                }, e.Pause = function () {
                    r._allVideos[this._object._displayName].pause()
                }, e.delete = function () {
                    TerraExplorer.internal.Project.deleteObject(this._object)
                }, Object.defineProperty(e, "volume", {
                    "default": 1, get: function () {
                        return r._allVideos[this._object._displayName].volume
                    }, set: function (e) {
                        e >= 0 && e <= 1 && (r._allVideos[this._object._displayName].volume = e)
                    }
                }), Object.defineProperty(e, "showProjector", {
                    "default": !0, get: function () {
                        return this._object.viewshedPrimitive.show
                    }, set: function (e) {
                        this._object.viewshedPrimitive.show = e, this._object.isProjectorShown = e
                    }
                });
                var i = TerraExplorer.internal.Project;
                e.id = Cesium.createGuid(), e.defaultName = t.i18n("VideoObj_DefaultName"), e._object.type = i._objectTypes.VIDEO_ON_TERRAIN, e.tool = e._object.tool = a.getId(), e.displayName = e._object.displayName = n !== undefined ? n : TerraExplorer.internal.Project.getAvailableDefaultName(e), e._object.id = e._object.guid, TerraExplorer.internal.Project.addToObjectList(e), f.resolve(e)
            })
        }), f
    }, r.prototype.deleteVideoOnTerrain = function (t, n) {
        var r = TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool;
        t !== undefined && (r._allVideos[t.displayName].remove(), delete r._allVideos[t.displayName], r._videoTextures[t.displayName].destroy(), delete r._videoTextures[t.displayName], viewer.entities.remove(r._primsVid[t.displayName]), delete r._primsVid[t.displayName], n === undefined ? TerraExplorer.tools.ToolManager._tools.Viewshed.deleteViewshed(t) : TerraExplorer.tools.ToolManager._tools.Viewshed.deleteViewshed(t._object), this._totalVideos--), this._totalVideos || viewer.scene.preRender.removeEventListener(e.proxy(this.updateVideos, this)), viewer.scene.videoTex = undefined
    }, r.prototype.updateVideos = function () {
        var e = this, t = viewer.scene.frameState.frameNumber;
        if (t % 2 === 0) {
            var n = TerraExplorer.internal.Project._videoOnTerrainObjects;
            Object.keys(this._allVideos).forEach(function (t) {
                i(viewer.scene.context._gl, e._videoTextures[t], e._allVideos[t])
            })
        }
    }, r.prototype.debugTexture = function (e, t) {
        var n = TerraExplorer.internal.Project,
            r = "uniform sampler2D debugTexture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec3 color = texture2D(debugTexture, v_textureCoordinates).rgb; \n     gl_FragColor = vec4(color, 1.0); \n}\n";
        viewer.scene.debugVOTCommand = viewer.scene.context.createViewportQuadCommand(r, {
            uniformMap: {
                debugTexture: function () {
                    return e != undefined ? e : viewer.scene.slopeColorsTexture
                }
            }
        }), viewer.scene.debugVOTCommand.pass = Cesium.Pass.OVERLAY;
        var i = viewer.canvas.width, s = viewer.canvas.height, o = new Cesium.BoundingRectangle;
        o.x = Math.floor(i * .7), o.y = Math.floor(s * .1);
        var u = Math.max(i, s);
        o.width = Math.floor(u * .2), o.height = Math.floor(u * .2), viewer.scene.debugVOTCommand.renderState = Cesium.RenderState.fromCache({viewport: Cesium.BoundingRectangle.clone(o)})
    }, r
}),define("tools/TETools/VolumeAnalysis", ["jquery", "TELang", "internal/Globals", "../MenuEntry", "internal/Units", "internal/InputMode", "./ProgressTool", "internal/GeometryHelper", "internal/NotificationCenter", "tools/ToolDialog", "tools/ListControl", "internal/Navigate", "./LayersStorage", "../PropertySheet"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p) {
    "use strict";

    function m() {
        this._explanationText = t.i18n("analysis_volume_explanation_text"), this._explanationTextOnStartOnly = !0, this._viewMode = !1, this._txtUnit = t.i18n("meters_short"), this.newName = undefined, this.volumeCalculated = undefined, this.quality = undefined, this._removedVol = 0, this._addedVol = 0, this.defaultQuality = d.MEDIUM, this._propertiesToSave = {
            name: !0,
            tool: !0,
            type: !0,
            quality: !0,
            addedVol: !0,
            removedVol: !0,
            volCalulated: !0,
            perimeter: !0,
            horizontalArea: !0,
            prims: !0,
            timestamp: !0
        }, this._layersStorage = h.DefaultStorage, this.getId = function () {
            return "VolumeAnalysis"
        }, this.getMenuEntry = function () {
            return r.addToSidebar(this, t.i18n("Menu_Analyze_Volume"), "./img/newDesign/volume.png", 27, r.MenuEntryAnalyze(), t.i18n("Measurement_Header"), !1, !0, undefined, "none")
        }, this.open = function (e) {
            e ? (this._viewMode = !0, y = e.prims[0], this.volumeCalculated = e.volCalulated, this._addedVol = e.addedVol, this._removedVol = e.removedVol, this._currentObject = e) : (this._viewMode = !1, this._currentObject = undefined)
        }
    }

    function b(e, t) {
        return new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.PolylineGeometry({
                    positions: e,
                    ellipsoid: Cesium.Ellipsoid.WGS84,
                    vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT,
                    width: 2,
                    followSurface: !1
                }),
                attributes: {
                    color: Cesium.ColorGeometryInstanceAttribute.fromColor(t ? new Cesium.Color(1, 1, 1, .75) : new Cesium.Color(1, 1, 1, .4)),
                    distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, TerraExplorer.tools.ToolManager._tools.VolumeAnalysis._perimeter * 30)
                }
            }),
            asynchronous: !1,
            allowPicking: !1,
            isAnalysisPrimitive: !0,
            appearance: new Cesium.PolylineColorAppearance({translucent: !0, renderState: {depthTest: {enabled: t}}})
        })
    }

    function w(e, t) {
        return new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.PolygonGeometry({
                    polygonHierarchy: {
                        positions: e,
                        holes: []
                    },
                    ellipsoid: Cesium.Ellipsoid.WGS84,
                    perPositionHeight: !0,
                    vertexFormat: Cesium.VertexFormat.POSITION_AND_COLOR
                }),
                attributes: {
                    color: Cesium.ColorGeometryInstanceAttribute.fromColor(t ? new Cesium.Color(1, 1, 1, .75) : new Cesium.Color(1, 1, 1, .4)),
                    distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, TerraExplorer.tools.ToolManager._tools.VolumeAnalysis._perimeter * 30)
                }
            }),
            asynchronous: !1,
            allowPicking: !1,
            isAnalysisPrimitive: !0,
            appearance: new Cesium.PerInstanceColorAppearance({
                addZBias: !0,
                flat: !0,
                renderState: {
                    depthTest: {enabled: t},
                    lineWidth: Cesium.Math.clamp(2, Cesium.ContextLimits.minimumAliasedLineWidth, Cesium.ContextLimits.maximumAliasedLineWidth)
                }
            })
        })
    }

    function E(e) {
        return TerraExplorer.internal.Units.AltitudeUnit == TerraExplorer.internal.Units.FEET ? (e = TerraExplorer.internal.Units.meterToFeet(e), TerraExplorer.tools.ToolManager._tools.VolumeAnalysis._txtUnit = t.i18n("feet_short")) : TerraExplorer.tools.ToolManager._tools.VolumeAnalysis._txtUnit = t.i18n("meters_short"), e
    }

    var d = {LOW: 512, MEDIUM: 1024, HIGH: 2048}, v = {
        512: t.i18n("Volume_Analysis_altitude_quality_low"),
        1024: t.i18n("Volume_Analysis_altitude_quality_medium"),
        2048: t.i18n("Volume_Analysis_altitude_quality_high")
    };
    m.inheritsFrom(o), m.prototype.onOpenedToolContainer = function () {
        this._explanationTextOnStartOnly = !1, this._currentObject !== undefined && this._currentObject.name !== undefined ? (e("#headerDivContainer span:first")[0].innerText = this._currentObject.name, this.updateVolumeText()) : (e(e(".toolHeaderContainer")[0]).text(t.i18n("Menu_Analyze_Volume")), this._toolContainer.enableButton(1, !1), this._toolContainer.enableButton(2, !1), this._toolContainer.enableButton(3, !1), this._toolContainer.enableButton(4, !1))
    }, m.prototype.onClosedToolContainer = function () {
        this._explanationTextOnStartOnly = !0
    }, m.prototype.getPrimsToSave = function (e) {
        var t = [];
        return e.forEach(function (e) {
            e.toSave && e._billboards.forEach(function (e) {
                t.push(e.position)
            })
        }), t
    }, m.prototype.reset = function () {
        this._toolContainerText = "", this._listControl != null && this._listControl.removeAll(), this.ToolContainer.enableButton(1, !1), this.ToolContainer.enableButton(2, !1), this.ToolContainer.enableButton(3, !1), this.ToolContainer.enableButton(4, !1), this.newName = undefined, this.quality = undefined, this.volumeCalculated = undefined, this._removedVol = 0, this._addedVol = 0, this._horizontalArea = 0, this._perimeter = 0
    };
    var g = null, y = null;
    return m.prototype.onBeforeOpenToolContainer = function () {
        return s.Mode = s.MEASUREMENT, e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), this._viewMode || (y = new Cesium.BillboardCollection, viewer.scene.primitives.add(y), this.drawingTool = TerraExplorer.internal.DrawingTool, g = this.drawingTool.drawPolygon({
            AltitudeMethod: this.drawingTool.ALTITUDE_METHODS.RELATIVE_TO_MODEL,
            useFirstPointAsAltitude: !0,
            onPointUpdate: e.proxy(this.onClickUpdate, this),
            onFinish: e.proxy(this.onFinish, this),
            onAbort: e.proxy(this.onAbort, this),
            style: {
                fill: !0,
                outlineColor: new Cesium.Color(1, .84, 0, 1),
                outlineWidth: 2,
                material: new Cesium.Color(1, 1, 1, .75)
            },
            intersectionStyle: {fill: !1, utline: !0, outlineColor: Cesium.Color.RED, outlineWidth: 2},
            onIntersection: e.proxy(this.onIntersection, this)
        })), this.parent.onBeforeOpenToolContainer.call(this), this.showNormalButtons(), this._viewMode ? (this.ToolContainer.enableButton(2, !1), this.ToolContainer.enableButton(4, !1), this.updateVolumeText()) : (this.reset(), this._explanationTextOnStartOnly && this._toolContainer.setExplanationText(this._explanationText)), a.addObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, m.prototype.onBeforeCloseToolContainer = function (e) {
        return this.parent.onBeforeCloseToolContainer.call(this, e), this.drawingTool !== undefined && this.drawingTool.Active && (e == 2 || e == 1 && !this._viewMode) && g.abort(), this._viewMode || this.reset(), s.Mode = s.FREE_FLIGHT, a.removeObserver(this, "unitsChanged", "TEN_UNITS_CHANGED", null), !0
    }, m.prototype.showNormalButtons = function () {
        this.ToolContainer.removeButtons();
        var e = TerraExplorer.tools.ToolContainer.buttonType;
        this.ToolContainer.addButton(1, "./img/delete.png", undefined, t.i18n("measure_volume_tooltip_delete")), this._toolContainer.addButton("displayProperties", "./img/newDesign/vs_layer_properties.png", undefined, t.i18n("Volume_Analysis_Tooltip_Properties"), e.CHECKBOX_BUTTON), this.ToolContainer.addButton(2, "./img/delete_last_point.png", undefined, t.i18n("measure_volume_tooltip_delete_last_point")), this.ToolContainer.addButton(3, "./img/newDesign/volume_calculate_enable.png", undefined, t.i18n("Volume_Analysis_Tooltip_Claculate"), e.BUTTON), this.ToolContainer.addButton(4, "./img/newDesign/measurement_v.png", undefined, t.i18n("measure_finish_drawing_tool"))
    }, m.prototype.onButtonClick = function (e) {
        this.parent.onButtonClick.call(this, e);
        switch (e) {
            case 1:
                this.drawingTool !== undefined && this.drawingTool.Active && this.drawingTool.abortDrawing(), this._viewMode ? TerraExplorer.internal.Project.deleteObject(this._currentObject) : (this.reset(), this.updateVolumeText(), f.IsOpen && f.close());
                break;
            case"displayProperties":
                this.displayPropertiesSheet();
                break;
            case 2:
                this.drawingTool.cancellationCallback();
                if (y.length > 0) {
                    var n = y.get(y.length - 1);
                    y.remove(n), this.updateVolumeText(), y.length == 0 && (this.ToolContainer.enableButton(1, !1), this.ToolContainer.enableButton(2, !1), this.ToolContainer.enableButton(3, !1), this.ToolContainer.enableButton(4, !1)), y.length < 3 && this.ToolContainer.enableButton(4, !1)
                }
                break;
            case 3:
                this.doWorkAsync();
                break;
            case 4:
                if (this.drawingTool._isSelfIntersecting) {
                    alert(t.i18n("measure_area_cannot_calculate_area"));
                    return
                }
                this.drawingTool.finishDrawing()
        }
    }, m.prototype.calculateVolumeAnalysis = function (t, n) {
        e(".containerButton").css("left", "2px"), e(".containerView").css("left", "120px"), this.isCalculating = !0, this.updateVolumeText();
        var r = this, i = [];
        for (var s = 0; s < y.length; s++) i.push(y.get(s).position);
        if (this._volAltitude === undefined) {
            var o = viewer.scene.globe.ellipsoid.cartesianToCartographic(y.get(0).position);
            this._volAltitude = o.height
        }
        var u = TerraExplorer.SGWorld.Analysis.queryElevationBuffer(i, {quality: t});
        Cesium.when(u, function (e) {
            r.ToolContainer.enableButton("1", !1), r.ToolContainer.enableButton("2", !1), r.ToolContainer.enableButton("4", !1), r._addedVol = 0, r._removedVol = 0;
            var t = e.sqrMetersPerPixel;
            e.forEach(function (e) {
                if (e !== -9999) {
                    var n = Math.abs(r._volAltitude - e);
                    e > r._volAltitude ? r._removedVol += t * n : e < r._volAltitude && (r._addedVol += t * n)
                }
            }), r.updateVolumeText(), r._currentObject.addedVol = r._addedVol, r._currentObject.removedVol = r._removedVol, r._currentObject.volCalulated = r.volumeCalculated, h.DefaultStorage.saveItem(r._currentObject), r.ToolContainer.enableButton("1", !0), r.ToolContainer.enableButton("2", !1), r.ToolContainer.enableButton("3", !1)
        }).otherwise(function (e) {
            console.log(e)
        }), n != undefined && n(), this.ToolContainer.enableButton("1", !0), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("4", !1), this.volumeCalculated = !0, this.isCalculating = !1
    }, m.prototype.unitsChanged = function (e) {
        this.updateVolumeText()
    }, m.prototype.doWork = function (e) {
        this.calculateVolumeAnalysis(this.quality !== undefined ? this.quality : this.defaultQuality, e)
    }, m.prototype.workCompleted = function () {
        this.CancelWork == 0 && this.updateVolumeText()
    }, m.prototype.onClickUpdate = function (e, t, n) {
        var r = y.add({position: e[t], image: "img/point_white.png", eyeOffset: Cesium.DynamicEyeOffset()});
        e.length == 0 && (this._toolContainer.enableButton(1, !1), this._toolContainer.enableButton(2, !1), this._toolContainer.enableButton(4, !1)), e.length > 0 && (this._toolContainer.enableButton(1, !0), this._toolContainer.enableButton(2, !0), this.ToolContainer.enableButton("displayProperties", !1)), e.length > 2 && this._toolContainer.enableButton(4, !0), this.updateVolumeText()
    }, m.prototype.onFinish = function (t, n, r) {
        if (t.length < 3) {
            e("#headerDivContainer #CloseImg").length > 0 && e("#headerDivContainer #CloseImg")[0].click();
            return
        }
        if (r !== undefined && r.isSelfIntersect) {
            n();
            return
        }
        var i = viewer.scene.globe.ellipsoid.cartesianToCartographic(t[0]);
        this._volAltitude = i.height, y !== null && (viewer.scene.primitives.remove(y), y = new Cesium.BillboardCollection, viewer.scene.primitives.add(y));
        if (t.length > 2) {
            var s = this.createVolumeObject(t);
            TerraExplorer.tools.ToolManager.openTool("VolumeAnalysis", s), e(e(".selectedLine img")[0]).length > 0 && e(".selectedLine img")[0].click(), this.ToolContainer.enableButton("2", !1), this.ToolContainer.enableButton("4", !1), this.ToolContainer.enableButton("displayProperties", !0)
        }
    }, m.prototype.createObj = function (e) {
        return y = new Cesium.BillboardCollection, viewer.scene.primitives.add(y), this._horizontalArea = e.horizontalArea, this._perimeter = e.perimeter, this.quality = e.quality, this.volumeCalculated = e.volCalulated, this._addedVol = e.addedVol, this._removedVol = e.removedVol, this.createVolumeObject(e.prims, e.name, e.timestamp)
    }, m.prototype.createVolumeObject = function (n, r, i) {
        var s = TerraExplorer.internal.Project, o = new Cesium.PrimitiveCollection;
        viewer.scene.primitives.add(o);
        var u = new Cesium.PrimitiveCollection;
        viewer.scene.primitives.add(u), y !== null && (viewer.scene.primitives.remove(y), y = new Cesium.BillboardCollection, viewer.scene.primitives.add(y));
        for (var a = 0; a < n.length; a++) y.add({
            position: n[a],
            image: "img/point_white.png",
            eyeOffset: Cesium.DynamicEyeOffset(),
            translucencyByDistance: new Cesium.NearFarScalar(0, 1, this._perimeter * 10, 0)
        });
        var f = [];
        f = n.slice(), f.push(f[0]), o.add(b(f, !0)), o.add(w(n, !0)), u.add(b(f, !1)), u.add(w(n, !1));
        var l = Cesium.BoundingSphere.fromPoints(n);
        y.toSave = !0;
        var c = {
            id: this._currentObject && this._currentObject.id ? this._currentObject.id : Cesium.createGuid(),
            type: TerraExplorer.internal.Project.ObjectsTypes.VOLUME,
            bs: l,
            tool: this.getId(),
            defaultName: t.i18n("VolObj_DefaultName"),
            quality: this.quality ? this.quality : this.defaultQuality,
            volCalulated: this.volumeCalculated,
            addedVol: this._addedVol,
            removedVol: this._removedVol,
            horizontalArea: this._horizontalArea,
            perimeter: this._perimeter,
            timestamp: Cesium.defaultValue(i, Date.now()),
            prims: [y, o, u]
        };
        c.flyTo = function () {
            viewer.camera.flyToBoundingSphere(c.bs)
        }, c.delete = function () {
            TerraExplorer.internal.Project.deleteObject(c)
        }, Object.defineProperty(c, "show", {
            "default": !0, get: function () {
                return c.prims[0]._billboards[0].show
            }, set: function (e) {
                this.prims.forEach(function (t) {
                    t instanceof Cesium.BillboardCollection ? t._billboards.forEach(function (t) {
                        t.show = e
                    }) : t instanceof Cesium.LabelCollection ? t._labels.forEach(function (t) {
                        t.show = e
                    }) : t.show = e
                })
            }
        }), Object.defineProperty(c, "displayName", {
            "default": !0, get: function () {
                return c.name
            }, set: function (e) {
                c.name = e
            }
        }), Object.defineProperty(c, "Quality", {
            "default": !0, get: function () {
                return c.quality
            }, set: function (t) {
                c.quality = t, e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click()
            }
        }), this.newName !== undefined && (r = this.newName);
        if (r !== undefined && r.indexOf(t.i18n("VolObj_DefaultName")) > -1) {
            var h = Number(r.split("#")[1]);
            s._allAvailableObjectsNames[s._objectTypes.VOLUME] === undefined && (s._allAvailableObjectsNames[s._objectTypes.VOLUME] = new Array(s._objectsMaxNumber.volume)), s._allAvailableObjectsNames[s._objectTypes.VOLUME][h] = !0
        }
        return c.name = r ? r : TerraExplorer.internal.Project.getAvailableDefaultName(c), TerraExplorer.internal.Project.addToObjectList(c), c
    }, m.prototype.updateVolumeText = function () {
        if (this._horizontalArea == 0 && this._perimeter == 0 && this._currentObject !== undefined) this._toolContainerText = ""; else {
            if (this._currentObject !== undefined) this._horizontalArea = this._currentObject.horizontalArea, this._perimeter = this._currentObject.perimeter; else {
                var n = [];
                for (var r = 0; r < y.length; r++) n.push(y.get(r).position);
                this._horizontalArea = u.calcArea2D(n), this._perimeter = 0;
                for (var r = 0; r < n.length - 1; r++) this._perimeter += u.geoDist3D(n[r], n[r + 1]);
                this._perimeter += u.geoDist3D(n[n.length - 1], n[0])
            }
            var s = e("<div class='containerDiv'></div>"),
                o = e("<div class='containerDivParent' id='MessageClientId'></div>");
            s.append(o), TerraExplorer.tools.ToolContainer.setText(""), e("#LowerView #MessageClientId").length > 0 && e("#LowerView #MessageClientId").parent().remove(), e("#LowerView").append(s), o.css({height: s.height()}), this._listControl = new l(o), this._listControl.IsAnalyzeToolList = !0;
            var a = t.i18n("measure_area_horizontalArea", {area: i.formatArea(this._horizontalArea)}),
                f = t.i18n("measure_area_perimeter", {perimeter: i.formatDistance(this._perimeter)}),
                c = t.i18n("Volume_Analysis_Volume");
            if (this._viewMode) if (this.isCalculating) this._listControl.add({
                text: c,
                calculateProp: {
                    className: "listControlLineTextAnalyzeToolClaculateClassDisabled",
                    aText: t.i18n("Volume_Analysis_Calculating")
                }
            }), this.ToolContainer.enableButton("3", !1); else if (this.volumeCalculated) {
                var h = t.i18n("measure_volume_added", {addedVol: i.formatVolume(this._addedVol)}),
                    p = t.i18n("measure_volume_remove", {removedVol: i.formatVolume(this._removedVol)});
                this._listControl.add({
                    text: c,
                    calculateProp: {
                        className: "listControlLineTextAnalyzeToolClaculateClassDisabled",
                        aText: t.i18n("Volume_Analysis_Calculated"),
                        onClick: undefined
                    }
                }), this._listControl.add({text: h}), this._listControl.add({text: p}), this.ToolContainer.enableButton("3", !1)
            } else this._listControl.add({
                text: c,
                calculateProp: {
                    className: "listControlLineTextAnalyzeToolClaculateClass",
                    aText: t.i18n("Volume_Analysis_Calculate"),
                    onClick: "TerraExplorer.tools.ToolManager._tools.VolumeAnalysis.doWorkAsync();"
                }
            });
            this._listControl.add({text: a}), this._listControl.add({text: f})
        }
    }, m.prototype.displayPropertiesSheet = function () {
        this._toolContainer.selectButton("displayProperties", !0);
        var n = Cesium.when.defer();
        n.resolve([{valueTemp: 0}]);
        var r = this;
        Cesium.when(n, function (n) {
            var i = new p(r.CreatePropObj()), s;
            r._currentObject === undefined && (s = {
                type: TerraExplorer.internal.Project.ObjectsTypes.VOLUME,
                defaultName: t.i18n("VolObj_DefaultName")
            }), r._currentObject === undefined ? (r.newName !== undefined ? e("#newNameId").val(r.newName) : e("#newNameId").val(TerraExplorer.internal.Project.getAvailableDefaultName(s, !0)), r.quality !== undefined && e("#qualityTd select").val(r.quality)) : (e("#newNameId").val(r._currentObject.displayName), e("#qualityTd select").val(r._currentObject.quality))
        })
    }, m.prototype.CreatePropObj = function () {
        var e = this, n = {
            title: t.i18n("Volume_Analysis_display_properties"),
            img: "./img/newDesign/volume.png",
            onCloseDialogUpdate: e.onCloseDialogUpdate,
            fields: [{
                label: t.i18n("Volume_display_Name"),
                type: "textbox",
                id: "newNameId"
            }, {
                label: t.i18n("Volume_Analysis_display_Quality"),
                type: "combobox",
                id: "qualityTd",
                selectId: "qualitySelectionBox",
                onChange: e.onChangeQualitySelectionBox,
                comboItems: [{value: d.LOW, key: v[d.LOW]}, {
                    value: d.MEDIUM,
                    key: v[d.MEDIUM],
                    defaultItem: !0
                }, {value: d.HIGH, key: v[d.HIGH]}],
                defaultComboItem: ""
            }]
        };
        return n
    }, m.prototype.onCloseDialogUpdate = function (t) {
        TerraExplorer.tools.ToolDialog.SetPosition();
        var n = TerraExplorer.tools.ToolManager._tools.VolumeAnalysis;
        n.ToolContainer.selectButton("displayProperties", !1), t || (n.newName = e("#newNameId").val(), n.quality = Number(e("#qualityTd").find(":selected").val()), n._currentObject !== undefined && (n._currentObject.Quality != n.quality && (TerraExplorer.tools.ToolManager._tools.VolumeAnalysis.volumeCalculated = !1, n._currentObject.volCalulated = !1), n._currentObject.displayName = n.newName, n._currentObject.Quality = n.quality, n.updateVolumeText(), h.DefaultStorage.saveItem(n._currentObject)), e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click(), e(".listControlLineTextNormalSidebar").each(function (t, r) {
            r.textContent == n.newName && e(r).click()
        }), n._currentObject !== undefined && (TerraExplorer.tools.ToolManager.openTool("VolumeAnalysis", n._currentObject), e(e(".selectedLine img")[0]).length > 0 && e(".selectedLine img")[0].click()))
    }, m.prototype.onIntersection = function (e, t, n) {
        n()
    }, m.prototype.onAbort = function (e) {
        g = null, y.removeAll(), this.reset(), e && e.abortReason == this.drawingTool.ABORT_REASONS.ESC_KEY && setTimeout(function () {
            TerraExplorer.tools.ToolManager.openTool("VolumeAnalysis")
        }, 0)
    }, m
}),define("tools/ToolManager", ["jquery", "TELang", "./ToolContainer", "./ToolDelegate", "./TETools/DistanceTool", "./TETools/AreaTool", "./TETools/ProfileTool", "./TETools/PlacesTool", "./TETools/LayersTool", "./TETools/LoadLayersTool", "./TETools/LayerToolbox", "./TETools/UndergroundTool", "./TETools/SettingsTool", "./TETools/QueryTool", "./TETools/MessageLink", "./TETools/ShadowTool", "./TETools/TimeTool", "./TETools/EditFavoriteTool", "./TETools/EditLayersTool", "./TETools/AttributeTableTool", "./TETools/PresentationTool", "./TETools/PresentationStepsTool", "./TETools/ContourMapTool", "./TETools/TwoDModeTool", "./TETools/TwoDNorthModeTool", "./TETools/ThreeDModeTool", "./TETools/SlopeTool", "./TETools/AddViewshedTool", "./TETools/ViewshedTool", "./TETools/AboutTool", "./TETools/RotateTool", "./TETools/AddFavoriteTool", "./TETools/ObliqueViewerTool", "./TETools/ModifyTerrainTool", "./TETools/HoleOnTerrainTool", "./TETools/VideoOnTerrainTool", "./TETools/VolumeAnalysis"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b, w, E, S, x, T, N, C, k, L, A, O, M, _, D, P, H, B) {
    "use strict";
    var j = null, F = function () {
        this._tools = {}, this._toolsRegistered = !1, this._currentTool, this.registerTools = function (t) {
            if (this._toolsRegistered) throw{
                type: "TE_EXCEPTION",
                format: "ToolManager is singeltone. Use ToolManager.getInstance() to get instance"
            };
            n.ToolManager = this, this.registerTool(new i), this.registerTool(new s), this.registerTool(new o), this.registerTool(new u), this.registerTool(new a), this.registerTool(new f), this.registerTool(new l), TerraExplorer.isMobile() || this.registerTool(new c), this.registerTool(new h), this.registerTool(new p), this.registerTool(new d), TerraExplorer.isMobile() || this.registerTool(new v), TerraExplorer.isMobile() || this.registerTool(new m), this.registerTool(new g), this.registerTool(new y), this.registerTool(new b), this.registerTool(new w), this.registerTool(new E), this.registerTool(new S), this.registerTool(new O), this.registerTool(new M), this.registerTool(new x), this.registerTool(new T), this.registerTool(new N), this.registerTool(new C), this.registerTool(new k), this.registerTool(new L), this.registerTool(new A), this.registerTool(new _), this.registerTool(new D), this.registerTool(new P), this.registerTool(new H), this.registerTool(new B), t.forEach(e.proxy(function (e) {
                this.registerTool(e)
            }, this))
        }, this.checkToolValidity = function (e) {
            if (e.getId == undefined) throw{type: "TE_EXCEPTION", format: "Tools must implement getId() method"};
            var t = e.getId();
            if (this._tools[t] != null) throw{
                type: "TE_EXCEPTION",
                format: "Tool with id {0} already registered",
                param: t
            };
            return !0
        }, this.registerToolAsSideTool = function (e) {
            this.checkToolValidity(e) && (TerraExplorer.tools.SideBar.AddSideTool(e), this._tools[e.getId()] = e, e.ToolManager = this)
        }, this.registerTool = function (e) {
            this.checkToolValidity(e) && (this._tools[e.getId()] = e, e.ToolManager = this)
        }, this.startTool = function (e, t, n, r) {
            e && this.openTool(e.getId(), t, n, r)
        }, this.getMenuEntries = function () {
            var e = new Array;
            for (var t in this._tools) {
                var n = this._tools[t];
                n.getMenuEntry != undefined && e.push(n.getMenuEntry())
            }
            return e
        }
    };
    return F.prototype.getInstance = function () {
        return j
    }, F.prototype.openTool = function (t, i, s, o) {
        this._currentTool = t;
        var u = this._tools[t];
        u.open != undefined && u.open(i), u instanceof r && (u.Param = i, n.showWithDelegate(u, function () {
            s != undefined && setTimeout(j.openTool, 1, s, o)
        })), TerraExplorer.mobileApp && e("#openAnotherProjectId").remove()
    }, F.prototype.restartTool = function (e, t, n, r) {
        setTimeout(this.openTool(e, t, n, r), 1)
    }, j = new F, j
}),function (e) {
    function t(t, n, r) {
        var i = "rgb" + (e.support.rgba ? "a" : "") + "(" + parseInt(t[0] + r * (n[0] - t[0]), 10) + "," + parseInt(t[1] + r * (n[1] - t[1]), 10) + "," + parseInt(t[2] + r * (n[2] - t[2]), 10);
        return e.support.rgba && (i += "," + (t && n ? parseFloat(t[3] + r * (n[3] - t[3])) : 1)), i + ")"
    }

    function n(e) {
        var t;
        return (t = /#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/.exec(e)) ? [parseInt(t[1], 16), parseInt(t[2], 16), parseInt(t[3], 16), 1] : (t = /#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/.exec(e)) ? [17 * parseInt(t[1], 16), 17 * parseInt(t[2], 16), 17 * parseInt(t[3], 16), 1] : (t = /rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e)) ? [parseInt(t[1]), parseInt(t[2]), parseInt(t[3]), 1] : (t = /rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9\.]*)\s*\)/.exec(e)) ? [parseInt(t[1], 10), parseInt(t[2], 10), parseInt(t[3], 10), parseFloat(t[4])] : i[e]
    }

    e.extend(!0, e, {
        support: {
            rgba: function () {
                var t = e("script:first"), n = t.css("color"), r = !1;
                if (/^rgba/.test(n)) r = !0; else try {
                    r = n != t.css("color", "rgba(0, 0, 0, 0.5)").css("color"), t.css("color", n)
                } catch (i) {
                }
                return r
            }()
        }
    });
    var r = "color backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor outlineColor".split(" ");
    e.each(r, function (r, i) {
        e.Tween.propHooks[i] = {
            get: function (t) {
                return e(t.elem).css(i)
            }, set: function (r) {
                var s = r.elem.style, o = n(e(r.elem).css(i)), u = n(r.end);
                r.run = function (e) {
                    s[i] = t(o, u, e)
                }
            }
        }
    }), e.Tween.propHooks.borderColor = {
        set: function (i) {
            var s = i.elem.style, o = [], u = r.slice(2, 6);
            e.each(u, function (t, r) {
                o[r] = n(e(i.elem).css(r))
            });
            var a = n(i.end);
            i.run = function (n) {
                e.each(u, function (e, r) {
                    s[r] = t(o[r], a, n)
                })
            }
        }
    };
    var i = {
        aqua: [0, 255, 255, 1],
        azure: [240, 255, 255, 1],
        beige: [245, 245, 220, 1],
        black: [0, 0, 0, 1],
        blue: [0, 0, 255, 1],
        brown: [165, 42, 42, 1],
        cyan: [0, 255, 255, 1],
        darkblue: [0, 0, 139, 1],
        darkcyan: [0, 139, 139, 1],
        darkgrey: [169, 169, 169, 1],
        darkgreen: [0, 100, 0, 1],
        darkkhaki: [189, 183, 107, 1],
        darkmagenta: [139, 0, 139, 1],
        darkolivegreen: [85, 107, 47, 1],
        darkorange: [255, 140, 0, 1],
        darkorchid: [153, 50, 204, 1],
        darkred: [139, 0, 0, 1],
        darksalmon: [233, 150, 122, 1],
        darkviolet: [148, 0, 211, 1],
        fuchsia: [255, 0, 255, 1],
        gold: [255, 215, 0, 1],
        green: [0, 128, 0, 1],
        indigo: [75, 0, 130, 1],
        khaki: [240, 230, 140, 1],
        lightblue: [173, 216, 230, 1],
        lightcyan: [224, 255, 255, 1],
        lightgreen: [144, 238, 144, 1],
        lightgrey: [211, 211, 211, 1],
        lightpink: [255, 182, 193, 1],
        lightyellow: [255, 255, 224, 1],
        lime: [0, 255, 0, 1],
        magenta: [255, 0, 255, 1],
        maroon: [128, 0, 0, 1],
        navy: [0, 0, 128, 1],
        olive: [128, 128, 0, 1],
        orange: [255, 165, 0, 1],
        pink: [255, 192, 203, 1],
        purple: [128, 0, 128, 1],
        violet: [128, 0, 128, 1],
        red: [255, 0, 0, 1],
        silver: [192, 192, 192, 1],
        white: [255, 255, 255, 1],
        yellow: [255, 255, 0, 1],
        transparent: [255, 255, 255, 0]
    }
}(jQuery),define("jquery.animate-colors-min", function () {
}),define("tools/MenuButton", ["jquery", "TELang", "./ToolManager", "./MenuEntry", "./ToolContainer", "tools/ToolDialog", "internal/Settings", "./TETools/LayersStorage", "./ListControl", "./DisplayGroupItem", "./DisplayItem", "jquery.animate-colors-min"], function (e, t, n, r, i, s, o, u, a, f, l, c) {
    "use strict";
    var h = function () {
        this._visibility = !1, this._image = "./img/newDesign/menu_background.png", this._showAnalysisDistance = !0, this._showAnalysisArea = !0, this._showAnalysisVolume = !0, this._showAnalysisProfile = !0, this._showQueryTool = !0, this._showShadowTool = !0, this._showViewshedTool = !1, this._showSlopeTool = !1, this._showContourMapTool = !0, this._showTwoDModeTool = !0, this._showTwoDNorthModeTool = !0, this._showAnalysisDistnace = !0, this._showThreeDModeTool = !0, this._showRotateTool = !0, this._showLayers = !0, this._ShowLayerToolbox = !0, this._showPlaces = !0, this._showUnderground = !0, this._showSettings = !0, this._currentEntry = {Text: "Places"}, this._thirdLevelGroups = [], this._beforeSettingsEntry = "Places", this._allObjectsItems = new f, this._layersStorage = u.DefaultStorage, this._listControl = null, this._listControlObj = null, this._rootMenuEntry = null, this._currentMenuEntry = null, this._enabled = !0
    }, p = this;
    return Cesium.defineProperties(h.prototype, {
        DefaultOpacity: {
            get: function () {
                return 1
            }
        }, Visibility: {
            get: function () {
                return this._visibility
            }, set: function (t) {
                if (e("#MenuButtonDiv").length == 0 && t == 1) {
                    var r = e("<div class='s8' id='MenuButtonDiv' style='z-index:10000;position:absolute; left:0px; top:0px; width:54px; height:54px; border: none; border-radius: 0px; background-color: rgba(20, 20, 20, 1.0); overflow: hidden;'><img id='MenuButtonImg' src='" + this._image + "' class='link' '/></div>").disableSelection(),
                        u = e("<div class='menu' id='MenuDiv' z-index='100' style='display:none; '><img id='BackButtonImg' class='menuLine' src='img/back.png' style='display:none;padding:8px 12px 8px 8px; border-right: 1px solid rgba(255, 255, 255, 0.2); float:left' /><div id='MenuHeaderDiv' style='margin:10px 8px 8px 8px; text-align: center;'>Menu</div><div style='border-top: 2px solid #ffffff;clear:both;'></div><table id='MenuTable' width ='100%' class='menuTable' cellpadding='0px' cellspacing=0px' style='position:relative;left:10px;'></table></div>").disableSelection(),
                        a = e("<img id='MenuBottomBorderImg' src='img/menuButtomBorder.png' z-index='100' style='position:absolute; display:none ' />").disableSelection();
                    e("#" + window.divId).append(r), r.css({opacity: this.DefaultOpacity}), r.on("dragstart", function (e) {
                        e.preventDefault()
                    });
                    var f = !1;
                    r.click(e.proxy(function () {
                        if (!this._enabled || f) {
                            f && (f = !1);
                            return
                        }
                        var t = e("#MenuDiv").is(":visible");
                        t ? this.closeMenu() : this.showMenu()
                    }, this));
                    var l = e.proxy(this.closeMenu, this), c = this, h;
                    r.on("mousedown", function () {
                        f = !1, h = setTimeout(function () {
                            f = !0;
                            var e = Cesium.defaultValue(o.longPressToolId, "PlacesTool");
                            n.openTool(e), l()
                        }, 500)
                    }).on("mouseup mouseleave", function () {
                        clearTimeout(h)
                    }), r.on("click", function () {
                        TerraExplorer.tools.SideBar.Show()
                    }), r.on("touchend", function () {
                        TerraExplorer.tools.SideBar.Show()
                    }), e("#BackButtonImg").click(e.proxy(function () {
                        this.CurrentMenuEntry = this.RootMenuEntry
                    }, this));
                    var p = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
                    p.setInputAction(l, Cesium.ScreenSpaceEventType.LEFT_DOWN), p.setInputAction(l, Cesium.ScreenSpaceEventType.MIDDLE_DOWN), p.setInputAction(l, Cesium.ScreenSpaceEventType.RIGHT_DOWN), i.MainButton = this, s.MainButton = this
                }
                e("#MenuButtonDiv").length != 0 && (t ? e("#MenuButtonDiv").show() : e("#MenuButtonDiv").hide()), this._visibility = t
            }
        }, DivId: {
            get: function () {
                return "MenuButtonDiv"
            }
        }, Image: {
            get: function () {
                return this._image
            }, set: function (t) {
                this._image = t, e("#MenuButtonImg").attr("src", "./img/newDesign/menu_background.png"), e("#MenuButtonImg").css("padding", "0")
            }
        }, ShowShadowTool: {
            get: function () {
                return this._showShadowTool
            }, set: function (e) {
                this._showShadowTool = e
            }
        }, ShowSlopeTool: {
            get: function () {
                return this._showSlopeTool
            }, set: function (e) {
                this._showSlopeTool = e
            }
        }, ShowViewshedTool: {
            get: function () {
                return this._showViewshedTool
            }, set: function (e) {
                this._showViewshedTool = e
            }
        }, ShowContourMapTool: {
            get: function () {
                return this._showContourMapTool
            }, set: function (e) {
                this._showContourMapTool = e
            }
        }, ShowTwoDModeTool: {
            get: function () {
                return this._showTwoDModeTool
            }, set: function (e) {
                this._showTwoDModeTool = e
            }
        }, ShowThreeDModeTool: {
            get: function () {
                return this._showThreeDModeTool
            }, set: function (e) {
                this._showThreeDModeTool = e
            }
        }, ShowTwoDNorthModeTool: {
            get: function () {
                return this._showTwoDNorthModeTool
            }, set: function (e) {
                this._showTwoDNorthModeTool = e
            }
        }, ShowRotateTool: {
            get: function () {
                return this._showRotateTool
            }, set: function (e) {
                this._showRotateTool = e
            }
        }, ShowQueryTool: {
            get: function () {
                return this._showQueryTool
            }, set: function (e) {
                this._showQueryTool = e
            }
        }, ShowAnalysisDistance: {
            get: function () {
                return this._showAnalysisDistnace
            }, set: function (e) {
                this._showAnalysisDistnace = e
            }
        }, ShowAnalysisArea: {
            get: function () {
                return this._showAnalysisArea
            }, set: function (e) {
                this._showAnalysisArea = e
            }
        }, ShowAnalysisVolume: {
            get: function () {
                return this._showAnalysisVolume
            }, set: function (e) {
                this._showAnalysisVolume = e
            }
        }, ShowAnalysisProfile: {
            get: function () {
                return this._showAnalysisProfile
            }, set: function (e) {
                this._showAnalysisProfile = e
            }
        }, ShowLayers: {
            get: function () {
                return this._showLayers
            }, set: function (e) {
                this._showLayers = e
            }
        }, ShowLayerToolbox: {
            get: function () {
                return this._showLayerToolbox
            }, set: function (e) {
                this._showLayerToolbox = e
            }
        }, ShowPlaces: {
            get: function () {
                return this._showPlaces
            }, set: function (e) {
                this._showPlaces = e
            }
        }, ShowUnderground: {
            get: function () {
                return this._showUnderground
            }, set: function (e) {
                this._showUnderground = e
            }
        }, ShowSettings: {
            get: function () {
                return this._showSettings
            }, set: function (e) {
                this._showSettings = e
            }
        }, RootMenuEntry: {
            get: function () {
                return this._rootMenuEntry
            }, set: function (e) {
                this._rootMenuEntry = e, this._currentMenuEntry = e
            }
        }, CurrentMenuEntry: {
            get: function () {
                return this._currentMenuEntry
            }, set: function (t) {
                this._currentMenuEntry = t;
                if (this._currentMenuEntry == null) return;
                e("#MenuHeaderDiv").text(t.Text), this._rootMenuEntry == t ? e("#BackButtonImg").hide() : e("#BackButtonImg").show(), this.rebuildTable(t.ChildEntries)
            }
        }, Enable: {
            get: function () {
                return this._enabled
            }, set: function (t) {
                var n = e("#MenuButtonDiv");
                t ? n.css({opacity: this.DefaultOpacity}) : n.css({opacity: .2}), this._enabled = t
            }
        }
    }), h.prototype.flash = function (t) {
        t == undefined && (t = 5e3);
        var n = setInterval(function () {
            e("#MenuButtonDiv").css("border") == "2px solid rgb(255, 255, 255)" ? e("#MenuButtonDiv").css({border: "2px solid rgb(144, 215, 237)"}) : e("#MenuButtonDiv").css({border: "2px solid rgb(255, 255, 255)"})
        }, 300);
        setTimeout(function () {
            clearInterval(n), e("#MenuButtonDiv").css({border: "2px solid rgb(255, 255, 255)"})
        }, t)
    }, h.prototype.onMainMenuShow = function () {
        i.setEnable(!1)
    }, h.prototype.onMainMenuHide = function () {
        i.setEnable(!0)
    }, h.prototype.buildMenu = function () {
        var e = this.buildMenuFromEntries(n.getMenuEntries());
        if (e.ChildEntries.length == 0) return;
        this.RootMenuEntry = e, this.CurrentMenuEntry = e
    }, h.prototype.showMenu = function () {
        this.onMainMenuShow(), this.buildMenu(), TerraExplorer.tools.SideBar.Show()
    }, h.prototype.closeMenu = function () {
        e("#MenuDiv").hide(), e("#MenuBottomBorderImg").hide(), this.onMainMenuHide()
    }, h.prototype.addObjectEntries = function (r, i) {
        var s = this, o = TerraExplorer.internal.Project;
        this._listControl.add({
            text: t.i18n("analysis_objects"),
            header: !0,
            objectSubHeader: !0
        }), this._allObjectsItems.childItems = [];
        var u = 0;
        for (var a = 0; a < TerraExplorer.tools.userTools.length; a++) {
            var f = TerraExplorer.tools.ToolManager._tools[TerraExplorer.tools.userTools[a]].getMenuEntry().Parent;
            f.substr(0, f.indexOf("|")) === s.CurrentMenuEntry.Text && u++
        }
        Object.values(TerraExplorer.internal.Project._allAnalysisObjects).forEach(function (e) {
            e.length > 0 && o._allAvailableObjectsNames[e[0]._object.type] === undefined && (o._allAvailableObjectsNames[e[0]._object.type] = new Array(o._objectsMaxNumber[e[0]._object.type]))
        });
        var l = [].concat.apply([], Object.values(TerraExplorer.internal.Project._allAnalysisObjects));
        l.sort(function (e, t) {
            if (e.timestamp < t.timestamp) return -1;
            if (e.timestamp > t.timestamp) return 1;
            0
        }), l.forEach(function (t) {
            t = t._object, (t.type === o._objectTypes.VIEWSHED || t.type === o._objectTypes.VIDEO_ON_TERRAIN) && t.viewshedObjOptions !== undefined && t.viewshedObjOptions._displayName == undefined && (t.viewshedObjOptions.displayName !== undefined ? t.viewshedObjOptions._displayName = t.viewshedObjOptions.displayName : t.viewshedObjOptions._displayName = o.getAvailableDefaultName(t));
            var r = s.createDisplayItem(t);
            TerraExplorer.internal.Settings.saveObjects == 0 && s._layersStorage.saveItem(t), r.doNotPush === undefined && s._allObjectsItems.childItems.push(r);
            var i = [{
                img: "./img/newDesign/lineHover/edit.png", onClick: function (t) {
                    var r = s._allObjectsItems.getItem(t.data.index - u - 1),
                        i = TerraExplorer.tools.ToolManager._tools.LayersTool.getLayerFromItem(r);
                    if (i.type == "viewshed") {
                        i._displayName = r.name;
                        var o = TerraExplorer.tools.ToolManager._tools.Viewshed;
                        o.ToolContainer !== null && o._addingViewshedMode && e("#ContainerRootDiv #CloseImg").click(), n.openTool("Viewshed", i)
                    } else n.openTool(i.tool, i)
                }
            }, {
                img: "./img/newDesign/lineHover/delete.png", onClick: function (e) {
                    var t = s._allObjectsItems.getItem(e.data.index - u - 1),
                        n = TerraExplorer.tools.ToolManager._tools.LayersTool.getLayerFromItem(t);
                    TerraExplorer.internal.Project.deleteObject(n)
                }
            }];
            (t.type === o._objectTypes.MODIFY_TERRAIN || t.type === o._objectTypes.VIDEO_ON_TERRAIN || t.type === o._objectTypes.HOLE_ON_TERRAIN) && i.shift(), s._listControl.add({
                onClick: function (e) {
                    if (e.target.nodeName == "LABEL" || e.target.nodeName == "INPUT") return;
                    var t = s._allObjectsItems.getItem(e.data - u - 1),
                        n = TerraExplorer.tools.ToolManager._tools.LayersTool.getLayerFromItem(t);
                    n.type == "viewshed" || n.type == "videoOnTerrain" ? (viewer.scene.globe._surface._debug.maxDepth > 12 && (TerraExplorer.groundCollisionDetection = !1), TerraExplorer.internal.Navigate.flyToPosition(new TerraExplorer.internal.TEPosition({
                        cartesian: n.position,
                        headingPitchRange: new Cesium.HeadingPitchRange(n.viewshedPrimitive._camera.heading, n.viewshedPrimitive._camera.pitch, 1)
                    }), {
                        complete: function () {
                            viewer.camera.flyTo({
                                destination: n.position,
                                orientation: {direction: n.direction, up: Cesium.Cartesian3.UNIT_Z},
                                duration: .01,
                                complete: function () {
                                    TerraExplorer.groundCollisionDetection = !0
                                },
                                cancel: function () {
                                    TerraExplorer.groundCollisionDetection = !0
                                }
                            })
                        }
                    })) : (viewer.scene.globe._surface._debug.maxDepth > 12 && (TerraExplorer.groundCollisionDetection = !1), viewer.camera.flyToBoundingSphere(n.bs, {
                        complete: function () {
                            TerraExplorer.groundCollisionDetection = !0
                        }, cancel: function () {
                            TerraExplorer.groundCollisionDetection = !0
                        }
                    }))
                }, text: r.name, isSideBarObject: !0, buttons: i, checkbox: {
                    isChecked: function () {
                        return t.show
                    }, onClick: function (e) {
                        var t = s._allObjectsItems.getItem(e.data - u - 1),
                            n = TerraExplorer.tools.ToolManager._tools.LayersTool.getLayerFromItem(t);
                        n.type === "modifyTerrain" ? n.Show = !n.Show : n.show = !n.show, TerraExplorer.internal.Settings.saveObjects == 0 && s._layersStorage.saveItem(n)
                    }
                }
            })
        })
    }, h.prototype.createDisplayItem = function (t) {
        var n, r, i, s, o = TerraExplorer.internal.Project._objectTypes;
        switch (t.type) {
            case o.VIEWSHED:
                n = "./img/newDesign/analyze_viewshed.png", r = t.viewshedObjOptions._displayName, i = t.guid, s = 10;
                break;
            case o.DISTANCE:
                n = "./img/newDesign/analyze_distance.png", r = t.name, i = t.id;
                break;
            case o.AREA:
                n = "./img/newDesign/analyze_area.png", r = t.name, i = t.id;
                break;
            case o.VOLUME:
                n = "./img/newDesign/volume.png", r = t.name, i = t.id;
                break;
            case o.VIDEO_ON_TERRAIN:
                n = "./img/newDesign/analyze_distance.png", r = t.displayName, i = t.guid;
                break;
            case o.MODIFY_TERRAIN:
                n = "./img/newDesign/analyze_distance.png", r = t.meshObject !== undefined && t.displayName.indexOf("Terrain") > -1 ? t.displayName.replace("Terrain", "B3dm") : t.displayName, i = t.id;
                break;
            case o.HOLE_ON_TERRAIN:
                n = "./img/newDesign/analyze_distance.png", r = t.displayName, i = t.id;
                break;
            default:
                n = "", r = "", i = Cesium.createGuid()
        }
        var u = e.grep(this._allObjectsItems, function (e) {
            return e.id === i
        });
        if (u.length === 1) return u.doNotPush = !0, u[0];
        var a = new l(r, n);
        return s === undefined && (s = 6), a.id = i, a.tag = s, a
    }, h.prototype.AddSubMenu = function (n) {
        var r = "aaa", i = this;
        n.Text == t.i18n("Menu_Analyze") && (n._toolId = "AnalyzeTool", n.displayName = t.i18n("menuEntry_displayName_Analyze")), n.Text == t.i18n("Menu_Layers") && (n._toolId = "Menu_Layers", n.displayName = t.i18n("Menu_Layers")), n.Text == t.i18n("Menu_Navigation") && (n._toolId = "Menu_Navigation", n.displayName = t.i18n("menuEntry_displayName_Navigation")), n._toolId == "PlacesTool" ? n.displayName = t.i18n("menuEntry_displayName_Places") : n._toolId == "SettingsTool" && (n.displayName = "");
        if (n.subEntry == undefined) {
            var s = e("<div class='menuEntry'><img id='menuIcon" + n._toolId + "' src='" + n.Icon + "'/><span id='menuSpan'>" + n.displayName + "</span></div>");
            s.click(e.proxy(function () {
                e("#menuIconSettingsTool").IsSelected = !1, e("#menuIconSettingsTool").css({
                    width: "21px",
                    height: "21px",
                    margin: "0px"
                }), e("#MenuTable div").each(function (t, n) {
                    n.IsSelected = !1, e(n).css("background-color", "#282828"), e("#tab_selection_img").remove(), n.isLayersToolMenu = !1
                }), s.css("background-color", "#0DC2DF"), s.prop("IsSelected", !0), s.append('<img id="tab_selection_img" src="./img/newDesign/tab_selection.png">'), s.entry.displayName == t.i18n("menuEntry_displayName_Layers") && (s[0].isLayersToolMenu = !0), this.menuEntryClicked(n)
            }, this)), n.ChildEntries.length == 0 && s.find("#BulletImgId").css("visibility", "hidden"), s.entry = n, n._toolId === "SettingsTool" && e("#headerDiv #menuIconSettingsTool").length <= 0 ? (e("#headerDiv").prepend(s), s.css({
                position: "relative",
                padding: "3px 7px 3px 7px",
                "background-color": "#2b2b2b",
                "margin-top": "0px",
                height: "21px",
                width: "21px",
                cursor: "pointer"
            })) : n._toolId !== "SettingsTool" && e("#MenuTable")[0] !== undefined && e("#MenuTable")[0].appendChild(s[0])
        } else {
            var i = this;
            this._listControl.add({
                img: n.Icon, text: n.Text, header: !0, subHeader: !0, onClick: function () {
                    i.menuEntryClicked(n)
                }
            })
        }
    }, h.prototype.buildMenuFromEntries = function (e) {
        var n = {}, i = new r;
        i.Text = t.i18n("Menu_Menu"), n[i.Text] = i;
        for (var s in e) {
            var o = e[s];
            if (o._text == t.i18n("Menu_Analyze_Viewshed")) continue;
            var u = o.Parent;
            u == "" && (u = i.Text);
            var a = n[u];
            if (a == undefined) {
                a = new r;
                var f = u.split("|");
                a.Text = f[0], f.length > 1 && (a.Icon = f[1]), f.length > 2 && (a.Order = parseInt(f[2])), f.length > 3 && (a.Level3Group = f[3]), this.canAddMenu(a) && this.canAddMenu(o) && (n[u] = a, i.addChildEntryOrdered(a))
            }
            this.canAddMenu(o) && a.addChildEntryOrdered(o)
        }
        return i
    }, h.prototype.canAddMenu = function (e) {
        return e.ToolId == "DistanceTool" && !this.ShowAnalysisDistance ? !1 : e.ToolId == "AreaTool" && !this.ShowAnalysisArea ? !1 : e.ToolId == "ProfileTool" && !this.ShowAnalysisProfile ? !1 : e.ToolId == "PlacesTool" && !this.ShowPlaces ? !1 : e.ToolId == "UndergroundTool" && !this.ShowUnderground ? !1 : e.ToolId == "LayersTool" && !this.ShowLayers ? !1 : e.ToolId == "LayerToolbox" && !this.ShowLayerToolbox ? !1 : e.ToolId == "SettingsTool" && !this.ShowSettings ? !1 : e.ToolId == "QueryTool" && !this.ShowQueryTool ? !1 : e.ToolId == "ShadowTool" && !this.ShowShadowTool ? !1 : e.ToolId == "ContourMapTool" && !this.ShowContourMapTool ? !1 : e.ToolId == "TwoDModeTool" && !this.ShowTwoDModeTool ? !1 : e.ToolId == "ThreeDModeTool" && !this.ShowThreeDModeTool ? !1 : e.ToolId == "TwoDNorthModeTool" && !this.ShowTwoDModeTool ? !1 : e.ToolId == "RotateTool" && !this.ShowRotateTool ? !1 : e.ToolId == "SlopeTool" && !this.ShowSlopeTool ? !1 : e.ToolId == "ViewshedTool" && !this.ShowViewshedTool ? !1 : e.ToolId == "VolumeAnalysis" && !this.ShowAnalysisVolume ? !1 : !0
    }, h.prototype.CreateSubMenuEntryList = function (n) {
        function r(t) {
            return e("#checkImageSubHeader" + t).length > 0 ? !0 : !1
        }

        if (Object.keys(this._thirdLevelGroups).length == 0) e(n).each(e.proxy(function (e, t) {
            this.AddSubMenu(t)
        }), this); else {
            var i = this, s = [];
            e.each(Object.keys(this._thirdLevelGroups), function (e, t) {
                s.push(t)
            });
            if (this._currentEntry.ToolId === "Menu_Navigation" || this._currentEntry.ToolId === "AnalyzeTool") {
                var o, u;
                e.each(s, function (e, n) {
                    if (n === t.i18n("NavigationModes_Header") || n === t.i18n("NavigationModes_Header") + " " || n === t.i18n("TerrainAnalysis_Header") || n === t.i18n("TerrainAnalysis_Header") + " ") u = e, o = n
                }), s.splice(u, 1), s.splice(0, 0, o)
            }
            e.each(s, function (r, s) {
                var o = s;
                if (o != "undefined") {
                    var u = e.grep(n, function (e) {
                        return e.Group == o
                    });
                    if (u[0]._toolId == "LoadLayersTool" && !TerraExplorer.tools.MenuButton.layout.loadLayersButton) return !0;
                    s != "" && i._listControl.add({text: s, header: !0}), e(u).each(function (n, r) {
                        var s = {
                            text: r.Text,
                            img: r.Icon,
                            parent: r.Parent,
                            group: r._group,
                            inContainer: r.InContainer,
                            selectedImagePath: r.SelectedImagePath,
                            toolId: r.ToolId,
                            header: !0,
                            subHeader: !0,
                            onClick: function (n) {
                                var o = e(".selectedLine");
                                o.length > 0 && (o.css({"background-color": ""}), o.removeClass("selectedLine"), o.removeAttr("selectedOn"), e(".listControlLineButtonsSidebar").children().each(function (t, n) {
                                    e(n).css("display", "none")
                                }));
                                if (n.currentTarget.nodeName.toLowerCase() == "img" && s.selectedImagePath != undefined) {
                                    var u = "listControlContainer" + (s.group ? s.group.replace(/\s/g, "") : s.text.replace(/\s/g, ""));
                                    e("#" + u).find("img").each(function () {
                                        e(this).attr("src", e(this).closest("div")[0].unSelectedImagePath)
                                    }), e(n.currentTarget).attr("src", s.selectedImagePath)
                                }
                                var a = n.target;
                                n.target instanceof HTMLImageElement && (n.stopPropagation(), a = n.target.parentElement.children[0]);
                                var f = "checkImageSubHeader";
                                a.textContent != t.i18n("Menu_Underground") && a.textContent != t.i18n("Menu_Navigate_Rotate") && e("#" + f).length > 0 && e("#" + f).remove(), !r.IsGlobalMode && (r.DisplayCheckButton == undefined || r.DisplayCheckButton != "none") && e(a).after('<img id="' + f + '" src="./img/newDesign/v-check_on.png" style="position:absolute;left:245px;"/>'), i.menuEntryClicked(r)
                            }
                        };
                        if (r.IsGlobalMode) {
                            var o = TerraExplorer.tools.ToolManager._tools[r._toolId];
                            s.isGlobalMode = !0, s.checkbox = {
                                isChecked: function () {
                                    return Cesium.defaultValue(TerraExplorer.activeGlobalStates[r._toolId], !1)
                                }, onClick: function (t) {
                                    var n = e(this).is(":checked");
                                    o.checked !== undefined && typeof o.checked == "function" && o.checked(n)
                                }
                            }
                        }
                        i._listControl.add(s)
                    })
                }
            })
        }
    }, h.prototype.addGroupFromEntry = function (e) {
        var t = e.Group;
        this._thirdLevelGroups[t] == undefined && (this._thirdLevelGroups[t] = !0)
    }, h.prototype.rebuildTable = function (t) {
        if (t.length == 0) return;
        e("#sidebarContentDiv").empty();
        if (t[0].Parent == "") e("#MenuTable").empty(), t.forEach(e.proxy(function (e) {
            this.AddSubMenu(e)
        }, this)); else {
            var n = e("<div style='position:absolute;overflow:hidden; width:100%; height:300px;'></div>"),
                r = e("<div id='MessageClientId'></div>");
            e("#sidebarContentDiv").append(r), r.css({height: e("#sidebarContentDiv").height()}), this._listControl = new a(r);
            var i = this;
            Object.keys(this._thirdLevelGroups).forEach(function (e) {
                delete i._thirdLevelGroups[e]
            }), t.forEach(e.proxy(function (e) {
                e.subEntry = !0, this.addGroupFromEntry(e)
            }, this)), this.CreateSubMenuEntryList(t), this._currentEntry._toolId === "AnalyzeTool" && this.addObjectEntries(t.length, r.get(0)), this.addBlankSpace()
        }
        e(".menuInternalLine").last().css("border-bottom", "0px");
        var s = e("#MenuButtonDiv").position();
        e("#MenuDiv").css({
            bottom: 30 + e("#MenuButtonDiv").outerHeight(),
            left: s.left
        }), e("#menuButtons span").each(function (t, n) {
            e(n).css("display", "block").css("padding-bottom", "3px")
        })
    }, h.prototype.addBlankSpace = function () {
        for (var e = 0; e < 4; e++) this._listControl.add({text: "", blankSpace: !0})
    }, h.prototype.menuEntryClicked = function (n) {
        n._toolId != "SettingsTool" && (this._beforeSettingsEntry = n), this._currentEntry._toolId == "SettingsTool" && n._toolId != this._currentEntry._toolId && (TerraExplorer.tools.ToolManager._tools.SettingsTool.onClose(), e("#menuIconSettingsTool").IsSelected = !1, e("#menuIconSettingsTool").parent().css("background-color", "#2b2b2b"));
        if (this._currentEntry._toolId == "SettingsTool" && n._toolId == this._currentEntry._toolId) {
            e("#menuIconSettingsTool").IsSelected = !1, e("#menuIconSettingsTool").parent().css("background-color", "#2b2b2b"), e("#menuIcon" + this._beforeSettingsEntry._toolId).click();
            return
        }
        n._toolId === "Menu_Navigation" && TerraExplorer.tools.ToolManager.openTool("PlacesTool"), n._toolId === "Menu_Layers" && TerraExplorer.tools.ToolManager.openTool("LayersTool"), e(".toolDialog #toolDialogTitleID").text() === t.i18n("viewshed_display_properties") && e(".toolDialog #closeXID").length > 0 && e(".toolDialog #closeXID").click(), this._currentEntry._toolId !== undefined && TerraExplorer.tools.ToolManager._tools[this._currentEntry._toolId] !== undefined && TerraExplorer.tools.ToolManager._tools[this._currentEntry._toolId].onClosedToolContainer !== undefined && TerraExplorer.tools.ToolManager._tools[this._currentEntry._toolId].onClosedToolContainer(), this._currentEntry = n, n.ChildEntries.length > 0 ? this.CurrentMenuEntry = n : (this.closeMenu(), this.onMenuAction(n)), (TerraExplorer.browser.isEdge || TerraExplorer.browser.isFirefox) && e(".listControlLineTextSubHeaderSidebar").css({
            "margin-top": "0px",
            "padding-top": "0px"
        });
        if (this._currentEntry.Text == t.i18n("Menu_Navigation") || this._currentEntry.Text == t.i18n("Menu_Analyze")) {
            var r = e(".listControlLineTextSubHeaderSidebar");
            TerraExplorer.activeGlobalStates[this._currentEntry._toolId] && console.log("asdfsf");
            var i = TerraExplorer.internal.Navigate.CurrentNavigationMode, s = e.grep(r, function (t) {
                var n = "3D";
                switch (i) {
                    case 1:
                        n = "TwoDNorthMode";
                        break;
                    case 2:
                        n = "TwoDMode";
                        break;
                    case 3:
                    default:
                        n = "ThreeDMode"
                }
                return e(t).closest("div")[0].id == n
            });
            s != undefined && e(s).next().length == 0 && e(s).closest("div").length > 0 && e(s).find("img").attr("src", e(s).closest("div")[0].selectedImagePath)
        }
        n._toolId == "Menu_Navigation" && (e(".SubHaederDiv").append(window.PlacesDiv), e("#placesBigDiv").css("position", "initial")), n._toolId == "Menu_Layers" && e(".SubHaederLayersDiv").parent().append(window.LayersDiv)
    }, h.prototype.onMenuAction = function (t) {
        if (t.ChildEntries.length > 0) return;
        TerraExplorer.tools.ToolManager._tools.Viewshed._isOpened && TerraExplorer.tools.ToolManager._tools.Viewshed.onClosedToolContainer(), n.openTool(t.ToolId, t.Param);
        if (t.IsGlobalMode) {
            e.grep(e("#MenuTable").children(), function (t) {
                return e(t)[0].IsSelected == 1
            })[0].click();
            return
        }
        s.IsOpen && i.setEnable(!1)
    }, h.prototype.onToolDialogClosed = function () {
        i.getEnable() == 0 && i.setEnable(!0)
    }, new h
}),define("tools/ContextMenu", ["jquery", "TELang", "./TETools/PlacesTool"], function (e, t, n) {
    "use strict";
    var r = 0, i = function (e, t) {
        this.id = ++r, this.text = e, this.command = t, this.active = !0
    }, s = function () {
        this._menu = {name: "default", target: null, items: []}
    };
    Cesium.defineProperties(s.prototype, {}), s.prototype.init = function () {
        var t = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
        t.setInputAction(e.proxy(this.openMenu, this), Cesium.ScreenSpaceEventType.RIGHT_CLICK), t.setInputAction(function () {
            e(".contextMenu").hide()
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN)
    };
    var o = !1;
    return s.prototype.openMenu = function (t) {
        if (this._menu.items.length <= 0) return;
        var n = this.buildMenu(e(viewer.container).get(0), t.position.clone()), r = e(window).width(),
            i = e(window).height();
        t.position.x + n.outerWidth() > r ? n.css("left", r - n.outerWidth()) : n.css("left", t.position.x), t.position.y + n.outerHeight() > i ? n.css("top", i - n.outerHeight()) : n.css("top", t.position.y), n.show()
    }, s.prototype.buildMenu = function (t, n) {
        if (e("#" + this._menu.name).length) {
            var r = e("#" + this._menu.name);
            return r.hide(), r.get(0).screenPoint = n, r
        }
        var r = document.createElement("div");
        r.className = "contextMenu", r.target = t, r.id = this._menu.name, r.screenPoint = n;
        for (var i = 0; i < this._menu.items.length; i++) {
            var s = document.createElement("div");
            this._menu.items[i].active ? s.className = "contextMenuOption active" : s.className = "contextMenuOption inactive", s.innerHTML = this._menu.items[i].text;
            var o = this._menu.items[i].command;
            s.onclick = function () {
                o(r.screenPoint)
            }, r.appendChild(s)
        }
        return e("body").append(r), e(r)
    }, s.prototype.addItem = function (e, t) {
        var n = new i(e, t);
        return this._menu.items.push(n), n.id
    }, new s
}),define("tools/MessageView", ["jquery", "TELang", "internal/InputMode", "internal/Navigate"], function (e, t, n, r) {
    "use strict";

    function s() {
        return e(viewer.scene.canvas).height() / 5
    }

    var i = null, o = function () {
    };
    return Cesium.defineProperties(o.prototype, {
        IsOpen: {
            get: function () {
                return e("#MessageDivId").is(":visible")
            }
        }
    }), o.prototype.init = function () {
        this._eventListener = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas), this._eventListener.setInputAction(e.proxy(this.onLeftClick, this), Cesium.ScreenSpaceEventType.LEFT_CLICK)
    }, o.prototype.onLeftClick = function (e) {
        if (r.IsMultiGestureNavigation) return;
        if (n.Mode != n.FREE_FLIGHT) return;
        var t = this.IsOpen, i = {}, s = viewer.scene.screenToWorld(e.position, i);
        Cesium.defined(s) && Cesium.defined(i.id) && (t = !this.showMessage(i.id)), t && this.hideMessage()
    }, o.prototype.showMessage = function (n) {
        var r = TerraExplorer.internal.Project.findObjectFromID(n);
        if (this.hasMessage(r) == 0) return !1;
        if (e("#MessageDivId").length == 0) {
            var i = e("<div id='MessageDivId' class='messageView' style=''><div style='width:100%; height:8px; background-color:rgba(60,60,60,1.0);'></div><div id='MessageDivId' style='overflow:auto; word-wrap: break-word;'></div></div>");
            e("#" + window.divId).append(i)
        }
        e("#MessageDivId").empty();
        if (this.hasAttributeMessage(r)) {
            if (r.feature.attributes != undefined) {
                var o = "<table class='messageViewTable' style=''>";
                o += "<tr><th width='30%'>" + t.i18n("messageView_attr_name") + "</th><th>" + t.i18n("messageView_attr_value") + "</th></tr>";
                for (var u in r.feature.attributes) o += "<tr><td>" + u + "</td><td>" + r.feature.attributes[u] + "</td></tr>";
                o += "</table>", e("#MessageDivId").append(e(o)), e("#MessageDivId").css({height: s(), padding: 0})
            }
        } else this.hasFavoriteMessage(r) && (e("#MessageDivId").text(r.favoriteItem.desc), e("#MessageDivId").css({padding: 10}));
        if (!this.IsOpen) {
            var a = e(viewer.scene.canvas);
            e("#MessageDivId").css({
                width: "100%",
                height: s(),
                top: a.height() + 1,
                "z-index": 500
            }), e("#MessageDivId").show(), e("#MessageDivId").animate({top: a.height() - s()}, 250)
        }
        return !0
    }, o.prototype.hideMessage = function () {
        e("#MessageDivId").animate({top: e(viewer.scene.canvas).height() + 1}, 150, function () {
            e("#MessageDivId").hide()
        })
    }, o.prototype.hasMessage = function (e) {
        return e == undefined ? !1 : this.hasFavoriteMessage(e) ? !0 : this.hasAttributeMessage(e) ? !0 : !1
    }, o.prototype.hasAttributeMessage = function (e) {
        return !1
    }, o.prototype.hasFavoriteMessage = function (e) {
        return e == undefined ? !1 : e.favoriteItem && e.favoriteItem.desc != "" ? !0 : !1
    }, i = new o, i
}),define("tools/SideBar", ["jquery", "./MenuEntry", "./ListControl", "./ToolDialog"], function (e, t, n, r) {
    "use strict";

    function o() {
        var t = e("<label id='sgAccountLabel' isInit='false'>" + TELang.i18n("sgAccount_Login") + "</label>");
        return f(t), t
    }

    function u(t) {
        var n = e("#sgAccountLabel").attr("isInit") === "true" && t != null && e("#sgAccountLabel").text() !== t;
        e("#sgAccountLabel").attr("isInit", "true"), t == null ? e("#sgAccountLabel").text(TELang.i18n("sgAccount_Login")) : e("#sgAccountLabel").text(t).attr("title", t), n === !0 && TerraExplorer.internal.Project.displayLoginLayersMessage()
    }

    function a(e) {
        sgAccount.checkAccount(u)
    }

    function f(e) {
        e.click({callbackFunction: a}, sgAccount.manageAccount), e.show(function () {
            sgAccount.checkAccount(u)
        })
    }

    var i = function () {
        this._width = 270, this._hasSearchTool = !0, this._hasMenu = !0, this._isShown = !0, this._firstTime = !0, this._sideTools = [], this._currentTool = null, this._firstTimeNoAnimation = !0, this._startingXPosition = undefined, this._startingYPosition = undefined, this._menuButtonsDivHeight = 5, this._sideBarContentDivHeight = 94 - this._menuButtonsDivHeight
    }, s = this;
    return Cesium.defineProperties(i.prototype, {
        IsShown: {
            get: function () {
                return this._isShown
            }
        }, IsOccupyLargeScreenPortion: {
            get: function () {
                return this._isShown && this._width > e("#" + window.divId).width() / 3
            }
        }, Width: {
            get: function () {
                return this._width
            }
        }, Visibility: {
            set: function (t) {
                if (t == 1) {
                    var n = e("<div class='sideBarMain' id='sideBar'></div>"),
                        r = e('<div id="placesContainer" class="sideBar"></div>'),
                        i = e('<div id="headerDiv" class="headerDivSidebar"></div>'),
                        s = e('<div id="searchBox"></div>'),
                        u = e("<div id='menuButtons'><table id='MenuTable' width ='100%' class='menuTable' cellpadding='0px' cellspacing=0px'></table></div>"),
                        a = e('<div id="sidebarContentDiv" class="narrowScrollbar" style=" width:100%; height:' + this._sideBarContentDivHeight + '%; background-color:#141414; z-index:1;"></div>'),
                        f = e("<img id='closeXID' class='link' src='./img/newDesign/x_close_caption.png'></img>"),
                        l = o();
                    i.append(f), i.append(l), r.append(i).append(s).append(u).append(a), n.append(r), n.width(this._width), e("#" + window.divId).prepend(n), e("#sideBar").hide(), this.Hide()
                }
            }
        }
    }), i.prototype.toggleSideBar = function () {
        e("#sideBar").width() == 0 ? this.Show() : this.Hide()
    }, i.prototype.AddSideTool = function (e) {
        this._sideTools[e.getId()] = !0, this.currentEntry = null
    }, e("#menuIconSettingsTool").click(function () {
        e("#CloseImg").length > 0 && e("#CloseImg").click(), e("#sidebarContentDiv").empty(), TerraExplorer.tools.ToolManager._tools.SettingsTool.open(), e("#toolDialogTitleID").remove(), e("#ContainerRootDiv").length > 0 && e("#ContainerRootDiv").hide()
    }), i.prototype.Show = function () {
        function s(t) {
            e(t).hover(function () {
                this.IsSelected || e(this).css("background-color", "#0CC2DE")
            }, function () {
                this.IsSelected || e(this).css("background-color", "#282828")
            })
        }

        e("#sideBar").show();
        var t = TerraExplorer.tools.ToolManager.getMenuEntries();
        if (t.length == 0) return;
        var n = this._width, r = e("#" + window.divId).height(), i = e("#cesiumContainer").width();
        this._firstTimeNoAnimation ? (e("#cesiumContainer").width(i - this._width), e("#sideBar").width(this._width), e("#placesContainer").css("left", "0"), this._firstTimeNoAnimation = !1) : e({width: 0}).animate({width: n}, {
            queue: !1,
            step: function () {
                e("#cesiumContainer").width(i - this.width), e("#sideBar").width(this.width), e("#placesContainer").css({left: this.width - n - 2})
            },
            duration: 250,
            complete: function () {
                e("#sideBar").width(n), e("#cesiumContainer").width(i - n), e("#placesContainer").css({left: -2}), e("#ContainerRootDiv").length > 0 && e("#ContainerRootDiv").css("left", "300px")
            }
        }), this._isShown = !0, e("#closeXID").click(function () {
            TerraExplorer.tools.SideBar.toggleSideBar()
        }), e("#MenuButtonDiv").hide();
        var o = !!navigator.userAgent.match(/firefox/i), u = /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
            a = TerraExplorer.browser.isIE;
        (o || u) && e("#searchIcon").css("padding", "0px 0px 0px 3px"), a && e("#searchIcon").css("padding", "2px"), this._firstTime ? (e("#MenuTable div").each(function (e, t) {
            s(t)
        }), this._firstTime = !1, e("#menuIconMenu_Navigation").click()) : this.currentEntry !== null && this.currentEntry._toolId !== "" ? (this.currentEntry._toolId === "Menu_Navigation" && e("#menuIconMenu_Navigation").click(), this.currentEntry._toolId === "Menu_Layers" && e("#menuIconMenu_Layers").click(), this.currentEntry._toolId === "AnalyzeTool" && e("#menuIconAnalyzeTool").click()) : e("#menuIconMenu_Navigation").click();
        var f = this;
        e("#sideBar").on("touchstart", function (e) {
            var t = e.originalEvent.targetTouches;
            t.length == 1 && (f._startingXPosition = t[0].clientX, f._startingYPosition = t[0].clientY)
        }), e("#sideBar").on("touchmove", function (e) {
            var t = e.originalEvent.changedTouches;
            if (t.length == 1) {
                var n = t[0].clientX, r = t[0].clientY, i = n - f._startingXPosition,
                    s = Math.abs(r - f._startingYPosition);
                i < -1 * f._width / 3 && s < 50 && f.Hide()
            }
        })
    }, i.prototype.Hide = function () {
        this.currentEntry = TerraExplorer.tools.MenuButton.CurrentMenuEntry;
        var t = this._width, n = 1e3, r = e("#cesiumContainer").width(), i = e("#" + window.divId).width();
        e({width: t}).animate({width: 0}, {
            queue: !1, step: function () {
                e("#sideBar").width(this.width), e("#placesContainer").css({left: this.width - t - 2}), e("#cesiumContainer").width(r - (this.width - t))
            }, duration: 250, complete: function () {
                e("#sideBar").width(0), e("#cesiumContainer").width(i), e("#placesContainer").css({left: -t - 2}), window.isTELoading || (e("#MenuButtonDiv").show(), e("#MenuButtonDiv").css("visibility", "visible")), e("#ContainerRootDiv").length > 0 && (e("#ContainerRootDiv").css("left", "30px"), TerraExplorer.isTouch() && e("#ContainerRootDiv").css("left", "0px"))
            }
        }), this._isShown = !1, e("#sideBar").off("touchstart").off("touchmove")
    }, i.prototype.RemoveSectionFromSideBar = function (t) {
        e("#placesContainer").children(t).remove()
    }, i.prototype.ChangeStyleForSideTools = function (t) {
        e("#sideBar " + t).each(function (t, n) {
            var r = e(n).attr("class");
            r != undefined && r.indexOf("listControl") != -1 && (r += "Sidebar", e(n).attr("class", r))
        })
    }, i.prototype.AddSearchTool = function () {
    }, i.prototype.AddMenuItem = function () {
    }, new i
});
var sgAccount = function ($) {
    function SGAccount() {
    }

    function getValue(e, t) {
        var n = $(e).find(t);
        return n.length == 1 ? n.text() : null
    }

    function getBaseUrl() {
        return window.SGUrl === undefined ? location.origin + "/" + location.pathname.match(/[\/]([^\/]+)[\/]/)[1] + getCurrentSitePath() : window.SGUrl
    }

    function getCurrentSitePath() {
        var e = getQueryValue("site");
        return e == undefined ? "" : ("/" + e).replace("#", "")
    }

    function getQueryValue(key) {
        var match = window.location.href.match(eval("/[?&]" + key.toLowerCase() + "[=]([^&]+)/i"));
        if (match == null) return;
        return unescape(match[1].replace("+", "%20"))
    }

    function closeActiveDialogs() {
        $("#divAccountDialog").length > 0 && $("#divAccountDialog").dialog("close").remove()
    }

    function checkTouchAvailable() {
        var e = !1;
        return function (t) {
            if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0, 4))) e = !0
        }(navigator.userAgent || navigator.vendor || window.opera), e
    }

    function receiveMessage(e) {
        if (e.data == "closeModal") {
            window.closeModal();
            return
        }
    }

    var sgAccount = new SGAccount;
    return sgAccount.checkAccount = function (e) {
        var t = getBaseUrl() + "/ConnectSG", n = {request: "check"}, r = JSON.stringify(n), i = this;
        $.ajax({
            type: "POST",
            url: t,
            async: !0,
            xhrFields: {withCredentials: !0},
            data: r,
            success: function (t, n, r) {
                e(t.loggedInDisplayName)
            },
            error: function (t) {
                console.error(TELang.i18n("sgAccount_FailedConnectSG")), e(null)
            }
        })
    }, sgAccount.loginAccount = function (e, t, n) {
        var r = getBaseUrl() + "/ConnectSG",
            i = {request: "login", username: e, password: t, sgClientData: localStorage.sgClientData};
        localStorage.sgClientData != null && localStorage.removeItem("sgClientData");
        var s = JSON.stringify(i), o = this;
        $.ajax({
            type: "POST",
            url: r,
            async: !0,
            xhrFields: {withCredentials: !0},
            data: s,
            success: function (e, t, r) {
                n(e.loggedInDisplayName)
            },
            error: function (e) {
            }
        })
    }, sgAccount.manageAccount = function (e) {
        var t = getBaseUrl() + "/ConnectSG", n = {request: "check"}, r = JSON.stringify(n), i = this;
        $.ajax({
            type: "POST",
            url: t,
            async: !0,
            xhrFields: {withCredentials: !0},
            data: r,
            success: function (t, n, r) {
                TerraExplorer.mobileApp || (t.result == "success" && t.isAnonymous == "false" && t.username != null ? sgAccount.displayAccount(e.data.callbackFunction) : sgAccount.displayLogin(e.data.callbackFunction))
            },
            error: function (e) {
                console.error(TELang.i18n("sgAccount_FailedConnectSG"))
            }
        })
    }, sgAccount.displayLogin = function (e, t) {
        closeActiveDialogs();
        var n = getBaseUrl() + "/Admin/LoginSG.aspx?teweb=true";
        $("#" + window.divId).css("visibility", "visible"), sgAccount.displayFrame(n, TELang.i18n("sgAccount_LoginTitle"), e, t)
    }, sgAccount.displayAccount = function (e) {
        closeActiveDialogs();
        var t = getBaseUrl() + "/Admin/SGAccount.aspx?teweb=true";
        sgAccount.displayFrame(t, TELang.i18n("sgAccount_AccountTitle"), e, !1)
    }, sgAccount.displayFrame = function (e, t, n, r) {
        $("link[href='./css/datePicker.css']").length > 0 && $("link[href='./css/datePicker.css']").attr("href", "./css/jquery-ui.min.css");
        var i = $('<div id="divAccountDialog" style=""></div>').html('<iframe id="sgAccountFrame" style="border: 0px; " src="' + e + '" width="100%" height="100%" scrolling="no"></iframe>').dialog({
            autoOpen: !1,
            resizable: !1,
            closeOnEscape: !0,
            modal: !0,
            height: 320,
            width: checkTouchAvailable() ? screen.width : 450,
            title: t,
            close: n,
            closeOnEscape: !r || r != 1,
            open: function () {
                r && r == 1 && $(".ui-dialog-titlebar-close").hide(), $("#divAccountDialog").css({
                    overflow: "hidden",
                    border: "0px",
                    "background-color": "white"
                }), $(".ui-dialog").css({
                    border: "0px",
                    padding: "0px",
                    "z-index": "9999"
                }), $(".ui-dialog-titlebar").css({
                    background: "#151515",
                    border: "0px",
                    color: "#d8d8d8"
                }), $(".ui-dialog-titlebar").prepend("<img src='img/Skyline16x18.png' id='sgLogo' style='padding-top:  3px' />"), $(".ui-dialog-title").css({
                    "float": "none",
                    "padding-left": "10px",
                    "font-size": "13px",
                    "vertical-align": "super"
                }), $(".ui-button").css({"background-color": "black"}).unbind("mouseenter").unbind("mouseleave"), $(".ui-icon").addClass("ui-icon-custom"), $("#" + window.divId).append($(".ui-dialog"))
            }
        });
        i.dialog("open"), checkTouchAvailable() && ($(window).off("navigate"), i.parent().height("100%"), i.parent().width("100%"), i.parent().css("top", 0), i.parent().css("left", 0)), window.closeModal = function () {
            closeActiveDialogs()
        }
    }, sgAccount.TE4WLogin = function (e, t, n) {
        var r = getValue(e, "sx\\:loginMode, loginMode");
        r == "config" ? sgAccount.loginAccount(getValue(e, "sx\\:userName, userName"), getValue(e, "sx\\:password, password"), function () {
            t()
        }) : r == "force" || n ? sgAccount.checkAccount(function (e) {
            e != null && e.trim() != "" || window.location.search.indexOf("mobileApp=1") > -1 ? t() : sgAccount.displayLogin(function () {
                t()
            }, !0)
        }) : localStorage.sgClientData != null ? sgAccount.loginAccount(null, null, function () {
            t()
        }) : t()
    }, window.addEventListener ? window.addEventListener("message", receiveMessage, !1) : window.attachEvent("onmessage", receiveMessage), sgAccount
}(jQuery);
define("tools/sgAccount", function () {
}), define("tools/tools", ["./ToolManager", "./MenuButton", "./MenuEntry", "./ContextMenu", "./MessageView", "./ToolContainer", "./DisplayItem", "./DisplayGroupItem", "./ToolDialog", "./ToolDelegate", "./SideBar", "./sgAccount", "./PropertySheet"], function (e, t, n, r, i, s, o, u, a, f, l, c, h) {
    "use strict";
    var p = {
        init: function () {
        }
    };
    return p.ToolManager = e, p.MenuButton = t, p.MenuEntry = n, p.ContextMenu = r, p.MessageView = i, p.ToolContainer = s, p.DisplayItem = o, p.DisplayGroupItem = u, p.ToolDialog = a, p.ToolDelegate = f, p.SideBar = l, p.sgAccount = c, p.PropertySheet = h, p
}), define("internal/DebugInfo", ["jquery"], function (e) {
    "use strict";
    var t = function () {
        this._visibility = !1, this._frameRateMonitor, this._optimizeTerrainPerformance = !0
    };
    return Cesium.defineProperties(t.prototype, {
        Visibility: {
            get: function () {
                return this._visibility
            }, set: function (t) {
                if (e("#DebugInfoDiv").length == 0 && t == 1) {
                    var n = e("<div class='s7' id='DebugInfoDiv' style='position:absolute; right:10px; top:10px; width:200; height:60px; background: rgba(0, 0, 0, 0.7);'>                                            <div style='padding: 4px;'>                                                <span id='FrameRateDiv'>FPS: 0</span><br>                                                <span id='YawDiv'>1235</span><br>                                                <span id='PitchDiv'>1235</span>                                            </div>                                          </div>");
                    n.disableSelection(), e("body").append(n), e("#DebugInfoDiv").on("dragstart", function (e) {
                        e.preventDefault()
                    }), this._frameRateMonitor = Cesium.FrameRateMonitor.fromScene(viewer.scene), viewer.clock.onTick.addEventListener(e.proxy(function (t) {
                        if (viewer.scene.mode == Cesium.SceneMode.MORPHING) return;
                        this._frameRateMonitor.lastFramesPerSecond != undefined && e("#FrameRateDiv").text("FPS: " + this._frameRateMonitor.lastFramesPerSecond.toFixed(0)), e("#YawDiv").text("Yaw: " + Cesium.Math.toDegrees(viewer.camera.heading).toFixed(1)), e("#PitchDiv").text("Pitch: " + Cesium.Math.toDegrees(viewer.camera.pitch).toFixed(1))
                    }, this))
                }
                this._visibility = t
            }
        }, optimizeTerrainPerformance: {
            get: function () {
                return this._optimizeTerrainPerformance
            }, set: function (e) {
                this._optimizeTerrainPerformance = e, e ? (viewer.loadQueueTimeSliceWhileMoving = 1, viewer.original_dp = undefined) : (viewer.loadQueueTimeSliceWhileMoving = 5, viewer.original_dp = !0)
            }
        }
    }), new t
}), define("sfsterrainprovider/SFSTerrainProvider", ["WorkerPool"], function (e) {
    "use strict";

    function i(e, t) {
        var n = Cesium.when.defer(), r, i = TerraExplorer.tools.ToolManager._tools.ModifyTerrainTool;
        return r = i.fillArrayFromVerticesAndHeight(e.vertices, t, e.heights[0]), r.timeStamp = e.timeStamp, r.mtHeight = e.heights, r.mtType = e.mtType, r.fromKML = e.fromKML, r.rect = e.rectangle, r.level = e.level, n.resolve(r), n
    }

    function s(e, t) {
        return Math.floor(Math.random() * (t - e + 1)) + e
    }

    function o(e, t) {
        var n = Cesium.when.defer(), s = [];
        return e.forEach(function (e) {
            s.push(i(e, t))
        }), Cesium.when.all(s, function (e) {
            var t = e[0].lenght, i = function (e, t) {
                return t.timeStamp - e.timeStamp
            };
            if (e.length === 1) n.resolve(e[0]); else {
                var s = e.sort(i), o = s.shift();
                s.forEach(function (e) {
                    o.forEach(function (t, n) {
                        t === r && e[n] !== r && (o[n] = e[n])
                    })
                }), n.resolve(o)
            }
        }), n
    }

    function u(e, t, n, r) {
        var i = 0, s = n + 1;
        return i |= r.getTileDataAvailable(2 * e, 2 * t, s) ? 1 : 0, i |= r.getTileDataAvailable(2 * e + 1, 2 * t, s) ? 2 : 0, i |= r.getTileDataAvailable(2 * e, 2 * t + 1, s) ? 4 : 0, i |= r.getTileDataAvailable(2 * e + 1, 2 * t + 1, s) ? 8 : 0, i
    }

    var t = !1, n = function (t) {
        if (!Cesium.defined(t)) throw new Cesium.DeveloperError("options is required.");
        this._errorEvent = new Cesium.Event, this._modelFloorMasks = {}, this._credit = t.credit, typeof this._credit == "string" && (this._credit = new Cesium.Credit(this._credit)), t.heightMapWidth = Cesium.defaultValue(t.heightMapWidth, 32), t.heightMapHeight = Cesium.defaultValue(t.heightMapHeight, 32), this._options = t, this.readyPromise = Cesium.when.resolve(!0), this._subdomains = t.subdomains, t.firstRequestUrl = t.url.replace("{s}", this.sTag(0, 0, 0)), this._firstRequest = t.firstRequestUrl + "?" + "request=GetMap&Version=1.3.0&Service=WMS&CRS=EPSG:4326&bbox=-90,-180,90,180&height=32&width=32&optimizedOnly=0&v=1&layers=" + t.layerName + "&Styles=&Format=image/mpt";
        var n = this, r = t.pngOnly;
        t.maxTerrainLevel !== undefined && isNaN(t.maxTerrainLevel) && (t.maxTerrainLevel = undefined), this._maxTerrainLevel = Cesium.defaultValue(t.maxTerrainLevel, TerraExplorer.__maxTerrainLevel), r ? n.setFormatMPT(!1) : $.ajax({
            url: this._firstRequest,
            success: function (e) {
                var t = Cesium.defined(e.childNodes) && e.childNodes.length > 0 ? !0 : !1;
                if (!!t || !!TerraExplorer.browser.isIE) return n.setFormatMPT(!1), null;
                n.setFormatMPT(!0)
            },
            error: function () {
                return n.setFormatMPT(!1), null
            },
            async: !1
        }), this._urlTemplate = t.url + "?" + "request=GetMap&Version=1.3.0&Service=WMS&v=1&CRS=EPSG:4326&bbox={south},{west},{north},{east}&height={height}&width={width}&optimizedOnly={optimizedOnly}&layers=" + t.layerName + "&Styles=&Format=image/" + this._format, this._allElevationLayers = null, this._tilingScheme = new Cesium.GeographicTilingScheme, this._levelZeroMaximumGeometricError = Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid, t.heightMapWidth * 4, this._tilingScheme.getNumberOfXTilesAtLevel(0)), this._workerPool = new e({workerPath: "./js/sfsterrainprovider/ParseElevationWorker.js"}), this._pendingRequests = 0, this._requestGridSize = 8, this._requestsCache = {}, this._requestsCacheKeys = [], this.errorEvent.addEventListener(function (e) {
        }, this)
    };
    const r = 1;
    return n._geometricErrorFactor = 2, Object.defineProperties(n.prototype, {
        errorEvent: {
            get: function () {
                return this._errorEvent
            }
        }, credit: {
            get: function () {
                return this._credit
            }
        }, hasVertexNormals: {
            get: function () {
                return !1
            }
        }, tilingScheme: {
            get: function () {
                return this._tilingScheme
            }
        }, ready: {
            get: function () {
                return !0
            }
        }, hasWaterMask: {
            get: function () {
                return !1
            }
        }, heightMapHeight: {
            get: function () {
                return this._options.heightMapHeight
            }
        }, heightMapWidth: {
            get: function () {
                return this._options.heightMapWidth
            }
        }, pendingRequests: {
            get: function () {
                return this._pendingRequests
            }
        }
    }), n.prototype.setFormatMPT = function (e) {
        if (e && this.pngOnly) return;
        var t = this._format;
        this._format = e ? "mpt" : "png";
        if (t === this._format) return;
        this._isMPT = e, this._urlTemplate !== undefined && (this._urlTemplate = this._urlTemplate.replace("image/" + t, "image/" + this._format))
    }, n.prototype.getLevelMaximumGeometricError = function (e) {
        return this._levelZeroMaximumGeometricError / (1 << e) * n._geometricErrorFactor
    }, n.prototype.createKeyFromTile = function (e, t, n) {
        return e + "_" + t + "_" + n
    }, n.prototype.getTileDataAvailable = function (e, t, n) {
        var r = Math.min(this._maxTerrainLevel, 25);
        return this._isMPT ? TerraExplorer.__useNotOptimizedSLTerrain16 ? undefined : !0 : n < r ? !0 : !1
    }, n.prototype.requestFactorForLevel = function (e) {
        var t = Math.log(this._requestGridSize) / Math.log(2);
        return t = Math.min(t, e), Math.pow(2, t)
    }, n.prototype.getRequestBaseTerrainUrl = function (e, t, n, r) {
        return this.getRequestUrl(e, t, n, r)
    }, n.prototype.getRequestElevationLayer = function (e, t, n) {
        return this.getRequestUrl(e, t, n, !1, !0)
    }, n.prototype.getRequestUrl = function (e, t, n, r, i) {
        var s = n, o = r != undefined ? this.requestFactorForLevel(n) : 1, e = r != undefined ? (e - e % o) / o : e,
            t = r != undefined ? (t - t % o) / o : t, n = r != undefined ? n - Math.log(o) / Math.log(2) : n,
            u = this.tilingScheme.tileXYToNativeRectangle(e, t, n), a = this.heightMapWidth * o === 256 && r ? 1 : 0;
        i && (a = 0);
        var f = this._urlTemplate.replace("{south}", u.south).replace("{north}", u.north).replace("{west}", u.west).replace("{east}", u.east).replace("{optimizedOnly}", a).replace("{width}", this.heightMapWidth * o).replace("{height}", this.heightMapHeight * o).replace("{s}", this.sTag(e, t, n));
        return f + "&level=" + n + "&origLevel=" + s
    }, n.prototype.isT_Inside_E = function (e, t) {
        return e.west >= t.west * Cesium.Math.DEGREES_PER_RADIAN && e.east <= t.east * Cesium.Math.DEGREES_PER_RADIAN && e.south >= t.south * Cesium.Math.DEGREES_PER_RADIAN && e.north <= t.north * Cesium.Math.DEGREES_PER_RADIAN ? !0 : !1
    }, n.prototype.isT_Intersects_E = function (e, t) {
        var n = e.west * Cesium.Math.RADIANS_PER_DEGREE, r = e.east * Cesium.Math.RADIANS_PER_DEGREE,
            i = e.south * Cesium.Math.RADIANS_PER_DEGREE, s = e.north * Cesium.Math.RADIANS_PER_DEGREE,
            o = new Cesium.Rectangle(n, i, r, s), u = Cesium.Rectangle.intersection(o, t, new Cesium.Rectangle);
        return u
    }, n.prototype.sTag = function (e, t, n) {
        if (this._subdomains == undefined) return "";
        var r = (e + t + n) % this._subdomains.length;
        return this._subdomains[r]
    }, n.prototype.refreshElevationLayer = function (e) {
        if (e.rectangle && viewer.scene.globe._surface._levelZeroTiles !== undefined) {
            var t = this.findDirectParent(e.rectangle, !0);
            t.freeResources()
        }
    }, n.prototype.findDirectParent = function (e, t) {
        var n = function (e, t, r) {
            var i = r ? 4.1 : 2.1;
            if (e._rectangle.width <= t.width * i && Cesium.Rectangle.contains(e._rectangle, Cesium.Rectangle.center(t))) return e;
            var s = e.children.length;
            for (var o = 0; o < s; o++) {
                var u = e.children[o];
                if (Cesium.Rectangle.contains(u._rectangle, Cesium.Rectangle.center(t))) return n(u, t, r)
            }
            return null
        };
        if (e.width == Math.PI) return null;
        for (var r = 0; r < viewer.scene.globe._surface._levelZeroTiles.length; r++) {
            var i = n(viewer.scene.globe._surface._levelZeroTiles[r], e, t);
            if (i) return i
        }
        return null
    }, n.prototype.isTileAvailable = function (e, t, n) {
        var r = this._tilingScheme.tileXYToRectangle(e, t, n, new Cesium.Rectangle), i = this.findDirectParent(r);
        if (i && i.data && i.data.terrainData) {
            if (!(i.data.terrainData._childTileMask > 0)) return !1;
            var s = i.children.length;
            for (var o = 0; o < s; o++) {
                var u = i.children[o];
                if (Cesium.Rectangle.equals(u._rectangle, r)) return i.data.terrainData._childTileMask & 1 << o
            }
        }
        return !0
    }, n.prototype.markTileAsUnavailable = function (e, t, n) {
        var r = this._tilingScheme.tileXYToRectangle(e, t, n, new Cesium.Rectangle), i = this.findDirectParent(r);
        i && i.data && i.data.terrainData && i.data.terrainData._childTileMask > 0 && $.each(i.children, function (e, t) {
            if (Cesium.Rectangle.equals(t._rectangle, r)) {
                switch (e) {
                    case 0:
                        i.data.terrainData._childTileMask &= -5;
                        break;
                    case 1:
                        i.data.terrainData._childTileMask &= -9;
                        break;
                    case 2:
                        i.data.terrainData._childTileMask &= -2;
                        break;
                    case 3:
                        i.data.terrainData._childTileMask &= -3;
                        break;
                    default:
                }
                return !1
            }
            return !0
        })
    }, n.prototype.requestBaseTerrainTileGeometry = function (e, t, n, r) {
        return this.requestTileGeometryBuffers(e, t, n, r)
    }, n.prototype.requestElevationLayerTileGeometry = function (e, t, n, r, i) {
        return this.requestTileGeometryBuffers(e, t, n, r, i)
    }, n.prototype.requestTileGeometryBuffers = function (e, n, r, i, s) {
        var o = this, u = 15, a = {};
        a.requestedRectangle = this.tilingScheme.tileXYToNativeRectangle(e, n, r), a.layer = s;
        var f, l, c, h, p = Cesium.when.defer(), f = this.requestTileHeightBuffer(e, n, r, i, undefined, s);
        return f === undefined ? undefined : (l = this.requestTileHeightBuffer(e + 1, n, r, i, !0, s), c = this.requestTileHeightBuffer(e, n + 1, r, i, !0, s), h = this.requestTileHeightBuffer(e + 1, n + 1, r, i, !0, s), Cesium.when.all([f, l, c, h], function (e) {
            if (t == 0) {
                if (e[0].myReject != undefined && e[0].myReject) {
                    p.reject();
                    return
                }
                var n = o.heightMapWidth + 1, r = o.heightMapHeight + 1, i = new Float32Array(n * r), s = e[0].isFloor;
                for (var f = 0; f < n; f++) for (var l = 0; l < r; l++) {
                    var c = f, h = l, d = 0;
                    l === n - 1 && (h = 0, d = 1, s && (d = 0, h = n - 2)), f === r - 1 && (c = 0, d = 2);
                    var v = f * n + l, m = c * o.heightMapWidth + h;
                    e[d] !== null && (e[d].myReject == undefined || !e[d].myReject) && (i[v] = e[d][m])
                }
                if (e[3].myReject == undefined || !e[3].myReject) i[n * r - 1] = e[3][0];
                var g = o.arrayToHeightmapTerrainData(i, n, r, u);
                a.buffer = g, p.resolve(a)
            } else {
                var g = o.arrayToHeightmapTerrainData(e[0], o.heightMapWidth, o.heightMapHeight);
                a.buffer = g, p.resolve(a)
            }
        }).otherwise(function () {
            p.reject()
        }), p)
    }, n.prototype.requestTileGeometry = function (e, t, n, r) {
        var i = this, s = [], o = i.tilingScheme.tileXYToNativeRectangle(e, t, n);
        this._allElevationLayers != null && this._allElevationLayers.length > 0 && n > 7 ? $(this._allElevationLayers).each(function (u, a) {
            var f = a.show;
            if (f) {
                var l = a.rectangle;
                i.isT_Inside_E(o, l) ? (i.setFormatMPT(!1), s.push(i.requestElevationLayerTileGeometry(e, t, n, r, a))) : i.isT_Intersects_E(o, l) != undefined ? (i.setFormatMPT(!1), s.push(i.requestElevationLayerTileGeometry(e, t, n, r, a)), s.push(i.requestBaseTerrainTileGeometry(e, t, n, r))) : (i.setFormatMPT(!0), s.push(i.requestBaseTerrainTileGeometry(e, t, n, r)))
            } else i.setFormatMPT(!0), s.push(i.requestBaseTerrainTileGeometry(e, t, n, r))
        }) : (i.setFormatMPT(!0), s.push(i.requestBaseTerrainTileGeometry(e, t, n, r)));
        var u = Cesium.when.defer();
        return Cesium.when.all(s, function (e) {
            if (e.length === 1) e.layer !== undefined && console.log("missing scale and offset"), u.resolve(e[0].buffer); else if (e.length > 1) {
                var t = $.grep(e, function (e) {
                    return e.layer !== undefined
                }), n = $.grep(e, function (e) {
                    return e.layer === undefined
                });
                if (t.length === 0) u.resolve(e[0].buffer); else {
                    var r = t[t.length - 1], s = n[n.length - 1], o = {
                        tolerance: r.layer.nullTolerance,
                        nullValueNumber: r.layer.nullValueNumber,
                        verticesX: r.layer.polygonVerticesX,
                        verticesY: r.layer.polygonVerticesY,
                        scale: Cesium.defaultValue(r.layer.scale, 1),
                        offset: Cesium.defaultValue(r.layer.offset, 0)
                    };
                    u.resolve(i.mergeBuffers(s.buffer, r.buffer, o, s.requestedRectangle))
                }
            } else u.reject()
        }).otherwise(function () {
            u.reject()
        }), u
    }, n.prototype.mergeBuffers = function (e, t, n, r) {
        var i, s, o, u, a, f = 33, l = 33, c = r.west, h = r.north, p = r.east, d = r.south, v = r.width / f,
            m = r.height / l, g = n.scale, y = n.offset, b = n.nullValueNumber, w = n.tolerance,
            E = b !== undefined && w !== undefined;
        if (E) var S = Cesium.defaultValue(n.nullValueNumber, 0), x = Cesium.defaultValue(Number(n.tolerance), 0);
        var T = new Float32Array(f * l);
        for (i = 0, a = h; i < l; i++, a += m) for (s = 0, u = c; s < f; s++, u += v) o = i * f + s, E ? T[o] = !t._buffer[o] || t._buffer[o] >= S - x && t._buffer[o] <= S + x ? e._buffer[o] : t._buffer[o] * g + y : T[o] = t._buffer[o] ? t._buffer[o] * g + y : e._buffer[o];
        return this.arrayToHeightmapTerrainData(T, f, l, 15)
    }, n.prototype.requestTileHeightBuffer = function (e, n, r, i, u, a) {
        var f = this;
        if (isNaN(e + n + r)) return;
        if (!Cesium.defined(i) || i === !1) i = new Cesium.Request({defer: !0});
        var l = i.defer == 0;
        u = Cesium.defaultValue(l, !1);
        var c = Cesium.when.defer();
        if (t == 0) {
            var h;
            if (a !== undefined) a.getUrlFromSTag = function (e, t, n) {
                return a.subdomains === undefined ? a.url : a.subdomains[0] + "/SG"
            }, h = this.getRequestElevationLayer(e, n, r).replace(this._options.url, a.getUrlFromSTag(e, n, r) + "/Elevation").replace(this._options.layerName, a.name), a.format === "mpt" && (h = h.replace("image/png", "image/mpt")); else {
                h = this.getRequestBaseTerrainUrl(e, n, r, l || u);
                var p = viewer.terrainProvider.tilingScheme.tileXYToRectangle(e, n, r),
                    d = viewer.terrainProvider._modifyTerrainObjects, v = Cesium.when.defer();
                if (d !== undefined) {
                    var m = [];
                    d.forEach(function (e) {
                        e.show && Cesium.Rectangle.intersection(p, e.rectangle, new Cesium.Rectangle) != undefined && m.push(e)
                    });
                    if (m.length > 0) if (m.length === 1 && m[0].modelFloorBestLevel && r > m[0].modelFloorBestLevel) v.resolve("NoMerge"); else {
                        var g = o(m, p, r);
                        Cesium.when(g, function (e) {
                            v.resolve(e)
                        }).otherwise(function (e) {
                            console.log(e);
                            debugger
                        })
                    } else v.resolve("NoMerge")
                } else v.resolve("NoMerge");
                var y = Cesium.when.defer(), b = $.grep(TerraExplorer.internal.Project.MeshLayers, function (e) {
                    return e._selectedTiles.length > 0
                });
                if (b.length === 1 && b[0].level && r > b[0].level) y.resolve("NoFloor"); else {
                    var w = !1, E = 32, S = 65535;
                    b.forEach(function (e) {
                        if (e.ready && e.show && e.rootFloorRectangle !== undefined && Cesium.Rectangle.intersection(p, e.rootFloorRectangle) !== undefined) {
                            var t = new Uint16Array(E * E), n = p.west, r = p.south, i = (p.east - p.west) / 32,
                                s = (p.north - p.south) / 32, o;
                            for (var u = 0; u < E; u++) for (var a = 0; a < E; a++) {
                                var f = n + i * a + i / 2, l = p.north - s * u - s / 2,
                                    c = new Cesium.Cartographic(f, l);
                                o = S;
                                var h = e.getHRMTFP(e, c, !0);
                                h != undefined && h.content && h.content._model && h.content._model.floor && (o = h.content._model.floor.getHeight(c.longitude, c.latitude)), o !== S ? (o += 1.5, t[u * E + a] = o) : t[u * E + a] = o
                            }
                            w = !0, y.resolve(t)
                        }
                    }), w || y.resolve("NoFloor")
                }
                var x = viewer.scene.globe.ellipsoid
            }
            if (this._requestsCache.hasOwnProperty(h) === !1) {
                this._requestsCache[h] = {}, this._requestsCacheKeys.push(h);
                if (this._requestsCacheKeys.length > 100) {
                    for (var T = 0; T < 50; T++) delete this._requestsCache[this._requestsCacheKeys[T]];
                    this._requestsCacheKeys.splice(0, 50)
                }
            } else {
                var N = this._requestsCacheKeys.indexOf(h);
                this._requestsCacheKeys.splice(N, 1), this._requestsCacheKeys.push(h)
            }
            var C = this._requestsCache[h];
            if (C.dataLoaded === undefined) {
                l ? C.dataLoaded = Cesium.Resource.fetchArrayBuffer(h) : C.dataLoaded = Cesium.Resource.fetchArrayBuffer(h);
                if (!Cesium.defined(C.dataLoaded)) return undefined
            }
            var k = this;
            this._pendingRequests++, Cesium.when(C.dataLoaded, function (t) {
                C.workerFinished === undefined && (C.workerFinished = k._workerPool.queueWorkItem({
                    buffer: t,
                    isElevation: a !== undefined,
                    level: r
                })), Cesium.when.all([C.workerFinished, v, y], function (t) {
                    var i = t[1] !== undefined && t[1] !== "NoMerge", s = t[2] !== undefined && t[2] !== "NoFloor";
                    if (!!t[0].rejected) {
                        var l = k.heightMapWidth * k.heightMapHeight, h = new Int16Array(l), p = 0;
                        for (var u = 0; u < l; u++) h[u] = 300;
                        return r > 2 && (h.myReject = !0), c.resolve(h), c
                    }
                    var o = k.extractTileHeightBuffer(t[0].buffer, e, n, r);
                    k._pendingRequests--;
                    if (i) for (var u = 0; u < 32; u++) for (var a = 0; a < 32; a++) {
                        var f = u * 32 + a;
                        t[1].fromKML ? o[f] = t[1][f] === 1 ? o[f] : t[1].mtType == 1 ? o[f] + t[1].mtHeight : t[1].mtType == 2 ? Math.min(o[f], t[1].mtHeight) : t[1].mtType == 3 ? Math.max(o[f], t[1].mtHeight) : t[1].mtHeight : o[f] = t[1][f] === 1 ? o[f] : t[1].mtType == 1 ? o[f] + t[1][f] : t[1].mtType == 2 ? Math.min(o[f], t[1][f]) : t[1].mtType == 3 ? Math.max(o[f], t[1][f]) : t[1][f]
                    }
                    if (s) {
                        for (var u = 0; u < 32; u++) for (var a = 0; a < 32; a++) {
                            var f = u * 32 + a;
                            o[f] = t[2][f] === 65535 || t[2][f] > 10500 ? o[f] : t[2][f]
                        }
                        o.isFloor = !0
                    }
                    c.resolve(o)
                }).otherwise(function () {
                    var e = k.heightMapWidth * k.heightMapHeight, t = new Int16Array(e), n = 0;
                    for (var i = 0; i < e; i++) t[i] = 300;
                    return r > 2 && (t.myReject = !0), c.resolve(t), c
                })
            }).otherwise(function () {
                k._pendingRequests--, c.reject()
            })
        } else {
            var L = this.heightMapWidth * this.heightMapHeight, A = new Int16Array(L), O = s(0, 1500);
            for (var T = 0; T < L; T++) A[T] = O;
            c.resolve(A)
        }
        return c
    }, n.prototype.extractTileHeightBuffer = function (e, t, n, r) {
        try {
            var i = this.requestFactorForLevel(r), s = t % i, o = n % i,
                u = new Float32Array(this.heightMapWidth * this.heightMapHeight), a = 1e6, f = -1e5;
            for (var l = 0; l < this.heightMapHeight; l++) for (var c = 0; c < this.heightMapWidth; c++) {
                var h = l + o * this.heightMapHeight, p = c + s * this.heightMapWidth, d = l * this.heightMapWidth + c,
                    v = h * this.heightMapWidth * i + p;
                e[v] > f && (f = e[v]), e[v] < a && (a = e[v]), u[d] = e[v]
            }
        } catch (m) {
            console.log(m.message)
        }
        return u
    }, n.prototype.arrayToHeightmapTerrainData = function (e, t, n, r) {
        Cesium.defined(e) === !1 && (e = new Int16Array(t * n));
        var i = {buffer: e, width: t, height: n, childTileMask: r};
        return new Cesium.HeightmapTerrainData(i)
    }, n
}), define("KmlParser", ["jquery", "./TELang", "./wfs/Layer", "./internal/TEPosition", "./tools/MenuButton", "./internal/StatusBar", "./internal/Units", "./internal/SearchBox", "./internal/NavigationControl", "./internal/Settings", "./tools/SideBar"], function (e, t, n, r, i, s, o, u, a, f, l) {
    "use strict";

    function h(e) {
        switch (e.toLowerCase().trim()) {
            case"true":
            case"yes":
            case"1":
                return !0;
            case"false":
            case"no":
            case"0":
            case null:
                return !1;
            default:
                return Boolean(e)
        }
    }

    function v(e) {
        var t = Number(e);
        return isNaN(t) ? undefined : t
    }

    function m(e) {
        return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1")
    }

    function g(e, t, n) {
        return e.replace(new RegExp(m(t), "g"), n)
    }

    function y(e) {
        var t = e.replace(/([^a-zA-Z])and([^a-zA-Z])/gi, "$1 && $2");
        return t = t.replace(/([^a-zA-Z])or([^a-zA-Z])/gi, "$1 || $2"), t = t.replace(/([^=!<>])=([^=!<>])/g, "$1 == $2"), t = g(t, " <> ", " != "), t = g(t, "=<", "<="), t = g(t, "=>", ">="), t
    }

    function b(t) {
        var n;
        if (t.indexOf("<<") === 0 && t.lastIndexOf(">>") === t.length - 2) n = t.substring(2, t.length - 2); else {
            var r = /(\<([^\>]+)\>)/g, i = r.exec(t);
            i !== null && (n = i[i.length - 1])
        }
        if (n !== undefined) {
            n = y(n);
            var s = [], o, u = [], r = /(\[([^\]]+)\])/gi, i = r.exec(n);
            while (i !== null) {
                var a = i[i.length - 1];
                if (s.indexOf(a) === -1) {
                    var f = i[0];
                    n.charAt(i.index - 1) === '"' && n.charAt(i.index + i[0].length) === '"' && (f = '"' + f + '"'), s.push(a)
                }
                i = r.exec(n)
            }
            var l = n;
            e.each(s, function (e, t) {
                var n = "_arg__" + e;
                l = g(l, "[" + t + "]", n), l = g(l, '"' + n + '"', n)
            });
            var c = "return " + l + ";";
            return s.length === 1 ? o = new Function("_arg__0", c) : s.length === 2 ? o = new Function("_arg__0", "_arg__1", c) : s.length === 3 ? o = new Function("_arg__0", "_arg__1", "_arg__2", c) : s.length === 4 ? o = new Function("_arg__0", "_arg__1", "_arg__2", "_arg__3", c) : console.log("Classification with more than 4 attributes is not supported"), {
                condition: "<" + n + ">",
                attributeNames: s,
                func: o
            }
        }
        return {condition: t}
    }

    var c = function (e, t) {
        function n(e) {
            return (e & 255) << 24 | (e & 65280) << 8 | e >> 8 & 65280 | e >> 24 & 255
        }

        function r(e) {
            var t = e.length, n = 0, r = [t];
            while (n < t) r[t - n - 1] = e[n], ++n;
            return r.toString().replace(/,/g, "")
        }

        if (e.length > 0) {
            var i;
            if (t) {
                if (e[0].nodeName === "color") {
                    var s = "#" + r(e.text());
                    return s = s.substring(0, 7), i = Cesium.Color.fromCssColorString(s), i
                }
                if (!isNaN(e.text())) {
                    var o = Number(e.text()).toString(16);
                    if (o.length < 6 && o != undefined) {
                        var u = o.length;
                        while (u < 6) o = "0" + o, u++
                    }
                    var s = "#" + o;
                    i = Cesium.Color.fromCssColorString(s);
                    if (i != undefined) {
                        var a = i.red;
                        i.red = i.blue, i.blue = a
                    }
                    return i
                }
                i = e.text()
            } else i = e.text();
            return i
        }
        return undefined
    };
    const p = {low: 16 / .75, normal: 16, high: 12.8, best: 16 / 1.5};
    var d = function () {
        this._domains = {}, this._locations = null, this._featureLayers = null, this._rasterLayers = null, this._elevationLayers = null, this._meshLayers = null, this._cptLayers = null, this._kmlLayers = null, this._modifyTerrainObjects = null, this._holeOnTerrainObjects = null, this._videoOnTerrainObjects = null, this._tours = null, this._startPosition = null, this._domainsKml = null, this._nameOfDomain = null, this._unsupportedLayers = new Array, this.depthTestAgainstTerrain = !0, this.startupProjectKMLParsing = !1, this.allowAttributeEditing = !0, this.disableFixedLocalTime = !1, this._userScript = null
    };
    return Cesium.defineProperties(d.prototype, {
        FeatureLayers: {
            get: function () {
                return this._featureLayers
            }
        }, RasterLayers: {
            get: function () {
                return this._rasterLayers
            }
        }, ElevationLayers: {
            get: function () {
                return this._elevationLayers
            }
        }, MeshLayers: {
            get: function () {
                return this._meshLayers
            }
        }, CPTLayers: {
            get: function () {
                return this._cptLayers
            }
        }, ModifyTerrainObjects: {
            get: function () {
                return this._modifyTerrainObjects
            }
        }, HoleOnTerrainObjects: {
            get: function () {
                return this._holeOnTerrainObjects
            }
        }, VideoOnTerrainObjects: {
            get: function () {
                return this._videoOnTerrainObjects
            }
        }, Locations: {
            get: function () {
                return this._locations
            }
        }, Tours: {
            get: function () {
                return this._tours
            }
        }, UnsupportedLayers: {
            get: function () {
                return this._unsupportedLayers
            }
        }, Subdomains: {
            get: function () {
                return this._nameOfDomain ? this._domains[this._nameOfDomain] : this._domains["http://www.skylineglobe.com"]
            }
        }
    }), d.prototype.loadConfig = function (t) {
        this._domainsKml = t;
        var n = function (e) {
            return e.length > 0 ? e.text() : undefined
        }, r = function (e) {
            return e.length > 0 ? e.text() === "true" : undefined
        };
        this._userScript = n(e(t).find("sx\\:userScript, userScript")), this.depthTestAgainstTerrain = r(e(t).find("sx\\:depthTestAgainstTerrainNEW, depthTestAgainstTerrainNEW")), i.layout = {};
        var o = r(e(t).find("sx\\:LoadLayersID, LoadLayersID"));
        i.layout.loadLayersButton = o == undefined ? !0 : o;
        var a = Number(n(e(t).find("sx\\:maxTerrainLevel, maxTerrainLevel")));
        this.maxTerrainLevel = isNaN(a) ? 16 : a, this.useNotOptimizedSLTerrain16 = r(e(t).find("sx\\:useNotOptimizedSLTerrain16, useNotOptimizedSLTerrain16")), this.startupProjectKMLParsing = r(e(t).find("sx\\:startupProjectKMLParsing, startupProjectKMLParsing"));
        var c = n(e(t).find("sx\\:allowAttributeEditing, allowAttributeEditing"));
        f.allowAttributeEditing = c ? c : !0, this.disableFixedLocalTime = r(e(t).find("sx\\:disableFixedLocalTime, disableFixedLocalTime"));
        if (window.SGUrl === undefined) {
            var h = window.location.pathname.indexOf("/") == 0 ? window.location.pathname.substring(1) : window.location.pathname;
            h = h.substring(0, h.indexOf("/")), f.baseConnectionUrl = window.location.protocol + "//" + window.location.host + "/" + h, f.connectionUrl = f.baseConnectionUrl + TerraExplorer.getCurrentSitePath() + "/"
        } else f.baseConnectionUrl = window.SGUrl, f.connectionUrl = window.SGUrl;
        f.cookieString = "";
        var p = n(e(t).find("sx\\:userName, userName"));
        p != undefined && p != "" ? f.userConnection = p : (f.userConnection = "Guest", f.cookieString = "");
        var d = n(e(t).find("sx\\:password, password"));
        d != undefined && d != "" ? f.passwordConnection = d : (f.passwordConnection = "", f.cookieString = ""), f.saveSettings();
        var v = e(t).find("sx\\:Layout, Layout");
        if (v.length <= 0) return;
        l.Visibility = !0;
        var m = v.find("sx\\:SearchBox, SearchBox");
        if (m.length > 0) {
            var g = n(m.find("sx\\:searchProvider, searchProvider"));
            g && (u.SearchServer = g);
            var y = r(m.find("visibility"));
            y && (u.Visibility = y), g === "" && l.RemoveSectionFromSideBar("#searchBox")
        }
        var b = v.find("sx\\:StatusBar, StatusBar");
        if (b.length > 0) {
            var y = r(b.find("visibility"));
            y != undefined && (s.Visibility = y);
            var w = r(b.find("sx\\:displayLocation, displayLocation"));
            w != undefined && (s.DisplayLocation = w);
            var E = n(b.find("sx\\:copyrightText, copyrightText"));
            E && (s.Copyright = E)
        }
        i.Visibility = !0;
        var S = n(v.find("sx\\:MenuButton sx\\:iconUrl, MenuButton"));
        S && (i.Image = S);
        var x = r(v.find("sx\\:AppMenu sx\\:analysisQueryMenu, AppMenu"));
        x != undefined && (i.ShowQueryTool = x);
        var T = r(v.find("sx\\:AppMenu sx\\:analysisDistanceMenu, AppMenu"));
        T != undefined && (i.ShowAnalysisDistance = T);
        var N = r(v.find("sx\\:AppMenu sx\\:analysisAreaMenu, AppMenu"));
        N != undefined && (i.ShowAnalysisArea = N);
        var C = r(v.find("sx\\:AppMenu sx\\:analysisVolumeMenu, AppMenu"));
        C != undefined && (i.ShowAnalysisVolume = C);
        var k = r(v.find("sx\\:AppMenu sx\\:analysisProfileMenu, AppMenu"));
        k != undefined && (i.ShowAnalysisProfile = k);
        var L = r(v.find("sx\\:AppMenu sx\\:analysisShadowMenu, AppMenu"));
        L != undefined && (i.ShowShadowTool = L);
        var A = r(v.find("sx\\:AppMenu sx\\:layersMenu, AppMenu"));
        A != undefined && (i.ShowLayers = A);
        var O = r(v.find("sx\\:AppMenu sx\\:placesMenu, AppMenu"));
        O != undefined && (i.ShowPlaces = O);
        var M = r(v.find("sx\\:AppMenu sx\\:undergroundMenu, AppMenu"));
        M != undefined && (i.ShowUnderground = M);
        var _ = r(v.find("sx\\:AppMenu sx\\:settingsMenu, AppMenu"));
        _ != undefined && (i.ShowSettings = _);
        var D = e(t).find("ScreenOverlay");
        if (D.length > 0 && r(D.find("visibility")) == 1) {
            var P = n(D.find("Icon href")), H = D.find("overlayXY"), B = D.find("screenXY");
            if (P && P.trim().length > 0 && H.length > 0 && B.length > 0) {
                var j = H.attr("xunits"), F = H.attr("yunits");
                if (j == "fraction" && F == "fraction") {
                    var I = H.attr("y"), q = B.attr("x"), R = B.attr("y"),
                        U = e("<img src='" + this.buildCacheBypassUrl(P) + "' style='position:absolute; right:" + q + "px;'/>");
                    I == 0 ? U.css({top: Number(R)}) : U.css({bottom: Number(R)}), e("body").append(U)
                }
            }
        }
        TerraExplorer.tilesetVerticalDatumFlag = n(e(t).find("sx\\:tilesetVerticalDatum, tilesetVerticalDatum"))
    }, d.prototype.buildCacheBypassUrl = function (e) {
        if (!e) return undefined;
        var t = e + (e.match("[?]") ? "&" : "?") + "rnd=" + (new Date).getTime();
        return t
    }, d.prototype.loadFromData = function (e) {
        this.loadDomains(this._domainsKml), this.loadLayers(e), this.loadLocations(e), this.loadTours(e), this.loadStartPosition(e), this.startupProjectKMLParsing && viewer.dataSources.add(Cesium.KmlDataSource.load(e, {
            camera: viewer.camera,
            canvas: viewer.canvas
        })), viewer.scene.globe.depthTestAgainstTerrain = this.depthTestAgainstTerrain == 0 ? !1 : !0, this.disableFixedLocalTime && (TerraExplorer.internal.FixedLocalTime.Enable = !1)
    }, d.prototype.loadDomains = function (t) {
        var n = this, r = e(t).find("sx\\:Domain, Domain");
        r.length ? (this._nameOfDomain = e(r).attr("name"), r.each(function (t, r) {
            var i = e(r).attr("name");
            if (i != undefined) {
                n._domains[i] = [i];
                var s = e(r).find("sx\\:subdomain, subdomain");
                s.each(function (t, r) {
                    n._domains[i].push(e(r).text())
                })
            }
        }), f.Subdomains = this._domains[this._nameOfDomain]) : f.Subdomains = this._domains["http://www.skylineglobe.com"]
    }, d.prototype.replaceDomainWithTag = function (t) {
        if (t == undefined) return {url: t, subdomains: undefined};
        var n = this;
        if (Object.keys(n._domains).length == 0) {
            var r = TerraExplorer.internal.Settings.Subdomains;
            if (!Cesium.defined(r)) return {url: t, subdomains: undefined};
            r.length > 0 && (n._domains[r[0]] = r)
        }
        var i = [];
        return e.each(n._domains, function (n, r) {
            t.indexOf(n + ":") != -1 || t.indexOf(n + "/") != -1 ? (t = t.replace(n, "{s}"), i = r) : e.each(r, function (e, n) {
                if (t.indexOf(n + ":") != -1 || t.indexOf(n + "/") != -1) t = t.replace(n, "{s}"), i = r
            })
        }), {url: t, subdomains: i.length > 0 ? i : undefined}
    }, d.prototype.loadLayers = function (e) {
        this.loadFeatureLayers(e), this.loadRasterLayers(e), this.loadKmlLayers(e), this.loadMeshLayers(e), this.loadCPTLayers(e), this.loadModifyTerrainObj(e), this.loadHoleOnTerrainObj(e), this.loadVideoOnTerrainObj(e)
    }, d.prototype.loadFeatureLayers = function (t) {
        var n = e(t).find("sx\\:FeatureLayer, FeatureLayer"), r = this._featureLayers = new Array, i = this;
        n.each(function (n, r) {
            var s = e(r), u = s.children("sx\\:suggestedBlockWidth");
            u = parseInt(u.length > 0 ? u.text() : "1222");
            var a = s.find("visibility").length,
                f = a == 1 ? Number(s.find("visibility").text()) : a > 1 ? Number(e(s.find("visibility")[0]).text()) : 1,
                l = s.find("Link href").text(), c = i.replaceDomainWithTag(l), h = {
                    displayName: s.children("name").text(),
                    url: c.url,
                    name: s.find("Link sx\\:layerName, layerName").text(),
                    visibility: f,
                    style: i.convertLayerStyle(s, t),
                    level: o.blockWidthToTeLayerLevel(u),
                    subdomains: c.subdomains,
                    indexInProjectTree: n,
                    fromKML: !0
                }, p = s.find("sx\\:startLocation,startLocation");
            p.length > 0 && (h.startLocation = !0);
            var d = TerraExplorer.SGWorld.Creator.isLayerSupported(l, h.name, "WFS", !1);
            d.isSupported ? i._featureLayers.push(h) : (h.latLon = !1, h.isSupported = !1, h.reason = d.reason, i._unsupportedLayers.push(h))
        })
    }, d.prototype.findStyle = function (t, n) {
        var r = t.children("Style");
        if (r.length <= 0) {
            var i = t.children("sx\\:FeatureGroup");
            if (!(i.length > 0)) return r;
            var s = i.children("styleUrl");
            if (s.length <= 0) return r;
            var o, u = s.text().split("#");
            for (var a = 0; a < u.length; a++) {
                o = u[a];
                if (u[a] != "" && !u[a].toLowerCase().startsWith("annotation")) break
            }
            if (o.indexOf("\\") >= 0 && o.indexOf("\\\\") < 0) {
                var f = o.split("\\");
                o = f.join("\\\\")
            }
            r = e(n).find("Style[id='" + o + "']");
            if (r.length <= 0) return r
        }
        return r
    }, d.prototype.convertLayerStyle = function (t, n) {
        var r = this.findStyle(t, n), i = r.length > 0, s = t.children("sx\\:geometryType"), o = null;
        if (s.length <= 0) {
            o = t.children("sx\\:FeatureGroup");
            if (!(o.length > 0)) return {};
            if (o.length == 1) s = o.children("sx\\:geometryType"); else for (var u = 0; u < o.length; u++) {
                var a = e(o[u]).children("sx\\:annotation");
                if (a.length == 0) {
                    s = e(o[u]).children("sx\\:geometryType");
                    break
                }
            }
        }
        var f = {};
        i && s.text() == "Polygons" ? f = this.readPolygonStyle(r) : i && s.text() == "Polylines" ? f = this.readPolylineStyle(r) : s.text() == "Points" && (i ? f = this.readPointStyle(r) : f = this.readModelTag(t)), f == undefined && (console.log("Could not read style for layer '" + t.find("Link sx\\:layerName, layerName").text() + "'"), f = {}), o != null ? (f.altitudeMethod = Number(c(r.children("sx\\:Altitude_Method"))), f.altitudeOffset = this.readClassification(r, "sx:Altitude")) : (f.altitudeMethod = Number(c(t.children("sx\\:Altitude_Method"))), f.altitudeOffset = this.readClassification(t, "sx:Altitude")), f.altitudeOffset == undefined && (f.altitudeOffset = 0);
        if (isNaN(f.altitudeMethod) || f.altitudeMethod == undefined) f.altitudeMethod = TerraExplorer.internal.TEPosition.ATC_TERRAIN_ABSOLUTE;
        return f.tooltip = this.readClassification(r, "sx:Tool_Tip"), f.messageLink = this.readMessageLinks(r), f
    }, d.prototype.readPolygonStyle = function (t) {
        var n = !0, r = Number(c(t.children("sx\\:Line_Width"))), i = this.readClassification(t, "sx:Line_Width");
        isNaN(r) && (r = Number(c(t.find("width"))), isNaN(r) ? r = 1 : n = !1);
        var s, o, u, a, f;
        if (n) var l = e(t).find("s"), h = {
            polygon: {
                outlineColor: this.readClassification(t, "sx:Line_Color"),
                outlineWidth: i,
                fill: this.readClassification(t, "sx:Fill_Opacity"),
                outline: this.readClassification(t, "sx:Line_Opacity"),
                material: this.readClassification(t, "sx:Fill_Color"),
                extrudedHeight: v(c(t.children("sx\\:Extend_to_Ground"))) == 1 ? 0 : undefined,
                fromKml: !0
            }
        }; else var o = c(t.find("LineStyle").children("width")), s = c(t.find("LineStyle").children("color"), !0),
            f = c(t.find("PolyStyle").children("color")), u = v(c(t.find("PolyStyle").children("fill"))),
            a = v(c(t.find("PolyStyle").children("outline"))),
            h = {polygon: {outlineColor: s, outlineWidth: o, fill: u, outline: a, material: f}};
        return h
    }, d.prototype.readPolylineStyle = function (e) {
        var t = !0, n = this.readClassification(e, "sx:Line_Width");
        n == undefined && (n = Number(c(e.find("LineStyle").children("width"))), t = !1);
        var r;
        if (t) {
            r = this.readClassification(e, "sx:Line_Color");
            var i = this.readClassification(e, "sx:Line_Opacity"),
                s = this.readClassification(e, "sx:Extend_to_Ground"), o = this.readClassification(e, "sx:Fill_Color"),
                u = this.readClassification(e, "sx:Fill_Opacity"), a = Number(c(e.children("sx\\:Line_Back_Opacity"))),
                f = this.readClassification(e, "sx:Max._Visibility_Distance"),
                l = this.readClassification(e, "sx:Min._Visibility_Distance")
        } else r = c(e.find("LineStyle").children("color"), !0);
        var h = {
            polyline: {
                material: r,
                width: n,
                lineOpacity: i,
                extendToGround: s,
                fillColor: o,
                wallAlpha: u,
                widthInMeters: !1,
                backgroundOpacity: a,
                maxVisibilityDistance: f,
                minVisibilityDistance: l
            }
        };
        return h
    }, d.prototype.readClassification = function (t, n) {
        var r = n.toLowerCase().indexOf("color") != -1, i, s = {}, o = e.grep(t.children(), function (e) {
            return e.nodeName == n
        });
        if (o != undefined) {
            if (r) var u = e(o);
            o = c(e(o));
            if (o == undefined) return undefined;
            if (o.indexOf("Classification") == -1) {
                s.defaultValue = r ? c(u, !0) : o;
                if (typeof s.defaultValue == "string") {
                    var a = /(\[([^\]]+)\])/gi, f = a.exec(s.defaultValue);
                    f !== null && (i = b(s.defaultValue), i.func !== undefined ? s.classification = i : (s.attributeName = f[f.length - 1], f = a.exec(s.defaultValue), f !== null && (s.multipleAttributeReplacementNeeded = !0)))
                }
            } else s.classificationArray = [], e(o).find("Class").each(function (t, n) {
                var o = c(e(n).children("condition"));
                i = b(o);
                var u = r ? c(e(n).children("value"), !0) : c(e(n).children("value"), !1);
                i.value = u, i.func !== undefined && (s.classificationArray[i.condition] = i)
            }), s.defaultValue = r ? c(e(o).find("defaultValue"), !0) : c(e(o).find("defaultValue"), !1)
        }
        return s
    }, d.prototype.readFeatureLayerLabelStyle = function (e) {
        var t = this.readClassification(e, "sx:Scale"), n = this.readClassification(e, "sx:Text_Color"),
            r = this.readClassification(e, "sx:Min._Viewing_Height"), i = this.readClassification(e, "sx:Limit_Growth"),
            s = this.readClassification(e, "sx:Text_Size"), o = this.readClassification(e, "sx:Font"),
            u = this.readClassification(e, "sx:Background_Color"),
            a = this.readClassification(e, "sx:Background_Opacity"), f = this.readClassification(e, "sx:Italic"),
            l = this.readClassification(e, "sx:Bold"), c = this.readClassification(e, "sx:Underline"),
            h = this.readClassification(e, "sx:Image_file"),
            p = this.readClassification(e, "sx:Text_Relative_to_Image"), d = this.readClassification(e, "sx:Show_Text"),
            v = this.readClassification(e, "sx:Text_Alignment"), m = this.readClassification(e, "sx:Text"), g = {
                label: {
                    text: m,
                    scaleMPP: t,
                    fillColor: n,
                    scaleByDistance: new Cesium.NearFarScalar(150, 1, 8e6, 0),
                    minViewingHeight: r,
                    font: s,
                    family: o,
                    backgroundColor: u,
                    backgroundOpacity: a,
                    italic: f,
                    bold: l,
                    underline: undefined,
                    limitGrowth: i,
                    imageFile: h,
                    textRelativeToImage: p,
                    showText: d,
                    textAlignment: v
                }
            };
        return g
    }, d.prototype.readPointStyle = function (t) {
        var n = {};
        try {
            var r = t.children("IconStyle");
            if (r.length > 0) n = this.readIconStyle(r, !1); else {
                var i = t.children("LabelStyle");
                if (i.length > 0) n = this.readLabelStyle(i); else {
                    var s = t.children("sx\\:Image_file") || t.children("sx\\:image_file"), o = t.children("sx\\:Text");
                    s.length > 0 && o.length == 0 ? n = this.readIconStyle(t, !0) : o.length > 0 ? n = this.readFeatureLayerLabelStyle(t) : n = this.readLabelStyle()
                }
            }
            var u = {
                lineToGround: this.readClassification(t, "sx:Line_to_Ground"),
                lineToGroundLength: this.readClassification(t, "sx:Line_Length"),
                lineToGroundColor: this.readClassification(t, "sx:Line_Color")
            };
            e.extend(n, u)
        } catch (a) {
            return undefined
        }
        return n
    }, d.prototype.readModelTag = function (e) {
        var t = e.children("Model");
        if (t.length > 0) {
            var n = {
                model: {
                    uri: c(t.children("Link")),
                    scale: Cesium.defaultValue(c(t.find("Scale x")), 1),
                    heading: Cesium.defaultValue(c(t.find("Orientation heading")), 0),
                    pitch: Cesium.defaultValue(c(t.find("Orientation tilt")), 0),
                    roll: Cesium.defaultValue(c(t.find("Orientation roll")), 0)
                }
            };
            return n
        }
        return {}
    }, d.prototype.readIconStyle = function (e, t) {
        if (t) var n = this.readClassification(e, "sx:Image_Color"), r = this.readClassification(e, "sx:Image_file"),
            i = this.readClassification(e, "sx:Image_Opacity"),
            s = this.readClassification(e, "sx:Min._Viewing_Height"), o = this.readClassification(e, "sx:Scale"),
            u = this.readClassification(e, "sx:Limit_Growth"), a = {
                billboard: {
                    color: c(e.children("sx\\:Image_Color"), !0),
                    image: r,
                    imageColor: n,
                    imageOpacity: i,
                    scaleTE: o,
                    limitGrowth: u,
                    minViewingHeightObj: s
                }
            }; else var a = {billboard: {color: c(e.children("color"), !0), image: c(e.find("Icon href"))}};
        return a
    }, d.prototype.readLabelStyle = function (e) {
        var n;
        return e === undefined ? n = {label: {text: t.i18n("viewshed_display_X")}} : n = {
            label: {
                text: c(e.children("sx\\:text")),
                fillColor: c(e.children("color"), !0),
                scale: Number(c(e.children("scale")))
            }
        }, n
    }, d.prototype.loadLocations = function (t) {
        var n = e(t).find("Placemark:has(LookAt)"), r = this, i = this._locations = new Array;
        n.each(function (n, s) {
            var o = e(s), u = o.children("LookAt"), a = r.findStyle(o, t), f = {
                id: o.attr("id"),
                name: o.children("name").text(),
                tePosition: r.tePositionFromCameraOrLookAt(u),
                image: a.length > 0 ? a.find("iconStyle Icon href").text() : undefined
            }, l = e(s).find("sx\\:startLocation,startLocation");
            l.length > 0 && (f.startLocation = !0), i.push(f)
        })
    }, d.prototype.tePositionFromCameraOrLookAt = function (e) {
        var t = e.children("range") ? e.children("range").text() : 0, n = new r({
            cartesian: Cesium.Cartesian3.fromDegrees(Number(e.children("longitude").text()), Number(e.children("latitude").text()), Number(e.children("altitude").text())),
            headingPitchRange: new Cesium.HeadingPitchRange(Cesium.Math.toRadians(e.children("heading").text()), Cesium.Math.toRadians(-90 + Number(e.children("tilt").text())), Number(t)),
            altitudeType: e.children("altitudeMode").text() == "relativeToGround" ? r.ATC_TERRAIN_RELATIVE : r.ATC_TERRAIN_ABSOLUTE
        });
        return n
    }, d.prototype.loadRasterLayers = function (t) {
        var n = e(t).find("sx\\:RasterLayer, RasterLayer"), r = this._rasterLayers = new Array, i = this,
            s = e(t).find("Style");
        n.each(function (n, r) {
            var o = e(r), u = !1;
            if (r.parentNode.nodeName.indexOf("Terrain") == -1) {
                var a = o.find("sx\\:elevation,elevation");
                a.length > 0 && c(a) != "0" && (u = !0);
                var f = 1, l = i.findStyle(o, t);
                if (l.length > 0) {
                    var h = i.readPolygonStyle(l);
                    f = h && h.polygon && h.polygon.material && h.polygon.material.alpha ? h.polygon.material.alpha : 1
                }
                var p = undefined, d = o.find("sx\\:BoundingBox, BoundingBox");
                if (d.length > 0) {
                    var v = Math.min(parseFloat(d.children("sx\\:minY").text()), parseFloat(d.children("sx\\:maxY").text())),
                        m = Math.max(parseFloat(d.children("sx\\:minY").text()), parseFloat(d.children("sx\\:maxY").text()));
                    p = Cesium.Rectangle.fromDegrees(d.children("sx\\:minX").text(), v.toString(), d.children("sx\\:maxX").text(), m.toString())
                }
                var g = o.children("visibility").text(), y = o.find("Link href").text(), b = i.replaceDomainWithTag(y),
                    w = o.find("sx\\:Service,Service"), E, S, x;
                w.length > 0 ? (E = w.text() == "googleEarthEnterprise", S = w.text() == "WMTS") : E = !!o.find("sx\\:googleEarthEnterprise, googleEarthEnterprise").length;
                var T = o.find("sx\\:accessToken,accessToken");
                if (T.length > 0) {
                    x = e(T[0]).text();
                    var N = y.toLocaleLowerCase().indexOf("/tiles"), C;
                    e.ajax({
                        url: y.substring(0, N) + "?access_token=" + x, method: "GET", success: function (e) {
                            C = "mapbox." + e.name.toLocaleLowerCase()
                        }, error: function () {
                        }, async: !1
                    })
                }
                var k = E != undefined && E ? o.children("name").text() : o.find("Link sx\\:layerName, layerName").text(),
                    L = o.children("styleUrl").text().replace(/^[#]/, ""), A = e.grep(s, function (t) {
                        return L === e(t).attr("id")
                    });
                if (A.length == 1) {
                    var O = e(A[0]).find("sx\\:maxVisibilityDistance,maxVisibilityDistance"),
                        M = e(A[0]).find("sx\\:minVisibilityDistance,minVisibilityDistance");
                    if (O.length > 0) var _ = Number(O.text());
                    if (M.length > 0) var D = Number(M.text())
                }
                var P = {
                    displayName: o.children("name").text(),
                    url: b.url,
                    name: k,
                    visibility: g ? Number(g) : !0,
                    alpha: f,
                    rectangle: p,
                    subdomains: b.subdomains,
                    fromKML: !0,
                    maxVisibilityDistance: _,
                    minVisibilityDistance: D
                }, H = o.find("sx\\:startLocation,startLocation");
                H.length > 0 && (P.startLocation = !0);
                if (E) P.googleEarthEnterpriseLayer = !0; else if (S) P.WMTS = !0; else if (u) {
                    P.isElevationLayer = !0, P.guid = Cesium.createGuid(), P.show = P.visibility;
                    var B = o.find("sx\\:elevationScale,elevationScale");
                    B.length > 0 ? P.scale = Number(B.text()) : P.scale = 1, P.offset = 0;
                    var j = o.find("sx\\:elevationOffset,elevationOffset");
                    j.length > 0 ? P.offset = Number(j.text()) : P.offset = 0;
                    var F = o.find("sx\\:geometryWKT,geometryWKT");
                    if (F.length > 0) {
                        var I = F.text().split("((")[1].split("))")[0].split(",");
                        P.polygonVerticesX = [], P.polygonVerticesY = [], I.forEach(function (e) {
                            e = e.replace(/^\s+/, ""), P.polygonVerticesX.push(Number(e.split(" ")[0])), P.polygonVerticesY.push(Number(e.split(" ")[1]))
                        })
                    }
                } else x && (P.isMapbox = x, P.mapID = C);
                var q = o.find("sx\\:nullValue,nullValue");
                if (q.length > 0) {
                    u && (P.nullValueNumber = Number(c(q))), P.nullValue = c(q, !0);
                    if (P.nullValue !== undefined) {
                        var R = P.nullValue;
                        P.nullValue = new Cesium.Color(R.red, R.green, R.blue, R.alpha)
                    }
                }
                var U = o.find("sx\\:nullTolerance,nullTolerance");
                U.length > 0 && P.nullValue != undefined && (P.nullTolerance = c(U, !1));
                var z = P.googleEarthEnterpriseLayer != undefined ? undefined : P.WMTS != undefined ? TerraExplorer.SGWorld.Creator.isLayerSupported(y, P.name, "WMTS", !1) : TerraExplorer.SGWorld.Creator.isLayerSupported(y, P.name, "WMS", !1),
                    W;
                z != undefined && (W = !!z.isSupported), !W && !E && !x ? (P.isSupported = !1, P.reason = z.reason, P.latLon = !1, i._unsupportedLayers.push(P)) : u ? (i._elevationLayers == null && (i._elevationLayers = new Array), i._elevationLayers.push(P)) : i._rasterLayers.push(P)
            }
        })
    }, d.prototype.loadMeshLayers = function (t) {
        var n = e(t).find("sx\\:MeshLayer, MeshLayer"), r = this._meshLayers = new Array, i = this;
        n.each(function (t, n) {
            var r = e(n), s = r.attr("id"), o = r.children("visibility").text(),
                u = r.children("sx\\:overSampling,overSampling");
            if (u.length > 0) var a = p[e(u[0]).text().toLocaleLowerCase()];
            var f = r.children("sx\\:replaceTerrainWithMesh,replaceTerrainWithMesh");
            if (f.length > 0) var l = Number(e(f[0]).text());
            var c = i.replaceDomainWithTag(r.find("Link href").text()), d = c.url.indexOf("@");
            d > -1 && (c.url = c.url.substring(d + 1));
            var v = r.find("Link sx\\:layerName, layerName").text();
            if (c.url.toLowerCase().indexOf("sfs/streamer.ashx") !== -1) {
                console.log("Mesh layers from SFS are not supported (layer: " + v + ").");
                return
            }
            if (c.url.toLowerCase().indexOf("streamer.ashx") !== -1) {
                var m = c.url.replace(/streamer.ashx/gi, "b3dm");
                c.url = m
            }
            var g = r.find("Location altitude"), y = r.find("sx\\:originalAltitude,originalAltitude");
            if (g.length > 0 && y.length > 0) var b = Number(g.text()), w = Number(y.text());
            var E = r.find("Location longitude"), S = r.find("sx\\:originalLongitude,originalLongitude"),
                x = r.find("Location latitude"), T = r.find("sx\\:originalLatitude,originalLatitude");
            if (x.length > 0) var N = Cesium.Math.toRadians(Number(E.text())),
                C = Cesium.Math.toRadians(Number(x.text()));
            if (S.length > 0) var k = Cesium.Math.toRadians(Number(S.text())),
                L = Cesium.Math.toRadians(Number(T.text()));
            var A = {
                displayName: r.children("name").text(),
                url: c.url,
                name: v,
                visibility: o ? h(o) : !0,
                subdomains: c.subdomains,
                altitudeOffset: {
                    altitude: b,
                    newLon: N,
                    newLat: C,
                    originalAltitude: w,
                    originalLongitude: k,
                    originalLatitude: L
                },
                useFloor: l === undefined ? 1 : l,
                teID: s,
                fromKML: !0,
                oversampling: a
            }, O = r.find("sx\\:startLocation,startLocation");
            O.length > 0 && (A.startLocation = !0), i._meshLayers.push(A)
        })
    }, d.prototype.loadCPTLayers = function (t) {
        var n = e(t).find("sx\\:PointCloud, PointCloud"), r = this._cptLayers = new Array, i = this;
        n.each(function (t, n) {
            var r = e(n), s = r.children("visibility").text(), o = r.find("Link href").text();
            if (o.indexOf("@") != -1) {
                var u = o.split("@"), a = u[0];
                a.indexOf(".cpt") && (a = a.replace(".cpt", ""));
                var f = window.location.protocol + "//" + u[1].replace(/^([^$]+)[$]+(.*)/, "$1$2") + "/pnts/" + a;
                o = f
            }
            var l = i.replaceDomainWithTag(o), c = {
                displayName: r.children("name").text(),
                url: l.url,
                name: a,
                visibility: s ? h(s) : !0,
                subdomains: l.subdomains,
                fromKML: !0,
                pointSize: Number(r.find("sx\\:pointSize,pointSize").text())
            }, p = r.find("sx\\:startLocation,startLocation");
            p.length > 0 && (c.startLocation = !0), i._cptLayers.push(c)
        })
    }, d.prototype.loadVideoOnTerrainObj = function (t) {
        var n = e(t).find("sx\\:VideoOnTerrain,VideoOnTerrain");
        this._videoOnTerrainObjects = new Array;
        var r = this;
        n.each(function (t, n) {
            var i = e(n), s = i.find("name").text(), o = i.find("Point coordinates").text().split(","),
                u = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromDegrees(Number(o[0]), Number(o[1]), Number(o[2]))),
                a = i.find("Link href").text(),
                f = new Cesium.HeadingPitchRange(Cesium.defaultValue(c(i.find("Orientation heading")), 0), Cesium.defaultValue(c(i.find("Orientation tilt")), 0), Cesium.defaultValue(c(i.find("Distance")), 1e3)),
                l = Number(i.find("sx\\:fieldOfView,fieldOfView").text()), h = {
                    volume: Number(i.find("sx\\:volume,volume").text()),
                    showProjector: Number(i.find("sx\\:showProjector,showProjector").text())
                }, p = {name: s, position: u, url: a, hpra: f, fov: l, options: h, fromKML: !0},
                d = e(n).find("sx\\:startLocation,startLocation");
            d.length > 0 && (p.startLocation = !0), r._videoOnTerrainObjects.push(p)
        })
    }, d.prototype.loadHoleOnTerrainObj = function (t) {
        var n = e(t).find("sx\\:HoleOnTerrain, HoleOnTerrain");
        this._holeOnTerrainObjects = new Array;
        var r = this;
        n.each(function (t, n) {
            var i = e(n);
            if (c(e(n))) {
                var s = i.find("name").text(), o = i.find("Polygon");
                if (o !== undefined && o.length > 0) {
                    var u = o.find("coordinates");
                    if (u.length > 0) var a = u.text().split(" ");
                    n.polygonVerticesX = [], n.polygonVerticesY = [], a.forEach(function (e) {
                        e = e.replace(/^\s+/, ""), n.polygonVerticesX.push(Number(e.split(",")[0])), n.polygonVerticesY.push(Number(e.split(",")[1]))
                    });
                    var f = [];
                    for (var l = 0; l < a.length; l++) {
                        var h = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromDegrees(n.polygonVerticesX[l], n.polygonVerticesY[l], 0));
                        f.push(h)
                    }
                }
                var n = {vertices: f, fromKML: !0, displayName: s, name: s},
                    p = i.find("sx\\:startLocation,startLocation");
                p.length > 0 && (n.startLocation = !0), r._holeOnTerrainObjects.push(n)
            }
        })
    }, d.prototype.loadModifyTerrainObj = function (t) {
        var n = e(t).find("sx\\:ModifyTerrain, ModifyTerrain");
        this._modifyTerrainObjects = new Array;
        var r = this;
        n.each(function (t, n) {
            var i = e(n), s = i.children("name").text(), o = i.find("sx\\:innerPolygon,innerPolygon");
            if (o.length > 0) var u = o.find("sx\\:geometryWKT,geometryWKT");
            var a;
            if (u !== undefined && u.length > 0) {
                var f = u.text().split("((")[1].split("))")[0].split(",");
                n.polygonVerticesX = [], n.polygonVerticesY = [], n.polygonVerticesHeight = [], f.forEach(function (e) {
                    e = e.replace(/^\s+/, ""), n.polygonVerticesX.push(Number(e.split(" ")[0])), n.polygonVerticesY.push(Number(e.split(" ")[1])), n.polygonVerticesHeight.push(Number(e.split(" ")[2])), a === undefined && (a = n.polygonVerticesHeight[0])
                });
                var l = [], c = [];
                for (var h = 0; h < f.length; h++) {
                    var p = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromDegrees(n.polygonVerticesX[h], n.polygonVerticesY[h], 0));
                    l.push(p), c.push(n.polygonVerticesHeight[h])
                }
            }
            var d = TerraExplorer.tools.ToolManager._tools.ModifyTerrainTool,
                v = i.find("sx\\:elevationBehavior,elevationBehavior");
            if (v.length > 0) var m = v.text().toLowerCase() === "replace" ? d.MODIFY_TERRAIN_TYPES.REPLACE : v.text().toLowerCase() === "crop above" ? d.MODIFY_TERRAIN_TYPES.CROP_ABOVE : v.text().toLowerCase() === "crop below" ? d.MODIFY_TERRAIN_TYPES.CROP_BELOW : d.MODIFY_TERRAIN_TYPES.OFFSET;
            var n = {name: s, vertices: l, heights: c, fromKML: !0, elevationBehavior: m}, g = !1,
                y = i.find("sx\\:applyTo,applyTo");
            if (y.length > 0) {
                var b = e(y[0]).html(), w = e.grep(r.MeshLayers, function (e) {
                    return "#" + e.teID === b
                });
                if (w.length === 1) {
                    w[0].modifyB3dmObjects === undefined && (w[0].modifyB3dmObjects = []);
                    var E = {};
                    n.modifyB3dmID = Cesium.createGuid(), E.mtID = n.modifyB3dmID, E.polygon = n.vertices, E.modifiedHeight = a, E.elevationBehavior = m, E.visibility = !0, E.name = s, w[0].modifyB3dmObjects.push(E), n.isModifyB3dmObject = !0, n.meshObject = w[0]
                }
            }
            var S = i.find("sx\\:startLocation,startLocation");
            S.length > 0 && (n.startLocation = !0), r._modifyTerrainObjects.push(n)
        })
    }, d.prototype.loadKmlLayers = function (t) {
        var n = e(t).find("NetworkLink");
        this._kmlLayers = new Array;
        for (var r = 0; r < n.length; r++) {
            var i = (new XMLSerializer).serializeToString(n.get(r)),
                s = "<?xml version='1.0' encoding='utf-8'?><kml xmlns='http://www.opengis.net/kml/2.2' xmlns:gx='http://www.google.com/kml/ext/2.2'><Document>" + i + "</Document></kml>";
            this.loadKmlLayer(s)
        }
        n.remove()
    }, d.prototype.loadKmlLayer = function (t, n) {
        var r = e.parseXML(t), i = e(r).find("NetworkLink"), s = this, o = Cesium.createGuid();
        for (var u = 0; u < this._kmlLayers.length; u++) if (this._kmlLayers[u].layerSrc == t) {
            o = this._kmlLayers[u].guid, viewer.dataSources.remove(this._kmlLayers[u]), this._kmlLayers.splice(u, 1);
            break
        }
        viewer.dataSources.add(Cesium.KmlDataSource.load(r, {
            camera: viewer.camera,
            canvas: viewer.canvas
        })).then(function (r) {
            r.layerSrc = t, r.guid = o, r.LayerDisplayName = r.name, r.LayerDisplayName == undefined && (r.LayerDisplayName = e(i).children("name").length > 0 ? e(i).children("name").text() : e(i).find("Link href").text().replace(/^.*[\\\/]/, "")), s._kmlLayers.push(r), n != undefined && (n = r), r.refresh = function () {
                s.loadKmlLayer(this.layerSrc, this)
            }
        })
    }, d.prototype.loadTours = function (t) {
        var n = e(t).find("gx\\:Tour, Tour");
        this._tours = new Array;
        var r = this;
        for (var i = 0; i < n.length; i++) {
            var s = {
                id: e(n[i]).attr("id") || Cesium.createGuid(),
                name: e(n[i]).children("name").length == 1 ? e(n[i]).children("name").text() : "",
                playlist: [],
                duration: undefined,
                playSpeed: e(n[i]).children("sx\\:playSpeed").text()
            }, o = e(n[i]).children("gx\\:Playlist");
            o && o.children().each(function (t, n) {
                if (n.nodeName == "gx:AnimatedUpdate") return;
                n.nodeName == "gx:FlyTo" && s.playlist.push(r.readFlyToTag(n)), n.nodeName == "gx:Wait" && s.playlist.push(r.readWaitTag(n)), n.nodeName == "sx:Caption" && s.playlist.push(r.readCaptionTag(n));
                if (n.nodeName == "BalloonStyle") {
                    var i = {}, o = e.grep(n.children, function (e) {
                        return e.nodeName == "text"
                    });
                    if (o.length > 0) {
                        var u = o[0].textContent;
                        i.type = "message", i.messageType = "html", i.content = u
                    } else {
                        var a = n.textContent;
                        i.type = "message", i.messageType = "text", i.content = a
                    }
                    s.playlist.push(i)
                }
                if (n.nodeName == "sx:playSpeed") {
                    var f = {type: "playSpeedStep", speed: e(n).text()};
                    s.playlist.push(f)
                }
            }), this._tours.push(s)
        }
        n.remove()
    }, d.prototype.readMessageLinks = function (t) {
        var n = {}, r = e(t).find("sx\\:BalloonStyle, BalloonStyle");
        if (r.length > 0) {
            var i = e.grep(r.children(), function (e) {
                return e.nodeName == "text"
            });
            if (i.length > 0) {
                var s = i[0].textContent;
                n.type = "Html", n.content = s
            } else if (e(r).find("sx\\:attributesStyle, attributesStyle").length > 0) n.type = "attributesStyle", n.content = ""; else {
                var o = r[0].textContent;
                n.type = "Text", n.content = o
            }
            return n
        }
    }, d.prototype.loadStartPosition = function (t) {
        this._startPosition = null;
        try {
            var n = e(t).find("Document").children().first();
            if (n.length < 1) return;
            if (n[0].nodeName != "LookAt") return;
            var r = {id: "StartPosition", name: "StartPosition", tePosition: this.tePositionFromCameraOrLookAt(n)};
            this._startPosition = r
        } catch (i) {
        }
    }, d.prototype.readFlyToTag = function (t) {
        var n = {
            type: "FlyTo",
            id: e(t).attr("id") || Cesium.createGuid(),
            duration: e(t).children("gx\\:duration").length == 1 ? Number(e(t).children("gx\\:duration").text()) : undefined,
            flyToMode: e(t).children("gx\\:flyToMode").length == 1 ? e(t).children("gx\\:flyToMode").text() : "bounce",
            tePosition: this.tePositionFromCameraOrLookAt(e(t).children("Camera").length > 0 ? e(t).children("Camera") : e(t).children("LookAt"))
        };
        return n
    }, d.prototype.readWaitTag = function (t) {
        var n = {
            type: "Wait",
            duration: e(t).children("gx\\:duration").length == 1 ? Number(e(t).children("gx\\:duration").text()) : undefined
        };
        return n
    }, d.prototype.readCaptionTag = function (t) {
        var n = {
            type: "Caption",
            text: e(t).children("sx\\:text").length === 1 ? e(t).children("sx\\:text").text() : ""
        };
        return n
    }, new d
}), define("SGWorld/TerraExplorerObject", ["jquery", "TELang"], function (e, t) {
    "use strict";

    function n(e) {
        this._object = e.object, this._position, this._object !== undefined && (this._object.position !== undefined ? this._position = this._object.position : this._object.bs && (this._position = this._object.bs.center))
    }

    return Cesium.defineProperties(n.prototype, {
        show: {
            get: function () {
                return this._object.show
            }, set: function (e) {
                if (this._object.parent === "layers") {
                    var t = TerraExplorer.tools.ToolManager._tools.LayersTool;
                    t.showLayer(this._object, e)
                } else this.type === "modifyTerrain" ? this._object.Show = e : this._object.show = e;
                this.updateUI()
            }
        }, description: {
            get: function () {
                return this._object.displayName
            }, set: function (e) {
                this._object.displayName = e, this.updateUI()
            }
        }, timestamp: {
            get: function () {
                return this._object.timestamp
            }
        }, type: {
            get: function () {
                return this._object.type
            }
        }, parent: {
            get: function () {
                if (this._object.parent === "layers") return TerraExplorer.layers.items;
                if (this._object.parent === "objects") return TerraExplorer.objects.items;
                if (this._object.parent === "analysis") return TerraExplorer.analysis.items
            }, set: function (e) {
                this._object.parent = e
            }
        }
    }), n.prototype.updateUI = function (t) {
        var n = t !== undefined ? t : this._object.parent,
            r = n === "objects" || n === "analysis" ? "menuIconAnalyzeTool" : n === "layers" ? "menuIconMenu_Layers" : undefined;
        r !== undefined && e("#" + r).click()
    }, n.prototype.refresh = function () {
        var e = undefined;
        return this._object.parent === "layers" && (e = this._object.parent), this._object.refresh != undefined && (this._object = this._object.refresh()), e !== undefined && this._object && (this._object.parent = e), this._object
    }, n.prototype.delete = function () {
        if (this._object.delete !== undefined) {
            var e = this._object.parent;
            this._object = this._object.delete(), this.updateUI(e)
        }
    }, n.prototype.flyTo = function (e, t) {
        if (e !== undefined) TerraExplorer.internal.Navigate.flyToPosition(e, t); else if (this._object.flyTo !== undefined) this._object.flyTo(); else if (this._object.position !== undefined) if (this._object.direction !== undefined) {
            var n = this._object.viewshedMap._lightCamera;
            viewer.camera.flyTo({destination: this._object.position, orientation: {heading: n.heading, pitch: n.pitch}})
        } else viewer.camera.flyTo({destination: this._object.position}); else {
            var r = TerraExplorer.tools.ToolManager._tools.LayersTool;
            r.onFlyTo(this._object)
        }
    }, n
}), define("internal/Project", ["jquery", "TELang", "KmlParser", "wfs/Layer", "./Units", "tools/TETools/FavoritesStorage", "tools/TETools/LayersStorage", "SGWorld/TerraExplorerObject"], function (e, t, n, r, i, s, o, u) {
    "use strict";

    function f(t, n) {
        var r = t;
        r.indexOf("{s}") != -1 && n != undefined && (r = r.replace("{s}", n[0])), TerraExplorer.isSkylineGlobeServer(r, function (t, i, s, o, u) {
            if (i == 1 && !Cesium.TrustedServers.contains(r)) {
                var a = t.authority != undefined ? t.authority : t.path.split("/")[0];
                TerraExplorer.trustedSkylineGlobeServers.addTrustedSG(a, s), n != undefined && e(n).each(function (e, t) {
                    var n = new Cesium.Uri(t), r = n.authority != undefined ? n.authority : n.path.split("/")[0];
                    TerraExplorer.trustedSkylineGlobeServers.addTrustedSG(r, s)
                })
            }
        })
    }

    function l(e) {
        return TerraExplorer.browser.isFirefox && e.indexOf("��") == 0 ? e.slice(2).replace(/\0/g, "") : e
    }

    function c(e) {
        var t;
        return e.indexOf("://") > -1 ? t = e.split("/")[2] : t = e.split("/")[0], t = t.split(":")[0], t = t.split("?")[0], t
    }

    var a = function () {
        this._featureLayers = [], this._rasterLayers = [], this._locations = [], this._presentations = [], this._startPosition, this._unsupportedLayers = [], this._cancelCloseAlert = !1, this._viewshedObjects = [], this._distanceObjects = [], this._areaObjects = [], this._volumeAnalysisObjects = [], this._videoOnTerrainObjects = [], this._holeOnTerrainObjects = [], this._modifyTerrainObjects = [], this._modelModifyTerrainObjects = {}, this._tilesetsLevels = {}, this._tilesetsTerrainHeights = {}, this._objectTypes = {
            VIEWSHED: "viewshed",
            DISTANCE: "distance",
            AREA: "area",
            VOLUME: "volume",
            VIDEO_ON_TERRAIN: "videoOnTerrain",
            MODIFY_TERRAIN: "modifyTerrain",
            HOLE_ON_TERRAIN: "holeOnTerrain"
        }, this._objectsToSave = {
            viewshed: !1,
            distance: !0,
            area: !0,
            volume: !0,
            videoOnTerrain: !1,
            modifyTerrain: !1,
            holeOnTerrain: !1
        }, this._allLayersObjects = {
            elevation: [],
            imagery: [],
            feature: {FeatureLine: [], FeaturePoint: [], FeaturePolygon: []},
            mesh: [],
            cpt: []
        }, this._allAnalysisObjects = {
            viewshed: this._viewshedObjects,
            distance: this._distanceObjects,
            area: this._areaObjects,
            volume: this._volumeAnalysisObjects,
            videoOnTerrain: this._videoOnTerrainObjects,
            modifyTerrain: this._modifyTerrainObjects,
            holeOnTerrain: this._holeOnTerrainObjects
        }, this._objectsMaxNumber = {
            distance: 30,
            area: 30,
            volume: 30,
            videoOnTerrain: 8,
            modifyTerrain: 30,
            holeOnTerrain: 30
        }, this.allTEObjects = {
            analysis: this._allAnalysisObjects,
            layers: this._allLayersObjects
        }, this._allAvailableObjectsNames = {}, this._wmtsDictionary = {};
        var t = this;
        this._statistics = {
            getNumberOfFeatures: function () {
                var n = 0;
                return e(t._featureLayers).each(function (e, t) {
                    n += t.Statistics.getNumberOfCurrentlyRenderedFeatures()
                }), n
            }, getNumberOfPositions: function () {
                var n = 0;
                return e(t._featureLayers).each(function (e, t) {
                    n += t.Statistics.getNumberOfCurrentlyRenderedPositions()
                }), n
            }
        }, this._featureLayers.getLayerContainingFid = function (e) {
            for (var t = 0; t < this.length; t++) {
                var n = this[t].getFeature(e);
                if (n != null) return {layer: this[t], feature: n.feature}
            }
            return null
        }
    };
    return Cesium.defineProperties(a.prototype, {
        FeatureLayers: {
            get: function () {
                return this._featureLayers
            }
        }, KmlLayers: {
            get: function () {
                return n._kmlLayers
            }
        }, Locations: {
            get: function () {
                return this._locations
            }
        }, Presentations: {
            get: function () {
                return this._presentations
            }
        }, MeshLayers: {
            get: function () {
                var t = e.grep(viewer.scene.primitives._primitives, function (e) {
                    return e instanceof Cesium.Cesium3DTileset
                });
                return t
            }
        }, ViewshedObjects: {
            get: function () {
                return this._viewshedObjects
            }
        }, VideoOnTerrainObjects: {
            get: function () {
                return this._videoOnTerrainObjects
            }
        }, HoleOnTerrainObjects: {
            get: function () {
                return this._holeOnTerrainObjects
            }
        }, ModifyTerrainObjects: {
            get: function () {
                return this._modifyTerrainObjects
            }
        }, DistanceObjects: {
            get: function () {
                return this._distanceObjects
            }
        }, AreaObjects: {
            get: function () {
                return this._areaObjects
            }
        }, VolumeAnalysisObject: {
            get: function () {
                return this._volumeAnalysisObjects
            }
        }, ObjectsTypes: {
            get: function () {
                return this._objectTypes
            }
        }, StartPosition: {
            get: function () {
                return this._startPosition
            }
        }, Statistics: {
            get: function () {
                return this._statistics
            }
        }, UnsupportedLayers: {
            get: function () {
                return this._unsupportedLayers
            }, set: function (e) {
                this._unsupportedLayers = e
            }
        }, ElevationLayers: {
            get: function () {
                return n.ElevationLayers
            }
        }
    }), a.prototype.load = function (t, n, r) {
        f(r.terrainImageryUrl, r.terrainSubdomainsImagery), f(r.terrainElevationUrl, r.terrainSubdomainsElevation);
        var i = this;
        e.ajax({
            url: t, success: function (t) {
                var n;
                typeof t == "string" ? (t = l(t), t.indexOf("xmlns:gx") != -1 ? n = e.parseXML(t) : console.error("Not a valid google-earth string")) : n = t, i.readProject(n)
            }, complete: n
        }), this._objectsMaxNumber[this._objectTypes.VIEWSHED] = TerraExplorer.maxNumViewshed, Object.keys(this._allAnalysisObjects).forEach(function (e) {
            i._allAvailableObjectsNames[e] === undefined && (i._allAvailableObjectsNames[e] = new Array(i._objectsMaxNumber[e]))
        })
    }, a.prototype.readLayout = function (e) {
        n.loadConfig(e), TerraExplorer.tools.MenuButton.buildMenu()
    }, a.prototype.readProject = function (e) {
        n.loadFromData(e), this.createFeatureLayers(n.FeatureLayers), this.createRasterLayers(n.RasterLayers), this.createElevationLayers(n.ElevationLayers), this.createMeshLayers(n.MeshLayers), this.CreatePointCloudModel(n.CPTLayers), this.CreateModifyTerrainObjects(n._modifyTerrainObjects), this.CreateHoleOnTerrainObjects(n._holeOnTerrainObjects), this.CreateVideoOnTerrainObjects(n._videoOnTerrainObjects), this.UnsupportedLayers = n.UnsupportedLayers, this._locations = n.Locations, this._presentations = n.Tours, this._startPosition = n._startPosition, this._userScript = n._userScript
    }, a.prototype.addToUnsupportedLayers = function (t) {
        this.UnsupportedLayers.push(t);
        var n = e.grep(viewer.scene.primitives._primitives, function (e) {
            return e.guid === t.guid
        });
        n.length === 1 && viewer.scene.primitives.remove(n[0])
    }, a.prototype.showErrorMessages = function (e) {
        e && alert("Startup Script Error: " + e.message), this.UnsupportedLayers.length > 0 && this.displayUnsupportedLayersMessage()
    }, a.prototype.replaceUrlWithRandomSubdomain = function (e, t) {
        return t == undefined ? e : e.replace("{s}", t ? t[Math.floor(Math.random() * t.length)] : "")
    }, a.prototype.createFeatureLayers = function (t) {
        var n = [], s = this;
        return viewer.scene.context.fragmentDepth || e(t).each(function (e, t) {
            var n = t.style;
            n !== undefined && n.polyline !== undefined && n.altitudeMethod === 2 && (n.altitudeMethod = 0, n.altitudeOffset !== undefined ? n.altitudeOffset.defaultValue = 1 : (n.altitudeOffset = {}, n.altitudeOffset.defaultValue = 1))
        }), e(t).each(function (t, a) {
            var l = Cesium.when.defer();
            n.push(l);
            var c = s.replaceUrlWithRandomSubdomain(a.url, a.subdomains) + TerraExplorer.functions.queryStringExist(a.url) + "REQUEST=GetLayerExBaseInfo" + "&typename=" + a.name;
            f(a.url, a.subdomains);
            var h = a;
            e.ajax({
                dataType: "xml", url: c, success: function (e) {
                    var t = e.getElementsByTagName("BlockWidth");
                    if (t.length == 1) {
                        var n = parseFloat(t[0].textContent);
                        if (n <= 0 || !Cesium.defined(n)) {
                            console.log("Layer does not contain a valid blockWidth");
                            return
                        }
                        var r = t[0].attributes[0].value, s = i.blockWidthToTeLayerLevel(n);
                        h.level = s, h.level <= 2 && (h.level = 3)
                    }
                }, complete: function () {
                    if (h.name != "" && h.url != "") {
                        var t = new r(viewer, h.url, h.name, h.level, h.style, h.displayName, h.subdomains, h.latLon, h.myLayer);
                        t.indexInProjectTree = h.indexInProjectTree, t.timestamp = h.timestamp, t.setVisibility(h.visibility), t.latLon = h.latLon, s._featureLayers.push(t), h.myLayer === TerraExplorer.SGWorld.Creator.CreateFor.UI && TerraExplorer.tools.ToolManager._tools.LayersTool.insertMyLayersKey(t), t.refresh(), h.startLocation && (t.startLocation = !0);
                        var n = TerraExplorer.tools.ToolManager._tools.LayersTool;
                        t.delete = function () {
                            e("#menuIconMenu_Layers").length > 0 && e("#menuIconMenu_Layers").click(), n.deleteLayer(n.getItemFromLayer(t))
                        }, t.type === undefined && (t.type = o.getItemType(t)), t.parentType = "feature";
                        var i = new u({object: t});
                        s.addLayersToObjectList(i), l.resolve(i)
                    } else l.reject("error")
                }
            })
        }), n
    }, a.prototype.deleteObject = function (t) {
        if (t != undefined) {
            e("#headerDivContainer #CloseImg").length > 0 && e("#headerDivContainer #CloseImg")[0].click(), t.type === this._objectTypes.MODIFY_TERRAIN ? t.destroy() : t.type === this._objectTypes.HOLE_ON_TERRAIN ? viewer.scene.primitives.removeAndDestroy(t) : t.type === this._objectTypes.VIEWSHED ? TerraExplorer.tools.ToolManager._tools.Viewshed.deleteViewshed(t) : t.type === this._objectTypes.VIDEO_ON_TERRAIN ? TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool.deleteVideoOnTerrain(t) : (Object.values(t.prims).forEach(function (e) {
                viewer.scene.primitives.remove(e)
            }), t.entities !== undefined && Object.values(t.entities).forEach(function (e) {
                viewer.entities.remove(e)
            }), t.defaultName !== undefined && (this._allAvailableObjectsNames[t.type][Number(t.name.split("#")[1])] = undefined), o.deleteItem(t.name));
            var n = TerraExplorer.internal.Project._allAnalysisObjects[t.type], r;
            for (var i = 0; i < n.length; i++) t.type === this._objectTypes.VIEWSHED ? t.guid === n[i]._object.guid && (r = i) : t.id === n[i]._object.id && (r = i);
            r !== undefined && n.splice(r, 1);
            var s = e("#MessageClientId").scrollTop();
            e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click(), e("#MessageClientId").animate({scrollTop: s}, 0)
        }
    }, a.prototype.OpenProjectFromServer = function (e, t) {
        if (t == undefined || e == undefined) return;
        var n = t.split(".").length - 1, r = t.split(".")[n], i = e + "/projects?id=" + r, s = c(e),
            o = TerraExplorer.getQueryValue("site");
        s == window.location.host ? window.SGUrl !== undefined ? window.open(window.SGUrl + TerraExplorer.getCurrentSitePath() + "?catalogid=" + r, "_top") : window.open(window.location.protocol + "//" + window.location.host + "/sg" + TerraExplorer.getCurrentSitePath() + "/terraexplorerweb/terraexplorer.html?catalogid=" + r, "_top") : window.SGUrl !== undefined ? window.open(window.location.protocol + "//" + window.location.host + window.location.pathname + TerraExplorer.getCurrentSitePath() + "?kmlUrl=" + i, "_top") : window.open(window.location.protocol + "//" + window.location.host + "/sg" + TerraExplorer.getCurrentSitePath() + "/terraexplorerweb/terraexplorer.html?kmlUrl=" + i, "_top")
    }, a.prototype.createElevationLayerFromServer = function (t) {
        var r = [], i = this;
        return e(t).each(function (e, t) {
            var s = Cesium.when.defer();
            r.push(s), f(t.url, t.subdomains);
            var o = i.readRasterBBOxFromServer(t, function (e) {
                var t = Cesium.when.defer();
                e.guid = Cesium.createGuid(), e.type = "elevation", n._elevationLayers == null && (n._elevationLayers = new Array), n._elevationLayers.push(e), i.createElevationLayers(i.ElevationLayers), e.myLayer === TerraExplorer.SGWorld.Creator.CreateFor.UI && TerraExplorer.tools.ToolManager._tools.LayersTool.insertMyLayersKey(e);
                var r = new u({object: e});
                return i.addLayersToObjectList(r), t.resolve(r), t
            });
            r.push(o)
        }), r
    }, a.prototype.createPolygon = function (e) {
        if (typeof e != "string") return undefined;
        var t = [];
        e = e.replace(/,/g, "");
        var n = e.split(" ");
        if (n.length % 2 != 0) debugger;
        for (var r = 0; r < n.length; r += 2) t.push([Number(n[r]), Number(n[r + 1])]);
        return t
    }, a.prototype.setElevationLayerFormat = function (e) {
        var t = Cesium.when.defer();
        if (Cesium.defined(e.format)) t.resolve(e.format); else {
            var n = e.rectangle, r = Cesium.Rectangle.center(n), i = viewer.terrainProvider.findDirectParent(n),
                s = i.level + 2, o = viewer.terrainProvider.tilingScheme.positionToTileXY(r, s),
                u = viewer.terrainProvider.tilingScheme.tileXYToRectangle(o.x, o.y, s),
                a = [u.south * 180 / Math.PI, u.west * 180 / Math.PI, u.north * 180 / Math.PI, u.east * 180 / Math.PI].join(","),
                f = e.url + "?request=GetMap&Version=1.3.0&Service=WMS&v=1&CRS=EPSG%3A4326&bbox=" + a + "&height=256&width=256&optimizedOnly=0&layers=" + e.name + "&Styles=&Format=image/mpt",
                l = f.replace("image/mpt", "image/png"), c = TerraExplorer.internal.Engine,
                h = Cesium.Resource.fetchArrayBuffer(f);
            Cesium.when(h, function (e) {
                c.isMPT(e) ? Cesium.when(c.isValidElevation({buffer: e}), function (e) {
                    e.rejected ? t.resolve("png") : t.resolve("mpt")
                }).otherwise(function (e) {
                    t.resolve("png")
                }) : t.resolve("png")
            }).otherwise(function (e) {
                t.resolve("png")
            })
        }
        return t
    }, a.prototype.createElevationLayers = function (t) {
        var n = this;
        t != null && (e(t).each(function (e, t) {
            Cesium.when(n.setElevationLayerFormat(t), function (e) {
                var n = viewer.terrainProvider;
                return t.format = e, n.refreshElevationLayer(t), t.refresh = function () {
                    return n.refreshElevationLayer(t), t
                }, t
            })
        }), viewer.terrainProvider._allElevationLayers = t)
    }, a.prototype.CreateVideoOnTerrainObjects = function (t) {
        var n = TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool, r = this, i = Cesium.when.defer(),
            s = new Cesium.EventHelper;
        s.add(viewer.scene.globe.tileLoadProgressEvent, function (e) {
            e == 0 && i.resolve()
        }), Cesium.when(i, function () {
            e(t).each(function (t, n) {
                Cesium.when(TerraExplorer.SGWorld.Creator.CreateVideoOnTerrain(n.name, n.url, n.fov, n.position, n.hpra, n.options), function (t) {
                    if (t !== undefined) {
                        var n = !!e.grep(r._videoOnTerrainObjects, function (e) {
                            return e.id === t.id
                        }).length;
                        n || r._videoOnTerrainObjects.push(t)
                    }
                })
            })
        })
    }, a.prototype.CreateHoleOnTerrainObjects = function (t) {
        var n = TerraExplorer.tools.ToolManager._tools.HoleOnTerrainTool, r = this, i = Cesium.when.defer(),
            s = new Cesium.EventHelper;
        s.add(viewer.scene.globe.tileLoadProgressEvent, function (e) {
            e == 0 && i.resolve()
        }), Cesium.when(i, function () {
            e(t).each(function (e, t) {
                Cesium.when(TerraExplorer.SGWorld.Creator.CreateHoleOnTerrain(t.displayName, t.vertices, {}), function (e) {
                    t.startLocation && (e.startLocation = !0)
                })
            })
        })
    }, a.prototype.CreateModifyMeshObject = function (n) {
        var r = Cesium.when.defer(), i = e.extend({}, n), s = TerraExplorer.tools.ToolManager._tools.ModifyTerrainTool,
            o = i.heights;
        o === undefined && (o = i.modifiedHeight);
        var u = i.vertices, a = i.polygon;
        if (u === undefined || o === undefined) throw{type: "TE_EXCEPTION", format: "Missing argument"};
        if (u.length === undefined || u.length === 0) throw{
            type: "TE_EXCEPTION",
            format: "Vertices -  must be a non zero length array"
        };
        var f, l, c, h, p;
        l = Cesium.defaultValue(i.mtType, s.MODIFY_TERRAIN_TYPES.OFFSET), c = Cesium.defaultValue(i.fromKML, undefined), h = Cesium.defaultValue(i.priority, 1), p = Date.now();
        var d = Cesium.defaultValue(n.mtID, Cesium.createGuid()), v = !1;
        if (o.length === undefined || o.length === 0) {
            if (!!isNaN(Number(o))) throw{type: "TE_EXCEPTION", format: "Vertices -  must be a non zero length array"};
            var m = u.length;
            f = new Array(m), f.fill(o)
        } else f = o[0];
        var g = f.length ? f[0] : f, y = Cesium.Rectangle.fromCartesianArray(u), b = Cesium.Rectangle.center(y),
            w = Cesium.BoundingSphere.fromPoints(u);
        w.radius = Math.max(200, g);
        var E = {
            id: d,
            isModifyTerrainObj: !0,
            show: !0,
            visibility: !0,
            rectangle: y,
            mtType: l,
            vertices: u,
            polygon: a,
            heights: g,
            fromKML: c,
            priority: h,
            timeStamp: p,
            defaultName: t.i18n("modifyB3dm_DefaultName"),
            type: "modifyTerrain",
            tool: s.getId(),
            bs: w,
            baseBs: w,
            highBs: w,
            meshObject: i.meshObject,
            isModifyB3dmObject: i.isModifyB3dmObject,
            elevationBehavior: l
        };
        Cesium.defineProperties(E, {
            Show: {
                get: function () {
                    return E.show
                }, set: function (t) {
                    E.show = E.visibility = t;
                    var n = e.grep(TerraExplorer.internal.Project.MeshLayers, function (e) {
                        return e.name === E.meshObject.name
                    });
                    if (n.length === 1) {
                        var r = e.grep(n[0].modifyB3dmObjects, function (e) {
                            return e.mtID === E.id
                        });
                        r.length === 1 && (r[0].visibility = t, r[0].rectangle = E.rectangle, r[0].elevationBehavior = l, n[0].refresh())
                    }
                }
            }
        });
        if (name !== undefined && name.indexOf(t.i18n("modifyB3dm_DefaultName")) > -1) {
            var S = Number(name.split("#")[1]);
            project._allAvailableObjectsNames[project._objectTypes.MODIFY_TERRAIN] === undefined && (project._allAvailableObjectsNames[project._objectTypes.MODIFY_TERRAIN] = new Array(project._objectsMaxNumber.modifyTerrain)), project._allAvailableObjectsNames[project._objectTypes.MODIFY_TERRAIN][S] = !0
        }
        return E.displayName = E.name = i.name ? i.name : TerraExplorer.internal.Project.getAvailableDefaultName(E), E.destroy = function () {
            var e = this.id, t;
            this.Show = !1, t = undefined, TerraExplorer.internal.Project._modifyTerrainObjects.forEach(function (n, r) {
                n._object.id === e && (t = r)
            }), t !== undefined && TerraExplorer.internal.Project._modifyTerrainObjects.splice(t, 1)
        }, E.delete = E.destroy, E.flyTo = function () {
            viewer.camera.flyToBoundingSphere(this.bs)
        }, i.doNotShowInObjectList === undefined && TerraExplorer.internal.Project.addToObjectList(E, !0), r.resolve(E), r
    }, a.prototype.CreateModifyTerrainObjects = function (t, n) {
        var r = TerraExplorer.SGWorld.Creator, i = this, s = Cesium.when.defer(), o = new Cesium.EventHelper;
        o.add(viewer.scene.globe.tileLoadProgressEvent, function (e) {
            e == 0 && s.resolve()
        }), Cesium.when(s, function () {
            e(t).each(function (t, s) {
                var o = {
                    fromKML: Cesium.defaultValue(n, !0),
                    doNotShowInObjectList: n ? !0 : undefined,
                    mtType: s.elevationBehavior,
                    isModifyB3dmObject: s.isModifyB3dmObject,
                    meshObject: s.meshObject
                };
                if (o.meshObject !== undefined) {
                    o.name = s.name, o.vertices = s.vertices, o.heights = s.heights, o.mtID = s.modifyB3dmID, i.CreateModifyMeshObject(o);
                    return
                }
                if (s.elevationBehavior === 1) {
                    var u = s.vertices[0], a = viewer.scene.globe.ellipsoid.cartesianToCartographic(u),
                        f = TerraExplorer.functions.queryBestLevel(a);
                    Cesium.when(f, function (t) {
                        Cesium.sampleTerrain(viewer.terrainProvider, t, [a]).then(function (t) {
                            var n = s.heights[0] - t[0].height;
                            r.CreateModifyTerrain(s.name, s.vertices, [n], o).then(function (t) {
                                if (s.startLocation) {
                                    var n = e.grep(TerraExplorer.objects.modifyTerrain.items, function (e) {
                                        return e.id === t.id
                                    });
                                    n.length > 0 && (n[0].startLocation = !0)
                                }
                            })
                        })
                    })
                } else r.CreateModifyTerrain(s.name, s.vertices, s.heights, o).then(function (t) {
                    if (s.startLocation) {
                        var n = e.grep(TerraExplorer.objects.modifyTerrain.items, function (e) {
                            return e.id === t.id
                        });
                        n.length > 0 && (n[0].startLocation = !0)
                    }
                })
            })
        })
    }, a.prototype.addLayersToObjectList = function (e) {
        var t;
        e instanceof u ? t = e : t = new u({object: e}), t.parent = "layers", this._allLayersObjects[e.type] !== undefined ? this._allLayersObjects[e.type].push(t) : this._allLayersObjects[e._object.parentType][e.type].push(t)
    }, a.prototype.addToObjectList = function (n) {
        if (TerraExplorer.internal.Settings.saveObjects != 2) {
            n.text = Cesium.defaultValue(n.text, Cesium.defaultValue(n.displayName, Cesium.defaultValue(n.name, t.i18n("OBJECT_WITHOUT_NAME"))));
            var r;
            return n instanceof u ? r = n : r = new u({object: n}), n.type === "videoOnTerrain" || n.type === "modifyTerrain" || n.type === "holeOnTerrain" ? r.parent = "objects" : r.parent = "analysis", this._allAnalysisObjects[n.type].push(r), e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click(), r
        }
        var i = this._currentTool = TerraExplorer.tools.ToolManager._tools[n.tool];
        i._currentObject = n, i._toolContainer !== undefined && i._onBeforeCloseEvent.addEventListener(this.removeFrom3D)
    }, a.prototype.removelayerFromTEObj = function (e) {
        var t, n;
        e.type === "FeaturePolygon" || e.type === "FeatureLine" || e.type === "FeaturePoint" ? n = TerraExplorer.internal.Project._allLayersObjects.feature[e.type] : n = TerraExplorer.internal.Project._allLayersObjects[e.type];
        if (n !== undefined) {
            for (var r = 0; r < n.length; r++) e.guid === n[r]._object.guid && (t = r);
            t !== undefined && n.splice(t, 1)
        }
    }, a.prototype.removeFrom3D = function (e) {
        var t = TerraExplorer.internal.Project, n = TerraExplorer.tools.ToolManager;
        if (e === 2 || n._currentTool !== t._currentTool.getId()) if (t._currentTool !== undefined) {
            var r = t._currentTool._currentObject;
            r && r.prims !== undefined && r.prims.forEach(function (e) {
                viewer.scene.primitives.remove(e)
            }), r && r.entities !== undefined && r.entities.forEach(function (e) {
                viewer.entities.remove(e)
            }), t._currentTool._onBeforeCloseEvent.removeEventListener(t.removeFrom3D)
        }
    }, a.prototype.CreateViewsheds = function (t) {
        var n = this;
        e(t).each(function (e, t) {
            var n = {}, r = TerraExplorer.SGWorld.Creator.CreateViewshedObject(position, distance, direction, n)
        })
    }, a.prototype.createRasterLayers = function (t) {
        var n = [], r = this;
        return e(t).each(function (i, s) {
            var o = e(t).find("sx\\:BoundingBox, BoundingBox");
            if (s.rectangle === undefined && s.googleEarthEnterpriseLayer === undefined && s.isMapbox === undefined) {
                var u = r.readRasterBBOxFromServer(s, r.createRasterLayer);
                n.push(u)
            } else {
                var u = r.createRasterLayer(s);
                n.push(u)
            }
        }), n
    }, a.prototype.createRasterLayer = function (e) {
        function n(e, r) {
            r == undefined && (r = !0), f(e.url, e.subdomains);
            var i = {transparent: "true", format: "image/png"};
            e.clippingPolygonVertices != undefined && (i.clippingpolygonvertices = e.clippingPolygonVertices);
            var s;
            if (e.googleEarthEnterpriseLayer != undefined) {
                var o = e.url.indexOf("?http"), u;
                o > -1 && (u = e.url.substring(0, o), e.url = e.url.substring(o).substring(1));
                var a = new Cesium.GoogleEarthEnterpriseMetadata({
                    url: unescape(e.url),
                    proxy: u == undefined ? undefined : new Cesium.DefaultProxy(u)
                });
                s = new Cesium.GoogleEarthEnterpriseImageryProvider({metadata: a})
            } else if (e.WMTS != undefined) {
                var l = t._wmtsDictionary[e.name], c = l.identifier, h = l.rectangle, p = l.tileMatrixLabelsArray,
                    d = l.format, v = [];
                for (var m = 1; m <= p.length; m++) v.push(c + ":" + m);
                s = new Cesium.WebMapTileServiceImageryProvider({
                    url: e.url,
                    layer: e.name,
                    style: "default",
                    format: Cesium.defaultValue(d, "image/jpeg"),
                    tileMatrixSetID: c,
                    tileMatrixLabels: v,
                    rectangle: h,
                    subdomains: e.subdomains,
                    tilingScheme: new Cesium.GeographicTilingScheme
                })
            } else e.isMapbox ? s = new Cesium.MapboxImageryProvider({
                mapId: e.mapID,
                accessToken: e.isMapbox
            }) : (s = new Cesium.WebMapServiceImageryProvider({
                url: e.url,
                layers: e.name,
                rectangle: e.rectangle,
                parameters: i,
                subdomains: e.subdomains
            }), s.latLon = e.latLon, s.rectangle == undefined && (s.rectangle = new Cesium.Rectangle(e.rectangle.west, e.rectangle.south, e.rectangle.east, e.rectangle.north)));
            var g = viewer.imageryLayers.addImageryProvider(s);
            g.show = e.visibility, g.alpha = e.alpha, g.displayName = e.displayName, g.name = e.name, g.guid = Cesium.createGuid(), g.myLayer = e.myLayer, g._rectangle = e.rectangle, g.latLon = e.latLon, g.myLayer = e.myLayer, g.type = "imagery", g.colorToAlpha = e.nullValue, g.maxVisibilityDistance = e.maxVisibilityDistance, g.minVisibilityDistance = e.minVisibilityDistance;
            var y = e.nullTolerance;
            y !== undefined && !isNaN(Number(y)) && (y = Number(y), y < 0 ? g.colorToAlpha = undefined : y === 0 ? g.colorToAlphaThreshold = .001 : g.colorToAlphaThreshold = y / 250);
            var b = g;
            if (e.maxVisibilityDistance || e.minVisibilityDistance) b.maxH = Cesium.defaultValue(e.maxVisibilityDistance, 1e8), b.minH = Cesium.defaultValue(e.minVisibilityDistance, 0), b.minH !== undefined && b.maxH !== undefined && viewer.scene.preRender.addEventListener(function () {
                b.show && (b.alpha = TerraExplorer.internal.Navigate.HeightAboveGround < b.maxH && TerraExplorer.internal.Navigate.HeightAboveGround > b.minH ? 1 : 0)
            });
            return e.startLocation && (g.startLocation = !0), e.myLayer === TerraExplorer.SGWorld.Creator.CreateFor.UI && r && TerraExplorer.tools.ToolManager._tools.LayersTool.insertMyLayersKey(g), g.refresh = function () {
                var t = this.guid, r = this.show;
                if (this.minVisibilityDistance || this.maxVisibilityDistance) e.minVisibilityDistance = this.minVisibilityDistance, e.maxVisibilityDistance = this.maxVisibilityDistance;
                return viewer.imageryLayers.remove(g), g = n(e, !1), g.guid = t, g.show = r, g
            }, g
        }

        var t = this, r = n(e), i = new u({object: r});
        TerraExplorer.internal.Project.addLayersToObjectList(i);
        var s = Cesium.when.defer();
        return s.resolve(i), s
    }, a.prototype.createMeshLayers = function (t) {
        function r(t, n) {
            function u(e, t) {
                e.modelMatrix = Cesium.Matrix4.IDENTITY;
                var n = e._root._header.boundingVolume.region[4];
                t.altitudeOffset === undefined && (t.altitudeOffset = {});
                var r = e.getOriginPivot(), i = Cesium.Cartographic.fromCartesian(r);
                e.realAltitude = Cesium.defaultValue(t.altitudeOffset.altitude, n), e.origAltitude = Cesium.defaultValue(t.altitudeOffset.originalAltitude, n);
                var s = e.realAltitude - e.origAltitude;
                e.realAltitudeTEW = n + s;
                var o, u, a = t.altitudeOffset.originalLongitude, f = t.altitudeOffset.originalLatitude;
                o = Cesium.defaultValue(t.altitudeOffset.newLon, i.longitude), u = Cesium.defaultValue(t.altitudeOffset.newLat, i.latitude);
                if (f && a) {
                    var l = (o - a) * Math.PI / 180, c = (u - f) * Math.PI / 180;
                    o = i.longitude + l, u = i.latitude + c
                }
                e.setNewLayerBboxCenter(o, u), e.origPivotHeight = n, e.setPivot(o, u, e.realAltitudeTEW, !!a);
                var h = Cesium.Cartographic.fromRadians(o, u, e.realAltitudeTEW);
                return e.modelModifyTerrainHeight = e.realAltitudeTEW, e.bestLevelPromise = TerraExplorer.functions.queryBestLevel(h), Cesium.when(e.bestLevelPromise, function (t) {
                    e.level = t, Cesium.sampleTerrain(viewer.terrainProvider, e.level, [h]).then(function (t) {
                        var n = e.modelModifyTerrainHeight - t[0].height;
                        e.delta = n
                    })
                }), e
            }

            n == undefined && (n = !0), f(t.url, t.subdomains);
            var i = "";
            Cesium.getExtensionFromUri(t.name) !== "json" && (i = "/");
            var s = t.url.trim();
            s.toLocaleLowerCase().indexOf(t.name.toLocaleLowerCase()) == -1 && (s += "/" + t.name.trim() + i), TerraExplorer.tilesetVerticalDatumFlag !== undefined && TerraExplorer.tilesetVerticalDatumFlag !== "copy_z" && TerraExplorer.tilesetVerticalDatumFlag !== "" && (s += "?vdatum=" + TerraExplorer.tilesetVerticalDatumFlag);
            var o = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({
                url: s,
                maximumNumberOfLoadedTiles: TerraExplorer.max3DTiles,
                maximumScreenSpaceError: t.oversampling,
                preloadFlightDestinations: !1,
                subdomains: t.subdomains,
                myLayer: t.myLayer
            }));
            o.name = t.name, o.displayName = t.displayName, o.guid = Cesium.createGuid(), o.show = t.visibility, t.type == undefined && (t.type = "mesh"), o.type = t.type, o.timestamp = t.timestamp, o.myLayer = t.myLayer, o.modifyB3dmObjects = t.modifyB3dmObjects, o.useFloor = t.useFloor, o.layer = t, t.startLocation && (o.startLocation = !0), o.readyPromise.then(function (e) {
                e.reg = e._root._header.boundingVolume.region, u(e, e.layer), e.reg !== undefined && (e.oriRect = Cesium.Rectangle.unpack(e.reg, 0), e.deltaLon !== undefined && (e.curRect = new Cesium.Rectangle(e.oriRect.west + e.deltaLon, e.oriRect.south + e.deltaLat, e.oriRect.east + e.deltaLon, e.oriRect.north + e.deltaLat)))
            }), t.myLayer === TerraExplorer.SGWorld.Creator.CreateFor.UI && n && TerraExplorer.tools.ToolManager._tools.LayersTool.insertMyLayersKey(o), o.refresh = function () {
                var n = this.guid, i = this.show, s = this.delta, u = this.level, a = this.realAltitude,
                    f = this.origAltitude, l = this.origLongitude, c = this.origLatitude,
                    h = this.modelModifyTerrainHeight, p = this.modifyB3dmObjects;
                if (viewer.terrainProvider._modifyTerrainObjects !== undefined) {
                    var d = e.grep(viewer.terrainProvider._modifyTerrainObjects, function (e) {
                        return e.id === TerraExplorer.internal.Project._modelModifyTerrainObjects[n]
                    });
                    d.length === 1 && d[0].destroy()
                }
                return delete TerraExplorer.internal.Project._modelModifyTerrainObjects[this.guid], viewer.scene.primitives.remove(this), o = r(t, !1), o.guid = n, o.show = i, o.delta = s, o.level = u, o.realAltitude = a, o.origAltitude = f, o.origLongitude = l, o.origLatitude = c, o.modelModifyTerrainHeight = h, o.modifyB3dmObjects = p, o
            };
            var a = TerraExplorer.tools.ToolManager._tools.LayersTool;
            return o.delete = function () {
                a.deleteLayer(a.getItemFromLayer(o)), TerraExplorer.internal.Project._modelModifyTerrainObjects[this.guid] !== undefined && delete TerraExplorer.internal.Project._modelModifyTerrainObjects[this.guid]
            }, o
        }

        var n = [], i = this;
        return e(t).each(function (e, t) {
            var s = Cesium.when.defer();
            n.push(s);
            var o = r(t), a = new u({object: o});
            i.addLayersToObjectList(a), s.resolve(a)
        }), n
    }, a.prototype.CreatePointCloudModel = function (t) {
        function r(e, t) {
            t == undefined && (t = !0), f(e.url, e.subdomains);
            var n = "";
            Cesium.getExtensionFromUri(e.name) !== "json" && (n = "/");
            var i = e.url.trim();
            i.indexOf(e.name) == -1 && (i += "/" + e.name.trim() + n);
            var s = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({
                url: i,
                subdomains: e.subdomains,
                myLayer: e.myLayer,
                maximumScreenSpaceError: 64
            }));
            s.name = e.name, s.displayName = e.displayName, s.guid = Cesium.createGuid(), s.show = e.visibility, e.type == undefined && (e.type = "cpt"), s.type = e.type, s.myLayer = e.myLayer;
            var o = e.pointSize > 0 ? e.pointSize : undefined;
            o && Cesium.when(s.readyPromise, function (e) {
                e.style = new Cesium.Cesium3DTileStyle({pointSize: o})
            }), e.startLocation && (s.startLocation = !0), e.myLayer === TerraExplorer.SGWorld.Creator.CreateFor.UI && t && TerraExplorer.tools.ToolManager._tools.LayersTool.insertMyLayersKey(s), s.refresh = function () {
                var t = this.guid, n = this.show;
                return viewer.scene.primitives.remove(this), s = r(e, !1), s.guid = t, s.show = n, s
            };
            var u = TerraExplorer.tools.ToolManager._tools.LayersTool;
            return s.delete = function () {
                u.deleteLayer(u.getItemFromLayer(s))
            }, s
        }

        var n = [], i = this;
        return e(t).each(function (e, t) {
            var s = Cesium.when.defer();
            n.push(s);
            var o = r(t), a = new u({object: o});
            i.addLayersToObjectList(a), s.resolve(a)
        }), n
    }, a.prototype.readRasterBBOxFromServer = function (t, n) {
        var r = Cesium.when.defer(),
            i = this.replaceUrlWithRandomSubdomain(t.url, t.subdomains) + "?SERVICE=WMS" + "&REQUEST=GetCapabilities" + "&layers=" + t.name;
        return e.ajax({
            dataType: "xml", beforeSend: function (e) {
                e.withCredentials = !0
            }, url: i, success: function (e) {
                var i = e.getElementsByTagName("EX_GeographicBoundingBox");
                i.length == 0 ? (i = e.getElementsByTagName("LatLonBoundingBox"), i.length == 0 ? t.rectangle = Cesium.Rectangle.MAX_VALUE : t.rectangle = Cesium.Rectangle.fromDegrees(parseFloat(i[0].attributes.minx.value), parseFloat(i[0].attributes.miny.value), parseFloat(i[0].attributes.maxx.value), parseFloat(i[0].attributes.maxy.value))) : t.rectangle = Cesium.Rectangle.fromDegrees(parseFloat(i[0].getElementsByTagName("westBoundLongitude")[0].textContent), parseFloat(i[0].getElementsByTagName("southBoundLatitude")[0].textContent), parseFloat(i[0].getElementsByTagName("eastBoundLongitude")[0].textContent), parseFloat(i[0].getElementsByTagName("northBoundLatitude")[0].textContent)), n && n(t).then(function (e) {
                    r.resolve(e)
                })
            }, error: function () {
                r.reject("error")
            }
        }), r
    }, a.prototype.showBottomLeftErrorMessage = function (t, n) {
        var r = e.extend(!0, {}, n), i = this, s = Cesium.defaultValue(r.timeout, 0);
        TerraExplorer.tools.ToolDialog.showAlertDialog(t), e(".toolDialog").css({
            left: "280px",
            top: "93%",
            height: "30px",
            "background-color": "rgba(0,0,0,1.0)",
            width: "430px"
        }), e(".toolDialog .toolDialogLabel").css({
            top: "auto",
            color: "rgba(255,255,255,1.0)",
            "background-color": "rgba(0,0,0,1.0)"
        }).prepend("<img width=12 height=12 style='vertical-align: middle;' src='../terraexplorerweb/img/newDesign/errorIcon.png'/>&nbsp;&nbsp;"), e("#titleTextID").remove(), TerraExplorer.tools.ToolDialog.removeCloseButton(), e(".toolDialog #closeXID").css("visibility", "hidden"), e("#DialogSaveButton").parent().remove(), s && setTimeout(function () {
            i._cancelCloseAlert || e(".toolDialog #closeXID").click()
        }, s)
    }, a.prototype.displayUnsupportedLayersMessage = function () {
        var e = t.i18n("UnsupportedLayers_Alert", {
            aTag: "<a href=# style='text-decoration:none;color:rgba(13,194,223,1.0);' onclick='TerraExplorer.internal.Project.displayDetailedUnsupported();'>",
            closedATag: "</a>"
        });
        this.showBottomLeftErrorMessage(e, {timeout: 1e4})
    }, a.prototype.refreshPage = function () {
        window.location.href = window.location.href.replace("#", "")
    }, a.prototype.displayLoginLayersMessage = function () {
        var n = t.i18n("Login_Layers_Alert", {
            aTag: "<a href=# style='text-decoration:none;color:rgba(13,194,223,1.0);' onclick='TerraExplorer.internal.Project.refreshPage();'>",
            closedATag: "</a>"
        });
        this.showBottomLeftErrorMessage(n, {timeout: 12e3}), e(".toolDialog").width("80%"), e("#toolDialogTitleID").width("80%"), e(".toolDialogLabel").width("80%"), e(".toolDialog").css("top", "90%")
    }, a.prototype.displayDetailedUnsupported = function () {
        this._cancelCloseAlert = !0;
        var n = t.i18n("UnsupportedLayers_Alert_List") + "<br/><br/>", r = (this.UnsupportedLayers.length + 2) * 20,
            i = 1;
        this.UnsupportedLayers.forEach(function (t) {
            var r, s;
            if (t.displayName !== undefined) s = t.displayName.length > 20 ? t.displayName.substring(0, 20) : t.displayName, r = t.displayName.length > 20 ? "..." : ""; else if (t.name != undefined) s = t.name.length > 20 ? t.name.substring(0, 20) : t.name, r = t.name.length > 20 ? "..." : ""; else {
                var o = e(t).children("name").text();
                s = o.length > 20 ? o.substring(0, 20) : o, r = o.length > 20 ? "..." : ""
            }
            n += i + ") &nbsp;&nbsp;<span title='" + t.name + "'>" + s + "</span>" + r + "<span class='unsupportedLayers'>" + " - " + t.reason + "</span><br/><br/>", i++
        }), TerraExplorer.tools.ToolDialog.showAlertDialog(n), e(".toolDialog").css({
            left: "280px",
            top: "90%"
        }), e(".toolDialog").width("550"), e(".toolDialogLabel").width("530").height("180").css("overflow-y", "auto");
        var s = Number(e(".toolDialog").css("top").replace("px", ""));
        e(".toolDialog").height(e(".toolDialog").height() + r);
        var o = (s - r - 50).toString() + "px";
        e(".toolDialog").css("top", o), e("#titleTextID").html("Error Messages"), TerraExplorer.isTouch() && (e(".toolDialog").height("100%"), e(".toolDialog").width("100%"), e(".toolDialog").css("top", 0), e(".toolDialog").css("left", 0))
    }, a.prototype.getAvailableDefaultName = function (e, n) {
        for (var r = 0; r < this._allAvailableObjectsNames[e.type].length; r++) if (this._allAvailableObjectsNames[e.type][r] === undefined) return n === undefined && (this._allAvailableObjectsNames[e.type][r] = !0), Cesium.defaultValue(e.defaultName, t.i18n("OBJECT_WITHOUT_NAME")) + r.toString()
    }, a.prototype.findObjectFromID = function (e) {
        var t = s.getFeatureById(e);
        return t != null ? t : (t = this._featureLayers.getLayerContainingFid(e), t != null ? t : null)
    }, new a
}), define("internal/EngineCommon", ["jquery", "TELang", "KmlParser", "turf.min", "WorkerPool"], function (t, n, r, i, s) {
    "use strict";

    function f(e) {
        return ("0" + (e & 255).toString(16)).slice(-2)
    }

    function l(e, t, n, r) {
        const i = n, s = r;
        var o = t.west, u = t.east, a = t.south, f = t.north, l = u - o, c = f - a, h = e.longitude * 180 / Math.PI,
            p = e.latitude * 180 / Math.PI;
        return e.normalizedLongitude = (h - o) / l * n, e.normalizedLatitude = (p - a) / c * r, e
    }

    function c(e, t) {
        var n = new Cesium.Cartesian4(1, 1 / 255, 1 / 65025, 1 / 16581375), r = t, i = new Cesium.Cartesian4;
        i.x = e[r++], i.y = e[r++], i.z = e[r++], i.w = e[r], Cesium.Cartesian4.divideByScalar(i, 255, i);
        var s = Cesium.Cartesian4.dot(i, n);
        return isNaN(s) ? -1 : s
    }

    function h(e, t) {
        var n = t.center, r = t.radius, i = e.x, s = e.y, o = e.z;
        return Math.pow(i - n.x, 2) + Math.pow(s - n.y, 2) + Math.pow(o - n.z, 2) < Math.pow(r, 2) ? !0 : !1
    }

    function p(e, t, n, r) {
        var i = new Cesium.Cartesian4,
            s = Cesium.Matrix4.clone(viewer.scene.context.uniformState.inverseViewProjection),
            o = Cesium.Cartesian4.clone(Cesium.Cartesian4.UNIT_W, new Cesium.Cartesian4);
        o.x = e * 2 - 1, o.y = t * 2 - 1, o.z = n * 2 - 1, o.w = 1, i = Cesium.Matrix4.multiplyByVector(s, o, i);
        var u = 1 / i.w;
        Cesium.Cartesian3.multiplyByScalar(i, u, i);
        var a = Cesium.Cartesian3.fromCartesian4(i, new Cesium.Cartesian3),
            f = Cesium.Cartesian3.subtract(viewer.camera.position.clone(), a, new Cesium.Cartesian3),
            l = Cesium.Cartesian3.magnitude(f);
        return l
    }

    function d(e, t) {
        var n = t.length;
        for (var r = 0; r < n; ++r) {
            var i = t[r];
            if (e.indexOf(i) !== -1) return i
        }
    }

    function v(e) {
        if (e.byteLength > 2) {
            var t = new Uint8Array(e.byteLength > 0 ? e.slice(1, 4) : 0),
                n = t.length == 0 || t[0] == "P".charCodeAt() && t[1] == "N".charCodeAt() && t[2] == "G".charCodeAt();
            return n
        }
        return !1
    }

    function m(e) {
        if (e.byteLength > 80) {
            var t = 96, n = new DataView(e), r = n.getUint32(64, !0), i = n.getUint32(68, !0), s = n.getUint32(72, !0),
                o = n.getUint32(76, !0);
            return o == 1 ? !0 : !1
        }
        return !1
    }

    function g(e, t, n) {
        var r = Cesium.Rectangle.fromCartesianArray(t), i = e._pickObject.content.tile._boundingVolume, s = i.rectangle;
        if (s !== undefined) {
            if (Cesium.Rectangle.intersection(s, r) !== undefined) return !0
        } else {
            var o = n.obb2Brect(i.boundingVolume);
            if (Cesium.Rectangle.intersection(o, r) !== undefined) return !0
        }
        return !1
    }

    var o = function () {
        this._oTex = undefined, this._fullyContainingParents = {}, this._elevationValidationWorkerPool = new s({workerPath: "./js/sfsterrainprovider/ParseElevationWorker.js"})
    };
    const u = 256;
    var a = new Cesium.Cartesian3;
    Cesium.defineProperties(o.prototype, {}), o.prototype.convertToXYVertices = function (e, t, n, r) {
        var i = [], s = e[0].longitude !== undefined;
        return e.forEach(function (e) {
            var o = [], u = s ? e : viewer.scene.globe.ellipsoid.cartesianToCartographic(e);
            u = l(u, t, n, r), o.push(u.normalizedLongitude), o.push(u.normalizedLatitude), i.push(o)
        }), i
    }, o.prototype.showScreenTex = function (e, t) {
        TerraExplorer.canSTex = new Cesium.Texture({context: viewer.scene.context, source: viewer.canvas});
        var n = TerraExplorer.internal.Project,
            r = "uniform sampler2D sTex; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec3 e = texture2D(sTex, v_textureCoordinates).rgb; \n     gl_FragColor = vec4(e, 1.0)*0.3;\n}\n";
        viewer.scene.debugLoadingCommand = viewer.scene.context.createViewportQuadCommand(r, {
            uniformMap: {
                sTex: function () {
                    return TerraExplorer.canSTex !== undefined ? TerraExplorer.canSTex : viewer.scene.slopeMapTexture
                }
            }
        }), viewer.scene.debugLoadingCommand.pass = Cesium.Pass.OVERLAY;
        var i = viewer.canvas.width, s = viewer.canvas.height, o = new Cesium.BoundingRectangle;
        o.x = 0, o.y = 0;
        var u = Math.max(i, s);
        o.width = e, o.height = t, viewer.scene.debugLoadingCommand.renderState = Cesium.RenderState.fromCache({viewport: Cesium.BoundingRectangle.clone(o)})
    }, o.prototype.getPromiseTerrain = function (e) {
        var t = Cesium.when.defer();
        if (e) t.resolve(1); else {
            var n = function () {
                viewer.scene.globe._surface._lastTileLoadQueueLength === 0 && (viewer.scene.postRender.removeEventListener(n), t.resolve(1))
            };
            viewer.scene.postRender.addEventListener(n)
        }
        return t
    }, o.prototype.removeScreenTex = function () {
        viewer.scene.debugLoadingCommand = undefined
    }, o.prototype.isOnMeshLayer = function (e) {
        var t = TerraExplorer.internal.Project.MeshLayers, n = undefined;
        return t.forEach(function (t) {
            if (t !== undefined && t._root !== undefined) {
                var r = t.boundingSphere;
                h(e, r) && (n = t)
            }
        }), n
    }, o.prototype.queryElevationBuffer = function (n, r, i) {
        function s(e) {
            var t = Number.MIN_VALUE;
            return e.forEach(function (e) {
                var n = viewer.scene.globe.ellipsoid.cartesianToCartographic(e).height;
                t = Math.max(t, n)
            }), t
        }

        function o(e) {
            var t = Number.MAX_VALUE;
            return e.forEach(function (e) {
                var n = viewer.scene.globe.ellipsoid.cartesianToCartographic(e).height;
                t = Math.min(t, n)
            }), t
        }

        function u(e) {
            var t = Number.MAX_VALUE, n = TerraExplorer.internal.Project._modifyTerrainObjects;
            return n.forEach(function (n) {
                if (Cesium.Rectangle.intersection(e, n._object.rectangle) !== undefined) {
                    var r = n._object.heights.length !== undefined ? n._object.heights[0] : n._object.heights;
                    t = Math.min(r, t)
                }
            }), t
        }

        function a(e) {
            var t = Number.MIN_VALUE, n = TerraExplorer.internal.Project._modifyTerrainObjects;
            return n.forEach(function (n) {
                if (Cesium.Rectangle.intersection(e, n._object.rectangle) !== undefined) {
                    var r = n._object.heights.length !== undefined ? n._object.heights[0] : n._object.heights;
                    t = Math.max(r, t)
                }
            }), t
        }

        this.showScreenTex(2048, 2048);
        var f = Cesium.when.defer(), l = this, c, h, p;
        c = viewer.camera.position.clone(), h = viewer.camera.heading, p = viewer.camera.pitch;
        var d = Cesium.Rectangle.fromCartesianArray(n), v = s(n), m = o(n), g = a(d), y = u(d),
            b = Cesium.ApproximateTerrainHeights.getMinimumMaximumHeights(d).maximumTerrainHeight,
            w = Math.max(g, v, b) + 500, E = Math.min(y, m),
            S = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Rectangle.northwest(d)),
            x = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Rectangle.southeast(d)),
            T = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Rectangle.northeast(d)),
            N = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Rectangle.southwest(d)),
            C = Cesium.Cartesian3.distance(S, T), k = Cesium.Cartesian3.distance(S, N);
        this._sqrMetersPerPixel = Math.pow(C / r, 2);
        var L = C, A = k,
            O = Cesium.Cartographic.fromRadians(d.west + (d.east - d.west) / 2, d.south + (d.north - d.south) / 2),
            M = O.clone(), _ = this.isOnMeshLayer(viewer.scene.globe.ellipsoid.cartographicToCartesian(M));
        if (_ !== undefined) var D = viewer.scene.globe.ellipsoid.cartesianToCartographic(_.boundingSphere.center).height + 1e3;
        M.referenceAltitude = i, this._cNear = 1, this._cFar = M.height = D !== undefined ? D : w, E < 0 ? (this._cFar -= E - 2, this._belowZero = !0) : this._belowZero = !1, viewer.camera.setView({destination: Cesium.Cartesian3.fromDegrees(0, 0, 5e3)});
        var P = viewer.canvas.width, H = viewer.canvas.height, B = viewer.camera.frustum.far,
            j = viewer.camera.frustum.clone();
        return l.normalStateObj = {
            pos: c,
            heading: h,
            pitch: p,
            origCanvasWidth: P,
            origCanvasHeight: H,
            prevFar: B,
            prevFrustum: j
        }, Cesium.when(this.wait(3), function () {
            var e = viewer.scene.globe.ellipsoid.cartographicToCartesian(M), i = h, s = Cesium.Math.toRadians(-90);
            viewer.camera.setView({
                destination: e,
                orientation: {heading: i, pitch: s}
            }), viewer.canvas.width = r, viewer.canvas.height = r, viewer.forceResize();
            var o = {width: L, aspectRatio: 1, near: l._cNear, far: l._cFar}, u = new Cesium.OrthographicFrustum(o);
            u.preserveRatioOne = !0, viewer.camera.frustum = u;
            var a = l.getPromiseTerrain(_ !== undefined && _.rootFloorAdded !== undefined), c = [],
                p = viewer.camera.frustum.computeCullingVolume(viewer.camera.position, viewer.camera.direction, viewer.camera.up);
            t(TerraExplorer.internal.Project.MeshLayers).each(function (e, t) {
                t.ready && p.computeVisibility(t.boundingSphere) != Cesium.Intersect.OUTSIDE && c.push(t)
            });
            var v = c.length, m, g = Cesium.when.defer();
            g.resolve(1), Cesium.when.all([a, g], function () {
                TerraExplorer.volumeCalc = !0;
                var e = l.wait(3);
                Cesium.when(e, function () {
                    var e = Cesium.Matrix4.inverse(viewer.camera.frustum.projectionMatrix, new Cesium.Matrix4);
                    l.maxDepth = M.height - M.referenceAltitude;
                    var t = viewer.scene._view.pickDepths[0]._framebuffer,
                        i = viewer.scene.context.readPixels({x: 0, y: 0, width: r, height: r, framebuffer: t});
                    TerraExplorer.depthPixelsTex = l.createCesiumTexture(i, r, r);
                    var s = d.west * Cesium.Math.DEGREES_PER_RADIAN, o = d.east * Cesium.Math.DEGREES_PER_RADIAN,
                        u = d.south * Cesium.Math.DEGREES_PER_RADIAN, a = d.north * Cesium.Math.DEGREES_PER_RADIAN,
                        c = new Cesium.Rectangle(s, u, o, a), h = l.convertToXYVertices(n, c, r, r),
                        p = l.drawPolygonOnCanvas(h, "#FF00FF", r, r), v = p.getContext("2d"),
                        m = v.getImageData(0, 0, r, r).data, g = Uint8Array.from(m), y = l.createCesiumTexture(g, r, r);
                    TerraExplorer.cTex = y;
                    var b = viewer.scene.frameState, w = viewer.scene._passState, E = b.context, S = r, x = r;
                    l._oTex = new Cesium.Texture({
                        context: E,
                        width: S,
                        height: x,
                        pixelFormat: Cesium.PixelFormat.R,
                        pixelDatatype: Cesium.PixelDatatype.FLOAT
                    });
                    var T = "uniform sampler2D clippingPolygonTex; \nuniform sampler2D depthPixelsTex; \nuniform float maxDepth; \nuniform float f; \nuniform mat4 invProj; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec4 clipPix = texture2D(clippingPolygonTex, vec2(v_textureCoordinates.x,1.0 -v_textureCoordinates.y)).rgba; \n    bool cPix;\n    vec4 pix = texture2D(depthPixelsTex, vec2(v_textureCoordinates.x,1.0 -v_textureCoordinates.y)).rgba; \n	 float d = dot(pix, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n    cPix = (clipPix.r > 0. && clipPix.g == 0.0 && clipPix.b > 0.);\n    vec4 tempVec = vec4(v_textureCoordinates.xy * vec2(2.0,2.0) - vec2(1.0,1.0), d, 1.0);\n    tempVec = invProj * tempVec;\n    vec3 eC = tempVec.xyz / tempVec.w;\n    float delta =  maxDepth - abs(eC.z);\n    float c = (cPix) ? (delta >= 0.) ? delta*2.0 : delta : -9999. ; \n    gl_FragColor = vec4(c,0.0,0.0,0.0); \n}\n",
                        N = {
                            depthPixelsTex: function () {
                                return TerraExplorer.depthPixelsTex != undefined ? TerraExplorer.depthPixelsTex : viewer.scene.slopeMapTexture
                            }, f: function () {
                                return TerraExplorer.factor !== undefined ? TerraExplorer.factor : 1
                            }, clippingPolygonTex: function () {
                                return TerraExplorer.cTex !== undefined ? TerraExplorer.cTex : viewer.scene.slopeMapTexture
                            }, maxDepth: function () {
                                return TerraExplorer.internal.Engine.maxDepth
                            }, invProj: function () {
                                return e
                            }
                        }, C;
                    l.computeCommand = new Cesium.ComputeCommand({
                        fragmentShaderSource: T,
                        outputTexture: l._oTex,
                        uniformMap: N,
                        persists: !1,
                        owner: l,
                        postExecute: function () {
                            C = l._oTex;
                            var e = new Cesium.Framebuffer({
                                context: E,
                                colorTextures: [l._oTex],
                                destroyAttachments: !0
                            });
                            l._elevationBufferPixels = E.readPixels({x: 0, y: 0, width: S, height: x, framebuffer: e});
                            var t = new Float32Array(S * x);
                            for (var n = 0; n < x; n++) for (var r = 0; r < S; r++) t[n * S + r] = l._elevationBufferPixels[(n * S + r) * 4];
                            t.sqrMetersPerPixel = l._sqrMetersPerPixel, f.resolve(t), setTimeout(function () {
                                l.returnToNormal(l.normalStateObj)
                            }, 500), l.computeCommand = undefined
                        }
                    }), l.computeCommand.pass = Cesium.Pass.COMPUTE
                })
            }).otherwise(function (e) {
                f.reject(e), l.returnToNormal(normalStateObj)
            })
        }).otherwise(function () {
            f.reject(e), l.returnToNormal(l.normalStateObj)
        }), f
    }, o.prototype.createPolygonTex = function (e, t, n, r) {
        var i = Math.max(t, n), s = Cesium.Rectangle.fromCartesianArray(e), o = s.west * Cesium.Math.DEGREES_PER_RADIAN,
            u = s.east * Cesium.Math.DEGREES_PER_RADIAN, a = s.south * Cesium.Math.DEGREES_PER_RADIAN,
            f = s.north * Cesium.Math.DEGREES_PER_RADIAN, l = new Cesium.Rectangle(o, a, u, f),
            c = this.convertToXYVertices(e, l, i, i), h = this.drawPolygonOnCanvas(c, "#FF00FF", i, i),
            p = h.getContext("2d");
        if (r) {
            var d = viewer.terrainProvider.findDirectParent(s);
            h.containingParent = d
        }
        return h
    }, o.prototype.createImageFromPixels = function (e, t, n) {
        var r = Cesium.when.defer(), i = document.createElement("canvas");
        i.width = t, i.height = n;
        var s = i.getContext("2d"), o = s.getImageData(0, 0, t, n);
        for (var u = 0; u < n; u++) for (var a = 0; a < t; a++) {
            var f = (n - 1 - u) * t + a, l = (u * t + a) * 4;
            o.data[f * 4 + 0] = e[l + 0], o.data[f * 4 + 1] = e[l + 1], o.data[f * 4 + 2] = e[l + 2], o.data[f * 4 + 3] = 255
        }
        s.putImageData(o, 0, 0);
        var c = i.toDataURL(), h = document.createElement("img");
        return h.src = c, h.onload = function () {
            r.resolve(this)
        }, r
    }, o.prototype.replaceTagWithOriginalDomain = function (e, t) {
        var n;
        return e.indexOf("{s}") != -1 ? n = t != undefined && t.length > 0 ? e.replace("{s}", t[0]) : console.error("Error - sTag with no subdomains.") : n = e, n
    }, o.prototype.isCameraInsideMeshFloorPolygon = function (e) {
        if (e.rootFloorAdded === undefined) return !1;
        var t = viewer.camera.positionCartographic, n = t.height, r = e._root.boundingVolume, i = r.minimumHeight,
            s = r.maximumHeight;
        if (n > s || n < i || !Cesium.Rectangle.contains(e.rootFloorRectangle, t)) return !1;
        var o = e.rootFloorCanvasPolygon, a = l(t, e.rootFloorRectangleDegrees, u, u),
            f = {x: a.normalizedLongitude, y: a.normalizedLatitude}, c = Math.floor(f.x), h = Math.floor(f.y),
            p = h * u + c;
        return e.rootFloorPixels[p * 4] === 255 ? !0 : !1
    }, o.prototype.isPointInsidePolygon = function (e, t, n, r) {
        var i, s = n.length - 1, o = !1, u = n, a = r;
        for (i = 0; i < n.length; i++) (a[i] < t && a[s] >= t || a[s] < t && a[i] >= t) && (u[i] <= e || u[s] <= e) && (o ^= u[i] + (t - a[i]) / (a[s] - a[i]) * (u[s] - u[i]) < e), s = i;
        return o
    }, o.prototype.displayPixelsOnCanvas = function (e, t, n, r) {
        var i = document.createElement("canvas");
        i.width = t, i.height = n;
        var s = i.getContext("2d"), o = s.getImageData(0, 0, t, n);
        for (var u = 0; u < n; u++) for (var a = 0; a < t; a++) {
            var f = (n - 1 - u) * t + a, l = (u * t + a) * 4,
                c = TerraExplorer.tools.ToolManager._tools.VolumeAnalysis._volAltitude;
            o.data[f * 4 + 0] = e[l + 0] % 255, o.data[f * 4 + 1] = e[l + 0] % 255, o.data[f * 4 + 2] = e[l + 0] % 255, o.data[f * 4 + 3] = 255;
            if (r !== undefined && r.bbox !== undefined) {
                var h = r.bbox.x * t, p = r.bbox.y * n, d = r.bbox.height * n, v = r.bbox.width * t;
                a >= h && u >= p && u <= d + p && a <= v + h && (o.data[f * 4 + 0] = 255, o.data[f * 4 + 1] = 0, o.data[f * 4 + 2] = 0, o.data[f * 4 + 3] = 255)
            }
        }
        s.putImageData(o, 0, 0), this.displayCanvasAsImage(i)
    }, o.prototype.createTextureFromImage = function (e) {
        return new Cesium.Texture({
            context: viewer.scene.context,
            pixelFormat: Cesium.PixelFormat.RGBA,
            pixelDatatype: Cesium.PixelDatatype.UNSIGNED_BYTE,
            source: e,
            sampler: new Cesium.Sampler({
                wrapT: Cesium.TextureWrap.CLAMP_TO_EDGE,
                wrapS: Cesium.TextureWrap.CLAMP_TO_EDGE,
                minificationFilter: Cesium.TextureMinificationFilter.LINEAR,
                magnificationFilter: Cesium.TextureMagnificationFilter.LINEAR
            })
        })
    }, o.prototype.getB3dmEffectsUniforms = function (e) {
        var t, n, r = viewer.scene.globe.ellipsoid;
        if (e._pickObject !== undefined) {
            t = e._pickObject.content._tile.boundingSphere.center;
            var i = e._pickObject.primitive;
            i._root !== undefined && i._root._header !== undefined && i._root._header.boundingVolume !== undefined && i._root._header.boundingVolume.region !== undefined && (n = i._root._header.boundingVolume.region);
            var s = i._root.boundingVolume.minimumHeight, o = i._root.boundingVolume.maximumHeight;
            (s === undefined || o === undefined) && n !== undefined && (s = n[4], o = n[5]);
            var u = o - s
        } else e._boundingSphere !== undefined && e._pickObject === undefined && (t = e._boundingSphere.center);
        var a = Cesium.Cartographic.fromCartesian(t);
        if (n !== undefined) var f = Cesium.Rectangle.fromRadians(n[0], n[1], n[2], n[3]),
            l = r.cartographicToCartesian(Cesium.Rectangle.northeast(f)),
            c = r.cartographicToCartesian(Cesium.Rectangle.southwest(f)), h = Cesium.Cartesian3.distance(l, c),
            p = -50 * h;
        p === undefined && (p = -5e3);
        var d = Cesium.Cartesian3.fromRadians(a.longitude, a.latitude, p), v = new Cesium.EncodedCartesian3;
        Cesium.EncodedCartesian3.fromCartesian(d, v);
        var m = Cesium.Cartesian3.normalize(t, new Cesium.Cartesian3),
            g = Cesium.defined(TerraExplorer.elevationColorsTexture) ? TerraExplorer.elevationColorsTexture : viewer.scene.createElevationTextureFromPallete(viewer.scene.ContourMapPallete),
            y = Cesium.defined(TerraExplorer.elevationColorsLinearTexture) ? TerraExplorer.elevationColorsLinearTexture : viewer.scene.createElevationTextureFromPallete(viewer.scene.ContourMapLinearPallete),
            b = TerraExplorer.elevationDelta, w = TerraExplorer.elevationMin, E = {};
        return E.u_encodedCenterHigh = function () {
            return v.high
        }, E.u_encodedCenterLow = function () {
            return v.low
        }, E.u_diagonal50 = function () {
            return p
        }, E.u_minHeightB3dm = function () {
            return s === undefined ? 0 : s
        }, E.u_deltaB3dm = function () {
            return u === undefined ? 1e3 : u
        }, E.u_contourColorsTexture = function () {
            return TerraExplorer.internal.Settings.contourB3dmTextureMode > 0 ? y : g
        }, E.u_contourElevationDelta = function () {
            return b
        }, E.u_contourElevationMin = function () {
            return w
        }, E.u_contourRepeat = function () {
            return TerraExplorer.internal.Settings.contourB3dmTextureMode
        }, E.u_contourMode = function () {
            return !!TerraExplorer.internal.Settings.contourMode
        }, E.u_slopeTexture = function () {
            return viewer.scene.slopeMapTexture !== undefined ? viewer.scene.slopeMapTexture : (viewer.scene.slopeMapTexture = viewer.scene.createElevationTextureFromPallete(viewer.scene.SlopeMapPallete, !0), viewer.scene.slopeMapTexture)
        }, E.u_isSlopeMap = function () {
            return viewer.scene.displaySlopeMap
        }, E.u_isElevationMap = function () {
            return viewer.scene.showContourColors
        }, E.u_pivotNormal = function () {
            return m
        }, E.u_isLightingEnabled = function () {
            return viewer.scene.globe.enableLighting
        }, E.u_brightnessValue = function () {
            return viewer.scene.brightnessValue
        }, E.u_slsaturation = function () {
            return Cesium.Batched3DModel3DTileContent.slsaturation == undefined ? 1.3 : Cesium.Batched3DModel3DTileContent.slsaturation
        }, E
    }, o.prototype.addEffectsToB3dmFs = function (e, t) {
        if (t.fs !== undefined) return t.fs;
        var n = viewer.scene.context._depthTexture;
        if (e.indexOf("v_texcoord0") > -1) var e = e.replace("gl_FragColor = color;", "gl_FragColor = vec4(pow(texture2D(u_diffuse, v_texcoord0).rgb,vec3(1./1.7))*(diffuseIntensity*0.3+0.7),1.);");
        e.indexOf("APPLY_SL_SATURATION") != -1 && (t._useSLSaturation = !0, e = "#define APPLY_SL_SATURATION\n" + e);
        var r = Cesium.defaultValue(d(e, ["v_normalEC", "v_normal"]), "vec3(1.0)"),
            i = Cesium.defaultValue(d(e, ["v_positionEC", "v_position"]), "czm_windowToEyeCoordinates(gl_FragCoord)"),
            s, o;
        n ? (s = Cesium.ShaderSource.replaceMain(e, "sl_b3dm_original_main"), o = "#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform bool u_contourMode;uniform bool u_isLightingEnabled; uniform float u_brightnessValue; uniform bool u_isElevationMap; uniform bool u_isSlopeMap; uniform vec3 u_pivotNormal;\nuniform float u_diagonal50;uniform float u_contourRepeat;uniform sampler2D u_contourColorsTexture;uniform float u_deltaB3dm;uniform float u_minHeightB3dm; uniform float u_contourElevationDelta;uniform float u_contourElevationMin;uniform vec3 u_encodedCenterHigh; uniform vec3 u_encodedCenterLow;uniform sampler2D u_slopeTexture; varying vec3 v_position2; varying float isSLShader; varying vec3 v_normal2;\nvoid main() {\n   sl_b3dm_original_main(); \n   if (!u_isElevationMap && !u_isSlopeMap) {\n       if (u_isLightingEnabled) {\n           gl_FragColor = vec4(mix(vec3(0.),gl_FragColor.rgb,(u_brightnessValue*0.7)+0.3),1.) ;\n       }\n   }\n else if (u_isElevationMap){\n   vec4 p = czm_translateRelativeToEye(u_encodedCenterHigh, u_encodedCenterLow);\n   vec4 positionEC_Center = czm_modelViewRelativeToEye * p;\n   vec3 subV = " + i + ".xyz - positionEC_Center.xyz;\n" + "   float lenSubV = length(subV);\n" + "float gradientFactor = 1.0;\n" + "vec3 gradientColor = vec3(1.0,1.0,1.0);\n" + "vec3 gradientColor2 =vec3(1.0,1.0,1.0);\n" + "float localHeight = lenSubV; \n" + "float realDist = length(" + i + ".xyz);\n" + " float dis = length(" + i + ".xyz)/(0.01666 * max(czm_viewport.z,czm_viewport.w) * 2.);\n" + " float weighted_dist = log(dis)/log(10.);\n" + " float scale_factor = floor(weighted_dist);\n" + "if (realDist > 1500. || realDist < 2.){scale_factor = 11.;}\n" + " float alpha_factor = 5.-5.*fract(weighted_dist);\n" + " if (alpha_factor > 1.)\n" + "     alpha_factor = 1.;\n" + " float s1 = pow(10., scale_factor);\n" + " float s2 = s1 * 5.;\n" + " float s3 = s2 * 5.;\n" + " float ffy = dFdy(localHeight);\n" + " float ffx = dFdx(localHeight);\n" + " float ffyy = max(ffy, ffx);\n" + " float ffyyBold = max(ffy, ffx)*2.;\n" + " float l1 = 1. / s1;\n" + " float l2 = 2. / s2;\n" + " float l3 = 2. / s3;\n" + " float v1b = fract(localHeight / s1) - (ffyy*l1 / 2.0);\n" + " float v2b = fract(localHeight / s2) - (ffyy*l2 / 2.0);\n" + " float v3b = fract(localHeight / s3) - (ffyyBold*l3 / 2.0);\n" + " float v1d = v1b + (ffyy * l1);\n" + " float v2d = v2b + (ffyy * l2);\n" + " float v3d = v3b + (ffyyBold * l3);\n" + " float b1 =  fract(v1b);\n" + " float d1 =  fract(v1d);\n" + " float b2 =  fract(v2b);\n" + " float d2 =  fract(v2d);\n" + " float b3 =  fract(v3b);\n" + " float d3 =  fract(v3d);\n" + " alpha_factor = 1.;\n" + "float gradientHeight = localHeight + u_diagonal50;\n" + " if (gradientHeight < 1.){gradientColor = texture2D(u_contourColorsTexture,vec2(0.,0.)).rgb;}\n" + "else {\n" + "gradientColor = texture2D(u_contourColorsTexture,vec2(0.,clamp((gradientHeight + u_contourElevationMin)/u_contourElevationDelta,0.,1.))).rgb;\n" + "gradientColor2 = texture2D(u_contourColorsTexture,vec2(0.,fract(gradientHeight/60.0))).rgb;\n" + "float vv = 0.8-clamp((length(v_positionEC)-20000.0)/30000.0,0.0,1.0)*0.8;\n" + "if (u_contourRepeat>0.){gradientColor = gradientColor.rgb * vec3(1.0-vv) + gradientColor2.rgb * vec3(vv);}}\n" + "if (u_contourMode){\n" + " if (scale_factor < 10.)\n" + " {\n" + "     if (abs(b1 - d1) > 0.5){\n" + "         gl_FragColor.xyzw = mix(gl_FragColor, vec4(0.33,0.33, 0.33, gl_FragColor.w), alpha_factor);}\n" + "         \n" + "     if (abs(b2 - d2) > 0.5)\n" + "     {\n" + "         if (abs(b3 - d3) > 0.5){\n" + "             gl_FragColor.xyzw = vec4(0., 0., 0., gl_FragColor.w);return;}\n" + "         else{\n" + "             gl_FragColor.xyzw = mix(vec4(0.33, 0.33, 0.33, gl_FragColor.w), vec4(0., 0., 0., gl_FragColor.w), alpha_factor);return;}\n" + "     }\n" + " }}\n" + " gl_FragColor = vec4(gl_FragColor.xyz*(0.5+0.65*(1.-gradientFactor))+gradientColor*0.35*gradientFactor,1.);\n" + "}\n" + "   else if (u_isSlopeMap){\n" + "   vec3 nffy = dFdy(" + i + ".xyz);\n" + "   vec3 nffx = dFdx(" + i + ".xyz);\n" + "   vec3 nEC = normalize(cross(nffx,nffy));\n" + "   vec3 nMC = czm_inverseNormal * nEC;\n" + "       vec3 normal = nMC;\n" + "       float nDotL = clamp(dot(u_pivotNormal,normal),0.,1.); \n" + "       vec3 tex = texture2D(u_slopeTexture,vec2(0.,nDotL)).rgb; \n" + "       gl_FragColor = vec4(tex*0.5 + 0.5*gl_FragColor.rgb,1.0); \n" + "  }\n", TerraExplorer.onlyFloor ? o += "gl_FragColor=vec4(gl_FragColor.rgb,0.001);\n}\n" : o += "}\n", s.indexOf("vec3 normal = normalize(v_normal);") > -1 && s.replace("vec3 normal = normalize(v_normal);", "vec3 nffy = dFdy(v_positionEC.xyz);vec3 nffx = dFdx(v_positionEC.xyz);vec3 nEC = normalize(cross(nffx,nffy));vec3 nMC = czm_inverseNormal * nEC;vec3 normal = nMC;"), s.indexOf("v_normal ") === -1 && s.indexOf("v_normal;") === -1 && (o = o.replace("void main", "varying vec3 v_normal; void main")), s.indexOf("v_positionEC") === -1 && (o = o.replace("void main", "varying vec3 v_positionEC; void main"))) : (s = e, s.indexOf("v_normal ") === -1 && s.indexOf("v_normal;") === -1 && (s = s.replace("void main", "varying vec3 v_normal; void main")), s.indexOf("v_positionEC") === -1 && (s = s.replace("void main", "varying vec3 v_positionEC; void main")));
        if (s.indexOf("max(dot(normal, vec3(0., 0., 1.)), 0.)*0.7;") > -1) var s = s.replace("gl_FragColor = color;", "gl_FragColor = vec4(pow(u_diffuse.rgb,vec3(1./1.9))*(dot(czm_sunDirectionEC,normal)*0.3+0.7),1.);");
        var u;
        return n ? u = s + "\n" + o : u = s + "\n", t.fs = u, u
    }, o.prototype.addEffectsToB3dmVs = function (e, t) {
        return t.vs !== undefined ? t.vs : (e.indexOf("vec3 oct_to_float32x3(vec2 e)") > -1 ? (e.indexOf("void tile_main") > -1 ? e = e.replace("void tile_main", "varying vec3 v_normal2;varying float isSLShader; void tile_main") : e = e.replace("void main", "varying vec3 v_normal2;varying float isSLShader; void main"), e = e.replace("gl_Position", "v_normal2 = a_normal; isSLShader = 1.0; gl_Position"), e.indexOf("v_positionEC") === -1 && e.indexOf("vec4 pos ") > -1 && (e = e.replace("void main", "varying vec3 v_positionEC; void main"), e = e.replace("gl_Position", "v_positionEC = pos.xyz; gl_Position"))) : (e.indexOf("void tile_main") > -1 ? e = e.replace("void tile_main", "varying vec3 v_normal2;varying float isSLShader; void tile_main") : e = e.replace("void main", "varying vec3 v_normal2;varying float isSLShader; void main"), e = e.replace("gl_Position", "v_normal2 = vec3(1.0); isSLShader = 0.0; gl_Position"), e.indexOf("v_normal ") === -1 && e.indexOf("v_normal;") === -1 && (e.indexOf("void tile_main") > -1 ? e = e.replace("void tile_main", "varying vec3 v_normal;void tile_main") : e = e.replace("void main", "varying vec3 v_normal;void main"), e = e.replace("gl_Position", "v_normal = vec3(1.0); gl_Position")), e.indexOf("v_positionEC") === -1 && (e.indexOf("void tile_main") > -1 ? e = e.replace("void tile_main", "varying vec3 v_positionEC; void tile_main") : (e = e.replace("void main", "varying vec3 v_positionEC; void main"), e = e.replace("gl_Position", ";v_positionEC = (u_mv * vec4(a_pos, 1.0)).xyz; gl_Position")))), t.vs = e, e)
    }, o.prototype.createCesiumTexture = function (e, t, n) {
        return new Cesium.Texture({
            context: viewer.scene.context,
            pixelFormat: Cesium.PixelFormat.RGBA,
            pixelDatatype: Cesium.PixelDatatype.UNSIGNED_BYTE,
            source: {width: Cesium.defaultValue(t, 2048), height: Cesium.defaultValue(n, 2048), arrayBufferView: e},
            sampler: new Cesium.Sampler({
                wrapS: Cesium.TextureWrap.CLAMP_TO_EDGE,
                wrapT: Cesium.TextureWrap.CLAMP_TO_EDGE,
                minificationFilter: Cesium.TextureMinificationFilter.LINEAR,
                magnificationFilter: Cesium.TextureMagnificationFilter.LINEAR
            })
        })
    }, o.prototype.showDebugDepth = function () {
        var e = "uniform sampler2D clippingPolygonTex; \nuniform sampler2D depthPixelsTex; \nuniform float f; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    float z_window = czm_unpackDepth(texture2D(depthPixelsTex, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n",
            t = "uniform sampler2D clippingPolygonTex; \nuniform sampler2D depthPixelsTex; \nuniform float f; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec4 clipPix = texture2D(clippingPolygonTex, vec2(v_textureCoordinates.x,1.0 -v_textureCoordinates.y)).rgba; \n    bool cPix;\n    vec4 pix = texture2D(depthPixelsTex, vec2(v_textureCoordinates.x,1.0 -v_textureCoordinates.y)).rgba; \n	 float d = dot(pix, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n    cPix = (clipPix.r > 0. && clipPix.g == 0.0 && clipPix.b > 0.);\n    float c = (cPix) ? fract(d * f) : 0. ; \n    gl_FragColor = vec4(vec3(c), 1.0); \n}\n";
        viewer.scene.debugDepthCommand = viewer.scene.context.createViewportQuadCommand(t, {
            uniformMap: {
                depthPixelsTex: function () {
                    return TerraExplorer.depthPixelsTex != undefined ? TerraExplorer.depthPixelsTex : viewer.scene.slopeMapTexture
                }, f: function () {
                    return TerraExplorer.factor !== undefined ? TerraExplorer.factor : 1
                }, clippingPolygonTex: function () {
                    return TerraExplorer.cTex !== undefined ? TerraExplorer.cTex : viewer.scene.slopeMapTexture
                }
            }, owner: TerraExplorer
        }), viewer.scene.debugDepthCommand.pass = Cesium.Pass.OVERLAY;
        var n = viewer.canvas.width, r = viewer.canvas.height, i = new Cesium.BoundingRectangle;
        i.x = Math.floor(n * .7), i.y = Math.floor(r * .1);
        var s = Math.max(n, r);
        i.width = Math.floor(s * .2), i.height = Math.floor(s * .2), viewer.scene.debugDepthCommand.renderState = Cesium.RenderState.fromCache({viewport: Cesium.BoundingRectangle.clone(i)})
    }, o.prototype.returnToNormal = function (e) {
        TerraExplorer.volumeCalc = undefined, viewer.camera.frustum = e.prevFrustum, viewer.camera.switchToPerspectiveFrustum(), viewer.camera.setView({
            destination: e.pos,
            orientation: {heading: e.heading, pitch: e.pitch}
        }), viewer.canvas.width = e.origCanvasWidth, viewer.canvas.height = e.origCanvasHeight, viewer.forceResize(), viewer.camera.frustum.far = e.prevFar, viewer.scene.context.uniformState.updateCamera(viewer.camera), TerraExplorer.depthPixelsTex.destroy(), TerraExplorer.internal.Engine.removeScreenTex()
    }, o.prototype.isValidElevation = function (e) {
        return this._elevationValidationWorkerPool.queueWorkItem(e)
    }, o.prototype.isMPT = function (e) {
        return m(e)
    }, o.prototype.isPNG = function (e) {
        return v(e)
    }, o.prototype.displayCanvasAsImage = function (e) {
        var n = e.toDataURL(), r = document.createElement("img");
        r.src = n, r.style.width = "200px", r.style.height = "200px", r.style.position = "absolute", r.style.left = "50%", r.style.bottom = "100px", t(r).css("z-index", 1e5), document.body.appendChild(r)
    }, o.prototype.findFullyContainingParentRectangle = function (e, t, n) {
        function r(e, t) {
            return Cesium.Rectangle.contains(e.rectangle, Cesium.Rectangle.northwest(t)) && Cesium.Rectangle.contains(e.rectangle, Cesium.Rectangle.northeast(t)) && Cesium.Rectangle.contains(e.rectangle, Cesium.Rectangle.southeast(t)) && Cesium.Rectangle.contains(e.rectangle, Cesium.Rectangle.southwest(t))
        }

        this._fullyContainingParents[n] = e;
        if (t === undefined) return;
        r(t, e) ? this._fullyContainingParents[n] = t : (t._parent === undefined && (this._fullyContainingParents[n] = t), t = t._parent, this.findFullyContainingParentRectangle(e, t, n))
    }, o.prototype.getMinMaxHeightPolylineGeom = function (e) {
        var n = TerraExplorer.internal.Project.MeshLayers, r = Cesium.Rectangle.fromCartesianArray(e),
            i = t.grep(n, function (e) {
                return e.show && e.rootFloorRectangle !== undefined && Cesium.Rectangle.intersection(r, e.rootFloorRectangle) !== undefined
            }), s = 1e4, o = -1e4;
        t(i).each(function (e, t) {
            var n = t._root.boundingVolume, r = t._root.holePrimitives;
            if (TerraExplorer.disableOptimizationOnB3dm === undefined && r !== undefined && r[0] !== undefined) var i = r[0]._minHeight,
                u = TerraExplorer.onModelLargeRange !== undefined ? r[0]._maxHeight + 10 : (r[1]._maxHeight + r[0]._maxHeight) / 2,
                a = !0;
            TerraExplorer.onModelLargeRange = undefined;
            if (n !== undefined) if (n.minimumHeight !== undefined) s = Math.min(s, n.minimumHeight), o = Math.max(o, n.maximumHeight); else {
                var f = t._root._header.boundingVolume.region[4], l = t._root._header.boundingVolume.region[5];
                s = Math.min(s, f), o = Math.max(o, l)
            }
            a !== undefined && (s = Math.max(s, i), o = Math.min(o, u));
            var c = Math.abs(t.delta);
            s += -1 * c, o += c
        });
        if (s === 1e4 || TerraExplorer.disablePerformancePolylinesOnTerrain) s = undefined;
        if (o === -1e4 || TerraExplorer.disablePerformancePolylinesOnTerrain) o = undefined;
        return {minHeightOnB3dm: s, maxHeightOnB3dm: o}
    }, o.prototype.replaceDomainWIthTag = function (e) {
        if (e == undefined) return {url: e, subdomains: undefined};
        var n = r;
        if (Object.keys(n._domains).length == 0) {
            var i = TerraExplorer.internal.Settings.Subdomains;
            if (!Cesium.defined(i)) return {url: e, subdomains: undefined};
            i.length > 0 && (n._domains[i[0]] = i)
        }
        var s = [];
        return t.each(n._domains, function (n, r) {
            e.indexOf(n + ":") != -1 || e.indexOf(n + "/") != -1 ? (e = e.replace(n, "{s}"), s = r) : t.each(r, function (t, n) {
                if (e.indexOf(n + ":") != -1 || e.indexOf(n + "/") != -1) e = e.replace(n, "{s}"), s = r
            })
        }), {url: e, subdomains: s.length > 0 ? s : undefined}
    }, o.prototype.convertBetweenRanges = function (e, t, n, r, i) {
        return (e - t) * (i - r) / (n - t) + r
    }, o.prototype.drawPolygonOnCanvas = function (e, t, n, r, i) {
        if (i === undefined) {
            var i = document.createElement("canvas");
            i.width = n, i.height = r
        }
        var s = i.getContext("2d");
        if (e.length <= 0) return;
        s.moveTo(e[0][0], e[0][1]);
        for (var o = 0; o < e.length; o++) s.lineTo(e[o][0], e[o][1]);
        return t != null && t != undefined && (s.fillStyle = t, s.fill()), i
    }, o.prototype.obb2Brect = function (e) {
        var t = [], n = Cesium.Cartesian3.clone(e.center, a), r = e.halfAxes, i = [n.x, n.y, n.z];
        for (var s = 0; s < 8; s++) {
            var o = [];
            for (var u = 0; u < 3; u++) o.push(i[u] + +r[u + 0] * (s & 1 ? 1 : -1) + r[u + 3] * (s & 2 ? 1 : -1) + r[u + 6] * (s & 4 ? 1 : -1));
            t.push(Cesium.Cartesian3.fromElements(o[0], o[1], o[2]))
        }
        return Cesium.Rectangle.fromCartesianArray(t)
    }, o.prototype.modifyVertices = function (e, n) {
        var r = this, i = function (e, t) {
            return t.order - e.order
        }, s = n._pickObject.primitive, o = t.grep(s.modifyB3dmObjects, function (e) {
            return e.visibility === !0
        }), a, f = [];
        t(o).each(function (e, t) {
            g(n, t.polygon, r) && f.push(t)
        });
        if (f.length == 0) return e;
        var c = n._pickObject.content.tile._boundingVolume, h = c.rectangle;
        if (h === undefined) {
            h = r.obb2Brect(c.boundingVolume);
            if (h === undefined) return console.log("Error 00056"), e
        }
        var p = [];
        t.each(f, function (e, t) {
            var n = {modifiedHeight: t.modifiedHeight, elevationBehavior: t.elevationBehavior};
            t.polygon.mbObj = n, p.push(t.polygon)
        });
        var d = TerraExplorer.tools.ToolManager._tools.ModifyTerrainTool.MODIFY_TERRAIN_TYPES,
            v = h.west * 180 / Math.PI, m = h.south * 180 / Math.PI, y = h.east * 180 / Math.PI,
            b = h.north * 180 / Math.PI, w = new Cesium.Rectangle(v, m, y, b),
            E = TerraExplorer.internal.Engine.createMultiPolygonsCanvas(w, p), S = E.getContext("2d"),
            x = S.getImageData(0, 0, E.width, E.height).data, T = n._rtcCenter, N = new ArrayBuffer(e.byteLength),
            C = new DataView(N), k = 0, L = 12, A = Float32Array.BYTES_PER_ELEMENT, O = [],
            M = new ArrayBuffer(e.byteLength), _ = new Cesium.Cartographic, D = viewer.scene.globe.ellipsoid, P, H;
        for (P = 0, H = e.byteLength; P < H; P++) C.setUint8(P, e[P]);
        for (P = 0, H = e.length; P < H; P += L) {
            var B = C.getFloat32(k, !0);
            k += A;
            var j = C.getFloat32(k, !0);
            k += A;
            var F = C.getFloat32(k, !0);
            k += A;
            var I = new Cesium.Cartesian3(B, j, F);
            Cesium.Cartesian3.add(I, T, I);
            var q = Cesium.Cartographic.fromCartesian(I, D, _), R = l(q, w, u, u),
                U = {x: R.normalizedLongitude, y: R.normalizedLatitude}, z, W,
                X = r.isVertexInPolygon(x, U, E.colorsIndex);
            if (X !== undefined) {
                var V = X.elevationBehavior, J = X.modifiedHeight;
                switch (V) {
                    case d.CROP_BELOW:
                        W = Math.max(J, q.height);
                        break;
                    case d.CROP_ABOVE:
                        W = Math.min(J, q.height);
                        break;
                    case d.OFFSET:
                        var K = Math.abs(q.height - J);
                        W = q.height < J ? q.height + J : q.height - J;
                        break;
                    default:
                        W = J + q.height * .001 - (s.realAltitude - s.origAltitude)
                }
            } else W = q.height;
            z = Cesium.Cartesian3.fromRadians(q.longitude, q.latitude, W), Cesium.Cartesian3.subtract(z, T, z), O.push(z.x), O.push(z.y), O.push(z.z)
        }
        var Q = new DataView(M);
        for (var G = 0, H = O.length; G < H; G++) Q.setFloat32(G * A, O[G], !0);
        var Y = M.byteLength, Z = new Uint8Array(Y);
        for (var et = 0; et < Y; et++) Z[et] = Q.getUint8(et);
        return Z
    }, o.prototype.createMultiPolygonsCanvas = function (e, n, r) {
        var r = Cesium.defaultValue(r, u), i = this, s = document.createElement("canvas");
        s.colorsIndex = {}, s.width = r, s.height = r;
        var o = 1;
        return t(n).each(function (t, n) {
            var u = TerraExplorer.internal.Engine.convertToXYVertices(n, e, r, r), a = f(o), l = "#" + a + "0000";
            s = i.drawPolygonOnCanvas(u, l, r, r, s), s.colorsIndex[a] = n.mbObj, o++
        }), s
    }, o.prototype.createPolygonCanvas = function (e, t, n) {
        var n = Cesium.defaultValue(n, u), r = e.west * 180 / Math.PI, i = e.south * 180 / Math.PI,
            s = e.east * 180 / Math.PI, o = e.north * 180 / Math.PI, a = new Cesium.Rectangle(r, i, s, o),
            f = TerraExplorer.internal.Engine.convertToXYVertices(t, a, n, n),
            l = TerraExplorer.internal.Engine.drawPolygonOnCanvas(f, "#FF0000", n, n);
        return l
    }, o.prototype.isVertexInPolygon = function (e, t, n) {
        var r = Math.floor(t.x), i = Math.floor(t.y), s = i * u + r, o = f(e[s * 4]);
        return n[o]
    };
    var y = new Cesium.Cartesian3, b = new Cesium.Quaternion, w = new Cesium.Quaternion, E = new Cesium.Matrix3;
    return o.prototype.offsetFromHeadingPitchRange = function (e, t, n) {
        t = Cesium.Math.clamp(t, -Cesium.Math.PI_OVER_TWO, Cesium.Math.PI_OVER_TWO), e = Cesium.Math.zeroToTwoPi(e) - Cesium.Math.PI_OVER_TWO;
        var r = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y, -t, b),
            i = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -e, w),
            s = Cesium.Quaternion.multiply(i, r, i), o = Cesium.Matrix3.fromQuaternion(s, E),
            u = Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_X, y);
        return Cesium.Matrix3.multiplyByVector(o, u, u), Cesium.Cartesian3.negate(u, u), Cesium.Cartesian3.multiplyByScalar(u, n, u), u
    }, o.prototype.setPivot = function (e, t, n, r, i) {
        if (t === undefined || n === undefined || r === undefined) return;
        var s = viewer.scene.globe.ellipsoid;
        e.setNewLayerBboxCenter(t, n), e.modelMatrix = Cesium.Matrix4.IDENTITY;
        var o = e.getOriginPivot(), u = s.cartesianToCartographic(o), a = Cesium.Cartesian3.fromRadians(t, n, r);
        if (a !== undefined) {
            var f = s.cartesianToCartographic(a);
            e.deltaLat = f.latitude - u.latitude, e.deltaLon = f.longitude - u.longitude, i === undefined && (Math.abs(e.deltaLat) < Cesium.Math.EPSILON5 && (e.deltaLat = 0), Math.abs(e.deltaLon) < Cesium.Math.EPSILON5 && (e.deltaLon = 0));
            var l = Cesium.Transforms.eastNorthUpToFixedFrame(o), c = Cesium.Transforms.eastNorthUpToFixedFrame(a),
                h = Cesium.Matrix4.inverse(l, new Cesium.Matrix4);
            e.invMulDes = Cesium.Matrix4.multiply(c, h, new Cesium.Matrix4);
            var p = Cesium.Cartesian3.subtract(a, o, new Cesium.Cartesian3);
            e.T = p, e.modelMatrix = Cesium.Matrix4.multiply(e.invMulDes, e.modelMatrix, new Cesium.Matrix4), e.scaledPivotFactor = Math.cos(u.latitude) / Math.cos(f.latitude), e.layer.fromKML || setTimeout(function () {
                TerraExplorer.tools.ToolManager._tools.LayersTool._layersStorage.saveItem(e)
            }, 1e3)
        }
    }, o.prototype.getDynamicContourFactor = function () {
        var e = TerraExplorer.internal.Navigate.HeightAboveGround, t = Math.log10(e), n = Math.min(Math.max(.1, t), 8);
        return n -= 1, n /= 7, 10500 * n
    }, o.prototype.tileRectIntersect = function (e, t) {
        var n = e.boundingVolume.rectangle;
        if (n !== undefined) {
            if (Cesium.Rectangle.intersection(t, n) !== undefined) return !0
        } else {
            var r = e.boundingVolume.boundingSphere, i = Cesium.BoundingSphere.fromRectangle3D(t),
                s = Cesium.Cartesian3.distance(r.center, i.center);
            if (s <= r.radius + i.radius) return !0
        }
        return !1
    }, o.prototype.wait = function (e) {
        var t = Cesium.when.defer(), n = viewer.scene.frameState, r = n.frameNumber, i = r + e, s = function () {
            var e = n.frameNumber;
            i > e || (viewer.scene.preRender.removeEventListener(s), t.resolve())
        };
        return viewer.scene.preRender.addEventListener(s), t
    }, o.prototype.scalePolygonVertices = function (e, n, r) {
        var s = [], o = [], u = viewer.scene.globe.ellipsoid;
        t(e).each(function (e, t) {
            var n = u.cartesianToCartographic(t);
            s.push([n.longitude * 180 / Math.PI, n.latitude * 180 / Math.PI])
        }), s.push(s[0]);
        var a;
        try {
            var e = i.polygon([s]), f = i.centerOfMass(e);
            if (r === "latitude") {
                var l, c, h, p;
                t(s).each(function (e, t) {
                    h = f.geometry.coordinates[0], p = t[0], h > p ? (c = h - p, c *= n, o.push(Cesium.Cartesian3.fromDegrees(h - c, t[1]))) : (c = p - h, c *= n, o.push(Cesium.Cartesian3.fromDegrees(h + c, t[1])))
                })
            } else a = i.transformScale(e, n), t(a.geometry.coordinates[0]).each(function (e, t) {
                var n = Cesium.Cartesian3.fromDegrees(t[0], t[1]);
                o.push(n)
            })
        } catch (d) {
            return undefined
        }
        return o
    }, o
}), define("internal/CesiumOverrides", ["jquery", "WorkerPool", "sfsterrainprovider/SFSTerrainProvider"], function (e, t, n) {
    "use strict";

    function d() {
        if (!viewer.camera.isMoving) return !0;
        if (TerraExplorer.tilesProcessingLimit > 0) {
            if (p == viewer.scene._frameState.frameNumber) return !1;
            p = viewer.scene._frameState.frameNumber;
            if (viewer.scene._frameState.frameNumber % 5 > 0) return !1
        }
        return !0
    }

    function b(e, t, n) {
        var r = Cesium.Transforms.eastNorthUpToFixedFrame(s, viewer.scene.globe.ellipsoid),
            i = Cesium.Matrix4.inverseTransformation(r, new Cesium.Matrix4),
            s = this._pickObject.content._tile.boundingSphere.center,
            o = Cesium.Cartesian3.normalize(s, new Cesium.Cartesian3);
        return e.toENU = function () {
            return i
        }, e.u_contourTexture = function () {
            return viewer.scene.slopeColorsTexture !== undefined ? viewer.scene.slopeColorsTexture : (viewer.scene.slopeColorsTexture = viewer.scene.createElevationTextureFromPallete(viewer.scene.ContourMapPallete), viewer.scene.slopeColorsTexture)
        }, e.u_slopeTexture = function () {
            return viewer.scene.slopeMapTexture !== undefined ? viewer.scene.slopeMapTexture : (viewer.scene.slopeMapTexture = viewer.scene.createElevationTextureFromPallete(viewer.scene.SlopeMapPallete, !0), viewer.scene.slopeMapTexture)
        }, e.u_isSlopeMap = function () {
            return viewer.scene.displaySlopeMap
        }, e.u_isElevationMap = function () {
            return viewer.scene.showContourColors
        }, e.u_pivotNormal = function () {
            return o
        }, e.u_isLightingEnabled = function () {
            return viewer.scene.globe.enableLighting
        }, e.u_brightnessValue = function () {
            return viewer.scene.brightnessValue
        }, this._useSLSaturation && (e.u_slsaturation = function () {
            return Cesium.Batched3DModel3DTileContent.slsaturation == undefined ? 1.3 : Cesium.Batched3DModel3DTileContent.slsaturation
        }), e
    }

    function w(e, t) {
        var n = t.length;
        for (var r = 0; r < n; ++r) {
            var i = t[r];
            if (e.indexOf(i) !== -1) return i
        }
    }

    function E(e) {
        return e._originalVertexShaderLoaded = e._vertexShaderLoaded, function (e) {
            return e.indexOf("vec3 oct_to_float32x3(vec2 e)") > -1 ? (e = e.replace("void main", "varying vec3 v_normal2;varying float isSLShader; void main"), e = e.replace("gl_Position", "v_normal2 = a_normal; isSLShader = 1.0; gl_Position"), e.indexOf("v_positionEC") === -1 && e.indexOf("vec4 pos ") > -1 && (e = e.replace("void main", "varying vec3 v_positionEC; void main"), e = e.replace("gl_Position", "v_positionEC = pos.xyz; gl_Position"))) : (e = e.replace("void main", "varying vec3 v_normal2;varying float isSLShader; void main"), e = e.replace("gl_Position", "v_normal2 = vec3(1.0); isSLShader = 0.0; gl_Position"), e.indexOf("v_normal ") === -1 && e.indexOf("v_normal;") === -1 && (e = e.replace("void main", "varying vec3 v_normal;void main"), e = e.replace("gl_Position", "v_normal = vec3(1.0); gl_Position")), e.indexOf("v_positionEC") === -1 && (e = e.replace("void main", "varying vec3 v_positionEC; void main"))), e
        }
    }

    function S(e) {
        return e._originalFragmentShaderLoaded = e._fragmentShaderLoaded, function (t) {
            t.indexOf("APPLY_SL_SATURATION") != -1 && (e._useSLSaturation = !0, t = "#define APPLY_SL_SATURATION\n" + t);
            var n = Cesium.defaultValue(w(t, ["v_normalEC", "v_normal"]), "vec3(1.0)"),
                r = Cesium.defaultValue(w(t, ["v_positionEC", "v_position"]), "vec3(1.0)"),
                i = Cesium.ShaderSource.replaceMain(t, "sl_b3dm_original_main"),
                s = "#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform bool u_isLightingEnabled; uniform float u_brightnessValue; uniform bool u_isElevationMap; uniform bool u_isSlopeMap; uniform vec3 u_pivotNormal;\nuniform mat4 toENU; uniform sampler2D u_contourTexture; uniform sampler2D u_slopeTexture; varying vec3 v_position2; varying float isSLShader; varying vec3 v_normal2;\nvoid main() {\n   sl_b3dm_original_main(); \n   if (isSLShader>0.5 && !u_isElevationMap && !u_isSlopeMap) {\n       if (u_isLightingEnabled) {\n           gl_FragColor = vec4(mix(vec3(0.),gl_FragColor.rgb,u_brightnessValue),1.) ;\n       }\n   }\n   else if (isSLShader>0.5 && u_isSlopeMap){\n       vec3 normal = normalize(" + n + ");\n" + "       float nDotL = clamp(dot(u_pivotNormal,v_normal2),0.,1.); \n" + "       vec3 tex = texture2D(u_slopeTexture,vec2(0.,nDotL)).rgb; \n" + "       gl_FragColor = vec4(tex*0.5 + 0.5*gl_FragColor.rgb,1.0); \n" + "  }\n" + "}\n";
            return i.indexOf("v_normal ") === -1 && i.indexOf("v_normal;") === -1 && (s = s.replace("void main", "varying vec3 v_normal; void main")), i.indexOf("v_positionEC") === -1 && (s = s.replace("void main", "varying vec3 v_positionEC; void main")), i + "\n" + s
        }
    }

    function T(t) {
        var n = Cesium.when.defer();
        t.rootFloorRequested = !0;
        var r = Cesium.when.defer(), i = t.layer;
        if (i === undefined) {
            n.reject();
            return
        }
        var s = i.url.split("b3dm");
        if (s.length === 1) {
            n.reject();
            return
        }
        s = s[0], s += "b3dm/" + i.name, s.indexOf("{s}") > -1 && (s = TerraExplorer.internal.Engine.replaceTagWithOriginalDomain(s, TerraExplorer.internal.Settings.Subdomains));
        var o = t._root._header, u = o.children, a = {}, f = /\/[^.]+[.]json/i, l = [];
        return e(u).each(function (t, n) {
            n.content && n.content.url ? f.test(n.content.url) ? l.push(Cesium.Resource.fetchJson(s + "/" + n.content.url)) : a[n.content.url] = n : e(n.children).each(function (e, t) {
                t.content && t.content.url && (f.test(t.content.url) ? l.push(Cesium.Resource.fetchJson(s + "/" + t.content.url)) : a[t.content.url] = t)
            })
        }), Cesium.when.all(l, function (t) {
            e(t).each(function (e, t) {
                t && t.root && t.root.content && t.root.content.url && (a[t.root.content.url] = t)
            }), r.resolve()
        }), Cesium.when(r, function () {
            e(Object.keys(a)).each(function (e, r) {
                var i = a[r], o = s + "/" + r;
                Cesium.when(Cesium.Resource.fetchArrayBuffer(o), function (e) {
                    if (e instanceof ArrayBuffer) try {
                        var r = new Cesium.Batched3DModel3DTileContent(t, i, o, e, 0, !0), s = r._model;
                        if (s.gltf.floor == undefined) return !0;
                        if (t.useFloor === 0) return !0;
                        var u = s.gltf.floor.extensions;
                        if (u == undefined) {
                            var a = s.gltf.floor.polygon;
                            a !== undefined && (u = a.extensions)
                        }
                        var f = s.gltf.buffers.KHR_binary_glTF.extras._pipeline.source,
                            l = u.KHR_binary_glTF.bufferView;
                        if (l === undefined) return !0;
                        if (u.KHR_binary_glTF.polygon != undefined) try {
                            l = u.KHR_binary_glTF.polygon.bufferView;
                            var c = f.slice(l.byteOffset, l.byteOffset + l.byteLength),
                                h = String.fromCharCode.apply(null, c), p = JSON.parse(h), d = [], v;
                            for (var m in p) if (m == "polygon") {
                                var g = p[m], y = g[0], b = g.slice(1);
                                b = b.length > 0 ? b : undefined, d.push(new Cesium.PolygonGeometry({polygonHierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(y, b))}))
                            }
                        } catch (w) {
                            console.log("Cannot parse floor polygon: " + w.message), u.polygon == undefined
                        }
                        v = Cesium.Rectangle.fromDegrees(u.KHR_binary_glTF.minX, u.KHR_binary_glTF.minY, u.KHR_binary_glTF.maxX, u.KHR_binary_glTF.maxY)
                    } catch (w) {
                        return !0
                    }
                    v !== undefined && d.length > 0 && n.resolve({rootFloorRectangle: v, rootFloorPolygons: d})
                }).otherwise(function (e) {
                    return !0
                })
            })
        }), n
    }

    function k(e, t) {
        var n = 1024, r = new Uint8Array(n * 4), i = r.length, s = e[0].val, o = e[e.length - 1].val, u = s - o, a = o,
            f = n / u, l = 0;
        l = e.length;
        for (var c = l - 1; c > 0; c--) {
            var h = e[c].color.replace("#", ""), p = e[c - 1].color.replace("#", ""), d = parseInt(h, 16),
                v = parseInt(p, 16), m = e[c].val, g = e[c - 1].val, y = Math.floor((m - a) * f + .5),
                b = Math.floor((g - a) * f + .5), w = b - y;
            if (w == 0) continue;
            var E = (d & 16711680) >> 16 << 16, S = (d & 65280) >> 8 << 16, x = (d & 255) << 16,
                T = (v & 16711680) >> 16 << 16, N = (v & 65280) >> 8 << 16, C = (v & 255) << 16,
                k = Math.floor((T - E) / w), A = Math.floor((N - S) / w), O = Math.floor((C - x) / w), M, _, D;
            M = 0, D = 0;
            for (var P = y; P < b; P++) {
                var H;
                E += k, S += A, x += O, M += D, r[P * 4 + 0] = E >> 16, r[P * 4 + 1] = S >> 16, r[P * 4 + 2] = x >> 16, r[P * 4 + 3] = 255
            }
        }
        var B = L(r);
        return t ? (viewer.scene._slopeTex = B, viewer.scene.slopeMapTexture = viewer.scene._slopeTex) : e.isLinear === undefined ? (TerraExplorer.elevationColorsTexture = B, TerraExplorer.elevationDelta = Math.abs(u), TerraExplorer.elevationMin = s >= 0 ? -1 * s : Math.abs(s)) : TerraExplorer.elevationColorsLinearTexture = B, B
    }

    function L(e) {
        return new Cesium.Texture({
            context: viewer.scene.context,
            pixelFormat: Cesium.PixelFormat.RGBA,
            pixelDatatype: Cesium.PixelDatatype.UNSIGNED_BYTE,
            source: {width: 1, height: 1024, arrayBufferView: e},
            sampler: new Cesium.Sampler({
                wrapS: Cesium.TextureWrap.CLAMP_TO_EDGE,
                wrapT: Cesium.TextureWrap.CLAMP_TO_EDGE,
                minificationFilter: Cesium.TextureMinificationFilter.LINEAR,
                magnificationFilter: Cesium.TextureMagnificationFilter.LINEAR
            })
        })
    }

    function A(e, t) {
        try {
            viewer.scene._undergroundFloor != null && !viewer.scene._undergroundFloor.isDestroyed() && viewer.scene.primitives.remove(viewer.scene._undergroundFloor);
            var n = e;
            e instanceof Cesium.Cartesian3 && (n = viewer.scene.globe.ellipsoid.cartesianToCartographic(e));
            var r = new Cesium.GeometryInstance({
                geometry: new Cesium.EllipseGeometry({
                    center: Cesium.Cartesian3.fromRadians(n.longitude, n.latitude),
                    height: n.height,
                    semiMinorAxis: 2e5,
                    semiMajorAxis: 2e5,
                    vertexFormat: Cesium.VertexFormat.POSITION_AND_ST
                }), id: "undergroundSurface"
            }), i = Cesium.Material.fromType("Grid");
            i.uniforms.color = Cesium.Color.WHITE.withAlpha(.3), i.uniforms.cellAlpha = .001, i.uniforms.lineCount = new Cesium.Cartesian2(2e3, 2e3), i.uniforms.lineThickness = new Cesium.Cartesian2(1, 1);
            var s = viewer.scene.primitives.add(new Cesium.Primitive({
                geometryInstances: r,
                appearance: new Cesium.EllipsoidSurfaceAppearance({material: i})
            }));
            s.appearance.renderState.depthTest.enabled = !0
        } catch (o) {
            console.log(o.message)
        }
        return s
    }

    function M() {
        viewer.scene._undergroundFloor != undefined && !viewer.scene._undergroundFloor.isDestroyed() && (viewer.scene.primitives.remove(viewer.scene._undergroundFloor), viewer.scene._undergroundFloor = null, O.length > 0 && (O.forEach(function (e) {
            e.show = !0
        }), O = []))
    }

    function _() {
        TerraExplorer.internal.favorites !== undefined && TerraExplorer.internal.favorites._billboards.forEach(function (e) {
            var t = Cesium.Cartesian3.dot(Cesium.Cartesian3.normalize(viewer.camera.position, new Cesium.Cartesian3), Cesium.Cartesian3.normalize(e.position, new Cesium.Cartesian3));
            e.show && (t < 0 || 1 - t >= 3e-4) && (O.push(e), e.show = !1)
        })
    }

    function P(e, t) {
        return e.val < t.val ? -1 : t.val < e.val ? 1 : 0
    }

    function H() {
        var e = viewer.scene, t = e.preRender.raiseEvent, n = e.postRender.raiseEvent;
        e.preRender.raiseEvent = function () {
        }, e.postRender.raiseEvent = function () {
        }, e.render(), e.preRender.raiseEvent = t, e.postRender.raiseEvent = n
    }

    function j(t, n) {
        if (viewer.canvas.width <= 0 || viewer.canvas.height <= 0) return;
        if (B > 0) return;
        var r = {
            level: 16,
            callback: undefined,
            pickPrimitive: undefined,
            pick: undefined,
            includeUndergroundSurface: !0
        }, i = e.extend(!0, {}, r, n), s, o;
        try {
            B++, TerraExplorer.optimized_depth_picking = undefined;
            if (i.useDrillPick) var u = viewer.scene.drillPick(t);
            o = viewer.scene.pick(t), TerraExplorer.optimized_depth_picking = !0
        } catch (a) {
            console.log("Pick error!")
        } finally {
            B--
        }
        var f = i.includeUndergroundSurface && Cesium.defined(o) && Cesium.defined(o.id) && o.id == "undergroundSurface";
        if (Cesium.defined(o) && Cesium.defined(o.primitive) && viewer.scene.pickPositionSupported) viewer.scene.pickTranslucentDepth && o.primitive._appearance && o.primitive._appearance.translucent && H(), s = viewer.scene.pickPosition(t), o !== undefined && o.primitive !== undefined && Cesium.Cartesian3.equalsEpsilon(s, viewer.camera.position.clone(), .01) && o.primitive.position !== undefined && (s = o.primitive.position), i.callback != undefined && i.callback(s); else if (TerraExplorer.internal.Navigate.HeightAboveGround < 0 && viewer.scene.pickPositionSupported) s = viewer.scene.pickPosition(t), i.callback != undefined && i.callback(s); else {
            var l = viewer.camera.getPickRay(t);
            s = viewer.scene.globe.pick(l, viewer.scene);
            if (i.callback != undefined) {
                var c = viewer.scene.globe.ellipsoid.cartesianToCartographic(s),
                    h = Cesium.sampleTerrain(viewer.terrainProvider, i.level, [c]);
                Cesium.when(h, function (e) {
                    e[0].height != undefined && (s = viewer.scene.globe.ellipsoid.cartographicToCartesian(e[0])), i.callback(s)
                })
            }
        }
        return n != undefined && o != undefined && (n.pickPrimitive = o.primitive, n.id = o.id, n.pick = o, i.useDrillPick && u.length > 0 && (n.allPicks = u)), s
    }

    function F(e) {
        if (e.parentLayer != undefined && e._instanceIds != undefined) for (var t = 0; t < e._instanceIds.length; t++) e.parentLayer.removeRenderedFeatureId(e._instanceIds[t]);
        e._onDestroyTilePrimitive !== undefined && e._onDestroyTilePrimitive()
    }

    function I(e) {
        if (e.parentLayer != undefined && e._primitiveOptions !== undefined && e._primitiveOptions.geometryInstances !== undefined) {
            var t = e._primitiveOptions.geometryInstances;
            for (var n = 0; n < t.length; n++) e.parentLayer.removeRenderedFeatureId(t[n].id)
        }
        e._onDestroyTilePrimitive !== undefined && e._onDestroyTilePrimitive()
    }

    function V(e) {
        return e === undefined && (e = 0), new Cesium.Cartesian3(.001234321, 0, e)
    }

    function J(e) {
        this.value = new Float32Array([e])
    }

    function K(e, t, n, r) {
        var i = new Cesium.Cartesian3;
        Cesium.Cartesian3.subtract(this.position, e, i);
        var s, o, u = Cesium.defaultValue(n, this.defaultRotateAmount), a = Cesium.Quaternion.fromAxisAngle(t, -u, s),
            f = Cesium.Matrix3.fromQuaternion(a, o);
        Cesium.Matrix3.multiplyByVector(f, i, i), Cesium.Matrix3.multiplyByVector(f, this.direction, this.direction), Cesium.Matrix3.multiplyByVector(f, this.up, this.up), Cesium.Matrix3.multiplyByVector(f, this.right, this.right), r != undefined && Cesium.Cartesian3.multiplyByScalar(i, r, i), this.position = Cesium.Cartesian3.add(i, e, this.position)
    }

    function Y(e, t, n) {
        var r = {r: 0, g: 0, b: 0, a: 255};
        if (e.indexOf("nullvalue=") > -1) {
            var i = e.split("nullvalue=")[1].split("&")[0], s = i.split("%2C");
            r.r = s[0], r.g = s[1], r.b = s[2]
        }
        if (e.indexOf("nulltolerance=") > -1) var o = e.split("nulltolerance=")[1].split("&")[0];
        var u = new Image, a = document.createElement("canvas"), f = a.getContext("2d");
        u.url = e, u.onload = function () {
            if (u.url != undefined && u.url.indexOf("nullvalue") != -1) {
                delete u.url, a.width = u.width, a.height = u.height, f.drawImage(u, 0, 0), u.imageProcesses = [];
                var e = u.width / G, t = u.height, i = 0;
                for (var s = 0; s < G; s++) {
                    var l = s * e, c = f.getImageData(l, i, e, t).data;
                    u.imageProcesses[s] = Q.queueWorkItem({
                        nullValue: r,
                        nullTolerance: o,
                        canvasData: c,
                        width: e,
                        height: t,
                        startX: l
                    })
                }
                Cesium.when.all(u.imageProcesses, function (e) {
                    for (var t = 0; t < e.length; t++) {
                        var r = f.createImageData(e[t].width, e[t].height);
                        for (var i = 0; i < e[t].canvasData.length; i++) r.data[i] = e[t].canvasData[i];
                        f.putImageData(r, e[t].startX, 0)
                    }
                    u.src = a.toDataURL(), n.resolve(u)
                }).otherwise(function (e) {
                    console.log(e)
                })
            } else n.resolve(u)
        }, u.onerror = function (e) {
            n.reject(e)
        }, t && (Cesium.TrustedServers.contains(e) ? u.crossOrigin = "use-credentials" : u.crossOrigin = ""), u.src = e
    }

    function et(t, n) {
        var r = "#ifdef GL_EXT_frag_depth\n                            #extension GL_EXT_frag_depth : enable\n                            #endif\n                            \n                            //varying vec4 v_color;\n                            void main(void)\n                            {\n                                //gl_FragColor = v_color;\n                                gl_FragColor = vec4(0.375, 0.375, 0.375, 1.0);\n                                gl_FragDepthEXT = 1.0;\n                            }",
            i = Cesium.ShaderProgram.replaceCache({
                context: n.context,
                shaderProgram: i,
                vertexShaderSource: t.shaderProgram.vertexShaderSource.sources[0],
                fragmentShaderSource: r,
                attributeLocations: t.shaderProgram._attributeLocations
            });
        t.shaderProgram = i;
        var s = e.extend(!0, {}, t._renderState);
        return s.depthMask = !0, s.depthTest.enabled = !0, s.depthTest.func = Cesium.DepthFunction.GREATER, t._renderState = Cesium.RenderState.fromCache(s), t._HolePrimitive = !0, t.pass = Cesium.Pass.TERRAIN_CLASSIFICATION2, i
    }

    function nt(e, t) {
        for (var n = 0; n < e.children.length; n++) {
            var r = e.children[n].state >= Cesium.QuadtreeTileLoadState.DONE && (e.children[n].data.terrainData._mesh != undefined || e.children[n].data.terrainData._buffer != undefined);
            if (r && e.children[n].x == t.x && e.children[n].y == t.y) return e.children[n]
        }
        return undefined
    }

    function rt(e, t) {
        var n = e.tilingScheme, r = n.positionToTileXY(t, 0),
            i = viewer.scene.globe._surface.tileProvider.quadtree._levelZeroTiles,
            s = i[0].x == r.x && i[0].y == r.y ? i[0] : i[1];
        for (var o = 1; o < 22; o++) {
            r = n.positionToTileXY(t, o);
            var u = nt(s, r);
            if (u == undefined) break;
            s = u
        }
        return s
    }

    function it(e, t) {
        var n;
        for (n = 0; n < t.length; ++n) {
            var r = t[n], i = rt(e, r);
            r.height = i.data.terrainData.interpolateHeight(i.rectangle, r.longitude, r.latitude)
        }
        return t
    }

    function st(e, t) {
        function r() {
            e.ready ? Cesium.when(it(e, t), function (e) {
                n.resolve(e)
            }) : setTimeout(r, 10)
        }

        Cesium.Check.typeOf.object("terrainProvider", e), Cesium.Check.defined("positions", t);
        var n = Cesium.when.defer();
        return r(), n.promise
    }

    function ot(e, t, n) {
        var r = [], i = e._root, s = !1, o = Cesium.defaultValue(i._boundingVolume.rectangle, i.Brect),
            u = TerraExplorer.internal.Engine;
        o === undefined && (i.Brect = o = u.obb2Brect(i._boundingVolume._orientedBoundingBox));
        if (o !== undefined) {
            s = !0;
            if (!Cesium.Rectangle.contains(o, t)) return undefined
        } else if (i._boundingVolume._boundingSphere !== undefined) {
            var a = Cesium.Cartesian3.distance(i._boundingVolume._boundingSphere.center, Cesium.Cartesian3.fromRadians(t.longitude, t.latitude, t.height));
            if (a > i._boundingVolume._boundingSphere.radius) return undefined
        }
        var f;
        r.push(e._root);
        while (r.length > 0) {
            var l = r.pop();
            l.hasRenderableContent && (f == undefined || f.geometricError > l.geometricError) && (f = l);
            var c = l.children, h = c.length;
            for (var p = 0; p < h; ++p) {
                var d = c[p];
                if (s) {
                    var v = Cesium.defaultValue(d._boundingVolume.rectangle, d.Brect);
                    v === undefined && (d.Brect = v = u.obb2Brect(d._boundingVolume._orientedBoundingBox));
                    if (Cesium.Rectangle.contains(v, t)) {
                        if (n && d.hasRenderableContent && d.contentReady && (!Cesium.defined(d.content._model) || !Cesium.defined(d.content._model.floor))) continue;
                        r.push(d)
                    }
                } else if (d._boundingVolume._boundingSphere !== undefined) {
                    var a = Cesium.Cartesian3.distance(d._boundingVolume._boundingSphere.center, Cesium.Cartesian3.fromRadians(t.longitude, t.latitude, t.height));
                    if (a <= d._boundingVolume._boundingSphere.radius) {
                        if (n && d.hasRenderableContent && d.contentReady && (!Cesium.defined(d.content._model) || !Cesium.defined(d.content._model.floor))) continue;
                        r.push(d)
                    }
                }
            }
        }
        return f
    }

    function at(e, t) {
        var n = TerraExplorer.internal.Project.MeshLayers, r;
        for (r = 0; r < e.length; ++r) {
            var i = e[r], s = i instanceof Cesium.Cartographic, o = s ? i : Cesium.Cartographic.fromCartesian(i);
            o.height = ut, n.forEach(function (e) {
                if (e.ready && e.show) {
                    var n = ot(e, o, t);
                    n !== undefined && (t ? n.content && n.content._model && n.content._model.floor && (o.height = n.content._model.floor.getHeight(o.longitude, o.latitude), ut = n.content._model.floor.nullValue, TerraExplorer.debugFloor !== undefined && (o.height == ut ? console.log("Floor hight: null value") : console.log("Floor hight: " + o.height))) : o.height = n._boundingVolume.maximumHeight)
                }
            });
            if (!s) {
                var u = Cesium.Cartesian3.fromRadiansArrayHeights([o.longitude, o.latitude, o.height])[0];
                i.z = u.z
            }
        }
        return e
    }

    function ft(e, t) {
        Cesium.Check.defined("positions", e);
        var n = Cesium.when.defer();
        return Cesium.when(at(e, t), function (e) {
            n.resolve(e)
        }), n.promise
    }

    function ct(e, t) {
        t == undefined && (t = lt.TERRAIN | lt.MESH);
        var n = Cesium.when.defer(), r = [];
        t > lt.TERRAIN ? e.forEach(function (e) {
            r.push(Cesium.Cartographic.fromRadians(e.longitude, e.latitude, e.height))
        }) : r = e;
        var i = [];
        t & lt.TERRAIN && i.push(st(viewer.terrainProvider, e));
        var s = (t & lt.FLOOR) > 0;
        return t & (lt.MESH | lt.FLOOR) && i.push(ft(r, s)), Cesium.when.all(i).then(function (t) {
            if (i.length > 1) for (var r = 0; r < e.length; r++) {
                var o = t[0][r], u = t[1][r];
                if (u.height == ut) continue;
                if (o.height < u.height || s) o.height = u.height
            }
            n.resolve(t[0])
        }), n.promise
    }

    const r = 2e3;
    var i = function () {
    };
    i.init = function () {
        TerraExplorer.HolePrimitive = Z
    };
    var s = this;
    Cesium.defineProperties(Cesium.Camera.prototype, {
        isMoving: {
            get: function () {
                return this._isMoving == undefined && (this._isMoving = !1, this.moveStart.addEventListener(function () {
                    this._isMoving = !0
                }, this), this.moveEnd.addEventListener(function () {
                    this._isMoving = !1
                }, this)), this._isMoving
            }
        }
    });
    const o = 15e4;
    var u = Cesium.Camera.prototype.flyTo, a = new Cesium.Cartesian3;
    i.Camera_flyTo = function (e) {
        var t = TerraExplorer.internal.FixedLocalTime.Enable, n = e.destination, r = Cesium.defined(n.west);
        r && (n = this.getRectangleCameraCoordinates(n, a));
        var i = viewer.scene.globe.ellipsoid;
        if (TerraExplorer.internal.Navigate.HeightAboveGround > o && n !== undefined && i.cartesianToCartographic(n).height < o) {
            TerraExplorer.internal.FixedLocalTime.Enable = !1;
            if (e.cancel !== undefined) {
                var s = e.cancel;
                e.cancel = function () {
                    TerraExplorer.internal.FixedLocalTime.Enable = t, s.call(this)
                }
            } else e.cancel = function () {
                TerraExplorer.internal.FixedLocalTime.Enable = t
            };
            if (e.complete !== undefined) {
                var f = e.complete;
                e.complete = function () {
                    TerraExplorer.internal.FixedLocalTime.Enable = t, f.call(this)
                }
            } else e.complete = function () {
                TerraExplorer.internal.FixedLocalTime.Enable = t
            }
        }
        u.call(this, e)
    }, Cesium.Camera.prototype.flyTo = i.Camera_flyTo, i.Resource_createIfNeeded = function (e) {
        return e instanceof Cesium.Resource ? (e.url !== undefined && (e.url.indexOf("http%3A%2F%2F") > -1 || e.url.indexOf("https%3A%2F%2F") > -1) && (e.url = unescape(e.url)), e.getDerivedResource({request: e.request})) : typeof e != "string" ? e : new Cesium.Resource({url: e})
    }, Cesium.Resource.createIfNeeded = i.Resource_createIfNeeded, i.WebMapServiceImageryProvider_requestImage = function (e, t, n) {
        function r(e, t) {
            return Math.floor(Math.random() * (t - e + 1)) + e
        }

        var i = Cesium.when.defer(), s = 256, o = document.createElement("canvas");
        o.width = s, o.height = s;
        var u = o.getContext("2d");
        u.beginPath(), u.rect(0, 0, s, s);
        var a = r(50, 100);
        return u.fillStyle = "rgba(" + a + ", " + a + ", " + a + ", 1.0)", u.fill(), u.strokeStyle = "gray", u.strokeRect(10, 10, s - 20, s - 20), i.resolve(o), i
    };
    var f = Cesium.TrustedServers.contains;
    i.TrustedServers_contains = function (e) {
        try {
            if (TerraExplorer.trustedSkylineGlobeServers.contains(e)) return !0
        } catch (t) {
        }
        return f(e)
    }, Cesium.TrustedServers.contains = i.TrustedServers_contains;
    var l = Cesium.Cesium3DTileset.prototype, c = Cesium.Cesium3DTileset;
    Cesium.Cesium3DTileset = function (e) {
        e.maximumMemoryUsage = TerraExplorer._3dTilesetMaximumMemoryUsage, e.maximumScreenSpaceError = Cesium.defaultValue(TerraExplorer._3dTilesetMaximumScreenSpaceError, e.maximumScreenSpaceError), this._subdomains = e.subdomains, this._visibilityEvent = new Cesium.Event, this.currentlyShown = !1, this.level = 0, this.delta = 0, this.invMulDes = Cesium.Matrix4.IDENTITY, this.T = new Cesium.Cartesian3, c.call(this, e), this.getOriginPivot = function () {
            if (this.originPivot !== undefined) return this.originPivot;
            var e = this._root._header.boundingVolume, t = e.region[4],
                n = new Cesium.Rectangle(e.region[0], e.region[1], e.region[2], e.region[3]),
                r = Cesium.Rectangle.center(n);
            return this.originPivot = Cesium.Cartesian3.fromRadians(r.longitude, r.latitude, t), this.originPivot
        }, this.getCurrentPivot = function () {
            var e = this._root.boundingVolume, t = this.realAltitude - this.origAltitude;
            isNaN(t) && (t = 0);
            var n = this.origPivotHeight + t, r = e._boundingSphere.center,
                i = viewer.scene.globe.ellipsoid.cartesianToCartographic(r);
            return Cesium.Cartesian3.fromRadians(i.longitude, i.latitude, n)
        }, this.setNewLayerBboxCenter = function (e, t) {
            var n = this.properties.Longitude.minimum, r = this.properties.Longitude.maximum,
                i = this.properties.Latitude.minimum, s = this.properties.Latitude.maximum, o = (r - n) / 2,
                u = (s - i) / 2;
            this.properties.Longitude.minimum = e - o, this.properties.Longitude.maximum = e + o, this.properties.Latitude.minimum = t - u, this.properties.Latitude.maximum = t + u
        }, this.setDefaultPivot = function () {
            var e = this.getOriginPivot(), t = viewer.scene.globe.ellipsoid.cartesianToCartographic(e);
            this.setPivot(t.longitude, t.latitude, t.height)
        }, this.setPivot = function (e, t, n, r) {
            TerraExplorer.internal.Engine.setPivot(this, e, t, n, r)
        }
    }, Cesium.Cesium3DTileset.prototype = l, Cesium.Cesium3DTileset.useSubDomains = !0, Cesium.Cesium3DTileset.b3dmDebugFreezeFrame = !1, Cesium.Cesium3DTileset.prototype.buildURL = function (e, t) {
        var n = function (e) {
            return Math.abs(e.split("").reduce(function (e, t) {
                return e = (e << 5) - e + t.charCodeAt(0), e & e
            }, 0))
        };
        if (t == undefined) return e;
        var r = e.split("{s}");
        if (r.length == 1) return e;
        var i = r[1], s = n(i) % t.length, o = e.replace("{s}", t[s]);
        return o
    }, Cesium.Cesium3DTileset.progressCount = 0, Cesium.Cesium3DTileset.loadProgressAllTiles = function (e, t, n) {
        Cesium.Cesium3DTileset.progressCount++
    };
    var h = Cesium.Cesium3DTileset.prototype.destroy;
    i.Cesium3dTileset_destroy = function () {
        if (this._root !== undefined) var t = this._root.holePrimitives;
        h.call(this);
        var n = -1;
        t !== undefined && t.length !== undefined && e(t).each(function (e, t) {
            viewer.scene.primitives.remove(t), n = e
        })
    }, Cesium.Cesium3DTileset.prototype.destroy = i.Cesium3dTileset_destroy, Cesium.defineProperties(Cesium.Cesium3DTile.prototype, {
        hierarchyLevel: {
            get: function () {
                if (this._hierarchyLevel == undefined) {
                    this._hierarchyLevel = 0;
                    var e = this;
                    while (e.parent) e.parent.hasTilesetContent || this._hierarchyLevel++, e = e.parent
                }
                return this._hierarchyLevel
            }
        }
    }), Cesium.Cesium3DTile.prototype.isAncestor = function (e) {
        while (e.parent) {
            if (e.parent == this) return !0;
            e = e.parent
        }
        return !1
    }, Cesium.Cesium3DTile.prototype.isDescendantOf = function (e) {
        if (e instanceof Array) {
            for (var t = 0; t < e.length; t++) if (e[t].isAncestor(this)) return t
        } else if (e.isAncestor(this)) return 0;
        return -1
    };
    var p = 0;
    Cesium.Cesium3DTile.prototype.canRequestContent = function () {
        return viewer.camera.isMoving && !d() ? !1 : Cesium.defined(this._requestServer) ? this._requestServer.hasAvailableRequests() : !0
    };
    var v = Cesium.sampleTerrainMostDetailed;
    i.sampleTerrainMostDetailed = function (e, t) {
        if (e instanceof n) {
            var r = Cesium.when.defer(), i = TerraExplorer.functions.queryBestLevel(t[0]);
            return Cesium.when(i, function (n) {
                Cesium.sampleTerrain(e, n, [t[0]]).then(function (e) {
                    r.resolve(e)
                }).otherwise(function (e) {
                    console.log(e)
                })
            }), r.promise
        }
        v.call(this, e, t)
    }, Cesium.sampleTerrainMostDetailed = i.sampleTerrainMostDetailed;
    var m = Cesium.Batched3DModel3DTileContent.prototype, g = Cesium.Batched3DModel3DTileContent;
    Cesium.Batched3DModel3DTileContent = function (e, t, n, r, i, s) {
        this._tileset = e, this._tile = t, this._resource = n, this._model = undefined, this._batchTable = undefined, this._features = undefined, this._batchIdAttributeName = undefined, this._diffuseAttributeOrUniformName = {}, this._rtcCenterTransform = undefined, this._contentModelMatrix = undefined, this.featurePropertiesDirty = !1, this.init(this, r, i, s)
    }, Cesium.Batched3DModel3DTileContent.prototype = m;
    var y = Uint32Array.BYTES_PER_ELEMENT;
    i.Batched3DModel3DTileContent_initialize = function (e, t) {
        var n = Cesium.defaultValue(t, 0);
        t = n;
        var r = new Uint8Array(e), i = Cesium.getMagic(r, t);
        if (i !== "b3dm") throw new Cesium.DeveloperError("Invalid Batched 3D Model.  Expected magic=b3dm.  Read magic=" + i);
        var s = new DataView(e);
        t += y, t += y;
        var o = s.getUint32(t, !0);
        t += y;
        var u = s.getUint32(t, !0);
        this._featuresLength = u, t += y;
        var a = new Cesium.Cesium3DTileBatchTableResources(this, u);
        this.batchTableResources = a;
        var f = s.getUint32(t, !0);
        t += y;
        if (f > 0) {
            var l = Cesium.getStringFromTypedArray(r, t, f);
            t += f, a.batchTable = JSON.parse(l)
        }
        var c = n + o - t, h = new Uint8Array(e, t, c), p = new Cesium.Model({
            gltf: h,
            cull: !1,
            releaseGltfJson: !0,
            vertexShaderLoaded: a.getVertexShaderCallback(),
            fragmentShaderLoaded: a.getFragmentShaderCallback(),
            uniformMapLoaded: a.getUniformMapCallback(),
            pickVertexShaderLoaded: a.getPickVertexShaderCallback(),
            pickFragmentShaderLoaded: a.getPickFragmentShaderCallback(),
            pickUniformMapLoaded: a.getPickUniformMapCallback(),
            basePath: this.buildURL(this._tileset._subdomains),
            incrementallyLoadTextures: !1
        });
        this._model = p, this.state = Cesium.Cesium3DTileContentState.PROCESSING, this._contentReadyToProcessPromise.resolve(this);
        var d = this;
        p.readyPromise.then(function (e) {
            d.state = Cesium.Cesium3DTileContentState.READY, d._readyPromise.resolve(d)
        }).otherwise(function (e) {
            d.state = Cesium.Cesium3DTileContentState.FAILED, d._readyPromise.reject(e)
        })
    }, i.Batched3DModel3DTileContent_request = function () {
        var e = this, t = this._tile.distanceToCamera, n = Cesium.RequestScheduler.schedule(new Cesium.Request({
            url: this.buildURL(this._tileset._subdomains),
            server: this._tile.requestServer,
            requestFunction: Cesium.loadArrayBuffer,
            type: Cesium.RequestType.TILES3D,
            distance: t,
            defer: !0
        }));
        if (Cesium.defined(n)) return this.state = Cesium.Cesium3DTileContentState.LOADING, n.then(function (t) {
            if (e.isDestroyed()) return Cesium.when.reject("tileset is destroyed");
            e.initialize(t)
        }).otherwise(function (t) {
            e.state = Cesium.Cesium3DTileContentState.FAILED, e._readyPromise.reject(t)
        }), !0
    }, Cesium.Batched3DModel3DTileContent.prototype.request = i.Batched3DModel3DTileContent_request;
    var x = Cesium.Batched3DModel3DTileContent.prototype.update;
    i.Batched3DModel3DTileContent_update = function (t, n) {
        x.call(this, t, n);
        var r = this;
        if (this._model.floor != undefined && !this._model.floor.added) {
            this._tileset._root.holePrimitives == undefined && (this._tileset._root.holePrimitives = []);
            var t = r._tileset, i = TerraExplorer.internal.Project, s = t.delta,
                o = Math.min(t._root._header.boundingVolume.region[4], t.realAltitudeTEW) + s,
                u = Math.max(t._root._header.boundingVolume.region[5], t.realAltitudeTEW) + s;
            if (this._model.floor.polygonGeometries != undefined) {
                var a = viewer.scene.context.fragmentDepth, f = Cesium.defaultValue(t.deltaLat, 0),
                    l = Cesium.defaultValue(t.deltaLon, 0);
                viewer.terrainProvider._modifyTerrainObjects === undefined && (viewer.terrainProvider._modifyTerrainObjects = []), i._modelModifyTerrainObjects[t.guid] === undefined && t.modelModifyTerrainHeight !== undefined && t.rootFloorRequested === undefined && Cesium.when(T(t), function (n) {
                    r._model.floor === undefined && (r._model.floor = {});
                    var c = n.rootFloorPolygons[0];
                    t.holePolygon = c._polygonHierarchy.positions;
                    var h;
                    if ((l || f) && a) {
                        h = [], e(t.holePolygon).each(function (e, t) {
                            var n = viewer.scene.globe.ellipsoid.cartesianToCartographic(t),
                                r = Cesium.Cartographic.fromRadians(n.longitude + l, n.latitude + f, n.height);
                            h.push(viewer.scene.globe.ellipsoid.cartographicToCartesian(r))
                        });
                        var p = Cesium.defaultValue(t.scaledPivotFactor, 1);
                        h = TerraExplorer.internal.Engine.scalePolygonVertices(h, p, "latitude"), c._polygonHierarchy.positions = h
                    } else h = t.holePolygon;
                    if (a) {
                        var d = new TerraExplorer.HolePrimitive({
                            geometryInstances: new Cesium.GeometryInstance({
                                geometry: c,
                                id: "holePrimitive",
                                modelMatrix: t.modelMatrix
                            }),
                            appearance: new Cesium.PerInstanceColorAppearance({flat: !0}),
                            parentTileset: t._root._tileset,
                            minHeight: o,
                            maxHeight: u
                        }), v = new TerraExplorer.HolePrimitive({
                            geometryInstances: new Cesium.GeometryInstance({
                                geometry: c,
                                id: "holePrimitive",
                                modelMatrix: t.modelMatrix
                            }),
                            appearance: new Cesium.PerInstanceColorAppearance({flat: !0}),
                            parentTileset: t._root._tileset
                        });
                        t._root.holePrimitives.addedHoles === undefined && (t._root.holePrimitives.push(viewer.scene.primitives.add(d)), t._root.holePrimitives.push(viewer.scene.primitives.add(v)), t._root.holePrimitives.addedHoles = !0)
                    }
                    TerraExplorer.tools.ToolManager._tools.ModifyTerrainTool.modifyTerrain("", h, s, {
                        mtType: 1,
                        doNotShowInObjectList: !0
                    }).then(function (e) {
                        i._modelModifyTerrainObjects[t.guid] = e.id, e.isModelFloorMTO = !0, e.modelFloorBestLevel = t.level, t._visibilityEvent.addEventListener(function (t) {
                            TerraExplorer.internal.DrawingTool.activeSelectPointMode || (e.Show = t)
                        })
                    });
                    if (t.rootFloorAdded === undefined && r._model.floor !== undefined) {
                        t.getHRMTFP = ot;
                        var m = n.rootFloorRectangle;
                        t.rootFloorRectangle = new Cesium.Rectangle(m.west + l, m.south + f, m.east + l, m.north + f), t.rootFloorRectangleDegrees = new Cesium.Rectangle(t.rootFloorRectangle.west * 180 / Math.PI, t.rootFloorRectangle.south * 180 / Math.PI, t.rootFloorRectangle.east * 180 / Math.PI, t.rootFloorRectangle.north * 180 / Math.PI), t.rootIntersectingTiles = TerraExplorer.tools.ToolManager._tools.ModifyTerrainTool.getIntersectingTiles(t.rootFloorRectangle), t.rootFloorAdded = !0, t.rootFloorPolygon = n.rootFloorPolygons[0]._polygonHierarchy.positions, t.rootFloorCanvasPolygon = TerraExplorer.internal.Engine.createPolygonCanvas(t.rootFloorRectangle, t.rootFloorPolygon);
                        var g = t.rootFloorCanvasPolygon.getContext("2d");
                        t.rootFloorPixels = g.getImageData(0, 0, t.rootFloorCanvasPolygon.width, t.rootFloorCanvasPolygon.height).data
                    }
                }), this._model.floor.added = !0
            }
        }
    }, Cesium.Batched3DModel3DTileContent.prototype.update = i.Batched3DModel3DTileContent_update;
    var N = Cesium.GlobeSurfaceTileProvider.prototype.beginUpdate;
    i.GlobeSurfaceTileProvider_beginUpdate = function (e) {
        N.call(this, e), Cesium.defined(this._renderState) && (this._renderState = Cesium.clone(this._renderState, !1), this._renderState.cull = Cesium.clone(this._renderState.cull, !1), this._renderState.cull.enabled = !viewer.scene.showUndergroundSurface, this._renderState = Cesium.RenderState.fromCache(this._renderState))
    }, Cesium.GlobeSurfaceTileProvider.prototype.beginUpdate = i.GlobeSurfaceTileProvider_beginUpdate;
    var C = Cesium.QuadtreePrimitive.prototype.beginFrame;
    i.QuadtreePrimitive_beginFrame = function (e) {
        C.call(this, e), this._cameraMoving == undefined && (viewer.loadQueueTimeSliceWhileMoving = 1, this._cameraMoving = !1, viewer.camera.moveEnd.addEventListener(function () {
            this._cameraMoving = !1, this._loadQueueTimeSlice = 5
        }, this), viewer.camera.moveStart.addEventListener(function () {
            this._cameraMoving = !0, this._loadQueueTimeSlice = viewer.loadQueueTimeSliceWhileMoving
        }, this))
    }, Cesium.QuadtreePrimitive.prototype.beginFrame = i.QuadtreePrimitive_beginFrame, Cesium.QuadtreePrimitive.prototype.getRenderedLevelInfo = function () {
        var e = [];
        return this._tilesToRender.forEach(function (t) {
            e[t.level] == undefined && (e[t.level] = 0), e[t.level]++
        }), e
    }, Cesium.QuadtreePrimitive.prototype.getRenderedBestLevelInfo = function () {
        var e = this.getRenderedLevelInfo(), t = 0;
        for (var n in e) t < Number(n) && (t = Number(n));
        return {bestLevel: t, count: e[t]}
    }, Cesium.QuadtreePrimitive.prototype.levelHistory = {
        framesInterval: 60,
        currentFrame: 0,
        bsetLevel: 0,
        bestLevelCount: 0,
        bestLevelWasUpdated: !1,
        secondBestLevel: 0,
        secondBestLevelCount: 0,
        secondBestLevelWasUpdated: !1,
        getBestAndSecondBestLevelInfo: function () {
            var e = viewer.scene.globe._surface.getRenderedLevelInfo(), t = 0;
            for (var n in e) t < Number(n) && (t = Number(n));
            var r = t - 1;
            while (r > 0 && e[r] == undefined) r--;
            return {bestLevel: t, secondBestLevel: r, levelInfo: e}
        },
        init: function () {
            viewer.scene.preRender.addEventListener(function () {
                this.currentFrame++, this.currentFrame > this.framesInterval && this.reset();
                var e = this.getBestAndSecondBestLevelInfo(), t = e.bestLevel, n = e.secondBestLevel;
                t > this.bsetLevel ? (this.bsetLevel = t, this.bestLevelCount = e.levelInfo[t], this.bestLevelWasUpdated = !0) : t == this.bsetLevel && e.levelInfo[t] > this.bestLevelCount && (this.bestLevelCount = e.levelInfo[t], this.bestLevelWasUpdated = !0), n > this.secondBestLevel ? (this.secondBestLevel = n, this.secondBestLevelCount = e.levelInfo[n], this.secondBestLevelWasUpdated = !0) : n == this.secondBestLevel && e.levelInfo[n] > this.secondBestLevelCount && (this.secondBestLevelCount = e.levelInfo[n], this.secondBestLevelWasUpdated = !0)
            }, this)
        },
        reset: function () {
            this.currentFrame = 0, this.bestLevelWasUpdated = !1, this.secondBestLevelWasUpdated = !1;
            var e = this.getBestAndSecondBestLevelInfo();
            this.bsetLevel = e.bestLevel, this.bestLevelCount = e.levelInfo[e.bestLevel], this.secondBsetLevel = e.secondBsetLevel, this.secondBestLevelCount = e.levelInfo[e.secondBestLevel]
        }
    };
    var O = [], D = -1e5;
    Cesium.Scene.prototype.updateUndergroundSurface = function () {
        var e = TerraExplorer.internal.Navigate.HeightAboveGround;
        this.skyAtmosphere.show = !this.showUndergroundSurface, this.screenSpaceCameraController.enableCollisionDetection = !this.showUndergroundSurface;
        if (!this.showUndergroundSurface) {
            M(), D = e;
            return
        }
        if (D > 100 && e <= 100) {
            var t = new Cesium.Cartographic(viewer.camera.positionCartographic.longitude, viewer.camera.positionCartographic.latitude, this.undergroundSurfaceHeight);
            this._undergroundFloor = A(t, TerraExplorer.internal.Navigate.HeightAboveGround < 0)
        }
        viewer.scene.undergroundMode && D > r && e <= r && _(), this._undergroundFloor && (this._undergroundFloor.show = e < 0), D = e
    }, Cesium.defineProperties(Cesium.Scene.prototype, {
        ContourMapPallete: {
            get: function () {
                return this._contourMapPallete.length <= 0 && (this._contourMapPallete.push({
                    val: 9e3,
                    color: "#420042"
                }), this._contourMapPallete.push({val: 6e3, color: "#844142"}), this._contourMapPallete.push({
                    val: 1800,
                    color: "#AD8201"
                }), this._contourMapPallete.push({val: 600, color: "#FFFFC6"}), this._contourMapPallete.push({
                    val: 160,
                    color: "#84FF84"
                }), this._contourMapPallete.push({val: 1, color: "#008200"}), this._contourMapPallete.push({
                    val: 0,
                    color: "#D6FFFF"
                }), this._contourMapPallete.push({
                    val: -380,
                    color: "#A5DFFF"
                }), this._contourMapPallete.push({
                    val: -1500,
                    color: "#5204FF"
                }), this._contourMapPallete.sort(P)), this._contourMapPallete
            }, set: function (e) {
                this._contourMapPallete = e
            }
        }, ContourMapLinearPallete: {
            get: function () {
                return this._contourMapLinearPallete.length <= 0 && (this._contourMapLinearPallete.push({
                    val: 7e3,
                    color: "#420042"
                }), this._contourMapLinearPallete.push({
                    val: 6e3,
                    color: "#844142"
                }), this._contourMapLinearPallete.push({
                    val: 5e3,
                    color: "#AD8201"
                }), this._contourMapLinearPallete.push({
                    val: 4e3,
                    color: "#FFFFC6"
                }), this._contourMapLinearPallete.push({
                    val: 3e3,
                    color: "#84FF84"
                }), this._contourMapLinearPallete.push({
                    val: 2e3,
                    color: "#008200"
                }), this._contourMapLinearPallete.push({
                    val: 1e3,
                    color: "#D6FFFF"
                }), this._contourMapLinearPallete.push({
                    val: 0,
                    color: "#A5DFFF"
                }), this._contourMapLinearPallete.push({
                    val: -1e3,
                    color: "#5204FF"
                }), this._contourMapLinearPallete.sort(P)), this._contourMapLinearPallete.isLinear = !0, this._contourMapLinearPallete
            }, set: function (e) {
                this._contourMapLinearPallete = e
            }
        }, SlopeMapPallete: {
            get: function () {
                return this._sTex.length <= 0 && (this._sTex.push({
                    val: 100 * Math.cos(Cesium.Math.toRadians(90)),
                    color: "#FF0000"
                }), this._sTex.push({
                    val: 100 * Math.cos(Cesium.Math.toRadians(70)),
                    color: "#FF0000"
                }), this._sTex.push({
                    val: 100 * Math.cos(Cesium.Math.toRadians(45)),
                    color: "#FF8000"
                }), this._sTex.push({
                    val: 100 * Math.cos(Cesium.Math.toRadians(31)),
                    color: "#FFF000"
                }), this._sTex.push({
                    val: 100 * Math.cos(Cesium.Math.toRadians(17)),
                    color: "#00FF00"
                }), this._sTex.push({
                    val: 100 * Math.cos(Cesium.Math.toRadians(6)),
                    color: "#0000FF"
                }), this._sTex.push({val: 100 * Math.cos(Cesium.Math.toRadians(0)), color: "#00FFFF"})), this._sTex
            }, set: function (e) {
                this._sTex = e
            }
        }, undergroundSurfaceHeight: {
            get: function () {
                return -1e3
            }
        }, showUndergroundSurface: {
            get: function () {
                try {
                    var e = viewer.scene,
                        t = e.undergroundMode && TerraExplorer.internal.Navigate.HeightAboveGround < r;
                    e._prevShowUndergroundSurface = t
                } catch (n) {
                    console.log(n.message)
                }
                return t
            }
        }, undergroundMode: {
            get: function () {
                return this._undergroundMode == undefined && (this._undergroundMode = !1), this._undergroundMode
            }, set: function (e) {
                this._undergroundMode = e, viewer.scene.globe._surface.invalidateAllTiles()
            }
        }, allowDepthPicking: {
            get: function () {
                return !Cesium.defined(window.TerraExplorer) || Cesium.defined(window.TerraExplorer) && !Cesium.defined(window.TerraExplorer.optimized_depth_picking) ? this._environmentState.useGlobeDepthFramebuffer && this.useDepthPicking : this.useDepthPicking ? this.frameState.passes.pick : !1
            }
        }
    });
    var B = 0;
    Cesium.Scene.prototype.screenToWorld = j, Cesium.Scene.prototype.createElevationTextureFromPallete = function (e, t) {
        return k(e, t)
    }, Cesium.defineProperties(Cesium.BillboardCollection.prototype, {
        ready: {
            get: function () {
                var t = !0;
                return e.each(this._billboards, function (e, n) {
                    if (n.ready == 0) return t = !1, !1
                }), t
            }
        }
    });
    var q = Cesium.PrimitiveCollection.prototype.destroy;
    i.PrimitiveCollection_destroy = function () {
        F(this), q.call(this)
    }, Cesium.PrimitiveCollection.prototype.destroy = i.PrimitiveCollection_destroy;
    var R = Cesium.GroundPolylinePrimitive.prototype.destroy;
    i.GroundPolylinePrimitive_destroy = function () {
        I(this), R.call(this)
    }, Cesium.GroundPolylinePrimitive.prototype.destroy = i.GroundPolylinePrimitive_destroy;
    var U = Cesium.LabelCollection.prototype.destroy;
    i.LabelCollection_destroy = function () {
        this._onDestroyTilePrimitive !== undefined && this._onDestroyTilePrimitive(), U.call(this)
    }, Cesium.LabelCollection.prototype.destroy = i.LabelCollection_destroy;
    var z = Cesium.Primitive.prototype.destroy;
    i.Primitive_destroy = function () {
        F(this), z.call(this)
    }, Cesium.Primitive.prototype.destroy = i.Primitive_destroy;
    var W = Cesium.Primitive.prototype.update;
    i.Primitive_update = function (e) {
        W.call(this, e)
    }, Cesium.Primitive.prototype.update = i.Primitive_update;
    var X = Cesium.ShadowMapShader.createShadowReceiveFragmentShader;
    Cesium.ShadowMapShader.createShadowReceiveFragmentShader = function (e, t, n, r, i) {
        var s = viewer.scene.globe.enableLighting;
        if (s || t._isSpotLight) i = !1;
        return X(e, t, n, r, i)
    }, Cesium.DynamicEyeOffset = V, Cesium.BillboardCollection.prototype.updateVS = function (e) {
        if (e.indexOf("dynamicEyeOffset") === -1) {
            var t = "\nvec4 dynamicEyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\nvec3 correctedEyeOffset = eyeOffset;\nif (eyeOffset.x == 0.001234321)\n{\neyeOffset.x = 0.0;\ncorrectedEyeOffset = vec3(eyeOffset.xy, positionEC.z * 0.04 + eyeOffset.z); // p.z * 0.04 means that we take the distance from the billboard to the camera and moves the billboard position a little percentage of that distance toward the camera.\n}\npositionEC = czm_eyeOffset(positionEC, correctedEyeOffset);\nreturn positionEC;\n}\n";
            e = e.replace("czm_eyeOffset", "dynamicEyeOffset"), e = e.replace("void main()", t + "void main()\n")
        }
        return e
    };
    var $ = Cesium.Primitive._modifyShaderPosition;
    i.Primitive_modifyShaderPosition = function (e, t, n) {
        var r = $.call(this, e, t, n);
        if (!Cesium.defined(e._batchTableAttributeIndices) || !Cesium.defined(e._batchTableAttributeIndices.zbias)) return r;
        var i = "    p = p * (1.0 - czm_batchTable_zbias(batchId));\n", s = e.parentLayer ? e.parentLayer._level : 0;
        s > 10 && (i = "    p = p * (1.0 - czm_batchTable_zbias(batchId) * 2.0);\n");
        var o = "gl_Position = ", u = r.indexOf(o), a = r.indexOf("\n", u) + 1, r = r.slice(0, a) + i + r.slice(a);
        return r
    }, Cesium.Primitive._modifyShaderPosition = i.Primitive_modifyShaderPosition, Cesium.defineProperties(J.prototype, {
        componentDatatype: {
            get: function () {
                return Cesium.ComponentDatatype.FLOAT
            }
        }, componentsPerAttribute: {
            get: function () {
                return 1
            }
        }, normalize: {
            get: function () {
                return !1
            }
        }
    }), J.fromZBias = function (e) {
        if (!Cesium.defined(e)) throw new DeveloperError("zbias is required.");
        return new J(e)
    }, J.toValue = function (e, t) {
        if (!Cesium.defined(e)) throw new DeveloperError("zbias is required.");
        return Cesium.defined(t) ? color.toBytes(t) : new Float32Array(e)
    }, J.equals = function (e, t) {
        return e === t || Cesium.defined(e) && Cesium.defined(t) && e.value[0] === t.value[0]
    }, J.defaultBias = function () {
        var e = TerraExplorer.zbiaz == undefined ? .01 : TerraExplorer.zbiaz;
        return J.fromZBias(e)
    }, Cesium.ZBiasGeometryInstanceAttribute = J, Cesium.Camera.prototype.rotateAroundPoint = K;
    var Q = new t({workerPath: "./js/internal/nullValueRemoveWorker.js"}), G = 8;
    Cesium.Resource._Implementations.createImage = Y;
    var Z = function (e) {
        e.allowPicking = !1, e.classificationType = Cesium.ClassificationType.TERRAIN, Cesium.GroundPrimitive.call(this, e), this.isHolePrimitive = !0, this.geometryInstances.attributes = {color: new Cesium.ColorGeometryInstanceAttribute(.375, .375, .375, .6)}, this.parentTileset = e.parentTileset, this._minHeight = e.minHeight, this._maxHeight = e.maxHeight
    };
    Z.prototype = Object.create(Cesium.GroundPrimitive.prototype), Z.prototype.constructor = Z;
    var tt = 550;
    Z.prototype.update = function (e) {
        if (TerraExplorer.disableHolePrimitives) return;
        this.onSetMinMaxTerrainHeights === undefined && (this.onSetMinMaxTerrainHeights = function (e) {
            if (this._minTerrainHeight > -200) {
                var t = this._maxTerrainHeight - this._minTerrainHeight;
                if (t > tt) {
                    var n = tt / t;
                    this._maxTerrainHeight *= n, this._minTerrainHeight *= n
                }
            }
        }), Cesium.GroundPrimitive.prototype.update.call(this, e);
        var t;
        this._primitive && this._primitive._primitive && this._primitive._primitive._colorCommands && this._primitive._primitive._colorCommands.length > 0 && (t = this._primitive._primitive._colorCommands[2]);
        var n;
        this._primitive && this._primitive._primitive && this._primitive._primitive._pickCommands && this._primitive._primitive._pickCommands.length > 0 && (n = this._primitive._primitive._pickCommands[2]), t && t._HolePrimitive === undefined && (this._primitive._spColor = et(t, e)), n && n._HolePrimitive === undefined && (this._primitive._spPick = et(n, e)), this.parentTileset !== undefined && this.parentTileset.show == 0 && (this.show = !1)
    }, Z.prototype.delete = function () {
        TerraExplorer.internal.Project.deleteObject(this)
    }, Z.prototype.flyTo = function () {
        this.bs !== undefined && viewer.camera.flyToBoundingSphere(this.bs)
    }, Cesium.sampleRenderedTerrain = st;
    var ut = 65535;
    Cesium.sampleRenderedMesh = ft;
    var lt = {TERRAIN: 2, MESH: 4, FLOOR: 8};
    return Cesium.SampleRenderedDataFlags = lt, Cesium.sampleRenderedData = ct, i
}), define("internal/Tests", ["jquery"], function (e) {
    "use strict";

    function o(e, t, n) {
        var r = u(e, t), i;
        r ? i = "Text copied to the clipboard." : i = "Copy not supported or blocked.  Press Ctrl+c to copy.", setTimeout(function () {
            i = ""
        }, 2e3)
    }

    function u(e, t) {
        var n = "_hiddenCopyText_", r = t.tagName === "INPUT" || t.tagName === "TEXTAREA", i, s, o;
        if (r) o = t, i = t.selectionStart, s = t.selectionEnd; else {
            o = document.getElementById(n);
            if (!o) {
                var o = document.createElement("textarea");
                o.style.position = "absolute", o.style.left = "-9999px", o.style.top = "0", o.id = n, document.body.appendChild(o)
            }
            for (var u = 0; u < t.children[0].childElementCount; u++) o.textContent += e.children[0].children[u].textContent + t.children[0].children[u].textContent, o.textContent += String.fromCharCode(13)
        }
        var a = document.activeElement;
        o.focus(), o.setSelectionRange(0, o.value.length);
        var f;
        try {
            f = document.execCommand("copy")
        } catch (l) {
            f = !1
        }
        return a && typeof a.focus == "function" && a.focus(), r ? t.setSelectionRange(i, s) : o.textContent = "", f
    }

    var t = 0, n = -1, r, i = function () {
        this._fps = 0, this._prevOnFrameTime = 0
    };
    Cesium.defineProperties(i.prototype, {
        fps: {
            get: function () {
                return this._fps
            }
        }
    }), i.prototype.init = function () {
        var e = TerraExplorer.getUrlParameters().test || 0;
        e == 1 && this.showConsole()
    };
    var s = !1;
    return i.prototype.showConsole = function () {
        var t = e("<div id='WrapperDiv' style='position:absolute; left:5px; top:5px; opacity:1.0; width:600px; height:267px; background-color: rgba(255, 255, 255, 1.0); font-size: 13px;'>				<div id='Titles' style='position:absolute; width:600px;'>				<table id='titles-row'>					<tr id='a' style='textAlign:center; padding-right:20px; padding-left:10px; display:table-cell;'><th> FPS </th></tr>					<tr id='b' style='textAlign:center; padding-right:20px; display:table-cell;'><th> Sharpen Time<br>(Seconds) </th></tr>					<tr id='c' style='textAlign:center; padding-right:20px; display:table-cell;'><th> Memory<br>(MB) </th></tr>					<tr id='d' style='textAlign:center; padding-right:20px; display:table-cell;'><th> Number Of<br>Features </th></tr>					<tr id='e' style='textAlign:center; padding-right:22px; display:table-cell;'><th> Added<br>Features </th></tr>					<tr id='f' style='textAlign:center; padding-right:28px; display:table-cell;'><th> Number Of<br>Vertices </th></tr>					<tr id='g' style='textAlign:center; padding-right:2px; display:table-cell;'><th> Added<br>Vertices </th></tr>				</table>				</div>				<div id='TestDiv' style='position:absolute; top:45px; opacity: 1.0; border:2px; width:600px; height:175px; display:none; background-color: rgba(255, 255, 255, 1.0); overflow-y:scroll; border-top: 1px solid rgba(200, 200, 200, 1.0); border-bottom: 1px solid rgba(200, 200, 200, 1.0);'>				<table id='row'>					<tr id='left' align='center' style='display:table-cell; width:50px;'></tr>					<tr id='middle1' align='center' style='width:100px; display:table-cell;'></tr>					<tr id='middle2' align='center' style='width:85px; display:table-cell;'></tr>					<tr id='middle3' align='center' style='width:85px; display:table-cell;'></tr>					<tr id='middle4' align='center' style='width:80px; display:table-cell;'></tr>					<tr id='middle5' align='center' style='width:100px; display:table-cell;'></tr>					<tr id='right' align='center' style='width:80px; display:table-cell;'></tr>				</table>				</div>				<button id='copyButton2' style='position:absolute; bottom:10px; left:10px; border:none; color:white; background-color: #008CBA; padding: 6px 6px; cursor:pointer;'>Copy To Clipboard</button>				<button id='pauseButton' style='position:absolute; bottom:10px; left:140px; border:none; color:white; background-color: #008CBA; padding: 6px 6px; cursor:pointer;'>Stop Monitor</button>				<div id='logo' style='position:absolute; bottom:3px; right:10px;'><img src='img/QA_Logo.png' alt='QAlogo' height='30'></div>				</div>").disableSelection();
        e("#" + window.divId).append(t), e("#TestDiv").show(), document.getElementById("copyButton2").addEventListener("click", function () {
            o(document.getElementById("titles-row"), document.getElementById("row"), "msg")
        }), document.getElementById("pauseButton").addEventListener("click", function () {
            s = !s, document.getElementById("pauseButton").textContent = s ? "Start Monitor" : "Stop Monitor"
        });
        var n = 0;
        TerraExplorer.internal.Tests.StartMonitor();
        var r = 1e3, i = 0, u = 0, a = 0;
        setInterval(function () {
            if (s) return;
            i += r / 1e3;
            var e = document.createElement("tr"), t = document.getElementById("left").appendChild(e),
                o = document.createElement("td"), f = e.appendChild(o);
            f.innerHTML = TerraExplorer.internal.Tests.fps.toFixed(1) + " ", TerraExplorer.internal.Tests.fps < 30 && (f.style.backgroundColor = "red");
            var l = document.createElement("tr"), c = document.getElementById("middle1").appendChild(l),
                h = document.createElement("td"), p = l.appendChild(h);
            TerraExplorer.internal.StatusBar.isBuffering() ? (p.innerHTML = n + " ", n++) : n > 0 ? (p.innerHTML = n + " ", n = 0) : p.innerHTML = "0 ";
            var d = document.createElement("tr"), v = document.getElementById("middle2").appendChild(d),
                m = document.createElement("td"), g = d.appendChild(m);
            typeof InstallTrigger == "undefined" ? g.innerHTML = (performance.memory.usedJSHeapSize / 1048576).toFixed(1) + " " : g.innerHTML = "N/A ";
            var y = document.createElement("tr"), b = document.getElementById("middle3").appendChild(y),
                w = document.createElement("td"), E = y.appendChild(w);
            E.innerHTML = TerraExplorer.internal.Project.Statistics.getNumberOfFeatures() + " ";
            var S = document.createElement("tr"), x = document.getElementById("middle4").appendChild(S),
                T = document.createElement("td"), N = S.appendChild(T);
            N.innerHTML = TerraExplorer.internal.Project.Statistics.getNumberOfFeatures() - u + " ", u = TerraExplorer.internal.Project.Statistics.getNumberOfFeatures();
            var C = document.createElement("tr"), k = document.getElementById("middle5").appendChild(C),
                L = document.createElement("td"), A = C.appendChild(L);
            A.innerHTML = TerraExplorer.internal.Project.Statistics.getNumberOfPositions() + " ";
            var O = document.createElement("tr"), M = document.getElementById("right").appendChild(O),
                _ = document.createElement("td"), D = O.appendChild(_);
            D.innerHTML = TerraExplorer.internal.Project.Statistics.getNumberOfPositions() - a + " ", a = TerraExplorer.internal.Project.Statistics.getNumberOfPositions();
            var P = document.getElementById("TestDiv");
            P.scrollTop = P.scrollHeight
        }, r)
    }, i.prototype.StartMonitor = function () {
        if (n != -1) return;
        t = 0, r = Date.now(), viewer.scene.preRender.addEventListener(this.onPreFrame, this), n = setInterval(e.proxy(this.onTimer, this), 250)
    }, i.prototype.StopMonitor = function () {
        if (n == -1) return;
        viewer.scene.preRender.removeEventListener(this.onPreFrame, this), clearInterval(n), this._fps = 0, t = 0, n = -1
    }, i.prototype.onPreFrame = function (e, n) {
        t++
    }, i.prototype.onTimer = function () {
        var e = Date.now(), n = (e - r) / 1e3;
        r = e, this._fps = t / n, t = 0
    }, new i
}), define("internal/DrawingTool", ["jquery", "TELang", "internal/GeometryHelper", "internal/InputMode"], function (e, t, n, r) {
    "use strict";

    function i() {
        this.getId = function () {
            return "DrawingTool"
        }, this._handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas), this._isActive = !1, this._activeShapePoints = [], this._activeEarthPoints = [], this._cancelledPoints = [], this._currentPointIndex = -1, this._style = {}, this._intersectionStyle = {}, this._onPointUpdateCallback = null, this._onFinishCallback = null, this._onAbortCallback = null, this._onMouseMoveCallback = null, this._onIntersection = null, this._isSelfIntersecting = !1, this._styleDirty = !1, this._activeType = null, this._origCursor = null, this._planeMode = !1, this._plane3D = null, this._isDraggingGlobe = !1, this._prevWasPoint = !1, this._firstPointReleased = !1, this._pickPrim = null, this._dashedLines = [], this._cancelFinish = !1, this._prevRealScreenPosition = undefined, this._prevScreenPosition = undefined, this._newMovementPosition = undefined, this._mobileIndications = new Cesium.BillboardCollection, this._reprojectedPosition, this._firstPickDictatesAbsAltitude = !1, this.SHAPE_TYPES = {
            POINT: 0,
            LINE: 1,
            POLYGON: 2
        }, this.ALTITUDE_METHODS = {
            RELATIVE_TO_MODEL: 0,
            RELATIVE_TO_TERRAIN: 1,
            ABSOLUTE: 2,
            ON_TERRAIN: 3
        }, this.ABORT_REASONS = {
            NONE: 0,
            ESC_KEY: 1
        }, this._altitude = 0, this._altitudeMethod = this.ALTITUDE_METHODS.ON_TERRAIN, this._drawingOptionsObj = {
            finish: function () {
                TerraExplorer.internal.DrawingTool.finishDrawing()
            }, abort: function () {
                var e = TerraExplorer.internal.DrawingTool;
                e.abortDrawing(e.ABORT_REASONS.NONE)
            }, cancelLastPoint: function () {
                TerraExplorer.internal.DrawingTool.cancellationCallback()
            }, alignToVerticalAxis: !1, alignToHorizontalAxis: !1
        }
    }

    function d(e, t, n) {
        return new Cesium.Primitive({
            geometryInstances: new Cesium.GeometryInstance({
                geometry: new Cesium.PolygonGeometry({
                    polygonHierarchy: {
                        positions: e,
                        holes: []
                    },
                    ellipsoid: Cesium.Ellipsoid.WGS84,
                    perPositionHeight: !0,
                    vertexFormat: Cesium.VertexFormat.POSITION_AND_COLOR
                }),
                attributes: {
                    color: Cesium.ColorGeometryInstanceAttribute.fromColor(n ? t.material : t.material.withAlpha(.3)),
                    distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, TerraExplorer.tools.ToolManager._tools.AreaTool._perimeter * 30)
                }
            }),
            asynchronous: !1,
            allowPicking: !1,
            shadows: Cesium.ShadowMode.DISABLED,
            isAnalysisPrimitive: !0,
            appearance: new Cesium.PerInstanceColorAppearance({
                addZBias: !0,
                flat: !0,
                renderState: {
                    depthTest: {enabled: n},
                    lineWidth: Cesium.Math.clamp(2, Cesium.ContextLimits.minimumAliasedLineWidth, Cesium.ContextLimits.maximumAliasedLineWidth)
                }
            })
        })
    }

    function v(e, t, n) {
        var r = new Cesium.PrimitiveCollection, i = Cesium.BoundingRectangle.fromPoints(e),
            s = (i.width + i.height) * 2;
        for (var o = 0; o < e.length - 1; o++) {
            var u = r.add(new Cesium.Primitive({
                geometryInstances: new Cesium.GeometryInstance({
                    geometry: new Cesium.PolylineGeometry({
                        positions: [e[o], e[o + 1]],
                        ellipsoid: Cesium.Ellipsoid.WGS84,
                        vertexFormat: Cesium.PolylineColorAppearance.VERTEX_FORMAT,
                        width: 2,
                        followSurface: !0
                    }),
                    attributes: {
                        color: Cesium.ColorGeometryInstanceAttribute.fromColor(n ? t.material : t.material.withAlpha(.3)),
                        distanceDisplayCondition: TerraExplorer.isTouch() ? undefined : new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(0, s * 20 + 2)
                    }
                }),
                asynchronous: !1,
                allowPicking: !1,
                shadows: Cesium.ShadowMode.DISABLED,
                isAnalysisPrimitive: !0,
                appearance: new Cesium.PolylineColorAppearance({})
            }));
            u.positions = [e[o], e[o + 1]], u.appearance.renderState.depthTest.enabled = !1, u.isAnalysisPrimitive = !0
        }
        return r
    }

    function m(e, t, n) {
        t.hierarchy = e, t.material = n !== undefined ? t.material.withAlpha(.3) : t.material;
        var r = viewer.entities.add(new Cesium.Entity({
            polygon: t,
            id: n ? "drawingToolShapeNoDepth" : "drawingToolShape"
        }));
        return r
    }

    function g(e, t, n) {
        t.positions = e, t.material = n !== undefined ? t.material.withAlpha(.3) : t.material;
        var r = viewer.entities.add(new Cesium.Entity({
            polyline: t,
            id: n === undefined ? undefined : "drawingToolShape_NoDepthTest"
        }));
        return r
    }

    function y(e, t, n) {
        return g(e, t, n)
    }

    function b(e, t) {
        var n = viewer.entities.add(new Cesium.Entity({position: e, point: t}));
        return n
    }

    function w(e, t, n, r) {
        var i, s = TerraExplorer.internal.DrawingTool.SHAPE_TYPES;
        if (t === s.LINE) i = g(e, n, r); else if (t === s.POLYGON) {
            var o = n.outline ? !0 : !1;
            n.outline = !1, i = m(e, n, r), n.width = n.outlineWidth, o && (u = y(S, n, undefined), u.origOptions = n, a = y(S, n, !0), a.origOptions = n)
        } else t === s.POINT && (i = b(e, n));
        return i
    }

    var s, o, u, a, f, l;
    const c = {
        color: Cesium.Color.RED,
        pixelSize: 3,
        outlineColor: Cesium.Color.BLUE,
        outlineWidth: 2,
        show: !0,
        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
    }, h = {followSurface: !0, clampToGround: !0, width: 1, show: !0, material: Cesium.Color.WHITE}, p = {
        heightReference: Cesium.HeightReference.NONE,
        show: !0,
        fill: !0,
        material: Cesium.Color.BLUE.withAlpha(.5),
        outline: !0,
        outlineColor: Cesium.Color.RED,
        outlineWidth: 2,
        groundClampingMethod: 2
    };
    Cesium.defineProperties(i.prototype, {
        Active: {
            get: function () {
                return this._isActive
            }
        }
    }), i.prototype.resetTool = function () {
        f = undefined, s = undefined, o = undefined, u = undefined, a = undefined, T = !1, E = undefined, l = undefined, this._reprojectedPosition = undefined, this._pickPrim = null, this._firstPickDictatesAbsAltitude = !1, this._style = {}, this._dashedLines = [], this._cancelFinish = !1, this._isDraggingGlobe = !1, this._prevWasPoint = !1, this._firstPointReleased = !1, this._intersectionStyle = {}, this._activeType = null, this._activeShapePoints = [], this._activeEarthPoints = [], this._cancelledPoints = [], this._currentPointIndex = -1, this._onPointUpdateCallback = null, this._onFinishCallback = null, this._onAbortCallback = null, this._onMouseMoveCallback = null, this._onIntersection = null, this._altitudeMethod = this.ALTITUDE_METHODS.ON_TERRAIN, this._altitude = 0, this._isActive = !1, this._isSelfIntersecting = !1, this._styleDirty = !1, this._planeMode = !1, this._origCursor = null, this._plane3D = null, this._prevRealScreenPosition = undefined, this._prevScreenPosition = undefined, this._newMovementPosition = undefined, this._mobileIndications.removeAll()
    }, i.prototype.stopDrawing = function () {
        this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN), this._handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_DOWN), this._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP), TerraExplorer.internal.Navigate._draggingEvent.removeEventListener(this.cancelPointOnDrag, this), e(document).unbind("keydown"), viewer.scene.preRender.removeEventListener(this.onSyncedMovement, this), r.Mode = r.FREE_FLIGHT, TerraExplorer.isTouch() && (e("canvas").off("touchstart"), e("canvas").off("touchend")), TerraExplorer.isMobile() && e(window).off("navigate"), this._activeShapePoints.forEach(function (e) {
            viewer.entities.remove(e)
        }), this._cancelledPoints.forEach(function (e) {
            viewer.entities.remove(e)
        }), this._activeEarthPoints.forEach(function (e) {
            viewer.entities.remove(e)
        }), viewer.entities.remove(f), viewer.entities.remove(s), viewer.entities.remove(o), viewer.entities.remove(u), viewer.entities.remove(a), viewer.entities.remove(l), viewer.scene.primitives.remove(s), viewer.scene.primitives.remove(o), this._dashedLines.forEach(function (e) {
            viewer.entities.remove(e)
        }), this.resetTool()
    }, i.prototype.initOptions = function (t, n) {
        var r = {
            onPointUpdate: function (e, t, n) {
            },
            onFinish: function (e) {
            },
            onAbort: function (e) {
            },
            onMouseMove: function (e) {
            },
            onIntersection: function (e, t, n) {
            },
            style: n === 0 ? c : n === 1 ? h : n === 2 ? p : {},
            intersectionStyle: n === 0 ? c : n === 1 ? h : n === 2 ? p : {}
        };
        t = Cesium.defaultValue(t, {});
        var i = !!t.intersectionStyle, t = e.extend(!0, {}, r, t);
        i || (t.intersectionStyle = {}), this._style = t.style, this._firstPickDictatesAbsAltitude = Cesium.defaultValue(t.useFirstPointAsAltitude, !1), this._planeMode = Cesium.defaultValue(t.planeMode, !1), this._intersectionStyle = t.intersectionStyle, this._onPointUpdateCallback = Cesium.defaultValue(t.onPointUpdate, r.onPointUpdate), this._onFinishCallback = Cesium.defaultValue(t.onFinish, r.onFinish), this._onAbortCallback = Cesium.defaultValue(t.onAbort, r.onAbort), this._onMouseMoveCallback = Cesium.defaultValue(t.onMouseMove, r.onMouseMove), this._onIntersection = Cesium.defaultValue(t.onIntersection, r.onIntersection), this._altitude = Cesium.defaultValue(t.Altitude, 0), this._altitudeMethod = Cesium.defaultValue(t.AltitudeMethod, this.ALTITUDE_METHODS.ON_TERRAIN), this._originalOptions = t
    }, i.prototype.drawPoints = function (e) {
        return this.initOptions(e, this.SHAPE_TYPES.POINT), this.startDrawing(this.SHAPE_TYPES.POINT, this._style), this._drawingOptionsObj
    }, i.prototype.drawPolyline = function (e) {
        return this.initOptions(e, this.SHAPE_TYPES.LINE), this.startDrawing(this.SHAPE_TYPES.LINE, this._style), this._drawingOptionsObj
    }, i.prototype.drawPolygon = function (e) {
        return this.initOptions(e, this.SHAPE_TYPES.POLYGON), this.startDrawing(this.SHAPE_TYPES.POLYGON, this._style), this._drawingOptionsObj
    }, i.prototype.finishDrawing = function () {
        var e;
        TerraExplorer.isTouch() || (e = this._activeShapePoints.pop()), this._onFinishCallback !== null && this._onFinishCallback(this._activeShapePoints, this.cancellationCallbackFinish, {isSelfIntersect: this._isSelfIntersecting}), this._cancelFinish ? (e && this._activeShapePoints.push(e), this._cancelFinish = !1) : this.stopDrawing()
    }, i.prototype.abortDrawing = function (e) {
        this._onAbortCallback !== null && this._onAbortCallback({abortReason: e}), this.stopDrawing()
    }, i.prototype.checkSelfIntersection = function () {
        if (TerraExplorer.isTouch() && this._activeType !== this.SHAPE_TYPES.POLYGON) return;
        var e = this._isSelfIntersecting;
        this._activeType === this.SHAPE_TYPES.POLYGON ? this._isSelfIntersecting = n.isSelfIntersect(this._activeShapePoints) : this._isSelfIntersecting = n.isSelfIntersectLine(this._activeShapePoints), e !== this._isSelfIntersecting && (this._styleDirty = !0)
    }, i.prototype.onSyncedMovement = function () {
        if (this._isMouseMovementEvent && f !== undefined) {
            var t = this._newMovementPosition;
            if (Cesium.defined(t)) {
                var n = this.setAltitude(t, this._options);
                t = n.newPosition, f.position.setValue(t), this._activeShapePoints.pop(), this._activeShapePoints.push(t), this._firstPointReleased && this._onMouseMoveCallback(t)
            }
        }
        f !== undefined && this._activeType !== this.SHAPE_TYPES.POINT && (this._drawingOptionsObj !== undefined && this._drawingOptionsObj.options !== undefined && (this._style = e.extend(!0, {}, this._style, this._drawingOptionsObj.options), this._drawingOptionsObj.options = undefined, this._styleDirty = !0), this._newMovementPosition !== undefined && this._prevRealScreenPosition !== undefined && Cesium.Cartesian2.distance(this._newMovementPosition.screenPosition, this._prevRealScreenPosition) > 5 && this.checkSelfIntersection(), this._styleDirty && this.applySelfIntersection()), this._isMouseMovementEvent = !1
    }, i.prototype.applySelfIntersection = function () {
        TerraExplorer.isTouch() ? (this.updatePrim(this._activeType), this._styleDirty = !1) : (this._activeType === this.SHAPE_TYPES.POLYGON ? (s.polygon.material = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.material, this._style.material) : this._style.material, s.polygon.outlineColor = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.outlineColor, this._style.outlineColor) : this._style.outlineColor, s.polygon.outline = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.outline, this._style.outline) : this._style.outline, s.polygon.fill = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.fill, this._style.fill) : this._style.fill, o.polygon.fill = this._isSelfIntersecting ? !1 : s.polygon.fill, o.polygon.outline = this._isSelfIntersecting ? !1 : s.polygon.outline, u.polyline.width = this._isSelfIntersecting ? u.origOptions.outlineWidth : u.origOptions.outlineWidth, a.polyline.width = this._isSelfIntersecting ? a.origOptions.outlineWidth : a.origOptions.outlineWidth, u.polyline.material = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.outlineColor, this._style.material) : u.origOptions.material, a.polyline.material = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.outlineColor, this._style.material) : a.origOptions.material) : (s.polyline.material = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.material, this._style.material) : this._style.material, s.polyline.width = this._isSelfIntersecting ? Cesium.defaultValue(this._intersectionStyle.width, this._style.width) : this._style.width, o.outline = this._isSelfIntersecting ? !1 : !0), this._styleDirty = !1)
    }, i.prototype.cancellationCallbackFinish = function () {
        TerraExplorer.internal.DrawingTool._cancelFinish = !0
    }, i.prototype.cancellationCallback = function () {
        var e = TerraExplorer.internal.DrawingTool, t = TerraExplorer.internal.DrawingTool.SHAPE_TYPES,
            n = e._activeShapePoints.pop();
        TerraExplorer.isTouch() ? viewer.entities.remove(n) : (e._cancelledPoints.push(e._activeShapePoints.pop()), e._activeShapePoints.push(n), e._cancelledPoints.push(e._activeEarthPoints.pop()), viewer.entities.remove(e._cancelledPoints.pop())), e._activeShapePoints.length === 1 && e._dashedLines.length > 0 && (viewer.entities.remove(e._dashedLines.pop()), e._originalOptions.useFirstPointAsAltitude && !e._firstPickDictatesAbsAltitude && (e._firstPickDictatesAbsAltitude = !0)), TerraExplorer.isTouch() && (this._activeType === t.POINT ? (viewer.entities.remove(s), viewer.entities.remove(o), s = w(this._activeShapePoints, this._activeType, this.__options), o = w(this._activeShapePoints, this._activeType, this.__options, !0)) : (this.checkSelfIntersection(), this._styleDirty ? this.applySelfIntersection() : this.updatePrim(this._activeType))), e._currentPointIndex--
    }, i.prototype.updatePrim = function (e) {
        var t = TerraExplorer.internal.DrawingTool.SHAPE_TYPES;
        e === t.POLYGON && (this._intersectionStyle.fill = !0, this._intersectionStyle.material = Cesium.Color.RED.withAlpha(0), this._intersectionStyle.outline = !0, this._intersectionStyle.outlineColor = Cesium.Color.RED.withAlpha(1));
        var n = this._isSelfIntersecting ? this._intersectionStyle : this.__options;
        viewer.entities.remove(s), viewer.entities.remove(o), viewer.scene.primitives.remove(s), viewer.scene.primitives.remove(o), s = e === t.LINE ? v(this._activeShapePoints, n, undefined) : s = d(this._activeShapePoints, n, undefined), o = e === t.LINE ? v(this._activeShapePoints, n, !0) : o = d(this._activeShapePoints, n, !0), viewer.scene.primitives.add(s), viewer.scene.primitives.add(o)
    }, i.prototype.setAltitude = function (e, t) {
        var n = e;
        if (this._plane3D !== null && e.screenPosition !== undefined) {
            var r = n, i = viewer.scene.globe.ellipsoid.cartesianToCartographic(r),
                s = Cesium.Cartographic.fromRadians(i.longitude, i.latitude, 0),
                o = new Cesium.Ray(r, this._plane3D.normal, new Cesium.Cartesian3),
                u = Cesium.IntersectionTests.rayPlane(o, this._plane3D, new Cesium.Cartesian3);
            u === undefined && (o.direction = Cesium.Cartesian3.negate(this._plane3D.normal, o.direction), u = Cesium.IntersectionTests.rayPlane(o, this._plane3D, new Cesium.Cartesian3)), this._reprojectedPosition = n = u
        } else {
            var a = this._altitudeMethod;
            t.clampToGround = !1, t.heightReference = Cesium.HeightReference.NONE;
            var i = viewer.scene.globe.ellipsoid.cartesianToCartographic(e);
            t.perPositionHeight = a === this.ALTITUDE_METHODS.ON_TERRAIN ? !1 : !0, a === this.ALTITUDE_METHODS.ON_TERRAIN ? (t.clampToGround = !0, t.heightReference = Cesium.HeightReference.CLAMP_TO_GROUND) : a === this.ALTITUDE_METHODS.ABSOLUTE ? n = Cesium.Cartesian3.fromRadians(i.longitude, i.latitude, this._altitude) : a === this.ALTITUDE_METHODS.RELATIVE_TO_MODEL ? n = Cesium.Cartesian3.fromRadians(i.longitude, i.latitude, i.height + this._altitude) : a === this.ALTITUDE_METHODS.RELATIVE_TO_TERRAIN && (n = Cesium.Cartesian3.fromRadians(i.longitude, i.latitude, viewer.scene.globe.getHeight(i) + this._altitude))
        }
        return {newPosition: n, options: t}
    };
    var E, S, x, T = !1;
    return i.prototype.cancelPointOnDrag = function (e) {
        this._isDraggingGlobe = e;
        if (this._isDraggingGlobe && this._prevWasPoint || this._isDraggingGlobe && !this._firstPointReleased) this.cancellationCallback(), this._isDraggingGlobe && !this._firstPointReleased && this._dashedLines.length > 0 && (viewer.entities.remove(this._dashedLines.pop()), l = undefined, this._originalOptions.useFirstPointAsAltitude && !this._firstPickDictatesAbsAltitude && (this._firstPickDictatesAbsAltitude = !0)), this._prevWasPoint = !1
    }, i.prototype.startDrawing = function (t, i) {
        function h(r) {
            function M() {
                x = new Cesium.CallbackProperty(function () {
                    if (u._newMovementPosition !== undefined && f !== undefined) return [u._newMovementPosition, f.position._value]
                }, !1), u._dashedLines.length === 0 && (l = viewer.entities.add({
                    id: "drawingToolShape_NoDepthTest_Dashed",
                    polyline: {
                        positions: x,
                        width: 3,
                        material: new Cesium.PolylineDashMaterialProperty({color: Cesium.Color.WHITE}),
                        depthFailMaterial: new Cesium.PolylineDashMaterialProperty({color: Cesium.Color.WHITE})
                    }
                }), u._dashedLines.push(l))
            }

            u.activeSelectPointMode = !0;
            var c = {useDrillPick: !0};
            if (TerraExplorer.isTouch()) {
                viewer.scene.primitives.add(u._mobileIndications);
                if (TerraExplorer.internal.Navigate.IsMultiGestureNavigation) return
            }
            var h = viewer.scene.screenToWorld(r.position, c);
            if (Cesium.defined(h)) {
                i = e.extend(!0, {}, i, u._drawingOptionsObj.options);
                if (u._planeMode) if (u._activeShapePoints.length < 3) u._plane3D = null; else if (u._activeShapePoints.length === 3) {
                    var p = u._activeShapePoints[0], d = u._activeShapePoints[1], v = u._activeShapePoints[2];
                    u._plane3D = n.getPlaneFromPoints(p, d, v);
                    if (!TerraExplorer.isTouch()) {
                        if (!u._plane3D) return;
                        M()
                    }
                }
                t === a.POLYGON ? u._activeShapePoints.length < 2 && (T = !0, t = a.LINE, i.followSurface = !1, i.width = i.outlineWidth) : T && t === a.LINE && (t = a.POLYGON, delete i.color, delete i.width, viewer.entities.remove(s), viewer.entities.remove(o), s = w(TerraExplorer.isTouch() ? u._activeShapePoints : E, t, i), o = w(TerraExplorer.isTouch() ? u._activeShapePoints : E, t, i, !0), T = !1);
                var m = u.setAltitude(h, i);
                u._reprojectedPosition === undefined ? (i = m.options, h = m.newPosition) : h = u._reprojectedPosition;
                if (u._firstPickDictatesAbsAltitude) {
                    u._altitude = viewer.scene.globe.ellipsoid.cartesianToCartographic(h).height, u._altitudeMethod = u.ALTITUDE_METHODS.ABSOLUTE;
                    var g = viewer.scene.globe.ellipsoid.cartesianToCartographic(h),
                        y = Cesium.Cartographic.fromRadians(g.longitude, g.latitude, g.height + 1),
                        N = viewer.scene.globe.ellipsoid.cartographicToCartesian(y),
                        C = Cesium.Cartesian3.subtract(h, N, new Cesium.Cartesian3),
                        k = Cesium.Cartesian3.normalize(C, new Cesium.Cartesian3);
                    u._plane3D = Cesium.Plane.fromPointNormal(h, k), TerraExplorer.isTouch() || M(), u._firstPickDictatesAbsAltitude = !1
                }
                TerraExplorer.isTouch() || (f && u._plane3D === null && f.position.setValue(h), u._activeShapePoints.length === 0 && (f = b(h, i), f.show = !1, u._activeShapePoints.push(h), t !== a.POINT && (S = new Cesium.CallbackProperty(function () {
                    var e = [];
                    return u._activeShapePoints.forEach(function (t) {
                        e.push(t)
                    }), e.push(u._activeShapePoints[0]), e
                }, !1), E = new Cesium.CallbackProperty(function () {
                    if (u._activeShapePoints.length > 0) {
                        var e = viewer.scene.globe.ellipsoid.cartesianToCartographic(u._activeShapePoints[u._activeShapePoints.length - 1]),
                            t = viewer.scene.globe.ellipsoid.cartesianToCartographic(viewer.camera.position.clone()),
                            n = Cesium.defaultValue(TerraExplorer.drawingTolerance, 1e-7);
                        Math.abs(t.longitude - e.longitude) < n && Math.abs(t.latitude - e.latitude) < n && (u._activeShapePoints[u._activeShapePoints.length - 1] = u._activeShapePoints[u._activeShapePoints.length - 2].clone())
                    }
                    return u._activeShapePoints
                }, !1), s = w(E, t, i), o = w(E, t, i, !0)))), u._prevScreenPosition = r.position, u._activeShapePoints.push(h), t === a.POINT && u._activeEarthPoints.push(b(h, i)), u._currentPointIndex++;
                var L;
                TerraExplorer.isTouch() ? L = u._activeShapePoints : L = u._activeShapePoints.slice(0, u._activeShapePoints.length - 1), u._points = L, TerraExplorer.isTouch() && (u._activeType === a.POINT ? (viewer.entities.remove(s), viewer.entities.remove(o), s = w(u._activeShapePoints, u._activeType, i), o = w(u._activeShapePoints, u._activeType, i, !0)) : u.updatePrim(u._activeType));
                var A = c.allPicks;
                u._pickPrim = !1;
                if (A !== undefined && A.length > 0) {
                    var O = e.grep(A, function (e) {
                        return e.primitive !== undefined && (e.primitive instanceof Cesium.Cesium3DTileset || e.primitive instanceof Cesium.Model)
                    });
                    O.length > 0 && (u._pickPrim = !0)
                }
                TerraExplorer.isTouch() && (u.checkSelfIntersection(), u._styleDirty && u.applySelfIntersection()), u._isDraggingGlobe && (u.cancellationCallback(), u._isDraggingGlobe = !1)
            } else u.doNotRelease = !0
        }

        function p() {
            u.doNotRelease === undefined && !u._isDraggingGlobe && u._points !== undefined ? (u._onPointUpdateCallback(u._points, u._points.length - 1, u.cancellationCallback, {
                isSelfIntersect: u._isSelfIntersecting,
                isPrimitive: u._pickPrim
            }), u._prevRealScreenPosition = u._prevScreenPosition, u._firstPointReleased = !0, u.activeSelectPointMode = !1) : u.doNotRelease && (u.doNotRelease = undefined), u._prevWasPoint = !0
        }

        var u = this, a = TerraExplorer.internal.DrawingTool.SHAPE_TYPES;
        this._isActive = !0, this._activeType = t, this.__options = i;
        var c = TerraExplorer.internal.Navigate;
        c._draggingEvent.addEventListener(this.cancelPointOnDrag, this), r.Mode = r.MEASUREMENT, viewer.scene.preRender.addEventListener(this.onSyncedMovement, this), viewer._cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK), this._handler.setInputAction(function (e) {
            h(e)
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN), this._handler.setInputAction(function (e) {
            p(e)
        }, Cesium.ScreenSpaceEventType.LEFT_UP), TerraExplorer.isTouch() || this._handler.setInputAction(function (e) {
            if (Cesium.defined(f)) {
                var t = viewer.scene.pick(e.endPosition);
                if (t === undefined || t.primitive !== undefined || t.id !== undefined && (t.id.id === "drawingToolShape" || t.id.id === "drawingToolShapeNoDepth" || t.id.id === "drawingToolShape_NoDepthTest") || (u._altitudeMethod === u.ALTITUDE_METHODS.RELATIVE_TO_MODEL || u._altitudeMethod === u.ALTITUDE_METHODS.ABSOLUTE) && t.content !== undefined) {
                    var n;
                    t === undefined || t.id === undefined || t.id.id !== "drawingToolShape" && t.id.id !== "drawingToolShapeNoDepth" && t.id.id !== "drawingToolShape_NoDepthTest" ? n = viewer.scene.screenToWorld(e.endPosition, {}) : n = viewer.scene.screenToWorld(new Cesium.Cartesian2(e.endPosition.x + 1, e.endPosition.y), {}), Cesium.defined(n) && (u._newMovementPosition = n, u._newMovementPosition.screenPosition = e.endPosition, u._isMouseMovementEvent = !0, u._options = i)
                }
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE), this._handler.setInputAction(function (e) {
            var t = TerraExplorer.internal.DrawingTool;
            t.finishDrawing()
        }, Cesium.ScreenSpaceEventType.RIGHT_DOWN), e(document).bind("keydown", e.proxy(function (e) {
            if (e.keyCode == 27) {
                var t = TerraExplorer.internal.DrawingTool;
                this.abortDrawing(t.ABORT_REASONS.ESC_KEY)
            }
        }, this)), TerraExplorer.isMobile() && e(window).on("navigate", function (e, t) {
            var n = t.state.direction;
            if (n == "back") {
                var r = TerraExplorer.internal.DrawingTool;
                r.abortDrawing(r.ABORT_REASONS.NONE)
            }
        })
    }, i
}), define("internal/internal", ["./SearchBox", "./NavigationControl", "./StatusBar", "./DebugInfo", "./Units", "wfs/Layer", "sfsterrainprovider/SFSTerrainProvider", "./Project", "tools/TETools/FavoritesStorage", "./GeometryHelper", "./EngineCommon", "./Navigate", "./CesiumOverrides", "./FixedLocalTime", "./Settings", "./Tests", "./TEPosition", "./Presentation", "./DrawingTool"], function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y) {
    "use strict";
    var b = {};
    return b.SearchBox = e, b.NavigationControl = t, b.StatusBar = n, b.DebugInfo = r, b.Units = i, b.WFSLayer = s, b.SFSTerrainProvider = o, b.Project = u, b.Navigate = c, b.CesiumOverrides = h, b.FixedLocalTime = p, b.Settings = d, b.Tests = v, b.TEPosition = m, b.Presentation = g, b.DrawingTool = y, b.Engine = l, b
}), define("SGWorld/Creator", ["jquery", "TELang", "../tools/ToolDialog", "../internal/Units", "KmlParser", "SGWorld/TerraExplorerObject", "../internal/Settings"], function (e, t, n, r, i, s, o) {
    "use strict";

    function v(e) {
        var t = e.slice(0, 5);
        return t == "https" ? !0 : !1
    }

    function g(t) {
        try {
            var n = e(e(t).children()[0]).getAttributes(), r = e.grep(Object.keys(n), function (e) {
                return e.indexOf(":") > -1
            });
            r = e.map(r, function (e) {
                return e.substring(e.indexOf(":") + 1)
            })
        } catch (i) {
            return console.log("error parsing data" + i), []
        }
        return r.unshift(""), r
    }

    function y(n, r, i, s) {
        var o = !1, u = g(r);
        if (r === undefined) return !1;
        if (n === "WFS") {
            var a;
            e(u).each(function (t, n) {
                n === "" ? a = e(r).find("FeatureType") : a = e(r).find(n + "\\:FeatureType", "FeatureType");
                if (a.length > 0) return o = !0, !1
            })
        } else if (n === "WMS" || n === "WMTS") {
            var f, l = !1;
            e(u).each(function (t, n) {
                if (l) return !1;
                n === "" ? f = e(r).find("Layer") : f = e(r).find(n + "\\:Layer,Layer"), f.length > 0 && f.each(function (t, r) {
                    var i = !1;
                    if (n === "") i = e(r).children("Name").length > 0 || e(r).children("name").length > 0 || e(r).children("identifier").length > 0; else {
                        var s = n + "\\:";
                        i = e(r).find(s + "Name").length > 0 || e(r).find(s + "name").length > 0 || e(r).find(s + "identifier").length > 0 || e(r).find(s + "Identifier").length > 0
                    }
                    i && (o = !0, l = !0)
                })
            })
        }
        s.text = "";
        if (!o) {
            var c = b(s.request);
            if (c) switch (c) {
                case"NotFound":
                    s.text = t.i18n("Layers_NotFound");
                    break;
                case"NotAuthorized":
                    s.text = t.i18n("Layers_NotAuthorized");
                    break;
                default:
                    s.text = t.i18n("Layers_FailToLoad")
            }
        }
        return o
    }

    function b(e) {
        if (!e && !e.getAllResponseHeaders()) return undefined;
        var t = e.getAllResponseHeaders().match(/errortype:\s*(\S+)/);
        return t ? t[1] : undefined
    }

    function w(t, n, r) {
        var i = e(n).children("ServiceExceptionReport");
        if (i.length > 0) {
            if (r.text !== undefined) {
                i = i.children("ServiceException");
                if (i.length > 0) {
                    var s = i.attr("code"), o = m[t];
                    r.text = i.text().trim()
                }
            }
            return !0
        }
        var i = e(n).children("ExceptionReport");
        if (i.length > 0) {
            if (r.text !== undefined) {
                i = i.children("Exception");
                if (i.length > 0) {
                    var s = i.attr("exceptionCode"), o = m[t];
                    r.text = i.text().trim()
                }
            }
            return !0
        }
        return !1
    }

    function E() {
        var n = e.grep(e("#MenuTable").children(), function (e) {
            return e.IsSelected
        });
        n.length > 0 && n[0].textContent === t.i18n("Menu_Layers") && n[0].click()
    }

    function S(n, r) {
        var i = {hasDefaultLocation: !1, success: !0, err: ""};
        i.hasDefaultLocation = !1;
        if (n.indexOf("streamer.ashx") != -1) {
            var s = n.replace(/streamer.ashx/g, "pnts");
            n = s
        }
        if (n.toLocaleLowerCase().indexOf("pnts") === -1) {
            var o = n[n.length - 1];
            n = o === "/" ? n + "pnts" : n + "/pnts"
        }
        return n += "/" + r + "/tileset.json", e.ajax({
            url: encodeURI(n),
            xhrFields: {withCredentials: !0},
            success: function (e) {
                e.root != undefined ? i.hasDefaultLocation = !0 : i.hasDefaultLocation = !1
            },
            error: function (e) {
                i.success = !1, e.responseText.indexOf("(-6)") >= 0 ? i.err = t.i18n("ERR_layer_not_found", {layerName: r}) : i.err = e.responseText
            },
            async: !1
        }), i
    }

    function x(t, n) {
        var r;
        switch (n) {
            case"FeaturePolygon":
                r = "Polygons";
                break;
            case"FeatureLine":
                r = "Polylines";
                break;
            case"FeaturePoint":
                r = "Points";
                break;
            default:
                r = n
        }
        var s = Cesium.createGuid(),
            o = "<?xml version='1.0' encoding='utf-8'?>                                            <kml xmlns= 'http://www.opengis.net/kml/2.2' xmlns:sx = 'http://www.skylineglobe.com/kml/ext' xmlns:gx = 'http://www.google.com/kml/ext/2.2'>                                                <Document>                                                    <sx:FeatureLayer id='" + s + "'>" + t + "<sx:FeatureGroup id='" + s + "_1'>                                                            <sx:geometryType>" + r + "</sx:geometryType>                                                        </sx:FeatureGroup>                                                    </sx:FeatureLayer>                                                </Document>                                            </kml>",
            u = e.parseXML(o), a = e(u).find("sx\\:FeatureLayer, FeatureLayer"), f = i.convertLayerStyle(e(a[0]), u);
        return f
    }

    function T(t) {
        var n = e.parseJSON(localStorage.getItem("_TEW_Layers_")), r;
        n.forEach(function (e, n) {
            e.name !== undefined && e.name === t && (r = n)
        }), r !== undefined && (n.splice(r, 1), localStorage.setItem("_TEW_Layers_", JSON.stringify(n)))
    }

    const u = 6371010, a = 53 * Cesium.Math.RADIANS_PER_DEGREE, f = "_FromStorage",
        l = {fromStorage: !1, visibility: !0};
    var c = function () {
        this._Msg_LayerFromNonSecuredServer = t.i18n("Msg_LayerFromNonSecuredServer"), this._Msg_CouldNotCreateLayer = t.i18n("Msg_CouldNotCreateLayer"), this._Msg_NonLatLonLayer = t.i18n("non_LatLon_Layer"), this._Msg_CPTHasNoDefaultLocation = t.i18n("CPT_No_defaultLocation_Notification"), this._isElevationLayer = !1, this.CreateFor = {
            PROJECT: 0,
            UI: 1,
            API: 2
        }
    }, h = this, p = Cesium.Cartesian3.UNIT_Z, d = new Cesium.Cartesian3, m = {
        WFS: t.i18n("ERR_WFSServiceDown"),
        WMS: t.i18n("ERR_WMSServiceDown"),
        WMTS: t.i18n("ERR_WMSServiceDown"),
        "3DML": t.i18n("ERR_3DMLServiceDown"),
        CPT: t.i18n("ERR_CPTServiceDown")
    };
    (function (e) {
        e.fn.getAttributes = function () {
            var t = {};
            return this.length && e.each(this[0].attributes, function (e, n) {
                t[n.name] = n.value
            }), t
        }
    })(jQuery), c.prototype.isLayerSupported = function (n, r, i, s) {
        var o = i;
        if (o == "WMTS") var u;
        var a = n, f, l = !1, c = !1, h = "", p = this;
        return a += TerraExplorer.functions.queryStringExist(n), o == "WFS" ? a += "SERVICE=" + o + "&VERSION=1.0.0" + "&REQUEST=GetCapabilities" + "&outputFormat=GML2" + "&typeName=" + r : o == "WMS" ? a += "SERVICE=" + o + "&REQUEST=GetCapabilities" + "&layers=" + r : o == "WMTS" && (a += "SERVICE=" + o + "&REQUEST=GetCapabilities" + "&layer=" + r), e.ajax({
            dataType: "text SL_Conversion", url: encodeURI(a), success: function (t, n, i) {
                var s = {text: "", request: i};
                if (w(o, t, s)) {
                    c = !0, h = s.text;
                    return
                }
                if (!y(o, t, r, s)) {
                    c = !0, h = s.text;
                    return
                }
                var u = TerraExplorer.getXmlTag(t, "CRS", o);
                if (u.length == 0) {
                    u = TerraExplorer.getXmlTag(t, "SRS", o);
                    if (u.length == 0 && o == "WMTS") {
                        var a = e(t).find("contents,contents");
                        if (a.length > 0) {
                            var l = a.find("tilematrixset,tilematrixset");
                            if (l.length > 0) var p = e.grep(l, function (t) {
                                return e(t).children().length > 0
                            });
                            var d = e(p).children(), v = e.grep(d, function (e) {
                                return e.tagName == "ows:SupportedCRS"
                            });
                            if (v != undefined && e(v).text().indexOf("4326") > -1) {
                                f = !0;
                                var m = e.grep(d, function (e) {
                                    return e.tagName == "ows:Identifier"
                                });
                                if (m != undefined) var g = e(m).text();
                                var b = [], E = e(p).find("tilematrix,tilematrix"),
                                    S = a.find("ows\\:wgs84boundingbox,ows\\:wgs84boundingbox");
                                if (S.length > 0) {
                                    var x = e(S[0]), T = x.find("ows\\:LowerCorner,ows\\:LowerCorner").text(),
                                        N = x.find("ows\\:UpperCorner,ows\\:UpperCorner").text(),
                                        C = Cesium.Math.toRadians(Number(T.split(" ")[0])),
                                        k = Cesium.Math.toRadians(Number(T.split(" ")[1])),
                                        L = Cesium.Math.toRadians(Number(N.split(" ")[0])),
                                        A = Cesium.Math.toRadians(Number(N.split(" ")[1])), O = a.find("Format");
                                    if (O.length > 0) var M = O.first().text();
                                    var _ = new Cesium.Rectangle(C, k, L, A)
                                }
                                var D = {identifier: g, tileMatrixLabelsArray: E, rectangle: _, format: M};
                                TerraExplorer.internal.Project._wmtsDictionary[r] = D;
                                return
                            }
                        }
                    }
                    if (u.length == 0) {
                        f = !1;
                        return
                    }
                }
                e.each(u, function (e, t) {
                    if (t.textContent == "EPSG:4326") return f = !0, !1
                }), f == undefined && (f = !1)
            }, converters: {
                "text SL_Conversion": function (t) {
                    try {
                        var n = e.parseXML(t);
                        return n
                    } catch (r) {
                        return f = t.indexOf("EPSG:4326") > -1, !1
                    }
                }
            }, error: function (e, t, n) {
                return n.name === "NetworkError" && (l = !0, f = !1), !1
            }, async: !1
        }), c || (h = l ? t.i18n("ERR_NetworkError") : f ? undefined : t.i18n("Disabled_Layer")), {
            isSupported: f && !l,
            isLatLon: f,
            isServiceException: c,
            reason: h
        }
    };
    var N = function (t) {
        var n = e.extend(!0, {}, l);
        if (t.indexOf(f) != -1) {
            var r = t.split(f)[0], n = e.parseJSON(t.split(f)[1]);
            return n.url = r, n.fromStorage = !0, n
        }
        return n.url = t, n
    };
    return c.prototype.CreateFeatureLayer = function (e, t, n, s, o, u, a) {
        var f, l, c = N(t);
        f = c.fromStorage, l = c.visibility, t = c.url;
        if (v(window.location.protocol) && !v(t)) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(this._Msg_LayerFromNonSecuredServer);
            return
        }
        var h = null, p = s, d;
        t.indexOf("streamer.ashx") == -1 && t.indexOf("?") == -1 ? d = t + "/streamer.ashx" : d = t;
        var m = this.isLayerSupported(d, n, "WFS"), g = m.isLatLon, y = m.isSupported, b = m.isServiceException;
        if (b && u !== !1) return;
        !g && !f && u !== !1 && (TerraExplorer.tools.ToolDialog.showAlertDialog(this._Msg_NonLatLonLayer), o = 1);
        var w = i.replaceDomainWithTag(d), S = {
            url: w.url,
            name: n,
            displayName: e,
            visibility: l,
            style: h,
            level: r.blockWidthToTeLayerLevel(0),
            myLayer: u === !1 ? this.CreateFor.API : this.CreateFor.UI,
            type: p,
            timestamp: Cesium.defaultValue(a, Date.now()),
            latLon: g,
            isSupported: y,
            subdomains: w.subdomains
        };
        if (S.latLon != undefined && S.latLon == 0) return;
        var T;
        if (o == 0) T = TerraExplorer.tools.ToolManager._tools.EditLayersTool.firstStyleLayer(S); else {
            typeof o == "string" && (o = x(o, p)), S.style = o;
            var C = TerraExplorer.internal.Project.createFeatureLayers(S);
            T = C[0]
        }
        return T.then(function () {
            E()
        }), T
    }, c.prototype.CreateMeshLayer = function (e, t, n, r, s) {
        var o = this, u, a, f = N(t);
        t = f.url;
        if (v(window.location.protocol) && !v(t) && r !== !1) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(this._Msg_LayerFromNonSecuredServer);
            return
        }
        u = f.fromStorage, a = f.visibility;
        if (f.currentPivot !== undefined) var l = viewer.scene.globe.ellipsoid.cartesianToCartographic(new Cesium.Cartesian3(f.currentPivot.x, f.currentPivot.y, f.currentPivot.z)),
            c = {altitude: l.height, newLon: l.longitude, newLat: l.latitude};
        var h = i.replaceDomainWithTag(t), p = "mesh";
        if (h.url.toLocaleLowerCase().indexOf("streamer.ashx") != -1) {
            var d = h.url.replace(/streamer.ashx/g, "b3dm");
            h.url = d
        }
        if (h.url.toLocaleLowerCase().indexOf("b3dm") === -1) {
            var m = h.url[h.url.length - 1];
            h.url = m === "/" ? h.url + "b3dm" : h.url + "/b3dm"
        }
        var g = {
            url: h.url,
            name: n,
            displayName: e,
            visibility: a,
            myLayer: r === !1 ? this.CreateFor.API : this.CreateFor.UI,
            timestamp: Cesium.defaultValue(s, Date.now()),
            type: p,
            subdomains: h.subdomains,
            altitudeOffset: c
        }, y = TerraExplorer.internal.Project.createMeshLayers(g), b = y[0];
        return b.then(function (t) {
            t._object.readyPromise.otherwise(function (n) {
                try {
                    viewer.scene.primitives.remove(t._object), r !== !1 && TerraExplorer.tools.ToolDialog.showAlertDialog(Cesium.defaultValue(n.response, o._Msg_CouldNotCreateLayer + ": " + e))
                } catch (i) {
                }
            })
        }), b.then(function () {
            E()
        }), b
    }, c.prototype.CreateHoleOnTerrain = function (e, n, r) {
        var i = Cesium.when.defer(), o = TerraExplorer.internal.Project;
        try {
            var u = TerraExplorer.tools.ToolManager._tools.HoleOnTerrainTool.createHoleOnTerrain(n)
        } catch (a) {
            i.reject(a)
        }
        if (u instanceof TerraExplorer.HolePrimitive) {
            u.type = o.ObjectsTypes.HOLE_ON_TERRAIN, u.defaultName = t.i18n("DistanceObj_DefaultName"), u.displayName = e !== undefined ? e : TerraExplorer.internal.Project.getAvailableDefaultName(u), u.tool = TerraExplorer.tools.ToolManager._tools.HoleOnTerrainTool.getId(), u.bs = Cesium.BoundingSphere.fromPoints(u.geometryInstances.geometry._polygonHierarchy.positions), u.id = Cesium.createGuid();
            var f = new s({object: u});
            f.description = e, o.addToObjectList(f), i.resolve(f)
        } else i.reject("Could not create - Hole On Terrain");
        return i
    }, c.prototype.CreateElevationLayer = function (e, t, n, r, i) {
        return this._isElevationLayer = !0, this.CreateImageryLayer(e, t, n, r, i)
    }, c.prototype.CreateVideoOnTerrain = function (e, t, n, r, i, s) {
        return TerraExplorer.tools.ToolManager._tools.VideoOnTerrainTool.createVideoOnTerrain(e, t, n, r, i, s)
    }, c.prototype.CreateModifyTerrain = function (e, t, n, r) {
        var i = Cesium.when.defer(),
            o = TerraExplorer.tools.ToolManager._tools.ModifyTerrainTool.modifyTerrain(e, t, n, r);
        return Cesium.when(o, function (e) {
            var t = new s({object: e});
            i.resolve(t)
        }), i
    }, c.prototype.CreateModifyMesh = function (t, n, r, i, o) {
        var u = Cesium.when.defer(), a = e.extend(!0, {}, o);
        a.mtID = Cesium.createGuid(), a.name = t, a.polygon = a.vertices = n, a.modifiedHeight = r, a.isModifyB3dmObject = !0, a.meshObject = i, i.modifyB3dmObjects === undefined && (i.modifyB3dmObjects = []), i.modifyB3dmObjects.push(a);
        var f = TerraExplorer.internal.Project.CreateModifyMeshObject(a);
        return Cesium.when(f, function (e) {
            var t = new s({object: e});
            Cesium.defineProperties(t, {
                show: {
                    get: function () {
                        return this._object.Show
                    }, set: function (e) {
                        this._object.bs = e ? this._object.highBs : this._object.baseBs, this._object.Show = e
                    }
                }, description: {
                    get: function () {
                        return this._object.displayName
                    }, set: function (e) {
                        this._object.name = this._object.displayName = e
                    }
                }
            }), setTimeout(function () {
                t.show = !0
            }, 100), u.resolve(t)
        }), u
    }, c.prototype.CreateImageryLayer = function (e, t, n, r, s) {
        var o, u, a = N(t);
        o = a.fromStorage, u = a.visibility, t = a.url;
        if (v(window.location.protocol) && !v(t)) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(this._Msg_LayerFromNonSecuredServer);
            return
        }
        var f = "imagery";
        this._isElevationLayer ? t.indexOf("/Elevation") == -1 && t.indexOf("?") == -1 && (t += "/Elevation") : t.indexOf("/streamer.ashx") == -1 && t.indexOf("?") == -1 && (t += "/streamer.ashx");
        var l = this.isLayerSupported(t, n, "WMS"), c = l.isLatLon, h = l.isSupported, p = l.isServiceException;
        if (p && r !== !1) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(l.reason);
            return
        }
        !c && !o && r !== !1 && TerraExplorer.tools.ToolDialog.showAlertDialog(this._Msg_NonLatLonLayer);
        var d = i.replaceDomainWithTag(t), m = {
            url: d.url,
            name: n,
            displayName: e,
            visibility: u,
            myLayer: r === !1 ? this.CreateFor.API : this.CreateFor.UI,
            type: f,
            alpha: 1,
            subdomains: d.subdomains,
            timestamp: Cesium.defaultValue(s, Date.now()),
            latLon: c,
            isSupported: h
        };
        if (m.latLon != undefined && m.latLon == 0) {
            var g = Cesium.when.defer();
            return g.reject(this._Msg_NonLatLonLayer), g
        }
        var y;
        this._isElevationLayer ? (m.isElevationLayer = this._isElevationLayer, m.type = "elevation", this._isElevationLayer = !1, m.name.indexOf(".mpt") === -1 && (m.name += ".mpt"), y = TerraExplorer.internal.Project.createElevationLayerFromServer(m)) : y = TerraExplorer.internal.Project.createRasterLayers(m);
        if (y !== undefined) return y.length > 1 && y.shift(), y[0].then(function () {
            E()
        }), y[0]
    }, c.prototype.CreatePointCloudLayer = function (e, t, n, r, s) {
        if (v(window.location.protocol) && !v(t)) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(this._Msg_LayerFromNonSecuredServer);
            return
        }
        var o = S(t, n);
        if (!o.success && r !== !1) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(o.err);
            return
        }
        if (!o.hasDefaultLocation && r !== !1) {
            TerraExplorer.tools.ToolDialog.showAlertDialog(this._Msg_CPTHasNoDefaultLocation);
            return
        }
        var u, a, f = N(t);
        u = f.fromStorage, a = f.visibility, t = f.url;
        var l = i.replaceDomainWithTag(t), c = "cpt";
        if (l.url.indexOf("streamer.ashx") != -1) {
            var h = l.url.replace(/streamer.ashx/g, "pnts");
            l.url = h
        }
        if (l.url.toLocaleLowerCase().indexOf("pnts") === -1) {
            var p = l.url[l.url.length - 1];
            l.url = p === "/" ? l.url + "pnts" : l.url + "/pnts"
        }
        var d = {
            url: l.url,
            name: n,
            displayName: e,
            visibility: a,
            timestamp: Cesium.defaultValue(s, Date.now()),
            myLayer: r === !1 ? this.CreateFor.API : this.CreateFor.UI,
            type: c,
            subdomains: l.subdomains
        }, m = TerraExplorer.internal.Project.CreatePointCloudModel(d), g = m[0];
        return g.then(function (e) {
            e._object.readyPromise.otherwise(function (t) {
                try {
                    viewer.scene.primitives.remove(e._object), r !== !1 && TerraExplorer.tools.ToolDialog.showAlertDialog(t.response)
                } catch (n) {
                }
            })
        }), g.then(function () {
            E()
        }), g
    }, new c
}), define("SGWorld/Analysis", ["jquery", "TELang", "SGWorld/TerraExplorerObject"], function (e, t, n) {
    "use strict";

    function s(e, t) {
        return e.val < t.val ? -1 : t.val < e.val ? 1 : 0
    }

    var r = function () {
    };
    Cesium.defineProperties(r.prototype, {});
    var i = new Cesium.Cartesian3;
    return r.prototype.setSlopeMapPallete = function (e) {
        var t = [], n = !1, r = Object.entries(e);
        r.length > 0 && r.forEach(function (e) {
            e.length == 2 && e[0] >= 0 && e[0] <= 90 && t.push({
                val: 100 * Math.cos(Cesium.Math.toRadians(e[0])),
                color: e[1]
            })
        });
        if (t.length === 0 || n) {
            console.log("Error setting new pallete for slope map");
            return
        }
        t.sort(s), viewer.scene.SlopeMapPallete = t, viewer.scene.isSlopeDirty = !0
    }, r.prototype.queryElevationBuffer = function (t, n) {
        var r = Cesium.when.defer();
        t === undefined && r.reject("Could not process the query - polygon must not be undefined");
        var i = e.extend(!0, {}, n), s = Cesium.defaultValue(i.quality, 1024),
            o = Cesium.defaultValue(i.referenceAltitude, 0);
        return r.resolve(TerraExplorer.internal.Engine.queryElevationBuffer(t, s, o)), r
    }, r.prototype.CreateViewshedObject = function (r, i, s, o, u, a) {
        var f = Cesium.when.defer();
        try {
            if (s < 1 || s > 120) throw{type: "TE_EXCEPTION", format: "FovX is not in the allowed range."};
            if (o < 1 || o > 64) throw{type: "TE_EXCEPTION", format: "FovY is not in the allowed range."};
            s = s * Math.PI / 180, o = o * Math.PI / 180;
            var l = e.extend(!0, {}, a), c = l.isVOT, h = Math.tan(s / 2) / Math.tan(o / 2), p = u.heading, d = u.pitch,
                v = Cesium.defaultValue(l.roll, 0), m = new Cesium.Cartesian3(1, 1, 1), g = u.range,
                y = TerraExplorer.tools.ToolManager._tools.Viewshed.CreateViewshed(i, g, m, {
                    _displayName: r,
                    displayName: r,
                    hFOV: s,
                    vFOV: o,
                    aspectRatio: h,
                    isVOT: l.isVOT,
                    originalGuid: l.originalGuid
                });
            if (y == -1) throw{
                type: "TE_EXCEPTION",
                format: t.i18n("MAX_NUM_VIEWSHEDS_EXCEEDED", {maxNumViewsheds: TerraExplorer.maxNumViewshed})
            };
            var b = y.viewshedPrimitive._camera;
            b.setView({orientation: {heading: p, pitch: d, roll: v}});
            var w = new n({object: y});
            w._object.fromAPI = !0, c || (w.calculate = y.calculate, w.queryPointVisibility = y.queryPointVisibility, w.queryVisibilityDistance = y.queryVisibilityDistance, w.getObjectExposure = y.getObjectExposure, w.getObjectPosition = y.getObjectPosition), w.destroy = function () {
                y.destroy(this);
                for (var e in this) typeof this[e] == "function" && (this[e] = undefined);
                this._object = undefined, this.isDestroyed = !0
            }, e(".viewshedButton").length > 0 && e("#menuIconAnalyzeTool").length > 0 && e("#menuIconAnalyzeTool").click(), f.resolve(w)
        } catch (E) {
            f.reject(E)
        }
        return f
    }, new r
}), define("SGWorld/SGWorld", ["../jquery", "../TELang", "./Creator", "./Analysis"], function (e, t, n, r) {
    "use strict";
    var i = {};
    return i.Creator = n, i.Analysis = r, i
}), define("tools/Widgets/TE4WInspector/TE4WInspectorViewModel", [], function () {
    "use strict";

    function e(e, t) {
        var n = this, r = e.canvas, i = new Cesium.ScreenSpaceEventHandler(r);
        this._eventHandler = i, this._scene = e, this._canvas = r, this._primitive = undefined, this._tile = undefined, this._modelMatrixPrimitive = undefined, this._performanceDisplay = undefined, this._performanceContainer = t, this.heightsMap = !1, this.performance = !1, this.floorVisible = !0, this.generalVisible = !0, this.dropDownVisible = !0, Cesium.knockout.track(this, ["heightsMap", "performance", "toggleDropDown", "generalVisible", "toggleGeneral", "floorVisible", "toggleFloor"]), this._heightsMapSubscription = Cesium.knockout.getObservable(this, "heightsMap").subscribe(function (e) {
            TerraExplorer.onlyFloor = e, TerraExplorer.disableHolePrimitives = e, TerraExplorer.debugDisplayFloorValues = e, $.each(TerraExplorer.layers.mesh.items, function (e, t) {
                t.refresh()
            })
        }), this._performanceSubscription = Cesium.knockout.getObservable(this, "performance").subscribe(function (e) {
            e ? n._performanceDisplay = new Cesium.PerformanceDisplay({container: n._performanceContainer}) : n._performanceContainer.innerHTML = ""
        }), this._toggleDropDown = Cesium.createCommand(function () {
            n.dropDownVisible = !n.dropDownVisible
        }), this._toggleGeneral = Cesium.createCommand(function () {
            n.generalVisible = !n.generalVisible
        }), this._toggleFloor = Cesium.createCommand(function () {
            n.FloorVisible = !n.FloorVisible
        }), this._removePostRenderEvent = e.postRender.addEventListener(function () {
            n._update()
        })
    }

    return Cesium.defineProperties(e.prototype, {
        toggleGeneral: {
            get: function () {
                return this._toggleGeneral
            }
        }, toggleFloor: {
            get: function () {
                return this._toggleFloor
            }
        }, performanceContainer: {
            get: function () {
                return this._performanceContainer
            }
        }
    }), e.prototype._update = function () {
        this.performance && this._performanceDisplay.update()
    }, e.prototype.isDestroyed = function () {
        return !1
    }, e.prototype.destroy = function () {
        return this.heightsMap && (this.heightsMap = !1), this._eventHandler && this._eventHandler.destroy(), this._removePostRenderEvent && this._removePostRenderEvent(), this._heightsMapSubscription.dispose(), this._performanceSubscription.dispose(), Cesium.destroyObject(this)
    }, e
}), define("tools/Widgets/TE4WInspector/TE4WInspector", ["./TE4WInspectorViewModel"], function (e) {
    "use strict";

    function t(t, n) {
        t = Cesium.getElement(t);
        var r = document.createElement("div"), i = new e(n, r);
        this._viewModel = i, this._container = t;
        var s = document.createElement("div");
        this._element = s;
        var o = document.createElement("div");
        o.textContent = "TE4W Inspector", o.className = "cesium-cesiumInspector-button", o.setAttribute("data-bind", "click: toggleDropDown"), s.appendChild(o), s.className = "cesium-cesiumInspector", s.setAttribute("data-bind", 'css: { "cesium-cesiumInspector-visible" : dropDownVisible, "cesium-cesiumInspector-hidden" : !dropDownVisible }'), t.appendChild(this._element);
        var u = document.createElement("div");
        this._panel = u, u.className = "cesium-cesiumInspector-dropDown", s.appendChild(u);
        var a = Cesium.InspectorShared.createSection, f = Cesium.InspectorShared.createCheckbox,
            l = a(u, "Floor", "floorVisible", "toggleFloor");
        l.appendChild(f("Show Heights Map", "heightsMap"));
        var l = a(u, "General", "generalVisible", "toggleGeneral");
        l.appendChild(f("Performance Display", "performance")), r.className = "cesium-cesiumInspector-performanceDisplay", l.appendChild(r), Cesium.knockout.applyBindings(i, this._element)
    }

    return Cesium.defineProperties(t.prototype, {
        container: {
            get: function () {
                return this._container
            }
        }, viewModel: {
            get: function () {
                return this._viewModel
            }
        }
    }), t.prototype.isDestroyed = function () {
        return !1
    }, t.prototype.destroy = function () {
        return Cesium.knockout.cleanNode(this._element), this._container.removeChild(this._element), this.viewModel.destroy(), Cesium.destroyObject(this)
    }, t
}), define("tools/Widgets/viewerTE4WInspectorMixin", ["./TE4WInspector/TE4WInspector"], function (e) {
    "use strict";

    function n(n) {
        var r = document.createElement("div");
        r.className = "cesium-viewer-cesiumInspectorContainer", n.container.appendChild(r);
        var i = new e(r, n.scene);
        t = i, n.te4wInspector || Cesium.defineProperties(n, {
            te4wInspector: {
                get: function () {
                    return t
                }
            }
        })
    }

    var t = undefined;
    return n
}), define("TerraExplorer", ["jquery", "./jquery-ui.min", "./flot/jquery.flot.min", "./jquery.tablesorter.min", "./tools/TETools/FavoritesStorage", "./internal/GeometryHelper", "./tools/tools", "./internal/internal", "./SGWorld/SGWorld", "./tools/TETools/LayersStorage", "./tools/Widgets/viewerTE4WInspectorMixin"], function ($, jqueryui, flot, jquerysorter, TerraExplorer_FavoritesStorage, TerraExplorer_GeometryHelper, TerraExplorer_tools, TerraExplorer_internal, TerraExplorer_SGWorld, TerraExplorer_LayersStorage, TerraExplorer_ViewerTE4WInspectorMixin) {
    "use strict";

    function handleDebugArguments(e) {
        var t = e.getUrlParameters().debug || 0;
        if (t == 1) {
            viewer.scene.debugShowFramesPerSecond = !0;
            var n = function (e, t) {
                $(viewer.scene._performanceContainer).css({top: 65}), viewer.scene.postRender.removeEventListener(n)
            };
            viewer.scene.postRender.addEventListener(n)
        }
        t == 2 && (viewer.extend(Cesium.viewerCesiumInspectorMixin), $(viewer.cesiumInspector._container).css({top: 65})), t == 3 && viewer.extend(Cesium.viewerPerformanceWatchdogMixin, {lowFrameRateMessage: "This application appears to be performing poorly on your system.  Please try using a different web browser or updating your video drivers."}), t == 4 && (viewer.extend(Cesium.viewerCesium3DTilesInspectorMixin), $(viewer.cesium3DTilesInspector._container).css({top: 65})), TerraExplorer._3dTilesetMaximumMemoryUsage = e.getUrlParameters().max3DTSMemory, TerraExplorer._3dTilesetMaximumMemoryUsage && (TerraExplorer._3dTilesetMaximumMemoryUsage = parseInt(TerraExplorer._3dTilesetMaximumMemoryUsage)), TerraExplorer._3dTilesetMaximumScreenSpaceError = e.getUrlParameters().max3DTSSSE, TerraExplorer._3dTilesetMaximumScreenSpaceError && (TerraExplorer._3dTilesetMaximumScreenSpaceError = parseInt(TerraExplorer._3dTilesetMaximumScreenSpaceError))
    }

    function handleScaleArguments(e) {
        var t = e.getUrlParameters().scale || 1;
        if (t != 1 && t >= .1 && t <= 5) {
            var n = viewer.canvas, r = function () {
                n.style.width = "100%", n.style.height = "100%", n.width = n.offsetWidth / t, n.height = n.offsetHeight / t
            };
            $(viewer.canvas.parentElement).resize(r), r()
        }
    }

    function handleMiscArguments(e) {
        var t = e.getUrlParameters().ot || 0;
        if (t != 1) delete TerraExplorer_tools.ToolManager._tools.ObliqueViewerTool; else {
            var n = e.getUrlParameters().otff;
            n && (TerraExplorer_tools.ToolManager._tools.ObliqueViewerTool._footprintForwardLayerName = n);
            var r = e.getUrlParameters().otbf;
            r && (TerraExplorer_tools.ToolManager._tools.ObliqueViewerTool._footprintBackwardLayerName = r);
            var i = e.getUrlParameters().otip;
            i && (TerraExplorer_tools.ToolManager._tools.ObliqueViewerTool._imagesPath = i)
        }
    }

    function showIEWarning() {
        var e = this, t = localStorage.getItem("_TEW_show_ie11_warning_");
        if (t != "true") {
            var n = TELang.i18n("IE_Alert", {brTag: "<br>"}),
                r = "<label id='checkBoxLabel' for='cb'><input name='cb' id='cb' type='checkbox' style='vertical-align:middle'>Do not show this message again</label>",
                i = $("<div id='$warningDiv' style='position:absolute; display:table; top:30%; width:60%; margin:0 20%; background-color:rgba(10,10,10,0.5); color:rgba(255,255,255,1.0); left:0px; text-align:center; line-height:1.5'><table style='width:100%;'><tr><td><img width=16 style='vertical-align: text-top;' src='../terraexplorerweb/img/newDesign/warningIcon.png'/>&nbsp;&nbsp;" + n + "</td></tr><tr><td>" + r + "</td><tr></div>");
            i.find("#cb").on("click", function () {
                t = $(this).prop("checked") == 1, localStorage.setItem("_TEW_show_ie11_warning_", t), i.remove()
            }), $("#" + window.divId).append(i), setTimeout(function () {
                i.remove()
            }, 1e4)
        }
    }

    function refreshAnalysisTab() {
        $("#menuIconAnalyzeTool").length > 0 && $("#menuIconAnalyzeTool").click()
    }

    function refresNavigationTab() {
        $("#menuIconMenu_Navigation").length > 0 && $("#menuIconMenu_Navigation").click()
    }

    var TerraExplorer = {
        Version: "7.2.3.6000",
        ViewerTE4WInspectorMixin: TerraExplorer_ViewerTE4WInspectorMixin,
        getXmlTag: function (e, t, n) {
            var r = $(e).find(t);
            return r.length == 0 && n.toLowerCase() === "wfs" && (r = $(e).find("wfs\\:" + t + "," + t)), r.length > 0 ? r : $([])
        },
        getUrlParameters: function () {
            var e = [], t, n = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&");
            for (var r = 0; r < n.length; r++) t = n[r].split("="), e.push(t[0]), e[t[0]] = t[1];
            return e
        },
        getQueryValue: function (key) {
            var match = window.location.href.match(eval("/[?&]" + key.toLowerCase() + "[=]([^&]+)/i"));
            if (match == null) return;
            return unescape(match[1].replace("+", "%20"))
        },
        getCurrentSitePath: function () {
            var e = TerraExplorer.getQueryValue("site");
            return e == undefined ? "" : ("/" + e).replace("#", "")
        },
        init: function () {
            function r() {
                TerraExplorer.internal.Settings.sharpness !== undefined ? TerraExplorer.settings.sharpness = TerraExplorer.internal.Settings.sharpness : TerraExplorer.settings.sharpness = 1.3, TerraExplorer.internal.Settings.saturation !== undefined ? TerraExplorer.settings.saturation = TerraExplorer.internal.Settings.saturation : TerraExplorer.settings.saturation = 1.3, TerraExplorer.internal.Settings.brightness !== undefined ? TerraExplorer.settings.brightness = TerraExplorer.internal.Settings.brightness : TerraExplorer.settings.brightness = 0, TerraExplorer.internal.Settings.contrast !== undefined ? TerraExplorer.settings.contrast = TerraExplorer.internal.Settings.contrast : TerraExplorer.settings.contrast = 0, TerraExplorer.settings.gamma = 1, TerraExplorer.internal.Settings.resolutionScale !== undefined ? viewer.resolutionScale = TerraExplorer.internal.Settings.resolutionScale : TerraExplorer.isMobile() ? viewer.resolutionScale = .8 : viewer.resolutionScale = 1
            }

            function i() {
                viewer.shadowMap.maximumDistance = 25e3, viewer.shadows = Cesium.ShadowMode.DISABLED, viewer.terrainShadows = Cesium.ShadowMode.DISABLED, viewer.shadowMap.darkness = .5, TerraExplorer_internal.FixedLocalTime.Enable = !0
            }

            function s() {
                viewer.scene.helperVS == undefined && TerraExplorer.tools.ToolManager._tools.Viewshed.CreateAHelperViewshed()
            }

            function o() {
                TerraExplorer.tools.ToolManager._tools.MessageLinkTool.open()
            }

            function u() {
                window.addEventListener("keydown", function (e) {
                    e.ctrlKey && e.altKey && e.key === "d" && (viewer.te4wInspector && !viewer.te4wInspector.isDestroyed() ? viewer.te4wInspector.destroy() : viewer.extend(TerraExplorer.ViewerTE4WInspectorMixin))
                })
            }

            function a() {
                TerraExplorer.internal.DrawingTool = new TerraExplorer.internal.DrawingTool, TerraExplorer.internal.Engine = new TerraExplorer.internal.Engine
            }

            function d() {
                return window.mobilecheck = function () {
                    var e = !1;
                    return function (t) {
                        if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0, 4))) e = !0
                    }(navigator.userAgent || navigator.vendor || window.opera), e
                }
            }

            function v() {
                return window.mobileAndTabletcheck = function () {
                    var e = !1;
                    return function (t) {
                        if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0, 4))) e = !0
                    }(navigator.userAgent || navigator.vendor || window.opera), e
                }
            }

            function m() {
                var e = {};
                return e.isOpera = !!window.opr && !!opr.addons || !!window.opera || navigator.userAgent.indexOf(" OPR/") >= 0, e.isFirefox = typeof InstallTrigger != "undefined", e.isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor") > 0, e.isIE = !!document.documentMode, e.isEdge = !e.isIE && !!window.StyleMedia, e.isChrome = !!window.chrome && !!window.chrome.webstore, e.isBlink = (e.isChrome || e.isOpera) && !!window.CSS, e
            }

            var e = Cesium.WebMapServiceImageryProvider.prototype.requestImage;
            Cesium.WebMapServiceImageryProvider.prototype.requestImage = function (t, n, r) {
                this.pendingRequests = this.pendingRequests || 0;
                var i = e.apply(this, arguments);
                if (i != undefined) {
                    this.pendingRequests++;
                    var s = this;
                    i.then(function () {
                        s.pendingRequests--
                    }, function () {
                        s.pendingRequests--
                    })
                }
                return i
            };
            var t = Cesium.MapboxImageryProvider.prototype.requestImage;
            Cesium.MapboxImageryProvider.prototype.requestImage = function (e, n, r) {
                this.pendingRequests = this.pendingRequests || 0;
                var i = t.apply(this, arguments);
                if (i != undefined) {
                    this.pendingRequests++;
                    var s = this;
                    i.then(function () {
                        s.pendingRequests--
                    }, function () {
                        s.pendingRequests--
                    })
                }
                return i
            }, this.browser = m(), Cesium.RequestScheduler.maximumRequestsPerServer = 6, Cesium.RequestScheduler.maximumRequests = 30, Cesium.RequestScheduler.prioritize = !0, viewer.scene.pickTranslucentDepth = this.browser.isEdge ? !1 : !0, viewer.scene.globe.enableLighting = !1, this.optimized_depth_picking = !0, this.browser.isFrenchLanguage = navigator.language.substring(0, 2) === "fr", this.isTouch = v(), this.isMobile = d(), this.activeGlobalStates = {}, this.groundCollisionDetection = !0;
            var n = viewer.scene.context;
            TerraExplorer.isMobile() && (TerraExplorer.isMobileFloatingPointSupport = n._textureFloat & n._textureHalfFloat & n._colorBufferFloat & n._colorBufferHalfFloat & n._textureFloatLinear & n._textureHalfFloat), this.longRepeatValContour = 200, this.shortRepeatValContour = 20, this._saturation = undefined, this.functions = {}, this.functions.queryStringExist = function (t) {
                return t.indexOf("?") > -1 ? "&" : "?"
            }, this.deferredObjects = {}, this.functions.queryBestLevel = function (e) {
                function n(e, r) {
                    var i = TerraExplorer.tools.ToolManager._tools.QueryTool, s = r,
                        o = Cesium.sampleTerrain(viewer.terrainProvider, s, [e]);
                    return Cesium.when(o, function (r) {
                        var i = r[0].height;
                        i !== undefined ? (t.lowBoundLevel = Math.max(s, t.lowBoundLevel), s = Math.floor((t.highBoundLevel + t.lowBoundLevel) / 2), t.highBoundLevel > t.lowBoundLevel + 1 ? n(e, s) : (Cesium.sampleTerrain(viewer.terrainProvider, s, e), t.resolve(s))) : (t.highBoundLevel = Math.min(s, t.highBoundLevel), s = Math.floor(s / 2), n(e, s))
                    }).otherwise(function (e) {
                    }), t
                }

                var t = Cesium.when.defer();
                return t.highBoundLevel = 25, t.lowBoundLevel = 0, n(e, 25)
            }, TerraExplorer_tools.ToolManager.registerTools([]), i(), r(), s(), a(), o(), u(), TerraExplorer.changeLUTTexture = function (e) {
                var t = Cesium.Resource.fetchImage(e);
                t.then(function (e) {
                    TerraExplorer.LUT_Texture = TerraExplorer.internal.Engine.createTextureFromImage(e);
                    if (TerraExplorer._LUT === undefined) {
                        var t = viewer.scene.postProcessStages;
                        TerraExplorer._LUT = t.add(Cesium.PostProcessStageLibrary.createLUTStage())
                    }
                    TerraExplorer._LUT.uniforms.LUT = TerraExplorer.LUT_Texture
                })
            }, this.tilesProcessingLimit = 4, this.useAggressiveTileDelete = !1, this.__maxTerrainLevel = 30, this.saveViewshedsFromAPI = !0, this.maxNumViewshed = 8;
            var f = typeof InstallTrigger != "undefined", l = !!document.documentMode, c = !l && !!window.StyleMedia,
                h = f || c;
            this.max3DTiles = h ? 250 : 300;
            var p = [];
            l && (showIEWarning(), String.prototype.endsWith || (String.prototype.endsWith = function (e, t) {
                var n = this.toString();
                if (typeof t != "number" || !isFinite(t) || Math.floor(t) !== t || t > n.length) t = n.length;
                t -= e.length;
                var r = n.indexOf(e, t);
                return r !== -1 && r === t
            }), String.prototype.startsWith = function (e) {
                return this.indexOf(e) === 0 ? !0 : !1
            }, Object.values = function (e) {
                return this.keys(e).map(function (t) {
                    return e[t]
                })
            }), TerraExplorer_internal.Settings.init(), TerraExplorer_GeometryHelper.init(), TerraExplorer_internal.Units.init(), TerraExplorer_tools.ContextMenu.init(), TerraExplorer_tools.MessageView.init(), TerraExplorer_FavoritesStorage.loadFavoritesLayer(), TerraExplorer_LayersStorage.loadLayersFromLocalStorage(), TerraExplorer_internal.Navigate.init(), TerraExplorer_internal.FixedLocalTime.init(), TerraExplorer_internal.CesiumOverrides.init(), TerraExplorer_internal.NavigationControl.init(), viewer.scene.pickPositionSupported == 0 && console.log(TELang.i18n("warning_depth_buffer_picking_not_supported")), TerraExplorer_internal.Tests.init(), handleDebugArguments(this), handleScaleArguments(this), handleMiscArguments(this)
        },
        style: {
            measureBillboardOptions: function (e, t) {
                return {
                    position: e,
                    image: Cesium.writeTextToCanvas(t, {
                        font: "normal bold 32px Arial",
                        fill: !0,
                        stroke: !1,
                        fillColor: Cesium.Color.YELLOW,
                        strokeColor: Cesium.Color.BLACK,
                        strokeWidth: 1
                    }),
                    scale: .5,
                    pixelOffset: new Cesium.Cartesian2(0, -16),
                    eyeOffset: Cesium.DynamicEyeOffset()
                }
            }, segmentBillboardOptions: function (e, t, n, r) {
                var i = new Cesium.Cartesian3;
                Cesium.Cartesian3.lerp(t, n, .5, i);
                var s = r ? this.analysisBillboardOptions(i, e, t, n) : this.measureBillboardOptions(i, e);
                return s
            }, analysisLabelOptions: function (e, t, n, r, i) {
                var s = new Cesium.Cartesian3;
                if (n !== null && n !== undefined) {
                    Cesium.Cartesian3.lerp(t, n, .5, s);
                    var o;
                    i !== undefined && i.isLowResOriginal !== undefined ? o = i.isLowResOriginal : o = viewer.scene.globe._surface._debug.maxDepth < 6;
                    if (o) {
                        var u = viewer.scene.globe.ellipsoid.cartesianToCartographic(s), a = 0;
                        s = viewer.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromRadians(u.longitude, u.latitude, a))
                    }
                } else s = Cesium.Cartographic.toCartesian(t);
                var f = {
                    position: s,
                    text: e,
                    font: "500 14px arial",
                    fillColor: i !== undefined && i.color ? i.color : new Cesium.Color(1, .84, 0, 1),
                    horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    showBackground: !0,
                    pixelOffset: i !== undefined && i.pixelOffset ? i.pixelOffset : new Cesium.Cartesian2(0, 0),
                    backgroundColor: i !== undefined && i.backgroundColor ? i.backgroundColor : new Cesium.Color(.12, .12, .12, 1),
                    backgroundPadding: new Cesium.Cartesian2(7, 5),
                    scale: .9,
                    eyeOffset: Cesium.DynamicEyeOffset()
                };
                return r ? (f.distanceDisplayCondition = new Cesium.DistanceDisplayCondition(1, r * 20 + 2), f.disableDepthTestDistance = r * 2) : n !== null ? (f.disableDepthTestDistance = Cesium.Cartesian3.distance(t, n) * 1, f.distanceDisplayCondition = new Cesium.DistanceDisplayCondition(0, Cesium.Cartesian3.distance(t, n) * 20 + 2)) : (f.disableDepthTestDistance = undefined, f.distanceDisplayCondition = undefined), f
            }, analysisBillboardOptions: function (e, t, n, r) {
                var i = {
                    image: Cesium.writeTextToCanvas(t, {
                        font: "normal bold 28px Arial",
                        fill: !0,
                        stroke: !1,
                        scale: 0,
                        fillColor: Cesium.Color.WHITE,
                        strokeColor: Cesium.Color.BLACK,
                        strokeWidth: 10
                    }),
                    scaleByDistance: new Cesium.NearFarScalar(0, 1, Cesium.Cartesian3.distance(n, r) * 10, 0),
                    showBackground: !0,
                    backgroundColor: new Cesium.Color(.11, .11, .11, 1),
                    backgroundPadding: new Cesium.Cartesian2(70, 50),
                    translucencyByDistance: new Cesium.NearFarScalar(0, 1, Cesium.Cartesian3.distance(n, r) * 10, 0),
                    eyeOffset: Cesium.DynamicEyeOffset()
                }, s = this.measureBillboardOptions(e, t), o = $.extend(!0, {}, s, i);
                return o
            }
        },
        getCurrentPresentation: function () {
            return TerraExplorer.tools.ToolManager._tools.PresentationTool ? TerraExplorer.tools.ToolManager._tools.PresentationTool._currentPresentation : null
        },
        _untrustedSkylineGlobeServers: {},
        _ongoingSkylineGlobeServerTests: {},
        isSkylineGlobeServer: function (e, t) {
            var n = new Cesium.Uri(e), r = e + this.functions.queryStringExist(e) + "checkServer=1",
                i = r.toLowerCase(), s = !1, o = "SG", u = 0, a = 80;
            if (this._untrustedSkylineGlobeServers[i]) return t != undefined && t(n, !1, o, u, a), !1;
            var f = TerraExplorer.trustedSkylineGlobeServers.contains(e);
            return f != undefined && t != undefined ? (t(n, !0, f, u, a), !0) : (this._ongoingSkylineGlobeServerTests[i] instanceof Array || (this._ongoingSkylineGlobeServerTests[i] = []), this._ongoingSkylineGlobeServerTests[i].push(t), this._ongoingSkylineGlobeServerTests[i].length > 1 ? s : ($.ajax({
                url: r,
                success: function (e) {
                    try {
                        s = e.sg == 1, s && (o = e.appDomain, u = e.secured == 1, a = parseInt(e.port))
                    } catch (t) {
                        s = !1
                    }
                },
                error: function () {
                    console.log(e + " is not a SkylineGlobeServer")
                },
                complete: function () {
                    s == 0 && (TerraExplorer._untrustedSkylineGlobeServers[i] = !0), TerraExplorer._ongoingSkylineGlobeServerTests[i].forEach(function (e, t) {
                        e && e(n, s, o, u, a)
                    }), delete TerraExplorer._ongoingSkylineGlobeServerTests[i]
                },
                async: t != undefined
            }), s))
        },
        trustedSkylineGlobeServers: new function () {
            var e = {};
            this.addTrustedSG = function (t, n) {
                Cesium.defined(e[t.toLowerCase()]) || (e[t.toLowerCase()] = n.toLowerCase())
            }, this.contains = function (t) {
                if (!Cesium.defined(t)) return !1;
                var n = new Cesium.Uri(t);
                n.normalize();
                var r = e[n.authority.toLowerCase()];
                return r != undefined && n.path.toLowerCase().indexOf("/" + r + "/") == 0 ? r : undefined
            }
        },
        settings: {},
        debugFrameBuffer: {
            frameBufferTexture: undefined, factor: 1, addEventListener: !0, show: function () {
                this.addEventListener && viewer.scene.preRender.addEventListener(this.onPreFrame, this), this.addEventListener = !1;
                if (this.frameBufferTexture != undefined) {
                    var e = "uniform sampler2D frameBuffer_texture; \nuniform float factor; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec3 color = texture2D(frameBuffer_texture, v_textureCoordinates).rgb; \n    //gl_FragColor = vec4(vec3(fract(shadow*10.)), 1.0);\n   float c = fract(color.r * factor); \n   gl_FragColor = vec4(c,c,c, 1.0); \n}\n",
                        t = this;
                    this.debugFrameBufferCommand = viewer.scene.context.createViewportQuadCommand(e, {
                        uniformMap: {
                            frameBuffer_texture: function () {
                                return t.frameBufferTexture
                            }, factor: function () {
                                return t.factor
                            }
                        }, owner: this
                    }), this.debugFrameBufferCommand.pass = Cesium.Pass.OVERLAY;
                    var n = viewer.canvas.width, r = viewer.canvas.height, i = new Cesium.BoundingRectangle,
                        s = Math.max(n, r);
                    i.width = Math.floor(s * .3), i.height = Math.floor(s * .3), i.x = Math.floor(n - i.width * 1.1), i.y = Math.floor(r - i.height * 1.1), this.debugFrameBufferCommand.renderState = Cesium.RenderState.fromCache({viewport: Cesium.BoundingRectangle.clone(i)})
                }
            }, hide: function () {
                this.frameBufferTexture = undefined, this.addEventListener = !0, viewer.scene.preRender.removeEventListener(this.onPreFrame, this)
            }, onPreFrame: function (e) {
                this.show()
            }
        },
        USE_CORRIDOR_FOR_LINE_WIDTH_IN_METERS: 0,
        layers: {
            elevation: {
                create: function (e, t, n, r) {
                    return TerraExplorer.SGWorld.Creator.CreateElevationLayer(e !== undefined && e !== "" ? e : n, t, n, r)
                }
            }, feature: {
                create: function (e, t, n, r, i, s) {
                    return TerraExplorer.SGWorld.Creator.CreateFeatureLayer(e !== undefined && e !== "" ? e : n, t, n, r, i, s)
                }, featureLine: {}, featurePoint: {}, featurePolygon: {}
            }, imagery: {
                create: function (e, t, n, r) {
                    return TerraExplorer.SGWorld.Creator.CreateImageryLayer(e !== undefined && e !== "" ? e : n, t, n, r)
                }
            }, mesh: {
                create: function (e, t, n, r) {
                    return TerraExplorer.SGWorld.Creator.CreateMeshLayer(e !== undefined && e !== "" ? e : n, t, n, r)
                }
            }, pointCloud: {
                create: function (e, t, n, r) {
                    return TerraExplorer.SGWorld.Creator.CreatePointCloudLayer(e !== undefined && e !== "" ? e : n, t, n, r)
                }
            }, loadLayer: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.LoadLayersTool)
                }
            }
        },
        objects: {
            videoOnTerrain: {
                create: function (e, t, n, r, i, s) {
                    return TerraExplorer.SGWorld.Creator.CreateVideoOnTerrain(e, t, n, r, i, s)
                }
            }, modifyTerrain: {
                create: function (e, t, n, r) {
                    return TerraExplorer.SGWorld.Creator.CreateModifyTerrain(e, t, n, r)
                }
            }, holeOnTerrain: {
                create: function (e, t, n) {
                    return TerraExplorer.SGWorld.Creator.CreateHoleOnTerrain(e, t, n)
                }
            }, modifyMesh: {
                create: function (e, t, n, r, i) {
                    return TerraExplorer.SGWorld.Creator.CreateModifyMesh(e, t, n, r, i)
                }
            }
        },
        ViewMode: {_3D: 3, _2D: 2, _2D_NORTH: 1},
        navigate: {
            viewMode: {}, underground: {}, flyAround: {
                start: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.Rotate)
                }, stop: function () {
                    TerraExplorer.internal.Navigate.stop()
                }, isActive: function () {
                    return TerraExplorer.internal.Navigate.isFlyAround()
                }
            }, faceNorth: function () {
                TerraExplorer.internal.Navigate.faceNorth()
            }, stop: function () {
                TerraExplorer.internal.Navigate.stop()
            }, flyToPosition: function (e, t) {
                TerraExplorer.internal.Navigate.flyToPosition(e, t)
            }, jumpToPosition: function (e, t) {
                TerraExplorer.internal.Navigate.jumpToPosition(e, t)
            }, position: {
                create: function (e) {
                    return new TerraExplorer.internal.TEPosition(e)
                }
            }, zoom: function (e) {
                TerraExplorer.internal.Navigate.zoom(e)
            }, createLocation: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.AddFavorite)
                }
            }
        },
        AltitudeMethod: {RELATIVE_TO_MODEL: 0, RELATIVE_TO_TERRAIN: 1, ABSOLUTE: 2, ON_TERRAIN: 3},
        GroundClampingMethod: {CLAMPS_TO_TERRAIN: 0, CLAMPS_TO_MODEL: 1, CLAMPS_TO_FLOOR: 2},
        FeatureTypes: {
            POLYGON: "FeaturePolygon",
            POLYLINE: "FeaturePolyline",
            LINE: "FeatureLine",
            POINT: "FeaturePoint"
        },
        ElevationBehavior: {REPLACE: 0, OFFSET: 1, CROP_ABOVE: 2, CROP_BELOW: 3},
        drawing: {
            drawPoints: function (e) {
                return TerraExplorer.internal.DrawingTool.drawPoints(e)
            }, drawPolyline: function (e) {
                return TerraExplorer.internal.DrawingTool.drawPolyline(e)
            }, drawPolygon: function (e) {
                return TerraExplorer.internal.DrawingTool.drawPolygon(e)
            }
        },
        project: {},
        ContourMode: {COLORS_AND_LINES: 0, COLORS: 1, LINES: 2},
        analysis: {
            viewshed: {
                create: function (e, t, n, r, i, s) {
                    return TerraExplorer.SGWorld.Analysis.CreateViewshedObject(e, t, n, r, i, s)
                }, startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.AddViewshed)
                }
            }, queryElevationBuffer: {
                create: function (e, t) {
                    return TerraExplorer.SGWorld.Analysis.queryElevationBuffer(e, t)
                }
            }, shadow: {}, contourMap: {}, slopeMap: {
                setSlopeMapPalette: function (e) {
                    TerraExplorer.SGWorld.Analysis.setSlopeMapPallete(e)
                }
            }, query: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.QueryTool)
                }
            }, distance: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.DistanceTool)
                }
            }, area: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.AreaTool)
                }
            }, volume: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.VolumeAnalysis)
                }
            }, profile: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.ProfileTool)
                }
            }, time: {
                startTool: function () {
                    TerraExplorer.tools.ToolManager.startTool(TerraExplorer.tools.ToolManager._tools.TimeTool)
                }
            }
        }
    };
    return Cesium.defineProperties(TerraExplorer.analysis.shadow, {
        show: {
            get: function () {
                return viewer.shadows == 0 ? !1 : viewer.shadows == 1 ? !0 : viewer.shadows
            }, set: function (e) {
                if (e && viewer.shadows == 0 || !e && viewer.shadows == 1) TerraExplorer.tools.ToolManager._tools.ShadowTool.terrainShadowToggle(), refreshAnalysisTab()
            }
        }
    }), Cesium.defineProperties(TerraExplorer.analysis.contourMap, {
        mode: {
            get: function () {
                return viewer.scene.showContourColors === !0 && viewer.scene.showContourLines === !1 ? TerraExplorer.ContourMode.COLORS : viewer.scene.showContourColors === !1 && viewer.scene.showContourLines === !0 ? TerraExplorer.ContourMode.LINES : TerraExplorer.ContourMode.COLORS_AND_LINES
            }, set: function (e) {
                e == TerraExplorer.ContourMode.COLORS_AND_LINES ? (viewer.scene.showContourColors = !0, viewer.scene.showContourLines = !0) : e == TerraExplorer.ContourMode.COLORS ? (viewer.scene.showContourColors = !0, viewer.scene.showContourLines = !1) : e == TerraExplorer.ContourMode.LINES && (viewer.scene.showContourColors = !1, viewer.scene.showContourLines = !0)
            }
        }, show: {
            get: function () {
                return !!TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.ContourMap.getId()]
            }, set: function (e) {
                (e === !0 && !this.show || e === !1 && this.show) && TerraExplorer.tools.ToolManager._tools.ContourMap.open(), refreshAnalysisTab()
            }
        }
    }), Cesium.defineProperties(TerraExplorer.analysis.slopeMap, {
        show: {
            get: function () {
                return !!TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.Slope.getId()]
            }, set: function (e) {
                if (e && !!TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.Slope.getId()] == 0 || !e && !!TerraExplorer.activeGlobalStates[TerraExplorer.tools.ToolManager._tools.Slope.getId()] == 1) TerraExplorer.tools.ToolManager._tools.Slope.open(), refreshAnalysisTab()
            }
        }
    }), Cesium.defineProperties(TerraExplorer.analysis, {
        items: {
            get: function () {
                var e = TerraExplorer.internal.Project._allAnalysisObjects;
                return e.viewshed.concat(e.area).concat(e.distance).concat(e.volume)
            }
        }
    }), Cesium.defineProperties(TerraExplorer.analysis.viewshed, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allAnalysisObjects.viewshed
            }
        }
    }), Cesium.defineProperties(TerraExplorer.analysis.distance, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allAnalysisObjects.distance
            }
        }
    }), Cesium.defineProperties(TerraExplorer.analysis.area, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allAnalysisObjects.area
            }
        }
    }), Cesium.defineProperties(TerraExplorer.analysis.volume, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allAnalysisObjects.volume
            }
        }
    }), Cesium.defineProperties(TerraExplorer.project, {
        items: {
            get: function () {
                var e = TerraExplorer.layers.items.concat(TerraExplorer.analysis.items);
                return e
            }
        }
    }), Cesium.defineProperties(TerraExplorer.navigate.viewMode, {
        mode: {
            get: function () {
                return TerraExplorer.internal.Navigate._currentNavigationMode
            }, set: function (e) {
                e == TerraExplorer.ViewMode._3D ? TerraExplorer.tools.ToolManager._tools.ThreeDMode.open() : e == TerraExplorer.ViewMode._2D ? TerraExplorer.tools.ToolManager._tools.TwoDMode.open() : e == TerraExplorer.ViewMode._2D_NORTH && TerraExplorer.tools.ToolManager._tools.TwoDNorthMode.open(), refresNavigationTab()
            }
        }
    }), Cesium.defineProperties(TerraExplorer.navigate.underground, {
        mode: {
            get: function () {
                return viewer.scene.undergroundMode
            }, set: function (e) {
                e && !viewer.scene.undergroundMode && TerraExplorer.tools.ToolManager._tools.UndergroundTool.open(), !e && viewer.scene.undergroundMode && TerraExplorer.tools.ToolManager._tools.UndergroundTool.open(), refresNavigationTab()
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers, {
        items: {
            get: function () {
                var e = TerraExplorer.internal.Project._allLayersObjects;
                return e.elevation.concat(e.imagery).concat(e.feature.FeatureLine).concat(e.feature.FeaturePoint).concat(e.feature.FeaturePolygon).concat(e.mesh).concat(e.cpt)
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.elevation, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.elevation
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.imagery, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.imagery
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.feature, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.feature.FeatureLine.concat(TerraExplorer.internal.Project._allLayersObjects.feature.FeaturePoint).concat(TerraExplorer.internal.Project._allLayersObjects.feature.FeaturePolygon)
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.feature.featureLine, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.feature.FeatureLine
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.feature.featurePoint, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.feature.FeaturePoint
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.feature.featurePolygon, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.feature.FeaturePolygon
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.mesh, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.mesh
            }
        }
    }), Cesium.defineProperties(TerraExplorer.layers.pointCloud, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allLayersObjects.cpt
            }
        }
    }), Cesium.defineProperties(TerraExplorer.objects, {
        items: {
            get: function () {
                var e = TerraExplorer.internal.Project._allAnalysisObjects;
                return e.modifyTerrain.concat(e.videoOnTerrain).concat(e.holeOnTerrain)
            }
        }
    }), Cesium.defineProperties(TerraExplorer.objects.videoOnTerrain, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allAnalysisObjects.videoOnTerrain
            }
        }
    }), Cesium.defineProperties(TerraExplorer.objects.modifyTerrain, {
        items: {
            get: function () {
                var e = $.grep(TerraExplorer.internal.Project._allAnalysisObjects.modifyTerrain, function (e) {
                    return !e._object.isModifyB3dmObject
                });
                return e
            }
        }
    }), Cesium.defineProperties(TerraExplorer.objects.modifyMesh, {
        items: {
            get: function () {
                var e = $.grep(TerraExplorer.internal.Project._allAnalysisObjects.modifyTerrain, function (e) {
                    return e._object.isModifyB3dmObject === !0
                });
                return e
            }
        }
    }), Cesium.defineProperties(TerraExplorer.objects.holeOnTerrain, {
        items: {
            get: function () {
                return TerraExplorer.internal.Project._allAnalysisObjects.holeOnTerrain
            }
        }
    }), Cesium.defineProperties(TerraExplorer.settings, {
        saturation: {
            set: function (e) {
                if (TerraExplorer._saturation === undefined) {
                    var t = viewer.scene.postProcessStages;
                    TerraExplorer._saturation = t.add(Cesium.PostProcessStageLibrary.createSaturationStage())
                }
                TerraExplorer._saturation.uniforms.saturation = e
            }, get: function () {
                return TerraExplorer._saturation.uniforms.saturation
            }
        }, brightness: {
            set: function (e) {
                if (TerraExplorer.bcg === undefined) {
                    var t = viewer.scene.postProcessStages;
                    TerraExplorer.bcg = t.add(Cesium.PostProcessStageLibrary.createBCGStage())
                }
                TerraExplorer.bcg.uniforms.brightness = e
            }, get: function () {
                return TerraExplorer.bcg.uniforms.brightness
            }
        }, contrast: {
            set: function (e) {
                if (TerraExplorer.bcg === undefined) {
                    var t = viewer.scene.postProcessStages;
                    TerraExplorer.bcg = t.add(Cesium.PostProcessStageLibrary.createBCGStage())
                }
                TerraExplorer.bcg.uniforms.contrast = e + 1
            }, get: function () {
                return TerraExplorer.bcg.uniforms.contrast - 1
            }
        }, gamma: {
            set: function (e) {
                if (TerraExplorer.bcg === undefined) {
                    var t = viewer.scene.postProcessStages;
                    TerraExplorer.bcg = t.add(Cesium.PostProcessStageLibrary.createBCGStage())
                }
                TerraExplorer.bcg.uniforms.gamma = e
            }, get: function () {
                return TerraExplorer.bcg.uniforms.gamma
            }
        }, sharpness: {
            set: function (e) {
                e -= 1;
                if (TerraExplorer._sharpen === undefined) {
                    var t = viewer.scene.postProcessStages;
                    TerraExplorer._sharpen = t.add(Cesium.PostProcessStageLibrary.createSharpenStage())
                }
                TerraExplorer._sharpen.uniforms.sharpen = e
            }, get: function () {
                return TerraExplorer._sharpen.uniforms.sharpen + 1
            }
        }, lut: {
            set: function (e) {
                TerraExplorer.changeLUTTexture(e)
            }, get: function () {
                return TerraExplorer._LUT.uniforms.LUT
            }
        }, lut_factor: {
            get: function () {
                return TerraExplorer._LUT.uniforms.factor
            }, set: function (e) {
                TerraExplorer._LUT.uniforms.factor = e
            }
        }
    }), Cesium.defineProperties(TerraExplorer, {
        groundClampingMethod: {
            get: function () {
                return this._groundClampingMethod
            }, set: function (e) {
                if (e < 0 || e > 2) return;
                this._groundClampingMethod = e, $(this.internal.Project.FeatureLayers).each(function (e, t) {
                    t.type === "FeaturePolygon" && t.refresh()
                })
            }
        }
    }), TerraExplorer.tools = TerraExplorer_tools, TerraExplorer.internal = TerraExplorer_internal, TerraExplorer.SGWorld = TerraExplorer_SGWorld, TerraExplorer
}), require(["TerraExplorer"], function (e) {
    "use strict";
    var t = typeof window != "undefined" ? window : typeof self != "undefined" ? self : {};
    t.TerraExplorer = e
}, undefined, !0), define("RequireTE", function () {
});